diff -Nru php-5.4.19/ext/apc/apc_bin.c php-5.4.19.bak/ext/apc/apc_bin.c
--- php-5.4.19/ext/apc/apc_bin.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_bin.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,1046 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt.                                 |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Brian Shire <shire@php.net>                                 |
+  |          Xinchen Hui <laruence@php.net>                              |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: apc_bin.c 327151 2012-08-16 15:21:44Z laruence $ */
+
+/* Creates a binary architecture specific output to a string or file containing
+ * the current cache contents for both fies and user variables.  This is accomplished
+ * via the apc_copy_* functions and "swizzling" pointer values to a position
+ * independent value, and unswizzling them on restoration.
+ */
+
+#include "apc_globals.h"
+#include "apc_bin.h"
+#include "apc_zend.h"
+#include "apc_php.h"
+#include "apc_sma.h"
+#include "apc_pool.h"
+#include "ext/standard/md5.h"
+
+extern apc_cache_t* apc_cache;
+extern apc_cache_t* apc_user_cache;
+
+extern int _apc_store(char *strkey, int strkey_len, const zval *val, const uint ttl, const int exclusive TSRMLS_DC); /* this is hacky */
+
+#define APC_BINDUMP_DEBUG 0
+
+#if APC_BINDUMP_DEBUG
+
+#define SWIZZLE(bd, ptr)  \
+    do { \
+        if((long)bd < (long)ptr && (ulong)ptr < ((long)bd + bd->size)) { \
+            printf("SWIZZLE: %x ~> ", ptr); \
+            ptr = (void*)((long)(ptr) - (long)(bd)); \
+            printf("%x in %s on line %d", ptr, __FILE__, __LINE__); \
+        } else if((long)ptr > bd->size) { /* not swizzled */ \
+            apc_error("pointer to be swizzled is not within allowed memory range! (%x < %x < %x) in %s on %d" TSRMLS_CC, (long)bd, ptr, ((long)bd + bd->size), __FILE__, __LINE__); \
+            return; \
+        } \
+        printf("\n"); \
+    } while(0);
+
+#define UNSWIZZLE(bd, ptr)  \
+    do { \
+      printf("UNSWIZZLE: %x -> ", ptr); \
+      ptr = (void*)((long)(ptr) + (long)(bd)); \
+      printf("%x in %s on line %d \n", ptr, __FILE__, __LINE__); \
+    } while(0);
+
+#else    /* !APC_BINDUMP_DEBUG */
+
+#define SWIZZLE(bd, ptr) \
+    do { \
+        if((long)bd < (long)ptr && (ulong)ptr < ((long)bd + bd->size)) { \
+            ptr = (void*)((long)(ptr) - (long)(bd)); \
+        } else if((ulong)ptr > bd->size) { /* not swizzled */ \
+            apc_error("pointer to be swizzled is not within allowed memory range! (%x < %x < %x) in %s on %d" TSRMLS_CC, (long)bd, ptr, ((long)bd + bd->size), __FILE__, __LINE__); \
+            return NULL; \
+        } \
+    } while(0);
+
+#define UNSWIZZLE(bd, ptr) \
+    do { \
+      ptr = (void*)((long)(ptr) + (long)(bd)); \
+    } while(0);
+
+#endif
+
+static void *apc_bd_alloc(size_t size TSRMLS_DC);
+static void apc_bd_free(void *ptr TSRMLS_DC);
+static void *apc_bd_alloc_ex(void *ptr_new, size_t size TSRMLS_DC);
+
+typedef void (*apc_swizzle_cb_t)(apc_bd_t *bd, zend_llist *ll, void *ptr TSRMLS_DC);
+
+#if APC_BINDUMP_DEBUG
+#define apc_swizzle_ptr(bd, ll, ptr) _apc_swizzle_ptr(bd, ll, (void*)ptr, __FILE__, __LINE__ TSRMLS_CC)
+#else
+#define apc_swizzle_ptr(bd, ll, ptr) _apc_swizzle_ptr(bd, ll, (void*)ptr, NULL, 0 TSRMLS_CC)
+#endif
+
+static void _apc_swizzle_ptr(apc_bd_t *bd, zend_llist *ll, void **ptr, const char* file, int line TSRMLS_DC);
+static void apc_swizzle_function(apc_bd_t *bd, zend_llist *ll, zend_function *func TSRMLS_DC);
+static void apc_swizzle_class_entry(apc_bd_t *bd, zend_llist *ll, zend_class_entry *ce TSRMLS_DC);
+static void apc_swizzle_hashtable(apc_bd_t *bd, zend_llist *ll, HashTable *ht, apc_swizzle_cb_t swizzle_cb, int is_ptr TSRMLS_DC);
+static void apc_swizzle_zval(apc_bd_t *bd, zend_llist *ll, zval *zv TSRMLS_DC);
+static void apc_swizzle_op_array(apc_bd_t *bd, zend_llist *ll, zend_op_array *op_array TSRMLS_DC);
+static void apc_swizzle_property_info(apc_bd_t *bd, zend_llist *ll, zend_property_info *pi TSRMLS_DC);
+static void apc_swizzle_function_entry(apc_bd_t *bd, zend_llist *ll, const zend_function_entry *fe TSRMLS_DC);
+static void apc_swizzle_arg_info_array(apc_bd_t *bd, zend_llist *ll, const zend_arg_info* arg_info_array, uint num_args TSRMLS_DC);
+
+static apc_bd_t* apc_swizzle_bd(apc_bd_t* bd, zend_llist *ll TSRMLS_DC);
+static int apc_unswizzle_bd(apc_bd_t *bd, int flags TSRMLS_DC);
+
+/* {{{ apc_bd_alloc
+ *  callback for copy_* functions */
+static void *apc_bd_alloc(size_t size TSRMLS_DC) {
+    return apc_bd_alloc_ex(NULL, size TSRMLS_CC);
+} /* }}} */
+
+/* {{{ apc_bd_free
+ *  callback for copy_* functions */
+static void apc_bd_free(void *ptr TSRMLS_DC) {
+    size_t *size;
+    if(zend_hash_index_find(&APCG(apc_bd_alloc_list), (ulong)ptr, (void**)&size) == FAILURE) {
+        apc_error("apc_bd_free could not free pointer (not found in list: %x)" TSRMLS_CC, ptr);
+        return;
+    }
+    APCG(apc_bd_alloc_ptr) = (void*)((size_t)APCG(apc_bd_alloc_ptr) - *size);
+    zend_hash_index_del(&APCG(apc_bd_alloc_list), (ulong)ptr);
+} /* }}} */
+
+/* {{{ apc_bd_alloc_ex
+ *  set ranges or allocate a block of data from an already (e)malloc'd range.
+ *  if ptr_new is not NULL, it will reset the pointer to start at ptr_new,
+ *  with a range of size.  If ptr_new is NULL, returns the next available
+ *  block of given size.
+ */
+static void *apc_bd_alloc_ex(void *ptr_new, size_t size TSRMLS_DC) {
+    void *rval;
+
+    rval = APCG(apc_bd_alloc_ptr);
+    if(ptr_new != NULL) {  /* reset ptrs */
+      APCG(apc_bd_alloc_ptr) = ptr_new;
+      APCG(apc_bd_alloc_ubptr) = (void*)((unsigned char *) ptr_new + size);
+    } else {  /* alloc block */
+      APCG(apc_bd_alloc_ptr) = (void*)((size_t)APCG(apc_bd_alloc_ptr) + size);
+#if APC_BINDUMP_DEBUG
+      apc_notice("apc_bd_alloc: rval: 0x%x  ptr: 0x%x  ubptr: 0x%x  size: %d" TSRMLS_CC, rval, APCG(apc_bd_alloc_ptr), APCG(apc_bd_alloc_ubptr), size);
+#endif
+      if(APCG(apc_bd_alloc_ptr) > APCG(apc_bd_alloc_ubptr)) {
+          apc_error("Exceeded bounds check in apc_bd_alloc_ex by %d bytes." TSRMLS_CC, (unsigned char *) APCG(apc_bd_alloc_ptr) - (unsigned char *) APCG(apc_bd_alloc_ubptr));
+          return NULL;
+      }
+      zend_hash_index_update(&APCG(apc_bd_alloc_list), (ulong)rval, &size, sizeof(size_t), NULL);
+    }
+
+    return rval;
+} /* }}} */
+
+/* {{{ _apc_swizzle_ptr */
+static void _apc_swizzle_ptr(apc_bd_t *bd, zend_llist *ll, void **ptr, const char* file, int line TSRMLS_DC) {
+    if(*ptr) {
+        if((long)bd < (long)*ptr && (ulong)*ptr < ((long)bd + bd->size)) {
+            zend_llist_add_element(ll, &ptr);
+#if APC_BINDUMP_DEBUG
+            printf("[%06d] apc_swizzle_ptr: %x -> %x ", zend_llist_count(ll), ptr, *ptr);
+            printf(" in %s on line %d \n", file, line);
+#endif
+        } else if((ulong)ptr > bd->size) {
+            apc_error("pointer to be swizzled is not within allowed memory range! (%x < %x < %x) in %s on %d" TSRMLS_CC, (long)bd, *ptr, ((long)bd + bd->size), file, line); \
+            return;
+        }
+    }
+} /* }}} */
+
+/* {{{ apc_swizzle_op_array */
+static void apc_swizzle_op_array(apc_bd_t *bd, zend_llist *ll, zend_op_array *op_array TSRMLS_DC) {
+    uint i;
+
+#ifdef ZEND_ENGINE_2
+    apc_swizzle_arg_info_array(bd, ll, op_array->arg_info, op_array->num_args TSRMLS_CC);
+    apc_swizzle_ptr(bd, ll, &op_array->arg_info);
+#else
+    if (op_array->arg_types) {
+        apc_swizzle_ptr(bd, ll, &op_array->arg_types);
+    }
+#endif
+
+    apc_swizzle_ptr(bd, ll, &op_array->function_name);
+    apc_swizzle_ptr(bd, ll, &op_array->filename);
+    apc_swizzle_ptr(bd, ll, &op_array->refcount);
+#ifdef ZEND_ENGINE_2_4
+    if (op_array->last_literal) {
+        int i = 0;
+        apc_swizzle_ptr(bd, ll, &(op_array->literals));
+        for (; i<op_array->last_literal; i++) {
+            apc_swizzle_zval(bd, ll, &((op_array->literals[i]).constant) TSRMLS_CC);
+        }
+    }
+#endif
+
+    /* swizzle op_array */
+    for(i=0; i < op_array->last; i++) {
+#ifndef ZEND_ENGINE_2_4
+        if(op_array->opcodes[i].result.op_type == IS_CONST) {
+            apc_swizzle_zval(bd, ll, &op_array->opcodes[i].result.u.constant TSRMLS_CC);
+        }
+        if(op_array->opcodes[i].op1.op_type == IS_CONST) {
+            apc_swizzle_zval(bd, ll, &op_array->opcodes[i].op1.u.constant TSRMLS_CC);
+        }
+        if(op_array->opcodes[i].op2.op_type == IS_CONST) {
+            apc_swizzle_zval(bd, ll, &op_array->opcodes[i].op2.u.constant TSRMLS_CC);
+        }
+#else
+        if (op_array->opcodes[i].op1_type == IS_CONST) {
+            apc_swizzle_ptr(bd, ll, &op_array->opcodes[i].op1.literal);
+        }
+        if (op_array->opcodes[i].op2_type == IS_CONST) {
+            apc_swizzle_ptr(bd, ll, &op_array->opcodes[i].op2.literal);
+        }
+        if (op_array->opcodes[i].result_type == IS_CONST) {
+            apc_swizzle_ptr(bd, ll, &op_array->opcodes[i].result.literal);
+        }
+#endif
+        switch (op_array->opcodes[i].opcode) {
+#ifdef ZEND_ENGINE_2_3
+            case ZEND_GOTO:
+#endif
+            case ZEND_JMP:
+#ifdef ZEND_ENGINE_2_4
+                apc_swizzle_ptr(bd, ll, &op_array->opcodes[i].op1.jmp_addr);
+#else
+                apc_swizzle_ptr(bd, ll, &op_array->opcodes[i].op1.u.jmp_addr);
+#endif
+                break;
+            case ZEND_JMPZ:
+            case ZEND_JMPNZ:
+            case ZEND_JMPZ_EX:
+            case ZEND_JMPNZ_EX:
+#ifdef ZEND_ENGINE_2_3
+            case ZEND_JMP_SET:
+#endif
+#ifdef ZEND_ENGINE_2_4
+            case ZEND_JMP_SET_VAR:
+#endif
+#ifdef ZEND_ENGINE_2_4
+                apc_swizzle_ptr(bd, ll, &op_array->opcodes[i].op2.jmp_addr);
+#else
+                apc_swizzle_ptr(bd, ll, &op_array->opcodes[i].op2.u.jmp_addr);
+#endif
+        }
+    }
+    apc_swizzle_ptr(bd, ll, &op_array->opcodes);
+
+    /* break-continue array ptr */
+    if(op_array->brk_cont_array) {
+        apc_swizzle_ptr(bd, ll, &op_array->brk_cont_array);
+    }
+
+    /* static voriables */
+    if(op_array->static_variables) {
+        apc_swizzle_hashtable(bd, ll, op_array->static_variables, (apc_swizzle_cb_t)apc_swizzle_zval, 1 TSRMLS_CC);
+        apc_swizzle_ptr(bd, ll, &op_array->static_variables);
+    }
+
+#ifdef ZEND_ENGINE_2
+    /* try-catch */
+    if(op_array->try_catch_array) {
+        apc_swizzle_ptr(bd, ll, &op_array->try_catch_array);
+    }
+#endif
+
+#ifdef ZEND_ENGINE_2_1 /* PHP 5.1 */
+    /* vars */
+    if(op_array->vars) {
+        for(i=0; (signed int) i < op_array->last_var; i++) {
+            apc_swizzle_ptr(bd, ll, &op_array->vars[i].name);
+        }
+        apc_swizzle_ptr(bd, ll, &op_array->vars);
+    }
+#endif
+
+#ifdef ZEND_ENGINE_2
+    /* doc comment */
+    if(op_array->doc_comment) {
+        apc_swizzle_ptr(bd, ll, &op_array->doc_comment);
+    }
+#endif
+
+} /* }}} */
+
+/* {{{ apc_swizzle_function */
+static void apc_swizzle_function(apc_bd_t *bd, zend_llist *ll, zend_function *func TSRMLS_DC) {
+    apc_swizzle_op_array(bd, ll, &func->op_array TSRMLS_CC);
+#ifdef ZEND_ENGINE_2
+    if(func->common.scope) {
+        apc_swizzle_ptr(bd, ll, &func->common.scope);
+    }
+#endif
+} /* }}} */
+
+/* {{{ apc_swizzle_class_entry */
+static void apc_swizzle_class_entry(apc_bd_t *bd, zend_llist *ll, zend_class_entry *ce TSRMLS_DC) {
+
+    uint i;
+
+    if(ce->name) {
+        apc_swizzle_ptr(bd, ll, &ce->name);
+    }
+
+    if (ce->type == ZEND_USER_CLASS && ZEND_CE_DOC_COMMENT(ce)) {
+        apc_swizzle_ptr(bd, ll, &ZEND_CE_DOC_COMMENT(ce));
+    }
+
+#ifndef ZEND_ENGINE_2
+    apc_swizzle_ptr(bd, ll, &ce->refcount);
+#endif
+
+    apc_swizzle_hashtable(bd, ll, &ce->function_table, (apc_swizzle_cb_t)apc_swizzle_function, 0 TSRMLS_CC);
+#ifdef ZEND_ENGINE_2_4
+    if (ce->default_properties_table) {
+        apc_swizzle_ptr(bd, ll, &ce->default_properties_table);
+        for (i = 0; i < ce->default_properties_count; i++) {
+            if (ce->default_properties_table[i]) {
+                apc_swizzle_ptr(bd, ll, &ce->default_properties_table[i]);
+                apc_swizzle_zval(bd, ll, ce->default_properties_table[i] TSRMLS_CC);
+            }
+        }
+    }
+#else
+    apc_swizzle_hashtable(bd, ll, &ce->default_properties, (apc_swizzle_cb_t)apc_swizzle_zval, 1 TSRMLS_CC);
+#endif
+
+#ifdef ZEND_ENGINE_2
+    apc_swizzle_hashtable(bd, ll, &ce->properties_info, (apc_swizzle_cb_t)apc_swizzle_property_info, 0 TSRMLS_CC);
+#endif
+
+#ifdef ZEND_ENGINE_2_4
+    if (ce->default_static_members_table) {
+        apc_swizzle_ptr(bd, ll, &ce->default_static_members_table);
+        for (i = 0; i < ce->default_static_members_count; i++) {
+            if (ce->default_static_members_table[i]) {
+                apc_swizzle_ptr(bd, ll, &ce->default_static_members_table[i]);
+                apc_swizzle_zval(bd, ll, ce->default_static_members_table[i] TSRMLS_CC);
+            }
+        }
+    }
+    ce->static_members_table = ce->default_static_members_table;
+#else
+    apc_swizzle_hashtable(bd, ll, &ce->default_static_members, (apc_swizzle_cb_t)apc_swizzle_zval, 1 TSRMLS_CC);
+
+    if(ce->static_members != &ce->default_static_members) {
+        apc_swizzle_hashtable(bd, ll, ce->static_members, (apc_swizzle_cb_t)apc_swizzle_zval, 1 TSRMLS_CC);
+    } else {
+        apc_swizzle_ptr(bd, ll, &ce->static_members);
+    }
+#endif
+
+    apc_swizzle_hashtable(bd, ll, &ce->constants_table, (apc_swizzle_cb_t)apc_swizzle_zval, 1 TSRMLS_CC);
+
+    if(ce->type == ZEND_INTERNAL_CLASS &&  ZEND_CE_BUILTIN_FUNCTIONS(ce)) {
+        for(i=0; ZEND_CE_BUILTIN_FUNCTIONS(ce)[i].fname; i++) {
+            apc_swizzle_function_entry(bd, ll, &ZEND_CE_BUILTIN_FUNCTIONS(ce)[i] TSRMLS_CC);
+        }
+    }
+
+    apc_swizzle_ptr(bd, ll, &ce->constructor);
+    apc_swizzle_ptr(bd, ll, &ce->destructor);
+    apc_swizzle_ptr(bd, ll, &ce->clone);
+    apc_swizzle_ptr(bd, ll, &ce->__get);
+    apc_swizzle_ptr(bd, ll, &ce->__set);
+    apc_swizzle_ptr(bd, ll, &ce->__unset);
+    apc_swizzle_ptr(bd, ll, &ce->__isset);
+    apc_swizzle_ptr(bd, ll, &ce->__call);
+    apc_swizzle_ptr(bd, ll, &ce->serialize_func);
+    apc_swizzle_ptr(bd, ll, &ce->unserialize_func);
+
+#ifdef ZEND_ENGINE_2_2
+    apc_swizzle_ptr(bd, ll, &ce->__tostring);
+#endif
+
+    if (ce->type == ZEND_USER_CLASS) {
+        apc_swizzle_ptr(bd, ll, &ZEND_CE_FILENAME(ce));
+    }
+} /* }}} */
+
+/* {{{ apc_swizzle_property_info */
+static void apc_swizzle_property_info(apc_bd_t *bd, zend_llist *ll, zend_property_info *pi TSRMLS_DC) {
+    apc_swizzle_ptr(bd, ll, &pi->name);
+    apc_swizzle_ptr(bd, ll, &pi->doc_comment);
+
+#ifdef ZEND_ENGINE_2_2
+    apc_swizzle_ptr(bd, ll, &pi->ce);
+#endif
+} /* }}} */
+
+/* {{{ apc_swizzle_function_entry */
+static void apc_swizzle_function_entry(apc_bd_t *bd, zend_llist *ll, const zend_function_entry *fe TSRMLS_DC) {
+    apc_swizzle_ptr(bd, ll, &fe->fname);
+    apc_swizzle_arg_info_array(bd, ll, fe->arg_info, fe->num_args TSRMLS_CC);
+    apc_swizzle_ptr(bd, ll, &fe->arg_info);
+} /* }}} */
+
+/* {{{ apc_swizzle_arg_info_array */
+static void apc_swizzle_arg_info_array(apc_bd_t *bd, zend_llist *ll, const zend_arg_info* arg_info_array, uint num_args TSRMLS_DC) {
+    if(arg_info_array) {
+        uint i;
+
+        for(i=0; i < num_args; i++) {
+            apc_swizzle_ptr(bd, ll, &arg_info_array[i].name);
+            apc_swizzle_ptr(bd, ll, &arg_info_array[i].class_name);
+        }
+    }
+
+} /* }}} */
+
+/* {{{ apc_swizzle_hashtable */
+static void apc_swizzle_hashtable(apc_bd_t *bd, zend_llist *ll, HashTable *ht, apc_swizzle_cb_t swizzle_cb, int is_ptr TSRMLS_DC) {
+    uint i;
+    Bucket **bp, **bp_prev;
+
+    bp = &ht->pListHead;
+    while(*bp) {
+        bp_prev = bp;
+        bp = &(*bp)->pListNext;
+        if(is_ptr) {
+            swizzle_cb(bd, ll, *(void**)(*bp_prev)->pData TSRMLS_CC);
+            apc_swizzle_ptr(bd, ll, (*bp_prev)->pData);
+        } else {
+            swizzle_cb(bd, ll, (void**)(*bp_prev)->pData TSRMLS_CC);
+        }
+#ifdef ZEND_ENGINE_2_4
+        if ((*bp_prev)->nKeyLength) {
+            if (IS_INTERNED((*bp_prev)->arKey)) {
+                /* we should dump that internal string out */
+                char *tmp = apc_bd_alloc((*bp_prev)->nKeyLength TSRMLS_CC);
+                memcpy(tmp, (*bp_prev)->arKey, (*bp_prev)->nKeyLength);
+                (*bp_prev)->arKey = tmp;
+            }
+            apc_swizzle_ptr(bd, ll, &(*bp_prev)->arKey);
+        }
+#endif
+        apc_swizzle_ptr(bd, ll, &(*bp_prev)->pData);
+        if((*bp_prev)->pDataPtr) {
+            apc_swizzle_ptr(bd, ll, &(*bp_prev)->pDataPtr);
+        }
+        if((*bp_prev)->pListLast) {
+            apc_swizzle_ptr(bd, ll, &(*bp_prev)->pListLast);
+        }
+        if((*bp_prev)->pNext) {
+            apc_swizzle_ptr(bd, ll, &(*bp_prev)->pNext);
+        }
+        if((*bp_prev)->pLast) {
+            apc_swizzle_ptr(bd, ll, &(*bp_prev)->pLast);
+        }
+        apc_swizzle_ptr(bd, ll, bp_prev);
+    }
+    for(i=0; i < ht->nTableSize; i++) {
+        if(ht->arBuckets[i]) {
+            apc_swizzle_ptr(bd, ll, &ht->arBuckets[i]);
+        }
+    }
+    apc_swizzle_ptr(bd, ll, &ht->pListTail);
+
+    apc_swizzle_ptr(bd, ll, &ht->arBuckets);
+} /* }}} */
+
+/* {{{ apc_swizzle_zval */
+static void apc_swizzle_zval(apc_bd_t *bd, zend_llist *ll, zval *zv TSRMLS_DC) {
+
+    if(APCG(copied_zvals).nTableSize) {
+        if(zend_hash_index_exists(&APCG(copied_zvals), (ulong)zv)) {
+          return;
+        }
+        zend_hash_index_update(&APCG(copied_zvals), (ulong)zv, (void**)&zv, sizeof(zval*), NULL);
+    }
+
+    switch(Z_TYPE_P(zv) & IS_CONSTANT_TYPE_MASK) {
+        case IS_NULL:
+        case IS_LONG:
+        case IS_DOUBLE:
+        case IS_BOOL:
+        case IS_RESOURCE:
+            /* nothing to do */
+            break;
+        case IS_CONSTANT:
+        case IS_STRING:
+            apc_swizzle_ptr(bd, ll, &zv->value.str.val);
+            break;
+        case IS_ARRAY:
+        case IS_CONSTANT_ARRAY:
+            apc_swizzle_hashtable(bd, ll, zv->value.ht, (apc_swizzle_cb_t)apc_swizzle_zval, 1 TSRMLS_CC);
+            apc_swizzle_ptr(bd, ll, &zv->value.ht);
+            break;
+        case IS_OBJECT:
+            break;
+        default:
+            assert(0); /* shouldn't happen */
+    }
+} /* }}} */
+
+/* {{{ apc_swizzle_bd */
+static apc_bd_t* apc_swizzle_bd(apc_bd_t* bd, zend_llist *ll TSRMLS_DC) {
+    unsigned int i;
+    int count;
+    PHP_MD5_CTX context;
+    unsigned char digest[16];
+    register php_uint32 crc;
+    php_uint32 crcinit = 0;
+    unsigned char *crc_p;
+    void ***ptr;
+    void ***ptr_list;
+
+    count = zend_llist_count(ll);
+    ptr_list = emalloc(count * sizeof(void**));
+    ptr = zend_llist_get_first(ll);
+    for(i=0; i < count; i++) {
+#if APC_BINDUMP_DEBUG
+        printf("[%06d] ", i+1);
+#endif
+        SWIZZLE(bd, **ptr); /* swizzle ptr */
+        if((long)bd < (long)*ptr && (ulong)*ptr < ((long)bd + bd->size)) {  /* exclude ptrs that aren't actually included in the ptr list */
+#if APC_BINDUMP_DEBUG
+            printf("[------] ");
+#endif
+            SWIZZLE(bd, *ptr);  /* swizzle ptr list */
+            ptr_list[i] = *ptr;
+        }
+        ptr = zend_llist_get_next(ll);
+    }
+    SWIZZLE(bd, bd->entries);
+
+    if(count > 0) {
+        bd = erealloc(bd, bd->size + (count * sizeof(void**)));
+        bd->num_swizzled_ptrs = count;
+        bd->swizzled_ptrs = (void***)((unsigned char *)bd + bd->size -2);   /* extra -1 for null termination */
+        bd->size += count * sizeof(void**);
+        memcpy(bd->swizzled_ptrs, ptr_list, count * sizeof(void**));
+        SWIZZLE(bd, bd->swizzled_ptrs);
+    } else {
+        bd->num_swizzled_ptrs = 0;
+        bd->swizzled_ptrs = NULL;
+    }
+    ((unsigned char*)bd)[((bd->size >= 1) ? (bd->size-1) : 0)] = 0;  /* silence null termination for zval strings */
+    efree(ptr_list);
+    bd->swizzled = 1;
+
+    /* Generate MD5/CRC32 checksum */
+    memset(bd->md5, 0, 16);
+    bd->crc=0;
+
+    PHP_MD5Init(&context);
+    PHP_MD5Update(&context, (const unsigned char*)bd, bd->size);
+    PHP_MD5Final(digest, &context);
+    crc = apc_crc32((unsigned char*)bd, bd->size);
+
+    memmove(bd->md5, digest, 16);
+    bd->crc = crc;
+
+    return bd;
+} /* }}} */
+
+/* {{{ apc_unswizzle_bd */
+static int apc_unswizzle_bd(apc_bd_t *bd, int flags TSRMLS_DC) {
+    unsigned int i;
+    unsigned char md5_orig[16];
+    unsigned char digest[16];
+    PHP_MD5_CTX context;
+    register php_uint32 crc;
+    php_uint32 crcinit = 0;
+    php_uint32 crc_orig;
+    unsigned char *crc_p;
+
+    /* Verify the md5 or crc32 before we unswizzle */
+    memmove(md5_orig, bd->md5, 16);
+    memset(bd->md5, 0, 16);
+    crc_orig = bd->crc;
+    bd->crc=0;
+
+    if(flags & APC_BIN_VERIFY_MD5) {
+        PHP_MD5Init(&context);
+        PHP_MD5Update(&context, (const unsigned char*)bd, bd->size);
+        PHP_MD5Final(digest, &context);
+        if(memcmp(md5_orig, digest, 16)) {
+            apc_error("MD5 checksum of binary dump failed." TSRMLS_CC);
+            return -1;
+        }
+    }
+    if(flags & APC_BIN_VERIFY_CRC32) {
+        crc = apc_crc32((unsigned char*)bd, bd->size);
+        if(crc_orig != crc) {
+            apc_error("CRC32 checksum of binary dump failed." TSRMLS_CC);
+            return -1;
+        }
+    }
+    memcpy(bd->md5, md5_orig, 16); /* add back md5 checksum */
+    bd->crc = crc_orig;
+
+    UNSWIZZLE(bd, bd->entries);
+    UNSWIZZLE(bd, bd->swizzled_ptrs);
+    for(i=0; i < bd->num_swizzled_ptrs; i++) {
+        if(bd->swizzled_ptrs[i]) {
+            UNSWIZZLE(bd, bd->swizzled_ptrs[i]);
+            if(*bd->swizzled_ptrs[i] && (*bd->swizzled_ptrs[i] < (void*)bd)) {
+                UNSWIZZLE(bd, *bd->swizzled_ptrs[i]);
+            }
+        }
+    }
+
+    bd->swizzled=0;
+
+    return 0;
+} /* }}} */
+
+/* {{{ apc_bin_checkfilter */
+static int apc_bin_checkfilter(HashTable *filter, const char *key, uint key_len) {
+    zval **zptr;
+
+    if(filter == NULL) {
+        return 1;
+    }
+
+    if(zend_hash_find(filter, (char*)key, key_len, (void**)&zptr) == SUCCESS) {
+        if(Z_TYPE_PP(zptr) == IS_LONG && Z_LVAL_PP(zptr) == 0) {
+            return 0;
+        }
+    } else {
+        return 0;
+    }
+
+
+    return 1;
+} /* }}} */
+
+/* {{{ apc_bin_fixup_op_array */
+static inline void apc_bin_fixup_op_array(zend_op_array *op_array) {
+    ulong i;
+    for (i = 0; i < op_array->last; i++) {
+        op_array->opcodes[i].handler = zend_opcode_handlers[APC_OPCODE_HANDLER_DECODE(&op_array->opcodes[i])];
+    }
+}
+/* }}} */
+
+/* {{{ apc_bin_fixup_class_entry */
+static inline void apc_bin_fixup_class_entry(zend_class_entry *ce) {
+    zend_function *fe;
+    HashPosition hpos;
+
+    /* fixup the opcodes in each method */
+    zend_hash_internal_pointer_reset_ex(&ce->function_table, &hpos);
+    while(zend_hash_get_current_data_ex(&ce->function_table, (void**)&fe, &hpos) == SUCCESS) {
+        apc_bin_fixup_op_array(&fe->op_array);
+        zend_hash_move_forward_ex(&ce->function_table, &hpos);
+    }
+
+    /* fixup hashtable destructor pointers */
+    ce->function_table.pDestructor = (dtor_func_t)zend_function_dtor;
+#ifndef ZEND_ENGINE_2_4
+    ce->default_properties.pDestructor = (dtor_func_t)zval_ptr_dtor_wrapper;
+#endif
+    ce->properties_info.pDestructor = (dtor_func_t)zval_ptr_dtor_wrapper;
+#ifndef ZEND_ENGINE_2_4
+    ce->default_static_members.pDestructor = (dtor_func_t)zval_ptr_dtor_wrapper;
+    if (ce->static_members) {
+        ce->static_members->pDestructor = (dtor_func_t)zval_ptr_dtor_wrapper;
+    }
+#endif
+    ce->constants_table.pDestructor = (dtor_func_t)zval_ptr_dtor_wrapper;
+}
+/* }}} */
+
+/* {{{ apc_bin_dump */
+apc_bd_t* apc_bin_dump(HashTable *files, HashTable *user_vars TSRMLS_DC) {
+    uint fcount;
+    slot_t *sp;
+    apc_bd_entry_t *ep;
+    int i, count=0;
+    apc_bd_t *bd;
+    zend_llist ll;
+    zend_function *efp, *sfp;
+    size_t size=0;
+    apc_context_t ctxt;
+    void *pool_ptr;
+
+    zend_llist_init(&ll, sizeof(void*), NULL, 0);
+    zend_hash_init(&APCG(apc_bd_alloc_list), 0, NULL, NULL, 0);
+
+    /* flip the hash for faster filter checking */
+    files = apc_flip_hash(files);
+    user_vars = apc_flip_hash(user_vars);
+
+    /* get size and entry counts */
+    for(i=0; i < apc_user_cache->num_slots; i++) {
+        sp = apc_user_cache->slots[i];
+        for(; sp != NULL; sp = sp->next) {
+            if(apc_bin_checkfilter(user_vars, sp->key.data.user.identifier, sp->key.data.user.identifier_len)) {
+                size += sizeof(apc_bd_entry_t*) + sizeof(apc_bd_entry_t);
+                size += sp->value->mem_size - (sizeof(apc_cache_entry_t) - sizeof(apc_cache_entry_value_t));
+                count++;
+            }
+        }
+    }
+    for(i=0; i < apc_cache->num_slots; i++) {
+        sp = apc_cache->slots[i];
+        for(; sp != NULL; sp = sp->next) {
+            if(sp->key.type == APC_CACHE_KEY_FPFILE) {
+                if(apc_bin_checkfilter(files, sp->key.data.fpfile.fullpath, sp->key.data.fpfile.fullpath_len+1)) {
+                    size += sizeof(apc_bd_entry_t*) + sizeof(apc_bd_entry_t);
+                    size += sp->value->mem_size - (sizeof(apc_cache_entry_t) - sizeof(apc_cache_entry_value_t));
+                    count++;
+                }
+            } else {
+                /* TODO: Currently we don't support APC_CACHE_KEY_FILE type.  We need to store the path and re-stat on load */
+                apc_warning("Excluding some files from apc_bin_dump[file].  Cached files must be included using full path with apc.stat=0." TSRMLS_CC);
+            }
+        }
+    }
+
+    size += sizeof(apc_bd_t) +1;  /* +1 for null termination */
+    bd = emalloc(size);
+    bd->size = (unsigned int)size;
+    pool_ptr = emalloc(sizeof(apc_pool));
+    apc_bd_alloc_ex(pool_ptr, sizeof(apc_pool) TSRMLS_CC);
+    ctxt.pool = apc_pool_create(APC_UNPOOL, apc_bd_alloc, apc_bd_free, NULL, NULL TSRMLS_CC);  /* ideally the pool wouldn't be alloc'd as part of this */
+    if (!ctxt.pool) { /* TODO need to cleanup */
+        apc_warning("Unable to allocate memory for pool." TSRMLS_CC);
+        return NULL;
+    }
+    ctxt.copy = APC_COPY_IN_OPCODE; /* avoid stupid ALLOC_ZVAL calls here, hack */
+    apc_bd_alloc_ex((void*)((long)bd + sizeof(apc_bd_t)), bd->size - sizeof(apc_bd_t) -1 TSRMLS_CC);
+    bd->num_entries = count;
+    bd->entries = apc_bd_alloc_ex(NULL, sizeof(apc_bd_entry_t) * count TSRMLS_CC);
+
+    /* User entries */
+    zend_hash_init(&APCG(copied_zvals), 0, NULL, NULL, 0);
+    count = 0;
+    for(i=0; i < apc_user_cache->num_slots; i++) {
+        sp = apc_user_cache->slots[i];
+        for(; sp != NULL; sp = sp->next) {
+            if(apc_bin_checkfilter(user_vars, sp->key.data.user.identifier, sp->key.data.user.identifier_len)) {
+                ep = &bd->entries[count];
+                ep->type = sp->value->type;
+                ep->val.user.info = apc_bd_alloc(sp->value->data.user.info_len TSRMLS_CC);
+                memcpy(ep->val.user.info, sp->value->data.user.info, sp->value->data.user.info_len);
+                ep->val.user.info_len = sp->value->data.user.info_len;
+                if ((Z_TYPE_P(sp->value->data.user.val) == IS_ARRAY && APCG(serializer))
+                        || Z_TYPE_P(sp->value->data.user.val) == IS_OBJECT) {
+                    /* avoiding hash copy, hack */
+                    uint type = Z_TYPE_P(sp->value->data.user.val);
+                    Z_TYPE_P(sp->value->data.user.val) = IS_STRING;
+                    ep->val.user.val = apc_copy_zval(NULL, sp->value->data.user.val, &ctxt TSRMLS_CC);
+                    Z_TYPE_P(ep->val.user.val) = IS_OBJECT;
+                    sp->value->data.user.val->type = type;
+                } else if (Z_TYPE_P(sp->value->data.user.val) == IS_ARRAY && !APCG(serializer)) {
+                    /* this is a little complicated, we have to unserialize it first, then serialize it again */
+                    zval *garbage;
+                    ctxt.copy = APC_COPY_OUT_USER;
+                    garbage = apc_copy_zval(NULL, sp->value->data.user.val, &ctxt TSRMLS_CC);
+                    APCG(serializer) = apc_find_serializer("php" TSRMLS_CC);
+                    ctxt.copy = APC_COPY_IN_USER;
+                    ep->val.user.val = apc_copy_zval(NULL, garbage, &ctxt TSRMLS_CC);
+                    ep->val.user.val->type = IS_OBJECT;
+                    /* a memleak can not be avoided: zval_ptr_dtor(&garbage); */
+                    APCG(serializer) = NULL;
+                    ctxt.copy = APC_COPY_IN_OPCODE;
+                } else {
+                    ep->val.user.val = apc_copy_zval(NULL, sp->value->data.user.val, &ctxt TSRMLS_CC);
+                }
+                ep->val.user.ttl = sp->value->data.user.ttl;
+
+                /* swizzle pointers */
+                apc_swizzle_ptr(bd, &ll, &bd->entries[count].val.user.info);
+                zend_hash_clean(&APCG(copied_zvals));
+                if (ep->val.user.val->type == IS_OBJECT) {
+                    apc_swizzle_ptr(bd, &ll, &bd->entries[count].val.user.val->value.str.val);
+                } else {
+                    apc_swizzle_zval(bd, &ll, bd->entries[count].val.user.val TSRMLS_CC);
+                }
+                apc_swizzle_ptr(bd, &ll, &bd->entries[count].val.user.val);
+
+                count++;
+            }
+        }
+    }
+    zend_hash_destroy(&APCG(copied_zvals));
+    APCG(copied_zvals).nTableSize=0;
+
+    /* File entries */
+    for(i=0; i < apc_cache->num_slots; i++) {
+        for(sp=apc_cache->slots[i]; sp != NULL; sp = sp->next) {
+            if(sp->key.type == APC_CACHE_KEY_FPFILE) {
+                if(apc_bin_checkfilter(files, sp->key.data.fpfile.fullpath, sp->key.data.fpfile.fullpath_len+1)) {
+                    ep = &bd->entries[count];
+                    ep->type = sp->key.type;
+                    ep->val.file.filename = apc_bd_alloc(strlen(sp->value->data.file.filename) + 1 TSRMLS_CC);
+                    strcpy(ep->val.file.filename, sp->value->data.file.filename);
+                    ep->val.file.op_array = apc_copy_op_array(NULL, sp->value->data.file.op_array, &ctxt TSRMLS_CC);
+
+                    for(ep->num_functions=0; sp->value->data.file.functions[ep->num_functions].function != NULL;) { ep->num_functions++; }
+                    ep->val.file.functions = apc_bd_alloc(sizeof(apc_function_t) * ep->num_functions TSRMLS_CC);
+                    for(fcount=0; fcount < ep->num_functions; fcount++) {
+                        memcpy(&ep->val.file.functions[fcount], &sp->value->data.file.functions[fcount], sizeof(apc_function_t));
+                        ep->val.file.functions[fcount].name = apc_xmemcpy(sp->value->data.file.functions[fcount].name, sp->value->data.file.functions[fcount].name_len+1, apc_bd_alloc TSRMLS_CC);
+                        ep->val.file.functions[fcount].name_len = sp->value->data.file.functions[fcount].name_len;
+                        ep->val.file.functions[fcount].function = apc_bd_alloc(sizeof(zend_function) TSRMLS_CC);
+                        efp = ep->val.file.functions[fcount].function;
+                        sfp = sp->value->data.file.functions[fcount].function;
+                        switch(sfp->type) {
+                            case ZEND_INTERNAL_FUNCTION:
+                            case ZEND_OVERLOADED_FUNCTION:
+                                efp->op_array = sfp->op_array;
+                                break;
+                            case ZEND_USER_FUNCTION:
+                            case ZEND_EVAL_CODE:
+                                apc_copy_op_array(&efp->op_array, &sfp->op_array, &ctxt TSRMLS_CC);
+                                break;
+                            default:
+                                assert(0);
+                        }
+#ifdef ZEND_ENGINE_2
+                        efp->common.prototype = NULL;
+                        efp->common.fn_flags = sfp->common.fn_flags & (~ZEND_ACC_IMPLEMENTED_ABSTRACT);
+#endif
+                        apc_swizzle_ptr(bd, &ll, &ep->val.file.functions[fcount].name);
+                        apc_swizzle_ptr(bd, &ll, (void**)&ep->val.file.functions[fcount].function);
+                        apc_swizzle_op_array(bd, &ll, &efp->op_array TSRMLS_CC);
+                    }
+
+
+                    for(ep->num_classes=0; sp->value->data.file.classes[ep->num_classes].class_entry != NULL;) { ep->num_classes++; }
+                    ep->val.file.classes = apc_bd_alloc(sizeof(apc_class_t) * ep->num_classes TSRMLS_CC);
+                    for(fcount=0; fcount < ep->num_classes; fcount++) {
+                        ep->val.file.classes[fcount].name = apc_xmemcpy(sp->value->data.file.classes[fcount].name, sp->value->data.file.classes[fcount].name_len + 1, apc_bd_alloc TSRMLS_CC);
+                        ep->val.file.classes[fcount].name_len = sp->value->data.file.classes[fcount].name_len;
+                        ep->val.file.classes[fcount].class_entry = apc_copy_class_entry(NULL, sp->value->data.file.classes[fcount].class_entry, &ctxt TSRMLS_CC);
+                        ep->val.file.classes[fcount].parent_name = apc_xstrdup(sp->value->data.file.classes[fcount].parent_name, apc_bd_alloc TSRMLS_CC);
+
+                        apc_swizzle_ptr(bd, &ll, &ep->val.file.classes[fcount].name);
+                        apc_swizzle_ptr(bd, &ll, &ep->val.file.classes[fcount].parent_name);
+                        apc_swizzle_class_entry(bd, &ll, ep->val.file.classes[fcount].class_entry TSRMLS_CC);
+                        apc_swizzle_ptr(bd, &ll, &ep->val.file.classes[fcount].class_entry);
+                    }
+
+                    apc_swizzle_ptr(bd, &ll, &bd->entries[count].val.file.filename);
+                    apc_swizzle_op_array(bd, &ll, bd->entries[count].val.file.op_array TSRMLS_CC);
+                    apc_swizzle_ptr(bd, &ll, &bd->entries[count].val.file.op_array);
+                    apc_swizzle_ptr(bd, &ll, (void**)&ep->val.file.functions);
+                    apc_swizzle_ptr(bd, &ll, (void**)&ep->val.file.classes);
+
+                    count++;
+                } else {
+                    /* TODO: Currently we don't support APC_CACHE_KEY_FILE type.  We need to store the path and re-stat on load */
+                }
+            }
+        }
+    }
+
+    /* append swizzle pointer list to bd */
+    bd = apc_swizzle_bd(bd, &ll TSRMLS_CC);
+    zend_llist_destroy(&ll);
+    zend_hash_destroy(&APCG(apc_bd_alloc_list));
+
+    if(files) {
+        zend_hash_destroy(files);
+        efree(files);
+    }
+    if(user_vars) {
+        zend_hash_destroy(user_vars);
+        efree(user_vars);
+    }
+
+    efree(pool_ptr);
+
+    return bd;
+} /* }}} */
+
+/* {{{ apc_bin_load */
+int apc_bin_load(apc_bd_t *bd, int flags TSRMLS_DC) {
+    apc_bd_entry_t *ep;
+    uint i, i2;
+    int ret;
+    time_t t;
+    zend_op_array *alloc_op_array = NULL;
+    apc_function_t *alloc_functions = NULL;
+    apc_class_t *alloc_classes = NULL;
+    apc_cache_entry_t *cache_entry;
+    apc_cache_key_t cache_key;
+    apc_context_t ctxt;
+
+    if (bd->swizzled) {
+        if(apc_unswizzle_bd(bd, flags TSRMLS_CC) < 0) {
+            return -1;
+        }
+    }
+
+    t = apc_time();
+
+    for(i = 0; i < bd->num_entries; i++) {
+        ctxt.pool = apc_pool_create(APC_SMALL_POOL, apc_sma_malloc, apc_sma_free, apc_sma_protect, apc_sma_unprotect TSRMLS_CC);
+        if (!ctxt.pool) { /* TODO need to cleanup previous pools */
+            apc_warning("Unable to allocate memory for pool." TSRMLS_CC);
+            goto failure;
+        }
+        ep = &bd->entries[i];
+        switch (ep->type) {
+            case APC_CACHE_KEY_FILE:
+                /* TODO: Currently we don't support APC_CACHE_KEY_FILE type.  We need to store the path and re-stat on load (or something else perhaps?) */
+                break;
+            case APC_CACHE_KEY_FPFILE:
+                ctxt.copy = APC_COPY_IN_OPCODE;
+
+                HANDLE_BLOCK_INTERRUPTIONS();
+#if NONBLOCKING_LOCK_AVAILABLE
+                if(APCG(write_lock)) {
+                    if(!apc_cache_write_lock(apc_cache TSRMLS_CC)) {
+                        HANDLE_UNBLOCK_INTERRUPTIONS();
+                        return -1;
+                    }
+                }
+#endif
+                if(! (alloc_op_array = apc_copy_op_array(NULL, ep->val.file.op_array, &ctxt TSRMLS_CC))) {
+                    goto failure;
+                }
+                apc_bin_fixup_op_array(alloc_op_array);
+
+                if(! (alloc_functions = apc_sma_malloc(sizeof(apc_function_t) * (ep->num_functions + 1) TSRMLS_CC))) {
+                    goto failure;
+                }
+                for(i2=0; i2 < ep->num_functions; i2++) {
+                    if(! (alloc_functions[i2].name = apc_xmemcpy(ep->val.file.functions[i2].name, ep->val.file.functions[i2].name_len + 1, apc_sma_malloc TSRMLS_CC))) {
+                        goto failure;
+                    }
+                    alloc_functions[i2].name_len = ep->val.file.functions[i2].name_len;
+                    if(! (alloc_functions[i2].function = apc_sma_malloc(sizeof(zend_function) TSRMLS_CC))) {
+                        goto failure;
+                    }
+                    switch(ep->val.file.functions[i2].function->type) {
+                        case ZEND_INTERNAL_FUNCTION:
+                        case ZEND_OVERLOADED_FUNCTION:
+                            alloc_functions[i2].function->op_array = ep->val.file.functions[i2].function->op_array;
+                            break;
+                        case ZEND_USER_FUNCTION:
+                        case ZEND_EVAL_CODE:
+                            if (!apc_copy_op_array(&alloc_functions[i2].function->op_array, &ep->val.file.functions[i2].function->op_array, &ctxt TSRMLS_CC)) {
+                                goto failure;
+                            }
+                            apc_bin_fixup_op_array(&alloc_functions[i2].function->op_array);
+                            break;
+                        default:
+                            assert(0);
+                    }
+#ifdef ZEND_ENGINE_2
+                    alloc_functions[i2].function->common.prototype=NULL;
+                    alloc_functions[i2].function->common.fn_flags=ep->val.file.functions[i2].function->common.fn_flags & (~ZEND_ACC_IMPLEMENTED_ABSTRACT);
+#endif
+                }
+                alloc_functions[i2].name = NULL;
+                alloc_functions[i2].function = NULL;
+
+                if(! (alloc_classes = apc_sma_malloc(sizeof(apc_class_t) * (ep->num_classes + 1) TSRMLS_CC))) {
+                    goto failure;
+                }
+                for(i2=0; i2 < ep->num_classes; i2++) {
+                    if(! (alloc_classes[i2].name = apc_xmemcpy(ep->val.file.classes[i2].name, ep->val.file.classes[i2].name_len+1, apc_sma_malloc TSRMLS_CC))) {
+                        goto failure;
+                    }
+                    alloc_classes[i2].name_len = ep->val.file.classes[i2].name_len;
+                    if(! (alloc_classes[i2].class_entry = apc_copy_class_entry(NULL, ep->val.file.classes[i2].class_entry, &ctxt TSRMLS_CC))) {
+                        goto failure;
+                    }
+                    apc_bin_fixup_class_entry(alloc_classes[i2].class_entry);
+                    if(! (alloc_classes[i2].parent_name = apc_xstrdup(ep->val.file.classes[i2].parent_name, apc_sma_malloc TSRMLS_CC))) {
+                        if(ep->val.file.classes[i2].parent_name != NULL) {
+                            goto failure;
+                        }
+                    }
+                }
+                alloc_classes[i2].name = NULL;
+                alloc_classes[i2].class_entry = NULL;
+
+                if(!(cache_entry = apc_cache_make_file_entry(ep->val.file.filename, alloc_op_array, alloc_functions, alloc_classes, &ctxt TSRMLS_CC))) {
+                    goto failure;
+                }
+
+                if (!apc_cache_make_file_key(&cache_key, ep->val.file.filename, PG(include_path), t TSRMLS_CC)) {
+                    goto failure;
+                }
+
+                if ((ret = apc_cache_insert(apc_cache, cache_key, cache_entry, &ctxt, t TSRMLS_CC)) != 1) {
+                    if(ret==-1) {
+                        goto failure;
+                    }
+                }
+
+#if NONBLOCKING_LOCK_AVAILABLE
+                if(APCG(write_lock)) {
+                    apc_cache_write_unlock(apc_cache TSRMLS_CC);
+                }
+#endif
+                HANDLE_UNBLOCK_INTERRUPTIONS();
+
+                break;
+            case APC_CACHE_KEY_USER:
+                {
+                    zval *data;
+                    uint use_copy = 0;
+                    switch (Z_TYPE_P(ep->val.user.val)) {
+                        case IS_OBJECT:
+                            ctxt.copy = APC_COPY_OUT_USER;
+                            data = apc_copy_zval(NULL, ep->val.user.val, &ctxt TSRMLS_CC);
+                            use_copy = 1;
+                        break;
+                        default:
+                            data = ep->val.user.val;
+                        break;
+                    }
+                    ctxt.copy = APC_COPY_IN_USER;
+                    _apc_store(ep->val.user.info, ep->val.user.info_len, data, ep->val.user.ttl, 0 TSRMLS_CC);
+                    if (use_copy) {
+                        zval_ptr_dtor(&data);
+                    }
+                }
+                break;
+            default:
+                break;
+       }
+    }
+
+    return 0;
+
+failure:
+    apc_pool_destroy(ctxt.pool TSRMLS_CC);
+    apc_warning("Unable to allocate memory for apc binary load/dump functionality." TSRMLS_CC);
+#if NONBLOCKING_LOCK_AVAILABLE
+    if(APCG(write_lock)) {
+        apc_cache_write_unlock(apc_cache TSRMLS_CC);
+    }
+#endif
+    HANDLE_UNBLOCK_INTERRUPTIONS();
+    return -1;
+} /* }}} */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_bin.h php-5.4.19.bak/ext/apc/apc_bin.h
--- php-5.4.19/ext/apc/apc_bin.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_bin.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,63 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Brian Shire <shire@php.net>                                 |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: apc_bin.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_BINDUMP_H
+#define APC_BINDUMP_H
+
+#include "apc.h"
+#include "apc_php.h"
+#include "ext/standard/basic_functions.h"
+
+/* APC binload flags */
+#define APC_BIN_VERIFY_MD5    1 << 0
+#define APC_BIN_VERIFY_CRC32  1 << 1
+
+typedef struct _apc_bd_entry_t {
+    unsigned char type;
+    uint num_functions;
+    uint num_classes;
+    apc_cache_entry_value_t val;
+} apc_bd_entry_t;
+
+typedef struct _apc_bd_t {
+    unsigned int size;
+    int swizzled;
+    unsigned char md5[16];
+    php_uint32 crc;
+    unsigned int num_entries;
+    apc_bd_entry_t *entries;
+    int num_swizzled_ptrs;
+    void ***swizzled_ptrs;
+} apc_bd_t;
+
+apc_bd_t* apc_bin_dump(HashTable *files, HashTable *user_vars TSRMLS_DC);
+int apc_bin_load(apc_bd_t *bd, int flags TSRMLS_DC);
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc.c php-5.4.19.bak/ext/apc/apc.c
--- php-5.4.19/ext/apc/apc.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,724 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          George Schlossnagle <george@omniti.com>                     |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc.c 327370 2012-08-29 21:45:33Z ab $ */
+
+#include "apc.h"
+#include "apc_zend.h"
+#include "apc_cache.h"
+#include "apc_globals.h"
+#include "php.h"
+
+#if HAVE_PCRE || HAVE_BUNDLED_PCRE
+/*  Deal with problem present until php-5.2.2 where php_pcre.h was not installed correctly */
+#   if !HAVE_BUNDLED_PCRE && PHP_MAJOR_VERSION == 5 && (PHP_MINOR_VERSION < 2 || (PHP_MINOR_VERSION == 2 && PHP_RELEASE_VERSION < 2))
+#       include "apc_php_pcre.h"
+#   else
+#       include "ext/pcre/php_pcre.h"
+#   endif
+#   include "ext/standard/php_smart_str.h"
+#endif
+
+#define NELEMS(a) (sizeof(a)/sizeof((a)[0]))
+
+/* {{{ memory allocation wrappers */
+
+void* apc_emalloc(size_t n TSRMLS_DC)
+{
+    void* p = malloc(n);
+    if (p == NULL) {
+        apc_error("apc_emalloc: malloc failed to allocate %u bytes:" TSRMLS_CC, n);
+        return NULL;
+    }
+    return p;
+}
+
+void* apc_erealloc(void* p, size_t n TSRMLS_DC)
+{
+    void *new;
+    new = realloc(p, n);
+    if (new == NULL) {
+        apc_error("apc_erealloc: realloc failed to allocate %u bytes:" TSRMLS_CC, n);
+        return NULL;
+    }
+    return new;
+}
+
+void apc_efree(void* p TSRMLS_DC)
+{
+    if (p == NULL) {
+        apc_error("apc_efree: attempt to free null pointer" TSRMLS_CC);
+        return;
+    }
+    free(p);
+}
+
+char* APC_ALLOC apc_estrdup(const char* s TSRMLS_DC)
+{
+    int len;
+    char* dup;
+
+    if (s == NULL) {
+        return NULL;
+    }
+    len = strlen(s);
+    dup = (char*) malloc(len+1);
+    if (dup == NULL) {
+        apc_error("apc_estrdup: malloc failed to allocate %u bytes:" TSRMLS_CC, len+1);
+        return NULL;
+    }
+    memcpy(dup, s, len);
+    dup[len] = '\0';
+    return dup;
+}
+
+void* APC_ALLOC apc_xstrdup(const char* s, apc_malloc_t f TSRMLS_DC)
+{
+    return s != NULL ? apc_xmemcpy(s, strlen(s)+1, f TSRMLS_CC) : NULL;
+}
+
+void* APC_ALLOC apc_xmemcpy(const void* p, size_t n, apc_malloc_t f TSRMLS_DC)
+{
+    void* q;
+
+    if (p != NULL && (q = f(n TSRMLS_CC)) != NULL) {
+        memcpy(q, p, n);
+        return q;
+    }
+    return NULL;
+}
+
+/* }}} */
+
+/* {{{ console display functions */
+#ifdef ZTS
+# define APC_PRINT_FUNCTION_PARAMETER TSRMLS_C
+#else
+# define APC_PRINT_FUNCTION_PARAMETER format
+#endif
+
+#define APC_PRINT_FUNCTION(name, verbosity)					\
+	void apc_##name(const char *format TSRMLS_DC, ...)			\
+	{									\
+		va_list args;							\
+										\
+		va_start(args, APC_PRINT_FUNCTION_PARAMETER);			\
+		php_verror(NULL, "", verbosity, format, args TSRMLS_CC);	\
+		va_end(args);							\
+	}
+
+APC_PRINT_FUNCTION(error, E_ERROR)
+APC_PRINT_FUNCTION(warning, E_WARNING)
+APC_PRINT_FUNCTION(notice, E_NOTICE)
+
+#ifdef __DEBUG_APC__
+APC_PRINT_FUNCTION(debug, E_NOTICE)
+#else
+void apc_debug(const char *format TSRMLS_DC, ...) {}
+#endif
+/* }}} */
+
+/* {{{ string and text manipulation */
+
+char* apc_append(const char* s, const char* t TSRMLS_DC)
+{
+    int slen;
+    int tlen;
+    char* p;
+
+    slen = strlen(s);
+    tlen = strlen(t);
+
+    p = (char*) apc_emalloc((slen + tlen + 1) * sizeof(char) TSRMLS_CC);
+    memcpy(p, s, slen);
+    memcpy(p + slen, t, tlen + 1);
+
+    return p;
+}
+
+char* apc_substr(const char* s, int start, int length TSRMLS_DC)
+{
+    char* substr;
+    int src_len = strlen(s);
+
+    /* bring start into range */
+    if (start < 0) {
+        start = 0;
+    }
+    else if (start >= src_len) {
+        start = src_len - 1;
+    }
+
+    /* bring length into range */
+    if (length < 0 || src_len - start < length) {
+        length = src_len - start;
+    }
+
+    /* create the substring */
+    substr = apc_xmemcpy(s + start, length + 1, apc_emalloc TSRMLS_CC);
+    substr[length] = '\0';
+    return substr;
+}
+
+char** apc_tokenize(const char* s, char delim TSRMLS_DC)
+{
+    char** tokens;      /* array of tokens, NULL terminated */
+    int size;           /* size of tokens array */
+    int n;              /* index of next token in tokens array */
+    int cur;            /* current position in input string */
+    int end;            /* final legal position in input string */
+    int next;           /* position of next delimiter in input */
+
+    if (!s) {
+        return NULL;
+    }
+
+    size = 2;
+    n    = 0;
+    cur  = 0;
+    end  = strlen(s) - 1;
+
+    tokens = (char**) apc_emalloc(size * sizeof(char*) TSRMLS_CC);
+    tokens[n] = NULL;
+
+    while (cur <= end) {
+        /* search for the next delimiter */
+        char* p = strchr(s + cur, delim);
+        next = p ? p-s : end+1;
+
+        /* resize token array if necessary */
+        if (n == size-1) {
+            size *= 2;
+            tokens = (char**) apc_erealloc(tokens, size * sizeof(char*) TSRMLS_CC);
+        }
+
+        /* save the current token */
+        tokens[n] = apc_substr(s, cur, next-cur TSRMLS_CC);
+
+        tokens[++n] = NULL;
+        cur = next + 1;
+    }
+
+    return tokens;
+}
+
+/* }}} */
+
+/* {{{ apc_win32_restat */
+#ifdef PHP_WIN32
+static int apc_restat(apc_fileinfo_t *fileinfo TSRMLS_DC)
+{
+    HANDLE hFile;
+    BY_HANDLE_FILE_INFORMATION hInfo;
+
+    hFile = CreateFile(fileinfo->fullpath, GENERIC_WRITE, FILE_SHARE_WRITE|FILE_SHARE_READ, NULL, OPEN_ALWAYS, FILE_FLAG_BACKUP_SEMANTICS, NULL);
+
+    if (!hFile) {
+        apc_debug("Cannot create a file HANDLE for %s\n" TSRMLS_CC, fileinfo->fullpath);
+        return -1;
+    }
+
+    if (!GetFileInformationByHandle(hFile, &hInfo)) {
+        apc_debug("Cannot get file information from handle\n" TSRMLS_CC);
+        CloseHandle(hFile);
+        return -1;
+    }
+
+    CloseHandle(hFile);
+
+    fileinfo->st_buf.sb.st_dev = hInfo.dwVolumeSerialNumber;
+    fileinfo->st_buf.sb.st_ino = (((apc_ino_t)(hInfo.nFileIndexHigh) << 32) | (apc_ino_t) hInfo.nFileIndexLow);
+
+    return 0;
+}
+#else
+static int apc_restat(apc_fileinfo_t *fileinfo TSRMLS_DC)
+{
+	return 0;
+}
+#endif
+/* }}} */
+
+/* {{{ apc_search_paths */
+/* similar to php_stream_stat_path */
+#define APC_URL_STAT(wrapper, filename, pstatbuf) \
+    ((wrapper)->wops->url_stat((wrapper), (filename), PHP_STREAM_URL_STAT_QUIET, (pstatbuf), NULL TSRMLS_CC))
+
+/* copy out to path_buf if path_for_open isn't the same as filename */
+#define COPY_IF_CHANGED(p) \
+    (char*) (((p) == filename) ? filename : \
+            (strlcpy((char*)fileinfo->path_buf, (p), sizeof(fileinfo->path_buf))) \
+                    ? (fileinfo->path_buf) : NULL)
+
+/* len checks can be skipped here because filename is NUL terminated */
+#define IS_RELATIVE_PATH(filename, len) \
+        ((filename) && (filename[0] == '.' && \
+            (IS_SLASH(filename[1]) || \
+                (filename[1] == '.' && \
+                    IS_SLASH(filename[2])))))
+    
+/* {{{ stupid stringifcation */
+#if DEFAULT_SLASH == '/'
+    #define DEFAULT_SLASH_STRING "/"
+#elif DEFAULT_SLASH == '\\'
+    #define DEFAULT_SLASH_STRING "\\"
+#else
+    #error "Unknown value for DEFAULT_SLASH"
+#endif
+/* }}} */
+
+#define IS_COMMON_WRAPPER(fname, len) \
+     (((len) >= 5 && strncmp((fname), "file:", 5) == 0) || \
+      ((len) >= 5 && strncmp((fname), "http:", 5) == 0) || \
+      ((len) >= 4 && strncmp((fname), "ftp:", 4) == 0)  || \
+      ((len) >= 4 && strncmp((fname), "php:", 4) == 0)  || \
+      ((len) >= 5 && strncmp((fname), "zlib:", 5) == 0) || \
+      ((len) >= 5 && strncmp((fname), "data:", 5) == 0) || \
+      ((len) >= 5 && strncmp((fname), "glob:", 5) == 0) || \
+      ((len) >= 5 && strncmp((fname), "phar:", 5) == 0) || \
+      ((len) >= 5 && strncmp((fname), "ssh2:", 5) == 0) || \
+      ((len) >= 4 && strncmp((fname), "rar:", 4) == 0)  || \
+      ((len) >= 4 && strncmp((fname), "ogg:", 4) == 0)  || \
+      ((len) >= 7 && strncmp((fname), "expect:", 7) == 0))
+
+int apc_search_paths(const char* filename, const char* path, apc_fileinfo_t* fileinfo TSRMLS_DC)
+{
+    char** paths = NULL;
+    char *exec_fname;
+    int exec_fname_length;
+    int found = 0;
+    int i;
+    php_stream_wrapper *wrapper = NULL;
+    char *path_for_open = NULL;
+    int is_user_wrapper = 0;
+    int filename_len = strlen(filename);
+
+    assert(filename && fileinfo);
+
+    /* Prevent tries to stat userspace stream wrappers when reading opcodes
+        right after the file was compiled. The core stream wrappers should be
+        already loaded, so looking for them should be ok (not sure about phar) */
+    if (!IS_ABSOLUTE_PATH(filename, filename_len) && 
+        !IS_RELATIVE_PATH(filename, filename_len) &&
+        !IS_COMMON_WRAPPER(filename, filename_len)) {
+        char *p = (char *)filename;
+        int n = 0;
+
+        /* If we're here, it's most likely a userspace stream wrapper. Extract
+            it's protocol and check if it's already been registered. */
+
+        for (; isalnum((int)*p) || *p == '+' || *p == '-' || *p == '.'; p++) {
+            n++;
+        }
+
+        if ((*p == ':') && (n > 1) && (!strncmp("//", p+1, 2) || (n == 4 && !memcmp("data:", path, 5)))) {
+            char *tmp = estrndup(filename, n); 
+
+            if (!zend_hash_exists(php_stream_get_url_stream_wrappers_hash(), tmp, n + 1)) {
+                return -1;
+            }
+            efree(tmp);
+        }
+    }
+
+    wrapper = php_stream_locate_url_wrapper(filename, &path_for_open, 0 TSRMLS_CC);
+
+    if(!wrapper || !wrapper->wops) {
+        return -1;
+    }
+
+    is_user_wrapper = (NULL != wrapper->wops->label) && (strncmp(wrapper->wops->label, "user-space", 11) == 0);
+
+    if (!is_user_wrapper && !wrapper->wops->url_stat) {
+        return -1;
+    }
+
+    if(wrapper != &php_plain_files_wrapper) {
+        if(!is_user_wrapper && APC_URL_STAT(wrapper, path_for_open, &fileinfo->st_buf) == 0) {
+            fileinfo->fullpath = COPY_IF_CHANGED(path_for_open);
+            return apc_restat(fileinfo TSRMLS_CC);
+        }
+        return -1; /* cannot stat */
+    }
+
+    if (IS_ABSOLUTE_PATH(path_for_open, strlen(path_for_open)) && 
+            APC_URL_STAT(wrapper, path_for_open, &fileinfo->st_buf) == 0) {
+        fileinfo->fullpath = COPY_IF_CHANGED(path_for_open);
+        return apc_restat(fileinfo TSRMLS_CC);
+    }
+
+    if (!IS_RELATIVE_PATH(path_for_open, strlen(path_for_open))) {
+        paths = apc_tokenize(path, DEFAULT_DIR_SEPARATOR TSRMLS_CC);
+        if (!paths)
+            return -1;
+
+        /* for each directory in paths, look for filename inside */
+        for (i = 0; paths[i]; i++) {
+            snprintf(fileinfo->path_buf, sizeof(fileinfo->path_buf), "%s%c%s", paths[i], DEFAULT_SLASH, path_for_open);
+            if (APC_URL_STAT(wrapper, fileinfo->path_buf, &fileinfo->st_buf) == 0) {
+                fileinfo->fullpath = (char*) fileinfo->path_buf;
+                found = 1;
+                break;
+            }
+        }
+        /* in cli mode PHP explicitly checks the cwd, so we should as well */
+        if(APCG(enable_cli) && !strcmp(sapi_module.name, "cli")) {
+            snprintf(fileinfo->path_buf, sizeof(fileinfo->path_buf), ".%c%s", DEFAULT_SLASH, path_for_open);
+            if (APC_URL_STAT(wrapper, fileinfo->path_buf, &fileinfo->st_buf) == 0) {
+                fileinfo->fullpath = (char*) fileinfo->path_buf;
+                found = 1;
+            }
+        }
+    } else {
+        /* read cwd and try to fake up fullpath */
+        fileinfo->path_buf[0] = '\0';
+        if(VCWD_GETCWD(fileinfo->path_buf, sizeof(fileinfo->path_buf))) { 
+            strlcat(fileinfo->path_buf, DEFAULT_SLASH_STRING, sizeof(fileinfo->path_buf));
+            strlcat(fileinfo->path_buf, path_for_open, sizeof(fileinfo->path_buf));
+            if (APC_URL_STAT(wrapper, fileinfo->path_buf, &fileinfo->st_buf) == 0) {
+                fileinfo->fullpath = (char*) fileinfo->path_buf;
+                return apc_restat(fileinfo TSRMLS_CC);
+            }
+        }
+    }
+
+    /* check in path of the calling scripts' current working directory */
+    /* modified from main/streams/plain_wrapper.c */
+    if(!found && zend_is_executing(TSRMLS_C)) {
+        exec_fname = zend_get_executed_filename(TSRMLS_C);
+        exec_fname_length = strlen(exec_fname);
+        while((--exec_fname_length >= 0) && !IS_SLASH(exec_fname[exec_fname_length]));
+        if((exec_fname && exec_fname[0] != '[') && exec_fname_length > 0) {
+            /* not: [no active file] or no path */
+            memcpy(fileinfo->path_buf, exec_fname, exec_fname_length);
+            fileinfo->path_buf[exec_fname_length] = DEFAULT_SLASH;
+            strlcpy(fileinfo->path_buf +exec_fname_length +1, path_for_open,sizeof(fileinfo->path_buf)-exec_fname_length-1);
+            /* apc_warning("filename: %s, exec_fname: %s, fileinfo->path_buf: %s" TSRMLS_CC, path_for_open, exec_fname, fileinfo->path_buf); */
+            if (APC_URL_STAT(wrapper, fileinfo->path_buf, &fileinfo->st_buf) == 0) {
+                fileinfo->fullpath = (char*) fileinfo->path_buf;
+                found = 1;
+            }
+        }
+    }
+
+    if(paths) {
+        /* free the value returned by apc_tokenize */
+        for (i = 0; paths[i]; i++) {
+            apc_efree(paths[i] TSRMLS_CC);
+        }
+        apc_efree(paths TSRMLS_CC);
+    }
+
+    return found ? apc_restat(fileinfo TSRMLS_CC) : -1;
+}
+
+/* }}} */
+
+/* {{{ regular expression wrapper functions */
+
+#if (HAVE_PCRE || HAVE_BUNDLED_PCRE)
+typedef struct {
+    pcre *preg;
+    pcre *nreg;
+} apc_regex;
+
+#define APC_ADD_PATTERN(match, pat) do {\
+    if(match.len > 1) {\
+        smart_str_appendc(&match, '|');\
+    }\
+    smart_str_appendc(&match, '(');\
+    while(*pat) {\
+        if(*pat == '/') smart_str_appendc(&match, '\\');\
+        \
+        smart_str_appendc(&match, *(pat++));\
+    }\
+    smart_str_appendc(&match, ')');\
+} while(0)
+
+#define APC_COMPILE_PATTERN(re, match) do {\
+    if(match.len > 2) { /* more than just "//" */\
+        if (((re) = pcre_get_compiled_regex(match.c, NULL, NULL TSRMLS_CC)) == NULL) {\
+            apc_warning("apc_regex_compile_array: invalid expression '%s'" TSRMLS_CC, match.c); \
+            smart_str_free(&match);\
+            return NULL;\
+        }\
+    } else { \
+        (re) = NULL;\
+    }\
+} while(0)
+
+void* apc_regex_compile_array(char* patterns[] TSRMLS_DC)
+{
+    apc_regex* regs;
+    int npat;
+    smart_str pmatch = {0,};
+    smart_str nmatch = {0,};
+    char* pattern;
+
+    if (!patterns)
+        return NULL;
+
+    regs = (apc_regex*) apc_emalloc(sizeof(apc_regex) TSRMLS_CC);
+
+    smart_str_appendc(&pmatch, '/');
+    smart_str_appendc(&nmatch, '/');
+
+    for (npat = 0; patterns[npat] != NULL; npat++) {
+        pattern = patterns[npat];
+        if(pattern[0] == '+') {
+            pattern += sizeof(char);
+            APC_ADD_PATTERN(pmatch, pattern);
+        } else {
+            if(pattern[0] == '-') pattern += sizeof(char);
+            APC_ADD_PATTERN(nmatch, pattern);
+        }
+    }
+    smart_str_appendc(&pmatch, '/');
+    smart_str_appendc(&nmatch, '/');
+
+    smart_str_0(&nmatch);
+    smart_str_0(&pmatch);
+
+    APC_COMPILE_PATTERN(regs->preg, pmatch);
+    APC_COMPILE_PATTERN(regs->nreg, nmatch);
+
+    smart_str_free(&pmatch);
+    smart_str_free(&nmatch);
+
+    return (void*) regs;
+}
+
+void apc_regex_destroy_array(void* p TSRMLS_DC)
+{
+    if (p != NULL) {
+        apc_regex* regs = (apc_regex*) p;
+/* XXX add more tests and activate when it works properly on all SAPIs*/
+#if 0
+        if (regs->preg) {
+            pefree(regs->preg, 1);
+        }
+        if (regs->nreg) {
+            pefree(regs->nreg, 1);
+        }
+#endif
+        apc_efree(regs TSRMLS_CC);
+    }
+}
+
+#define APC_MATCH_PATTERN(re, input, output) do {\
+    if (re && pcre_exec(re, NULL, (input), strlen(input), 0, 0, NULL, 0) >= 0) {\
+        return (output);\
+    }\
+} while(0)
+
+
+int apc_regex_match_array(void* p, const char* input)
+{
+    apc_regex* regs;
+
+    if (!p)
+        return 0;
+
+    regs = (apc_regex*) p;
+
+    APC_MATCH_PATTERN(regs->preg, input, APC_POSITIVE_MATCH);
+    APC_MATCH_PATTERN(regs->nreg, input, APC_NEGATIVE_MATCH);
+
+    return 0;
+}
+#else /* no pcre */
+void* apc_regex_compile_array(char* patterns[] TSRMLS_DC)
+{
+    if(patterns && patterns[0] != NULL) {
+        apc_warning("pcre missing, disabling filters" TSRMLS_CC);
+    }
+    return NULL;
+}
+void apc_regex_destroy_array(void* p)
+{
+    /* nothing */
+}
+int apc_regex_match_array(void* p, const char* input)
+{
+    return 0;
+}
+#endif
+/* }}} */
+
+/* {{{ crc32 implementation */
+
+/* this table was generated by crc32gen() */
+static unsigned int crc32tab[] = {
+    /*   0 */  0x00000000, 0x3b83984b, 0x77073096, 0x4c84a8dd,
+    /*   4 */  0xee0e612c, 0xd58df967, 0x990951ba, 0xa28ac9f1,
+    /*   8 */  0x076dc419, 0x3cee5c52, 0x706af48f, 0x4be96cc4,
+    /*  12 */  0xe963a535, 0xd2e03d7e, 0x9e6495a3, 0xa5e70de8,
+    /*  16 */  0x0edb8832, 0x35581079, 0x79dcb8a4, 0x425f20ef,
+    /*  20 */  0xe0d5e91e, 0xdb567155, 0x97d2d988, 0xac5141c3,
+    /*  24 */  0x09b64c2b, 0x3235d460, 0x7eb17cbd, 0x4532e4f6,
+    /*  28 */  0xe7b82d07, 0xdc3bb54c, 0x90bf1d91, 0xab3c85da,
+    /*  32 */  0x1db71064, 0x2634882f, 0x6ab020f2, 0x5133b8b9,
+    /*  36 */  0xf3b97148, 0xc83ae903, 0x84be41de, 0xbf3dd995,
+    /*  40 */  0x1adad47d, 0x21594c36, 0x6ddde4eb, 0x565e7ca0,
+    /*  44 */  0xf4d4b551, 0xcf572d1a, 0x83d385c7, 0xb8501d8c,
+    /*  48 */  0x136c9856, 0x28ef001d, 0x646ba8c0, 0x5fe8308b,
+    /*  52 */  0xfd62f97a, 0xc6e16131, 0x8a65c9ec, 0xb1e651a7,
+    /*  56 */  0x14015c4f, 0x2f82c404, 0x63066cd9, 0x5885f492,
+    /*  60 */  0xfa0f3d63, 0xc18ca528, 0x8d080df5, 0xb68b95be,
+    /*  64 */  0x3b6e20c8, 0x00edb883, 0x4c69105e, 0x77ea8815,
+    /*  68 */  0xd56041e4, 0xeee3d9af, 0xa2677172, 0x99e4e939,
+    /*  72 */  0x3c03e4d1, 0x07807c9a, 0x4b04d447, 0x70874c0c,
+    /*  76 */  0xd20d85fd, 0xe98e1db6, 0xa50ab56b, 0x9e892d20,
+    /*  80 */  0x35b5a8fa, 0x0e3630b1, 0x42b2986c, 0x79310027,
+    /*  84 */  0xdbbbc9d6, 0xe038519d, 0xacbcf940, 0x973f610b,
+    /*  88 */  0x32d86ce3, 0x095bf4a8, 0x45df5c75, 0x7e5cc43e,
+    /*  92 */  0xdcd60dcf, 0xe7559584, 0xabd13d59, 0x9052a512,
+    /*  96 */  0x26d930ac, 0x1d5aa8e7, 0x51de003a, 0x6a5d9871,
+    /* 100 */  0xc8d75180, 0xf354c9cb, 0xbfd06116, 0x8453f95d,
+    /* 104 */  0x21b4f4b5, 0x1a376cfe, 0x56b3c423, 0x6d305c68,
+    /* 108 */  0xcfba9599, 0xf4390dd2, 0xb8bda50f, 0x833e3d44,
+    /* 112 */  0x2802b89e, 0x138120d5, 0x5f058808, 0x64861043,
+    /* 116 */  0xc60cd9b2, 0xfd8f41f9, 0xb10be924, 0x8a88716f,
+    /* 120 */  0x2f6f7c87, 0x14ece4cc, 0x58684c11, 0x63ebd45a,
+    /* 124 */  0xc1611dab, 0xfae285e0, 0xb6662d3d, 0x8de5b576,
+    /* 128 */  0x76dc4190, 0x4d5fd9db, 0x01db7106, 0x3a58e94d,
+    /* 132 */  0x98d220bc, 0xa351b8f7, 0xefd5102a, 0xd4568861,
+    /* 136 */  0x71b18589, 0x4a321dc2, 0x06b6b51f, 0x3d352d54,
+    /* 140 */  0x9fbfe4a5, 0xa43c7cee, 0xe8b8d433, 0xd33b4c78,
+    /* 144 */  0x7807c9a2, 0x438451e9, 0x0f00f934, 0x3483617f,
+    /* 148 */  0x9609a88e, 0xad8a30c5, 0xe10e9818, 0xda8d0053,
+    /* 152 */  0x7f6a0dbb, 0x44e995f0, 0x086d3d2d, 0x33eea566,
+    /* 156 */  0x91646c97, 0xaae7f4dc, 0xe6635c01, 0xdde0c44a,
+    /* 160 */  0x6b6b51f4, 0x50e8c9bf, 0x1c6c6162, 0x27eff929,
+    /* 164 */  0x856530d8, 0xbee6a893, 0xf262004e, 0xc9e19805,
+    /* 168 */  0x6c0695ed, 0x57850da6, 0x1b01a57b, 0x20823d30,
+    /* 172 */  0x8208f4c1, 0xb98b6c8a, 0xf50fc457, 0xce8c5c1c,
+    /* 176 */  0x65b0d9c6, 0x5e33418d, 0x12b7e950, 0x2934711b,
+    /* 180 */  0x8bbeb8ea, 0xb03d20a1, 0xfcb9887c, 0xc73a1037,
+    /* 184 */  0x62dd1ddf, 0x595e8594, 0x15da2d49, 0x2e59b502,
+    /* 188 */  0x8cd37cf3, 0xb750e4b8, 0xfbd44c65, 0xc057d42e,
+    /* 192 */  0x4db26158, 0x7631f913, 0x3ab551ce, 0x0136c985,
+    /* 196 */  0xa3bc0074, 0x983f983f, 0xd4bb30e2, 0xef38a8a9,
+    /* 200 */  0x4adfa541, 0x715c3d0a, 0x3dd895d7, 0x065b0d9c,
+    /* 204 */  0xa4d1c46d, 0x9f525c26, 0xd3d6f4fb, 0xe8556cb0,
+    /* 208 */  0x4369e96a, 0x78ea7121, 0x346ed9fc, 0x0fed41b7,
+    /* 212 */  0xad678846, 0x96e4100d, 0xda60b8d0, 0xe1e3209b,
+    /* 216 */  0x44042d73, 0x7f87b538, 0x33031de5, 0x088085ae,
+    /* 220 */  0xaa0a4c5f, 0x9189d414, 0xdd0d7cc9, 0xe68ee482,
+    /* 224 */  0x5005713c, 0x6b86e977, 0x270241aa, 0x1c81d9e1,
+    /* 228 */  0xbe0b1010, 0x8588885b, 0xc90c2086, 0xf28fb8cd,
+    /* 232 */  0x5768b525, 0x6ceb2d6e, 0x206f85b3, 0x1bec1df8,
+    /* 236 */  0xb966d409, 0x82e54c42, 0xce61e49f, 0xf5e27cd4,
+    /* 240 */  0x5edef90e, 0x655d6145, 0x29d9c998, 0x125a51d3,
+    /* 244 */  0xb0d09822, 0x8b530069, 0xc7d7a8b4, 0xfc5430ff,
+    /* 248 */  0x59b33d17, 0x6230a55c, 0x2eb40d81, 0x153795ca,
+    /* 252 */  0xb7bd5c3b, 0x8c3ec470, 0xc0ba6cad, 0xfb39f4e6,
+};
+
+unsigned int apc_crc32(const unsigned char* buf, unsigned int len)
+{
+    unsigned int i;
+    int k;
+    unsigned int crc;
+
+    /* preconditioning */
+    crc = 0xFFFFFFFF;
+
+    for (i = 0; i < len; i++) {
+        k = (crc ^ buf[i]) & 0x000000FF;
+        assert(k >= 0 && k <= 255);
+        crc = ((crc >> 8) & 0x00FFFFFF) ^ crc32tab[k];
+    }
+
+    /* postconditioning */
+    return ~crc;
+}
+
+/* crc32gen: generate the nth (0..255) crc32 table value */
+#if 0
+static unsigned long crc32gen(int n)
+{
+    int i;
+    unsigned long crc;
+
+    crc = n;
+    for (i = 8; i >= 0; i--) {
+        if (crc & 1) {
+            crc = (crc >> 1) ^ 0xEDB88320;
+        }
+        else {
+            crc >>= 1;
+        }
+    }
+    return crc;
+}
+#endif
+
+/* }}} */
+
+/* {{{ apc_flip_hash() */
+HashTable* apc_flip_hash(HashTable *hash) {
+    zval **entry, *data;
+    HashTable *new_hash;
+    HashPosition pos;
+
+    if(hash == NULL) return hash;
+
+    MAKE_STD_ZVAL(data);
+    ZVAL_LONG(data, 1);
+    
+    new_hash = emalloc(sizeof(HashTable));
+    zend_hash_init(new_hash, hash->nTableSize, NULL, ZVAL_PTR_DTOR, 0);
+
+    zend_hash_internal_pointer_reset_ex(hash, &pos);
+    while (zend_hash_get_current_data_ex(hash, (void **)&entry, &pos) == SUCCESS) {
+        if(Z_TYPE_PP(entry) == IS_STRING) {
+            zend_hash_update(new_hash, Z_STRVAL_PP(entry), Z_STRLEN_PP(entry) +1, &data, sizeof(data), NULL);
+        } else {
+            zend_hash_index_update(new_hash, Z_LVAL_PP(entry), &data, sizeof(data), NULL);
+        }
+        Z_ADDREF_P(data);
+        zend_hash_move_forward_ex(hash, &pos);
+    }
+    zval_ptr_dtor(&data);
+
+    return new_hash;
+}
+/* }}} */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_cache.c php-5.4.19.bak/ext/apc/apc_cache.c
--- php-5.4.19/ext/apc/apc_cache.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_cache.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,1386 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_cache.c 327066 2012-08-12 07:48:48Z laruence $ */
+
+#include "apc_cache.h"
+#include "apc_zend.h"
+#include "apc_sma.h"
+#include "apc_globals.h"
+#include "SAPI.h"
+#include "TSRM.h"
+#include "ext/standard/md5.h"
+
+/* TODO: rehash when load factor exceeds threshold */
+
+#define CHECK(p) { if ((p) == NULL) return NULL; }
+
+/* {{{ key_equals */
+#define key_equals(a, b) (a.inode==b.inode && a.device==b.device)
+/* }}} */
+
+static void apc_cache_expunge(apc_cache_t* cache, size_t size TSRMLS_DC);
+
+/* {{{ hash */
+static unsigned long hash(apc_cache_key_t key)
+{
+    return (unsigned long)(key.data.file.device + key.data.file.inode);
+}
+/* }}} */
+
+/* {{{ string_nhash_8 */
+#define string_nhash_8(s,len) (unsigned long)(zend_inline_hash_func((s), len))
+/* }}} */
+
+/* {{{ murmurhash */
+#if 0
+static inline unsigned long murmurhash(const char *skey, size_t keylen)
+{
+	const long m = 0x7fd652ad;
+	const long r = 16;
+	unsigned int h = 0xdeadbeef;
+
+	while(keylen >= 4)
+	{
+		h += *(unsigned int*)skey;
+		h *= m;
+		h ^= h >> r;
+
+		skey += 4;
+		keylen -= 4;
+	}
+
+	switch(keylen)
+	{
+	case 3:
+		h += skey[2] << 16;
+	case 2:
+		h += skey[1] << 8;
+	case 1:
+		h += skey[0];
+		h *= m;
+		h ^= h >> r;
+	};
+
+	h *= m;
+	h ^= h >> 10;
+	h *= m;
+	h ^= h >> 17;
+
+	return h;
+}
+#endif
+/* }}} */
+
+/* {{{ make_prime */
+static int const primes[] = {
+  257, /*   256 */
+  521, /*   512 */
+ 1031, /*  1024 */
+ 2053, /*  2048 */
+ 3079, /*  3072 */
+ 4099, /*  4096 */
+ 5147, /*  5120 */
+ 6151, /*  6144 */
+ 7177, /*  7168 */
+ 8209, /*  8192 */
+ 9221, /*  9216 */
+10243, /* 10240 */
+11273, /* 11264 */
+12289, /* 12288 */
+13313, /* 13312 */
+14341, /* 14336 */
+15361, /* 15360 */
+16411, /* 16384 */
+17417, /* 17408 */
+18433, /* 18432 */
+19457, /* 19456 */
+0      /* sentinel */
+};
+
+static int make_prime(int n)
+{
+    int *k = (int*)primes; 
+    while(*k) {
+        if((*k) > n) return *k;
+        k++;
+    }
+    return *(k-1);
+}
+/* }}} */
+
+/* {{{ make_slot */
+slot_t* make_slot(apc_cache_key_t *key, apc_cache_entry_t* value, slot_t* next, time_t t TSRMLS_DC)
+{
+    slot_t* p = apc_pool_alloc(value->pool, sizeof(slot_t));
+
+    if (!p) return NULL;
+
+    if(key->type == APC_CACHE_KEY_USER) {
+        char *identifier = (char*) apc_pmemcpy(key->data.user.identifier, key->data.user.identifier_len, value->pool TSRMLS_CC);
+        if (!identifier) {
+            return NULL;
+        }
+        key->data.user.identifier = identifier;
+    } else if(key->type == APC_CACHE_KEY_FPFILE) {
+        char *fullpath = (char*) apc_pstrdup(key->data.fpfile.fullpath, value->pool TSRMLS_CC);
+        if (!fullpath) {
+            return NULL;
+        }
+        key->data.fpfile.fullpath = fullpath;
+    }
+    p->key = key[0];
+    p->value = value;
+    p->next = next;
+    p->num_hits = 0;
+    p->creation_time = t;
+    p->access_time = t;
+    p->deletion_time = 0;
+    return p;
+}
+/* }}} */
+
+/* {{{ free_slot */
+static void free_slot(slot_t* slot TSRMLS_DC)
+{
+    apc_pool_destroy(slot->value->pool TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ remove_slot */
+static void remove_slot(apc_cache_t* cache, slot_t** slot TSRMLS_DC)
+{
+    slot_t* dead = *slot;
+    *slot = (*slot)->next;
+
+    cache->header->mem_size -= dead->value->mem_size;
+    CACHE_FAST_DEC(cache, cache->header->num_entries);
+    if (dead->value->ref_count <= 0) {
+        free_slot(dead TSRMLS_CC);
+    }
+    else {
+        dead->next = cache->header->deleted_list;
+        dead->deletion_time = time(0);
+        cache->header->deleted_list = dead;
+    }
+}
+/* }}} */
+
+/* {{{ process_pending_removals */
+static void process_pending_removals(apc_cache_t* cache TSRMLS_DC)
+{
+    slot_t** slot;
+    time_t now;
+
+    /* This function scans the list of removed cache entries and deletes any
+     * entry whose reference count is zero (indicating that it is no longer
+     * being executed) or that has been on the pending list for more than
+     * cache->gc_ttl seconds (we issue a warning in the latter case).
+     */
+
+    if (!cache->header->deleted_list)
+        return;
+
+    slot = &cache->header->deleted_list;
+    now = time(0);
+
+    while (*slot != NULL) {
+        int gc_sec = cache->gc_ttl ? (now - (*slot)->deletion_time) : 0;
+
+        if ((*slot)->value->ref_count <= 0 || gc_sec > cache->gc_ttl) {
+            slot_t* dead = *slot;
+
+            if (dead->value->ref_count > 0) {
+                switch(dead->value->type) {
+                    case APC_CACHE_ENTRY_FILE:
+                        apc_debug("GC cache entry '%s' (dev=%d ino=%d) was on gc-list for %d seconds" TSRMLS_CC, 
+                            dead->value->data.file.filename, dead->key.data.file.device, dead->key.data.file.inode, gc_sec);
+                        break;
+                    case APC_CACHE_ENTRY_USER:
+                        apc_debug("GC cache entry '%s' was on gc-list for %d seconds" TSRMLS_CC, dead->value->data.user.info, gc_sec);
+                        break;
+                }
+            }
+            *slot = dead->next;
+            free_slot(dead TSRMLS_CC);
+        }
+        else {
+            slot = &(*slot)->next;
+        }
+    }
+}
+/* }}} */
+
+/* {{{ prevent_garbage_collection */
+static void prevent_garbage_collection(apc_cache_entry_t* entry)
+{
+    /* set reference counts on zend objects to an arbitrarily high value to
+     * prevent garbage collection after execution */
+
+    enum { BIG_VALUE = 1000 };
+
+    if(entry->data.file.op_array) {
+        entry->data.file.op_array->refcount[0] = BIG_VALUE;
+    }
+    if (entry->data.file.functions) {
+        int i;
+        apc_function_t* fns = entry->data.file.functions;
+        for (i=0; fns[i].function != NULL; i++) {
+            *(fns[i].function->op_array.refcount) = BIG_VALUE;
+        }
+    }
+    if (entry->data.file.classes) {
+        int i;
+        apc_class_t* classes = entry->data.file.classes;
+        for (i=0; classes[i].class_entry != NULL; i++) {
+            classes[i].class_entry->refcount = BIG_VALUE;
+        }
+    }
+}
+/* }}} */
+
+/* {{{ apc_cache_create */
+apc_cache_t* apc_cache_create(int size_hint, int gc_ttl, int ttl TSRMLS_DC)
+{
+    apc_cache_t* cache;
+    int cache_size;
+    int num_slots;
+
+    num_slots = make_prime(size_hint > 0 ? size_hint : 2000);
+
+    cache = (apc_cache_t*) apc_emalloc(sizeof(apc_cache_t) TSRMLS_CC);
+    cache_size = sizeof(cache_header_t) + num_slots*sizeof(slot_t*);
+
+    cache->shmaddr = apc_sma_malloc(cache_size TSRMLS_CC);
+    if(!cache->shmaddr) {
+        apc_error("Unable to allocate shared memory for cache structures.  (Perhaps your shared memory size isn't large enough?). " TSRMLS_CC);
+        return NULL;
+    }
+    memset(cache->shmaddr, 0, cache_size);
+
+    cache->header = (cache_header_t*) cache->shmaddr;
+    cache->header->num_hits = 0;
+    cache->header->num_misses = 0;
+    cache->header->deleted_list = NULL;
+    cache->header->start_time = time(NULL);
+    cache->header->expunges = 0;
+    cache->header->busy = 0;
+
+    cache->slots = (slot_t**) (((char*) cache->shmaddr) + sizeof(cache_header_t));
+    cache->num_slots = num_slots;
+    cache->gc_ttl = gc_ttl;
+    cache->ttl = ttl;
+    CREATE_LOCK(cache->header->lock);
+#if NONBLOCKING_LOCK_AVAILABLE
+    CREATE_LOCK(cache->header->wrlock);
+#endif
+    memset(cache->slots, 0, sizeof(slot_t*)*num_slots);
+    cache->expunge_cb = apc_cache_expunge;
+    cache->has_lock = 0;
+
+    return cache;
+}
+/* }}} */
+
+/* {{{ apc_cache_destroy */
+void apc_cache_destroy(apc_cache_t* cache TSRMLS_DC)
+{
+    DESTROY_LOCK(cache->header->lock);
+#if NONBLOCKING_LOCK_AVAILABLE
+    DESTROY_LOCK(cache->header->wrlock);
+#endif
+
+	/* XXX this is definitely a leak, but freeing this causes all the apache
+		children to freeze. It might be because the segment is shared between
+		several processes. To figure out is how to free this safely. */
+    /*apc_sma_free(cache->shmaddr TSRMLS_CC);*/
+    apc_efree(cache TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ apc_cache_clear */
+void apc_cache_clear(apc_cache_t* cache TSRMLS_DC)
+{
+    int i;
+
+    if(!cache) return;
+
+    CACHE_LOCK(cache);
+    cache->header->busy = 1;
+    cache->header->num_hits = 0;
+    cache->header->num_misses = 0;
+    cache->header->start_time = time(NULL);
+    cache->header->expunges = 0;
+
+    for (i = 0; i < cache->num_slots; i++) {
+        slot_t* p = cache->slots[i];
+        while (p) {
+            remove_slot(cache, &p TSRMLS_CC);
+        }
+        cache->slots[i] = NULL;
+    }
+
+    memset(&cache->header->lastkey, 0, sizeof(apc_keyid_t));
+
+    cache->header->busy = 0;
+    CACHE_UNLOCK(cache);
+}
+/* }}} */
+
+/* {{{ apc_cache_expunge */
+static void apc_cache_expunge(apc_cache_t* cache, size_t size TSRMLS_DC)
+{
+    int i;
+    time_t t;
+
+    t = apc_time();
+
+    if(!cache) return;
+
+    if(!cache->ttl) {
+        /*
+         * If cache->ttl is not set, we wipe out the entire cache when
+         * we run out of space.
+         */
+        CACHE_SAFE_LOCK(cache);
+        process_pending_removals(cache TSRMLS_CC);
+        if (apc_sma_get_avail_mem() > (size_t)(APCG(shm_size)/2)) {
+            /* probably a queued up expunge, we don't need to do this */
+            CACHE_SAFE_UNLOCK(cache);
+            return;
+        }
+        cache->header->busy = 1;
+        CACHE_FAST_INC(cache, cache->header->expunges);
+clear_all:
+        for (i = 0; i < cache->num_slots; i++) {
+            slot_t* p = cache->slots[i];
+            while (p) {
+                remove_slot(cache, &p TSRMLS_CC);
+            }
+            cache->slots[i] = NULL;
+        }
+        memset(&cache->header->lastkey, 0, sizeof(apc_keyid_t));
+        cache->header->busy = 0;
+        CACHE_SAFE_UNLOCK(cache);
+    } else {
+        slot_t **p;
+        /*
+         * If the ttl for the cache is set we walk through and delete stale 
+         * entries.  For the user cache that is slightly confusing since
+         * we have the individual entry ttl's we can look at, but that would be
+         * too much work.  So if you want the user cache expunged, set a high
+         * default apc.user_ttl and still provide a specific ttl for each entry
+         * on insert
+         */
+
+        CACHE_SAFE_LOCK(cache);
+        process_pending_removals(cache TSRMLS_CC);
+        if (apc_sma_get_avail_mem() > (size_t)(APCG(shm_size)/2)) {
+            /* probably a queued up expunge, we don't need to do this */
+            CACHE_SAFE_UNLOCK(cache);
+            return;
+        }
+        cache->header->busy = 1;
+        CACHE_FAST_INC(cache, cache->header->expunges);
+        for (i = 0; i < cache->num_slots; i++) {
+            p = &cache->slots[i];
+            while(*p) {
+                /*
+                 * For the user cache we look at the individual entry ttl values
+                 * and if not set fall back to the default ttl for the user cache
+                 */
+                if((*p)->value->type == APC_CACHE_ENTRY_USER) {
+                    if((*p)->value->data.user.ttl) {
+                        if((time_t) ((*p)->creation_time + (*p)->value->data.user.ttl) < t) {
+                            remove_slot(cache, p TSRMLS_CC);
+                            continue;
+                        }
+                    } else if(cache->ttl) {
+                        if((*p)->creation_time + cache->ttl < t) {
+                            remove_slot(cache, p TSRMLS_CC);
+                            continue;
+                        }
+                    }
+                } else if((*p)->access_time < (t - cache->ttl)) {
+                    remove_slot(cache, p TSRMLS_CC);
+                    continue;
+                }
+                p = &(*p)->next;
+            }
+        }
+
+        if (!apc_sma_get_avail_size(size)) {
+            /* TODO: re-do this to remove goto across locked sections */
+            goto clear_all;
+        }
+        memset(&cache->header->lastkey, 0, sizeof(apc_keyid_t));
+        cache->header->busy = 0;
+        CACHE_SAFE_UNLOCK(cache);
+    }
+}
+/* }}} */
+
+/* {{{ apc_cache_insert */
+static inline int _apc_cache_insert(apc_cache_t* cache,
+                     apc_cache_key_t key,
+                     apc_cache_entry_t* value,
+                     apc_context_t* ctxt,
+                     time_t t
+                     TSRMLS_DC)
+{
+    slot_t** slot;
+
+    if (!value) {
+        return 0;
+    }
+
+    apc_debug("Inserting [%s]\n" TSRMLS_CC, value->data.file.filename);
+
+    process_pending_removals(cache TSRMLS_CC);
+
+    slot = &cache->slots[key.h % cache->num_slots];
+
+    while(*slot) {
+      if(key.type == (*slot)->key.type) {
+        if(key.type == APC_CACHE_KEY_FILE) {
+            if(key_equals((*slot)->key.data.file, key.data.file)) {
+                /* If existing slot for the same device+inode is different, remove it and insert the new version */
+                if (ctxt->force_update || (*slot)->key.mtime != key.mtime) {
+                    remove_slot(cache, slot TSRMLS_CC);
+                    break;
+                }
+                return 0;
+            } else if(cache->ttl && (*slot)->access_time < (t - cache->ttl)) {
+                remove_slot(cache, slot TSRMLS_CC);
+                continue;
+            }
+        } else {   /* APC_CACHE_KEY_FPFILE */
+            if((key.h == (*slot)->key.h) &&
+                !memcmp((*slot)->key.data.fpfile.fullpath, key.data.fpfile.fullpath, key.data.fpfile.fullpath_len+1)) {
+                /* Hrm.. it's already here, remove it and insert new one */
+                remove_slot(cache, slot TSRMLS_CC);
+                break;
+            } else if(cache->ttl && (*slot)->access_time < (t - cache->ttl)) {
+                remove_slot(cache, slot TSRMLS_CC);
+                continue;
+            }
+        }
+      }
+      slot = &(*slot)->next;
+    }
+
+    if ((*slot = make_slot(&key, value, *slot, t TSRMLS_CC)) == NULL) {
+        return -1;
+    }
+
+    value->mem_size = ctxt->pool->size;
+    cache->header->mem_size += ctxt->pool->size;
+    CACHE_FAST_INC(cache, cache->header->num_entries);
+    CACHE_FAST_INC(cache, cache->header->num_inserts);
+
+    return 1;
+}
+/* }}} */
+
+/* {{{ apc_cache_insert */
+int apc_cache_insert(apc_cache_t* cache, apc_cache_key_t key, apc_cache_entry_t* value, apc_context_t *ctxt, time_t t TSRMLS_DC)
+{
+    int rval;
+    CACHE_LOCK(cache);
+    rval = _apc_cache_insert(cache, key, value, ctxt, t TSRMLS_CC);
+    CACHE_UNLOCK(cache);
+    return rval;
+}
+/* }}} */
+
+/* {{{ apc_cache_insert */
+int *apc_cache_insert_mult(apc_cache_t* cache, apc_cache_key_t* keys, apc_cache_entry_t** values, apc_context_t *ctxt, time_t t, int num_entries TSRMLS_DC)
+{
+    int *rval;
+    int i;
+
+    rval = emalloc(sizeof(int) * num_entries);
+    CACHE_LOCK(cache);
+    for (i=0; i < num_entries; i++) {
+        if (values[i]) {
+            ctxt->pool = values[i]->pool;
+            rval[i] = _apc_cache_insert(cache, keys[i], values[i], ctxt, t TSRMLS_CC);
+        }
+    }
+    CACHE_UNLOCK(cache);
+    return rval;
+}
+/* }}} */
+
+/* {{{ apc_cache_user_insert */
+int apc_cache_user_insert(apc_cache_t* cache, apc_cache_key_t key, apc_cache_entry_t* value, apc_context_t* ctxt, time_t t, int exclusive TSRMLS_DC)
+{
+    slot_t** slot;
+    unsigned int keylen = key.data.user.identifier_len;
+    apc_keyid_t *lastkey = &cache->header->lastkey;
+    
+    if (!value) {
+        return 0;
+    }
+    
+    if(apc_cache_busy(cache)) {
+        /* cache cleanup in progress, do not wait */ 
+        return 0;
+    }
+
+    if(apc_cache_is_last_key(cache, &key, t TSRMLS_CC)) {
+        /* potential cache slam */
+        return 0;
+    }
+
+    CACHE_LOCK(cache);
+
+    memset(lastkey, 0, sizeof(apc_keyid_t));
+
+    lastkey->h = key.h;
+    lastkey->keylen = keylen;
+    lastkey->mtime = t;
+#ifdef ZTS
+    lastkey->tid = tsrm_thread_id();
+#else
+    lastkey->pid = getpid();
+#endif
+    
+    /* we do not reset lastkey after the insert. Whether it is inserted 
+     * or not, another insert in the same second is always a bad idea. 
+     */
+
+    process_pending_removals(cache TSRMLS_CC);
+    
+    slot = &cache->slots[key.h % cache->num_slots];
+
+    while (*slot) {
+        if (((*slot)->key.h == key.h) && 
+            (!memcmp((*slot)->key.data.user.identifier, key.data.user.identifier, keylen))) {
+            /* 
+             * At this point we have found the user cache entry.  If we are doing 
+             * an exclusive insert (apc_add) we are going to bail right away if
+             * the user entry already exists and it has no ttl, or
+             * there is a ttl and the entry has not timed out yet.
+             */
+            if(exclusive && (  !(*slot)->value->data.user.ttl ||
+                              ( (*slot)->value->data.user.ttl && (time_t) ((*slot)->creation_time + (*slot)->value->data.user.ttl) >= t ) 
+                            ) ) {
+                goto fail;
+            }
+            remove_slot(cache, slot TSRMLS_CC);
+            break;
+        } else 
+        /* 
+         * This is a bit nasty.  The idea here is to do runtime cleanup of the linked list of
+         * slot entries so we don't always have to skip past a bunch of stale entries.  We check
+         * for staleness here and get rid of them by first checking to see if the cache has a global
+         * access ttl on it and removing entries that haven't been accessed for ttl seconds and secondly
+         * we see if the entry has a hard ttl on it and remove it if it has been around longer than its ttl
+         */
+        if((cache->ttl && (*slot)->access_time < (t - cache->ttl)) || 
+           ((*slot)->value->data.user.ttl && (time_t) ((*slot)->creation_time + (*slot)->value->data.user.ttl) < t)) {
+            remove_slot(cache, slot TSRMLS_CC);
+            continue;
+        }
+        slot = &(*slot)->next;
+    }
+
+    if ((*slot = make_slot(&key, value, *slot, t TSRMLS_CC)) == NULL) {
+        goto fail;
+    } 
+    
+    value->mem_size = ctxt->pool->size;
+    cache->header->mem_size += ctxt->pool->size;
+
+    CACHE_FAST_INC(cache, cache->header->num_entries);
+    CACHE_FAST_INC(cache, cache->header->num_inserts);
+
+    CACHE_UNLOCK(cache);
+
+    return 1;
+
+fail:
+    CACHE_UNLOCK(cache);
+
+    return 0;
+}
+/* }}} */
+
+/* {{{ apc_cache_find_slot */
+slot_t* apc_cache_find_slot(apc_cache_t* cache, apc_cache_key_t key, time_t t TSRMLS_DC)
+{
+    slot_t** slot;
+    volatile slot_t* retval = NULL;
+
+    CACHE_RDLOCK(cache);
+    if(key.type == APC_CACHE_KEY_FILE) slot = &cache->slots[hash(key) % cache->num_slots];
+    else slot = &cache->slots[key.h % cache->num_slots];
+
+    while (*slot) {
+      if(key.type == (*slot)->key.type) {
+        if(key.type == APC_CACHE_KEY_FILE) {
+            if(key_equals((*slot)->key.data.file, key.data.file)) {
+                if((*slot)->key.mtime != key.mtime) {
+                    #if (USE_READ_LOCKS == 0)
+                    /* this is merely a memory-friendly optimization, if we do have a write-lock
+                     * might as well move this to the deleted_list right-away. Otherwise an insert
+                     * of the same key wil do it (or an expunge, *eventually*).
+                     */
+                    remove_slot(cache, slot TSRMLS_CC);
+                    #endif
+                    CACHE_SAFE_INC(cache, cache->header->num_misses);
+                    CACHE_RDUNLOCK(cache);
+                    return NULL;
+                }
+                CACHE_SAFE_INC(cache, (*slot)->num_hits);
+                CACHE_SAFE_INC(cache, (*slot)->value->ref_count);
+                (*slot)->access_time = t;
+                prevent_garbage_collection((*slot)->value);
+                CACHE_FAST_INC(cache, cache->header->num_hits); 
+                retval = *slot;
+                CACHE_RDUNLOCK(cache);
+                return (slot_t*)retval;
+            }
+        } else {  /* APC_CACHE_KEY_FPFILE */
+            if(((*slot)->key.h == key.h) &&
+                !memcmp((*slot)->key.data.fpfile.fullpath, key.data.fpfile.fullpath, key.data.fpfile.fullpath_len+1)) {
+                /* TTL Check ? */
+                CACHE_SAFE_INC(cache, (*slot)->num_hits);
+                CACHE_SAFE_INC(cache, (*slot)->value->ref_count);
+                (*slot)->access_time = t;
+                prevent_garbage_collection((*slot)->value);
+                CACHE_FAST_INC(cache, cache->header->num_hits);
+                retval = *slot;
+                CACHE_RDUNLOCK(cache);
+                return (slot_t*)retval;
+            }
+        }
+      }
+      slot = &(*slot)->next;
+    }
+    CACHE_FAST_INC(cache, cache->header->num_misses); 
+    CACHE_RDUNLOCK(cache);
+    return NULL;
+}
+/* }}} */
+
+/* {{{ apc_cache_find */
+apc_cache_entry_t* apc_cache_find(apc_cache_t* cache, apc_cache_key_t key, time_t t TSRMLS_DC)
+{
+    slot_t * slot = apc_cache_find_slot(cache, key, t TSRMLS_CC);
+    apc_debug("apc_cache_find [%i]\n" TSRMLS_CC, key.h);
+    return (slot) ? slot->value : NULL;
+}
+/* }}} */
+
+/* {{{ apc_cache_user_find */
+apc_cache_entry_t* apc_cache_user_find(apc_cache_t* cache, char *strkey, int keylen, time_t t TSRMLS_DC)
+{
+    slot_t** slot;
+    volatile apc_cache_entry_t* value = NULL;
+    unsigned long h;
+
+    if(apc_cache_busy(cache))
+    {
+        /* cache cleanup in progress */ 
+        return NULL;
+    }
+
+    CACHE_RDLOCK(cache);
+
+    h = string_nhash_8(strkey, keylen);
+
+    slot = &cache->slots[h % cache->num_slots];
+
+    while (*slot) {
+        if ((h == (*slot)->key.h) &&
+            !memcmp((*slot)->key.data.user.identifier, strkey, keylen)) {
+            /* Check to make sure this entry isn't expired by a hard TTL */
+            if((*slot)->value->data.user.ttl && (time_t) ((*slot)->creation_time + (*slot)->value->data.user.ttl) < t) {
+                #if (USE_READ_LOCKS == 0) 
+                /* this is merely a memory-friendly optimization, if we do have a write-lock
+                 * might as well move this to the deleted_list right-away. Otherwise an insert
+                 * of the same key wil do it (or an expunge, *eventually*).
+                 */
+                remove_slot(cache, slot TSRMLS_CC);
+                #endif
+                CACHE_FAST_INC(cache, cache->header->num_misses);
+                CACHE_RDUNLOCK(cache);
+                return NULL;
+            }
+            /* Otherwise we are fine, increase counters and return the cache entry */
+            CACHE_SAFE_INC(cache, (*slot)->num_hits);
+            CACHE_SAFE_INC(cache, (*slot)->value->ref_count);
+            (*slot)->access_time = t;
+
+            CACHE_FAST_INC(cache, cache->header->num_hits);
+            value = (*slot)->value;
+            CACHE_RDUNLOCK(cache);
+            return (apc_cache_entry_t*)value;
+        }
+        slot = &(*slot)->next;
+    }
+ 
+    CACHE_FAST_INC(cache, cache->header->num_misses);
+    CACHE_RDUNLOCK(cache);
+    return NULL;
+}
+/* }}} */
+
+/* {{{ apc_cache_user_exists */
+apc_cache_entry_t* apc_cache_user_exists(apc_cache_t* cache, char *strkey, int keylen, time_t t TSRMLS_DC)
+{
+    slot_t** slot;
+    volatile apc_cache_entry_t* value = NULL;
+    unsigned long h;
+
+    if(apc_cache_busy(cache))
+    {
+        /* cache cleanup in progress */ 
+        return NULL;
+    }
+
+    CACHE_RDLOCK(cache);
+
+    h = string_nhash_8(strkey, keylen);
+
+    slot = &cache->slots[h % cache->num_slots];
+
+    while (*slot) {
+        if ((h == (*slot)->key.h) &&
+            !memcmp((*slot)->key.data.user.identifier, strkey, keylen)) {
+            /* Check to make sure this entry isn't expired by a hard TTL */
+            if((*slot)->value->data.user.ttl && (time_t) ((*slot)->creation_time + (*slot)->value->data.user.ttl) < t) {
+                CACHE_UNLOCK(cache);
+                return NULL;
+            }
+            /* Return the cache entry ptr */
+            value = (*slot)->value;
+            CACHE_RDUNLOCK(cache);
+            return (apc_cache_entry_t*)value;
+        }
+        slot = &(*slot)->next;
+    }
+    CACHE_RDUNLOCK(cache);
+    return NULL;
+}
+/* }}} */
+
+/* {{{ apc_cache_user_update */
+int _apc_cache_user_update(apc_cache_t* cache, char *strkey, int keylen, apc_cache_updater_t updater, void* data TSRMLS_DC)
+{
+    slot_t** slot;
+    int retval;
+    unsigned long h;
+
+    if(apc_cache_busy(cache))
+    {
+        /* cache cleanup in progress */ 
+        return 0;
+    }
+
+    CACHE_LOCK(cache);
+
+    h = string_nhash_8(strkey, keylen);
+    slot = &cache->slots[h % cache->num_slots];
+
+    while (*slot) {
+        if ((h == (*slot)->key.h) &&
+            !memcmp((*slot)->key.data.user.identifier, strkey, keylen)) {
+            switch(Z_TYPE_P((*slot)->value->data.user.val) & ~IS_CONSTANT_INDEX) {
+                case IS_ARRAY:
+                case IS_CONSTANT_ARRAY:
+                case IS_OBJECT:
+                {
+                    if(APCG(serializer)) {
+                        retval = 0;
+                        break;
+                    } else {
+                        /* fall through */
+                    }
+                }
+                /* fall through */
+                default:
+                {
+                    retval = updater(cache, (*slot)->value, data);
+                    (*slot)->key.mtime = apc_time();
+                }
+                break;
+            }
+            CACHE_UNLOCK(cache);
+            return retval;
+        }
+        slot = &(*slot)->next;
+    }
+    CACHE_UNLOCK(cache);
+    return 0;
+}
+/* }}} */
+
+/* {{{ apc_cache_user_delete */
+int apc_cache_user_delete(apc_cache_t* cache, char *strkey, int keylen TSRMLS_DC)
+{
+    slot_t** slot;
+    unsigned long h;
+
+    CACHE_LOCK(cache);
+
+    h = string_nhash_8(strkey, keylen);
+
+    slot = &cache->slots[h % cache->num_slots];
+
+    while (*slot) {
+        if ((h == (*slot)->key.h) && 
+            !memcmp((*slot)->key.data.user.identifier, strkey, keylen)) {
+            remove_slot(cache, slot TSRMLS_CC);
+            CACHE_UNLOCK(cache);
+            return 1;
+        }
+        slot = &(*slot)->next;
+    }
+
+    CACHE_UNLOCK(cache);
+    return 0;
+}
+/* }}} */
+
+/* {{{ apc_cache_delete */
+int apc_cache_delete(apc_cache_t* cache, char *filename, int filename_len TSRMLS_DC)
+{
+    slot_t** slot;
+    time_t t;
+    apc_cache_key_t key;
+
+    t = apc_time();
+
+    /* try to create a cache key; if we fail, give up on caching */
+    if (!apc_cache_make_file_key(&key, filename, PG(include_path), t TSRMLS_CC)) {
+        apc_warning("Could not stat file %s, unable to delete from cache." TSRMLS_CC, filename);
+        return -1;
+    }
+
+    CACHE_LOCK(cache);
+
+    if(key.type == APC_CACHE_KEY_FILE) slot = &cache->slots[hash(key) % cache->num_slots];
+    else slot = &cache->slots[key.h % cache->num_slots];
+
+    while(*slot) {
+      if(key.type == (*slot)->key.type) {
+        if(key.type == APC_CACHE_KEY_FILE) {
+            if(key_equals((*slot)->key.data.file, key.data.file)) {
+                remove_slot(cache, slot TSRMLS_CC);
+                CACHE_UNLOCK(cache);
+                return 1;
+            }
+        } else {   /* APC_CACHE_KEY_FPFILE */
+            if(((*slot)->key.h == key.h) &&
+                (!memcmp((*slot)->key.data.fpfile.fullpath, key.data.fpfile.fullpath, key.data.fpfile.fullpath_len+1))) {
+                remove_slot(cache, slot TSRMLS_CC);
+                CACHE_UNLOCK(cache);
+                return 1;
+            }
+        }
+      }
+      slot = &(*slot)->next;
+    }
+    
+    memset(&cache->header->lastkey, 0, sizeof(apc_keyid_t));
+    
+    CACHE_UNLOCK(cache);
+    return 0;
+
+}
+/* }}} */
+
+/* {{{ apc_cache_release */
+void apc_cache_release(apc_cache_t* cache, apc_cache_entry_t* entry TSRMLS_DC)
+{
+    CACHE_SAFE_DEC(cache, entry->ref_count);
+}
+/* }}} */
+
+/* {{{ apc_cache_make_file_key */
+int apc_cache_make_file_key(apc_cache_key_t* key,
+                       const char* filename,
+                       const char* include_path,
+                       time_t t
+                       TSRMLS_DC)
+{
+    struct stat *tmp_buf=NULL;
+    struct apc_fileinfo_t *fileinfo = NULL;
+    int len;
+
+    assert(key != NULL);
+
+    if (!filename || !SG(request_info).path_translated) {
+        apc_debug("No filename and no path_translated - bailing\n" TSRMLS_CC);
+        goto cleanup;
+    }
+
+    len = strlen(filename);
+    if(APCG(fpstat)==0) {
+        if(IS_ABSOLUTE_PATH(filename,len) || strstr(filename, "://")) {
+            key->data.fpfile.fullpath = filename;
+            key->data.fpfile.fullpath_len = len;
+            key->h = string_nhash_8(key->data.fpfile.fullpath, key->data.fpfile.fullpath_len);
+            key->mtime = t;
+            key->type = APC_CACHE_KEY_FPFILE;
+            goto success;
+        } else if(APCG(canonicalize)) {
+
+            fileinfo = apc_php_malloc(sizeof(apc_fileinfo_t) TSRMLS_CC);
+
+            if (apc_search_paths(filename, include_path, fileinfo TSRMLS_CC) != 0) {
+                apc_warning("apc failed to locate %s - bailing" TSRMLS_CC, filename);
+                goto cleanup;
+            }
+
+            if(!VCWD_REALPATH(fileinfo->fullpath, APCG(canon_path))) {
+                apc_warning("realpath failed to canonicalize %s - bailing" TSRMLS_CC, filename);
+                goto cleanup;
+            }
+
+            key->data.fpfile.fullpath = APCG(canon_path);
+            key->data.fpfile.fullpath_len = strlen(APCG(canon_path));
+            key->h = string_nhash_8(key->data.fpfile.fullpath, key->data.fpfile.fullpath_len);
+            key->mtime = t;
+            key->type = APC_CACHE_KEY_FPFILE;
+            goto success;
+        }
+        /* fall through to stat mode */
+    }
+
+    fileinfo = apc_php_malloc(sizeof(apc_fileinfo_t) TSRMLS_CC);
+
+    assert(fileinfo != NULL);
+
+    if(!strcmp(SG(request_info).path_translated, filename)) {
+        tmp_buf = sapi_get_stat(TSRMLS_C);  /* Apache has already done this stat() for us */
+    }
+
+    if(tmp_buf) {
+        fileinfo->st_buf.sb = *tmp_buf;
+    } else {
+        if (apc_search_paths(filename, include_path, fileinfo TSRMLS_CC) != 0) {
+            apc_debug("Stat failed %s - bailing (%s) (%d)\n" TSRMLS_CC, filename,SG(request_info).path_translated);
+            goto cleanup;
+        }
+    }
+
+    if(APCG(max_file_size) < fileinfo->st_buf.sb.st_size) {
+        apc_debug("File is too big %s (%d - %ld) - bailing\n" TSRMLS_CC, filename,t,fileinfo->st_buf.sb.st_size);
+        goto cleanup;
+    }
+
+    /*
+     * This is a bit of a hack.
+     *
+     * Here I am checking to see if the file is at least 2 seconds old.  
+     * The idea is that if the file is currently being written to then its
+     * mtime is going to match or at most be 1 second off of the current
+     * request time and we want to avoid caching files that have not been
+     * completely written.  Of course, people should be using atomic 
+     * mechanisms to push files onto live web servers, but adding this
+     * tiny safety is easier than educating the world.  This is now
+     * configurable, but the default is still 2 seconds.
+     */
+    if(APCG(file_update_protection) && (t - fileinfo->st_buf.sb.st_mtime < APCG(file_update_protection)) && !APCG(force_file_update)) {
+        apc_debug("File is too new %s (%d - %d) - bailing\n" TSRMLS_CC,filename,t,fileinfo->st_buf.sb.st_mtime);
+        goto cleanup;
+    }
+
+    key->data.file.device = fileinfo->st_buf.sb.st_dev;
+    key->data.file.inode  = fileinfo->st_buf.sb.st_ino;
+    key->h = (unsigned long) key->data.file.device + (unsigned long) key->data.file.inode;
+
+    /*
+     * If working with content management systems that like to munge the mtime, 
+     * it might be appropriate to key off of the ctime to be immune to systems
+     * that try to backdate a template.  If the mtime is set to something older
+     * than the previous mtime of a template we will obviously never see this
+     * "older" template.  At some point the Smarty templating system did this.
+     * I generally disagree with using the ctime here because you lose the 
+     * ability to warm up new content by saving it to a temporary file, hitting
+     * it once to cache it and then renaming it into its permanent location so
+     * set the apc.stat_ctime=true to enable this check.
+     */
+    if(APCG(stat_ctime)) {
+        key->mtime  = (fileinfo->st_buf.sb.st_ctime > fileinfo->st_buf.sb.st_mtime) ? fileinfo->st_buf.sb.st_ctime : fileinfo->st_buf.sb.st_mtime; 
+    } else {
+        key->mtime = fileinfo->st_buf.sb.st_mtime;
+    }
+    key->type = APC_CACHE_KEY_FILE;
+
+success: 
+
+    if(fileinfo != NULL) {
+        apc_php_free(fileinfo TSRMLS_CC);
+    }
+
+    return 1;
+
+cleanup:
+    
+    if(fileinfo != NULL) {
+        apc_php_free(fileinfo TSRMLS_CC);
+    }
+
+    return 0;
+}
+/* }}} */
+
+/* {{{ apc_cache_make_user_key */
+int apc_cache_make_user_key(apc_cache_key_t* key, char* identifier, int identifier_len, const time_t t)
+{
+    assert(key != NULL);
+
+    if (!identifier)
+        return 0;
+
+    key->data.user.identifier = identifier;
+    key->data.user.identifier_len = identifier_len;
+    key->h = string_nhash_8(key->data.user.identifier, key->data.user.identifier_len);
+    key->mtime = t;
+    key->type = APC_CACHE_KEY_USER;
+    return 1;
+}
+/* }}} */
+
+/* {{{ apc_cache_make_file_entry */
+apc_cache_entry_t* apc_cache_make_file_entry(const char* filename,
+                                        zend_op_array* op_array,
+                                        apc_function_t* functions,
+                                        apc_class_t* classes,
+                                        apc_context_t* ctxt
+                                        TSRMLS_DC)
+{
+    apc_cache_entry_t* entry;
+    apc_pool* pool = ctxt->pool;
+
+    entry = (apc_cache_entry_t*) apc_pool_alloc(pool, sizeof(apc_cache_entry_t));
+    if (!entry) return NULL;
+
+    entry->data.file.filename  = apc_pstrdup(filename, pool TSRMLS_CC);
+    if(!entry->data.file.filename) {
+        apc_debug("apc_cache_make_file_entry: entry->data.file.filename is NULL - bailing\n" TSRMLS_CC);
+        return NULL;
+    }
+    apc_debug("apc_cache_make_file_entry: entry->data.file.filename is [%s]\n" TSRMLS_CC,entry->data.file.filename);
+    entry->data.file.op_array  = op_array;
+    entry->data.file.functions = functions;
+    entry->data.file.classes   = classes;
+
+    entry->data.file.halt_offset = apc_file_halt_offset(filename TSRMLS_CC);
+
+    entry->type = APC_CACHE_ENTRY_FILE;
+    entry->ref_count = 0;
+    entry->mem_size = 0;
+    entry->pool = pool;
+    return entry;
+}
+/* }}} */
+
+/* {{{ apc_cache_store_zval */
+zval* apc_cache_store_zval(zval* dst, const zval* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    if (Z_TYPE_P(src) == IS_ARRAY) {
+        /* Maintain a list of zvals we've copied to properly handle recursive structures */
+        zend_hash_init(&APCG(copied_zvals), 0, NULL, NULL, 0);
+        dst = apc_copy_zval(dst, src, ctxt TSRMLS_CC);
+        zend_hash_destroy(&APCG(copied_zvals));
+        APCG(copied_zvals).nTableSize=0;
+    } else {
+        dst = apc_copy_zval(dst, src, ctxt TSRMLS_CC);
+    }
+
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_cache_fetch_zval */
+zval* apc_cache_fetch_zval(zval* dst, const zval* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    if (Z_TYPE_P(src) == IS_ARRAY) {
+        /* Maintain a list of zvals we've copied to properly handle recursive structures */
+        zend_hash_init(&APCG(copied_zvals), 0, NULL, NULL, 0);
+        dst = apc_copy_zval(dst, src, ctxt TSRMLS_CC);
+        zend_hash_destroy(&APCG(copied_zvals));
+        APCG(copied_zvals).nTableSize=0;
+    } else {
+        dst = apc_copy_zval(dst, src, ctxt TSRMLS_CC);
+    }
+
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_cache_make_user_entry */
+apc_cache_entry_t* apc_cache_make_user_entry(const char* info, int info_len, const zval* val, apc_context_t* ctxt, const unsigned int ttl TSRMLS_DC)
+{
+    apc_cache_entry_t* entry;
+    apc_pool* pool = ctxt->pool;
+
+    entry = (apc_cache_entry_t*) apc_pool_alloc(pool, sizeof(apc_cache_entry_t));
+    if (!entry) return NULL;
+
+    entry->data.user.info = apc_pmemcpy(info, info_len, pool TSRMLS_CC);
+    entry->data.user.info_len = info_len;
+    if(!entry->data.user.info) {
+        return NULL;
+    }
+    entry->data.user.val = apc_cache_store_zval(NULL, val, ctxt TSRMLS_CC);
+    if(!entry->data.user.val) {
+        return NULL;
+    }
+    INIT_PZVAL(entry->data.user.val);
+    entry->data.user.ttl = ttl;
+    entry->type = APC_CACHE_ENTRY_USER;
+    entry->ref_count = 0;
+    entry->mem_size = 0;
+    entry->pool = pool;
+    return entry;
+}
+/* }}} */
+
+/* {{{ apc_cache_link_info */
+static zval* apc_cache_link_info(apc_cache_t *cache, slot_t* p TSRMLS_DC)
+{
+    zval *link = NULL;
+    char md5str[33];
+
+    ALLOC_INIT_ZVAL(link);
+
+    if(!link) {
+        return NULL;
+    }
+
+    array_init(link);
+
+    if(p->value->type == APC_CACHE_ENTRY_FILE) {
+        add_assoc_string(link, "type", "file", 1);
+        if(p->key.type == APC_CACHE_KEY_FILE) {
+
+            #ifdef PHP_WIN32
+            {
+              char buf[20];
+              sprintf(buf, "%I64d",  p->key.data.file.device);
+              add_assoc_string(link, "device", buf, 1);
+
+              sprintf(buf, "%I64d",  p->key.data.file.inode);
+              add_assoc_string(link, "inode", buf, 1);
+            }
+            #else
+            add_assoc_long(link, "device", p->key.data.file.device);
+            add_assoc_long(link, "inode", p->key.data.file.inode);
+            #endif
+
+            add_assoc_string(link, "filename", p->value->data.file.filename, 1);
+        } else { /* This is a no-stat fullpath file entry */
+            add_assoc_long(link, "device", 0);
+            add_assoc_long(link, "inode", 0);
+            add_assoc_string(link, "filename", (char*)p->key.data.fpfile.fullpath, 1);
+        }
+        if (APCG(file_md5)) {
+               make_digest(md5str, p->key.md5);
+               add_assoc_string(link, "md5", md5str, 1);
+        } 
+    } else if(p->value->type == APC_CACHE_ENTRY_USER) {
+        add_assoc_stringl(link, "info", p->value->data.user.info, p->value->data.user.info_len-1, 1);
+        add_assoc_long(link, "ttl", (long)p->value->data.user.ttl);
+        add_assoc_string(link, "type", "user", 1);
+    }
+
+    add_assoc_double(link, "num_hits", (double)p->num_hits);
+    add_assoc_long(link, "mtime", p->key.mtime);
+    add_assoc_long(link, "creation_time", p->creation_time);
+    add_assoc_long(link, "deletion_time", p->deletion_time);
+    add_assoc_long(link, "access_time", p->access_time);
+    add_assoc_long(link, "ref_count", p->value->ref_count);
+    add_assoc_long(link, "mem_size", p->value->mem_size);
+
+    return link;
+}
+/* }}} */
+
+/* {{{ apc_cache_info */
+zval* apc_cache_info(apc_cache_t* cache, zend_bool limited TSRMLS_DC)
+{
+    zval *info = NULL;
+    zval *list = NULL;
+    zval *deleted_list = NULL;
+    zval *slots = NULL;
+    slot_t* p;
+    int i, j;
+
+    if(!cache) return NULL;
+
+    CACHE_RDLOCK(cache);
+
+    ALLOC_INIT_ZVAL(info);
+
+    if(!info) {
+        CACHE_RDUNLOCK(cache);
+        return NULL;
+    }
+
+    array_init(info);
+    add_assoc_long(info, "num_slots", cache->num_slots);
+    add_assoc_long(info, "ttl", cache->ttl);
+
+    add_assoc_double(info, "num_hits", (double)cache->header->num_hits);
+    add_assoc_double(info, "num_misses", (double)cache->header->num_misses);
+    add_assoc_double(info, "num_inserts", (double)cache->header->num_inserts);
+    add_assoc_double(info, "expunges", (double)cache->header->expunges);
+    
+    add_assoc_long(info, "start_time", cache->header->start_time);
+    add_assoc_double(info, "mem_size", (double)cache->header->mem_size);
+    add_assoc_long(info, "num_entries", cache->header->num_entries);
+#ifdef MULTIPART_EVENT_FORMDATA
+    add_assoc_long(info, "file_upload_progress", 1);
+#else
+    add_assoc_long(info, "file_upload_progress", 0);
+#endif
+#if APC_MMAP
+    add_assoc_stringl(info, "memory_type", "mmap", sizeof("mmap")-1, 1);
+#else
+    add_assoc_stringl(info, "memory_type", "IPC shared", sizeof("IPC shared")-1, 1);
+#endif
+    add_assoc_stringl(info, "locking_type", APC_LOCK_TYPE, sizeof(APC_LOCK_TYPE)-1, 1);
+
+    if(!limited) {
+        /* For each hashtable slot */
+        ALLOC_INIT_ZVAL(list);
+        array_init(list);
+
+        ALLOC_INIT_ZVAL(slots);
+        array_init(slots);
+
+        for (i = 0; i < cache->num_slots; i++) {
+            p = cache->slots[i];
+            j = 0;
+            for (; p != NULL; p = p->next) {
+                zval *link = apc_cache_link_info(cache, p TSRMLS_CC);
+                add_next_index_zval(list, link);
+                j++;
+            }
+            if(j != 0) {
+                add_index_long(slots, (ulong)i, j);
+            }
+        }
+
+        /* For each slot pending deletion */
+        ALLOC_INIT_ZVAL(deleted_list);
+        array_init(deleted_list);
+
+        for (p = cache->header->deleted_list; p != NULL; p = p->next) {
+            zval *link = apc_cache_link_info(cache, p TSRMLS_CC);
+            add_next_index_zval(deleted_list, link);
+        }
+        
+        add_assoc_zval(info, "cache_list", list);
+        add_assoc_zval(info, "deleted_list", deleted_list);
+        add_assoc_zval(info, "slot_distribution", slots);
+    }
+
+    CACHE_RDUNLOCK(cache);
+    return info;
+}
+/* }}} */
+
+/* {{{ apc_cache_unlock */
+void apc_cache_unlock(apc_cache_t* cache TSRMLS_DC)
+{
+    CACHE_UNLOCK(cache);
+}
+/* }}} */
+
+/* {{{ apc_cache_busy */
+zend_bool apc_cache_busy(apc_cache_t* cache)
+{
+    return cache->header->busy;
+}
+/* }}} */
+
+/* {{{ apc_cache_is_last_key */
+zend_bool apc_cache_is_last_key(apc_cache_t* cache, apc_cache_key_t* key, time_t t TSRMLS_DC)
+{
+    apc_keyid_t *lastkey = &cache->header->lastkey;
+    unsigned int keylen = key->data.user.identifier_len;
+#ifdef ZTS
+    THREAD_T tid = tsrm_thread_id();
+    #define FROM_DIFFERENT_THREAD(k) (memcmp(&((k)->tid), &tid, sizeof(THREAD_T))!=0)
+#else
+    pid_t pid = getpid();
+    #define FROM_DIFFERENT_THREAD(k) (pid != (k)->pid) 
+#endif
+
+
+    /* unlocked reads, but we're not shooting for 100% success with this */
+    if(lastkey->h == key->h && keylen == lastkey->keylen) {
+        if(lastkey->mtime == t && FROM_DIFFERENT_THREAD(lastkey)) {
+            /* potential cache slam */
+            if(APCG(slam_defense)) {
+                apc_debug("Potential cache slam averted for key '%s'" TSRMLS_CC, key->data.user.identifier);
+                return 1;
+            }
+        }
+    }
+
+    return 0;
+}
+/* }}} */
+
+#if NONBLOCKING_LOCK_AVAILABLE
+/* {{{ apc_cache_write_lock */
+zend_bool apc_cache_write_lock(apc_cache_t* cache TSRMLS_DC)
+{
+    return apc_lck_nb_lock(cache->header->wrlock);
+}
+/* }}} */
+
+/* {{{ apc_cache_write_unlock */
+void apc_cache_write_unlock(apc_cache_t* cache TSRMLS_DC)
+{
+    apc_lck_unlock(cache->header->wrlock);
+}
+/* }}} */
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_cache.h php-5.4.19.bak/ext/apc/apc_cache.h
--- php-5.4.19/ext/apc/apc_cache.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_cache.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,372 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt.                                 |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_cache.h 326865 2012-07-29 14:19:27Z ab $ */
+
+#ifndef APC_CACHE_H
+#define APC_CACHE_H
+
+/*
+ * This module defines the shared memory file cache. Basically all of the
+ * logic for storing and retrieving cache entries lives here.
+ */
+
+#include "apc.h"
+#include "apc_compile.h"
+#include "apc_lock.h"
+#include "apc_pool.h"
+#include "apc_main.h"
+#include "TSRM.h"
+
+#define APC_CACHE_ENTRY_FILE   1
+#define APC_CACHE_ENTRY_USER   2
+
+#define APC_CACHE_KEY_FILE     1
+#define APC_CACHE_KEY_USER     2
+#define APC_CACHE_KEY_FPFILE   3
+
+#ifdef PHP_WIN32
+typedef unsigned __int64 apc_ino_t;
+typedef unsigned __int64 apc_dev_t;
+#else
+typedef ino_t apc_ino_t;
+typedef dev_t apc_dev_t;
+#endif
+
+/* {{{ cache locking macros */
+#define CACHE_LOCK(cache)        { LOCK(cache->header->lock);   cache->has_lock = 1; }
+#define CACHE_UNLOCK(cache)      { UNLOCK(cache->header->lock); cache->has_lock = 0; }
+#define CACHE_SAFE_LOCK(cache)   { if ((++cache->has_lock) == 1) LOCK(cache->header->lock); }
+#define CACHE_SAFE_UNLOCK(cache) { if ((--cache->has_lock) == 0) UNLOCK(cache->header->lock); }
+
+#if (RDLOCK_AVAILABLE == 1) && defined(HAVE_ATOMIC_OPERATIONS)
+#define USE_READ_LOCKS 1
+#define CACHE_RDLOCK(cache)        { RDLOCK(cache->header->lock);  cache->has_lock = 0; }
+#define CACHE_RDUNLOCK(cache)      { RDUNLOCK(cache->header->lock);  cache->has_lock = 0; }
+#define CACHE_SAFE_INC(cache, obj) { ATOMIC_INC(obj); }
+#define CACHE_SAFE_DEC(cache, obj) { ATOMIC_DEC(obj); }
+#else
+#define USE_READ_LOCKS 0
+#define CACHE_RDLOCK(cache)        { LOCK(cache->header->lock);  cache->has_lock = 1; }
+#define CACHE_RDUNLOCK(cache)      { UNLOCK(cache->header->lock);  cache->has_lock = 0; }
+#define CACHE_SAFE_INC(cache, obj) { CACHE_SAFE_LOCK(cache); obj++; CACHE_SAFE_UNLOCK(cache);}
+#define CACHE_SAFE_DEC(cache, obj) { CACHE_SAFE_LOCK(cache); obj--; CACHE_SAFE_UNLOCK(cache);}
+#endif
+
+#define CACHE_FAST_INC(cache, obj) { obj++; }
+#define CACHE_FAST_DEC(cache, obj) { obj--; }
+/* }}} */
+
+/* {{{ struct definition: apc_cache_key_t */
+#define T apc_cache_t*
+typedef struct apc_cache_t apc_cache_t; /* opaque cache type */
+
+typedef union _apc_cache_key_data_t {
+    struct {
+        apc_dev_t device;             /* the filesystem device */
+        apc_ino_t inode;              /* the filesystem inode */
+    } file;
+    struct {
+        const char *identifier;
+        int identifier_len;
+    } user;
+    struct {
+        const char *fullpath;
+        int fullpath_len;
+    } fpfile;
+} apc_cache_key_data_t;
+
+typedef struct apc_cache_key_t apc_cache_key_t;
+struct apc_cache_key_t {
+    apc_cache_key_data_t data;
+    unsigned long h;              /* pre-computed hash value */
+    time_t mtime;                 /* the mtime of this cached entry */
+    unsigned char type;
+    unsigned char md5[16];        /* md5 hash of the source file */
+};
+
+
+typedef struct apc_keyid_t apc_keyid_t;
+
+struct apc_keyid_t {
+    unsigned int h;
+    unsigned int keylen;
+    time_t mtime;
+#ifdef ZTS
+    THREAD_T tid;
+#else
+    pid_t pid;
+#endif
+};
+/* }}} */
+
+/* {{{ struct definition: apc_cache_entry_t */
+typedef union _apc_cache_entry_value_t {
+    struct {
+        char *filename;             /* absolute path to source file */
+        zend_op_array* op_array;    /* op_array allocated in shared memory */
+        apc_function_t* functions;  /* array of apc_function_t's */
+        apc_class_t* classes;       /* array of apc_class_t's */
+        long halt_offset;           /* value of __COMPILER_HALT_OFFSET__ for the file */
+        zend_uint *exec_refcount;   /* refcount member of zend_op_array refreshed before execution */
+    } file;
+    struct {
+        char *info;
+        int info_len;
+        zval *val;
+        unsigned int ttl;
+    } user;
+} apc_cache_entry_value_t;
+
+typedef struct apc_cache_entry_t apc_cache_entry_t;
+struct apc_cache_entry_t {
+    apc_cache_entry_value_t data;
+    unsigned char type;
+    int ref_count;
+    size_t mem_size;
+    apc_pool *pool;
+};
+/* }}} */
+
+/*
+ * apc_cache_create creates the shared memory compiler cache. This function
+ * should be called just once (ideally in the web server parent process, e.g.
+ * in apache), otherwise you will end up with multiple caches (which won't
+ * necessarily break anything). Returns a pointer to the cache object.
+ *
+ * size_hint is a "hint" at the total number of source files that will be
+ * cached. It determines the physical size of the hash table. Passing 0 for
+ * this argument will use a reasonable default value.
+ *
+ * gc_ttl is the maximum time a cache entry may speed on the garbage
+ * collection list. This is basically a work around for the inherent
+ * unreliability of our reference counting mechanism (see apc_cache_release).
+ *
+ * ttl is the maximum time a cache entry can idle in a slot in case the slot
+ * is needed.  This helps in cleaning up the cache and ensuring that entries 
+ * hit frequently stay cached and ones not hit very often eventually disappear.
+ */
+extern T apc_cache_create(int size_hint, int gc_ttl, int ttl TSRMLS_DC);
+
+/*
+ * apc_cache_destroy releases any OS resources associated with a cache object.
+ * Under apache, this function can be safely called by the child processes
+ * when they exit.
+ */
+extern void apc_cache_destroy(T cache TSRMLS_DC);
+
+/*
+ * apc_cache_clear empties a cache. This can safely be called at any time,
+ * even while other server processes are executing cached source files.
+ */
+extern void apc_cache_clear(T cache TSRMLS_DC);
+
+/*
+ * apc_cache_insert adds an entry to the cache, using a filename as a key.
+ * Internally, the filename is translated to a canonical representation, so
+ * that relative and absolute filenames will map to a single key. Returns
+ * non-zero if the file was successfully inserted, 0 otherwise. If 0 is
+ * returned, the caller must free the cache entry by calling
+ * apc_cache_free_entry (see below).
+ *
+ * key is the value created by apc_cache_make_file_key for file keys.
+ *
+ * value is a cache entry returned by apc_cache_make_entry (see below).
+ */
+extern int apc_cache_insert(T cache, apc_cache_key_t key,
+                            apc_cache_entry_t* value, apc_context_t* ctxt, time_t t TSRMLS_DC);
+
+extern int apc_cache_user_insert(T cache, apc_cache_key_t key,
+                            apc_cache_entry_t* value, apc_context_t* ctxt, time_t t, int exclusive TSRMLS_DC);
+
+extern int *apc_cache_insert_mult(apc_cache_t* cache, apc_cache_key_t* keys,
+                            apc_cache_entry_t** values, apc_context_t *ctxt, time_t t, int num_entries TSRMLS_DC);
+
+/*
+ * apc_cache_find searches for a cache entry by filename, and returns a
+ * pointer to the entry if found, NULL otherwise.
+ *
+ * key is a value created by apc_cache_make_file_key for file keys.
+ */
+extern apc_cache_entry_t* apc_cache_find(T cache, apc_cache_key_t key, time_t t TSRMLS_DC);
+
+/*
+ * apc_cache_user_find searches for a cache entry by its hashed identifier,
+ * and returns a pointer to the entry if found, NULL otherwise.
+ *
+ */
+extern apc_cache_entry_t* apc_cache_user_find(T cache, char* strkey, int keylen, time_t t TSRMLS_DC);
+
+/*
+ * apc_cache_user_exists searches for a cache entry by its hashed identifier,
+ * and returns a pointer to the entry if found, NULL otherwise.  This is a
+ * quick non-locking version of apc_cache_user_find that does not modify the
+ * shared memory segment in any way.
+ *
+ */
+extern apc_cache_entry_t* apc_cache_user_exists(T cache, char* strkey, int keylen, time_t t TSRMLS_DC);
+
+/*
+ * apc_cache_delete and apc_cache_user_delete finds an entry in the cache and deletes it.
+ */
+extern int apc_cache_delete(apc_cache_t* cache, char *filename, int filename_len TSRMLS_DC);
+extern int apc_cache_user_delete(apc_cache_t* cache, char *strkey, int keylen TSRMLS_DC);
+
+/* apc_cach_fetch_zval takes a zval in the cache and reconstructs a runtime
+ * zval from it.
+ *
+ */
+zval* apc_cache_fetch_zval(zval* dst, const zval* src, apc_context_t* ctxt TSRMLS_DC);
+
+/*
+ * apc_cache_release decrements the reference count associated with a cache
+ * entry. Calling apc_cache_find automatically increments the reference count,
+ * and this function must be called post-execution to return the count to its
+ * original value. Failing to do so will prevent the entry from being
+ * garbage-collected.
+ *
+ * entry is the cache entry whose ref count you want to decrement.
+ */
+extern void apc_cache_release(T cache, apc_cache_entry_t* entry TSRMLS_DC);
+
+/*
+ * apc_cache_make_file_key creates a key object given a relative or absolute
+ * filename and an optional list of auxillary paths to search. include_path is
+ * searched if the filename cannot be found relative to the current working
+ * directory.
+ *
+ * key points to caller-allocated storage (must not be null).
+ *
+ * filename is the path to the source file.
+ *
+ * include_path is a colon-separated list of directories to search.
+ *
+ * and finally we pass in the current request time so we can avoid
+ * caching files with a current mtime which tends to indicate that
+ * they are still being written to.
+ */
+extern int apc_cache_make_file_key(apc_cache_key_t* key,
+                                   const char* filename,
+                                   const char* include_path,
+                                   time_t t
+                                   TSRMLS_DC);
+
+/*
+ * apc_cache_make_file_entry creates an apc_cache_entry_t object given a filename
+ * and the compilation results returned by the PHP compiler.
+ */
+extern apc_cache_entry_t* apc_cache_make_file_entry(const char* filename,
+                                                    zend_op_array* op_array,
+                                                    apc_function_t* functions,
+                                                    apc_class_t* classes,
+                                                    apc_context_t* ctxt
+                                                    TSRMLS_DC);
+
+
+zend_bool apc_compile_cache_entry(apc_cache_key_t *key, zend_file_handle* h, int type, time_t t, zend_op_array** op_array_pp, apc_cache_entry_t** cache_entry_pp TSRMLS_DC);
+
+/*
+ * apc_cache_make_user_entry creates an apc_cache_entry_t object given an info string
+ * and the zval to be stored.
+ */
+extern apc_cache_entry_t* apc_cache_make_user_entry(const char* info, int info_len, const zval *val, apc_context_t* ctxt, const unsigned int ttl TSRMLS_DC);
+
+extern int apc_cache_make_user_key(apc_cache_key_t* key, char* identifier, int identifier_len, const time_t t);
+
+/* {{{ struct definition: slot_t */
+typedef struct slot_t slot_t;
+struct slot_t {
+    apc_cache_key_t key;        /* slot key */
+    apc_cache_entry_t* value;   /* slot value */
+    slot_t* next;               /* next slot in linked list */
+    unsigned long num_hits;     /* number of hits to this bucket */
+    time_t creation_time;       /* time slot was initialized */
+    time_t deletion_time;       /* time slot was removed from cache */
+    time_t access_time;         /* time slot was last accessed */
+};
+/* }}} */
+
+/* {{{ struct definition: cache_header_t
+   Any values that must be shared among processes should go in here. */
+typedef struct cache_header_t cache_header_t;
+struct cache_header_t {
+    apc_lck_t lock;             /* read/write lock (exclusive blocking cache lock) */
+    apc_lck_t wrlock;           /* write lock (non-blocking used to prevent cache slams) */
+    unsigned long num_hits;     /* total successful hits in cache */
+    unsigned long num_misses;   /* total unsuccessful hits in cache */
+    unsigned long num_inserts;  /* total successful inserts in cache */
+    unsigned long expunges;     /* total number of expunges */
+    slot_t* deleted_list;       /* linked list of to-be-deleted slots */
+    time_t start_time;          /* time the above counters were reset */
+    zend_bool busy;             /* Flag to tell clients when we are busy cleaning the cache */
+    int num_entries;            /* Statistic on the number of entries */
+    size_t mem_size;            /* Statistic on the memory size used by this cache */
+    apc_keyid_t lastkey;        /* the key that is being inserted (user cache) */
+};
+/* }}} */
+
+typedef void (*apc_expunge_cb_t)(T cache, size_t n TSRMLS_DC); 
+
+/* {{{ struct definition: apc_cache_t */
+struct apc_cache_t {
+    void* shmaddr;                /* process (local) address of shared cache */
+    cache_header_t* header;       /* cache header (stored in SHM) */
+    slot_t** slots;               /* array of cache slots (stored in SHM) */
+    int num_slots;                /* number of slots in cache */
+    int gc_ttl;                   /* maximum time on GC list for a slot */
+    int ttl;                      /* if slot is needed and entry's access time is older than this ttl, remove it */
+    apc_expunge_cb_t expunge_cb;  /* cache specific expunge callback to free up sma memory */
+    uint has_lock;                /* flag for possible recursive locks within the same process */
+};
+/* }}} */
+
+extern zval* apc_cache_info(T cache, zend_bool limited TSRMLS_DC);
+extern void apc_cache_unlock(apc_cache_t* cache TSRMLS_DC);
+extern zend_bool apc_cache_busy(apc_cache_t* cache);
+extern zend_bool apc_cache_write_lock(apc_cache_t* cache TSRMLS_DC);
+extern void apc_cache_write_unlock(apc_cache_t* cache TSRMLS_DC);
+extern zend_bool apc_cache_is_last_key(apc_cache_t* cache, apc_cache_key_t* key, time_t t TSRMLS_DC);
+
+/* used by apc_rfc1867 to update data in-place - not to be used elsewhere */
+
+typedef int (*apc_cache_updater_t)(apc_cache_t*, apc_cache_entry_t*, void* data);
+extern int _apc_cache_user_update(apc_cache_t* cache, char *strkey, int keylen,
+                                    apc_cache_updater_t updater, void* data TSRMLS_DC);
+
+
+#undef T
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_compile.c php-5.4.19.bak/ext/apc/apc_compile.c
--- php-5.4.19/ext/apc/apc_compile.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_compile.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,2483 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt.                                 |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_compile.c 327148 2012-08-16 14:11:18Z laruence $ */
+
+#include "apc_compile.h"
+#include "apc_globals.h"
+#include "apc_zend.h"
+#include "apc_php.h"
+#include "apc_string.h"
+#include "ext/standard/php_var.h"
+#include "ext/standard/php_smart_str.h"
+
+typedef void* (*ht_copy_fun_t)(void*, void*, apc_context_t* TSRMLS_DC);
+//typedef void  (*ht_free_fun_t)(void*, apc_context_t*);
+typedef int (*ht_check_copy_fun_t)(Bucket*, va_list);
+
+typedef void (*ht_fixup_fun_t)(Bucket*, zend_class_entry*, zend_class_entry*);
+
+#define CHECK(p) { if ((p) == NULL) return NULL; }
+
+enum {
+    APC_FREE_HASHTABLE_FUNCS,
+    APC_FREE_HASHTABLE_PROPS,
+    APC_FREE_HASHTABLE_STATIC_PROPS,
+};
+
+/* {{{ internal function declarations */
+
+static zend_function* my_bitwise_copy_function(zend_function*, zend_function*, apc_context_t* TSRMLS_DC);
+
+/*
+ * The "copy" functions perform deep-copies on a particular data structure
+ * (passed as the second argument). They also optionally allocate space for
+ * the destination data structure if the first argument is null.
+ */
+static zval** my_copy_zval_ptr(zval**, const zval**, apc_context_t* TSRMLS_DC);
+static zval* my_copy_zval(zval*, const zval*, apc_context_t* TSRMLS_DC);
+#ifndef ZEND_ENGINE_2_4
+static znode* my_copy_znode(znode*, znode*, apc_context_t* TSRMLS_DC);
+#endif
+static zend_op* my_copy_zend_op(zend_op*, zend_op*, apc_context_t* TSRMLS_DC);
+static zend_function* my_copy_function(zend_function*, zend_function*, apc_context_t* TSRMLS_DC);
+static zend_function_entry* my_copy_function_entry(zend_function_entry*, const zend_function_entry*, apc_context_t* TSRMLS_DC);
+static zend_class_entry* my_copy_class_entry(zend_class_entry*, zend_class_entry*, apc_context_t* TSRMLS_DC);
+static HashTable* my_copy_hashtable_ex(HashTable*, HashTable* TSRMLS_DC, ht_copy_fun_t, int, apc_context_t*, ht_check_copy_fun_t, ...);
+#define my_copy_hashtable( dst, src, copy_fn, holds_ptr, ctxt) \
+    my_copy_hashtable_ex(dst, src TSRMLS_CC, copy_fn, holds_ptr, ctxt, NULL)
+static HashTable* my_copy_static_variables(zend_op_array* src, apc_context_t* TSRMLS_DC);
+static zend_property_info* my_copy_property_info(zend_property_info* dst, zend_property_info* src, apc_context_t* TSRMLS_DC);
+static zend_arg_info* my_copy_arg_info_array(zend_arg_info*, const zend_arg_info*, uint, apc_context_t* TSRMLS_DC);
+static zend_arg_info* my_copy_arg_info(zend_arg_info*, const zend_arg_info*, apc_context_t* TSRMLS_DC);
+
+/*
+ * The "fixup" functions need for ZEND_ENGINE_2
+ */
+static void my_fixup_function( Bucket *p, zend_class_entry *src, zend_class_entry *dst );
+static void my_fixup_hashtable( HashTable *ht, ht_fixup_fun_t fixup, zend_class_entry *src, zend_class_entry *dst );
+/* my_fixup_function_for_execution is the same as my_fixup_function
+ * but named differently for clarity
+ */
+#define my_fixup_function_for_execution my_fixup_function
+
+#ifdef ZEND_ENGINE_2_2
+static void my_fixup_property_info( Bucket *p, zend_class_entry *src, zend_class_entry *dst );
+#define my_fixup_property_info_for_execution my_fixup_property_info
+#endif
+
+/*
+ * These functions return "1" if the member/function is
+ * defined/overridden in the 'current' class and not inherited.
+ */
+static int my_check_copy_function(Bucket* src, va_list args);
+static int my_check_copy_property_info(Bucket* src, va_list args);
+#ifndef ZEND_ENGINE_2_4
+static int my_check_copy_default_property(Bucket* p, va_list args);
+static int my_check_copy_static_member(Bucket* src, va_list args);
+#endif
+static int my_check_copy_constant(Bucket* src, va_list args);
+
+/* }}} */
+
+/* {{{ apc php serializers */
+int APC_SERIALIZER_NAME(php) (APC_SERIALIZER_ARGS) 
+{
+    smart_str strbuf = {0};
+    php_serialize_data_t var_hash;
+    PHP_VAR_SERIALIZE_INIT(var_hash);
+    php_var_serialize(&strbuf, (zval**)&value, &var_hash TSRMLS_CC);
+    PHP_VAR_SERIALIZE_DESTROY(var_hash);
+    if(strbuf.c) {
+        *buf = (unsigned char*)strbuf.c;
+        *buf_len = strbuf.len;
+        smart_str_0(&strbuf);
+        return 1; 
+    }
+    return 0;
+}
+
+int APC_UNSERIALIZER_NAME(php) (APC_UNSERIALIZER_ARGS) 
+{
+    const unsigned char *tmp = buf;
+    php_unserialize_data_t var_hash;
+    PHP_VAR_UNSERIALIZE_INIT(var_hash);
+    if(!php_var_unserialize(value, &tmp, buf + buf_len, &var_hash TSRMLS_CC)) {
+        PHP_VAR_UNSERIALIZE_DESTROY(var_hash);
+        zval_dtor(*value);
+        php_error_docref(NULL TSRMLS_CC, E_NOTICE, "Error at offset %ld of %ld bytes", (long)(tmp - buf), (long)buf_len);
+        (*value)->type = IS_NULL;
+        return 0;
+    }
+    PHP_VAR_UNSERIALIZE_DESTROY(var_hash);
+    return 1;
+}
+/* }}} */
+
+/* {{{ check_op_array_integrity */
+#if 0
+static void check_op_array_integrity(zend_op_array* src)
+{
+    int i, j;
+
+    /* These sorts of checks really aren't particularly effective, but they
+     * can provide a welcome sanity check when debugging. Just don't enable
+     * for production use!  */
+
+    assert(src->refcount != NULL);
+    assert(src->opcodes != NULL);
+    assert(src->last > 0);
+
+    for (i = 0; i < src->last; i++) {
+        zend_op* op = &src->opcodes[i];
+        znode* nodes[] = { &op->result, &op->op1, &op->op2 };
+        for (j = 0; j < 3; j++) {
+            assert(nodes[j]->op_type == IS_CONST ||
+                   nodes[j]->op_type == IS_VAR ||
+                   nodes[j]->op_type == IS_TMP_VAR ||
+                   nodes[j]->op_type == IS_UNUSED);
+
+            if (nodes[j]->op_type == IS_CONST) {
+                int type = nodes[j]->u.constant.type;
+                assert(type == IS_RESOURCE ||
+                       type == IS_BOOL ||
+                       type == IS_LONG ||
+                       type == IS_DOUBLE ||
+                       type == IS_NULL ||
+                       type == IS_CONSTANT ||
+                       type == IS_STRING ||
+                       type == FLAG_IS_BC ||
+                       type == IS_ARRAY ||
+                       type == IS_CONSTANT_ARRAY ||
+                       type == IS_OBJECT);
+            }
+        }
+    }
+}
+#endif
+/* }}} */
+
+/* {{{ my_bitwise_copy_function */
+static zend_function* my_bitwise_copy_function(zend_function* dst, zend_function* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    apc_pool* pool = ctxt->pool;
+
+    assert(src != NULL);
+
+    if (!dst) {
+        CHECK(dst = (zend_function*) apc_pool_alloc(pool, sizeof(src[0])));
+    }
+
+    /* We only need to do a bitwise copy */
+    memcpy(dst, src, sizeof(src[0]));
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_copy_zval_ptr */
+static zval** my_copy_zval_ptr(zval** dst, const zval** src, apc_context_t* ctxt TSRMLS_DC)
+{
+    zval* dst_new;
+    apc_pool* pool = ctxt->pool;
+    int usegc = (ctxt->copy == APC_COPY_OUT_OPCODE) || (ctxt->copy == APC_COPY_OUT_USER);
+
+    assert(src != NULL);
+
+    if (!dst) {
+        CHECK(dst = (zval**) apc_pool_alloc(pool, sizeof(zval*)));
+    }
+
+    if(usegc) {
+        ALLOC_ZVAL(dst[0]);
+        CHECK(dst[0]);
+    } else {
+        CHECK((dst[0] = (zval*) apc_pool_alloc(pool, sizeof(zval))));
+    }
+
+    CHECK((dst_new = my_copy_zval(*dst, *src, ctxt TSRMLS_CC)));
+
+    if(dst_new != *dst) {
+        if(usegc) {
+            FREE_ZVAL(dst[0]);
+        }
+        *dst = dst_new;
+    }
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_serialize_object */
+static zval* my_serialize_object(zval* dst, const zval* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    smart_str buf = {0};
+    apc_pool* pool = ctxt->pool;
+    apc_serialize_t serialize = APC_SERIALIZER_NAME(php);
+    void *config = NULL;
+
+    if(APCG(serializer)) { /* TODO: move to ctxt */
+        serialize = APCG(serializer)->serialize;
+        config = APCG(serializer)->config;
+    }
+
+    if(serialize((unsigned char**)&buf.c, &buf.len, src, config TSRMLS_CC)) {
+        dst->type = src->type & ~IS_CONSTANT_INDEX; 
+        dst->value.str.len = buf.len;
+        CHECK(dst->value.str.val = apc_pmemcpy(buf.c, (buf.len + 1), pool TSRMLS_CC));
+    }
+
+    if(buf.c) smart_str_free(&buf);
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_unserialize_object */
+static zval* my_unserialize_object(zval* dst, const zval* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    apc_unserialize_t unserialize = APC_UNSERIALIZER_NAME(php);
+    unsigned char *p = (unsigned char*)Z_STRVAL_P(src);
+    void *config = NULL;
+
+    if(APCG(serializer)) { /* TODO: move to ctxt */
+        unserialize = APCG(serializer)->unserialize;
+        config = APCG(serializer)->config;
+    }
+
+    if(unserialize(&dst, p, Z_STRLEN_P(src), config TSRMLS_CC)) {
+        return dst;
+    } else {
+        zval_dtor(dst);
+        dst->type = IS_NULL;
+    }
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_string_pmemcpy */
+static char *apc_string_pmemcpy(char *str, size_t len, apc_pool* pool TSRMLS_DC)
+{	
+#ifdef ZEND_ENGINE_2_4
+#ifndef ZTS
+    if (pool->type != APC_UNPOOL) {
+        char * ret = (char*)apc_new_interned_string((const char*)str, len TSRMLS_CC);
+        if (ret) {
+            return ret;
+        }
+    }
+#endif
+#endif
+    return apc_pmemcpy(str, len, pool TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ my_copy_zval */
+static APC_HOTSPOT zval* my_copy_zval(zval* dst, const zval* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    zval **tmp;
+    apc_pool* pool = ctxt->pool;
+
+    assert(dst != NULL);
+    assert(src != NULL);
+
+    memcpy(dst, src, sizeof(src[0]));
+
+    if(APCG(copied_zvals).nTableSize) {
+        if(zend_hash_index_find(&APCG(copied_zvals), (ulong)src, (void**)&tmp) == SUCCESS) {
+            if(Z_ISREF_P((zval*)src)) {
+                Z_SET_ISREF_PP(tmp);
+            }
+            Z_ADDREF_PP(tmp);
+            return *tmp;
+        }
+
+        zend_hash_index_update(&APCG(copied_zvals), (ulong)src, (void**)&dst, sizeof(zval*), NULL);
+    }
+
+
+    if(ctxt->copy == APC_COPY_OUT_USER || ctxt->copy == APC_COPY_IN_USER) {
+        /* deep copies are refcount(1), but moved up for recursive 
+         * arrays,  which end up being add_ref'd during its copy. */
+        Z_SET_REFCOUNT_P(dst, 1);
+        Z_UNSET_ISREF_P(dst);
+    } else {
+        /* code uses refcount=2 for consts */
+        Z_SET_REFCOUNT_P(dst, Z_REFCOUNT_P((zval*)src));
+        Z_SET_ISREF_TO_P(dst, Z_ISREF_P((zval*)src));
+    }
+
+    switch (src->type & IS_CONSTANT_TYPE_MASK) {
+    case IS_RESOURCE:
+    case IS_BOOL:
+    case IS_LONG:
+    case IS_DOUBLE:
+    case IS_NULL:
+        break;
+
+    case IS_CONSTANT:
+    case IS_STRING:
+        if (src->value.str.val) {
+            CHECK(dst->value.str.val = apc_string_pmemcpy(src->value.str.val,
+                                                   src->value.str.len+1,
+                                                   pool TSRMLS_CC));
+        }
+        break;
+
+    case IS_ARRAY:
+    case IS_CONSTANT_ARRAY:
+        if(APCG(serializer) == NULL ||
+            ctxt->copy == APC_COPY_IN_OPCODE || ctxt->copy == APC_COPY_OUT_OPCODE) {
+
+            CHECK(dst->value.ht =
+                my_copy_hashtable(NULL,
+                                  src->value.ht,
+                                  (ht_copy_fun_t) my_copy_zval_ptr,
+                                  1,
+                                  ctxt));
+            break;
+        } else {
+            /* fall through to object case */
+        }
+
+    case IS_OBJECT:
+    
+        dst->type = IS_NULL;
+        if(ctxt->copy == APC_COPY_IN_USER) {
+            dst = my_serialize_object(dst, src, ctxt TSRMLS_CC);
+        } else if(ctxt->copy == APC_COPY_OUT_USER) {
+            dst = my_unserialize_object(dst, src, ctxt TSRMLS_CC);
+        }
+        break;
+#ifdef ZEND_ENGINE_2_4
+    case IS_CALLABLE:
+        /* XXX implement this */
+        assert(0);
+        break;
+#endif
+
+    default:
+        assert(0);
+    }
+
+    return dst;
+}
+/* }}} */
+
+#ifdef ZEND_ENGINE_2_4
+/* {{{ my_copy_znode */
+static void my_check_znode(zend_uchar op_type, apc_context_t* ctxt TSRMLS_DC)
+{
+    assert(op_type == IS_CONST ||
+           op_type == IS_VAR ||
+           op_type == IS_CV ||
+           op_type == IS_TMP_VAR ||
+           op_type == IS_UNUSED);
+}
+/* }}} */
+
+/* {{{ my_copy_zend_op */
+static zend_op* my_copy_zend_op(zend_op* dst, zend_op* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    assert(dst != NULL);
+    assert(src != NULL);
+
+    memcpy(dst, src, sizeof(src[0]));
+
+    my_check_znode(dst->result_type & ~EXT_TYPE_UNUSED, ctxt TSRMLS_CC);
+    my_check_znode(dst->op1_type, ctxt TSRMLS_CC);
+
+    /* ZEND_BIND_TRAITS opcode don't set the op2 at all, so ommit its check */
+    if (dst->opcode != ZEND_BIND_TRAITS) {
+        my_check_znode(dst->op2_type, ctxt TSRMLS_CC);
+    }
+
+    return dst;
+}
+/* }}} */
+#else
+/* {{{ my_copy_znode */
+static znode* my_copy_znode(znode* dst, znode* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    assert(dst != NULL);
+    assert(src != NULL);
+
+    memcpy(dst, src, sizeof(src[0]));
+
+#ifdef IS_CV
+    assert(dst ->op_type == IS_CONST ||
+           dst ->op_type == IS_VAR ||
+           dst ->op_type == IS_CV ||
+           dst ->op_type == IS_TMP_VAR ||
+           dst ->op_type == IS_UNUSED);
+#else
+    assert(dst ->op_type == IS_CONST ||
+           dst ->op_type == IS_VAR ||
+           dst ->op_type == IS_TMP_VAR ||
+           dst ->op_type == IS_UNUSED);
+#endif
+
+    if (src->op_type == IS_CONST) {
+        if(!my_copy_zval(&dst->u.constant, &src->u.constant, ctxt TSRMLS_CC)) {
+            return NULL;
+        }
+    }
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_copy_zend_op */
+static zend_op* my_copy_zend_op(zend_op* dst, zend_op* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    assert(dst != NULL);
+    assert(src != NULL);
+
+    memcpy(dst, src, sizeof(src[0]));
+
+    CHECK(my_copy_znode(&dst->result, &src->result, ctxt TSRMLS_CC));
+    CHECK(my_copy_znode(&dst->op1, &src->op1, ctxt TSRMLS_CC));
+    CHECK(my_copy_znode(&dst->op2, &src->op2, ctxt TSRMLS_CC));
+
+    return dst;
+}
+/* }}} */
+#endif
+
+/* {{{ my_copy_function */
+static zend_function* my_copy_function(zend_function* dst, zend_function* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    assert(src != NULL);
+
+    CHECK(dst = my_bitwise_copy_function(dst, src, ctxt TSRMLS_CC));
+
+    switch (src->type) {
+    case ZEND_INTERNAL_FUNCTION:
+    case ZEND_OVERLOADED_FUNCTION:
+        /* shallow copy because op_array is internal */
+        dst->op_array = src->op_array;
+        break;
+
+    case ZEND_USER_FUNCTION:
+    case ZEND_EVAL_CODE:
+        CHECK(apc_copy_op_array(&dst->op_array,
+                                &src->op_array,
+                                ctxt TSRMLS_CC));
+        break;
+
+    default:
+        assert(0);
+    }
+    /*
+     * op_array bitwise copying overwrites what ever you modified
+     * before apc_copy_op_array - which is why this code is outside 
+     * my_bitwise_copy_function.
+     */
+
+    /* zend_do_inheritance will re-look this up, because the pointers
+     * in prototype are from a function table of another class. It just
+     * helps if that one is from EG(class_table).
+     */
+    dst->common.prototype = NULL;
+
+    /* once a method is marked as ZEND_ACC_IMPLEMENTED_ABSTRACT then you
+     * have to carry around a prototype. Thankfully zend_do_inheritance
+     * sets this properly as well
+     */
+    dst->common.fn_flags = src->common.fn_flags & (~ZEND_ACC_IMPLEMENTED_ABSTRACT);
+
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_copy_function_entry */
+static zend_function_entry* my_copy_function_entry(zend_function_entry* dst, const zend_function_entry* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    assert(src != NULL);
+
+    if (!dst) {
+        CHECK(dst = (zend_function_entry*) apc_pool_alloc(ctxt->pool, sizeof(src[0])));
+    }
+
+    /* Start with a bitwise copy */
+    memcpy(dst, src, sizeof(src[0]));
+
+    dst->fname = NULL;
+    dst->arg_info = NULL;
+
+    if (src->fname) {
+        CHECK((dst->fname = apc_pstrdup(src->fname, ctxt->pool TSRMLS_CC)));
+    }
+
+    if (src->arg_info) {
+        CHECK((dst->arg_info = my_copy_arg_info_array(NULL,
+                                                src->arg_info,
+                                                src->num_args,
+                                                ctxt TSRMLS_CC)));
+    }
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_copy_property_info */
+static zend_property_info* my_copy_property_info(zend_property_info* dst, zend_property_info* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    apc_pool* pool = ctxt->pool;
+
+    assert(src != NULL);
+
+    if (!dst) {
+        CHECK(dst = (zend_property_info*) apc_pool_alloc(pool, sizeof(*src)));
+    }
+
+    /* Start with a bitwise copy */
+    memcpy(dst, src, sizeof(*src));
+
+    dst->name = NULL;
+#if defined(ZEND_ENGINE_2) && PHP_MINOR_VERSION > 0
+    dst->doc_comment = NULL;
+#endif
+
+    if (src->name) {
+        /* private members are stored inside property_info as a mangled
+         * string of the form:
+         *      \0<classname>\0<membername>\0
+         */
+        CHECK((dst->name = apc_string_pmemcpy((char *)src->name, src->name_length+1, pool TSRMLS_CC)));
+    }
+
+#if defined(ZEND_ENGINE_2) && PHP_MINOR_VERSION > 0
+    if (src->doc_comment) {
+        CHECK((dst->doc_comment = apc_pmemcpy(src->doc_comment, (src->doc_comment_len + 1), pool TSRMLS_CC)));
+    }
+#endif
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_copy_property_info_for_execution */
+static zend_property_info* my_copy_property_info_for_execution(zend_property_info* dst, zend_property_info* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    assert(src != NULL);
+
+    if (!dst) {
+        CHECK(dst = (zend_property_info*) apc_pool_alloc(ctxt->pool, sizeof(*src)));
+    }
+
+    /* We need only a shallow copy */
+    memcpy(dst, src, sizeof(*src));
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_copy_arg_info_array */
+static zend_arg_info* my_copy_arg_info_array(zend_arg_info* dst, const zend_arg_info* src, uint num_args, apc_context_t* ctxt TSRMLS_DC)
+{
+    uint i = 0;
+
+
+    if (!dst) {
+        CHECK(dst = (zend_arg_info*) apc_pool_alloc(ctxt->pool, (sizeof(*src) * num_args)));
+    }
+
+    /* Start with a bitwise copy */
+    memcpy(dst, src, sizeof(*src)*num_args);
+
+    for(i=0; i < num_args; i++) {
+        CHECK((my_copy_arg_info( &dst[i], &src[i], ctxt TSRMLS_CC)));
+    }
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_copy_arg_info */
+static zend_arg_info* my_copy_arg_info(zend_arg_info* dst, const zend_arg_info* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    apc_pool* pool = ctxt->pool;
+
+    assert(src != NULL);
+
+    if (!dst) {
+        CHECK(dst = (zend_arg_info*) apc_pool_alloc(pool, sizeof(*src)));
+    }
+
+    /* Start with a bitwise copy */
+    memcpy(dst, src, sizeof(*src));
+
+    dst->name = NULL;
+    dst->class_name = NULL;
+
+    if (src->name) {
+        CHECK((dst->name = apc_string_pmemcpy((char *) src->name, src->name_len+1, pool TSRMLS_CC)));
+    }
+
+    if (src->class_name) {
+        CHECK((dst->class_name = apc_string_pmemcpy((char *) src->class_name, src->class_name_len+1, pool TSRMLS_CC)));
+    }
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_copy_class_entry */
+zend_class_entry* apc_copy_class_entry(zend_class_entry* dst, zend_class_entry* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    return my_copy_class_entry(dst, src, ctxt TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ my_copy_class_entry */
+static zend_class_entry* my_copy_class_entry(zend_class_entry* dst, zend_class_entry* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    int i = 0;
+    apc_pool* pool = ctxt->pool;
+
+    assert(src != NULL);
+
+    if (!dst) {
+        CHECK(dst = (zend_class_entry*) apc_pool_alloc(pool, sizeof(*src)));
+    }
+
+    /* Start with a bitwise copy */
+    memcpy(dst, src, sizeof(*src));
+
+    dst->name = NULL;
+    memset(&dst->function_table, 0, sizeof(dst->function_table));
+    ZEND_CE_DOC_COMMENT(dst) = NULL;
+    ZEND_CE_FILENAME(dst) = NULL;
+    memset(&dst->properties_info, 0, sizeof(dst->properties_info));
+    memset(&dst->constants_table, 0, sizeof(dst->constants_table));
+
+    if (src->name) {
+        CHECK((dst->name = apc_pstrdup(src->name, pool TSRMLS_CC)));
+    }
+
+    if(!(my_copy_hashtable_ex(&dst->function_table,
+                            &src->function_table TSRMLS_CC,
+                            (ht_copy_fun_t) my_copy_function,
+                            0,
+                            ctxt,
+                            (ht_check_copy_fun_t) my_check_copy_function,
+                            src))) {
+        return NULL;
+    }
+
+    /* the interfaces are populated at runtime using ADD_INTERFACE */
+    dst->interfaces = NULL; 
+
+    /* the current count includes inherited interfaces as well,
+       the real dynamic ones are the first <n> which are zero'd
+       out in zend_do_end_class_declaration */
+    for(i = 0 ; (uint)i < src->num_interfaces ; i++) {
+        if(src->interfaces[i])
+        {
+            dst->num_interfaces = i;
+            break;
+        }
+    }
+
+    /* these will either be set inside my_fixup_hashtable or 
+     * they will be copied out from parent inside zend_do_inheritance 
+     */
+    dst->parent = NULL;
+    dst->constructor =  NULL;
+    dst->destructor = NULL;
+    dst->clone = NULL;
+    dst->__get = NULL;
+    dst->__set = NULL;
+    dst->__unset = NULL;
+    dst->__isset = NULL;
+    dst->__call = NULL;
+#ifdef ZEND_ENGINE_2_2
+    dst->__tostring = NULL;
+#endif
+#ifdef ZEND_ENGINE_2_3
+	dst->__callstatic = NULL;
+#endif
+
+#ifdef ZEND_ENGINE_2_4
+    if (src->trait_aliases) {
+        int num_trait_aliases = 0;
+
+        /* get how much trait aliases we've got */
+        while (src->trait_aliases[num_trait_aliases]) {num_trait_aliases++;}
+
+        /* copy all the trait aliases */
+        CHECK(dst->trait_aliases =
+                (zend_trait_alias **) apc_pool_alloc(pool, sizeof(zend_trait_alias *)*(num_trait_aliases+1)));
+
+        i = 0;
+        while (src->trait_aliases[i] && i < num_trait_aliases) {
+            dst->trait_aliases[i] = apc_copy_trait_alias(NULL, src->trait_aliases[i], ctxt TSRMLS_CC);
+            i++;
+        }
+        dst->trait_aliases[i] = NULL;
+    }
+    if (src->trait_precedences) {
+        int num_trait_precedences = 0;
+
+        /* get how much trait precedences we've got */
+        while (src->trait_precedences[num_trait_precedences]) {num_trait_precedences++;}
+
+        /* copy all the trait precedences */
+        CHECK(dst->trait_precedences =
+                (zend_trait_alias **) apc_pool_alloc(pool, sizeof(zend_trait_alias *)*(num_trait_precedences+1)));
+
+        i = 0;
+        while (src->trait_precedences[i] && i < num_trait_precedences) {
+            dst->trait_precedences[i] = apc_copy_trait_precedence(NULL, src->trait_precedences[i], ctxt TSRMLS_CC);
+            i++;
+        }
+        dst->trait_precedences[i] = NULL;
+    }
+#endif
+
+    /* unset function proxies */
+    dst->serialize_func = NULL;
+    dst->unserialize_func = NULL;
+
+    my_fixup_hashtable(&dst->function_table, (ht_fixup_fun_t)my_fixup_function, src, dst);
+
+#ifdef ZEND_ENGINE_2_4
+	dst->default_properties_count = src->default_properties_count;
+    if (src->default_properties_count) {
+        CHECK(dst->default_properties_table = (zval**) apc_pool_alloc(pool, (sizeof(zval*) * src->default_properties_count)));
+        for (i = 0; i < src->default_properties_count; i++) {
+            if (src->default_properties_table[i]) {
+                my_copy_zval_ptr(&dst->default_properties_table[i], (const zval**)&src->default_properties_table[i], ctxt TSRMLS_CC);
+            } else {
+                dst->default_properties_table[i] = NULL;
+            }
+        }
+    } else {
+        dst->default_properties_table = NULL;
+    }
+#else
+    memset(&dst->default_properties, 0, sizeof(dst->default_properties));
+    CHECK((my_copy_hashtable_ex(&dst->default_properties,
+                            &src->default_properties TSRMLS_CC,
+                            (ht_copy_fun_t) my_copy_zval_ptr,
+                            1,
+                            ctxt,
+                            (ht_check_copy_fun_t) my_check_copy_default_property,
+                            src)));
+#endif
+
+    CHECK((my_copy_hashtable_ex(&dst->properties_info,
+                            &src->properties_info TSRMLS_CC,
+                            (ht_copy_fun_t) my_copy_property_info,
+                            0,
+                            ctxt,
+                            (ht_check_copy_fun_t) my_check_copy_property_info,
+                            src)));
+
+#ifdef ZEND_ENGINE_2_2
+    /* php5.2 introduced a scope attribute for property info */
+    my_fixup_hashtable(&dst->properties_info, (ht_fixup_fun_t)my_fixup_property_info_for_execution, src, dst);
+#endif
+
+#ifdef ZEND_ENGINE_2_4
+    dst->default_static_members_count = src->default_static_members_count;
+
+    if (src->default_static_members_count) {
+        CHECK(dst->default_static_members_table = (zval**) apc_pool_alloc(pool, (sizeof(zval*) * src->default_static_members_count)));
+        for (i = 0; i < src->default_static_members_count; i++) {
+            if (src->default_static_members_table[i]) {
+                my_copy_zval_ptr(&dst->default_static_members_table[i], (const zval**)&src->default_static_members_table[i], ctxt TSRMLS_CC);
+            } else {
+                dst->default_static_members_table[i] = NULL;
+            }
+        }
+    } else {
+        dst->default_static_members_table = NULL;
+    }
+    dst->static_members_table = dst->default_static_members_table;
+#else
+    memset(&dst->default_static_members, 0, sizeof(dst->default_static_members));
+    dst->static_members = NULL;
+    CHECK(my_copy_hashtable_ex(&dst->default_static_members,
+                            &src->default_static_members TSRMLS_CC,
+                            (ht_copy_fun_t) my_copy_zval_ptr,
+                            1,
+                            ctxt,
+                            (ht_check_copy_fun_t) my_check_copy_static_member,
+                            src,
+                            &src->default_static_members));
+
+    if(src->static_members != &src->default_static_members)
+    {
+        CHECK((dst->static_members = my_copy_hashtable_ex(NULL,
+                            src->static_members TSRMLS_CC,
+                            (ht_copy_fun_t) my_copy_zval_ptr,
+                            1,
+                            ctxt,
+                            (ht_check_copy_fun_t) my_check_copy_static_member,
+                            src,
+                            src->static_members)));
+    }
+    else
+    {
+        dst->static_members = &dst->default_static_members;
+    }
+#endif
+
+    CHECK((my_copy_hashtable_ex(&dst->constants_table,
+                            &src->constants_table TSRMLS_CC,
+                            (ht_copy_fun_t) my_copy_zval_ptr,
+                            1,
+                            ctxt,
+                            (ht_check_copy_fun_t) my_check_copy_constant,
+                            src)));
+
+    if (src->type == ZEND_USER_CLASS && ZEND_CE_DOC_COMMENT(src)) {
+        CHECK(ZEND_CE_DOC_COMMENT(dst) =
+                    apc_pmemcpy(ZEND_CE_DOC_COMMENT(src), (ZEND_CE_DOC_COMMENT_LEN(src) + 1), pool TSRMLS_CC));
+    }
+
+    if (src->type == ZEND_INTERNAL_CLASS && ZEND_CE_BUILTIN_FUNCTIONS(src)) {
+        int n;
+
+        for (n = 0; src->type == ZEND_INTERNAL_CLASS && ZEND_CE_BUILTIN_FUNCTIONS(src)[n].fname != NULL; n++) {}
+
+        CHECK((ZEND_CE_BUILTIN_FUNCTIONS(dst) =
+                (zend_function_entry*) apc_pool_alloc(pool, ((n + 1) * sizeof(zend_function_entry)))));
+
+        for (i = 0; i < n; i++) {
+            CHECK(my_copy_function_entry((zend_function_entry*)(&ZEND_CE_BUILTIN_FUNCTIONS(dst)[i]),
+                                   &ZEND_CE_BUILTIN_FUNCTIONS(src)[i],
+                                   ctxt TSRMLS_CC));
+        }
+        *(char**)&(ZEND_CE_BUILTIN_FUNCTIONS(dst)[n].fname) = NULL;
+    }
+
+    if (src->type == ZEND_USER_CLASS && ZEND_CE_FILENAME(src)) {
+        CHECK((ZEND_CE_FILENAME(dst) = apc_pstrdup(ZEND_CE_FILENAME(src), pool TSRMLS_CC)));
+    }
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_free_hashtable */
+static void my_free_hashtable(HashTable* ht, int type TSRMLS_DC)
+{
+    Bucket *curr = NULL;
+    Bucket *prev = NULL;
+
+    assert(ht != NULL);
+
+    prev = ht->pListHead;
+    while (prev != NULL) {
+        curr = prev;
+        prev = prev->pListNext;
+
+#ifdef ZEND_ENGINE_2_4
+        if (!IS_INTERNED(curr->arKey)) {
+            apc_php_free((char*)curr->arKey TSRMLS_CC);
+        } 
+#else
+        apc_php_free(curr->arKey TSRMLS_CC);
+#endif
+        switch (type) {
+            case APC_FREE_HASHTABLE_FUNCS:
+                do {
+#if 0
+                    /* XXX need to check where else the method is referenced,
+                        the refcount leak is still there */
+                    zend_function *fn;
+                    fn = (zend_function *)curr->pData;
+
+                    apc_free_op_array_after_execution(&fn->op_array TSRMLS_CC);
+#endif
+                    efree(curr->pData);
+                } while (0);
+                break;
+
+            case APC_FREE_HASHTABLE_PROPS:
+            case APC_FREE_HASHTABLE_STATIC_PROPS:
+                efree(curr->pData);
+                break;
+        }
+
+        /* XXX check if this must be ignored for any class method */
+        if (type != APC_FREE_HASHTABLE_FUNCS) {
+            apc_php_free(curr TSRMLS_CC);
+        }
+    }
+
+    apc_php_free(ht->arBuckets TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ my_copy_hashtable_ex */
+static APC_HOTSPOT HashTable* my_copy_hashtable_ex(HashTable* dst,
+                                    HashTable* src TSRMLS_DC,
+                                    ht_copy_fun_t copy_fn,
+                                    int holds_ptrs,
+                                    apc_context_t* ctxt,
+                                    ht_check_copy_fun_t check_fn,
+                                    ...)
+{
+    Bucket* curr = NULL;
+    Bucket* prev = NULL;
+    Bucket* newp = NULL;
+    int first = 1;
+    apc_pool* pool = ctxt->pool;
+
+    assert(src != NULL);
+
+    if (!dst) {
+        CHECK(dst = (HashTable*) apc_pool_alloc(pool, sizeof(src[0])));
+    }
+
+    memcpy(dst, src, sizeof(src[0]));
+
+    /* allocate buckets for the new hashtable */
+    CHECK((dst->arBuckets = apc_pool_alloc(pool, (dst->nTableSize * sizeof(Bucket*)))));
+
+    memset(dst->arBuckets, 0, dst->nTableSize * sizeof(Bucket*));
+    dst->pInternalPointer = NULL;
+    dst->pListHead = NULL;
+
+    for (curr = src->pListHead; curr != NULL; curr = curr->pListNext) {
+        int n = curr->h % dst->nTableSize;
+
+        if(check_fn) {
+            va_list args;
+            va_start(args, check_fn);
+
+            /* Call the check_fn to see if the current bucket
+             * needs to be copied out
+             */
+            if(!check_fn(curr, args)) {
+                dst->nNumOfElements--;
+                va_end(args);
+                continue;
+            }
+
+            va_end(args);
+        }
+
+        /* create a copy of the bucket 'curr' */
+#ifdef ZEND_ENGINE_2_4
+        if (!curr->nKeyLength) {
+            CHECK((newp = (Bucket*) apc_pmemcpy(curr, sizeof(Bucket), pool TSRMLS_CC)));
+        } else if (IS_INTERNED(curr->arKey)) {
+            CHECK((newp = (Bucket*) apc_pmemcpy(curr, sizeof(Bucket), pool TSRMLS_CC)));
+#ifndef ZTS
+        } else if (pool->type != APC_UNPOOL) {
+            char *arKey;
+
+            CHECK((newp = (Bucket*) apc_pmemcpy(curr, sizeof(Bucket), pool TSRMLS_CC)));
+            arKey = (char *)apc_new_interned_string(curr->arKey, curr->nKeyLength TSRMLS_CC);
+            if (!arKey) {
+                CHECK((newp->arKey = (char*) apc_pmemcpy(curr->arKey, curr->nKeyLength, pool TSRMLS_CC)));
+            } else {
+                newp->arKey = arKey;
+            }
+#endif
+        } else {
+            CHECK((newp = (Bucket*) apc_pmemcpy(curr, sizeof(Bucket), pool TSRMLS_CC)));
+            CHECK((newp->arKey = (char*) apc_pmemcpy(curr->arKey, curr->nKeyLength, pool TSRMLS_CC)));
+        }
+#else
+        CHECK((newp = (Bucket*) apc_pmemcpy(curr,
+                                  (sizeof(Bucket) + curr->nKeyLength - 1),
+                                  pool TSRMLS_CC)));
+#endif
+
+        /* insert 'newp' into the linked list at its hashed index */
+        if (dst->arBuckets[n]) {
+            newp->pNext = dst->arBuckets[n];
+            newp->pLast = NULL;
+            newp->pNext->pLast = newp;
+        }
+        else {
+            newp->pNext = newp->pLast = NULL;
+        }
+
+        dst->arBuckets[n] = newp;
+
+        /* copy the bucket data using our 'copy_fn' callback function */
+        CHECK((newp->pData = copy_fn(NULL, curr->pData, ctxt TSRMLS_CC)));
+
+        if (holds_ptrs) {
+            memcpy(&newp->pDataPtr, newp->pData, sizeof(void*));
+        }
+        else {
+            newp->pDataPtr = NULL;
+        }
+
+        /* insert 'newp' into the table-thread linked list */
+        newp->pListLast = prev;
+        newp->pListNext = NULL;
+
+        if (prev) {
+            prev->pListNext = newp;
+        }
+
+        if (first) {
+            dst->pListHead = newp;
+            first = 0;
+        }
+
+        prev = newp;
+    }
+
+    dst->pListTail = newp;
+
+    zend_hash_internal_pointer_reset(dst);
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ my_copy_static_variables */
+static HashTable* my_copy_static_variables(zend_op_array* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    if (src->static_variables == NULL) {
+        return NULL;
+    }
+
+    return my_copy_hashtable(NULL,
+                             src->static_variables,
+                             (ht_copy_fun_t) my_copy_zval_ptr,
+                             1,
+                             ctxt);
+}
+/* }}} */
+
+/* {{{ apc_copy_zval */
+zval* apc_copy_zval(zval* dst, const zval* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    apc_pool* pool = ctxt->pool;
+    int usegc = (ctxt->copy == APC_COPY_OUT_OPCODE) || (ctxt->copy == APC_COPY_OUT_USER);
+
+    assert(src != NULL);
+
+    if (!dst) {
+        if(usegc) {
+            ALLOC_ZVAL(dst);
+            CHECK(dst);
+        } else {
+            CHECK(dst = (zval*) apc_pool_alloc(pool, sizeof(zval)));
+        }
+    }
+
+    CHECK(dst = my_copy_zval(dst, src, ctxt TSRMLS_CC));
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_fixup_op_array_jumps */
+static void apc_fixup_op_array_jumps(zend_op_array *dst, zend_op_array *src )
+{
+    uint i;
+
+    for (i=0; i < dst->last; ++i) {
+        zend_op *zo = &(dst->opcodes[i]);
+        /*convert opline number to jump address*/
+        switch (zo->opcode) {
+#ifdef ZEND_ENGINE_2_3
+            case ZEND_GOTO:
+#endif
+            case ZEND_JMP:
+                /*Note: if src->opcodes != dst->opcodes then we need to the opline according to src*/
+#ifdef ZEND_ENGINE_2_4
+                zo->op1.jmp_addr = dst->opcodes + (zo->op1.jmp_addr - src->opcodes);
+#else
+                zo->op1.u.jmp_addr = dst->opcodes + (zo->op1.u.jmp_addr - src->opcodes);
+#endif
+                break;
+            case ZEND_JMPZ:
+            case ZEND_JMPNZ:
+            case ZEND_JMPZ_EX:
+            case ZEND_JMPNZ_EX:
+#ifdef ZEND_ENGINE_2_3
+            case ZEND_JMP_SET:
+#endif
+#ifdef ZEND_ENGINE_2_4
+            case ZEND_JMP_SET_VAR:
+#endif
+#ifdef ZEND_ENGINE_2_4
+                zo->op2.jmp_addr = dst->opcodes + (zo->op2.jmp_addr - src->opcodes);
+#else
+                zo->op2.u.jmp_addr = dst->opcodes + (zo->op2.u.jmp_addr - src->opcodes);
+#endif
+                break;
+            default:
+                break;
+        }
+    }
+}
+/* }}} */
+
+/* {{{ apc_copy_op_array */
+zend_op_array* apc_copy_op_array(zend_op_array* dst, zend_op_array* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    int i;
+    apc_fileinfo_t *fileinfo = NULL;
+    char canon_path[MAXPATHLEN];
+    char *fullpath = NULL;
+    apc_opflags_t * flags = NULL;
+    apc_pool* pool = ctxt->pool;
+
+    assert(src != NULL);
+
+    if (!dst) {
+        CHECK(dst = (zend_op_array*) apc_pool_alloc(pool, sizeof(src[0])));
+    }
+
+    if(APCG(apc_optimize_function)) {
+        APCG(apc_optimize_function)(src TSRMLS_CC);
+    }
+
+    /* start with a bitwise copy of the array */
+    memcpy(dst, src, sizeof(src[0]));
+
+    dst->function_name = NULL;
+    dst->filename = NULL;
+    dst->refcount = NULL;
+    dst->opcodes = NULL;
+    dst->brk_cont_array = NULL;
+    dst->static_variables = NULL;
+    dst->try_catch_array = NULL;
+    dst->arg_info = NULL;
+    dst->doc_comment = NULL;
+#ifdef ZEND_ENGINE_2_1
+    dst->vars = NULL;
+#endif
+
+    /* copy the arg types array (if set) */
+    if (src->arg_info) {
+        CHECK(dst->arg_info = my_copy_arg_info_array(NULL,
+                                                src->arg_info,
+                                                src->num_args,
+                                                ctxt TSRMLS_CC));
+    }
+
+    if (src->function_name) {
+        CHECK(dst->function_name = apc_pstrdup(src->function_name, pool TSRMLS_CC));
+    }
+    if (src->filename) {
+        CHECK(dst->filename = apc_pstrdup(src->filename, pool TSRMLS_CC));
+    }
+
+    CHECK(dst->refcount = apc_pmemcpy(src->refcount,
+                                      sizeof(src->refcount[0]),
+                                      pool TSRMLS_CC));
+
+#ifdef ZEND_ENGINE_2_4
+    if (src->literals) {
+        zend_literal *p, *q, *end;
+
+        q = src->literals;
+        p = dst->literals = (zend_literal*) apc_pool_alloc(pool, (sizeof(zend_literal) * src->last_literal));
+        end = p + src->last_literal;
+        while (p < end) {
+            *p = *q;
+            my_copy_zval(&p->constant, &q->constant, ctxt TSRMLS_CC);
+            p++;
+            q++;
+        }
+    }
+#endif
+
+    /* deep-copy the opcodes */
+    CHECK(dst->opcodes = (zend_op*) apc_pool_alloc(pool, (sizeof(zend_op) * src->last)));
+
+    if(apc_reserved_offset != -1) {
+        /* Insanity alert: the void* pointer is cast into an apc_opflags_t 
+         * struct. apc_zend_init() checks to ensure that it fits in a void* */
+        flags = (apc_opflags_t*) & (dst->reserved[apc_reserved_offset]);
+        memset(flags, 0, sizeof(apc_opflags_t));
+        /* assert(sizeof(apc_opflags_t) <= sizeof(dst->reserved)); */
+    }
+
+    for (i = 0; (uint) i < src->last; i++) {
+        zend_op *zo = &(src->opcodes[i]);
+        /* a lot of files are merely constant arrays with no jumps */
+        switch (zo->opcode) {
+#ifdef ZEND_ENGINE_2_3
+            case ZEND_GOTO:
+#endif
+            case ZEND_JMP:
+            case ZEND_JMPZ:
+            case ZEND_JMPNZ:
+            case ZEND_JMPZ_EX:
+            case ZEND_JMPNZ_EX:
+#ifdef ZEND_ENGINE_2_3
+            case ZEND_JMP_SET:
+#endif
+#ifdef ZEND_ENGINE_2_4
+            case ZEND_JMP_SET_VAR:
+#endif
+                if(flags != NULL) {
+                    flags->has_jumps = 1;
+                }
+                break;
+            /* auto_globals_jit was not in php-4.3.* */
+            case ZEND_FETCH_R:
+            case ZEND_FETCH_W:
+            case ZEND_FETCH_IS:
+            case ZEND_FETCH_FUNC_ARG:
+            case ZEND_FETCH_RW:
+            case ZEND_FETCH_UNSET:
+                if(PG(auto_globals_jit) && flags != NULL)
+                {
+                     /* The fetch is only required if auto_globals_jit=1  */
+#ifdef ZEND_ENGINE_2_4
+                    if((zo->extended_value & ZEND_FETCH_TYPE_MASK) == ZEND_FETCH_GLOBAL &&
+                            zo->op1_type == IS_CONST && 
+                            Z_TYPE_P(zo->op1.zv) == IS_STRING) {
+                        if (Z_STRVAL_P(zo->op1.zv)[0] == '_') {
+# define SET_IF_AUTOGLOBAL(member) \
+    if(!strcmp(Z_STRVAL_P(zo->op1.zv), #member)) \
+        flags->member = 1 /* no ';' here */
+#else
+                    if(zo->op2.u.EA.type == ZEND_FETCH_GLOBAL &&
+                            zo->op1.op_type == IS_CONST && 
+                            zo->op1.u.constant.type == IS_STRING) {
+                        znode * varname = &zo->op1;
+                        if (varname->u.constant.value.str.val[0] == '_') {
+# define SET_IF_AUTOGLOBAL(member) \
+    if(!strcmp(varname->u.constant.value.str.val, #member)) \
+        flags->member = 1 /* no ';' here */
+#endif
+                            SET_IF_AUTOGLOBAL(_GET);
+                            else SET_IF_AUTOGLOBAL(_POST);
+                            else SET_IF_AUTOGLOBAL(_COOKIE);
+                            else SET_IF_AUTOGLOBAL(_SERVER);
+                            else SET_IF_AUTOGLOBAL(_ENV);
+                            else SET_IF_AUTOGLOBAL(_FILES);
+                            else SET_IF_AUTOGLOBAL(_REQUEST);
+                            else SET_IF_AUTOGLOBAL(_SESSION);
+#ifdef ZEND_ENGINE_2_4
+                            else if(zend_is_auto_global(
+                                            Z_STRVAL_P(zo->op1.zv),
+                                            Z_STRLEN_P(zo->op1.zv)
+                                            TSRMLS_CC))
+#else
+                            else if(zend_is_auto_global(
+                                            varname->u.constant.value.str.val,
+                                            varname->u.constant.value.str.len
+                                            TSRMLS_CC))
+#endif
+                            {
+                                flags->unknown_global = 1;
+                            }
+#ifdef ZEND_ENGINE_2_4
+                        } else SET_IF_AUTOGLOBAL(GLOBALS);
+#else
+                        }
+#endif
+                    }
+                }
+                break;
+            case ZEND_RECV_INIT:
+#ifdef ZEND_ENGINE_2_4
+                if(zo->op2_type == IS_CONST &&
+                    Z_TYPE_P(zo->op2.zv) == IS_CONSTANT_ARRAY) {
+#else
+                if(zo->op2.op_type == IS_CONST &&
+                    zo->op2.u.constant.type == IS_CONSTANT_ARRAY) {
+#endif
+                    if(flags != NULL) {
+                        flags->deep_copy = 1;
+                    }
+                }
+                break;
+            default:
+#ifdef ZEND_ENGINE_2_4
+                if((zo->op1_type == IS_CONST &&
+                    Z_TYPE_P(zo->op1.zv) == IS_CONSTANT_ARRAY) ||
+                    (zo->op2_type == IS_CONST &&
+                        Z_TYPE_P(zo->op2.zv) == IS_CONSTANT_ARRAY)) {
+#else
+                if((zo->op1.op_type == IS_CONST &&
+                    zo->op1.u.constant.type == IS_CONSTANT_ARRAY) ||
+                    (zo->op2.op_type == IS_CONST &&
+                        zo->op2.u.constant.type == IS_CONSTANT_ARRAY)) {
+#endif
+                    if(flags != NULL) {
+                        flags->deep_copy = 1;
+                    }
+                }
+                break;
+        }
+
+        if(!(my_copy_zend_op(dst->opcodes+i, src->opcodes+i, ctxt TSRMLS_CC))) {
+            return NULL;
+        }
+
+#ifdef ZEND_ENGINE_2_4
+        if (zo->op1_type == IS_CONST) {
+            dst->opcodes[i].op1.literal = src->opcodes[i].op1.literal - src->literals + dst->literals;
+        }
+        if (zo->op2_type == IS_CONST) {
+            dst->opcodes[i].op2.literal = src->opcodes[i].op2.literal - src->literals + dst->literals;
+        }
+        if (zo->result_type == IS_CONST) {
+            dst->opcodes[i].result.literal = src->opcodes[i].result.literal - src->literals + dst->literals;
+        }
+#endif
+
+        /* This code breaks apc's rule#1 - cache what you compile */
+        if((APCG(fpstat)==0) && APCG(canonicalize)) {
+            /* not pool allocated, because the pool allocations eat up shm space */
+            fileinfo = (apc_fileinfo_t*) apc_php_malloc(sizeof(apc_fileinfo_t) TSRMLS_CC);
+#ifdef ZEND_ENGINE_2_4
+            if((zo->opcode == ZEND_INCLUDE_OR_EVAL) && 
+                (zo->op1_type == IS_CONST && Z_TYPE_P(zo->op1.zv) == IS_STRING)) {
+                /* constant includes */
+                if(!IS_ABSOLUTE_PATH(Z_STRVAL_P(zo->op1.zv),Z_STRLEN_P(zo->op1.zv))) { 
+                    if (apc_search_paths(Z_STRVAL_P(zo->op1.zv), PG(include_path), fileinfo TSRMLS_CC) == 0) {
+#else
+            if((zo->opcode == ZEND_INCLUDE_OR_EVAL) && 
+                (zo->op1.op_type == IS_CONST && zo->op1.u.constant.type == IS_STRING)) {
+                /* constant includes */
+                if(!IS_ABSOLUTE_PATH(Z_STRVAL_P(&zo->op1.u.constant),Z_STRLEN_P(&zo->op1.u.constant))) { 
+                    if (apc_search_paths(Z_STRVAL_P(&zo->op1.u.constant), PG(include_path), fileinfo TSRMLS_CC) == 0) {
+#endif
+                        if((fullpath = realpath(fileinfo->fullpath, canon_path))) {
+                            /* everything has to go through a realpath() */
+                            zend_op *dzo = &(dst->opcodes[i]);
+#ifdef ZEND_ENGINE_2_4
+                            dzo->op1.literal = (zend_literal*) apc_pool_alloc(pool, sizeof(zend_literal));
+                            Z_STRLEN_P(dzo->op1.zv) = strlen(fullpath);
+                            Z_STRVAL_P(dzo->op1.zv) = apc_pstrdup(fullpath, pool TSRMLS_CC);
+                            Z_TYPE_P(dzo->op1.zv) = IS_STRING;
+                            Z_SET_REFCOUNT_P(dzo->op1.zv, 2);
+                            Z_SET_ISREF_P(dzo->op1.zv);
+                            dzo->op1.literal->hash_value = zend_hash_func(Z_STRVAL_P(dzo->op1.zv), Z_STRLEN_P(dzo->op1.zv)+1);
+#else
+                            dzo->op1.u.constant.value.str.len = strlen(fullpath);
+                            dzo->op1.u.constant.value.str.val = apc_pstrdup(fullpath, pool TSRMLS_CC);
+#endif
+                        }
+                    }
+                }
+            }
+            apc_php_free(fileinfo TSRMLS_CC);
+        }
+    }
+
+    if(flags == NULL || flags->has_jumps) {
+        apc_fixup_op_array_jumps(dst,src);
+    }
+
+    /* copy the break-continue array */
+    if (src->brk_cont_array) {
+        CHECK(dst->brk_cont_array = apc_pmemcpy(src->brk_cont_array,
+                                    sizeof(src->brk_cont_array[0]) * src->last_brk_cont,
+                                    pool TSRMLS_CC));
+    }
+
+    /* copy the table of static variables */
+    if (src->static_variables) {
+        CHECK(dst->static_variables = my_copy_static_variables(src, ctxt TSRMLS_CC));
+    }
+
+    if (src->try_catch_array) {
+        CHECK(dst->try_catch_array = apc_pmemcpy(src->try_catch_array,
+                                        sizeof(src->try_catch_array[0]) * src->last_try_catch,
+                                        pool TSRMLS_CC));
+    }
+
+#ifdef ZEND_ENGINE_2_1 /* PHP 5.1 */
+    if (src->vars) {
+        CHECK(dst->vars = apc_pmemcpy(src->vars,
+                            sizeof(src->vars[0]) * src->last_var,
+                            pool TSRMLS_CC));
+
+        for(i = 0; i <  src->last_var; i++) dst->vars[i].name = NULL;
+
+        for(i = 0; i <  src->last_var; i++) {
+            CHECK(dst->vars[i].name = apc_string_pmemcpy((char *)src->vars[i].name,
+                                src->vars[i].name_len + 1,
+                                pool TSRMLS_CC));
+        }
+    }
+#endif
+
+    if (src->doc_comment) {
+        CHECK(dst->doc_comment
+                = apc_pmemcpy(src->doc_comment, (src->doc_comment_len + 1), pool TSRMLS_CC));
+    }
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_copy_new_functions */
+apc_function_t* apc_copy_new_functions(int old_count, apc_context_t* ctxt TSRMLS_DC)
+{
+    apc_function_t* array;
+    int new_count;              /* number of new functions in table */
+    int i;
+    apc_pool* pool = ctxt->pool;
+
+    new_count = zend_hash_num_elements(CG(function_table)) - old_count;
+    assert(new_count >= 0);
+
+    CHECK(array =
+        (apc_function_t*)
+            apc_pool_alloc(pool, (sizeof(apc_function_t) * (new_count + 1))));
+
+    if (new_count == 0) {
+        array[0].function = NULL;
+        return array;
+    }
+
+    /* Skip the first `old_count` functions in the table */
+    zend_hash_internal_pointer_reset(CG(function_table));
+    for (i = 0; i < old_count; i++) {
+        zend_hash_move_forward(CG(function_table));
+    }
+
+    /* Add the next `new_count` functions to our array */
+    for (i = 0; i < new_count; i++) {
+        char* key;
+        uint key_size;
+        zend_function* fun;
+
+        zend_hash_get_current_key_ex(CG(function_table),
+                                     &key,
+                                     &key_size,
+                                     NULL,
+                                     0,
+                                     NULL);
+
+        zend_hash_get_current_data(CG(function_table), (void**) &fun);
+
+        CHECK(array[i].name = apc_pmemcpy(key, (int) key_size, pool TSRMLS_CC));
+        array[i].name_len = (int) key_size-1;
+        CHECK(array[i].function = my_copy_function(NULL, fun, ctxt TSRMLS_CC));
+        zend_hash_move_forward(CG(function_table));
+    }
+
+    array[i].function = NULL;
+    return array;
+}
+/* }}} */
+
+/* {{{ apc_copy_new_classes */
+apc_class_t* apc_copy_new_classes(zend_op_array* op_array, int old_count, apc_context_t *ctxt TSRMLS_DC)
+{
+    apc_class_t* array;
+    int new_count;              /* number of new classes in table */
+    int i;
+    apc_pool* pool = ctxt->pool;
+
+    new_count = zend_hash_num_elements(CG(class_table)) - old_count;
+    assert(new_count >= 0);
+
+    CHECK(array =
+        (apc_class_t*)
+            apc_pool_alloc(pool, (sizeof(apc_class_t) * (new_count + 1))));
+
+    if (new_count == 0) {
+        array[0].class_entry = NULL;
+        return array;
+    }
+
+    /* Skip the first `old_count` classes in the table */
+    zend_hash_internal_pointer_reset(CG(class_table));
+    for (i = 0; i < old_count; i++) {
+        zend_hash_move_forward(CG(class_table));
+    }
+
+    /* Add the next `new_count` classes to our array */
+    for (i = 0; i < new_count; i++) {
+        char* key;
+        uint key_size;
+        zend_class_entry* elem = NULL;
+
+        array[i].class_entry = NULL;
+
+        zend_hash_get_current_key_ex(CG(class_table),
+                                     &key,
+                                     &key_size,
+                                     NULL,
+                                     0,
+                                     NULL);
+
+        zend_hash_get_current_data(CG(class_table), (void**) &elem);
+
+
+        elem = *((zend_class_entry**)elem);
+
+        CHECK(array[i].name = apc_pmemcpy(key, (int) key_size, pool TSRMLS_CC));
+        array[i].name_len = (int) key_size-1;
+        CHECK(array[i].class_entry = my_copy_class_entry(NULL, elem, ctxt TSRMLS_CC));
+
+        /*
+         * If the class has a pointer to its parent class, save the parent
+         * name so that we can enable compile-time inheritance when we reload
+         * the child class; otherwise, set the parent name to null and scan
+         * the op_array to determine if this class inherits from some base
+         * class at execution-time.
+         */
+
+        if (elem->parent) {
+            CHECK(array[i].parent_name = apc_pstrdup(elem->parent->name, pool TSRMLS_CC));
+        }
+        else {
+            array[i].parent_name = NULL;
+        }
+
+        zend_hash_move_forward(CG(class_table));
+    }
+
+    array[i].class_entry = NULL;
+    return array;
+}
+/* }}} */
+
+/* Used only by my_prepare_op_array_for_execution */
+#ifdef ZEND_ENGINE_2_4
+# define APC_PREPARE_FETCH_GLOBAL_FOR_EXECUTION()                                               \
+                         /* The fetch is only required if auto_globals_jit=1  */                \
+                        if((zo->extended_value & ZEND_FETCH_TYPE_MASK) == ZEND_FETCH_GLOBAL &&    \
+                            zo->op1_type == IS_CONST &&                                         \
+                            Z_TYPE_P(zo->op1.zv) == IS_STRING &&                                \
+                            Z_STRVAL_P(zo->op1.zv)[0] == '_') {                                 \
+                            (void)zend_is_auto_global(Z_STRVAL_P(zo->op1.zv),                   \
+                                                      Z_STRLEN_P(zo->op1.zv)                    \
+                                                      TSRMLS_CC);                               \
+                        }
+#else
+# define APC_PREPARE_FETCH_GLOBAL_FOR_EXECUTION()                                               \
+                         /* The fetch is only required if auto_globals_jit=1  */                \
+                        if(zo->op2.u.EA.type == ZEND_FETCH_GLOBAL &&                            \
+                            zo->op1.op_type == IS_CONST &&                                      \
+                            zo->op1.u.constant.type == IS_STRING &&                             \
+                            zo->op1.u.constant.value.str.val[0] == '_') {                       \
+                                                                                                \
+                            znode* varname = &zo->op1;                                          \
+                            (void)zend_is_auto_global(varname->u.constant.value.str.val,        \
+                                                          varname->u.constant.value.str.len     \
+                                                          TSRMLS_CC);                           \
+                        }
+#endif
+
+/* {{{ my_prepare_op_array_for_execution */
+static int my_prepare_op_array_for_execution(zend_op_array* dst, zend_op_array* src, apc_context_t* ctxt TSRMLS_DC) 
+{
+    /* combine my_fetch_global_vars and my_copy_data_exceptions.
+     *   - Pre-fetch superglobals which would've been pre-fetched in parse phase.
+     *   - If the opcode stream contain mutable data, ensure a copy.
+     *   - Fixup array jumps in the same loop.
+     */
+    int i=src->last;
+    zend_op *zo;
+    zend_op *dzo;
+    apc_opflags_t * flags = apc_reserved_offset  != -1 ? 
+                                (apc_opflags_t*) & (src->reserved[apc_reserved_offset]) : NULL;
+    int needcopy = flags ? flags->deep_copy : 1;
+    /* auto_globals_jit was not in php4 */
+    int do_prepare_fetch_global = PG(auto_globals_jit) && (flags == NULL || flags->unknown_global);
+
+#define FETCH_AUTOGLOBAL(member) do { \
+    if(flags && flags->member == 1) { \
+        zend_is_auto_global(#member,\
+                            (sizeof(#member) - 1)\
+                            TSRMLS_CC);\
+    } \
+} while(0);
+
+    FETCH_AUTOGLOBAL(_GET);
+    FETCH_AUTOGLOBAL(_POST);
+    FETCH_AUTOGLOBAL(_COOKIE);
+    FETCH_AUTOGLOBAL(_SERVER);
+    FETCH_AUTOGLOBAL(_ENV);
+    FETCH_AUTOGLOBAL(_FILES);
+    FETCH_AUTOGLOBAL(_REQUEST);
+    FETCH_AUTOGLOBAL(_SESSION);
+#ifdef ZEND_ENGINE_2_4
+    FETCH_AUTOGLOBAL(GLOBALS);
+#endif
+
+    if(needcopy) {
+
+#ifdef ZEND_ENGINE_2_4
+        if (src->literals) {
+            zend_literal *p, *q, *end;
+
+            q = src->literals;
+            p = dst->literals = (zend_literal*) apc_xmemcpy(src->literals,
+                                        sizeof(zend_literal) * src->last_literal,
+                                        apc_php_malloc TSRMLS_CC);
+            end = p + src->last_literal;
+            while (p < end) {
+                if (Z_TYPE(q->constant) == IS_CONSTANT_ARRAY) {
+                    my_copy_zval(&p->constant, &q->constant, ctxt TSRMLS_CC);
+                }
+                p++;
+                q++;
+            }
+        }
+#endif
+
+        dst->opcodes = (zend_op*) apc_xmemcpy(src->opcodes,
+                                    sizeof(zend_op) * src->last,
+                                    apc_php_malloc TSRMLS_CC);
+        zo = src->opcodes;
+        dzo = dst->opcodes;
+        while(i > 0) {
+
+#ifdef ZEND_ENGINE_2_4
+            if(zo->op1_type == IS_CONST) {
+               dzo->op1.literal = zo->op1.literal - src->literals + dst->literals;
+            }
+            if(zo->op2_type == IS_CONST) {
+               dzo->op2.literal = zo->op2.literal - src->literals + dst->literals;
+            }
+            if(zo->result_type == IS_CONST) {
+               dzo->result.literal = zo->result.literal - src->literals + dst->literals;
+            }
+#else
+            if( ((zo->op1.op_type == IS_CONST &&
+                  zo->op1.u.constant.type == IS_CONSTANT_ARRAY)) ||
+                ((zo->op2.op_type == IS_CONST &&
+                  zo->op2.u.constant.type == IS_CONSTANT_ARRAY))) {
+
+                if(!(my_copy_zend_op(dzo, zo, ctxt TSRMLS_CC))) {
+                    assert(0); /* emalloc failed or a bad constant array */
+                }
+            }
+#endif
+
+            switch(zo->opcode) {
+#ifdef ZEND_ENGINE_2_3
+                case ZEND_GOTO:
+#endif
+                case ZEND_JMP:
+#ifdef ZEND_ENGINE_2_4
+                    dzo->op1.jmp_addr = dst->opcodes +
+                                            (zo->op1.jmp_addr - src->opcodes);
+#else
+                    dzo->op1.u.jmp_addr = dst->opcodes +
+                                            (zo->op1.u.jmp_addr - src->opcodes);
+#endif
+                    break;
+                case ZEND_JMPZ:
+                case ZEND_JMPNZ:
+                case ZEND_JMPZ_EX:
+                case ZEND_JMPNZ_EX:
+#ifdef ZEND_ENGINE_2_3
+                case ZEND_JMP_SET:
+#endif
+#ifdef ZEND_ENGINE_2_4
+                case ZEND_JMP_SET_VAR:
+#endif
+#ifdef ZEND_ENGINE_2_4
+                    dzo->op2.jmp_addr = dst->opcodes +
+                                            (zo->op2.jmp_addr - src->opcodes);
+#else
+                    dzo->op2.u.jmp_addr = dst->opcodes +
+                                            (zo->op2.u.jmp_addr - src->opcodes);
+#endif
+                    break;
+                case ZEND_FETCH_R:
+                case ZEND_FETCH_W:
+                case ZEND_FETCH_IS:
+                case ZEND_FETCH_FUNC_ARG:
+                    if(do_prepare_fetch_global)
+                    {
+                        APC_PREPARE_FETCH_GLOBAL_FOR_EXECUTION();
+                    }
+                    break;
+                default:
+                    break;
+            }
+            i--;
+            zo++;
+            dzo++;
+        }
+    } else {  /* !needcopy */
+        /* The fetch is only required if auto_globals_jit=1  */
+        if(do_prepare_fetch_global)
+        {
+            zo = src->opcodes;
+            while(i > 0) {
+
+                if(zo->opcode == ZEND_FETCH_R ||
+                   zo->opcode == ZEND_FETCH_W ||
+                   zo->opcode == ZEND_FETCH_IS ||
+                   zo->opcode == ZEND_FETCH_FUNC_ARG
+                  ) {
+                    APC_PREPARE_FETCH_GLOBAL_FOR_EXECUTION();
+                }
+
+                i--;
+                zo++;
+            }
+        }
+    }
+    return 1;
+}
+/* }}} */
+
+/* {{{ apc_copy_op_array_for_execution */
+zend_op_array* apc_copy_op_array_for_execution(zend_op_array* dst, zend_op_array* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    if(dst == NULL) {
+        dst = (zend_op_array*) emalloc(sizeof(src[0]));
+    }
+    memcpy(dst, src, sizeof(src[0]));
+    dst->static_variables = my_copy_static_variables(src, ctxt TSRMLS_CC);
+
+    dst->refcount = apc_pmemcpy(src->refcount,
+                                      sizeof(src->refcount[0]),
+                                      ctxt->pool TSRMLS_CC);
+
+    my_prepare_op_array_for_execution(dst,src, ctxt TSRMLS_CC);
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_free_op_array_after_execution */
+void apc_free_op_array_after_execution(zend_op_array *src TSRMLS_DC)
+{
+    if (NULL != src->refcount) {
+        apc_php_free(src->refcount TSRMLS_CC);
+    }
+}
+/* }}} */
+
+/* {{{ apc_copy_function_for_execution */
+zend_function* apc_copy_function_for_execution(zend_function* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    zend_function* dst;
+
+    dst = (zend_function*) emalloc(sizeof(src[0]));
+    memcpy(dst, src, sizeof(src[0]));
+    apc_copy_op_array_for_execution(&(dst->op_array), &(src->op_array), ctxt TSRMLS_CC);
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_copy_function_for_execution_ex */
+zend_function* apc_copy_function_for_execution_ex(void *dummy, zend_function* src, apc_context_t* ctxt TSRMLS_DC)
+{
+    if(src->type==ZEND_INTERNAL_FUNCTION || src->type==ZEND_OVERLOADED_FUNCTION) {
+        return src;
+    }
+
+    return apc_copy_function_for_execution(src, ctxt TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ apc_free_function_after_execution */
+void apc_free_function_after_execution(zend_function* src TSRMLS_DC)
+{
+    if(src->type==ZEND_INTERNAL_FUNCTION || src->type==ZEND_OVERLOADED_FUNCTION) {
+        return;
+    }
+
+    apc_free_op_array_after_execution(&src->op_array TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ apc_copy_class_entry_for_execution */
+zend_class_entry* apc_copy_class_entry_for_execution(zend_class_entry* src, apc_context_t* ctxt TSRMLS_DC)
+{
+#ifdef ZEND_ENGINE_2_4
+    int i;
+#endif
+    zend_class_entry* dst = (zend_class_entry*) apc_pool_alloc(ctxt->pool, sizeof(src[0]));
+    memcpy(dst, src, sizeof(src[0]));
+
+    if(src->num_interfaces)
+    {
+        /* These are slots to be populated later by ADD_INTERFACE insns */
+        dst->interfaces = apc_php_malloc(
+                            (sizeof(zend_class_entry*) * src->num_interfaces) TSRMLS_CC);
+        memset(dst->interfaces, 0, 
+                            sizeof(zend_class_entry*) * src->num_interfaces);
+    }
+    else
+    {
+        /* assert(dst->interfaces == NULL); */
+    }
+
+    /* Deep-copy the class properties, because they will be modified */
+
+#ifdef ZEND_ENGINE_2_4
+    dst->name = apc_string_pmemcpy((char*)src->name, src->name_length+1, ctxt->pool TSRMLS_CC); 
+	dst->default_properties_count = src->default_properties_count;
+    if (src->default_properties_count) {
+        dst->default_properties_table = (zval**) apc_php_malloc((sizeof(zval*) * src->default_properties_count) TSRMLS_CC);
+        for (i = 0; i < src->default_properties_count; i++) {
+            if (src->default_properties_table[i]) {
+                my_copy_zval_ptr(&dst->default_properties_table[i], (const zval**)&src->default_properties_table[i], ctxt TSRMLS_CC);
+            } else {
+                dst->default_properties_table[i] = NULL;
+            }
+        }
+    } else {
+        dst->default_properties_table = NULL;
+    }
+#else
+    my_copy_hashtable(&dst->default_properties,
+                      &src->default_properties,
+                      (ht_copy_fun_t) my_copy_zval_ptr,
+                      1,
+                      ctxt);
+#endif
+
+    /* For derived classes, we must also copy the function hashtable (although
+     * we can merely bitwise copy the functions it contains) */
+    my_copy_hashtable(&dst->function_table,
+                      &src->function_table,
+                      (ht_copy_fun_t) apc_copy_function_for_execution_ex,
+                      0,
+                      ctxt);
+
+    my_fixup_hashtable(&dst->function_table, (ht_fixup_fun_t)my_fixup_function_for_execution, src, dst);
+
+    /* zend_do_inheritance merges properties_info.
+     * Need only shallow copying as it doesn't hold the pointers.
+     */
+    my_copy_hashtable(&dst->properties_info,
+                      &src->properties_info,
+                      (ht_copy_fun_t) my_copy_property_info_for_execution,
+                      0,
+                      ctxt);
+
+#ifdef ZEND_ENGINE_2_2
+    /* php5.2 introduced a scope attribute for property info */
+    my_fixup_hashtable(&dst->properties_info, (ht_fixup_fun_t)my_fixup_property_info_for_execution, src, dst);
+#endif
+
+    /* if inheritance results in a hash_del, it might result in
+     * a pefree() of the pointers here. Deep copying required. 
+     */
+
+    my_copy_hashtable(&dst->constants_table,
+                      &src->constants_table,
+                      (ht_copy_fun_t) my_copy_zval_ptr,
+                      1,
+                      ctxt);
+
+#ifdef ZEND_ENGINE_2_4
+	dst->default_static_members_count = src->default_static_members_count;
+    if (src->default_static_members_count) {
+        dst->default_static_members_table = (zval**) apc_php_malloc((sizeof(zval*) * src->default_static_members_count) TSRMLS_CC);
+        for (i = 0; i < src->default_static_members_count; i++) {
+            if (src->default_static_members_table[i]) {
+                my_copy_zval_ptr(&dst->default_static_members_table[i], (const zval**)&src->default_static_members_table[i], ctxt TSRMLS_CC);
+            } else {
+                dst->default_static_members_table[i] = NULL;
+            }
+        }
+    } else {
+        dst->default_static_members_table = NULL;
+    }
+    dst->static_members_table = dst->default_static_members_table;
+#else
+    my_copy_hashtable(&dst->default_static_members,
+                      &src->default_static_members,
+                      (ht_copy_fun_t) my_copy_zval_ptr,
+                      1,
+                      ctxt);
+
+    if(src->static_members != &(src->default_static_members))
+    {
+        dst->static_members = my_copy_hashtable(NULL,
+                          src->static_members,
+                          (ht_copy_fun_t) my_copy_zval_ptr,
+                          1,
+                          ctxt);
+    }
+    else 
+    {
+        dst->static_members = &(dst->default_static_members);
+    }
+#endif
+
+#ifdef ZEND_ENGINE_2_4
+    if (src->trait_aliases) {
+        int num_trait_aliases = 0;
+
+        /* get how much trait aliases we've got */
+        while (src->trait_aliases[num_trait_aliases]) {num_trait_aliases++;}
+
+        /* copy all the trait aliases */
+        CHECK(dst->trait_aliases = (zend_trait_alias **) apc_pool_alloc(ctxt->pool, sizeof(zend_trait_alias *)*(num_trait_aliases+1)));
+        i = 0;
+        while (src->trait_aliases[i]) {
+            dst->trait_aliases[i] = apc_copy_trait_alias_for_execution(src->trait_aliases[i], ctxt TSRMLS_CC);
+            i++;
+        }
+        dst->trait_aliases[i] = NULL;
+    } 
+    if (src->trait_precedences) {
+        int num_trait_precedences = 0;
+
+        /* get how much trait precedences we've got */
+        while (src->trait_precedences[num_trait_precedences]) {num_trait_precedences++;}
+
+        /* copy all the trait precedences */
+        CHECK(dst->trait_precedences = 
+                (zend_trait_alias **) apc_pool_alloc(ctxt->pool, sizeof(zend_trait_alias *)*(num_trait_precedences+1)));
+        i = 0;
+        while (src->trait_precedences[i]) {
+            dst->trait_precedences[i] =
+                apc_copy_trait_precedence_for_execution(src->trait_precedences[i], ctxt TSRMLS_CC);
+            i++;
+        }
+        dst->trait_precedences[i] = NULL;
+    } 
+#endif
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_free_class_entry_after_execution */
+void apc_free_class_entry_after_execution(zend_class_entry* src TSRMLS_DC)
+{
+    if(src->num_interfaces > 0 && src->interfaces) {
+        apc_php_free(src->interfaces TSRMLS_CC);
+        src->interfaces = NULL;
+        src->num_interfaces = 0;
+    }
+    /* my_destroy_hashtable() does not play nice with refcounts */
+
+#ifdef ZEND_ENGINE_2_4
+#if 0
+    if (!IS_INTERNED(src->name)) {
+        apc_php_free(src->name TSRMLS_CC);
+    }
+#endif
+    if (src->default_static_members_table) {
+       int i;
+
+       for (i = 0; i < src->default_static_members_count; i++) {
+          zval_ptr_dtor(&src->default_static_members_table[i]);
+       }
+       efree(src->default_static_members_table);
+       src->default_static_members_table = NULL;
+    }
+    src->static_members_table = NULL;
+    if (src->default_properties_table) {
+       int i;
+
+       for (i = 0; i < src->default_properties_count; i++) {
+           if (src->default_properties_table[i]) {
+               zval_ptr_dtor(&src->default_properties_table[i]);
+           }
+       }
+       efree(src->default_properties_table);
+       src->default_properties_table = NULL;
+    }
+#else
+    zend_hash_clean(&src->default_static_members);
+    if(src->static_members != &(src->default_static_members))
+    {
+        zend_hash_destroy(src->static_members);
+        apc_php_free(src->static_members TSRMLS_CC);
+        src->static_members = NULL;
+    }
+    else
+    {
+        src->static_members = NULL;
+    }
+
+    zend_hash_clean(&src->default_properties);
+#endif
+    zend_hash_clean(&src->constants_table);
+
+#ifdef ZEND_ENGINE_2_4
+#if 0
+    /* XXX function freeing seems to be still a fail even in 5.4 as well, so let it down for now */
+    my_free_hashtable(&src->function_table, APC_FREE_HASHTABLE_FUNCS TSRMLS_CC);
+
+    my_free_hashtable(&src->properties_info, APC_FREE_HASHTABLE_PROPS TSRMLS_CC);
+    my_free_hashtable(&src->constants_table, APC_FREE_HASHTABLE_STATIC_PROPS TSRMLS_CC);
+    src->trait_aliases = NULL; /* XXX free all the traits stuff */
+#endif
+#endif
+
+    /* TODO: more cleanup */
+}
+/* }}} */
+
+/* {{{ apc_file_halt_offset */
+long apc_file_halt_offset(const char *filename TSRMLS_DC)
+{
+    zend_constant *c;
+    char *name;
+    int len;
+    char haltoff[] = "__COMPILER_HALT_OFFSET__";
+    long value = -1;
+
+    zend_mangle_property_name(&name, &len, haltoff, sizeof(haltoff) - 1, filename, strlen(filename), 0);
+    
+    if (zend_hash_find(EG(zend_constants), name, len+1, (void **) &c) == SUCCESS) {
+        value = Z_LVAL(c->value);
+    }
+    
+    pefree(name, 0);
+
+    return value;
+}
+/* }}} */
+
+/* {{{ apc_do_halt_compiler_register */
+void apc_do_halt_compiler_register(const char *filename, long halt_offset TSRMLS_DC)
+{
+    char *name;
+    char haltoff[] = "__COMPILER_HALT_OFFSET__";
+    int len;
+   
+    if(halt_offset > 0) {
+        
+        zend_mangle_property_name(&name, &len, haltoff, sizeof(haltoff) - 1, 
+                                    filename, strlen(filename), 0);
+        
+        zend_register_long_constant(name, len+1, halt_offset, CONST_CS, 0 TSRMLS_CC);
+
+        pefree(name, 0);
+    }
+}
+/* }}} */
+
+/* {{{ my_fixup_function */
+static void my_fixup_function(Bucket *p, zend_class_entry *src, zend_class_entry *dst)
+{
+    zend_function* zf = p->pData;
+
+    #define SET_IF_SAME_NAME(member) \
+    do { \
+        if(src->member && !strcmp(zf->common.function_name, src->member->common.function_name)) { \
+            dst->member = zf; \
+        } \
+    } \
+    while(0)
+
+    if(zf->common.scope == src)
+    {
+
+        /* Fixing up the default functions for objects here since
+         * we need to compare with the newly allocated functions
+         *
+         * caveat: a sub-class method can have the same name as the
+         * parent's constructor and create problems.
+         */
+
+        if(zf->common.fn_flags & ZEND_ACC_CTOR) dst->constructor = zf;
+        else if(zf->common.fn_flags & ZEND_ACC_DTOR) dst->destructor = zf;
+        else if(zf->common.fn_flags & ZEND_ACC_CLONE) dst->clone = zf;
+        else
+        {
+            SET_IF_SAME_NAME(__get);
+            SET_IF_SAME_NAME(__set);
+            SET_IF_SAME_NAME(__unset);
+            SET_IF_SAME_NAME(__isset);
+            SET_IF_SAME_NAME(__call);
+#ifdef ZEND_ENGINE_2_2
+            SET_IF_SAME_NAME(__tostring);
+#endif
+#ifdef ZEND_ENGINE_2_3
+            SET_IF_SAME_NAME(__callstatic);
+#endif
+        }
+        zf->common.scope = dst;
+    }
+    else
+    {
+        /* no other function should reach here */
+        assert(0);
+    }
+
+    #undef SET_IF_SAME_NAME
+}
+/* }}} */
+
+#ifdef ZEND_ENGINE_2_2
+/* {{{ my_fixup_property_info */
+static void my_fixup_property_info(Bucket *p, zend_class_entry *src, zend_class_entry *dst)
+{
+    zend_property_info* property_info = (zend_property_info*)p->pData;
+
+    if(property_info->ce == src)
+    {
+        property_info->ce = dst;
+    }
+    else
+    {
+        assert(0); /* should never happen */
+    }
+}
+/* }}} */
+#endif
+
+/* {{{ my_fixup_hashtable */
+static void my_fixup_hashtable(HashTable *ht, ht_fixup_fun_t fixup, zend_class_entry *src, zend_class_entry *dst)
+{
+    Bucket *p;
+    uint i;
+
+    for (i = 0; i < ht->nTableSize; i++) {
+        if(!ht->arBuckets) break;
+        p = ht->arBuckets[i];
+        while (p != NULL) {
+            fixup(p, src, dst);
+            p = p->pNext;
+        }
+    }
+}
+/* }}} */
+
+/* {{{ my_check_copy_function */
+static int my_check_copy_function(Bucket* p, va_list args)
+{
+    zend_class_entry* src = va_arg(args, zend_class_entry*);
+    zend_function* zf = (zend_function*)p->pData;
+
+    return (zf->common.scope == src);
+}
+/* }}} */
+
+#ifndef ZEND_ENGINE_2_4
+/* {{{ my_check_copy_default_property */
+static int my_check_copy_default_property(Bucket* p, va_list args)
+{
+    zend_class_entry* src = va_arg(args, zend_class_entry*);
+    zend_class_entry* parent = src->parent;
+    zval ** child_prop = (zval**)p->pData;
+    zval ** parent_prop = NULL;
+
+    if (parent &&
+        zend_hash_quick_find(&parent->default_properties, p->arKey, 
+            p->nKeyLength, p->h, (void **) &parent_prop)==SUCCESS) {
+
+        if((parent_prop && child_prop) && (*parent_prop) == (*child_prop))
+        {
+            return 0;
+        }
+    }
+
+    /* possibly not in the parent */
+    return 1;
+}
+/* }}} */
+#endif
+
+/* {{{ my_check_copy_property_info */
+static int my_check_copy_property_info(Bucket* p, va_list args)
+{
+    zend_class_entry* src = va_arg(args, zend_class_entry*);
+    zend_class_entry* parent = src->parent;
+    zend_property_info* child_info = (zend_property_info*)p->pData;
+    zend_property_info* parent_info = NULL;
+
+#ifdef ZEND_ENGINE_2_2
+    /* so much easier */
+    return (child_info->ce == src);
+#endif
+
+    if (parent &&
+        zend_hash_quick_find(&parent->properties_info, p->arKey, p->nKeyLength,
+            p->h, (void **) &parent_info)==SUCCESS) {
+        if(parent_info->flags & ZEND_ACC_PRIVATE)
+        {
+            return 1;
+        }
+        if((parent_info->flags & ZEND_ACC_PPP_MASK) !=
+            (child_info->flags & ZEND_ACC_PPP_MASK))
+        {
+            /* TODO: figure out whether ACC_CHANGED is more appropriate
+             * here */
+            return 1;
+        }
+        return 0;
+    }
+
+    /* property doesn't exist in parent, copy into cached child */
+    return 1;
+}
+/* }}} */
+
+#ifndef ZEND_ENGINE_2_4
+/* {{{ my_check_copy_static_member */
+static int my_check_copy_static_member(Bucket* p, va_list args)
+{
+    zend_class_entry* src = va_arg(args, zend_class_entry*);
+    HashTable * ht = va_arg(args, HashTable*);
+    zend_class_entry* parent = src->parent;
+    HashTable * parent_ht = NULL;
+    char * member_name;
+    char * class_name = NULL;
+
+    zend_property_info *parent_info = NULL;
+    zend_property_info *child_info = NULL;
+    zval ** parent_prop = NULL;
+    zval ** child_prop = (zval**)(p->pData);
+
+    if(!parent) {
+        return 1;
+    }
+
+    /* these do not need free'ing */
+#ifdef ZEND_ENGINE_2_2
+    zend_unmangle_property_name(p->arKey, p->nKeyLength-1, &class_name, &member_name);
+#else
+    zend_unmangle_property_name(p->arKey, &class_name, &member_name);
+#endif
+
+    /* please refer do_inherit_property_access_check in zend_compile.c
+     * to understand why we lookup in properties_info.
+     */
+    if((zend_hash_find(&parent->properties_info, member_name,
+                        strlen(member_name)+1, (void**)&parent_info) == SUCCESS)
+        &&
+        (zend_hash_find(&src->properties_info, member_name,
+                        strlen(member_name)+1, (void**)&child_info) == SUCCESS))
+    {
+        if(ht == &(src->default_static_members))
+        {
+            parent_ht = &parent->default_static_members;
+        }
+        else
+        {
+            parent_ht = parent->static_members;
+        }
+
+        if(zend_hash_quick_find(parent_ht, p->arKey,
+                       p->nKeyLength, p->h, (void**)&parent_prop) == SUCCESS)
+        {
+            /* they point to the same zval */
+            if(*parent_prop == *child_prop)
+            {
+                return 0;
+            }
+        }
+    }
+
+    return 1;
+}
+/* }}} */
+#endif
+
+/* {{{ my_check_copy_constant */
+static int my_check_copy_constant(Bucket* p, va_list args)
+{
+    zend_class_entry* src = va_arg(args, zend_class_entry*);
+    zend_class_entry* parent = src->parent;
+    zval ** child_const = (zval**)p->pData;
+    zval ** parent_const = NULL;
+
+    if (parent &&
+        zend_hash_quick_find(&parent->constants_table, p->arKey, 
+            p->nKeyLength, p->h, (void **) &parent_const)==SUCCESS) {
+
+        if((parent_const && child_const) && (*parent_const) == (*child_const))
+        {
+            return 0;
+        }
+    }
+
+    /* possibly not in the parent */
+    return 1;
+}
+/* }}} */
+
+/* {{{ apc_register_optimizer(apc_optimize_function_t optimizer)
+ *      register a optimizer callback function, returns the previous callback
+ */
+apc_optimize_function_t apc_register_optimizer(apc_optimize_function_t optimizer TSRMLS_DC) {
+    apc_optimize_function_t old_optimizer = APCG(apc_optimize_function);
+    APCG(apc_optimize_function) = optimizer;
+    return old_optimizer;
+}
+/* }}} */
+
+#ifdef ZEND_ENGINE_2_4
+
+#define APC_COPY_TRAIT_METHOD(dst, src) \
+    CHECK(dst = \
+         (zend_trait_method_reference *)apc_pool_alloc(ctxt->pool, sizeof(zend_trait_method_reference))); \
+    memcpy(dst, src, sizeof(zend_trait_method_reference)); \
+\
+    if (src->method_name) { \
+        CHECK((dst->method_name = apc_pstrdup(src->method_name, ctxt->pool TSRMLS_CC))); \
+        dst->mname_len = src->mname_len; \
+    } \
+ \
+    if (src->class_name) { \
+        CHECK((dst->class_name = apc_pstrdup(src->class_name, ctxt->pool TSRMLS_CC))); \
+        dst->cname_len = src->cname_len; \
+    } \
+    if (src->ce) { \
+        dst->ce = my_copy_class_entry(NULL, src->ce, ctxt TSRMLS_CC); \
+    }
+
+#define APC_COPY_TRAIT_METHOD_FOR_EXEC(dst, src) \
+    dst = (zend_trait_method_reference *) apc_pool_alloc(ctxt->pool, sizeof(zend_trait_method_reference)); \
+    memcpy(dst, src, sizeof(zend_trait_method_reference)); \
+    if (src->method_name) { \
+        CHECK((dst->method_name = apc_pstrdup(src->method_name, ctxt->pool TSRMLS_CC))); \
+    } \
+\
+    if (src->class_name) { \
+        CHECK((dst->class_name = apc_pstrdup(src->class_name, ctxt->pool TSRMLS_CC))); \
+    } \
+    if (src->ce) { \
+        dst->ce = apc_copy_class_entry_for_execution(src->ce, ctxt TSRMLS_CC); \
+    }
+
+/* {{{ apc_copy_trait_alias */
+zend_trait_alias* apc_copy_trait_alias(zend_trait_alias *dst, zend_trait_alias *src, apc_context_t *ctxt TSRMLS_DC)
+{
+    if (!dst) {
+        CHECK(dst = (zend_trait_alias *) apc_pool_alloc(ctxt->pool, sizeof(zend_trait_alias)));
+    }
+    memcpy(dst, src, sizeof(zend_trait_alias));
+
+    if (src->alias) {
+        CHECK((dst->alias = apc_pstrdup(src->alias, ctxt->pool TSRMLS_CC)));
+        dst->alias_len = src->alias_len;
+    }
+
+    if (src->function) {
+        CHECK(dst->function = my_copy_function(NULL, src->function, ctxt TSRMLS_CC));
+    }
+
+    APC_COPY_TRAIT_METHOD(dst->trait_method, src->trait_method);
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_copy_trait_alias_for_execution */
+zend_trait_alias* apc_copy_trait_alias_for_execution(zend_trait_alias *src, apc_context_t *ctxt TSRMLS_DC)
+{
+    zend_trait_alias *dst = (zend_trait_alias *) apc_pool_alloc(ctxt->pool, sizeof(zend_trait_alias));
+
+    memcpy(dst, src, sizeof(zend_trait_alias));
+
+    if (src->alias) {
+        CHECK((dst->alias = apc_pstrdup(src->alias, ctxt->pool TSRMLS_CC)));
+    }
+
+    /* XXX function is not handled here, check if it's right */
+
+    APC_COPY_TRAIT_METHOD_FOR_EXEC(dst->trait_method, src->trait_method);
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_copy_trait_precedence */
+zend_trait_precedence* apc_copy_trait_precedence(zend_trait_precedence *dst, zend_trait_precedence *src, apc_context_t *ctxt TSRMLS_DC)
+{
+    if (!dst) {
+        CHECK(dst = (zend_trait_precedence *) apc_pool_alloc(ctxt->pool, sizeof(zend_trait_precedence)));
+    }
+    memcpy(dst, src, sizeof(zend_trait_precedence));
+
+    if (src->function) {
+        CHECK(dst->function = my_copy_function(NULL, src->function, ctxt TSRMLS_CC));
+    } 
+
+    if (src->exclude_from_classes && *src->exclude_from_classes) {
+        int i = 0, num_classes = 0;
+
+        while (src->exclude_from_classes[num_classes]) { num_classes++; }
+
+        CHECK(dst->exclude_from_classes =
+            (zend_class_entry **) apc_pool_alloc(ctxt->pool, sizeof(zend_class_entry *)*(num_classes+1)));
+
+        while (src->exclude_from_classes[i] && i < num_classes) {
+            char *name = (char *) src->exclude_from_classes[i];
+
+            dst->exclude_from_classes[i] = (zend_class_entry *) apc_pstrdup(name, ctxt->pool TSRMLS_CC);
+            i++;
+        }
+        dst->exclude_from_classes[i] = NULL;
+    }
+
+    APC_COPY_TRAIT_METHOD(dst->trait_method, src->trait_method);
+
+    return dst;
+}
+/* }}} */
+
+/* {{{ apc_copy_trait_precedence_for_execution */
+zend_trait_precedence* apc_copy_trait_precedence_for_execution(zend_trait_precedence *src, apc_context_t *ctxt TSRMLS_DC)
+{
+    zend_trait_precedence *dst = (zend_trait_precedence *) apc_pool_alloc(ctxt->pool, sizeof(zend_trait_precedence));
+
+    memcpy(dst, src, sizeof(zend_trait_precedence));
+
+    if (src->exclude_from_classes && *src->exclude_from_classes) {
+        int i = 0, num_classes = 0;
+
+        while (src->exclude_from_classes[num_classes]) { num_classes++; }
+
+        CHECK(dst->exclude_from_classes = 
+            (zend_class_entry **) apc_pool_alloc(ctxt->pool, sizeof(zend_class_entry *)*(num_classes+1)));
+
+        while (src->exclude_from_classes[i] && i < num_classes) {
+            char *name = (char *) src->exclude_from_classes[i];
+
+            dst->exclude_from_classes[i] = (zend_class_entry *) apc_pstrdup(name, ctxt->pool TSRMLS_CC);
+            i++;
+        }
+        dst->exclude_from_classes[i] = NULL;
+    }
+
+    /* XXX function is not handled here, check if it's right */
+
+    APC_COPY_TRAIT_METHOD(dst->trait_method, src->trait_method);
+
+    return dst;
+}
+/* }}} */
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_compile.h php-5.4.19.bak/ext/apc/apc_compile.h
--- php-5.4.19/ext/apc/apc_compile.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_compile.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,162 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_compile.h 327059 2012-08-11 16:04:48Z ab $ */
+
+#ifndef APC_COMPILE_H
+#define APC_COMPILE_H
+
+/*
+ * This module encapsulates most of the complexity involved in deep-copying
+ * the Zend compiler data structures. The routines are allocator-agnostic, so
+ * the same function can be used for copying to and from shared memory.
+ */
+
+#include "apc.h"
+#include "apc_php.h"
+#include "apc_main.h"
+#include "apc_serializer.h"
+
+/* {{{ struct definition: apc_function_t */
+typedef struct apc_function_t apc_function_t;
+struct apc_function_t {
+    char* name;                 /* the function name */
+    int name_len;               /* length of name */
+    zend_function* function;    /* the zend function data structure */
+};
+/* }}} */
+
+/* {{{ struct definition: apc_class_t */
+typedef struct apc_class_t apc_class_t;
+struct apc_class_t {
+    char* name;                     /* the class name */
+    int name_len;                   /* length of name */
+    char* parent_name;              /* the parent class name */
+    zend_class_entry* class_entry;  /* the zend class data structure */
+};
+/* }}} */
+
+/* {{{ struct definition: apc_opflags_t */
+typedef struct apc_opflags_t apc_opflags_t;
+struct apc_opflags_t {
+    unsigned int has_jumps      : 1; /* has jump offsets */
+    unsigned int deep_copy      : 1; /* needs deep copy */
+
+    /* autoglobal bits */
+    unsigned int _POST          : 1;
+    unsigned int _GET           : 1;
+    unsigned int _COOKIE        : 1;
+    unsigned int _SERVER        : 1;
+    unsigned int _ENV           : 1;
+    unsigned int _FILES         : 1;
+    unsigned int _REQUEST       : 1;
+    unsigned int _SESSION       : 1;
+#ifdef ZEND_ENGINE_2_4
+    unsigned int GLOBALS        : 1;
+#endif
+    unsigned int unknown_global : 1;
+};
+/* }}} */
+
+/*
+ * These are the top-level copy functions.
+ */
+
+extern zend_op_array* apc_copy_op_array(zend_op_array* dst, zend_op_array* src, apc_context_t* ctxt TSRMLS_DC);
+extern zend_class_entry* apc_copy_class_entry(zend_class_entry* dst, zend_class_entry* src, apc_context_t* ctxt TSRMLS_DC);
+extern apc_function_t* apc_copy_new_functions(int old_count, apc_context_t* ctxt TSRMLS_DC);
+extern apc_class_t* apc_copy_new_classes(zend_op_array* op_array, int old_count, apc_context_t* ctxt TSRMLS_DC);
+extern zval* apc_copy_zval(zval* dst, const zval* src, apc_context_t* ctxt TSRMLS_DC);
+#ifdef ZEND_ENGINE_2_4
+extern zend_trait_alias* apc_copy_trait_alias(zend_trait_alias *dst, zend_trait_alias *src, apc_context_t *ctxt TSRMLS_DC);
+extern zend_trait_precedence* apc_copy_trait_precedence(zend_trait_precedence *dst, zend_trait_precedence *src, apc_context_t *ctxt TSRMLS_DC);
+#endif
+
+#if 0
+/*
+ * Deallocation functions corresponding to the copy functions above.
+ */
+
+extern void apc_free_op_array(zend_op_array* src, apc_context_t* ctxt);
+extern void apc_free_functions(apc_function_t* src, apc_context_t* ctxt);
+extern void apc_free_classes(apc_class_t* src, apc_context_t* ctxt);
+extern void apc_free_zval(zval* src, apc_context_t* ctxt);
+#endif
+
+/*
+ * These "copy-for-execution" functions must be called after retrieving an
+ * object from the shared cache. They do the minimal amount of work necessary
+ * to allow multiple processes to concurrently execute the same VM data
+ * structures.
+ */
+
+extern zend_op_array* apc_copy_op_array_for_execution(zend_op_array* dst, zend_op_array* src, apc_context_t* ctxt TSRMLS_DC);
+extern zend_function* apc_copy_function_for_execution(zend_function* src, apc_context_t* ctxt TSRMLS_DC);
+extern zend_class_entry* apc_copy_class_entry_for_execution(zend_class_entry* src, apc_context_t* ctxt TSRMLS_DC);
+#ifdef ZEND_ENGINE_2_4
+extern zend_trait_alias* apc_copy_trait_alias_for_execution(zend_trait_alias *src, apc_context_t *ctxt TSRMLS_DC);
+extern zend_trait_precedence* apc_copy_trait_precedence_for_execution(zend_trait_precedence *src, apc_context_t *ctxt TSRMLS_DC);
+#endif
+
+/*
+ * The "free-after-execution" function performs a cursory clean up of the item data
+ * This is required to minimize memory leak warnings and to ensure correct destructor
+ * ordering of some variables.
+ */
+extern void apc_free_class_entry_after_execution(zend_class_entry* src TSRMLS_DC);
+extern void apc_free_function_after_execution(zend_function* src TSRMLS_DC);
+extern void apc_free_op_array_after_execution(zend_op_array *src TSRMLS_DC);
+
+/*
+ * Optimization callback definition and registration function. 
+ */
+typedef zend_op_array* (*apc_optimize_function_t) (zend_op_array* TSRMLS_DC);
+extern apc_optimize_function_t apc_register_optimizer(apc_optimize_function_t optimizer TSRMLS_DC);
+
+/*
+ * To handle __COMPILER_HALT_OFFSET__
+ */
+long apc_file_halt_offset(const char* filename TSRMLS_DC);
+void apc_do_halt_compiler_register(const char *filename, long halt_offset TSRMLS_DC);
+
+/*
+ * apc serialization functions
+ */
+int APC_SERIALIZER_NAME(php) (APC_SERIALIZER_ARGS);
+int APC_UNSERIALIZER_NAME(php) (APC_UNSERIALIZER_ARGS); 
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_debug.c php-5.4.19.bak/ext/apc/apc_debug.c
--- php-5.4.19/ext/apc/apc_debug.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_debug.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,70 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+*/
+
+/* $Id: apc_debug.c 307048 2011-01-03 23:53:17Z kalle $ */
+#include "apc.h"
+#include <stdio.h>
+#include "zend.h"
+#include "zend_compile.h"
+
+#if defined(__DEBUG_APC__)
+
+/* keep track of vld_dump_oparray() signature */
+typedef void (*vld_dump_f) (zend_op_array * TSRMLS_DC);
+
+#endif
+
+void dump(zend_op_array *op_array TSRMLS_DC)
+{
+#if defined(__DEBUG_APC__)
+  vld_dump_f dump_op_array;
+  DL_HANDLE handle = NULL;
+
+#ifdef PHP_WIN32
+  handle = GetModuleHandle(NULL);
+  
+  if (!handle) {
+	apc_warning("unable to fetch current module handle." TSRMLS_CC);
+  }
+#endif
+  
+  dump_op_array = (vld_dump_f) DL_FETCH_SYMBOL(handle, "vld_dump_oparray");
+  
+#ifdef PHP_WIN32
+  DL_UNLOAD(handle);
+#endif
+
+  if(dump_op_array) {
+    dump_op_array(op_array TSRMLS_CC);
+  
+    return;
+  }
+  
+  apc_warning("vld is not installed or something even worse." TSRMLS_CC);
+#endif
+}
diff -Nru php-5.4.19/ext/apc/apc_debug.h php-5.4.19.bak/ext/apc/apc_debug.h
--- php-5.4.19/ext/apc/apc_debug.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_debug.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,29 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+*/
+
+void dump(zend_op_array * TSRMLS_DC);
diff -Nru php-5.4.19/ext/apc/apc_fcntl.c php-5.4.19.bak/ext/apc/apc_fcntl.c
--- php-5.4.19/ext/apc/apc_fcntl.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_fcntl.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,123 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: George Schlossnagle <george@omniti.com>                     |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_fcntl.c 307048 2011-01-03 23:53:17Z kalle $ */
+
+#include "apc.h"
+
+#ifdef APC_FCNTL_LOCKS
+
+#include "apc_fcntl.h"
+#include <unistd.h>
+#include <fcntl.h>
+
+int apc_fcntl_create(const char* pathname TSRMLS_DC)
+{
+    int fd;
+    if(pathname == NULL) {
+        char lock_path[] = "/tmp/.apc.XXXXXX";
+        mktemp(lock_path);
+        fd = open(lock_path, O_RDWR|O_CREAT, 0666);
+        if(fd > 0 ) {
+            unlink(lock_path);
+            return fd;
+        } else {
+            apc_error("apc_fcntl_create: open(%s, O_RDWR|O_CREAT, 0666) failed:" TSRMLS_CC, lock_path);
+            return -1;
+        }
+    }
+    fd = open(pathname, O_RDWR|O_CREAT, 0666);
+    if(fd > 0 ) {
+        unlink(pathname);
+        return fd;
+    }
+    apc_error("apc_fcntl_create: open(%s, O_RDWR|O_CREAT, 0666) failed:" TSRMLS_CC, pathname);
+    return -1;
+}
+
+void apc_fcntl_destroy(int fd)
+{
+    close(fd);
+}
+
+static int lock_reg(int fd, int cmd, int type, off_t offset, int whence, off_t len)
+{
+  int ret;
+  struct flock lock;
+
+  lock.l_type = type;
+  lock.l_start = offset;
+  lock.l_whence = whence;
+  lock.l_len = len;
+  lock.l_pid = 0;
+
+  do { ret = fcntl(fd, cmd, &lock) ; }
+  while(ret < 0 && errno == EINTR);
+  return(ret);
+}
+
+void apc_fcntl_lock(int fd TSRMLS_DC)
+{
+    if(lock_reg(fd, F_SETLKW, F_WRLCK, 0, SEEK_SET, 0) < 0) {
+        apc_error("apc_fcntl_lock failed:" TSRMLS_CC);
+    }
+}
+
+void apc_fcntl_rdlock(int fd TSRMLS_DC)
+{
+    if(lock_reg(fd, F_SETLKW, F_RDLCK, 0, SEEK_SET, 0) < 0) {
+        apc_error("apc_fcntl_rdlock failed:" TSRMLS_CC);
+    }
+}
+
+zend_bool apc_fcntl_nonblocking_lock(int fd TSRMLS_DC)
+{
+    if(lock_reg(fd, F_SETLK, F_WRLCK, 0, SEEK_SET, 0) < 0) {
+        if(errno==EACCES||errno==EAGAIN) return 0;
+        else apc_error("apc_fcntl_lock failed:" TSRMLS_CC);
+    }
+    return 1;
+}
+
+void apc_fcntl_unlock(int fd TSRMLS_DC)
+{
+    if(lock_reg(fd, F_SETLKW, F_UNLCK, 0, SEEK_SET, 0) < 0) {
+        apc_error("apc_fcntl_unlock failed:" TSRMLS_CC);
+    }
+}
+
+#endif /* APC_FCNTL_LOCKS */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_fcntl.h php-5.4.19.bak/ext/apc/apc_fcntl.h
--- php-5.4.19/ext/apc/apc_fcntl.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_fcntl.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,50 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt.                                 |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: George Schlossnagle <george@omniti.com>                     |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_fcntl.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_FCNTL_H
+#define APC_FCNTL_H
+
+
+extern int apc_fcntl_create(const char* pathname TSRMLS_DC);
+extern void apc_fcntl_destroy(int fd);
+extern void apc_fcntl_lock(int fd TSRMLS_DC);
+extern void apc_fcntl_rdlock(int fd TSRMLS_DC);
+extern void apc_fcntl_unlock(int fd TSRMLS_DC);
+extern unsigned char apc_fcntl_nonblocking_lock(int fd TSRMLS_DC);
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_fcntl_win32.c php-5.4.19.bak/ext/apc/apc_fcntl_win32.c
--- php-5.4.19/ext/apc/apc_fcntl_win32.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_fcntl_win32.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,120 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: George Schlossnagle <george@omniti.com>                     |
+  |          Edin Kadribasic <edink@php.net>                             |
+  |          Pierre Joye <pierre@php.net>                                |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_fcntl_win32.c 309203 2011-03-14 06:47:16Z pajoye $ */
+
+#include "apc.h"
+#include "apc_fcntl.h"
+#include <php.h>
+#include <win32/flock.h>
+#include <io.h>
+#include <fcntl.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+
+int apc_fcntl_create(const char* pathname TSRMLS_DC)
+{
+    char lock_file[MAXPATHLEN];
+    HANDLE fd;
+    DWORD tmp_dirname_len;
+    char lock_filename_tpl[] = ".apc.XXXXXX";
+    char *lock_filename;
+
+    tmp_dirname_len = GetTempPath(MAXPATHLEN, lock_file);
+    if (!tmp_dirname_len) {
+        return -1;
+    }
+
+    lock_filename = _mktemp(lock_filename_tpl);
+    if (lock_filename == NULL) {
+      return -1;
+    }
+
+    snprintf(lock_file + tmp_dirname_len, MAXPATHLEN - tmp_dirname_len - 1, "%s", lock_filename);
+
+    fd = CreateFile(lock_file,
+        GENERIC_READ | GENERIC_WRITE,
+        FILE_SHARE_READ | FILE_SHARE_WRITE,
+        NULL,
+        OPEN_ALWAYS,
+        FILE_ATTRIBUTE_NORMAL,
+        NULL);
+
+    if (fd == INVALID_HANDLE_VALUE) {
+        apc_error("apc_fcntl_create: could not open %s" TSRMLS_CC, lock_file);
+        return -1;
+    }
+
+    return (int)fd;
+}
+
+void apc_fcntl_destroy(int fd)
+{
+    CloseHandle((HANDLE)fd);
+}
+
+void apc_fcntl_lock(int fd TSRMLS_DC)
+{
+    OVERLAPPED offset = {0, 0, 0, 0, NULL};
+
+    if (!LockFileEx((HANDLE)fd, LOCKFILE_EXCLUSIVE_LOCK, 0, 1, 0, &offset)) {
+        apc_error("apc_fcntl_lock failed errno:%d" TSRMLS_CC, GetLastError());
+    }
+}
+
+void apc_fcntl_rdlock(int fd TSRMLS_DC)
+{
+    OVERLAPPED offset = {0, 0, 0, 0, NULL};
+
+    if (!LockFileEx((HANDLE)fd, 0, 0, 1, 0, &offset)) {
+        apc_error("apc_fcntl_rdlock failed errno:%d" TSRMLS_CC, GetLastError());
+    }
+}
+
+void apc_fcntl_unlock(int fd TSRMLS_DC)
+{
+    OVERLAPPED offset = {0, 0, 0, 0, NULL};
+
+    if (!UnlockFileEx((HANDLE)fd, 0, 1, 0, &offset)) {
+        DWORD error_code = GetLastError();
+        /* Ignore already unlocked error */
+        if (error_code != ERROR_NOT_LOCKED) {
+            apc_error("apc_fcntl_unlock failed errno:%d" TSRMLS_CC, error_code);
+        }
+    }
+}
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_globals.h php-5.4.19.bak/ext/apc/apc_globals.h
--- php-5.4.19/ext/apc/apc_globals.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_globals.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,152 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt.                                 |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          George Schlossnagle <george@omniti.com>                     |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_globals.h 307215 2011-01-07 09:54:00Z gopalv $ */
+
+#ifndef APC_GLOBALS_H
+#define APC_GLOBALS_H
+
+#include "apc_cache.h"
+#include "apc_stack.h"
+#include "apc_php.h"
+#include "apc_main.h"
+
+/* {{{ struct apc_rfc1867_data */
+
+typedef struct _apc_rfc1867_data apc_rfc1867_data;
+
+struct _apc_rfc1867_data {
+    char tracking_key[64];
+    int  key_length;
+    size_t content_length;
+    char filename[128];
+    char name[64];
+    char *temp_filename;
+    int cancel_upload;
+    double start_time;
+    size_t bytes_processed;
+    size_t prev_bytes_processed;
+    int update_freq;
+    double rate;
+    int started;
+};
+/* }}} */
+
+
+ZEND_BEGIN_MODULE_GLOBALS(apc)
+    /* configuration parameters */
+    zend_bool enabled;      /* if true, apc is enabled (defaults to true) */
+    long shm_segments;      /* number of shared memory segments to use */
+    long shm_size;          /* size of each shared memory segment (in MB) */
+    long num_files_hint;    /* parameter to apc_cache_create */
+    long user_entries_hint;
+    long gc_ttl;            /* parameter to apc_cache_create */
+    long ttl;               /* parameter to apc_cache_create */
+    long user_ttl;
+#if APC_MMAP
+    char *mmap_file_mask;   /* mktemp-style file-mask to pass to mmap */
+#endif
+    char** filters;         /* array of regex filters that prevent caching */
+    void* compiled_filters; /* compiled regex filters */
+
+    /* module variables */
+    zend_bool initialized;       /* true if module was initialized */
+    apc_stack_t* cache_stack;    /* the stack of cached executable code */
+    zend_bool cache_by_default;  /* true if files should be cached unless filtered out */
+                                 /* false if files should only be cached if filtered in */
+    long file_update_protection; /* Age in seconds before a file is eligible to be cached - 0 to disable */
+    zend_bool enable_cli;        /* Flag to override turning APC off for CLI */
+    long max_file_size;          /* Maximum size of file, in bytes that APC will be allowed to cache */
+    zend_bool fpstat;            /* true if fullpath includes should be stat'ed */
+    zend_bool canonicalize;      /* true if relative paths should be canonicalized in no-stat mode */
+    zend_bool stat_ctime;        /* true if ctime in addition to mtime should be checked */
+    zend_bool write_lock;        /* true for a global write lock */
+    zend_bool slam_defense;      /* true for user cache slam defense */ 
+    zend_bool report_autofilter; /* true for auto-filter warnings */
+    zend_bool include_once;      /* Override the ZEND_INCLUDE_OR_EVAL opcode handler to avoid pointless fopen()s [still experimental] */
+    apc_optimize_function_t apc_optimize_function;   /* optimizer function callback */
+#ifdef MULTIPART_EVENT_FORMDATA
+    zend_bool rfc1867;            /* Flag to enable rfc1867 handler */
+    char* rfc1867_prefix;         /* Key prefix */
+    char* rfc1867_name;           /* Name of hidden field to activate upload progress/key suffix */
+    double rfc1867_freq;          /* Update frequency as percentage or bytes */
+    long rfc1867_ttl;             /* TTL for rfc1867 entries */
+    apc_rfc1867_data rfc1867_data;/* Per-request data */
+#endif
+    HashTable copied_zvals;      /* my_copy recursion detection list */
+    zend_bool force_file_update; /* force files to be updated during apc_compile_file */
+    char canon_path[MAXPATHLEN]; /* canonical path for key data */
+#ifdef APC_FILEHITS
+    zval *filehits;              /* Files that came from the cache for this request */
+#endif
+    zend_bool coredump_unmap;    /* Trap signals that coredump and unmap shared memory */
+    apc_cache_t *current_cache;  /* current cache being modified/read */
+    char *preload_path;
+    zend_bool file_md5;           /* record md5 hash of files */
+    void *apc_bd_alloc_ptr;      /* bindump alloc() ptr */
+    void *apc_bd_alloc_ubptr;    /* bindump alloc() upper bound ptr */
+    HashTable apc_bd_alloc_list; /* bindump alloc() ptr list */
+    zend_bool use_request_time;  /* use the SAPI request start time for TTL */
+    zend_bool lazy_functions;        /* enable/disable lazy function loading */
+    HashTable *lazy_function_table;  /* lazy function entry table */
+    zend_bool lazy_classes;          /* enable/disable lazy class loading */
+    HashTable *lazy_class_table;     /* lazy class entry table */
+#ifdef ZEND_ENGINE_2_4
+    long shm_strings_buffer;
+#endif
+    char *serializer_name;       /* the serializer config option */
+    apc_serializer_t *serializer;/* the actual serializer in use */
+ZEND_END_MODULE_GLOBALS(apc)
+
+/* (the following declaration is defined in php_apc.c) */
+ZEND_EXTERN_MODULE_GLOBALS(apc)
+
+#ifdef ZTS
+# define APCG(v) TSRMG(apc_globals_id, zend_apc_globals *, v)
+#else
+# define APCG(v) (apc_globals.v)
+#endif
+
+/* True globals */
+extern apc_cache_t* apc_cache;       /* the global compiler cache */
+extern apc_cache_t* apc_user_cache;  /* the global user content cache */
+extern void* apc_compiled_filters;   /* compiled filters */
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc.h php-5.4.19.bak/ext/apc/apc.h
--- php-5.4.19/ext/apc/apc.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,136 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          George Schlossnagle <george@omniti.com>                     |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc.h 327146 2012-08-16 10:57:33Z ab $ */
+
+#ifndef APC_H
+#define APC_H
+
+/*
+ * This module defines utilities and helper functions used elsewhere in APC.
+ */
+
+/* Commonly needed C library headers. */
+#include <assert.h>
+#include <errno.h>
+#include <stdarg.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <time.h>
+
+/* UNIX headers (needed for struct stat) */
+#include <sys/types.h>
+#include <sys/stat.h>
+#ifndef PHP_WIN32
+#include <unistd.h>
+#endif
+
+#ifdef HAVE_CONFIG_H
+#include <config.h>
+#endif
+
+#include "php.h"
+#include "main/php_streams.h"
+
+/* typedefs for extensible memory allocators */
+typedef void* (*apc_malloc_t)(size_t TSRMLS_DC);
+typedef void  (*apc_free_t)  (void * TSRMLS_DC);
+
+/* wrappers for memory allocation routines */
+extern void* apc_emalloc(size_t n TSRMLS_DC);
+extern void* apc_erealloc(void* p, size_t n TSRMLS_DC);
+extern void apc_efree(void* p TSRMLS_DC);
+extern char* apc_estrdup(const char* s TSRMLS_DC);
+extern void* apc_xstrdup(const char* s, apc_malloc_t f TSRMLS_DC);
+extern void* apc_xmemcpy(const void* p, size_t n, apc_malloc_t f TSRMLS_DC);
+
+/* console display functions */
+extern void apc_error(const char *format TSRMLS_DC, ...);
+extern void apc_warning(const char *format TSRMLS_DC, ...);
+extern void apc_notice(const char *format TSRMLS_DC, ...);
+extern void apc_debug(const char *format TSRMLS_DC, ...);
+
+/* string and text manipulation */
+extern char* apc_append(const char* s, const char* t TSRMLS_DC);
+extern char* apc_substr(const char* s, int start, int length TSRMLS_DC);
+extern char** apc_tokenize(const char* s, char delim TSRMLS_DC);
+
+/* filesystem functions */
+
+typedef struct apc_fileinfo_t 
+{
+    char *fullpath;
+    char path_buf[MAXPATHLEN];
+    php_stream_statbuf st_buf;
+} apc_fileinfo_t;
+
+extern int apc_search_paths(const char* filename, const char* path, apc_fileinfo_t* fileinfo TSRMLS_DC);
+
+/* regular expression wrapper functions */
+extern void* apc_regex_compile_array(char* patterns[] TSRMLS_DC);
+extern void apc_regex_destroy_array(void* p TSRMLS_DC);
+extern int apc_regex_match_array(void* p, const char* input);
+
+/* apc_crc32: returns the CRC-32 checksum of the first len bytes in buf */
+extern unsigned int apc_crc32(const unsigned char* buf, unsigned int len);
+
+/* apc_flip_hash flips keys and values for faster searching */
+extern HashTable* apc_flip_hash(HashTable *hash); 
+
+#define APC_NEGATIVE_MATCH 1
+#define APC_POSITIVE_MATCH 2
+
+#define apc_time() \
+    (APCG(use_request_time) ? (time_t) sapi_get_request_time(TSRMLS_C) : time(0));
+
+#if defined(__GNUC__)
+# define APC_UNUSED __attribute__((unused))
+# define APC_USED __attribute__((used))
+# define APC_ALLOC __attribute__((malloc))
+# define APC_HOTSPOT __attribute__((hot))
+#else 
+# define APC_UNUSED
+# define APC_USED
+# define APC_ALLOC 
+# define APC_HOTSPOT 
+#endif
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_iterator.c php-5.4.19.bak/ext/apc/apc_iterator.c
--- php-5.4.19/ext/apc/apc_iterator.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_iterator.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,749 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Brian Shire <shire@php.net>                                 |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: apc_iterator.c 327134 2012-08-15 14:21:28Z ab $ */
+
+#include "php_apc.h"
+#include "apc_iterator.h"
+#include "apc_cache.h"
+#include "apc_zend.h"
+
+#include "ext/standard/md5.h"
+
+#include "zend_interfaces.h"
+
+zend_class_entry *apc_iterator_ce;
+zend_object_handlers apc_iterator_object_handlers;
+
+/* {{{ apc_iterator_item */
+static apc_iterator_item_t* apc_iterator_item_ctor(apc_iterator_t *iterator, slot_t **slot_pp TSRMLS_DC) {
+    zval *zvalue;
+    char md5str[33];
+    slot_t *slot = *slot_pp;
+    apc_context_t ctxt = {0, };
+    apc_iterator_item_t *item = ecalloc(1, sizeof(apc_iterator_item_t));
+
+    if (slot->key.type == APC_CACHE_KEY_FILE) {
+        /* keys should be unique and with stat=1 we could have multiple files with the same name, so use '<device> <inode>' instead */
+#ifdef PHP_WIN32
+        item->key_len = spprintf(&item->key, 0, "%I64d %I64d", slot->key.data.file.device, slot->key.data.file.inode);
+#else
+        item->key_len = spprintf(&item->key, 0, "%ld %ld", (ulong)slot->key.data.file.device, (ulong)slot->key.data.file.inode);
+#endif
+        item->filename_key = estrdup(slot->value->data.file.filename);
+    } else if (slot->key.type == APC_CACHE_KEY_USER) {
+        item->key = estrndup((char*)slot->key.data.user.identifier, slot->key.data.user.identifier_len);
+        item->key_len = slot->key.data.user.identifier_len;
+        item->filename_key = item->key; 
+    } else if (slot->key.type == APC_CACHE_KEY_FPFILE) {
+        item->key = estrndup((char*)slot->key.data.fpfile.fullpath, slot->key.data.fpfile.fullpath_len);
+        item->key_len = slot->key.data.fpfile.fullpath_len;
+        item->filename_key = item->key;
+    } else {
+        apc_error("Internal error, invalid entry type." TSRMLS_CC);
+    }
+
+    ALLOC_INIT_ZVAL(item->value);
+    array_init(item->value);
+
+    if (APC_ITER_TYPE & iterator->format) {
+        if(slot->value->type == APC_CACHE_ENTRY_FILE) {
+            add_assoc_string(item->value, "type", "file", 1);
+        } else if(slot->value->type == APC_CACHE_ENTRY_USER) {
+            add_assoc_string(item->value, "type", "user", 1);
+        }
+    }
+    if (APC_ITER_FILENAME & iterator->format) {
+        if(slot->value->type == APC_CACHE_ENTRY_FILE) {
+            if (slot->key.type == APC_CACHE_KEY_FILE) {
+              add_assoc_string(item->value, "filename", slot->value->data.file.filename, 1);
+            } else {  /* APC_CACHE_FPFILE */
+              add_assoc_string(item->value, "filename", (char*)slot->key.data.fpfile.fullpath, 1);
+            }
+        }
+    }
+    if (APC_ITER_DEVICE & iterator->format) {
+        if(slot->key.type == APC_CACHE_KEY_FILE) {
+#ifdef PHP_WIN32
+			char buf[20];
+			sprintf(buf, "%I64d", slot->key.data.file.device);
+			add_assoc_string(item->value, "device", buf, 1);
+#else
+            add_assoc_long(item->value, "device", slot->key.data.file.device);
+#endif
+        }
+    }
+    if (APC_ITER_INODE & iterator->format) {
+        if(slot->key.type == APC_CACHE_KEY_FILE) {
+#ifdef PHP_WIN32
+			char buf[20];
+			sprintf(buf, "%I64d", slot->key.data.file.device);
+			add_assoc_string(item->value, "device", buf, 1);
+#else
+            add_assoc_long(item->value, "inode", slot->key.data.file.inode);
+#endif
+        }
+    }
+    if (APC_ITER_KEY & iterator->format) {
+        add_assoc_stringl(item->value, "key", item->key, (item->key_len - 1), 1);
+    }
+    if (APC_ITER_VALUE & iterator->format) {
+        if(slot->value->type == APC_CACHE_ENTRY_USER) {
+
+            ctxt.pool = apc_pool_create(APC_UNPOOL, apc_php_malloc, apc_php_free, NULL, NULL TSRMLS_CC);
+            ctxt.copy = APC_COPY_OUT_USER;
+
+            MAKE_STD_ZVAL(zvalue);
+            apc_cache_fetch_zval(zvalue, slot->value->data.user.val, &ctxt TSRMLS_CC);
+            apc_pool_destroy(ctxt.pool TSRMLS_CC);
+            add_assoc_zval(item->value, "value", zvalue);
+        }
+    }
+    if (APC_ITER_MD5 & iterator->format) {
+        if(slot->value->type == APC_CACHE_ENTRY_FILE) {
+            if(APCG(file_md5) && slot->key.md5) {
+                make_digest(md5str, slot->key.md5);
+                add_assoc_string(item->value, "md5", md5str, 1);
+            }
+        }
+    }
+    if (APC_ITER_NUM_HITS & iterator->format) {
+        add_assoc_long(item->value, "num_hits", slot->num_hits);
+    }
+    if (APC_ITER_MTIME & iterator->format) {
+        add_assoc_long(item->value, "mtime", slot->key.mtime);
+    }
+    if (APC_ITER_CTIME & iterator->format) {
+        add_assoc_long(item->value, "creation_time", slot->creation_time);
+    }
+    if (APC_ITER_DTIME & iterator->format) {
+        add_assoc_long(item->value, "deletion_time", slot->deletion_time);
+    }
+    if (APC_ITER_ATIME & iterator->format) {
+        add_assoc_long(item->value, "access_time", slot->access_time);
+    }
+    if (APC_ITER_REFCOUNT & iterator->format) {
+        add_assoc_long(item->value, "ref_count", slot->value->ref_count);
+    }
+    if (APC_ITER_MEM_SIZE & iterator->format) {
+        add_assoc_long(item->value, "mem_size", slot->value->mem_size);
+    }
+    if (APC_ITER_TTL & iterator->format) {
+        if(slot->value->type == APC_CACHE_ENTRY_USER) {
+            add_assoc_long(item->value, "ttl", slot->value->data.user.ttl);
+        }
+    }
+
+    return item;
+}
+/* }}} */
+
+/* {{{ apc_iterator_clone */
+static zend_object_value apc_iterator_clone(zval *zobject TSRMLS_DC) {
+    zend_object_value value = {0};
+    apc_error("APCIterator object cannot be cloned." TSRMLS_CC);
+    return value;
+}
+/* }}} */
+
+/* {{{ apc_iterator_item_dtor */
+static void apc_iterator_item_dtor(apc_iterator_item_t *item) {
+    if (item->filename_key && item->filename_key != item->key) {
+        efree(item->filename_key);
+    }
+    if (item->key) {
+        efree(item->key);
+    }
+    if (item->value) {
+        zval_ptr_dtor(&item->value);
+    }
+    efree(item);
+}
+/* }}} */
+
+/* {{{ apc_iterator_destroy */
+static void apc_iterator_destroy(void *object, zend_object_handle handle TSRMLS_DC) {
+    apc_iterator_t *iterator = (apc_iterator_t*)object;
+
+    if (iterator->initialized == 0) {
+        return;
+    }
+
+    while (apc_stack_size(iterator->stack) > 0) {
+        apc_iterator_item_dtor(apc_stack_pop(iterator->stack));
+    }
+    apc_stack_destroy(iterator->stack TSRMLS_CC);
+
+#ifdef ITERATOR_PCRE
+    if (iterator->regex) {
+        efree(iterator->regex);
+    }
+#endif
+    if (iterator->search_hash) {
+        zend_hash_destroy(iterator->search_hash);
+        efree(iterator->search_hash);
+    }
+    iterator->initialized = 0;
+
+}
+/* }}} */
+
+/* {{{ acp_iterator_free */
+static void apc_iterator_free(void *object TSRMLS_DC) {
+    zend_object_std_dtor(object TSRMLS_CC);
+    efree(object);
+}
+/* }}} */
+
+/* {{{ apc_iterator_create */
+static zend_object_value apc_iterator_create(zend_class_entry *ce TSRMLS_DC) {
+    zend_object_value retval;
+    apc_iterator_t *iterator;
+
+    iterator = emalloc(sizeof(apc_iterator_t));
+    iterator->obj.ce = ce;
+    ALLOC_HASHTABLE(iterator->obj.properties);
+    zend_hash_init(iterator->obj.properties, 0, NULL, ZVAL_PTR_DTOR, 0);
+#ifdef ZEND_ENGINE_2_4
+    iterator->obj.properties_table = NULL;
+#endif
+    iterator->obj.guards = NULL;
+    iterator->initialized = 0;
+    retval.handle = zend_objects_store_put(iterator, apc_iterator_destroy, apc_iterator_free, NULL TSRMLS_CC);
+    retval.handlers = &apc_iterator_object_handlers;
+
+    return retval;
+}
+/* }}} */
+
+/* {{{ apc_iterator_search_match
+ *       Verify if the key matches oru search parameters
+ */
+static int apc_iterator_search_match(apc_iterator_t *iterator, slot_t **slot) {
+    char *key;
+    int key_len;
+    char *fname_key = NULL;
+    int fname_key_len = 0;
+    int rval = 1;
+
+    if ((*slot)->key.type == APC_CACHE_KEY_FILE) {
+        key = (*slot)->value->data.file.filename;
+        key_len = strlen(key);
+        fname_key_len = spprintf(&fname_key, 0, "%ld %ld", (*slot)->key.data.file.device, (*slot)->key.data.file.inode);
+    } else if ((*slot)->key.type == APC_CACHE_KEY_USER) {
+        key = (char*)(*slot)->key.data.user.identifier;
+        key_len = (*slot)->key.data.user.identifier_len;
+    } else if ((*slot)->key.type == APC_CACHE_KEY_FPFILE) {
+        key = (char*)(*slot)->key.data.fpfile.fullpath;
+        key_len = (*slot)->key.data.fpfile.fullpath_len;
+    } else {
+        return 0;
+    }
+
+#ifdef ITERATOR_PCRE
+    if (iterator->regex) {
+        rval = (pcre_exec(iterator->re, NULL, key, strlen(key), 0, 0, NULL, 0) >= 0);
+    }
+#endif
+            
+    if (iterator->search_hash) {
+        rval = zend_hash_exists(iterator->search_hash, key, key_len);
+        if (!rval && fname_key) {
+            rval = zend_hash_exists(iterator->search_hash, fname_key, fname_key_len+1);
+        }
+    }
+
+    if (fname_key) {
+        efree(fname_key);
+    }
+
+    return rval;
+}
+/* }}} */
+
+/* {{{ apc_iterator_check_expiry */
+static int apc_iterator_check_expiry(apc_cache_t* cache, slot_t **slot, time_t t)
+{
+    if((*slot)->value->type == APC_CACHE_ENTRY_USER) {
+        if((*slot)->value->data.user.ttl) {
+            if((time_t) ((*slot)->creation_time + (*slot)->value->data.user.ttl) < t) {
+                return 0;
+            }
+        } else if(cache->ttl) {
+            if((*slot)->creation_time + cache->ttl < t) {
+                return 0;
+            }
+        }
+    } else if((*slot)->access_time < (t - cache->ttl)) {
+        return 0;
+    }
+
+    return 1;
+}
+/* }}} */
+
+/* {{{ apc_iterator_fetch_active */
+static int apc_iterator_fetch_active(apc_iterator_t *iterator TSRMLS_DC) {
+    int count=0;
+    slot_t **slot;
+    apc_iterator_item_t *item;
+    time_t t;
+
+    t = apc_time();
+
+    while (apc_stack_size(iterator->stack) > 0) {
+        apc_iterator_item_dtor(apc_stack_pop(iterator->stack));
+    }
+
+    CACHE_LOCK(iterator->cache);
+    while(count <= iterator->chunk_size && iterator->slot_idx < iterator->cache->num_slots) {
+        slot = &iterator->cache->slots[iterator->slot_idx];
+        while(*slot) {
+            if (apc_iterator_check_expiry(iterator->cache, slot, t)) {
+                if (apc_iterator_search_match(iterator, slot)) {
+                    count++;
+                    item = apc_iterator_item_ctor(iterator, slot TSRMLS_CC);
+                    if (item) {
+                        apc_stack_push(iterator->stack, item TSRMLS_CC);
+                    }
+                }
+            }
+            slot = &(*slot)->next;
+        }
+        iterator->slot_idx++;
+    }
+    CACHE_UNLOCK(iterator->cache);
+    iterator->stack_idx = 0;
+    return count;
+}
+/* }}} */
+
+/* {{{ apc_iterator_fetch_deleted */
+static int apc_iterator_fetch_deleted(apc_iterator_t *iterator TSRMLS_DC) {
+    int count=0;
+    slot_t **slot;
+    apc_iterator_item_t *item;
+
+    CACHE_LOCK(iterator->cache);
+    slot = &iterator->cache->header->deleted_list;
+    while ((*slot) && count <= iterator->slot_idx) {
+        count++;
+        slot = &(*slot)->next;
+    }
+    count = 0;
+    while ((*slot) && count < iterator->chunk_size) {
+        if (apc_iterator_search_match(iterator, slot)) {
+            count++;
+            item = apc_iterator_item_ctor(iterator, slot TSRMLS_CC);
+            if (item) {
+                apc_stack_push(iterator->stack, item TSRMLS_CC);
+            }
+        }
+        slot = &(*slot)->next;
+    }
+    CACHE_UNLOCK(iterator->cache);
+    iterator->slot_idx += count;
+    iterator->stack_idx = 0;
+    return count;
+}
+/* }}} */
+
+/* {{{ apc_iterator_totals */
+static void apc_iterator_totals(apc_iterator_t *iterator TSRMLS_DC) {
+    slot_t **slot;
+    int i;
+
+    CACHE_LOCK(iterator->cache);
+    for (i=0; i < iterator->cache->num_slots; i++) {
+        slot = &iterator->cache->slots[i];
+        while((*slot)) {
+            if (apc_iterator_search_match(iterator, slot)) {
+                iterator->size += (*slot)->value->mem_size;
+                iterator->hits += (*slot)->num_hits;
+                iterator->count++;
+            }
+            slot = &(*slot)->next;
+        }
+    }
+    CACHE_UNLOCK(iterator->cache);
+    iterator->totals_flag = 1;
+}
+/* }}} */
+
+/* {{{ proto object APCIterator::__costruct(string cache [, mixed search [, long format [, long chunk_size [, long list ]]]]) */
+PHP_METHOD(apc_iterator, __construct) {
+    zval *object = getThis();
+    apc_iterator_t *iterator = (apc_iterator_t*)zend_object_store_get_object(object TSRMLS_CC);
+    char *cachetype;
+    int cachetype_len;
+    long format = APC_ITER_ALL;
+    long chunk_size=0;
+    zval *search = NULL;
+    long list = APC_LIST_ACTIVE;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|zlll", &cachetype, &cachetype_len, &search, &format, &chunk_size, &list) == FAILURE) {
+        return;
+    }
+
+    if (!APCG(enabled)) {
+        apc_error("APC must be enabled to use APCIterator." TSRMLS_CC);
+    }
+
+    if (chunk_size < 0) {
+        apc_error("APCIterator chunk size must be 0 or greater." TSRMLS_CC);
+        return;
+    }
+
+    if (format > APC_ITER_ALL) {
+        apc_error("APCIterator format is invalid." TSRMLS_CC);
+        return;
+    }
+
+    if (list == APC_LIST_ACTIVE) {
+        iterator->fetch = apc_iterator_fetch_active;
+    } else if (list == APC_LIST_DELETED) {
+        iterator->fetch = apc_iterator_fetch_deleted;
+    } else {
+        apc_warning("APCIterator invalid list type." TSRMLS_CC);
+        return;
+    }
+
+    if(!strcasecmp(cachetype,"user")) {
+        iterator->cache = apc_user_cache;
+    } else {
+        iterator->cache = apc_cache;
+    }
+
+    iterator->slot_idx = 0;
+    iterator->stack_idx = 0;
+    iterator->key_idx = 0;
+    iterator->chunk_size = chunk_size == 0 ? APC_DEFAULT_CHUNK_SIZE : chunk_size;
+    iterator->stack = apc_stack_create(chunk_size TSRMLS_CC);
+    iterator->format = format;
+    iterator->totals_flag = 0;
+    iterator->count = 0;
+    iterator->size = 0;
+    iterator->hits = 0;
+    iterator->regex = NULL;
+    iterator->regex_len = 0;
+    iterator->search_hash = NULL;
+    if (search && Z_TYPE_P(search) == IS_STRING && Z_STRLEN_P(search)) {
+#ifdef ITERATOR_PCRE
+        iterator->regex = estrndup(Z_STRVAL_P(search), Z_STRLEN_P(search));
+        iterator->regex_len = Z_STRLEN_P(search);
+        iterator->re = pcre_get_compiled_regex(Z_STRVAL_P(search), NULL, NULL TSRMLS_CC);
+
+        if(!iterator->re) {
+            apc_error("Could not compile regular expression: %s" TSRMLS_CC, Z_STRVAL_P(search));
+        }
+#else
+        apc_error("Regular expressions support is not enabled, please enable PCRE for APCIterator regex support" TSRMLS_CC);
+#endif
+    } else if (search && Z_TYPE_P(search) == IS_ARRAY) {
+        Z_ADDREF_P(search);
+        iterator->search_hash = apc_flip_hash(Z_ARRVAL_P(search));
+    }
+    iterator->initialized = 1;
+}
+/* }}} */
+
+/* {{{ proto APCIterator::rewind() */
+PHP_METHOD(apc_iterator, rewind) {
+    apc_iterator_t *iterator = (apc_iterator_t*)zend_object_store_get_object(getThis() TSRMLS_CC);
+
+    if (zend_parse_parameters_none() == FAILURE) {
+        return;
+    }
+
+    if (iterator->initialized == 0) {
+        RETURN_FALSE;
+    }
+
+    iterator->slot_idx = 0;
+    iterator->stack_idx = 0;
+    iterator->key_idx = 0;
+    iterator->fetch(iterator TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ proto boolean APCIterator::valid() */
+PHP_METHOD(apc_iterator, valid) {
+    apc_iterator_t *iterator = (apc_iterator_t*)zend_object_store_get_object(getThis() TSRMLS_CC);
+
+    if (zend_parse_parameters_none() == FAILURE) {
+        return;
+    }
+
+    if (iterator->initialized == 0) {
+        RETURN_FALSE;
+    }
+
+    if (apc_stack_size(iterator->stack) == iterator->stack_idx) {
+        iterator->fetch(iterator TSRMLS_CC);
+    }
+
+    RETURN_BOOL(apc_stack_size(iterator->stack) == 0 ? 0 : 1);
+}
+/* }}} */
+
+/* {{{ proto mixed APCIterator::current() */
+PHP_METHOD(apc_iterator, current) {
+    apc_iterator_item_t *item;
+    apc_iterator_t *iterator = (apc_iterator_t*)zend_object_store_get_object(getThis() TSRMLS_CC);
+
+    if (zend_parse_parameters_none() == FAILURE) {
+        return;
+    }
+
+    if (iterator->initialized == 0) {
+        RETURN_FALSE;
+    }
+
+    if (apc_stack_size(iterator->stack) == iterator->stack_idx) {
+        if (iterator->fetch(iterator TSRMLS_CC) == 0) {
+            RETURN_FALSE;
+        }
+    }
+
+    item = apc_stack_get(iterator->stack, iterator->stack_idx);
+    RETURN_ZVAL(item->value, 1, 0);
+}
+/* }}} */
+
+/* {{{ proto string APCIterator::key() */
+PHP_METHOD(apc_iterator, key) {
+    apc_iterator_item_t *item;
+    apc_iterator_t *iterator = (apc_iterator_t*)zend_object_store_get_object(getThis() TSRMLS_CC);
+
+    if (zend_parse_parameters_none() == FAILURE) {
+        return;
+    }
+
+    if (iterator->initialized == 0 || apc_stack_size(iterator->stack) == 0) {
+        RETURN_FALSE;
+    }
+
+    if (apc_stack_size(iterator->stack) == iterator->stack_idx) {
+        if (iterator->fetch(iterator TSRMLS_CC) == 0) {
+            RETURN_FALSE;
+        }
+    }
+
+    item = apc_stack_get(iterator->stack, iterator->stack_idx);
+
+    if (item->key) {
+        RETURN_STRINGL(item->key, (item->key_len-1), 1);
+    } else {
+        RETURN_LONG(iterator->key_idx);
+    }
+}
+/* }}} */
+
+/* {{{ proto APCIterator::next() */
+PHP_METHOD(apc_iterator, next) {
+    apc_iterator_t *iterator = (apc_iterator_t*)zend_object_store_get_object(getThis() TSRMLS_CC);
+
+    if (zend_parse_parameters_none() == FAILURE) {
+        return;
+    }
+
+    if (iterator->initialized == 0 || apc_stack_size(iterator->stack) == 0) {
+        RETURN_FALSE;
+    }
+
+    iterator->stack_idx++;
+    iterator->key_idx++;
+
+    RETURN_TRUE;
+}
+/* }}} */
+
+/* {{{ proto long APCIterator::getTotalHits() */
+PHP_METHOD(apc_iterator, getTotalHits) {
+    apc_iterator_t *iterator = (apc_iterator_t*)zend_object_store_get_object(getThis() TSRMLS_CC);
+
+    if (zend_parse_parameters_none() == FAILURE) {
+        return;
+    }
+
+    if (iterator->initialized == 0) {
+        RETURN_FALSE;
+    }
+
+    if (iterator->totals_flag == 0) {
+        apc_iterator_totals(iterator TSRMLS_CC);
+    }
+
+    RETURN_LONG(iterator->hits);
+}
+/* }}} */
+
+/* {{{ proto long APCIterator::getTotalSize() */
+PHP_METHOD(apc_iterator, getTotalSize) {
+    apc_iterator_t *iterator = (apc_iterator_t*)zend_object_store_get_object(getThis() TSRMLS_CC);
+
+    if (zend_parse_parameters_none() == FAILURE) {
+        return;
+    }
+
+    if (iterator->initialized == 0) {
+        RETURN_FALSE;
+    }
+
+    if (iterator->totals_flag == 0) {
+        apc_iterator_totals(iterator TSRMLS_CC);
+    }
+
+    RETURN_LONG(iterator->size);
+}
+/* }}} */
+
+/* {{{ proto long APCIterator::getTotalCount() */
+PHP_METHOD(apc_iterator, getTotalCount) {
+    apc_iterator_t *iterator = (apc_iterator_t*)zend_object_store_get_object(getThis() TSRMLS_CC);
+
+    if (zend_parse_parameters_none() == FAILURE) {
+        return;
+    }
+
+    if (iterator->initialized == 0) {
+        RETURN_FALSE;
+    }
+
+    if (iterator->totals_flag == 0) {
+        apc_iterator_totals(iterator TSRMLS_CC);
+    }
+
+    RETURN_LONG(iterator->count);
+}
+/* }}} */
+
+/* {{{ arginfo */
+#if (PHP_MAJOR_VERSION >= 6 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION >= 3))
+# define PHP_APC_ARGINFO
+#else
+# define PHP_APC_ARGINFO static
+#endif
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_iterator___construct, 0, 0, 1)
+	ZEND_ARG_INFO(0, cache)
+	ZEND_ARG_INFO(0, search)
+	ZEND_ARG_INFO(0, format)
+	ZEND_ARG_INFO(0, chunk_size)
+	ZEND_ARG_INFO(0, list)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_iterator_void, 0, 0, 0)
+ZEND_END_ARG_INFO()
+/* }}} */
+
+/* {{{ apc_iterator_functions */
+static zend_function_entry apc_iterator_functions[] = {
+    PHP_ME(apc_iterator, __construct, arginfo_apc_iterator___construct, ZEND_ACC_PUBLIC|ZEND_ACC_CTOR)
+    PHP_ME(apc_iterator, rewind, arginfo_apc_iterator_void, ZEND_ACC_PUBLIC)
+    PHP_ME(apc_iterator, current, arginfo_apc_iterator_void, ZEND_ACC_PUBLIC)
+    PHP_ME(apc_iterator, key, arginfo_apc_iterator_void, ZEND_ACC_PUBLIC)
+    PHP_ME(apc_iterator, next, arginfo_apc_iterator_void, ZEND_ACC_PUBLIC)
+    PHP_ME(apc_iterator, valid, arginfo_apc_iterator_void, ZEND_ACC_PUBLIC)
+    PHP_ME(apc_iterator, getTotalHits, arginfo_apc_iterator_void, ZEND_ACC_PUBLIC)
+    PHP_ME(apc_iterator, getTotalSize, arginfo_apc_iterator_void, ZEND_ACC_PUBLIC)
+    PHP_ME(apc_iterator, getTotalCount, arginfo_apc_iterator_void, ZEND_ACC_PUBLIC)
+    {NULL, NULL, NULL}
+};
+/* }}} */
+
+/* {{{ apc_iterator_init */
+int apc_iterator_init(int module_number TSRMLS_DC) {
+    zend_class_entry ce;
+
+    INIT_CLASS_ENTRY(ce, APC_ITERATOR_NAME, apc_iterator_functions);
+    apc_iterator_ce = zend_register_internal_class(&ce TSRMLS_CC);
+    apc_iterator_ce->create_object = apc_iterator_create;
+    zend_class_implements(apc_iterator_ce TSRMLS_CC, 1, zend_ce_iterator);
+
+    zend_register_long_constant("APC_LIST_ACTIVE", sizeof("APC_LIST_ACTIVE"), APC_LIST_ACTIVE, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_LIST_DELETED", sizeof("APC_LIST_DELETED"), APC_LIST_DELETED, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+
+    zend_register_long_constant("APC_ITER_TYPE", sizeof("APC_ITER_TYPE"), APC_ITER_TYPE, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_KEY", sizeof("APC_ITER_KEY"), APC_ITER_KEY, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_FILENAME", sizeof("APC_ITER_FILENAME"), APC_ITER_FILENAME, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_DEVICE", sizeof("APC_ITER_DEVICE"), APC_ITER_DEVICE, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_INODE", sizeof("APC_ITER_INODE"), APC_ITER_INODE, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_VALUE", sizeof("APC_ITER_VALUE"), APC_ITER_VALUE, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_MD5", sizeof("APC_ITER_MD5"), APC_ITER_MD5, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_NUM_HITS", sizeof("APC_ITER_NUM_HITS"), APC_ITER_NUM_HITS, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_MTIME", sizeof("APC_ITER_MTIME"), APC_ITER_MTIME, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_CTIME", sizeof("APC_ITER_CTIME"), APC_ITER_CTIME, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_DTIME", sizeof("APC_ITER_DTIME"), APC_ITER_DTIME, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_ATIME", sizeof("APC_ITER_ATIME"), APC_ITER_ATIME, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_REFCOUNT", sizeof("APC_ITER_REFCOUNT"), APC_ITER_REFCOUNT, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_MEM_SIZE", sizeof("APC_ITER_MEM_SIZE"), APC_ITER_MEM_SIZE, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_TTL", sizeof("APC_ITER_TTL"), APC_ITER_TTL, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_NONE", sizeof("APC_ITER_NONE"), APC_ITER_NONE, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+    zend_register_long_constant("APC_ITER_ALL", sizeof("APC_ITER_ALL"), APC_ITER_ALL, CONST_PERSISTENT | CONST_CS, module_number TSRMLS_CC);
+
+    memcpy(&apc_iterator_object_handlers, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
+    apc_iterator_object_handlers.clone_obj = apc_iterator_clone;
+
+    return SUCCESS;
+}
+/* }}} */
+
+/* {{{ apc_iterator_delete */
+int apc_iterator_delete(zval *zobj TSRMLS_DC) {
+    apc_iterator_t *iterator;
+    zend_class_entry *ce = Z_OBJCE_P(zobj);
+    apc_iterator_item_t *item;
+
+    if (!ce || !instanceof_function(ce, apc_iterator_ce TSRMLS_CC)) {
+        apc_error("apc_delete object argument must be instance of APCIterator" TSRMLS_CC);
+        return 0;
+    }
+    iterator = (apc_iterator_t*)zend_object_store_get_object(zobj TSRMLS_CC);
+
+    if (iterator->initialized == 0) {
+        return 0;
+    }
+
+    while (iterator->fetch(iterator TSRMLS_CC)) {
+        while (iterator->stack_idx < apc_stack_size(iterator->stack)) {
+            item = apc_stack_get(iterator->stack, iterator->stack_idx++);
+            if (iterator->cache == apc_cache) {
+                apc_cache_delete(apc_cache, item->filename_key, strlen(item->filename_key) + 1 TSRMLS_CC);
+            } else {
+                apc_cache_user_delete(apc_user_cache, item->key, item->key_len TSRMLS_CC);
+            }
+        }
+    }
+
+    return 1;
+}
+/* }}} */
+
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_iterator.h php-5.4.19.bak/ext/apc/apc_iterator.h
--- php-5.4.19/ext/apc/apc_iterator.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_iterator.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,117 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Brian Shire <shire@.php.net>                                |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: apc_iterator.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_ITERATOR_H
+#define APC_ITERATOR_H
+
+#include "apc.h"
+#include "apc_stack.h"
+
+#if HAVE_PCRE || HAVE_BUNDLED_PCRE
+/*  Deal with problem present until php-5.2.2 where php_pcre.h was not installed correctly */
+#   if !HAVE_BUNDLED_PCRE && PHP_MAJOR_VERSION == 5 && (PHP_MINOR_VERSION < 2 || (PHP_MINOR_VERSION == 2 && PHP_RELEASE_VERSION < 2))
+#       include "apc_php_pcre.h"
+#   else
+#       include "ext/pcre/php_pcre.h"
+#   endif
+#   include "ext/standard/php_smart_str.h"
+#   define ITERATOR_PCRE 1
+#endif
+
+
+#define APC_ITERATOR_NAME "APCIterator"
+
+#define APC_DEFAULT_CHUNK_SIZE 100
+
+#define APC_LIST_ACTIVE   0x1
+#define APC_LIST_DELETED  0x2
+
+#define APC_ITER_TYPE       (1L << 0) 
+#define APC_ITER_KEY        (1L << 1) 
+#define APC_ITER_FILENAME   (1L << 2) 
+#define APC_ITER_DEVICE     (1L << 3) 
+#define APC_ITER_INODE      (1L << 4) 
+#define APC_ITER_VALUE      (1L << 5) 
+#define APC_ITER_MD5        (1L << 6) 
+#define APC_ITER_NUM_HITS   (1L << 7) 
+#define APC_ITER_MTIME      (1L << 8) 
+#define APC_ITER_CTIME      (1L << 9) 
+#define APC_ITER_DTIME      (1L << 10) 
+#define APC_ITER_ATIME      (1L << 11) 
+#define APC_ITER_REFCOUNT   (1L << 12) 
+#define APC_ITER_MEM_SIZE   (1L << 13) 
+#define APC_ITER_TTL        (1L << 14)
+
+#define APC_ITER_NONE       (0x00000000L)
+#define APC_ITER_ALL        (0xffffffffL)
+
+typedef void* (*apc_iterator_item_cb_t)(slot_t **slot);
+
+
+/* {{{ apc_iterator_t */
+typedef struct _apc_iterator_t {
+    zend_object obj;         /* must always be first */
+    short int initialized;   /* sanity check in case __construct failed */
+    long format;             /* format bitmask of the return values ie: key, value, info */
+    int (*fetch)(struct _apc_iterator_t *iterator TSRMLS_DC);
+                             /* fetch callback to fetch items from cache slots or lists */
+    apc_cache_t *cache;      /* cache which we are iterating on */
+    long slot_idx;           /* index to the slot array or linked list */
+    long chunk_size;         /* number of entries to pull down per fetch */
+    apc_stack_t *stack;      /* stack of entries pulled from cache */
+    int stack_idx;           /* index into the current stack */
+#ifdef ITERATOR_PCRE
+    pcre *re;                /* regex filter on entry identifiers */
+#endif
+    char *regex;             /* original regex expression or NULL */
+    int regex_len;           /* regex length */
+    HashTable *search_hash;  /* hash of keys to iterate over */
+    long key_idx;            /* incrementing index for numerical keys */
+    short int totals_flag;   /* flag if totals have been calculated */
+    long hits;               /* hit total */
+    size_t size;             /* size total */
+    long count;              /* count total */
+} apc_iterator_t;
+/* }}} */
+
+/* {{{ apc_iterator_item */
+typedef struct _apc_iterator_item_t {
+    char *key;              /* string key */
+    long key_len;           /* strlen of key */
+    char *filename_key;     /* filename key used for deletion */
+    zval *value;
+} apc_iterator_item_t;
+/* }}} */
+
+
+extern int apc_iterator_init(int module_number TSRMLS_DC);
+extern int apc_iterator_delete(zval *zobj TSRMLS_DC);
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_lock.h php-5.4.19.bak/ext/apc/apc_lock.h
--- php-5.4.19/ext/apc/apc_lock.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_lock.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,160 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: George Schlossnagle <george@omniti.com>                     |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  |          Pierre Joye <pierre@php.net>                                |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_lock.h 311339 2011-05-22 17:18:49Z gopalv $ */
+
+#ifndef APC_LOCK
+#define APC_LOCK
+
+#ifdef HAVE_CONFIG_H
+# include <config.h>
+#endif
+
+#include "apc.h"
+#include "apc_sem.h"
+#include "apc_fcntl.h"
+#include "apc_pthreadmutex.h"
+#include "apc_pthreadrwlock.h"
+#include "apc_spin.h"
+#include "apc_windows_srwlock_kernel.h"
+
+/* {{{ generic locking macros */
+#define CREATE_LOCK(lock)     apc_lck_create(NULL, 0, 1, lock)
+#define DESTROY_LOCK(lock)    apc_lck_destroy(lock)
+#define LOCK(lock)          { HANDLE_BLOCK_INTERRUPTIONS(); apc_lck_lock(lock); }
+#define RDLOCK(lock)        { HANDLE_BLOCK_INTERRUPTIONS(); apc_lck_rdlock(lock); }
+#define UNLOCK(lock)        { apc_lck_unlock(lock); HANDLE_UNBLOCK_INTERRUPTIONS(); }
+#define RDUNLOCK(lock)      { apc_lck_rdunlock(lock); HANDLE_UNBLOCK_INTERRUPTIONS(); }
+/* }}} */
+
+/* atomic operations : rdlocks are impossible without these */
+#if HAVE_ATOMIC_OPERATIONS
+# ifdef PHP_WIN32
+#  define ATOMIC_INC(a) InterlockedIncrement(&a)
+#  define ATOMIC_DEC(a) InterlockedDecrement(&a)
+# else
+#  define ATOMIC_INC(a) __sync_add_and_fetch(&a, 1)
+#  define ATOMIC_DEC(a) __sync_sub_and_fetch(&a, 1)
+# endif
+#endif
+
+#if defined(APC_SEM_LOCKS)
+# define APC_LOCK_TYPE "IPC Semaphore"
+# define RDLOCK_AVAILABLE 0
+# define NONBLOCKING_LOCK_AVAILABLE 1 
+# define apc_lck_t int
+# define apc_lck_create(a,b,c,d) d=apc_sem_create((b),(c) TSRMLS_CC)
+# define apc_lck_destroy(a)    apc_sem_destroy(a)
+# define apc_lck_lock(a)       apc_sem_lock(a TSRMLS_CC)
+# define apc_lck_nb_lock(a)    apc_sem_nonblocking_lock(a TSRMLS_CC)
+# define apc_lck_rdlock(a)     apc_sem_lock(a TSRMLS_CC)
+# define apc_lck_unlock(a)     apc_sem_unlock(a TSRMLS_CC)
+# define apc_lck_rdunlock(a)   apc_sem_unlock(a TSRMLS_CC)
+#elif defined(APC_PTHREADMUTEX_LOCKS)
+# define APC_LOCK_TYPE "pthread mutex Locks"
+# define RDLOCK_AVAILABLE 0
+# define NONBLOCKING_LOCK_AVAILABLE 1
+# define apc_lck_t pthread_mutex_t 
+# define apc_lck_create(a,b,c,d) apc_pthreadmutex_create((pthread_mutex_t*)&d TSRMLS_CC)
+# define apc_lck_destroy(a)    apc_pthreadmutex_destroy(&a)
+# define apc_lck_lock(a)       apc_pthreadmutex_lock(&a TSRMLS_CC)
+# define apc_lck_nb_lock(a)    apc_pthreadmutex_nonblocking_lock(&a TSRMLS_CC)
+# define apc_lck_rdlock(a)     apc_pthreadmutex_lock(&a TSRMLS_CC)
+# define apc_lck_unlock(a)     apc_pthreadmutex_unlock(&a TSRMLS_CC)
+# define apc_lck_rdunlock(a)   apc_pthreadmutex_unlock(&a TSRMLS_CC)
+#elif defined(APC_PTHREADRW_LOCKS)
+# define APC_LOCK_TYPE "pthread read/write Locks"
+# define RDLOCK_AVAILABLE 1
+# define NONBLOCKING_LOCK_AVAILABLE 1
+# define apc_lck_t pthread_rwlock_t 
+# define apc_lck_create(a,b,c,d) apc_pthreadrwlock_create((pthread_rwlock_t*)&d TSRMLS_CC)
+# define apc_lck_destroy(a)    apc_pthreadrwlock_destroy(&a)
+# define apc_lck_lock(a)       apc_pthreadrwlock_lock(&a TSRMLS_CC)
+# define apc_lck_nb_lock(a)    apc_pthreadrwlock_nonblocking_lock(&a TSRMLS_CC)
+# define apc_lck_rdlock(a)     apc_pthreadrwlock_rdlock(&a TSRMLS_CC)
+# define apc_lck_unlock(a)     apc_pthreadrwlock_unlock(&a TSRMLS_CC)
+# define apc_lck_rdunlock(a)   apc_pthreadrwlock_unlock(&a TSRMLS_CC)
+#elif defined(APC_SPIN_LOCKS)
+# define APC_LOCK_TYPE "spin Locks"
+# define RDLOCK_AVAILABLE 0
+# define NONBLOCKING_LOCK_AVAILABLE APC_SLOCK_NONBLOCKING_LOCK_AVAILABLE
+# define apc_lck_t slock_t 
+# define apc_lck_create(a,b,c,d) apc_slock_create((slock_t*)&(d))
+# define apc_lck_destroy(a)    apc_slock_destroy(&a)
+# define apc_lck_lock(a)       apc_slock_lock(&a TSRMLS_CC)
+# define apc_lck_nb_lock(a)    apc_slock_nonblocking_lock(&a)
+# define apc_lck_rdlock(a)     apc_slock_lock(&a TSRMLS_CC)
+# define apc_lck_unlock(a)     apc_slock_unlock(&a)
+# define apc_lck_rdunlock(a)   apc_slock_unlock(&a)
+#elif defined(APC_SRWLOCK_NATIVE) && defined(PHP_WIN32)
+# define APC_LOCK_TYPE "Windows Slim RWLOCK (native)"
+# define RDLOCK_AVAILABLE 1
+# define NONBLOCKING_LOCK_AVAILABLE 0
+# define apc_lck_t SRWLOCK
+# define apc_lck_create(a,b,c,d) InitializeSRWLock((SRWLOCK*)&(d))
+# define apc_lck_destroy(a)
+# define apc_lck_lock(a)       AcquireSRWLockExclusive(&a)
+# define apc_lck_rdlock(a)     AcquireSRWLockShared(&a)
+# define apc_lck_unlock(a)     ReleaseSRWLockExclusive(&a)
+# define apc_lck_rdunlock(a)   ReleaseSRWLockShared(&a)
+# if NONBLOCKING_LOCK_AVAILABLE==1 /* Only in win7/2008 */
+#  define apc_lck_nb_lock(a)    (TryAcquireSRWLockExclusive(&a TSRMLS_CC) == 0 ? 1 : 0);
+# endif
+#elif defined(APC_SRWLOCK_KERNEL) && defined(PHP_WIN32)
+# define APC_LOCK_TYPE "Windows Slim RWLOCK (kernel)"
+# define RDLOCK_AVAILABLE 1
+# define NONBLOCKING_LOCK_AVAILABLE 0
+# define apc_lck_t apc_windows_cs_rwlock_t
+# define apc_lck_create(a,b,c,d) apc_windows_cs_create((apc_windows_cs_rwlock_t*)&(d) TSRMLS_CC)
+# define apc_lck_destroy(a)      apc_windows_cs_destroy(&a);
+# define apc_lck_lock(a)         apc_windows_cs_lock(&a TSRMLS_CC)
+# define apc_lck_rdlock(a)       apc_windows_cs_rdlock(&a TSRMLS_CC)
+# define apc_lck_unlock(a)       apc_windows_cs_unlock_wr(&a TSRMLS_CC)
+# define apc_lck_rdunlock(a)     apc_windows_cs_unlock_rd(&a TSRMLS_CC)
+#else
+# define APC_LOCK_TYPE "File Locks"
+# ifdef HAVE_ATOMIC_OPERATIONS
+#  define RDLOCK_AVAILABLE 1
+# endif
+# ifdef PHP_WIN32
+#  define NONBLOCKING_LOCK_AVAILABLE 0
+# else
+#  define NONBLOCKING_LOCK_AVAILABLE 1
+# endif
+# define apc_lck_t int
+# define apc_lck_create(a,b,c,d) d=apc_fcntl_create((a) TSRMLS_CC)
+# define apc_lck_destroy(a)    apc_fcntl_destroy(a)
+# define apc_lck_lock(a)       apc_fcntl_lock(a TSRMLS_CC)
+# define apc_lck_nb_lock(a)    apc_fcntl_nonblocking_lock(a TSRMLS_CC)
+# define apc_lck_rdlock(a)     apc_fcntl_rdlock(a TSRMLS_CC)
+# define apc_lck_unlock(a)     apc_fcntl_unlock(a TSRMLS_CC)
+# define apc_lck_rdunlock(a)   apc_fcntl_unlock(a TSRMLS_CC)
+#endif
+
+#endif
diff -Nru php-5.4.19/ext/apc/apc_main.c php-5.4.19.bak/ext/apc/apc_main.c
--- php-5.4.19/ext/apc/apc_main.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_main.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,1066 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_main.c 327102 2012-08-13 13:04:46Z ab $ */
+
+#include "apc_php.h"
+#include "apc_main.h"
+#include "apc.h"
+#include "apc_lock.h"
+#include "apc_cache.h"
+#include "apc_compile.h"
+#include "apc_globals.h"
+#include "apc_sma.h"
+#include "apc_stack.h"
+#include "apc_zend.h"
+#include "apc_pool.h"
+#include "apc_string.h"
+#include "SAPI.h"
+#include "php_scandir.h"
+#include "ext/standard/php_var.h"
+#include "ext/standard/md5.h"
+
+#define APC_MAX_SERIALIZERS 16
+
+/* {{{ module variables */
+
+/* pointer to the original Zend engine compile_file function */
+typedef zend_op_array* (zend_compile_t)(zend_file_handle*, int TSRMLS_DC);
+static zend_compile_t *old_compile_file;
+static apc_serializer_t apc_serializers[APC_MAX_SERIALIZERS] = {{0,}};
+
+/* }}} */
+
+/* {{{ get/set old_compile_file (to interact with other extensions that need the compile hook) */
+static zend_compile_t* set_compile_hook(zend_compile_t *ptr)
+{
+    zend_compile_t *retval = old_compile_file;
+
+    if (ptr != NULL) old_compile_file = ptr;
+    return retval;
+}
+/* }}} */
+
+/* {{{ install_function */
+static int install_function(apc_function_t fn, apc_context_t* ctxt, int lazy TSRMLS_DC)
+{
+    int status;
+
+#if APC_HAVE_LOOKUP_HOOKS
+    if(lazy && fn.name[0] != '\0' && strncmp(fn.name, "__autoload", fn.name_len) != 0) {
+        status = zend_hash_add(APCG(lazy_function_table),
+                              fn.name,
+                              fn.name_len+1,
+                              &fn,
+                              sizeof(apc_function_t),
+                              NULL);
+#else
+    if(0) {
+#endif
+    } else {
+        zend_function *func = apc_copy_function_for_execution(fn.function, ctxt TSRMLS_CC);
+        status = zend_hash_add(EG(function_table),
+                              fn.name,
+                              fn.name_len+1,
+                              func,
+                              sizeof(zend_function),
+                              NULL);
+        efree(func);
+    }
+
+    if (status == FAILURE) {
+        /* apc_error("Cannot redeclare %s()" TSRMLS_CC, fn.name); */
+    }
+
+    return status;
+}
+/* }}} */
+
+/* {{{ apc_lookup_function_hook */
+int apc_lookup_function_hook(char *name, int len, ulong hash, zend_function **fe) {
+    apc_function_t *fn;
+    int status = FAILURE;
+    apc_context_t ctxt = {0,};
+    TSRMLS_FETCH();
+
+    ctxt.pool = apc_pool_create(APC_UNPOOL, apc_php_malloc, apc_php_free, apc_sma_protect, apc_sma_unprotect TSRMLS_CC);
+    ctxt.copy = APC_COPY_OUT_OPCODE;
+
+    if(zend_hash_quick_find(APCG(lazy_function_table), name, len, hash, (void**)&fn) == SUCCESS) {
+        *fe = apc_copy_function_for_execution(fn->function, &ctxt TSRMLS_CC);
+        status = zend_hash_add(EG(function_table),
+                                  fn->name,
+                                  fn->name_len+1,
+                                  *fe,
+                                  sizeof(zend_function),
+                                  NULL);
+    }
+
+    return status;
+}
+/* }}} */
+
+/* {{{ install_class */
+static int install_class(apc_class_t cl, apc_context_t* ctxt, int lazy TSRMLS_DC)
+{
+    zend_class_entry* class_entry = cl.class_entry;
+    zend_class_entry* parent = NULL;
+    int status;
+
+    /* Special case for mangled names. Mangled names are unique to a file.
+     * There is no way two classes with the same mangled name will occur,
+     * unless a file is included twice. And if in case, a file is included
+     * twice, all mangled name conflicts can be ignored and the class redeclaration
+     * error may be deferred till runtime of the corresponding DECLARE_CLASS
+     * calls.
+     */
+
+    if(cl.name_len != 0 && cl.name[0] == '\0') {
+        if(zend_hash_exists(CG(class_table), cl.name, cl.name_len+1)) {
+            return SUCCESS;
+        }
+    }
+
+    if(lazy && cl.name_len != 0 && cl.name[0] != '\0') {
+        status = zend_hash_add(APCG(lazy_class_table),
+                               cl.name,
+                               cl.name_len+1,
+                               &cl,
+                               sizeof(apc_class_t),
+                               NULL);
+        if(status == FAILURE) {
+            zend_error(E_ERROR, "Cannot redeclare class %s", cl.name);
+        }
+        return status;
+    }
+
+    class_entry =
+        apc_copy_class_entry_for_execution(cl.class_entry, ctxt TSRMLS_CC);
+
+
+    /* restore parent class pointer for compile-time inheritance */
+    if (cl.parent_name != NULL) {
+        zend_class_entry** parent_ptr = NULL;
+        /*
+         * __autoload brings in the old issues with mixed inheritance.
+         * When a statically inherited class triggers autoload, it runs
+         * afoul of a potential require_once "parent.php" in the previous 
+         * line, which when executed provides the parent class, but right
+         * now goes and hits __autoload which could fail. 
+         * 
+         * missing parent == re-compile. 
+         *
+         * whether __autoload is enabled or not, because __autoload errors
+         * cause php to die.
+         *
+         * Aside: Do NOT pass *strlen(cl.parent_name)+1* because
+         * zend_lookup_class_ex does it internally anyway!
+         */
+        status = zend_lookup_class_ex(cl.parent_name,
+                                    strlen(cl.parent_name), 
+#ifdef ZEND_ENGINE_2_4
+                                    NULL,
+#endif
+                                    0,
+                                    &parent_ptr TSRMLS_CC);
+        if (status == FAILURE) {
+            if(APCG(report_autofilter)) {
+                apc_warning("Dynamic inheritance detected for class %s" TSRMLS_CC, cl.name);
+            }
+            class_entry->parent = NULL;
+            return status;
+        }
+        else {
+            parent = *parent_ptr;
+            class_entry->parent = parent;
+            zend_do_inheritance(class_entry, parent TSRMLS_CC);
+        }
+    }
+
+    status = zend_hash_add(EG(class_table),
+                           cl.name,
+                           cl.name_len+1,
+                           &class_entry,
+                           sizeof(zend_class_entry*),
+                           NULL);
+
+    if (status == FAILURE) {
+        apc_error("Cannot redeclare class %s" TSRMLS_CC, cl.name);
+    }
+
+    return status;
+}
+/* }}} */
+
+/* {{{ apc_lookup_class_hook */
+int apc_lookup_class_hook(char *name, int len, ulong hash, zend_class_entry ***ce) {
+
+    apc_class_t *cl;
+    apc_context_t ctxt = {0,};
+    TSRMLS_FETCH();
+
+    if(zend_is_compiling(TSRMLS_C)) { return FAILURE; }
+
+    if(zend_hash_quick_find(APCG(lazy_class_table), name, len, hash, (void**)&cl) == FAILURE) {
+        return FAILURE;
+    }
+
+    ctxt.pool = apc_pool_create(APC_UNPOOL, apc_php_malloc, apc_php_free, apc_sma_protect, apc_sma_unprotect TSRMLS_CC);
+    ctxt.copy = APC_COPY_OUT_OPCODE;
+
+    if(install_class(*cl, &ctxt, 0 TSRMLS_CC) == FAILURE) {
+        apc_warning("apc_lookup_class_hook: could not install %s" TSRMLS_CC, name);
+        return FAILURE;
+    }
+
+    if(zend_hash_quick_find(EG(class_table), name, len, hash, (void**)ce) == FAILURE) {
+        apc_warning("apc_lookup_class_hook: known error trying to fetch class %s" TSRMLS_CC, name);
+        return FAILURE;
+    }
+
+    return SUCCESS;
+
+}
+/* }}} */
+
+/* {{{ uninstall_class */
+static int uninstall_class(apc_class_t cl TSRMLS_DC)
+{
+    int status;
+
+    status = zend_hash_del(EG(class_table),
+                           cl.name,
+                           cl.name_len+1);
+    if (status == FAILURE) {
+        apc_error("Cannot delete class %s" TSRMLS_CC, cl.name);
+    }
+    return status;
+}
+/* }}} */
+
+/* {{{ copy_function_name (taken from zend_builtin_functions.c to ensure future compatibility with APC) */
+static int copy_function_name(apc_function_t *pf TSRMLS_DC, int num_args, va_list args, zend_hash_key *hash_key)
+{
+    zval *internal_ar = va_arg(args, zval *),
+         *user_ar     = va_arg(args, zval *);
+    zend_function *func = pf->function;
+
+    if (hash_key->nKeyLength == 0 || hash_key->arKey[0] == 0) {
+        return 0;
+    }
+
+    if (func->type == ZEND_INTERNAL_FUNCTION) {
+        add_next_index_stringl(internal_ar, hash_key->arKey, hash_key->nKeyLength-1, 1);
+    } else if (func->type == ZEND_USER_FUNCTION) {
+        add_next_index_stringl(user_ar, hash_key->arKey, hash_key->nKeyLength-1, 1);
+    }
+
+    return 0;
+}
+
+/* {{{ copy_class_or_interface_name (taken from zend_builtin_functions.c to ensure future compatibility with APC) */
+static int copy_class_or_interface_name(apc_class_t *cl TSRMLS_DC, int num_args, va_list args, zend_hash_key *hash_key)
+{
+    zval *array = va_arg(args, zval *);
+    zend_uint mask = va_arg(args, zend_uint);
+    zend_uint comply = va_arg(args, zend_uint);
+    zend_uint comply_mask = (comply)? mask:0;
+    zend_class_entry *ce  = cl->class_entry;
+
+    if ((hash_key->nKeyLength==0 || hash_key->arKey[0]!=0)
+        && (comply_mask == (ce->ce_flags & mask))) {
+        add_next_index_stringl(array, ce->name, ce->name_length, 1);
+    }
+    return ZEND_HASH_APPLY_KEEP;
+}
+/* }}} */
+
+/* }}} */
+
+/* {{{ apc_defined_function_hook */
+int apc_defined_function_hook(zval *internal, zval *user) {
+    TSRMLS_FETCH();
+    zend_hash_apply_with_arguments(APCG(lazy_function_table) 
+#ifdef ZEND_ENGINE_2_3
+    TSRMLS_CC
+#endif
+    ,(apply_func_args_t) copy_function_name, 2, internal, user);
+  return 1;
+}
+/* }}} */
+
+/* {{{ apc_declared_class_hook */
+int apc_declared_class_hook(zval *classes, zend_uint mask, zend_uint comply) {
+    TSRMLS_FETCH();
+    zend_hash_apply_with_arguments(APCG(lazy_class_table) 
+#ifdef ZEND_ENGINE_2_3
+    TSRMLS_CC
+#endif
+    , (apply_func_args_t) copy_class_or_interface_name, 3, classes, mask, comply);
+  return 1;
+}
+/* }}} */
+
+/* {{{ cached_compile */
+static zend_op_array* cached_compile(zend_file_handle* h,
+                                        int type,
+                                        apc_context_t* ctxt TSRMLS_DC)
+{
+    apc_cache_entry_t* cache_entry;
+    int i, ii;
+
+    cache_entry = (apc_cache_entry_t*) apc_stack_top(APCG(cache_stack));
+    assert(cache_entry != NULL);
+
+    if (cache_entry->data.file.classes) {
+        int lazy_classes = APCG(lazy_classes);
+        for (i = 0; cache_entry->data.file.classes[i].class_entry != NULL; i++) {
+            if(install_class(cache_entry->data.file.classes[i], ctxt, lazy_classes TSRMLS_CC) == FAILURE) {
+                goto default_compile;
+            }
+        }
+    }
+
+    if (cache_entry->data.file.functions) {
+        int lazy_functions = APCG(lazy_functions);
+        for (i = 0; cache_entry->data.file.functions[i].function != NULL; i++) {
+            install_function(cache_entry->data.file.functions[i], ctxt, lazy_functions TSRMLS_CC);
+        }
+    }
+
+    apc_do_halt_compiler_register(cache_entry->data.file.filename, cache_entry->data.file.halt_offset TSRMLS_CC);
+
+
+    return apc_copy_op_array_for_execution(NULL, cache_entry->data.file.op_array, ctxt TSRMLS_CC);
+
+default_compile:
+
+    /* XXX more cleanup in uninstall class, and uninstall_function() should be here too */
+    if(cache_entry->data.file.classes) {
+        for(ii = 0; ii < i ; ii++) {
+            uninstall_class(cache_entry->data.file.classes[ii] TSRMLS_CC);
+        }
+    }
+
+    apc_stack_pop(APCG(cache_stack)); /* pop out cache_entry */
+
+    apc_cache_release(apc_cache, cache_entry TSRMLS_CC);
+
+    /* cannot free up cache data yet, it maybe in use */
+
+    return NULL;
+}
+/* }}} */
+
+/* {{{ apc_compile_cache_entry  */
+zend_bool apc_compile_cache_entry(apc_cache_key_t *key, zend_file_handle* h, int type, time_t t, zend_op_array** op_array, apc_cache_entry_t** cache_entry TSRMLS_DC) {
+    int num_functions, num_classes;
+    apc_function_t* alloc_functions;
+    zend_op_array* alloc_op_array;
+    apc_class_t* alloc_classes;
+    char *path;
+    apc_context_t ctxt;
+
+    /* remember how many functions and classes existed before compilation */
+    num_functions = zend_hash_num_elements(CG(function_table));
+    num_classes   = zend_hash_num_elements(CG(class_table));
+
+    /* compile the file using the default compile function,  *
+     * we set *op_array here so we return opcodes during     *
+     * a failure.  We should not return prior to this line.  */
+    *op_array = old_compile_file(h, type TSRMLS_CC);
+    if (*op_array == NULL) {
+        return FAILURE;
+    }
+
+    ctxt.pool = apc_pool_create(APC_MEDIUM_POOL, apc_sma_malloc, apc_sma_free, 
+                                                 apc_sma_protect, apc_sma_unprotect TSRMLS_CC);
+    if (!ctxt.pool) {
+        apc_warning("Unable to allocate memory for pool." TSRMLS_CC);
+        return FAILURE;
+    }
+    ctxt.copy = APC_COPY_IN_OPCODE;
+
+    if(APCG(file_md5)) {
+        int n;
+        unsigned char buf[1024];
+        PHP_MD5_CTX context;
+        php_stream *stream;
+        char *filename;
+
+        if(h->opened_path) {
+            filename = h->opened_path;
+        } else {
+            filename = h->filename;
+        }
+        stream = php_stream_open_wrapper(filename, "rb", REPORT_ERRORS | ENFORCE_SAFE_MODE, NULL);
+        if(stream) {
+            PHP_MD5Init(&context);
+            while((n = php_stream_read(stream, (char*)buf, sizeof(buf))) > 0) {
+                PHP_MD5Update(&context, buf, n);
+            }
+            PHP_MD5Final(key->md5, &context);
+            php_stream_close(stream);
+            if(n<0) {
+                apc_warning("Error while reading '%s' for md5 generation." TSRMLS_CC, filename);
+            }
+        } else {
+            apc_warning("Unable to open '%s' for md5 generation." TSRMLS_CC, filename);
+        }
+    }
+
+    if(!(alloc_op_array = apc_copy_op_array(NULL, *op_array, &ctxt TSRMLS_CC))) {
+        goto freepool;
+    }
+
+    if(!(alloc_functions = apc_copy_new_functions(num_functions, &ctxt TSRMLS_CC))) {
+        goto freepool;
+    }
+    if(!(alloc_classes = apc_copy_new_classes(*op_array, num_classes, &ctxt TSRMLS_CC))) {
+        goto freepool;
+    }
+
+    path = h->opened_path;
+    if(!path && key->type == APC_CACHE_KEY_FPFILE) path = (char*)key->data.fpfile.fullpath;
+    if(!path) path=h->filename;
+
+    apc_debug("2. h->opened_path=[%s]  h->filename=[%s]\n" TSRMLS_CC, h->opened_path?h->opened_path:"null",h->filename);
+
+    if(!(*cache_entry = apc_cache_make_file_entry(path, alloc_op_array, alloc_functions, alloc_classes, &ctxt TSRMLS_CC))) {
+        goto freepool;
+    }
+
+    return SUCCESS;
+
+freepool:
+    apc_pool_destroy(ctxt.pool TSRMLS_CC);
+    ctxt.pool = NULL;
+
+    return FAILURE;
+
+}
+/* }}} */
+
+/* {{{ my_compile_file
+   Overrides zend_compile_file */
+static zend_op_array* my_compile_file(zend_file_handle* h,
+                                               int type TSRMLS_DC)
+{
+    apc_cache_key_t key;
+    apc_cache_entry_t* cache_entry;
+    zend_op_array* op_array = NULL;
+    time_t t;
+    apc_context_t ctxt = {0,};
+    int bailout=0;
+    const char* filename = NULL;
+
+    if (!APCG(enabled) || apc_cache_busy(apc_cache)) {
+        return old_compile_file(h, type TSRMLS_CC);
+    }
+
+    if(h->opened_path) {
+        filename = h->opened_path;
+    } else {
+        filename = h->filename;
+    }
+
+    /* check our regular expression filters */
+    if (APCG(filters) && APCG(compiled_filters) && filename) {
+        int ret = apc_regex_match_array(APCG(compiled_filters), filename);
+
+        if(ret == APC_NEGATIVE_MATCH || (ret != APC_POSITIVE_MATCH && !APCG(cache_by_default))) {
+            return old_compile_file(h, type TSRMLS_CC);
+        }
+    } else if(!APCG(cache_by_default)) {
+        return old_compile_file(h, type TSRMLS_CC);
+    }
+    APCG(current_cache) = apc_cache;
+
+
+    t = apc_time();
+
+    apc_debug("1. h->opened_path=[%s]  h->filename=[%s]\n" TSRMLS_CC, h->opened_path?h->opened_path:"null",h->filename);
+
+    /* try to create a cache key; if we fail, give up on caching */
+    if (!apc_cache_make_file_key(&key, h->filename, PG(include_path), t TSRMLS_CC)) {
+        return old_compile_file(h, type TSRMLS_CC);
+    }
+
+    if(!APCG(force_file_update)) {
+        /* search for the file in the cache */
+        cache_entry = apc_cache_find(apc_cache, key, t TSRMLS_CC);
+        ctxt.force_update = 0;
+    } else {
+        cache_entry = NULL;
+        ctxt.force_update = 1;
+    }
+
+    if (cache_entry != NULL) {
+        int dummy = 1;
+        
+        ctxt.pool = apc_pool_create(APC_UNPOOL, apc_php_malloc, apc_php_free,
+                                                apc_sma_protect, apc_sma_unprotect TSRMLS_CC);
+        if (!ctxt.pool) {
+            apc_warning("Unable to allocate memory for pool." TSRMLS_CC);
+            return old_compile_file(h, type TSRMLS_CC);
+        }
+        ctxt.copy = APC_COPY_OUT_OPCODE;
+        
+        zend_hash_add(&EG(included_files), cache_entry->data.file.filename, 
+                            strlen(cache_entry->data.file.filename)+1,
+                            (void *)&dummy, sizeof(int), NULL);
+
+        apc_stack_push(APCG(cache_stack), cache_entry TSRMLS_CC);
+        op_array = cached_compile(h, type, &ctxt TSRMLS_CC);
+
+        if(op_array) {
+#ifdef APC_FILEHITS
+            /* If the file comes from the cache, add it to the global request file list */
+            add_next_index_string(APCG(filehits), h->filename, 1);
+#endif
+            /* this is an unpool, which has no cleanup - this only free's the pool header */
+            apc_pool_destroy(ctxt.pool TSRMLS_CC);
+            
+            /* We might leak fds without this hack */
+            if (h->type != ZEND_HANDLE_FILENAME) {
+                zend_llist_add_element(&CG(open_files), h); 
+            }
+
+            /* save this to free on rshutdown */
+            cache_entry->data.file.exec_refcount = op_array->refcount;
+
+            return op_array;
+        }
+        if(APCG(report_autofilter)) {
+            apc_warning("Autofiltering %s" TSRMLS_CC, 
+                            (h->opened_path ? h->opened_path : h->filename));
+            apc_warning("Recompiling %s" TSRMLS_CC, cache_entry->data.file.filename);
+        }
+        /* TODO: check what happens with EG(included_files) */
+    }
+
+    /* Make sure the mtime reflects the files last known mtime, and we respect max_file_size in the case of fpstat==0 */
+    if(key.type == APC_CACHE_KEY_FPFILE) {
+        apc_fileinfo_t fileinfo;
+        struct stat *tmp_buf = NULL;
+        if(!strcmp(SG(request_info).path_translated, h->filename)) {
+            tmp_buf = sapi_get_stat(TSRMLS_C);  /* Apache has already done this stat() for us */
+        }
+        if(tmp_buf) {
+            fileinfo.st_buf.sb = *tmp_buf;
+        } else {
+            if (apc_search_paths(h->filename, PG(include_path), &fileinfo TSRMLS_CC) != 0) {
+                apc_debug("Stat failed %s - bailing (%s) (%d)\n" TSRMLS_CC,h->filename,SG(request_info).path_translated);
+                return old_compile_file(h, type TSRMLS_CC);
+            }
+        }
+        if (APCG(max_file_size) < fileinfo.st_buf.sb.st_size) { 
+            apc_debug("File is too big %s (%ld) - bailing\n" TSRMLS_CC, h->filename, fileinfo.st_buf.sb.st_size);
+            return old_compile_file(h, type TSRMLS_CC);
+        }
+        key.mtime = fileinfo.st_buf.sb.st_mtime;
+    }
+
+    HANDLE_BLOCK_INTERRUPTIONS();
+
+#if NONBLOCKING_LOCK_AVAILABLE
+    if(APCG(write_lock)) {
+        if(!apc_cache_write_lock(apc_cache TSRMLS_CC)) {
+            HANDLE_UNBLOCK_INTERRUPTIONS();
+            return old_compile_file(h, type TSRMLS_CC);
+        }
+    }
+#endif
+
+    zend_try {
+        if (apc_compile_cache_entry(&key, h, type, t, &op_array, &cache_entry TSRMLS_CC) == SUCCESS) {
+            ctxt.pool = cache_entry->pool;
+            ctxt.copy = APC_COPY_IN_OPCODE;
+            if (apc_cache_insert(apc_cache, key, cache_entry, &ctxt, t TSRMLS_CC) != 1) {
+                apc_pool_destroy(ctxt.pool TSRMLS_CC);
+                ctxt.pool = NULL;
+            }
+        }
+    } zend_catch {
+        bailout=1; /* in the event of a bailout, ensure we don't create a dead-lock */
+    } zend_end_try();
+
+    APCG(current_cache) = NULL;
+
+#if NONBLOCKING_LOCK_AVAILABLE
+    if(APCG(write_lock)) {
+        apc_cache_write_unlock(apc_cache TSRMLS_CC);
+    }
+#endif
+    HANDLE_UNBLOCK_INTERRUPTIONS();
+
+    if (bailout) zend_bailout();
+
+    return op_array;
+}
+/* }}} */
+
+/* {{{ data preload */
+
+extern int _apc_store(char *strkey, int strkey_len, const zval *val, const unsigned int ttl, const int exclusive TSRMLS_DC);
+
+static zval* data_unserialize(const char *filename TSRMLS_DC)
+{
+    zval* retval;
+    long len = 0;
+    struct stat sb;
+    char *contents, *tmp;
+    FILE *fp;
+    php_unserialize_data_t var_hash;
+
+    if(VCWD_STAT(filename, &sb) == -1) {
+        return NULL;
+    }
+
+    fp = fopen(filename, "rb");
+
+    len = sizeof(char)*sb.st_size;
+
+    tmp = contents = malloc(len);
+
+    if(!contents) {
+       return NULL;
+    }
+
+    if(fread(contents, 1, len, fp) < 1) {	
+      free(contents);
+      return NULL;
+    }
+
+    MAKE_STD_ZVAL(retval);
+
+    PHP_VAR_UNSERIALIZE_INIT(var_hash);
+    
+    /* I wish I could use json */
+    if(!php_var_unserialize(&retval, (const unsigned char**)&tmp, (const unsigned char*)(contents+len), &var_hash TSRMLS_CC)) {
+        zval_ptr_dtor(&retval);
+        return NULL;
+    }
+
+    PHP_VAR_UNSERIALIZE_DESTROY(var_hash);
+
+    free(contents);
+    fclose(fp);
+
+    return retval;
+}
+
+static int apc_load_data(const char *data_file TSRMLS_DC)
+{
+    char *p;
+    char key[MAXPATHLEN] = {0,};
+    unsigned int key_len;
+    zval *data;
+
+    p = strrchr(data_file, DEFAULT_SLASH);
+
+    if(p && p[1]) {
+        strlcpy(key, p+1, sizeof(key));
+        p = strrchr(key, '.');
+
+        if(p) {
+            p[0] = '\0';
+            key_len = strlen(key)+1;
+
+            data = data_unserialize(data_file TSRMLS_CC);
+            if(data) {
+                _apc_store(key, key_len, data, 0, 1 TSRMLS_CC);
+            }
+            return 1;
+        }
+    }
+
+    return 0;
+}
+
+static int apc_walk_dir(const char *path TSRMLS_DC)
+{
+    char file[MAXPATHLEN]={0,};
+    int ndir, i;
+    char *p = NULL;
+    struct dirent **namelist = NULL;
+
+    if ((ndir = php_scandir(path, &namelist, 0, php_alphasort)) > 0)
+    {
+        for (i = 0; i < ndir; i++)
+        {
+            /* check for extension */
+            if (!(p = strrchr(namelist[i]->d_name, '.'))
+                    || (p && strcmp(p, ".data")))
+            {
+                free(namelist[i]);
+                continue;
+            }
+            snprintf(file, MAXPATHLEN, "%s%c%s",
+                    path, DEFAULT_SLASH, namelist[i]->d_name);
+            if(!apc_load_data(file TSRMLS_CC))
+            {
+                /* print error */
+            }
+            free(namelist[i]);
+        }
+        free(namelist);
+    }
+
+    return 1;
+}
+
+void apc_data_preload(TSRMLS_D)
+{
+    if(!APCG(preload_path)) return;
+
+    apc_walk_dir(APCG(preload_path) TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ apc_serializer hooks */
+static int _apc_register_serializer(const char* name, apc_serialize_t serialize, 
+                                    apc_unserialize_t unserialize,
+                                    void *config TSRMLS_DC)
+{
+    int i;
+    apc_serializer_t *serializer;
+
+    for(i = 0; i < APC_MAX_SERIALIZERS; i++) {
+        serializer = &apc_serializers[i];
+        if(!serializer->name) {
+            /* empty entry */
+            serializer->name = name; /* assumed to be const */
+            serializer->serialize = serialize;
+            serializer->unserialize = unserialize;
+            serializer->config = config;
+            apc_serializers[i+1].name = NULL;
+            return 1;
+        }
+    }
+
+    return 0;
+}
+
+apc_serializer_t* apc_find_serializer(const char* name TSRMLS_DC)
+{
+    int i;
+    apc_serializer_t *serializer;
+
+    for(i = 0; i < APC_MAX_SERIALIZERS; i++) {
+        serializer = &apc_serializers[i];
+        if(serializer->name && (strcmp(serializer->name, name) == 0)) {
+            return serializer;
+        }
+    }
+    return NULL;
+}
+
+apc_serializer_t* apc_get_serializers(TSRMLS_D)
+{
+    return &(apc_serializers[0]);
+}
+/* }}} */
+
+/* {{{ module init and shutdown */
+
+int apc_module_init(int module_number TSRMLS_DC)
+{
+    /* apc initialization */
+#if APC_MMAP
+    apc_sma_init(APCG(shm_segments), APCG(shm_size), APCG(mmap_file_mask) TSRMLS_CC);
+#else
+    apc_sma_init(APCG(shm_segments), APCG(shm_size), NULL TSRMLS_CC);
+#endif
+    apc_cache = apc_cache_create(APCG(num_files_hint), APCG(gc_ttl), APCG(ttl) TSRMLS_CC);
+    apc_user_cache = apc_cache_create(APCG(user_entries_hint), APCG(gc_ttl), APCG(user_ttl) TSRMLS_CC);
+
+    /* override compilation */
+    old_compile_file = zend_compile_file;
+    zend_compile_file = my_compile_file;
+    REGISTER_LONG_CONSTANT("\000apc_magic", (long)&set_compile_hook, CONST_PERSISTENT | CONST_CS);
+    REGISTER_LONG_CONSTANT("\000apc_compile_file", (long)&my_compile_file, CONST_PERSISTENT | CONST_CS);
+    REGISTER_LONG_CONSTANT(APC_SERIALIZER_CONSTANT, (long)&_apc_register_serializer, CONST_PERSISTENT | CONST_CS);
+
+    /* test out the constant function pointer */
+    apc_register_serializer("php", APC_SERIALIZER_NAME(php), APC_UNSERIALIZER_NAME(php), NULL TSRMLS_CC);
+
+    assert(apc_serializers[0].name != NULL);
+
+    apc_pool_init();
+
+#ifdef ZEND_ENGINE_2_4
+#ifndef ZTS
+    apc_interned_strings_init(TSRMLS_C);
+#endif
+#endif
+
+    apc_data_preload(TSRMLS_C);
+
+#if APC_HAVE_LOOKUP_HOOKS
+    if(APCG(lazy_functions)) {
+        zend_set_lookup_function_hook(apc_lookup_function_hook TSRMLS_CC);
+        zend_set_defined_function_hook(apc_defined_function_hook TSRMLS_CC);
+    }
+    if(APCG(lazy_classes)) {
+        zend_set_lookup_class_hook(apc_lookup_class_hook TSRMLS_CC);
+        zend_set_declared_class_hook(apc_declared_class_hook TSRMLS_CC);
+    }
+#else
+    if(APCG(lazy_functions) || APCG(lazy_classes)) {
+        apc_warning("Lazy function/class loading not available with this version of PHP, please disable APC lazy loading." TSRMLS_CC);
+        APCG(lazy_functions) = APCG(lazy_classes) = 0;
+    }
+#endif
+
+    APCG(initialized) = 1;
+    return 0;
+}
+
+int apc_module_shutdown(TSRMLS_D)
+{
+    if (!APCG(initialized))
+        return 0;
+
+    /* restore compilation */
+    zend_compile_file = old_compile_file;
+
+    /*
+     * In case we got interrupted by a SIGTERM or something else during execution
+     * we may have cache entries left on the stack that we need to check to make
+     * sure that any functions or classes these may have added to the global function
+     * and class tables are removed before we blow away the memory that hold them.
+     * 
+     * This is merely to remove memory leak warnings - as the process is terminated
+     * immediately after shutdown. The following while loop can be removed without
+     * affecting anything else.
+     */
+    while (apc_stack_size(APCG(cache_stack)) > 0) {
+        int i;
+        apc_cache_entry_t* cache_entry = (apc_cache_entry_t*) apc_stack_pop(APCG(cache_stack));
+        if (cache_entry->data.file.functions) {
+            for (i = 0; cache_entry->data.file.functions[i].function != NULL; i++) {
+                zend_hash_del(EG(function_table),
+                    cache_entry->data.file.functions[i].name,
+                    cache_entry->data.file.functions[i].name_len+1);
+            }
+        }
+        if (cache_entry->data.file.classes) {
+            for (i = 0; cache_entry->data.file.classes[i].class_entry != NULL; i++) {
+                zend_hash_del(EG(class_table),
+                    cache_entry->data.file.classes[i].name,
+                    cache_entry->data.file.classes[i].name_len+1);
+            }
+        }
+        apc_cache_release(apc_cache, cache_entry TSRMLS_CC);
+    }
+
+#ifdef ZEND_ENGINE_2_4
+#ifndef ZTS
+    apc_interned_strings_shutdown(TSRMLS_C);
+#endif
+#endif
+
+    apc_cache_destroy(apc_cache TSRMLS_CC);
+    apc_cache_destroy(apc_user_cache TSRMLS_CC);
+    apc_sma_cleanup(TSRMLS_C);
+
+    APCG(initialized) = 0;
+    return 0;
+}
+
+/* }}} */
+
+/* {{{ process init and shutdown */
+int apc_process_init(int module_number TSRMLS_DC)
+{
+    return 0;
+}
+
+int apc_process_shutdown(TSRMLS_D)
+{
+    return 0;
+}
+/* }}} */
+
+/* {{{ apc_deactivate */
+static void apc_deactivate(TSRMLS_D)
+{
+    /* The execution stack was unwound, which prevented us from decrementing
+     * the reference counts on active cache entries in `my_execute`.
+     */
+    while (apc_stack_size(APCG(cache_stack)) > 0) {
+        int i;
+        apc_cache_entry_t* cache_entry =
+            (apc_cache_entry_t*) apc_stack_pop(APCG(cache_stack));
+
+        if (cache_entry->data.file.classes) {
+            zend_class_entry* zce = NULL;
+            void ** centry = (void*)(&zce);
+            zend_class_entry** pzce = NULL;
+
+            for (i = 0; cache_entry->data.file.classes[i].class_entry != NULL; i++) {
+                centry = (void**)&pzce; /* a triple indirection to get zend_class_entry*** */
+                if(zend_hash_find(EG(class_table), 
+                    cache_entry->data.file.classes[i].name,
+                    cache_entry->data.file.classes[i].name_len+1,
+                    (void**)centry) == FAILURE)
+                {
+                    /* double inclusion of conditional classes ends up failing 
+                     * this lookup the second time around.
+                     */
+                    continue;
+                }
+
+                zce = *pzce;
+
+                zend_hash_del(EG(class_table),
+                    cache_entry->data.file.classes[i].name,
+                    cache_entry->data.file.classes[i].name_len+1);
+
+                apc_free_class_entry_after_execution(zce TSRMLS_CC);
+                zce = NULL;
+            }
+        }
+#if 0
+        if (cache_entry->data.file.functions) {
+            zend_function fn, *pfn = NULL;
+
+            for (i = 0; cache_entry->data.file.functions[i].function != NULL; i++) {
+
+                if (zend_hash_find(EG(function_table),
+                            cache_entry->data.file.functions[i].name,
+                            cache_entry->data.file.functions[i].name_len+1,
+                            (void**)&pfn) == FAILURE) {
+                    continue;
+                }
+
+                fn = *pfn;
+                zend_hash_del(EG(function_table),
+                        cache_entry->data.file.functions[i].name,
+                        cache_entry->data.file.functions[i].name_len+1);
+#if 0
+                apc_free_function_after_execution(&fn TSRMLS_CC);
+                efree(fn);
+#endif
+                pfn = NULL;
+            }
+        }
+
+        /* This is a very special case of apc_free_op_array_after_execution.
+           File related op_array->refcount is allocated on unpool for execution
+           and would never be freed in zend_execute_scripts() */
+#ifdef ZEND_ENGINE_2_4
+		if (cache_entry->data.file.exec_refcount) {
+			apc_php_free(cache_entry->data.file.exec_refcount TSRMLS_CC);
+			cache_entry->data.file.exec_refcount = NULL;
+		}
+#endif
+#endif
+
+        apc_cache_release(apc_cache, cache_entry TSRMLS_CC);
+    }
+}
+/* }}} */
+
+/* {{{ request init and shutdown */
+
+int apc_request_init(TSRMLS_D)
+{
+    apc_stack_clear(APCG(cache_stack));
+    if (!APCG(compiled_filters) && APCG(filters)) {
+        /* compile regex filters here to avoid race condition between MINIT of PCRE and APC.
+         * This should be moved to apc_cache_create() if this race condition between modules is resolved */
+        APCG(compiled_filters) = apc_regex_compile_array(APCG(filters) TSRMLS_CC);
+    }
+
+    if (!APCG(serializer) && APCG(serializer_name)) {
+        /* Avoid race conditions between MINIT of apc and serializer exts like igbinary */
+        APCG(serializer) = apc_find_serializer(APCG(serializer_name) TSRMLS_CC);
+    }
+
+#if APC_HAVE_LOOKUP_HOOKS
+    if(APCG(lazy_functions)) {
+        APCG(lazy_function_table) = emalloc(sizeof(HashTable));
+        zend_hash_init(APCG(lazy_function_table), 0, NULL, NULL, 0);
+    }
+    if(APCG(lazy_classes)) {
+        APCG(lazy_class_table) = emalloc(sizeof(HashTable));
+        zend_hash_init(APCG(lazy_class_table), 0, NULL, NULL, 0);
+    }
+#endif
+
+#ifdef APC_FILEHITS
+    ALLOC_INIT_ZVAL(APCG(filehits));
+    array_init(APCG(filehits));
+#endif
+
+    return 0;
+}
+
+int apc_request_shutdown(TSRMLS_D)
+{
+
+#if APC_HAVE_LOOKUP_HOOKS
+    if(APCG(lazy_class_table)) {
+        zend_hash_destroy(APCG(lazy_class_table));
+        efree(APCG(lazy_class_table));
+    }
+    if(APCG(lazy_function_table)) {
+        zend_hash_destroy(APCG(lazy_function_table));
+        efree(APCG(lazy_function_table));
+    }
+#endif
+
+    apc_deactivate(TSRMLS_C);
+
+#ifdef APC_FILEHITS
+    zval_ptr_dtor(&APCG(filehits));
+#endif
+
+    /* As long as regex is compiled per request, it must be freed accordingly.*/
+    if (APCG(compiled_filters) && APCG(filters)) {
+        apc_regex_destroy_array(APCG(compiled_filters) TSRMLS_CC);
+        APCG(compiled_filters) = NULL;
+    }
+
+    return 0;
+}
+
+/* }}} */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_main.h php-5.4.19.bak/ext/apc/apc_main.h
--- php-5.4.19/ext/apc/apc_main.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_main.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,88 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          George Schlossnagle <george@omniti.com>                     |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_main.h 308594 2011-02-23 12:35:33Z gopalv $ */
+
+#ifndef APC_MAIN_H
+#define APC_MAIN_H
+
+#include "apc_pool.h"
+#include "apc_serializer.h"
+
+/*
+ * This module provides the primary interface between PHP and APC.
+ */
+
+extern int apc_module_init(int module_number TSRMLS_DC);
+extern int apc_module_shutdown(TSRMLS_D);
+extern int apc_process_init(int module_number TSRMLS_DC);
+extern int apc_process_shutdown(TSRMLS_D);
+extern int apc_request_init(TSRMLS_D);
+extern int apc_request_shutdown(TSRMLS_D);
+
+typedef enum _apc_copy_type {
+    APC_NO_COPY = 0,
+    APC_COPY_IN_OPCODE,
+    APC_COPY_OUT_OPCODE,
+    APC_COPY_IN_USER,
+    APC_COPY_OUT_USER
+} apc_copy_type;
+
+typedef struct _apc_context_t
+{
+    apc_pool *pool;
+    apc_copy_type copy;
+    unsigned int force_update:1;
+} apc_context_t;
+
+/* {{{ struct apc_serializer_t */
+typedef struct apc_serializer_t apc_serializer_t;
+struct apc_serializer_t {
+    const char *name;
+    apc_serialize_t serialize;
+    apc_unserialize_t unserialize;
+    void *config;
+};
+/* }}} */
+
+apc_serializer_t* apc_get_serializers(TSRMLS_D);
+apc_serializer_t* apc_find_serializer(const char* name TSRMLS_DC);
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_mmap.c php-5.4.19.bak/ext/apc/apc_mmap.c
--- php-5.4.19/ext/apc/apc_mmap.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_mmap.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,177 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Rasmus Lerdorf <rasmus@php.net>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_mmap.c 307048 2011-01-03 23:53:17Z kalle $ */
+
+#include "apc.h"
+#include "apc_mmap.h"
+#include "apc_lock.h"
+
+#if APC_MMAP
+
+#include <fcntl.h>
+#include <sys/types.h>
+#include <sys/mman.h>
+
+/*
+ * Some operating systems (like FreeBSD) have a MAP_NOSYNC flag that
+ * tells whatever update daemons might be running to not flush dirty
+ * vm pages to disk unless absolutely necessary.  My guess is that
+ * most systems that don't have this probably default to only synching
+ * to disk when absolutely necessary.
+ */
+#ifndef MAP_NOSYNC
+#define MAP_NOSYNC 0
+#endif
+
+/* support for systems where MAP_ANONYMOUS is defined but not MAP_ANON, ie: HP-UX bug #14615 */
+#if !defined(MAP_ANON) && defined(MAP_ANONYMOUS)
+# define MAP_ANON MAP_ANONYMOUS
+#endif
+
+apc_segment_t apc_mmap(char *file_mask, size_t size TSRMLS_DC)
+{
+    apc_segment_t segment; 
+
+    int fd = -1;
+    int flags = MAP_SHARED | MAP_NOSYNC;
+    int remap = 1;
+
+    /* If no filename was provided, do an anonymous mmap */
+    if(!file_mask || (file_mask && !strlen(file_mask))) {
+#if !defined(MAP_ANON)
+        apc_error("Anonymous mmap does not apear to be available on this system (MAP_ANON/MAP_ANONYMOUS).  Please see the apc.mmap_file_mask INI option." TSRMLS_CC);
+#else
+        fd = -1;
+        flags = MAP_SHARED | MAP_ANON;
+        remap = 0;
+#endif
+    } else if(!strcmp(file_mask,"/dev/zero")) { 
+        fd = open("/dev/zero", O_RDWR, S_IRUSR | S_IWUSR);
+        if(fd == -1) {
+            apc_error("apc_mmap: open on /dev/zero failed:" TSRMLS_CC);
+            goto error;
+        }
+        remap = 0; /* cannot remap */
+    } else if(strstr(file_mask,".shm")) {
+        /*
+         * If the filemask contains .shm we try to do a POSIX-compliant shared memory
+         * backed mmap which should avoid synchs on some platforms.  At least on
+         * FreeBSD this implies MAP_NOSYNC and on Linux it is equivalent of mmap'ing
+         * a file in a mounted shmfs.  For this to work on Linux you need to make sure
+         * you actually have shmfs mounted.  Also on Linux, make sure the file_mask you
+         * pass in has a leading / and no other /'s.  eg.  /apc.shm.XXXXXX
+         * On FreeBSD these are mapped onto the regular filesystem so you can put whatever
+         * path you want here.
+         */
+        if(!mktemp(file_mask)) {
+            apc_error("apc_mmap: mktemp on %s failed:" TSRMLS_CC, file_mask);
+            goto error;
+        }
+        fd = shm_open(file_mask, O_CREAT|O_RDWR, S_IRUSR|S_IWUSR);
+        if(fd == -1) {
+            apc_error("apc_mmap: shm_open on %s failed:" TSRMLS_CC, file_mask);
+            goto error;
+        }
+        if (ftruncate(fd, size) < 0) {
+            close(fd);
+            shm_unlink(file_mask);
+            apc_error("apc_mmap: ftruncate failed:" TSRMLS_CC);
+            goto error;
+        }
+        shm_unlink(file_mask);
+    } else {
+        /*
+         * Otherwise we do a normal filesystem mmap
+         */
+        fd = mkstemp(file_mask);
+        if(fd == -1) {
+            apc_error("apc_mmap: mkstemp on %s failed:" TSRMLS_CC, file_mask);
+            goto error;
+        }
+        if (ftruncate(fd, size) < 0) {
+            close(fd);
+            unlink(file_mask);
+            apc_error("apc_mmap: ftruncate failed:" TSRMLS_CC);
+            goto error;
+        }
+        unlink(file_mask);
+    }
+
+    segment.shmaddr = (void *)mmap(NULL, size, PROT_READ | PROT_WRITE, flags, fd, 0);
+    segment.size = size;
+
+#ifdef APC_MEMPROTECT
+    if(remap) {
+        segment.roaddr = (void *)mmap(NULL, size, PROT_READ, flags, fd, 0);
+    } else {
+        segment.roaddr = NULL;
+    }
+#endif
+
+    if((long)segment.shmaddr == -1) {
+        apc_error("apc_mmap: mmap failed:" TSRMLS_CC);
+    }
+
+    if(fd != -1) close(fd);
+    
+    return segment;
+
+error:
+
+    segment.shmaddr = (void*)-1;
+    segment.size = 0;
+#ifdef APC_MEMPROTECT
+    segment.roaddr = NULL;
+#endif
+    return segment;
+}
+
+void apc_unmap(apc_segment_t *segment TSRMLS_DC)
+{
+    if (munmap(segment->shmaddr, segment->size) < 0) {
+        apc_warning("apc_unmap: munmap failed:" TSRMLS_CC);
+    }
+
+#ifdef APC_MEMPROTECT
+    if (segment->roaddr && munmap(segment->roaddr, segment->size) < 0) {
+        apc_warning("apc_unmap: munmap failed:" TSRMLS_CC);
+    }
+#endif
+
+}
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_mmap.h php-5.4.19.bak/ext/apc/apc_mmap.h
--- php-5.4.19/ext/apc/apc_mmap.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_mmap.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,54 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Gopal V <gopalv@php.net>                                    |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_mmap.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_MMAP_H
+#define APC_MMAP_H
+
+#include <limits.h>
+
+#include "apc.h"
+#include "apc_sma.h"
+
+/* Wrapper functions for shared memory mapped files */
+
+#if APC_MMAP
+apc_segment_t apc_mmap(char *file_mask, size_t size TSRMLS_DC);
+void apc_unmap(apc_segment_t* segment TSRMLS_DC);
+#endif
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc.php php-5.4.19.bak/ext/apc/apc.php
--- php-5.4.19/ext/apc/apc.php	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc.php	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,1362 @@
+<?php
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Ralf Becker <beckerr@php.net>                               |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  |          Ilia Alshanetsky <ilia@prohost.org>                         |
+  +----------------------------------------------------------------------+
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+$VERSION='$Id: apc.php 325483 2012-05-01 00:34:04Z rasmus $';
+
+////////// READ OPTIONAL CONFIGURATION FILE ////////////
+if (file_exists("apc.conf.php")) include("apc.conf.php");
+////////////////////////////////////////////////////////
+
+////////// BEGIN OF DEFAULT CONFIG AREA ///////////////////////////////////////////////////////////
+
+defaults('USE_AUTHENTICATION',1);			// Use (internal) authentication - best choice if 
+											// no other authentication is available
+											// If set to 0:
+											//  There will be no further authentication. You 
+											//  will have to handle this by yourself!
+											// If set to 1:
+											//  You need to change ADMIN_PASSWORD to make
+											//  this work!
+defaults('ADMIN_USERNAME','apc'); 			// Admin Username
+defaults('ADMIN_PASSWORD','password');  	// Admin Password - CHANGE THIS TO ENABLE!!!
+
+// (beckerr) I'm using a clear text password here, because I've no good idea how to let 
+//           users generate a md5 or crypt password in a easy way to fill it in above
+
+//defaults('DATE_FORMAT', "d.m.Y H:i:s");	// German
+defaults('DATE_FORMAT', 'Y/m/d H:i:s'); 	// US
+
+defaults('GRAPH_SIZE',200);					// Image size
+
+//defaults('PROXY', 'tcp://127.0.0.1:8080');
+
+////////// END OF DEFAULT CONFIG AREA /////////////////////////////////////////////////////////////
+
+
+// "define if not defined"
+function defaults($d,$v) {
+	if (!defined($d)) define($d,$v); // or just @define(...)
+}
+
+// rewrite $PHP_SELF to block XSS attacks
+//
+$PHP_SELF= isset($_SERVER['PHP_SELF']) ? htmlentities(strip_tags($_SERVER['PHP_SELF'],''), ENT_QUOTES, 'UTF-8') : '';
+$time = time();
+$host = php_uname('n');
+if($host) { $host = '('.$host.')'; }
+if (isset($_SERVER['SERVER_ADDR'])) {
+  $host .= ' ('.$_SERVER['SERVER_ADDR'].')';
+}
+
+// operation constants
+define('OB_HOST_STATS',1);
+define('OB_SYS_CACHE',2);
+define('OB_USER_CACHE',3);
+define('OB_SYS_CACHE_DIR',4);
+define('OB_VERSION_CHECK',9);
+
+// check validity of input variables
+$vardom=array(
+	'OB'	=> '/^\d+$/',			// operational mode switch
+	'CC'	=> '/^[01]$/',			// clear cache requested
+	'DU'	=> '/^.*$/',			// Delete User Key
+	'SH'	=> '/^[a-z0-9]+$/',		// shared object description
+
+	'IMG'	=> '/^[123]$/',			// image to generate
+	'LO'	=> '/^1$/',				// login requested
+
+	'COUNT'	=> '/^\d+$/',			// number of line displayed in list
+	'SCOPE'	=> '/^[AD]$/',			// list view scope
+	'SORT1'	=> '/^[AHSMCDTZ]$/',	// first sort key
+	'SORT2'	=> '/^[DA]$/',			// second sort key
+	'AGGR'	=> '/^\d+$/',			// aggregation by dir level
+	'SEARCH'	=> '~^[a-zA-Z0-9/_.-]*$~'			// aggregation by dir level
+);
+
+// default cache mode
+$cache_mode='opcode';
+
+// cache scope
+$scope_list=array(
+	'A' => 'cache_list',
+	'D' => 'deleted_list'
+);
+
+// handle POST and GET requests
+if (empty($_REQUEST)) {
+	if (!empty($_GET) && !empty($_POST)) {
+		$_REQUEST = array_merge($_GET, $_POST);
+	} else if (!empty($_GET)) {
+		$_REQUEST = $_GET;
+	} else if (!empty($_POST)) {
+		$_REQUEST = $_POST;
+	} else {
+		$_REQUEST = array();
+	}
+}
+
+// check parameter syntax
+foreach($vardom as $var => $dom) {
+	if (!isset($_REQUEST[$var])) {
+		$MYREQUEST[$var]=NULL;
+	} else if (!is_array($_REQUEST[$var]) && preg_match($dom.'D',$_REQUEST[$var])) {
+		$MYREQUEST[$var]=$_REQUEST[$var];
+	} else {
+		$MYREQUEST[$var]=$_REQUEST[$var]=NULL;
+	}
+}
+
+// check parameter sematics
+if (empty($MYREQUEST['SCOPE'])) $MYREQUEST['SCOPE']="A";
+if (empty($MYREQUEST['SORT1'])) $MYREQUEST['SORT1']="H";
+if (empty($MYREQUEST['SORT2'])) $MYREQUEST['SORT2']="D";
+if (empty($MYREQUEST['OB']))	$MYREQUEST['OB']=OB_HOST_STATS;
+if (!isset($MYREQUEST['COUNT'])) $MYREQUEST['COUNT']=20;
+if (!isset($scope_list[$MYREQUEST['SCOPE']])) $MYREQUEST['SCOPE']='A';
+
+$MY_SELF=
+	"$PHP_SELF".
+	"?SCOPE=".$MYREQUEST['SCOPE'].
+	"&SORT1=".$MYREQUEST['SORT1'].
+	"&SORT2=".$MYREQUEST['SORT2'].
+	"&COUNT=".$MYREQUEST['COUNT'];
+$MY_SELF_WO_SORT=
+	"$PHP_SELF".
+	"?SCOPE=".$MYREQUEST['SCOPE'].
+	"&COUNT=".$MYREQUEST['COUNT'];
+
+// authentication needed?
+//
+if (!USE_AUTHENTICATION) {
+	$AUTHENTICATED=1;
+} else {
+	$AUTHENTICATED=0;
+	if (ADMIN_PASSWORD!='password' && ($MYREQUEST['LO'] == 1 || isset($_SERVER['PHP_AUTH_USER']))) {
+
+		if (!isset($_SERVER['PHP_AUTH_USER']) ||
+			!isset($_SERVER['PHP_AUTH_PW']) ||
+			$_SERVER['PHP_AUTH_USER'] != ADMIN_USERNAME ||
+			$_SERVER['PHP_AUTH_PW'] != ADMIN_PASSWORD) {
+			Header("WWW-Authenticate: Basic realm=\"APC Login\"");
+			Header("HTTP/1.0 401 Unauthorized");
+
+			echo <<<EOB
+				<html><body>
+				<h1>Rejected!</h1>
+				<big>Wrong Username or Password!</big><br/>&nbsp;<br/>&nbsp;
+				<big><a href='$PHP_SELF?OB={$MYREQUEST['OB']}'>Continue...</a></big>
+				</body></html>
+EOB;
+			exit;
+			
+		} else {
+			$AUTHENTICATED=1;
+		}
+	}
+}
+	
+// select cache mode
+if ($AUTHENTICATED && $MYREQUEST['OB'] == OB_USER_CACHE) {
+	$cache_mode='user';
+}
+// clear cache
+if ($AUTHENTICATED && isset($MYREQUEST['CC']) && $MYREQUEST['CC']) {
+	apc_clear_cache($cache_mode);
+}
+
+if ($AUTHENTICATED && !empty($MYREQUEST['DU'])) {
+	apc_delete($MYREQUEST['DU']);
+}
+
+if(!function_exists('apc_cache_info') || !($cache=@apc_cache_info($cache_mode))) {
+	echo "No cache info available.  APC does not appear to be running.";
+  exit;
+}
+
+$cache_user = apc_cache_info('user', 1);  
+$mem=apc_sma_info();
+if(!$cache['num_hits']) { $cache['num_hits']=1; $time++; }  // Avoid division by 0 errors on a cache clear
+
+// don't cache this page
+//
+header("Cache-Control: no-store, no-cache, must-revalidate");  // HTTP/1.1
+header("Cache-Control: post-check=0, pre-check=0", false);
+header("Pragma: no-cache");                                    // HTTP/1.0
+
+function duration($ts) {
+    global $time;
+    $years = (int)((($time - $ts)/(7*86400))/52.177457);
+    $rem = (int)(($time-$ts)-($years * 52.177457 * 7 * 86400));
+    $weeks = (int)(($rem)/(7*86400));
+    $days = (int)(($rem)/86400) - $weeks*7;
+    $hours = (int)(($rem)/3600) - $days*24 - $weeks*7*24;
+    $mins = (int)(($rem)/60) - $hours*60 - $days*24*60 - $weeks*7*24*60;
+    $str = '';
+    if($years==1) $str .= "$years year, ";
+    if($years>1) $str .= "$years years, ";
+    if($weeks==1) $str .= "$weeks week, ";
+    if($weeks>1) $str .= "$weeks weeks, ";
+    if($days==1) $str .= "$days day,";
+    if($days>1) $str .= "$days days,";
+    if($hours == 1) $str .= " $hours hour and";
+    if($hours>1) $str .= " $hours hours and";
+    if($mins == 1) $str .= " 1 minute";
+    else $str .= " $mins minutes";
+    return $str;
+}
+
+// create graphics
+//
+function graphics_avail() {
+	return extension_loaded('gd');
+}
+if (isset($MYREQUEST['IMG']))
+{
+	if (!graphics_avail()) {
+		exit(0);
+	}
+
+	function fill_arc($im, $centerX, $centerY, $diameter, $start, $end, $color1,$color2,$text='',$placeindex=0) {
+		$r=$diameter/2;
+		$w=deg2rad((360+$start+($end-$start)/2)%360);
+
+		
+		if (function_exists("imagefilledarc")) {
+			// exists only if GD 2.0.1 is avaliable
+			imagefilledarc($im, $centerX+1, $centerY+1, $diameter, $diameter, $start, $end, $color1, IMG_ARC_PIE);
+			imagefilledarc($im, $centerX, $centerY, $diameter, $diameter, $start, $end, $color2, IMG_ARC_PIE);
+			imagefilledarc($im, $centerX, $centerY, $diameter, $diameter, $start, $end, $color1, IMG_ARC_NOFILL|IMG_ARC_EDGED);
+		} else {
+			imagearc($im, $centerX, $centerY, $diameter, $diameter, $start, $end, $color2);
+			imageline($im, $centerX, $centerY, $centerX + cos(deg2rad($start)) * $r, $centerY + sin(deg2rad($start)) * $r, $color2);
+			imageline($im, $centerX, $centerY, $centerX + cos(deg2rad($start+1)) * $r, $centerY + sin(deg2rad($start)) * $r, $color2);
+			imageline($im, $centerX, $centerY, $centerX + cos(deg2rad($end-1))   * $r, $centerY + sin(deg2rad($end))   * $r, $color2);
+			imageline($im, $centerX, $centerY, $centerX + cos(deg2rad($end))   * $r, $centerY + sin(deg2rad($end))   * $r, $color2);
+			imagefill($im,$centerX + $r*cos($w)/2, $centerY + $r*sin($w)/2, $color2);
+		}
+		if ($text) {
+			if ($placeindex>0) {
+				imageline($im,$centerX + $r*cos($w)/2, $centerY + $r*sin($w)/2,$diameter, $placeindex*12,$color1);
+				imagestring($im,4,$diameter, $placeindex*12,$text,$color1);	
+				
+			} else {
+				imagestring($im,4,$centerX + $r*cos($w)/2, $centerY + $r*sin($w)/2,$text,$color1);
+			}
+		}
+	} 
+
+	function text_arc($im, $centerX, $centerY, $diameter, $start, $end, $color1,$text,$placeindex=0) {
+		$r=$diameter/2;
+		$w=deg2rad((360+$start+($end-$start)/2)%360);
+
+		if ($placeindex>0) {
+			imageline($im,$centerX + $r*cos($w)/2, $centerY + $r*sin($w)/2,$diameter, $placeindex*12,$color1);
+			imagestring($im,4,$diameter, $placeindex*12,$text,$color1);	
+				
+		} else {
+			imagestring($im,4,$centerX + $r*cos($w)/2, $centerY + $r*sin($w)/2,$text,$color1);
+		}
+	} 
+	
+	function fill_box($im, $x, $y, $w, $h, $color1, $color2,$text='',$placeindex='') {
+		global $col_black;
+		$x1=$x+$w-1;
+		$y1=$y+$h-1;
+
+		imagerectangle($im, $x, $y1, $x1+1, $y+1, $col_black);
+		if($y1>$y) imagefilledrectangle($im, $x, $y, $x1, $y1, $color2);
+		else imagefilledrectangle($im, $x, $y1, $x1, $y, $color2);
+		imagerectangle($im, $x, $y1, $x1, $y, $color1);
+		if ($text) {
+			if ($placeindex>0) {
+			
+				if ($placeindex<16)
+				{
+					$px=5;
+					$py=$placeindex*12+6;
+					imagefilledrectangle($im, $px+90, $py+3, $px+90-4, $py-3, $color2);
+					imageline($im,$x,$y+$h/2,$px+90,$py,$color2);
+					imagestring($im,2,$px,$py-6,$text,$color1);	
+					
+				} else {
+					if ($placeindex<31) {
+						$px=$x+40*2;
+						$py=($placeindex-15)*12+6;
+					} else {
+						$px=$x+40*2+100*intval(($placeindex-15)/15);
+						$py=($placeindex%15)*12+6;
+					}
+					imagefilledrectangle($im, $px, $py+3, $px-4, $py-3, $color2);
+					imageline($im,$x+$w,$y+$h/2,$px,$py,$color2);
+					imagestring($im,2,$px+2,$py-6,$text,$color1);	
+				}
+			} else {
+				imagestring($im,4,$x+5,$y1-16,$text,$color1);
+			}
+		}
+	}
+
+
+	$size = GRAPH_SIZE; // image size
+	if ($MYREQUEST['IMG']==3)
+		$image = imagecreate(2*$size+150, $size+10);
+	else
+		$image = imagecreate($size+50, $size+10);
+
+	$col_white = imagecolorallocate($image, 0xFF, 0xFF, 0xFF);
+	$col_red   = imagecolorallocate($image, 0xD0, 0x60,  0x30);
+	$col_green = imagecolorallocate($image, 0x60, 0xF0, 0x60);
+	$col_black = imagecolorallocate($image,   0,   0,   0);
+	imagecolortransparent($image,$col_white);
+
+	switch ($MYREQUEST['IMG']) {
+	
+	case 1:
+		$s=$mem['num_seg']*$mem['seg_size'];
+		$a=$mem['avail_mem'];
+		$x=$y=$size/2;
+		$fuzz = 0.000001;
+
+		// This block of code creates the pie chart.  It is a lot more complex than you
+		// would expect because we try to visualize any memory fragmentation as well.
+		$angle_from = 0;
+		$string_placement=array();
+		for($i=0; $i<$mem['num_seg']; $i++) {	
+			$ptr = 0;
+			$free = $mem['block_lists'][$i];
+			uasort($free, 'block_sort');
+			foreach($free as $block) {
+				if($block['offset']!=$ptr) {       // Used block
+					$angle_to = $angle_from+($block['offset']-$ptr)/$s;
+					if(($angle_to+$fuzz)>1) $angle_to = 1;
+					if( ($angle_to*360) - ($angle_from*360) >= 1) {
+						fill_arc($image,$x,$y,$size,$angle_from*360,$angle_to*360,$col_black,$col_red);
+						if (($angle_to-$angle_from)>0.05) {
+							array_push($string_placement, array($angle_from,$angle_to));
+						}
+					}
+					$angle_from = $angle_to;
+				}
+				$angle_to = $angle_from+($block['size'])/$s;
+				if(($angle_to+$fuzz)>1) $angle_to = 1;
+				if( ($angle_to*360) - ($angle_from*360) >= 1) {
+					fill_arc($image,$x,$y,$size,$angle_from*360,$angle_to*360,$col_black,$col_green);
+					if (($angle_to-$angle_from)>0.05) {
+						array_push($string_placement, array($angle_from,$angle_to));
+					}
+				}
+				$angle_from = $angle_to;
+				$ptr = $block['offset']+$block['size'];
+			}
+			if ($ptr < $mem['seg_size']) { // memory at the end 
+				$angle_to = $angle_from + ($mem['seg_size'] - $ptr)/$s;
+				if(($angle_to+$fuzz)>1) $angle_to = 1;
+				fill_arc($image,$x,$y,$size,$angle_from*360,$angle_to*360,$col_black,$col_red);
+				if (($angle_to-$angle_from)>0.05) {
+					array_push($string_placement, array($angle_from,$angle_to));
+				}
+			}
+		}
+		foreach ($string_placement as $angle) {
+			text_arc($image,$x,$y,$size,$angle[0]*360,$angle[1]*360,$col_black,bsize($s*($angle[1]-$angle[0])));
+		}
+		break;
+		
+	case 2: 
+		$s=$cache['num_hits']+$cache['num_misses'];
+		$a=$cache['num_hits'];
+		
+		fill_box($image, 30,$size,50,-$a*($size-21)/$s,$col_black,$col_green,sprintf("%.1f%%",$cache['num_hits']*100/$s));
+		fill_box($image,130,$size,50,-max(4,($s-$a)*($size-21)/$s),$col_black,$col_red,sprintf("%.1f%%",$cache['num_misses']*100/$s));
+		break;
+		
+	case 3:
+		$s=$mem['num_seg']*$mem['seg_size'];
+		$a=$mem['avail_mem'];
+		$x=130;
+		$y=1;
+		$j=1;
+
+		// This block of code creates the bar chart.  It is a lot more complex than you
+		// would expect because we try to visualize any memory fragmentation as well.
+		for($i=0; $i<$mem['num_seg']; $i++) {	
+			$ptr = 0;
+			$free = $mem['block_lists'][$i];
+			uasort($free, 'block_sort');
+			foreach($free as $block) {
+				if($block['offset']!=$ptr) {       // Used block
+					$h=(GRAPH_SIZE-5)*($block['offset']-$ptr)/$s;
+					if ($h>0) {
+                                                $j++;
+						if($j<75) fill_box($image,$x,$y,50,$h,$col_black,$col_red,bsize($block['offset']-$ptr),$j);
+                                                else fill_box($image,$x,$y,50,$h,$col_black,$col_red);
+                                        }
+					$y+=$h;
+				}
+				$h=(GRAPH_SIZE-5)*($block['size'])/$s;
+				if ($h>0) {
+                                        $j++;
+					if($j<75) fill_box($image,$x,$y,50,$h,$col_black,$col_green,bsize($block['size']),$j);
+					else fill_box($image,$x,$y,50,$h,$col_black,$col_green);
+                                }
+				$y+=$h;
+				$ptr = $block['offset']+$block['size'];
+			}
+			if ($ptr < $mem['seg_size']) { // memory at the end 
+				$h = (GRAPH_SIZE-5) * ($mem['seg_size'] - $ptr) / $s;
+				if ($h > 0) {
+					fill_box($image,$x,$y,50,$h,$col_black,$col_red,bsize($mem['seg_size']-$ptr),$j++);
+				}
+			}
+		}
+		break;
+	case 4: 
+		$s=$cache['num_hits']+$cache['num_misses'];
+		$a=$cache['num_hits'];
+	        	
+		fill_box($image, 30,$size,50,-$a*($size-21)/$s,$col_black,$col_green,sprintf("%.1f%%",$cache['num_hits']*100/$s));
+		fill_box($image,130,$size,50,-max(4,($s-$a)*($size-21)/$s),$col_black,$col_red,sprintf("%.1f%%",$cache['num_misses']*100/$s));
+		break;
+	
+	}
+	header("Content-type: image/png");
+	imagepng($image);
+	exit;
+}
+
+// pretty printer for byte values
+//
+function bsize($s) {
+	foreach (array('','K','M','G') as $i => $k) {
+		if ($s < 1024) break;
+		$s/=1024;
+	}
+	return sprintf("%5.1f %sBytes",$s,$k);
+}
+
+// sortable table header in "scripts for this host" view
+function sortheader($key,$name,$extra='') {
+	global $MYREQUEST, $MY_SELF_WO_SORT;
+	
+	if ($MYREQUEST['SORT1']==$key) {
+		$MYREQUEST['SORT2'] = $MYREQUEST['SORT2']=='A' ? 'D' : 'A';
+	}
+	return "<a class=sortable href=\"$MY_SELF_WO_SORT$extra&SORT1=$key&SORT2=".$MYREQUEST['SORT2']."\">$name</a>";
+
+}
+
+// create menu entry 
+function menu_entry($ob,$title) {
+	global $MYREQUEST,$MY_SELF;
+	if ($MYREQUEST['OB']!=$ob) {
+		return "<li><a href=\"$MY_SELF&OB=$ob\">$title</a></li>";
+	} else if (empty($MYREQUEST['SH'])) {
+		return "<li><span class=active>$title</span></li>";
+	} else {
+		return "<li><a class=\"child_active\" href=\"$MY_SELF&OB=$ob\">$title</a></li>";	
+	}
+}
+
+function put_login_link($s="Login")
+{
+	global $MY_SELF,$MYREQUEST,$AUTHENTICATED;
+	// needs ADMIN_PASSWORD to be changed!
+	//
+	if (!USE_AUTHENTICATION) {
+		return;
+	} else if (ADMIN_PASSWORD=='password')
+	{
+		print <<<EOB
+			<a href="#" onClick="javascript:alert('You need to set a password at the top of apc.php before this will work!');return false";>$s</a>
+EOB;
+	} else if ($AUTHENTICATED) {
+		print <<<EOB
+			'{$_SERVER['PHP_AUTH_USER']}'&nbsp;logged&nbsp;in!
+EOB;
+	} else{
+		print <<<EOB
+			<a href="$MY_SELF&LO=1&OB={$MYREQUEST['OB']}">$s</a>
+EOB;
+	}
+}
+
+function block_sort($array1, $array2)
+{
+	if ($array1['offset'] > $array2['offset']) {
+		return 1;
+	} else {
+		return -1;
+	}
+}
+
+
+?>
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
+<html>
+<head><title>APC INFO <?php echo $host ?></title>
+<style><!--
+body { background:white; font-size:100.01%; margin:0; padding:0; }
+body,p,td,th,input,submit { font-size:0.8em;font-family:arial,helvetica,sans-serif; }
+* html body   {font-size:0.8em}
+* html p      {font-size:0.8em}
+* html td     {font-size:0.8em}
+* html th     {font-size:0.8em}
+* html input  {font-size:0.8em}
+* html submit {font-size:0.8em}
+td { vertical-align:top }
+a { color:black; font-weight:none; text-decoration:none; }
+a:hover { text-decoration:underline; }
+div.content { padding:1em 1em 1em 1em; position:absolute; width:97%; z-index:100; }
+
+
+div.head div.login {
+	position:absolute;
+	right: 1em;
+	top: 1.2em;
+	color:white;
+	width:6em;
+	}
+div.head div.login a {
+	position:absolute;
+	right: 0em;
+	background:rgb(119,123,180);
+	border:solid rgb(102,102,153) 2px;
+	color:white;
+	font-weight:bold;
+	padding:0.1em 0.5em 0.1em 0.5em;
+	text-decoration:none;
+	}
+div.head div.login a:hover {
+	background:rgb(193,193,244);
+	}
+
+h1.apc { background:rgb(153,153,204); margin:0; padding:0.5em 1em 0.5em 1em; }
+* html h1.apc { margin-bottom:-7px; }
+h1.apc a:hover { text-decoration:none; color:rgb(90,90,90); }
+h1.apc div.logo span.logo {
+	background:rgb(119,123,180);
+	color:black;
+	border-right: solid black 1px;
+	border-bottom: solid black 1px;
+	font-style:italic;
+	font-size:1em;
+	padding-left:1.2em;
+	padding-right:1.2em;
+	text-align:right;
+	}
+h1.apc div.logo span.name { color:white; font-size:0.7em; padding:0 0.8em 0 2em; }
+h1.apc div.nameinfo { color:white; display:inline; font-size:0.4em; margin-left: 3em; }
+h1.apc div.copy { color:black; font-size:0.4em; position:absolute; right:1em; }
+hr.apc {
+	background:white;
+	border-bottom:solid rgb(102,102,153) 1px;
+	border-style:none;
+	border-top:solid rgb(102,102,153) 10px;
+	height:12px;
+	margin:0;
+	margin-top:1px;
+	padding:0;
+}
+
+ol,menu { margin:1em 0 0 0; padding:0.2em; margin-left:1em;}
+ol.menu li { display:inline; margin-right:0.7em; list-style:none; font-size:85%}
+ol.menu a {
+	background:rgb(153,153,204);
+	border:solid rgb(102,102,153) 2px;
+	color:white;
+	font-weight:bold;
+	margin-right:0em;
+	padding:0.1em 0.5em 0.1em 0.5em;
+	text-decoration:none;
+	margin-left: 5px;
+	}
+ol.menu a.child_active {
+	background:rgb(153,153,204);
+	border:solid rgb(102,102,153) 2px;
+	color:white;
+	font-weight:bold;
+	margin-right:0em;
+	padding:0.1em 0.5em 0.1em 0.5em;
+	text-decoration:none;
+	border-left: solid black 5px;
+	margin-left: 0px;
+	}
+ol.menu span.active {
+	background:rgb(153,153,204);
+	border:solid rgb(102,102,153) 2px;
+	color:black;
+	font-weight:bold;
+	margin-right:0em;
+	padding:0.1em 0.5em 0.1em 0.5em;
+	text-decoration:none;
+	border-left: solid black 5px;
+	}
+ol.menu span.inactive {
+	background:rgb(193,193,244);
+	border:solid rgb(182,182,233) 2px;
+	color:white;
+	font-weight:bold;
+	margin-right:0em;
+	padding:0.1em 0.5em 0.1em 0.5em;
+	text-decoration:none;
+	margin-left: 5px;
+	}
+ol.menu a:hover {
+	background:rgb(193,193,244);
+	text-decoration:none;
+	}
+	
+	
+div.info {
+	background:rgb(204,204,204);
+	border:solid rgb(204,204,204) 1px;
+	margin-bottom:1em;
+	}
+div.info h2 {
+	background:rgb(204,204,204);
+	color:black;
+	font-size:1em;
+	margin:0;
+	padding:0.1em 1em 0.1em 1em;
+	}
+div.info table {
+	border:solid rgb(204,204,204) 1px;
+	border-spacing:0;
+	width:100%;
+	}
+div.info table th {
+	background:rgb(204,204,204);
+	color:white;
+	margin:0;
+	padding:0.1em 1em 0.1em 1em;
+	}
+div.info table th a.sortable { color:black; }
+div.info table tr.tr-0 { background:rgb(238,238,238); }
+div.info table tr.tr-1 { background:rgb(221,221,221); }
+div.info table td { padding:0.3em 1em 0.3em 1em; }
+div.info table td.td-0 { border-right:solid rgb(102,102,153) 1px; white-space:nowrap; }
+div.info table td.td-n { border-right:solid rgb(102,102,153) 1px; }
+div.info table td h3 {
+	color:black;
+	font-size:1.1em;
+	margin-left:-0.3em;
+	}
+
+div.graph { margin-bottom:1em }
+div.graph h2 { background:rgb(204,204,204);; color:black; font-size:1em; margin:0; padding:0.1em 1em 0.1em 1em; }
+div.graph table { border:solid rgb(204,204,204) 1px; color:black; font-weight:normal; width:100%; }
+div.graph table td.td-0 { background:rgb(238,238,238); }
+div.graph table td.td-1 { background:rgb(221,221,221); }
+div.graph table td { padding:0.2em 1em 0.4em 1em; }
+
+div.div1,div.div2 { margin-bottom:1em; width:35em; }
+div.div3 { position:absolute; left:40em; top:1em; width:580px; }
+//div.div3 { position:absolute; left:37em; top:1em; right:1em; }
+
+div.sorting { margin:1.5em 0em 1.5em 2em }
+.center { text-align:center }
+.aright { position:absolute;right:1em }
+.right { text-align:right }
+.ok { color:rgb(0,200,0); font-weight:bold}
+.failed { color:rgb(200,0,0); font-weight:bold}
+
+span.box {
+	border: black solid 1px;
+	border-right:solid black 2px;
+	border-bottom:solid black 2px;
+	padding:0 0.5em 0 0.5em;
+	margin-right:1em;
+}
+span.green { background:#60F060; padding:0 0.5em 0 0.5em}
+span.red { background:#D06030; padding:0 0.5em 0 0.5em }
+
+div.authneeded {
+	background:rgb(238,238,238);
+	border:solid rgb(204,204,204) 1px;
+	color:rgb(200,0,0);
+	font-size:1.2em;
+	font-weight:bold;
+	padding:2em;
+	text-align:center;
+	}
+	
+input {
+	background:rgb(153,153,204);
+	border:solid rgb(102,102,153) 2px;
+	color:white;
+	font-weight:bold;
+	margin-right:1em;
+	padding:0.1em 0.5em 0.1em 0.5em;
+	}
+//-->
+</style>
+</head>
+<body>
+<div class="head">
+	<h1 class="apc">
+		<div class="logo"><span class="logo"><a href="http://pecl.php.net/package/APC">APC</a></span></div>
+		<div class="nameinfo">Opcode Cache</div>
+	</h1>
+	<div class="login">
+	<?php put_login_link(); ?>
+	</div>
+	<hr class="apc">
+</div>
+<?php
+
+
+// Display main Menu
+echo <<<EOB
+	<ol class=menu>
+	<li><a href="$MY_SELF&OB={$MYREQUEST['OB']}&SH={$MYREQUEST['SH']}">Refresh Data</a></li>
+EOB;
+echo
+	menu_entry(1,'View Host Stats'),
+	menu_entry(2,'System Cache Entries');
+if ($AUTHENTICATED) {
+	echo menu_entry(4,'Per-Directory Entries');
+}
+echo
+	menu_entry(3,'User Cache Entries'),
+	menu_entry(9,'Version Check');
+	
+if ($AUTHENTICATED) {
+	echo <<<EOB
+		<li><a class="aright" href="$MY_SELF&CC=1&OB={$MYREQUEST['OB']}" onClick="javascript:return confirm('Are you sure?');">Clear $cache_mode Cache</a></li>
+EOB;
+}
+echo <<<EOB
+	</ol>
+EOB;
+
+
+// CONTENT
+echo <<<EOB
+	<div class=content>
+EOB;
+
+// MAIN SWITCH STATEMENT 
+
+switch ($MYREQUEST['OB']) {
+
+
+
+
+
+// -----------------------------------------------
+// Host Stats
+// -----------------------------------------------
+case OB_HOST_STATS:
+	$mem_size = $mem['num_seg']*$mem['seg_size'];
+	$mem_avail= $mem['avail_mem'];
+	$mem_used = $mem_size-$mem_avail;
+	$seg_size = bsize($mem['seg_size']);
+	$req_rate = sprintf("%.2f",($cache['num_hits']+$cache['num_misses'])/($time-$cache['start_time']));
+	$hit_rate = sprintf("%.2f",($cache['num_hits'])/($time-$cache['start_time']));
+	$miss_rate = sprintf("%.2f",($cache['num_misses'])/($time-$cache['start_time']));
+	$insert_rate = sprintf("%.2f",($cache['num_inserts'])/($time-$cache['start_time']));
+	$req_rate_user = sprintf("%.2f",($cache_user['num_hits']+$cache_user['num_misses'])/($time-$cache_user['start_time']));
+	$hit_rate_user = sprintf("%.2f",($cache_user['num_hits'])/($time-$cache_user['start_time']));
+	$miss_rate_user = sprintf("%.2f",($cache_user['num_misses'])/($time-$cache_user['start_time']));
+	$insert_rate_user = sprintf("%.2f",($cache_user['num_inserts'])/($time-$cache_user['start_time']));
+	$apcversion = phpversion('apc');
+	$phpversion = phpversion();
+	$number_files = $cache['num_entries']; 
+    $size_files = bsize($cache['mem_size']);
+	$number_vars = $cache_user['num_entries'];
+    $size_vars = bsize($cache_user['mem_size']);
+	$i=0;
+	echo <<< EOB
+		<div class="info div1"><h2>General Cache Information</h2>
+		<table cellspacing=0><tbody>
+		<tr class=tr-0><td class=td-0>APC Version</td><td>$apcversion</td></tr>
+		<tr class=tr-1><td class=td-0>PHP Version</td><td>$phpversion</td></tr>
+EOB;
+
+	if(!empty($_SERVER['SERVER_NAME']))
+		echo "<tr class=tr-0><td class=td-0>APC Host</td><td>{$_SERVER['SERVER_NAME']} $host</td></tr>\n";
+	if(!empty($_SERVER['SERVER_SOFTWARE']))
+		echo "<tr class=tr-1><td class=td-0>Server Software</td><td>{$_SERVER['SERVER_SOFTWARE']}</td></tr>\n";
+
+	echo <<<EOB
+		<tr class=tr-0><td class=td-0>Shared Memory</td><td>{$mem['num_seg']} Segment(s) with $seg_size 
+    <br/> ({$cache['memory_type']} memory, {$cache['locking_type']} locking)
+    </td></tr>
+EOB;
+	echo   '<tr class=tr-1><td class=td-0>Start Time</td><td>',date(DATE_FORMAT,$cache['start_time']),'</td></tr>';
+	echo   '<tr class=tr-0><td class=td-0>Uptime</td><td>',duration($cache['start_time']),'</td></tr>';
+	echo   '<tr class=tr-1><td class=td-0>File Upload Support</td><td>',$cache['file_upload_progress'],'</td></tr>';
+	echo <<<EOB
+		</tbody></table>
+		</div>
+
+		<div class="info div1"><h2>File Cache Information</h2>
+		<table cellspacing=0><tbody>
+		<tr class=tr-0><td class=td-0>Cached Files</td><td>$number_files ($size_files)</td></tr>
+		<tr class=tr-1><td class=td-0>Hits</td><td>{$cache['num_hits']}</td></tr>
+		<tr class=tr-0><td class=td-0>Misses</td><td>{$cache['num_misses']}</td></tr>
+		<tr class=tr-1><td class=td-0>Request Rate (hits, misses)</td><td>$req_rate cache requests/second</td></tr>
+		<tr class=tr-0><td class=td-0>Hit Rate</td><td>$hit_rate cache requests/second</td></tr>
+		<tr class=tr-1><td class=td-0>Miss Rate</td><td>$miss_rate cache requests/second</td></tr>
+		<tr class=tr-0><td class=td-0>Insert Rate</td><td>$insert_rate cache requests/second</td></tr>
+		<tr class=tr-1><td class=td-0>Cache full count</td><td>{$cache['expunges']}</td></tr>
+		</tbody></table>
+		</div>
+
+		<div class="info div1"><h2>User Cache Information</h2>
+		<table cellspacing=0><tbody>
+    <tr class=tr-0><td class=td-0>Cached Variables</td><td>$number_vars ($size_vars)</td></tr>
+		<tr class=tr-1><td class=td-0>Hits</td><td>{$cache_user['num_hits']}</td></tr>
+		<tr class=tr-0><td class=td-0>Misses</td><td>{$cache_user['num_misses']}</td></tr>
+		<tr class=tr-1><td class=td-0>Request Rate (hits, misses)</td><td>$req_rate_user cache requests/second</td></tr>
+		<tr class=tr-0><td class=td-0>Hit Rate</td><td>$hit_rate_user cache requests/second</td></tr>
+		<tr class=tr-1><td class=td-0>Miss Rate</td><td>$miss_rate_user cache requests/second</td></tr>
+		<tr class=tr-0><td class=td-0>Insert Rate</td><td>$insert_rate_user cache requests/second</td></tr>
+		<tr class=tr-1><td class=td-0>Cache full count</td><td>{$cache_user['expunges']}</td></tr>
+
+		</tbody></table>
+		</div>
+
+		<div class="info div2"><h2>Runtime Settings</h2><table cellspacing=0><tbody>
+EOB;
+
+	$j = 0;
+	foreach (ini_get_all('apc') as $k => $v) {
+		echo "<tr class=tr-$j><td class=td-0>",$k,"</td><td>",str_replace(',',',<br />',$v['local_value']),"</td></tr>\n";
+		$j = 1 - $j;
+	}
+
+	if($mem['num_seg']>1 || $mem['num_seg']==1 && count($mem['block_lists'][0])>1)
+		$mem_note = "Memory Usage<br /><font size=-2>(multiple slices indicate fragments)</font>";
+	else
+		$mem_note = "Memory Usage";
+
+	echo <<< EOB
+		</tbody></table>
+		</div>
+
+		<div class="graph div3"><h2>Host Status Diagrams</h2>
+		<table cellspacing=0><tbody>
+EOB;
+	$size='width='.(GRAPH_SIZE+50).' height='.(GRAPH_SIZE+10);
+	echo <<<EOB
+		<tr>
+		<td class=td-0>$mem_note</td>
+		<td class=td-1>Hits &amp; Misses</td>
+		</tr>
+EOB;
+
+	echo
+		graphics_avail() ? 
+			  '<tr>'.
+			  "<td class=td-0><img alt=\"\" $size src=\"$PHP_SELF?IMG=1&$time\"></td>".
+			  "<td class=td-1><img alt=\"\" $size src=\"$PHP_SELF?IMG=2&$time\"></td></tr>\n"
+			: "",
+		'<tr>',
+		'<td class=td-0><span class="green box">&nbsp;</span>Free: ',bsize($mem_avail).sprintf(" (%.1f%%)",$mem_avail*100/$mem_size),"</td>\n",
+		'<td class=td-1><span class="green box">&nbsp;</span>Hits: ',$cache['num_hits'].sprintf(" (%.1f%%)",$cache['num_hits']*100/($cache['num_hits']+$cache['num_misses'])),"</td>\n",
+		'</tr>',
+		'<tr>',
+		'<td class=td-0><span class="red box">&nbsp;</span>Used: ',bsize($mem_used ).sprintf(" (%.1f%%)",$mem_used *100/$mem_size),"</td>\n",
+		'<td class=td-1><span class="red box">&nbsp;</span>Misses: ',$cache['num_misses'].sprintf(" (%.1f%%)",$cache['num_misses']*100/($cache['num_hits']+$cache['num_misses'])),"</td>\n";
+	echo <<< EOB
+		</tr>
+		</tbody></table>
+
+		<br/>
+		<h2>Detailed Memory Usage and Fragmentation</h2>
+		<table cellspacing=0><tbody>
+		<tr>
+		<td class=td-0 colspan=2><br/>
+EOB;
+
+	// Fragementation: (freeseg - 1) / total_seg
+	$nseg = $freeseg = $fragsize = $freetotal = 0;
+	for($i=0; $i<$mem['num_seg']; $i++) {
+		$ptr = 0;
+		foreach($mem['block_lists'][$i] as $block) {
+			if ($block['offset'] != $ptr) {
+				++$nseg;
+			}
+			$ptr = $block['offset'] + $block['size'];
+                        /* Only consider blocks <5M for the fragmentation % */
+                        if($block['size']<(5*1024*1024)) $fragsize+=$block['size'];
+                        $freetotal+=$block['size'];
+		}
+		$freeseg += count($mem['block_lists'][$i]);
+	}
+	
+	if ($freeseg > 1) {
+		$frag = sprintf("%.2f%% (%s out of %s in %d fragments)", ($fragsize/$freetotal)*100,bsize($fragsize),bsize($freetotal),$freeseg);
+	} else {
+		$frag = "0%";
+	}
+
+	if (graphics_avail()) {
+		$size='width='.(2*GRAPH_SIZE+150).' height='.(GRAPH_SIZE+10);
+		echo <<<EOB
+			<img alt="" $size src="$PHP_SELF?IMG=3&$time">
+EOB;
+	}
+	echo <<<EOB
+		</br>Fragmentation: $frag
+		</td>
+		</tr>
+EOB;
+        if(isset($mem['adist'])) {
+          foreach($mem['adist'] as $i=>$v) {
+            $cur = pow(2,$i); $nxt = pow(2,$i+1)-1;
+            if($i==0) $range = "1";
+            else $range = "$cur - $nxt";
+            echo "<tr><th align=right>$range</th><td align=right>$v</td></tr>\n";
+          }
+        }
+        echo <<<EOB
+		</tbody></table>
+		</div>
+EOB;
+		
+	break;
+
+
+// -----------------------------------------------
+// User Cache Entries
+// -----------------------------------------------
+case OB_USER_CACHE:
+	if (!$AUTHENTICATED) {
+    echo '<div class="error">You need to login to see the user values here!<br/>&nbsp;<br/>';
+		put_login_link("Login now!");
+		echo '</div>';
+		break;
+	}
+	$fieldname='info';
+	$fieldheading='User Entry Label';
+	$fieldkey='info';
+
+// -----------------------------------------------
+// System Cache Entries		
+// -----------------------------------------------
+case OB_SYS_CACHE:	
+	if (!isset($fieldname))
+	{
+		$fieldname='filename';
+		$fieldheading='Script Filename';
+		if(ini_get("apc.stat")) $fieldkey='inode';
+		else $fieldkey='filename'; 
+	}
+	if (!empty($MYREQUEST['SH']))
+	{
+		echo <<< EOB
+			<div class="info"><table cellspacing=0><tbody>
+			<tr><th>Attribute</th><th>Value</th></tr>
+EOB;
+
+		$m=0;
+		foreach($scope_list as $j => $list) {
+			foreach($cache[$list] as $i => $entry) {
+				if (md5($entry[$fieldkey])!=$MYREQUEST['SH']) continue;
+				foreach($entry as $k => $value) {
+					if (!$AUTHENTICATED) {
+						// hide all path entries if not logged in
+						$value=preg_replace('/^.*(\\/|\\\\)/','<i>&lt;hidden&gt;</i>/',$value);
+					}
+
+					if ($k == "num_hits") {
+						$value=sprintf("%s (%.2f%%)",$value,$value*100/$cache['num_hits']);
+					}
+					if ($k == 'deletion_time') {
+						if(!$entry['deletion_time']) $value = "None";
+					}
+					echo
+						"<tr class=tr-$m>",
+						"<td class=td-0>",ucwords(preg_replace("/_/"," ",$k)),"</td>",
+						"<td class=td-last>",(preg_match("/time/",$k) && $value!='None') ? date(DATE_FORMAT,$value) : htmlspecialchars($value, ENT_QUOTES, 'UTF-8'),"</td>",
+						"</tr>";
+					$m=1-$m;
+				}
+				if($fieldkey=='info') {
+					echo "<tr class=tr-$m><td class=td-0>Stored Value</td><td class=td-last><pre>";
+					$output = var_export(apc_fetch($entry[$fieldkey]),true);
+					echo htmlspecialchars($output, ENT_QUOTES, 'UTF-8');
+					echo "</pre></td></tr>\n";
+				}
+				break;
+			}
+		}
+
+		echo <<<EOB
+			</tbody></table>
+			</div>
+EOB;
+		break;
+	}
+
+	$cols=6;
+	echo <<<EOB
+		<div class=sorting><form>Scope:
+		<input type=hidden name=OB value={$MYREQUEST['OB']}>
+		<select name=SCOPE>
+EOB;
+	echo 
+		"<option value=A",$MYREQUEST['SCOPE']=='A' ? " selected":"",">Active</option>",
+		"<option value=D",$MYREQUEST['SCOPE']=='D' ? " selected":"",">Deleted</option>",
+		"</select>",
+		", Sorting:<select name=SORT1>",
+		"<option value=H",$MYREQUEST['SORT1']=='H' ? " selected":"",">Hits</option>",
+		"<option value=Z",$MYREQUEST['SORT1']=='Z' ? " selected":"",">Size</option>",
+		"<option value=S",$MYREQUEST['SORT1']=='S' ? " selected":"",">$fieldheading</option>",
+		"<option value=A",$MYREQUEST['SORT1']=='A' ? " selected":"",">Last accessed</option>",
+		"<option value=M",$MYREQUEST['SORT1']=='M' ? " selected":"",">Last modified</option>",
+		"<option value=C",$MYREQUEST['SORT1']=='C' ? " selected":"",">Created at</option>",
+		"<option value=D",$MYREQUEST['SORT1']=='D' ? " selected":"",">Deleted at</option>";
+	if($fieldname=='info') echo
+		"<option value=D",$MYREQUEST['SORT1']=='T' ? " selected":"",">Timeout</option>";
+	echo 
+		'</select>',
+		'<select name=SORT2>',
+		'<option value=D',$MYREQUEST['SORT2']=='D' ? ' selected':'','>DESC</option>',
+		'<option value=A',$MYREQUEST['SORT2']=='A' ? ' selected':'','>ASC</option>',
+		'</select>',
+		'<select name=COUNT onChange="form.submit()">',
+		'<option value=10 ',$MYREQUEST['COUNT']=='10' ? ' selected':'','>Top 10</option>',
+		'<option value=20 ',$MYREQUEST['COUNT']=='20' ? ' selected':'','>Top 20</option>',
+		'<option value=50 ',$MYREQUEST['COUNT']=='50' ? ' selected':'','>Top 50</option>',
+		'<option value=100',$MYREQUEST['COUNT']=='100'? ' selected':'','>Top 100</option>',
+		'<option value=150',$MYREQUEST['COUNT']=='150'? ' selected':'','>Top 150</option>',
+		'<option value=200',$MYREQUEST['COUNT']=='200'? ' selected':'','>Top 200</option>',
+		'<option value=500',$MYREQUEST['COUNT']=='500'? ' selected':'','>Top 500</option>',
+		'<option value=0  ',$MYREQUEST['COUNT']=='0'  ? ' selected':'','>All</option>',
+		'</select>',
+    '&nbsp; Search: <input name=SEARCH value="',$MYREQUEST['SEARCH'],'" type=text size=25/>',
+		'&nbsp;<input type=submit value="GO!">',
+		'</form></div>';
+
+  if (isset($MYREQUEST['SEARCH'])) {
+   // Don't use preg_quote because we want the user to be able to specify a
+   // regular expression subpattern.
+   $MYREQUEST['SEARCH'] = '/'.str_replace('/', '\\/', $MYREQUEST['SEARCH']).'/i';
+   if (preg_match($MYREQUEST['SEARCH'], 'test') === false) {
+     echo '<div class="error">Error: enter a valid regular expression as a search query.</div>';
+     break;
+   }
+  }
+
+  echo
+		'<div class="info"><table cellspacing=0><tbody>',
+		'<tr>',
+		'<th>',sortheader('S',$fieldheading,  "&OB=".$MYREQUEST['OB']),'</th>',
+		'<th>',sortheader('H','Hits',         "&OB=".$MYREQUEST['OB']),'</th>',
+		'<th>',sortheader('Z','Size',         "&OB=".$MYREQUEST['OB']),'</th>',
+		'<th>',sortheader('A','Last accessed',"&OB=".$MYREQUEST['OB']),'</th>',
+		'<th>',sortheader('M','Last modified',"&OB=".$MYREQUEST['OB']),'</th>',
+		'<th>',sortheader('C','Created at',   "&OB=".$MYREQUEST['OB']),'</th>';
+
+	if($fieldname=='info') {
+		$cols+=2;
+		 echo '<th>',sortheader('T','Timeout',"&OB=".$MYREQUEST['OB']),'</th>';
+	}
+	echo '<th>',sortheader('D','Deleted at',"&OB=".$MYREQUEST['OB']),'</th></tr>';
+
+	// builds list with alpha numeric sortable keys
+	//
+	$list = array();
+	foreach($cache[$scope_list[$MYREQUEST['SCOPE']]] as $i => $entry) {
+		switch($MYREQUEST['SORT1']) {
+			case 'A': $k=sprintf('%015d-',$entry['access_time']); 	break;
+			case 'H': $k=sprintf('%015d-',$entry['num_hits']); 		break;
+			case 'Z': $k=sprintf('%015d-',$entry['mem_size']); 		break;
+			case 'M': $k=sprintf('%015d-',$entry['mtime']);			break;
+			case 'C': $k=sprintf('%015d-',$entry['creation_time']);	break;
+			case 'T': $k=sprintf('%015d-',$entry['ttl']);			break;
+			case 'D': $k=sprintf('%015d-',$entry['deletion_time']);	break;
+			case 'S': $k='';										break;
+		}
+		if (!$AUTHENTICATED) {
+			// hide all path entries if not logged in
+			$list[$k.$entry[$fieldname]]=preg_replace('/^.*(\\/|\\\\)/','*hidden*/',$entry);
+		} else {
+			$list[$k.$entry[$fieldname]]=$entry;
+		}
+	}
+
+	if ($list) {
+		
+		// sort list
+		//
+		switch ($MYREQUEST['SORT2']) {
+			case "A":	krsort($list);	break;
+			case "D":	ksort($list);	break;
+		}
+		
+		// output list
+		$i=0;
+		foreach($list as $k => $entry) {
+      if(!$MYREQUEST['SEARCH'] || preg_match($MYREQUEST['SEARCH'], $entry[$fieldname]) != 0) {  
+        $field_value = htmlentities(strip_tags($entry[$fieldname],''), ENT_QUOTES, 'UTF-8');
+        echo
+          '<tr class=tr-',$i%2,'>',
+          "<td class=td-0><a href=\"$MY_SELF&OB=",$MYREQUEST['OB'],"&SH=",md5($entry[$fieldkey]),"\">",$field_value,'</a></td>',
+          '<td class="td-n center">',$entry['num_hits'],'</td>',
+          '<td class="td-n right">',$entry['mem_size'],'</td>',
+          '<td class="td-n center">',date(DATE_FORMAT,$entry['access_time']),'</td>',
+          '<td class="td-n center">',date(DATE_FORMAT,$entry['mtime']),'</td>',
+          '<td class="td-n center">',date(DATE_FORMAT,$entry['creation_time']),'</td>';
+
+        if($fieldname=='info') {
+          if($entry['ttl'])
+            echo '<td class="td-n center">'.$entry['ttl'].' seconds</td>';
+          else
+            echo '<td class="td-n center">None</td>';
+        }
+        if ($entry['deletion_time']) {
+
+          echo '<td class="td-last center">', date(DATE_FORMAT,$entry['deletion_time']), '</td>';
+        } else if ($MYREQUEST['OB'] == OB_USER_CACHE) {
+
+          echo '<td class="td-last center">';
+          echo '[<a href="', $MY_SELF, '&OB=', $MYREQUEST['OB'], '&DU=', urlencode($entry[$fieldkey]), '">Delete Now</a>]';
+          echo '</td>';
+        } else {
+          echo '<td class="td-last center"> &nbsp; </td>';
+        }
+        echo '</tr>';
+        $i++;
+        if ($i == $MYREQUEST['COUNT'])
+          break;
+      }
+		}
+		
+	} else {
+		echo '<tr class=tr-0><td class="center" colspan=',$cols,'><i>No data</i></td></tr>';
+	}
+	echo <<< EOB
+		</tbody></table>
+EOB;
+
+	if ($list && $i < count($list)) {
+		echo "<a href=\"$MY_SELF&OB=",$MYREQUEST['OB'],"&COUNT=0\"><i>",count($list)-$i,' more available...</i></a>';
+	}
+
+	echo <<< EOB
+		</div>
+EOB;
+	break;
+
+
+// -----------------------------------------------
+// Per-Directory System Cache Entries
+// -----------------------------------------------
+case OB_SYS_CACHE_DIR:	
+	if (!$AUTHENTICATED) {
+		break;
+	}
+
+	echo <<<EOB
+		<div class=sorting><form>Scope:
+		<input type=hidden name=OB value={$MYREQUEST['OB']}>
+		<select name=SCOPE>
+EOB;
+	echo 
+		"<option value=A",$MYREQUEST['SCOPE']=='A' ? " selected":"",">Active</option>",
+		"<option value=D",$MYREQUEST['SCOPE']=='D' ? " selected":"",">Deleted</option>",
+		"</select>",
+		", Sorting:<select name=SORT1>",
+		"<option value=H",$MYREQUEST['SORT1']=='H' ? " selected":"",">Total Hits</option>",
+		"<option value=Z",$MYREQUEST['SORT1']=='Z' ? " selected":"",">Total Size</option>",
+		"<option value=T",$MYREQUEST['SORT1']=='T' ? " selected":"",">Number of Files</option>",
+		"<option value=S",$MYREQUEST['SORT1']=='S' ? " selected":"",">Directory Name</option>",
+		"<option value=A",$MYREQUEST['SORT1']=='A' ? " selected":"",">Avg. Size</option>",
+		"<option value=C",$MYREQUEST['SORT1']=='C' ? " selected":"",">Avg. Hits</option>",
+		'</select>',
+		'<select name=SORT2>',
+		'<option value=D',$MYREQUEST['SORT2']=='D' ? ' selected':'','>DESC</option>',
+		'<option value=A',$MYREQUEST['SORT2']=='A' ? ' selected':'','>ASC</option>',
+		'</select>',
+		'<select name=COUNT onChange="form.submit()">',
+		'<option value=10 ',$MYREQUEST['COUNT']=='10' ? ' selected':'','>Top 10</option>',
+		'<option value=20 ',$MYREQUEST['COUNT']=='20' ? ' selected':'','>Top 20</option>',
+		'<option value=50 ',$MYREQUEST['COUNT']=='50' ? ' selected':'','>Top 50</option>',
+		'<option value=100',$MYREQUEST['COUNT']=='100'? ' selected':'','>Top 100</option>',
+		'<option value=150',$MYREQUEST['COUNT']=='150'? ' selected':'','>Top 150</option>',
+		'<option value=200',$MYREQUEST['COUNT']=='200'? ' selected':'','>Top 200</option>',
+		'<option value=500',$MYREQUEST['COUNT']=='500'? ' selected':'','>Top 500</option>',
+		'<option value=0  ',$MYREQUEST['COUNT']=='0'  ? ' selected':'','>All</option>',
+		'</select>',
+		", Group By Dir Level:<select name=AGGR>",
+		"<option value='' selected>None</option>";
+		for ($i = 1; $i < 10; $i++)
+			echo "<option value=$i",$MYREQUEST['AGGR']==$i ? " selected":"",">$i</option>";
+		echo '</select>',
+		'&nbsp;<input type=submit value="GO!">',
+		'</form></div>',
+
+		'<div class="info"><table cellspacing=0><tbody>',
+		'<tr>',
+		'<th>',sortheader('S','Directory Name',	"&OB=".$MYREQUEST['OB']),'</th>',
+		'<th>',sortheader('T','Number of Files',"&OB=".$MYREQUEST['OB']),'</th>',
+		'<th>',sortheader('H','Total Hits',	"&OB=".$MYREQUEST['OB']),'</th>',
+		'<th>',sortheader('Z','Total Size',	"&OB=".$MYREQUEST['OB']),'</th>',
+		'<th>',sortheader('C','Avg. Hits',	"&OB=".$MYREQUEST['OB']),'</th>',
+		'<th>',sortheader('A','Avg. Size',	"&OB=".$MYREQUEST['OB']),'</th>',
+		'</tr>';
+
+	// builds list with alpha numeric sortable keys
+	//
+	$tmp = $list = array();
+	foreach($cache[$scope_list[$MYREQUEST['SCOPE']]] as $entry) {
+		$n = dirname($entry['filename']);
+		if ($MYREQUEST['AGGR'] > 0) {
+			$n = preg_replace("!^(/?(?:[^/\\\\]+[/\\\\]){".($MYREQUEST['AGGR']-1)."}[^/\\\\]*).*!", "$1", $n);
+		}
+		if (!isset($tmp[$n])) {
+			$tmp[$n] = array('hits'=>0,'size'=>0,'ents'=>0);
+		}
+		$tmp[$n]['hits'] += $entry['num_hits'];
+		$tmp[$n]['size'] += $entry['mem_size'];
+		++$tmp[$n]['ents'];
+	}
+
+	foreach ($tmp as $k => $v) {
+		switch($MYREQUEST['SORT1']) {
+			case 'A': $kn=sprintf('%015d-',$v['size'] / $v['ents']);break;
+			case 'T': $kn=sprintf('%015d-',$v['ents']);		break;
+			case 'H': $kn=sprintf('%015d-',$v['hits']);		break;
+			case 'Z': $kn=sprintf('%015d-',$v['size']);		break;
+			case 'C': $kn=sprintf('%015d-',$v['hits'] / $v['ents']);break;
+			case 'S': $kn = $k;					break;
+		}
+		$list[$kn.$k] = array($k, $v['ents'], $v['hits'], $v['size']);
+	}
+
+	if ($list) {
+		
+		// sort list
+		//
+		switch ($MYREQUEST['SORT2']) {
+			case "A":	krsort($list);	break;
+			case "D":	ksort($list);	break;
+		}
+		
+		// output list
+		$i = 0;
+		foreach($list as $entry) {
+			echo
+				'<tr class=tr-',$i%2,'>',
+				"<td class=td-0>",$entry[0],'</a></td>',
+				'<td class="td-n center">',$entry[1],'</td>',
+				'<td class="td-n center">',$entry[2],'</td>',
+				'<td class="td-n center">',$entry[3],'</td>',
+				'<td class="td-n center">',round($entry[2] / $entry[1]),'</td>',
+				'<td class="td-n center">',round($entry[3] / $entry[1]),'</td>',
+				'</tr>';
+
+			if (++$i == $MYREQUEST['COUNT']) break;
+		}
+		
+	} else {
+		echo '<tr class=tr-0><td class="center" colspan=6><i>No data</i></td></tr>';
+	}
+	echo <<< EOB
+		</tbody></table>
+EOB;
+
+	if ($list && $i < count($list)) {
+		echo "<a href=\"$MY_SELF&OB=",$MYREQUEST['OB'],"&COUNT=0\"><i>",count($list)-$i,' more available...</i></a>';
+	}
+
+	echo <<< EOB
+		</div>
+EOB;
+	break;
+
+// -----------------------------------------------
+// Version check
+// -----------------------------------------------
+case OB_VERSION_CHECK:
+	echo <<<EOB
+		<div class="info"><h2>APC Version Information</h2>
+		<table cellspacing=0><tbody>
+		<tr>
+		<th></th>
+		</tr>
+EOB;
+  if (defined('PROXY')) {
+    $ctxt = stream_context_create( array( 'http' => array( 'proxy' => PROXY, 'request_fulluri' => True ) ) );
+    $rss = @file_get_contents("http://pecl.php.net/feeds/pkg_apc.rss", False, $ctxt);
+  } else {
+    $rss = @file_get_contents("http://pecl.php.net/feeds/pkg_apc.rss");
+  }
+	if (!$rss) {
+		echo '<tr class="td-last center"><td>Unable to fetch version information.</td></tr>';
+	} else {
+		$apcversion = phpversion('apc');
+
+		preg_match('!<title>APC ([0-9.]+)</title>!', $rss, $match);
+		echo '<tr class="tr-0 center"><td>';
+		if (version_compare($apcversion, $match[1], '>=')) {
+			echo '<div class="ok">You are running the latest version of APC ('.$apcversion.')</div>';
+			$i = 3;
+		} else {
+			echo '<div class="failed">You are running an older version of APC ('.$apcversion.'), 
+				newer version '.$match[1].' is available at <a href="http://pecl.php.net/package/APC/'.$match[1].'">
+				http://pecl.php.net/package/APC/'.$match[1].'</a>
+				</div>';
+			$i = -1;
+		}
+		echo '</td></tr>';
+		echo '<tr class="tr-0"><td><h3>Change Log:</h3><br/>';
+
+		preg_match_all('!<(title|description)>([^<]+)</\\1>!', $rss, $match);
+		next($match[2]); next($match[2]);
+
+		while (list(,$v) = each($match[2])) {
+			list(,$ver) = explode(' ', $v, 2);
+			if ($i < 0 && version_compare($apcversion, $ver, '>=')) {
+				break;
+			} else if (!$i--) {
+				break;
+			}
+			echo "<b><a href=\"http://pecl.php.net/package/APC/$ver\">".htmlspecialchars($v, ENT_QUOTES, 'UTF-8')."</a></b><br><blockquote>";
+			echo nl2br(htmlspecialchars(current($match[2]), ENT_QUOTES, 'UTF-8'))."</blockquote>";
+			next($match[2]);
+		}
+		echo '</td></tr>';
+	}
+	echo <<< EOB
+		</tbody></table>
+		</div>
+EOB;
+	break;
+
+}
+
+echo <<< EOB
+	</div>
+EOB;
+
+?>
+
+<!-- <?php echo "\nBased on APCGUI By R.Becker\n$VERSION\n"?> -->
+</body>
+</html>
diff -Nru php-5.4.19/ext/apc/apc_php.h php-5.4.19.bak/ext/apc/apc_php.h
--- php-5.4.19/ext/apc/apc_php.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_php.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,81 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          George Schlossnagle <george@omniti.com>                     |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  |          Arun C. Murthy <arunc@yahoo-inc.com>                        |
+  |          Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_php.h 313808 2011-07-28 06:17:10Z gopalv $ */
+
+#ifndef APC_PHP_H
+#define APC_PHP_H
+
+/*
+ * The purpose of this header file is to include all PHP and Zend headers that
+ * are typically needed elsewhere in APC. This makes it easy to insure that
+ * all required headers are available.
+ */
+
+#include "php.h"
+#include "zend.h"
+#include "zend_API.h"
+#include "zend_compile.h"
+#include "zend_hash.h"
+#include "zend_extensions.h"
+
+#if ZEND_MODULE_API_NO >= 20100409
+#define ZEND_ENGINE_2_4
+#endif
+#if ZEND_MODULE_API_NO > 20060613
+#define ZEND_ENGINE_2_3
+#endif
+#if ZEND_MODULE_API_NO > 20050922
+#define ZEND_ENGINE_2_2
+#endif
+#if ZEND_MODULE_API_NO > 20050921
+#define ZEND_ENGINE_2_1
+#endif
+#ifdef ZEND_ENGINE_2_1
+#include "zend_vm.h"
+#endif
+
+#ifndef IS_CONSTANT_TYPE_MASK
+#define IS_CONSTANT_TYPE_MASK (~IS_CONSTANT_INDEX)
+#endif
+
+#include "rfc1867.h"
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_php_pcre.h php-5.4.19.bak/ext/apc/apc_php_pcre.h
--- php-5.4.19/ext/apc/apc_php_pcre.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_php_pcre.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,98 @@
+/*
+   +----------------------------------------------------------------------+
+   | APC/PHP Version 5                                                    |
+   +----------------------------------------------------------------------+
+   | Copyright (c) 1997-2011 The PHP Group                                |
+   +----------------------------------------------------------------------+
+   | This source file is subject to version 3.01 of the PHP license,      |
+   | that is bundled with this package in the file LICENSE, and is        |
+   | available through the world-wide-web at the following url:           |
+   | http://www.php.net/license/3_01.txt                                  |
+   | If you did not receive a copy of the PHP license and are unable to   |
+   | obtain it through the world-wide-web, please send a note to          |
+   | license@php.net so we can mail you a copy immediately.               |
+   +----------------------------------------------------------------------+
+   | Author: Andrei Zmievski <andrei@php.net>                             |
+   +----------------------------------------------------------------------+
+ */
+ 
+/* $Id: apc_php_pcre.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef PHP_PCRE_H
+#define PHP_PCRE_H
+
+#if HAVE_PCRE || HAVE_BUNDLED_PCRE
+
+#if HAVE_BUNDLED_PCRE
+#include "ext/pcre/pcrelib/pcre.h"
+#else
+#include "pcre.h"
+#endif
+
+#if HAVE_LOCALE_H
+#include <locale.h>
+#endif
+
+PHP_FUNCTION(preg_match);
+PHP_FUNCTION(preg_match_all);
+PHP_FUNCTION(preg_replace);
+PHP_FUNCTION(preg_replace_callback);
+PHP_FUNCTION(preg_split);
+PHP_FUNCTION(preg_quote);
+PHP_FUNCTION(preg_grep);
+
+PHPAPI char *php_pcre_replace(char *regex, int regex_len, char *subject, int subject_len, zval *replace_val, int is_callable_replace, int *result_len, int limit, int *replace_count TSRMLS_DC);
+PHPAPI pcre* pcre_get_compiled_regex(char *regex, pcre_extra **extra, int *options TSRMLS_DC);
+PHPAPI pcre* pcre_get_compiled_regex_ex(char *regex, pcre_extra **extra, int *preg_options, int *coptions TSRMLS_DC);
+
+extern zend_module_entry pcre_module_entry;
+#define pcre_module_ptr &pcre_module_entry
+
+typedef struct {
+	pcre *re;
+	pcre_extra *extra;
+	int preg_options;
+#if HAVE_SETLOCALE
+	char *locale;
+	unsigned const char *tables;
+#endif
+	int compile_options;
+	int refcount;
+} pcre_cache_entry;
+
+PHPAPI pcre_cache_entry* pcre_get_compiled_regex_cache(char *regex, int regex_len TSRMLS_DC);
+
+PHPAPI void  php_pcre_match_impl(  pcre_cache_entry *pce, char *subject, int subject_len, zval *return_value,
+	zval *subpats, int global, int use_flags, long flags, long start_offset TSRMLS_DC);
+
+PHPAPI char *php_pcre_replace_impl(pcre_cache_entry *pce, char *subject, int subject_len, zval *return_value, 
+	int is_callable_replace, int *result_len, int limit, int *replace_count TSRMLS_DC);
+
+PHPAPI void  php_pcre_split_impl(  pcre_cache_entry *pce, char *subject, int subject_len, zval *return_value,
+	long limit_val, long flags TSRMLS_DC);
+
+PHPAPI void  php_pcre_grep_impl(   pcre_cache_entry *pce, zval *input, zval *return_value,
+	long flags TSRMLS_DC);
+
+ZEND_BEGIN_MODULE_GLOBALS(pcre)
+	HashTable pcre_cache;
+	long backtrack_limit;
+	long recursion_limit;
+	int  error_code;
+ZEND_END_MODULE_GLOBALS(pcre)
+
+#ifdef ZTS
+# define PCRE_G(v) TSRMG(pcre_globals_id, zend_pcre_globals *, v)
+#else
+# define PCRE_G(v)	(pcre_globals.v)
+#endif
+
+#else
+
+#define pcre_module_ptr NULL
+
+#endif /* HAVE_PCRE || HAVE_BUNDLED_PCRE */
+
+#define phpext_pcre_ptr pcre_module_ptr
+
+#endif /* PHP_PCRE_H */
diff -Nru php-5.4.19/ext/apc/apc_pool.c php-5.4.19.bak/ext/apc/apc_pool.c
--- php-5.4.19/ext/apc/apc_pool.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_pool.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,509 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt.                                 |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Yahoo! Inc. in 2008.
+
+   Future revisions and derivatives of this source code must acknowledge
+   Yahoo! Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_pool.c 327069 2012-08-12 08:56:55Z laruence $ */
+
+
+#include "apc_pool.h"
+#include <assert.h>
+
+#ifdef HAVE_VALGRIND_MEMCHECK_H
+#include <valgrind/memcheck.h>
+#endif
+
+/* {{{ forward references */
+static apc_pool* apc_unpool_create(apc_pool_type type, apc_malloc_t, apc_free_t, apc_protect_t, apc_unprotect_t TSRMLS_DC);
+static apc_pool* apc_realpool_create(apc_pool_type type, apc_malloc_t, apc_free_t, apc_protect_t, apc_unprotect_t TSRMLS_DC);
+/* }}} */
+
+/* {{{ apc_pool_create */
+apc_pool* apc_pool_create(apc_pool_type pool_type, 
+                            apc_malloc_t allocate, 
+                            apc_free_t deallocate,
+                            apc_protect_t protect,
+                            apc_unprotect_t unprotect
+			    TSRMLS_DC)
+{
+    if(pool_type == APC_UNPOOL) {
+        return apc_unpool_create(pool_type, allocate, deallocate,
+                                            protect, unprotect TSRMLS_CC);
+    }
+
+    return apc_realpool_create(pool_type, allocate, deallocate, 
+                                          protect,  unprotect TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ apc_pool_destroy */
+void apc_pool_destroy(apc_pool *pool TSRMLS_DC)
+{
+    apc_free_t deallocate = pool->deallocate;
+    apc_pcleanup_t cleanup = pool->cleanup;
+
+    cleanup(pool TSRMLS_CC);
+    deallocate(pool TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ apc_unpool implementation */
+
+typedef struct _apc_unpool apc_unpool;
+
+struct _apc_unpool {
+    apc_pool parent;
+    /* apc_unpool is a lie! */
+};
+
+static void* apc_unpool_alloc(apc_pool* pool, size_t size TSRMLS_DC) 
+{
+    apc_unpool *upool = (apc_unpool*)pool;
+
+    apc_malloc_t allocate = upool->parent.allocate;
+
+    upool->parent.size += size;
+    upool->parent.used += size;
+
+    return allocate(size TSRMLS_CC);
+}
+
+static void apc_unpool_free(apc_pool* pool, void *ptr TSRMLS_DC)
+{
+    apc_unpool *upool = (apc_unpool*) pool;
+
+    apc_free_t deallocate = upool->parent.deallocate;
+
+    deallocate(ptr TSRMLS_CC);
+}
+
+static void apc_unpool_cleanup(apc_pool* pool TSRMLS_DC)
+{
+}
+
+static apc_pool* apc_unpool_create(apc_pool_type type, 
+                    apc_malloc_t allocate, apc_free_t deallocate,
+                    apc_protect_t protect, apc_unprotect_t unprotect
+		    TSRMLS_DC)
+{
+    apc_unpool* upool = allocate(sizeof(apc_unpool) TSRMLS_CC);
+
+    if (!upool) {
+        return NULL;
+    }
+
+    upool->parent.type = type;
+    upool->parent.allocate = allocate;
+    upool->parent.deallocate = deallocate;
+
+    upool->parent.protect = protect;
+    upool->parent.unprotect = unprotect;
+
+    upool->parent.palloc = apc_unpool_alloc;
+    upool->parent.pfree  = apc_unpool_free;
+
+    upool->parent.cleanup = apc_unpool_cleanup;
+
+    upool->parent.used = 0;
+    upool->parent.size = 0;
+
+    return &(upool->parent);
+}
+/* }}} */
+
+/*{{{ apc_realpool implementation */
+
+/* {{{ typedefs */
+typedef struct _pool_block
+{
+    size_t              avail;
+    size_t              capacity;
+    unsigned char       *mark;
+    struct _pool_block  *next;
+    unsigned             :0; /* this should align to word */
+    /* data comes here */
+}pool_block;
+
+/*
+   parts in ? are optional and turned on for fun, memory loss,
+   and for something else that I forgot about ... ah, debugging
+
+                 |--------> data[]         |<-- non word boundary (too)
+   +-------------+--------------+-----------+-------------+-------------->>>
+   | pool_block  | ?sizeinfo<1> | block<1>  | ?redzone<1> | ?sizeinfo<2>
+   |             |  (size_t)    |           | padded left |
+   +-------------+--------------+-----------+-------------+-------------->>>
+ */
+
+typedef struct _apc_realpool apc_realpool;
+
+struct _apc_realpool
+{
+    struct _apc_pool parent;
+
+    size_t     dsize;
+    void       *owner;
+
+    unsigned long count;
+
+    pool_block *head;
+    pool_block first; 
+};
+
+/* }}} */
+
+/* {{{ redzone code */
+static const unsigned char decaff[] =  {
+    0xde, 0xca, 0xff, 0xc0, 0xff, 0xee, 0xba, 0xad,
+    0xde, 0xca, 0xff, 0xc0, 0xff, 0xee, 0xba, 0xad,
+    0xde, 0xca, 0xff, 0xc0, 0xff, 0xee, 0xba, 0xad,
+    0xde, 0xca, 0xff, 0xc0, 0xff, 0xee, 0xba, 0xad
+};
+
+/* a redzone is at least 4 (0xde,0xca,0xc0,0xff) bytes */
+#define REDZONE_SIZE(size) \
+    ((ALIGNWORD((size)) > ((size) + 4)) ? \
+        (ALIGNWORD((size)) - (size)) : /* does not change realsize */\
+        ALIGNWORD((size)) - (size) + ALIGNWORD((sizeof(char)))) /* adds 1 word to realsize */
+
+#define SIZEINFO_SIZE ALIGNWORD(sizeof(size_t))
+
+#define MARK_REDZONE(block, redsize) do {\
+       memcpy(block, decaff, redsize );\
+    } while(0)
+
+#define CHECK_REDZONE(block, redsize) (memcmp(block, decaff, redsize) == 0)
+
+/* }}} */
+
+#define INIT_POOL_BLOCK(rpool, entry, size) do {\
+    (entry)->avail = (entry)->capacity = (size);\
+    (entry)->mark =  ((unsigned char*)(entry)) + ALIGNWORD(sizeof(pool_block));\
+    (entry)->next = (rpool)->head;\
+    (rpool)->head = (entry);\
+} while(0)
+
+/* {{{ create_pool_block */
+static pool_block* create_pool_block(apc_realpool *rpool, size_t size TSRMLS_DC)
+{
+    apc_malloc_t allocate = rpool->parent.allocate;
+
+    size_t realsize = sizeof(pool_block) + ALIGNWORD(size);
+
+    pool_block* entry = allocate(realsize TSRMLS_CC);
+
+    if (!entry) {
+        return NULL;
+    }
+
+    INIT_POOL_BLOCK(rpool, entry, size);
+    
+    rpool->parent.size += realsize;
+
+    rpool->count++;
+
+    return entry;
+}
+/* }}} */
+
+/* {{{ apc_realpool_alloc */
+static void* apc_realpool_alloc(apc_pool *pool, size_t size TSRMLS_DC)
+{
+    apc_realpool *rpool = (apc_realpool*)pool;
+    unsigned char *p = NULL;
+    size_t realsize = ALIGNWORD(size);
+    size_t poolsize;
+    unsigned char *redzone  = NULL;
+    size_t redsize  = 0;
+    size_t *sizeinfo= NULL;
+    pool_block *entry = NULL;
+    unsigned long i;
+    
+    if(APC_POOL_HAS_REDZONES(pool)) {
+        redsize = REDZONE_SIZE(size); /* redsize might be re-using word size padding */
+        realsize = size + redsize;    /* recalculating realsize */
+    } else {
+        redsize = realsize - size; /* use padding space */
+    }
+
+    if(APC_POOL_HAS_SIZEINFO(pool)) {
+        realsize += ALIGNWORD(sizeof(size_t));
+    }
+
+    /* minimize look-back, a value of 8 seems to give similar fill-ratios (+2%)
+     * as looping through the entire list. And much faster in allocations. */
+    for(entry = rpool->head, i = 0; entry != NULL && (i < 8); entry = entry->next, i++) {
+        if(entry->avail >= realsize) {
+            goto found;
+        }
+    }
+
+    /* upgrade the pool type to reduce overhead */
+    if(rpool->count > 4 && rpool->dsize < 4096) {
+        rpool->dsize = 4096;
+    } else if(rpool->count > 8 && rpool->dsize < 8192) {
+        rpool->dsize = 8192;
+    }
+
+    poolsize = ALIGNSIZE(realsize, rpool->dsize);
+
+    entry = create_pool_block(rpool, poolsize TSRMLS_CC);
+
+    if(!entry) {
+        return NULL;
+    }
+
+found:
+    p = entry->mark;
+
+    if(APC_POOL_HAS_SIZEINFO(pool)) {
+        sizeinfo = (size_t*)p;
+        p += SIZEINFO_SIZE;
+        *sizeinfo = size;
+    }
+
+    redzone = p + size;
+
+    if(APC_POOL_HAS_REDZONES(pool)) {
+        MARK_REDZONE(redzone, redsize);
+    }
+
+#ifdef VALGRIND_MAKE_MEM_NOACCESS
+    if(redsize != 0) {
+        VALGRIND_MAKE_MEM_NOACCESS(redzone, redsize);
+    }
+#endif
+
+    entry->avail -= realsize;
+    entry->mark  += realsize;
+    pool->used   += realsize;
+
+#ifdef VALGRIND_MAKE_MEM_UNDEFINED
+    /* need to write before reading data off this */
+    VALGRIND_MAKE_MEM_UNDEFINED(p, size);
+#endif
+
+    return (void*)p;
+}
+/* }}} */
+
+/* {{{ apc_realpool_check_integrity */
+/*
+ * Checking integrity at runtime, does an
+ * overwrite check only when the sizeinfo
+ * is set.
+ *
+ * Marked as used in gcc, so that this function
+ * is accessible from gdb, eventhough it is never
+ * used in code in non-debug builds.
+ */
+static APC_USED int apc_realpool_check_integrity(apc_realpool *rpool) 
+{
+    apc_pool *pool = &(rpool->parent); 
+    pool_block *entry;
+    size_t *sizeinfo = NULL;
+    unsigned char *start;
+    size_t realsize;
+    unsigned char   *redzone;
+    size_t redsize;
+
+    for(entry = rpool->head; entry != NULL; entry = entry->next) {
+        start = (unsigned char *)entry + ALIGNWORD(sizeof(pool_block));
+        if((entry->mark - start) != (entry->capacity - entry->avail)) {
+            return 0;
+        }
+    }
+
+    if(!APC_POOL_HAS_REDZONES(pool) ||
+        !APC_POOL_HAS_SIZEINFO(pool)) {
+        (void)pool; /* remove unused warning */
+        return 1;
+    }
+
+    for(entry = rpool->head; entry != NULL; entry = entry->next) {
+        start = (unsigned char *)entry + ALIGNWORD(sizeof(pool_block));
+
+        while(start < entry->mark) {
+            sizeinfo = (size_t*)start;
+            /* redzone starts where real data ends, in a non-word boundary
+             * redsize is at least 4 bytes + whatever's needed to make it
+             * to another word boundary.
+             */
+            redzone = start + SIZEINFO_SIZE + (*sizeinfo);
+            redsize = REDZONE_SIZE(*sizeinfo);
+#ifdef VALGRIND_MAKE_MEM_DEFINED
+            VALGRIND_MAKE_MEM_DEFINED(redzone, redsize);
+#endif
+            if(!CHECK_REDZONE(redzone, redsize))
+            {
+                /*
+                fprintf(stderr, "Redzone check failed for %p\n", 
+                                start + ALIGNWORD(sizeof(size_t)));*/
+                return 0;
+            }
+#ifdef VALGRIND_MAKE_MEM_NOACCESS
+            VALGRIND_MAKE_MEM_NOACCESS(redzone, redsize);
+#endif
+            realsize = SIZEINFO_SIZE + *sizeinfo + redsize;
+            start += realsize;
+        }
+    }
+
+    return 1;
+}
+/* }}} */
+
+/* {{{ apc_realpool_free */
+/*
+ * free does not do anything other than
+ * check for redzone values when free'ing
+ * data areas.
+ */
+static void apc_realpool_free(apc_pool *pool, void *p TSRMLS_DC)
+{
+}
+/* }}} */
+
+/* {{{ apc_realpool_cleanup */
+static void apc_realpool_cleanup(apc_pool *pool TSRMLS_DC) 
+{
+    pool_block *entry;
+    pool_block *tmp;
+    apc_realpool *rpool = (apc_realpool*)pool;
+    apc_free_t deallocate = pool->deallocate;
+
+    assert(apc_realpool_check_integrity(rpool)!=0);
+
+    entry = rpool->head;
+
+    while(entry->next != NULL) {
+        tmp = entry->next;
+        deallocate(entry TSRMLS_CC);
+        entry = tmp;
+    }
+}
+/* }}} */
+
+/* {{{ apc_realpool_create */
+static apc_pool* apc_realpool_create(apc_pool_type type, apc_malloc_t allocate, apc_free_t deallocate, 
+                                                         apc_protect_t protect, apc_unprotect_t unprotect
+                                                         TSRMLS_DC)
+{
+
+    size_t dsize = 0;
+    apc_realpool *rpool;
+
+    switch(type & APC_POOL_SIZE_MASK) {
+        case APC_SMALL_POOL:
+            dsize = 512;
+            break;
+
+        case APC_LARGE_POOL:
+            dsize = 8192;
+            break;
+
+        case APC_MEDIUM_POOL:
+            dsize = 4096;
+            break;
+
+        default:
+            return NULL;
+    }
+
+    rpool = (apc_realpool*)allocate((sizeof(apc_realpool) + ALIGNWORD(dsize)) TSRMLS_CC);
+
+    if(!rpool) {
+        return NULL;
+    }
+
+    rpool->parent.type = type;
+
+    rpool->parent.allocate = allocate;
+    rpool->parent.deallocate = deallocate;
+
+    rpool->parent.size = sizeof(apc_realpool) + ALIGNWORD(dsize);
+
+    rpool->parent.palloc = apc_realpool_alloc;
+    rpool->parent.pfree  = apc_realpool_free;
+
+    rpool->parent.protect = protect;
+    rpool->parent.unprotect = unprotect;
+
+    rpool->parent.cleanup = apc_realpool_cleanup;
+
+    rpool->dsize = dsize;
+    rpool->head = NULL;
+    rpool->count = 0;
+
+    INIT_POOL_BLOCK(rpool, &(rpool->first), dsize);
+
+    return &(rpool->parent);
+}
+
+
+/* }}} */
+
+/* }}} */
+
+/* {{{ apc_pool_init */
+void apc_pool_init()
+{
+    /* put all ye sanity checks here */
+    assert(sizeof(decaff) > REDZONE_SIZE(ALIGNWORD(sizeof(char))));
+    assert(sizeof(pool_block) == ALIGNWORD(sizeof(pool_block)));
+#if APC_POOL_DEBUG
+    assert((APC_POOL_SIZE_MASK & (APC_POOL_SIZEINFO | APC_POOL_REDZONES)) == 0);
+#endif
+}
+/* }}} */
+
+/* {{{ apc_pstrdup */
+void* APC_ALLOC apc_pstrdup(const char* s, apc_pool* pool TSRMLS_DC)
+{
+    return s != NULL ? apc_pmemcpy(s, (strlen(s) + 1), pool TSRMLS_CC) : NULL;
+}
+/* }}} */
+
+/* {{{ apc_pmemcpy */
+void* APC_ALLOC apc_pmemcpy(const void* p, size_t n, apc_pool* pool TSRMLS_DC)
+{
+    void* q;
+
+    if (p != NULL && (q = apc_pool_alloc(pool, n)) != NULL) {
+        memcpy(q, p, n);
+        return q;
+    }
+    return NULL;
+}
+/* }}} */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_pool.h php-5.4.19.bak/ext/apc/apc_pool.h
--- php-5.4.19/ext/apc/apc_pool.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_pool.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,114 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt.                                 |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Gopal Vijayaraghavan <gopalv@yahoo-inc.com>                 |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Yahoo! Inc. in 2008.
+
+   Future revisions and derivatives of this source code must acknowledge
+   Yahoo! Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_pool.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_POOL_H
+#define APC_POOL_H
+
+#include "apc.h"
+#include "apc_sma.h"
+
+/* #define APC_POOL_DEBUG 1 */
+
+typedef enum {
+    APC_UNPOOL         = 0x0,
+    APC_SMALL_POOL     = 0x1,
+    APC_MEDIUM_POOL    = 0x2,
+    APC_LARGE_POOL     = 0x3,
+    APC_POOL_SIZE_MASK = 0x7,   /* waste a bit */
+#if APC_POOL_DEBUG
+    APC_POOL_REDZONES  = 0x08,
+    APC_POOL_SIZEINFO  = 0x10,
+    APC_POOL_OPT_MASK  = 0x18
+#endif
+} apc_pool_type;
+
+#if APC_POOL_DEBUG
+#define APC_POOL_HAS_SIZEINFO(pool) ((pool->type & APC_POOL_SIZEINFO)!=0)
+#define APC_POOL_HAS_REDZONES(pool) ((pool->type & APC_POOL_REDZONES)!=0)
+#else
+/* let gcc optimize away the optional features */
+#define APC_POOL_HAS_SIZEINFO(pool) (0)
+#define APC_POOL_HAS_REDZONES(pool) (0)
+#endif
+
+
+typedef struct _apc_pool apc_pool;
+
+typedef void  (*apc_pcleanup_t)(apc_pool *pool TSRMLS_DC);
+
+typedef void* (*apc_palloc_t)(apc_pool *pool, size_t size TSRMLS_DC);
+typedef void  (*apc_pfree_t) (apc_pool *pool, void* p TSRMLS_DC);
+
+typedef void* (*apc_protect_t)  (void *p);
+typedef void* (*apc_unprotect_t)(void *p);
+
+struct _apc_pool {
+    apc_pool_type   type;
+
+    apc_malloc_t    allocate;
+    apc_free_t      deallocate;
+
+    apc_palloc_t    palloc;
+    apc_pfree_t     pfree;
+
+	apc_protect_t   protect;
+	apc_unprotect_t unprotect;
+
+    apc_pcleanup_t  cleanup;
+
+    size_t          size;
+    size_t          used;
+
+    /* apc_realpool and apc_unpool add more here */
+};
+
+#define apc_pool_alloc(pool, size)  ((void *) pool->palloc(pool, size TSRMLS_CC))
+#define apc_pool_free(pool, ptr) 	((void)   pool->pfree (pool, ptr TSRMLS_CC))
+
+#define apc_pool_protect(pool, ptr)  (pool->protect ? \
+										(pool)->protect((ptr)) : (ptr))
+
+#define apc_pool_unprotect(pool, ptr)  (pool->unprotect ? \
+											(pool)->unprotect((ptr)) : (ptr))
+
+extern void apc_pool_init();
+
+extern apc_pool* apc_pool_create(apc_pool_type pool_type,
+                            apc_malloc_t allocate,
+                            apc_free_t deallocate,
+							apc_protect_t protect,
+							apc_unprotect_t unprotect
+							TSRMLS_DC);
+
+extern void apc_pool_destroy(apc_pool* pool TSRMLS_DC);
+
+extern void* apc_pmemcpy(const void* p, size_t n, apc_pool* pool TSRMLS_DC);
+extern void* apc_pstrdup(const char* s, apc_pool* pool TSRMLS_DC);
+
+#endif
diff -Nru php-5.4.19/ext/apc/apc_pthreadmutex.c php-5.4.19.bak/ext/apc/apc_pthreadmutex.c
--- php-5.4.19/ext/apc/apc_pthreadmutex.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_pthreadmutex.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,111 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Brian Shire <shire@php.net>                                 |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: apc_pthreadmutex.c 307048 2011-01-03 23:53:17Z kalle $ */
+
+#include "apc_pthreadmutex.h"
+
+#ifdef APC_PTHREADMUTEX_LOCKS
+
+pthread_mutex_t *apc_pthreadmutex_create(pthread_mutex_t *lock TSRMLS_DC) 
+{
+    int result;
+    pthread_mutexattr_t* attr;
+    attr = malloc(sizeof(pthread_mutexattr_t));
+
+    result = pthread_mutexattr_init(attr);
+    if(result == ENOMEM) {
+        apc_error("pthread mutex error: Insufficient memory exists to create the mutex attribute object." TSRMLS_CC);
+    } else if(result == EINVAL) {
+        apc_error("pthread mutex error: attr does not point to writeable memory." TSRMLS_CC);
+    } else if(result == EFAULT) {
+        apc_error("pthread mutex error: attr is an invalid pointer." TSRMLS_CC);
+    }
+
+#ifdef PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
+       result = pthread_mutexattr_settype(attr, PTHREAD_MUTEX_ADAPTIVE_NP);
+       if (result == EINVAL) {
+               apc_error("pthread_mutexattr_settype: unable to set adaptive mutexes" TSRMLS_CC);
+       }
+#endif
+
+    /* pthread_mutexattr_settype(attr, PTHREAD_MUTEX_ERRORCHECK); */
+    result = pthread_mutexattr_setpshared(attr, PTHREAD_PROCESS_SHARED);
+    if(result == EINVAL) {
+        apc_error("pthread mutex error: attr is not an initialized mutex attribute object, or pshared is not a valid process-shared state setting." TSRMLS_CC);
+    } else if(result == EFAULT) {
+        apc_error("pthread mutex error: attr is an invalid pointer." TSRMLS_CC);
+    } else if(result == ENOTSUP) {
+        apc_error("pthread mutex error: pshared was set to PTHREAD_PROCESS_SHARED." TSRMLS_CC);
+    }
+
+    if(pthread_mutex_init(lock, attr)) { 
+        apc_error("unable to initialize pthread lock" TSRMLS_CC);
+    }
+    return lock;
+}
+
+void apc_pthreadmutex_destroy(pthread_mutex_t *lock)
+{
+    return; /* we don't actually destroy the mutex, as it would destroy it for all processes */
+}
+
+void apc_pthreadmutex_lock(pthread_mutex_t *lock TSRMLS_DC)
+{
+    int result;
+    result = pthread_mutex_lock(lock);
+    if(result == EINVAL) {
+        apc_error("unable to obtain pthread lock (EINVAL)" TSRMLS_CC);
+    } else if(result == EDEADLK) {
+        apc_error("unable to obtain pthread lock (EDEADLK)" TSRMLS_CC);
+    }
+}
+
+void apc_pthreadmutex_unlock(pthread_mutex_t *lock TSRMLS_DC)
+{
+    if(pthread_mutex_unlock(lock)) {
+        apc_error("unable to unlock pthread lock" TSRMLS_CC);
+    }
+}
+
+zend_bool apc_pthreadmutex_nonblocking_lock(pthread_mutex_t *lock TSRMLS_DC)
+{
+    int rval;
+    rval = pthread_mutex_trylock(lock);
+    if(rval == EBUSY) {     /* Lock is already held */
+        return 0;
+    } else if(rval == 0) {  /* Obtained lock */
+        return 1;
+    } else {                /* Other error */
+        apc_error("unable to obtain pthread trylock" TSRMLS_CC);
+        return 0;
+    }
+}
+
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_pthreadmutex.h php-5.4.19.bak/ext/apc/apc_pthreadmutex.h
--- php-5.4.19/ext/apc/apc_pthreadmutex.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_pthreadmutex.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,48 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Brian Shire <shire@php.net>                                 |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: apc_pthreadmutex.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_PTHREADMUTEX_H
+#define APC_PTHREADMUTEX_H
+
+#include "apc.h"
+
+#ifdef APC_PTHREADMUTEX_LOCKS
+
+#include <pthread.h>
+
+pthread_mutex_t *apc_pthreadmutex_create(pthread_mutex_t *lock TSRMLS_DC);
+void apc_pthreadmutex_destroy(pthread_mutex_t *lock);
+void apc_pthreadmutex_lock(pthread_mutex_t *lock TSRMLS_DC);
+void apc_pthreadmutex_unlock(pthread_mutex_t *lock TSRMLS_DC);
+zend_bool apc_pthreadmutex_nonblocking_lock(pthread_mutex_t *lock TSRMLS_DC);
+
+#endif
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_pthreadrwlock.c php-5.4.19.bak/ext/apc/apc_pthreadrwlock.c
--- php-5.4.19/ext/apc/apc_pthreadrwlock.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_pthreadrwlock.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,120 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Gopal V <gopalv@php.net>                                    |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: $ */
+
+#include "apc_pthreadrwlock.h"
+
+#ifdef APC_PTHREADRW_LOCKS
+
+pthread_rwlock_t *apc_pthreadrwlock_create(pthread_rwlock_t *lock TSRMLS_DC) 
+{
+    int result;
+    pthread_rwlockattr_t attr;
+
+    result = pthread_rwlockattr_init(&attr);
+    if(result == ENOMEM) {
+        apc_error("pthread rwlock error: Insufficient memory exists to create the rwlock attribute object." TSRMLS_CC);
+    } else if(result == EINVAL) {
+        apc_error("pthread rwlock error: attr does not point to writeable memory." TSRMLS_CC);
+    } else if(result == EFAULT) {
+        apc_error("pthread rwlock error: attr is an invalid pointer." TSRMLS_CC);
+    }
+
+#ifdef	__USE_UNIX98
+	pthread_rwlockattr_setkind_np(&attr, PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP);
+#endif
+
+    result = pthread_rwlockattr_setpshared(&attr, PTHREAD_PROCESS_SHARED);
+    if(result == EINVAL) {
+        apc_error("pthread rwlock error: attr is not an initialized rwlock attribute object, or pshared is not a valid process-shared state setting." TSRMLS_CC);
+    } else if(result == EFAULT) {
+        apc_error("pthread rwlock error: attr is an invalid pointer." TSRMLS_CC);
+    } else if(result == ENOTSUP) {
+        apc_error("pthread rwlock error: pshared was set to PTHREAD_PROCESS_SHARED." TSRMLS_CC);
+    }
+
+    if(pthread_rwlock_init(lock, &attr)) { 
+        apc_error("unable to initialize pthread rwlock" TSRMLS_CC);
+    }
+
+    pthread_rwlockattr_destroy(&attr);
+
+    return lock;
+}
+
+void apc_pthreadrwlock_destroy(pthread_rwlock_t *lock)
+{
+    return; /* we don't actually destroy the rwlock, as it would destroy it for all processes */
+}
+
+void apc_pthreadrwlock_lock(pthread_rwlock_t *lock TSRMLS_DC)
+{
+    int result;
+    result = pthread_rwlock_wrlock(lock);
+    if(result == EINVAL) {
+        apc_error("unable to obtain pthread lock (EINVAL)" TSRMLS_CC);
+    } else if(result == EDEADLK) {
+        apc_error("unable to obtain pthread lock (EDEADLK)" TSRMLS_CC);
+    }
+}
+
+void apc_pthreadrwlock_rdlock(pthread_rwlock_t *lock TSRMLS_DC)
+{
+    int result;
+    result = pthread_rwlock_rdlock(lock);
+    if(result == EINVAL) {
+        apc_error("unable to obtain pthread lock (EINVAL)" TSRMLS_CC);
+    } else if(result == EDEADLK) {
+        apc_error("unable to obtain pthread lock (EDEADLK)" TSRMLS_CC);
+    }
+}
+
+void apc_pthreadrwlock_unlock(pthread_rwlock_t *lock TSRMLS_DC)
+{
+    if(pthread_rwlock_unlock(lock)) {
+        apc_error("unable to unlock pthread lock" TSRMLS_CC);
+    }
+}
+
+zend_bool apc_pthreadrwlock_nonblocking_lock(pthread_rwlock_t *lock TSRMLS_DC)
+{
+    int rval;
+    rval = pthread_rwlock_trywrlock(lock);
+    if(rval == EBUSY) {     /* Lock is already held */
+        return 0;
+    } else if(rval == 0) {  /* Obtained lock */
+        return 1;
+    } else {                /* Other error */
+        apc_error("unable to obtain pthread trylock" TSRMLS_CC);
+        return 0;
+    }
+}
+
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_pthreadrwlock.h php-5.4.19.bak/ext/apc/apc_pthreadrwlock.h
--- php-5.4.19/ext/apc/apc_pthreadrwlock.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_pthreadrwlock.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,49 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Gopal V <gopalv@php.net>                                    |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: apc_pthreadrwlock.h 302175 2010-08-13 06:20:28Z kalle $ */
+
+#ifndef APC_PTHREADRWLOCK_H
+#define APC_PTHREADRWLOCK_H
+
+#include "apc.h"
+
+#ifdef APC_PTHREADRW_LOCKS
+
+#include <pthread.h>
+
+pthread_rwlock_t *apc_pthreadrwlock_create(pthread_rwlock_t *lock TSRMLS_DC);
+void apc_pthreadrwlock_destroy(pthread_rwlock_t *lock);
+void apc_pthreadrwlock_lock(pthread_rwlock_t *lock TSRMLS_DC);
+void apc_pthreadrwlock_rdlock(pthread_rwlock_t *lock TSRMLS_DC);
+void apc_pthreadrwlock_unlock(pthread_rwlock_t *lock TSRMLS_DC);
+zend_bool apc_pthreadrwlock_nonblocking_lock(pthread_rwlock_t *lock TSRMLS_DC);
+
+#endif
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_rfc1867.c php-5.4.19.bak/ext/apc/apc_rfc1867.c
--- php-5.4.19/ext/apc/apc_rfc1867.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_rfc1867.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,236 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Rasmus Lerdorf <rasmus@php.net>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_rfc1867.c 309694 2011-03-25 18:47:38Z rasmus $*/
+
+#include "apc.h"
+#include "apc_globals.h"
+#include "rfc1867.h"
+
+#ifdef PHP_WIN32
+#include "win32/time.h"
+#endif
+
+#ifdef MULTIPART_EVENT_FORMDATA
+extern int _apc_store(char *strkey, int strkey_len, const zval *val, const uint ttl, const int exclusive TSRMLS_DC);
+extern int _apc_update(char *strkey, int strkey_len, apc_cache_updater_t updater, void* data TSRMLS_DC);
+
+static int update_bytes_processed(apc_cache_t* cache, apc_cache_entry_t* entry, void* data) {
+    int *bytes_ptr = (int*)data;
+    zval* val = entry->data.user.val;
+
+    if(Z_TYPE_P(val) == IS_ARRAY) {
+        HashTable *ht = val->value.ht;
+        Bucket* curr = NULL;
+        for (curr = ht->pListHead; curr != NULL; curr = curr->pListNext) {
+            if(curr->nKeyLength == 8 && 
+                (!memcmp(curr->arKey, "current", curr->nKeyLength))) {
+                zval* current =  ((zval**)curr->pData)[0];
+                current->value.lval = *bytes_ptr;
+                return 1;
+            }
+        }
+    }
+
+    return 0;
+}
+
+static double my_time() {
+    struct timeval a;
+    double t;
+    gettimeofday(&a, NULL);
+    t = a.tv_sec + (a.tv_usec/1000000.00);
+    return t;
+}
+
+
+#define RFC1867_DATA(name) \
+                ((request_data)->name)
+
+int apc_rfc1867_progress(uint event, void *event_data, void **extra TSRMLS_DC) {
+    apc_rfc1867_data *request_data = &APCG(rfc1867_data);
+    zval *track = NULL;
+
+    switch (event) {
+        case MULTIPART_EVENT_START:
+            {
+                multipart_event_start *data = (multipart_event_start *) event_data;
+                
+                RFC1867_DATA(content_length)    = data->content_length;
+                RFC1867_DATA(tracking_key)[0]   = '\0';
+                RFC1867_DATA(name)[0]           = '\0';
+                RFC1867_DATA(cancel_upload)     = 0;
+                RFC1867_DATA(temp_filename)     = NULL;
+                RFC1867_DATA(filename)[0]       = '\0';
+                RFC1867_DATA(key_length)        = 0;
+                RFC1867_DATA(start_time)        = my_time();
+                RFC1867_DATA(bytes_processed)   = 0;
+                RFC1867_DATA(prev_bytes_processed) = 0;
+                RFC1867_DATA(rate)              = 0;
+                RFC1867_DATA(update_freq)       = (int) APCG(rfc1867_freq);
+                RFC1867_DATA(started)           = 0;
+                
+                if(RFC1867_DATA(update_freq) < 0) {  // frequency is a percentage, not bytes
+                    RFC1867_DATA(update_freq) = (int) (RFC1867_DATA(content_length) * APCG(rfc1867_freq) / 100); 
+                }
+            }
+            break;
+
+        case MULTIPART_EVENT_FORMDATA:
+            {
+                int prefix_len = strlen(APCG(rfc1867_prefix));
+                multipart_event_formdata *data = (multipart_event_formdata *) event_data;
+                if(data->name && !strncasecmp(data->name, APCG(rfc1867_name), strlen(APCG(rfc1867_name))) 
+                    && data->value && data->length) { 
+                    
+                    if(data->length >= sizeof(RFC1867_DATA(tracking_key)) - prefix_len) {
+                        apc_warning("Key too long for '%s'. Maximum size is '%d' characters." TSRMLS_CC, 
+                                    APCG(rfc1867_name), 
+                                    sizeof(RFC1867_DATA(tracking_key)) - prefix_len);
+                        break;
+                    }
+
+                    if(RFC1867_DATA(started)) {
+                        apc_warning("Upload progress key '%s' should be before the file upload entry in the form." TSRMLS_CC, 
+                                    APCG(rfc1867_name)); 
+                        break;
+                    }
+
+                    strlcat(RFC1867_DATA(tracking_key), APCG(rfc1867_prefix), 63);
+                    strlcat(RFC1867_DATA(tracking_key), *data->value, 63);
+                    RFC1867_DATA(key_length) = data->length + prefix_len;
+                    RFC1867_DATA(bytes_processed) = data->post_bytes_processed;
+                }
+            }
+            break;
+
+        case MULTIPART_EVENT_FILE_START:
+            {
+                RFC1867_DATA(started) = 1;
+                if(*RFC1867_DATA(tracking_key)) {
+                    multipart_event_file_start *data = (multipart_event_file_start *) event_data;
+
+                    RFC1867_DATA(bytes_processed) = data->post_bytes_processed;
+                    strlcpy(RFC1867_DATA(filename),*data->filename,128);
+                    RFC1867_DATA(temp_filename) = NULL;
+                    strlcpy(RFC1867_DATA(name),data->name,64);
+                    ALLOC_INIT_ZVAL(track);
+                    array_init(track);
+                    add_assoc_long(track, "total", RFC1867_DATA(content_length));
+                    add_assoc_long(track, "current", RFC1867_DATA(bytes_processed));
+                    add_assoc_string(track, "filename", RFC1867_DATA(filename), 1);
+                    add_assoc_string(track, "name", RFC1867_DATA(name), 1);
+                    add_assoc_long(track, "done", 0);
+                    add_assoc_double(track, "start_time", RFC1867_DATA(start_time));
+                    _apc_store(RFC1867_DATA(tracking_key), RFC1867_DATA(key_length)+1, track, APCG(rfc1867_ttl), 0 TSRMLS_CC);
+                    zval_ptr_dtor(&track);
+                }
+            }
+            break;
+
+        case MULTIPART_EVENT_FILE_DATA:
+            if(*RFC1867_DATA(tracking_key)) {
+                multipart_event_file_data *data = (multipart_event_file_data *) event_data;
+                RFC1867_DATA(bytes_processed) = data->post_bytes_processed;
+                if(RFC1867_DATA(bytes_processed) - RFC1867_DATA(prev_bytes_processed) > (uint) RFC1867_DATA(update_freq)) {
+                    if(!_apc_update(RFC1867_DATA(tracking_key), RFC1867_DATA(key_length), update_bytes_processed, &RFC1867_DATA(bytes_processed) TSRMLS_CC)) {
+                        ALLOC_INIT_ZVAL(track);
+                        array_init(track);
+                        add_assoc_long(track, "total", RFC1867_DATA(content_length));
+                        add_assoc_long(track, "current", RFC1867_DATA(bytes_processed));
+                        add_assoc_string(track, "filename", RFC1867_DATA(filename), 1);
+                        add_assoc_string(track, "name", RFC1867_DATA(name), 1);
+                        add_assoc_long(track, "done", 0);
+                        add_assoc_double(track, "start_time", RFC1867_DATA(start_time));
+                        _apc_store(RFC1867_DATA(tracking_key), RFC1867_DATA(key_length)+1, track, APCG(rfc1867_ttl), 0 TSRMLS_CC);
+                        zval_ptr_dtor(&track);
+                    }
+                    RFC1867_DATA(prev_bytes_processed) = RFC1867_DATA(bytes_processed);
+                }
+            }
+            break;
+
+        case MULTIPART_EVENT_FILE_END:
+            if(*RFC1867_DATA(tracking_key)) {
+                multipart_event_file_end *data = (multipart_event_file_end *) event_data;
+                RFC1867_DATA(bytes_processed) = data->post_bytes_processed;
+                RFC1867_DATA(cancel_upload) = data->cancel_upload;
+                if(data->temp_filename) {
+                    RFC1867_DATA(temp_filename) = data->temp_filename;
+                } else {
+                    RFC1867_DATA(temp_filename) = "";
+                }
+                ALLOC_INIT_ZVAL(track);
+                array_init(track);
+                add_assoc_long(track, "total", RFC1867_DATA(content_length));
+                add_assoc_long(track, "current", RFC1867_DATA(bytes_processed));
+                add_assoc_string(track, "filename", RFC1867_DATA(filename), 1);
+                add_assoc_string(track, "name", RFC1867_DATA(name), 1);
+                add_assoc_string(track, "temp_filename", RFC1867_DATA(temp_filename), 1);
+                add_assoc_long(track, "cancel_upload", RFC1867_DATA(cancel_upload));
+                add_assoc_long(track, "done", 0);
+                add_assoc_double(track, "start_time", RFC1867_DATA(start_time));
+                _apc_store(RFC1867_DATA(tracking_key), RFC1867_DATA(key_length)+1, track, APCG(rfc1867_ttl), 0 TSRMLS_CC);
+                zval_ptr_dtor(&track);
+            }
+            break;
+
+        case MULTIPART_EVENT_END:
+            if(*RFC1867_DATA(tracking_key)) {
+                double now = my_time(); 
+                multipart_event_end *data = (multipart_event_end *) event_data;
+                RFC1867_DATA(bytes_processed) = data->post_bytes_processed;
+                if(now>RFC1867_DATA(start_time)) RFC1867_DATA(rate) = 8.0*RFC1867_DATA(bytes_processed)/(now-RFC1867_DATA(start_time));
+                else RFC1867_DATA(rate) = 8.0*RFC1867_DATA(bytes_processed);  /* Too quick */
+                ALLOC_INIT_ZVAL(track);
+                array_init(track);
+                add_assoc_long(track, "total", RFC1867_DATA(content_length));
+                add_assoc_long(track, "current", RFC1867_DATA(bytes_processed));
+                add_assoc_double(track, "rate", RFC1867_DATA(rate));
+                add_assoc_string(track, "filename", RFC1867_DATA(filename), 1);
+                add_assoc_string(track, "name", RFC1867_DATA(name), 1);
+                add_assoc_long(track, "cancel_upload", RFC1867_DATA(cancel_upload));
+                add_assoc_long(track, "done", 1);
+                add_assoc_double(track, "start_time", RFC1867_DATA(start_time));
+                _apc_store(RFC1867_DATA(tracking_key), RFC1867_DATA(key_length)+1, track, APCG(rfc1867_ttl), 0 TSRMLS_CC);
+                zval_ptr_dtor(&track);
+            }
+            break;
+    }
+
+    return SUCCESS;
+}
+
+#endif
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_sem.c php-5.4.19.bak/ext/apc/apc_sem.c
--- php-5.4.19/ext/apc/apc_sem.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_sem.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,192 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_sem.c 307048 2011-01-03 23:53:17Z kalle $ */
+
+#include "apc.h"
+
+#ifdef APC_SEM_LOCKS
+
+#include "apc_sem.h"
+#include "php.h"
+#include <sys/types.h>
+#include <sys/ipc.h>
+#include <sys/sem.h>
+#include <sys/stat.h>
+#include <unistd.h>
+
+#if HAVE_SEMUN
+/* we have semun, no need to define */
+#else
+#undef HAVE_SEMUN
+union semun {
+    int val;                  /* value for SETVAL */
+    struct semid_ds *buf;     /* buffer for IPC_STAT, IPC_SET */
+    unsigned short *array;    /* array for GETALL, SETALL */
+                              /* Linux specific part: */
+    struct seminfo *__buf;    /* buffer for IPC_INFO */
+};
+#define HAVE_SEMUN 1
+#endif
+
+#ifndef SEM_R
+# define SEM_R 0444
+#endif
+#ifndef SEM_A
+# define SEM_A 0222
+#endif
+
+/* always use SEM_UNDO, otherwise we risk deadlock */
+#define USE_SEM_UNDO
+
+#ifdef USE_SEM_UNDO
+# define UNDO SEM_UNDO
+#else
+# define UNDO 0
+#endif
+
+int apc_sem_create(int proj, int initval TSRMLS_DC)
+{
+    int semid;
+    int perms = 0777;
+    union semun arg;
+    key_t key = IPC_PRIVATE;
+
+    if ((semid = semget(key, 1, IPC_CREAT | IPC_EXCL | perms)) >= 0) {
+        /* sempahore created for the first time, initialize now */
+        arg.val = initval;
+        if (semctl(semid, 0, SETVAL, arg) < 0) {
+            apc_error("apc_sem_create: semctl(%d,...) failed:" TSRMLS_CC, semid);
+        }
+    }
+    else if (errno == EEXIST) {
+        /* sempahore already exists, don't initialize */
+        if ((semid = semget(key, 1, perms)) < 0) {
+            apc_error("apc_sem_create: semget(%u,...) failed:" TSRMLS_CC, key);
+        }
+        /* insert <sleazy way to avoid race condition> here */
+    }
+    else {
+        apc_error("apc_sem_create: semget(%u,...) failed:" TSRMLS_CC, key);
+    }
+
+    return semid;
+}
+
+void apc_sem_destroy(int semid)
+{
+    /* we expect this call to fail often, so we do not check */
+    union semun arg;
+    semctl(semid, 0, IPC_RMID, arg);
+}
+
+void apc_sem_lock(int semid TSRMLS_DC)
+{
+    struct sembuf op;
+
+    op.sem_num = 0;
+    op.sem_op  = -1;
+    op.sem_flg = UNDO;
+
+    if (semop(semid, &op, 1) < 0) {
+        if (errno != EINTR) {
+            apc_error("apc_sem_lock: semop(%d) failed:" TSRMLS_CC, semid);
+        }
+    }
+}
+
+int apc_sem_nonblocking_lock(int semid TSRMLS_DC) 
+{
+    struct sembuf op;
+
+    op.sem_num = 0;
+    op.sem_op  = -1;
+    op.sem_flg = UNDO | IPC_NOWAIT;
+
+    if (semop(semid, &op, 1) < 0) {
+      if (errno == EAGAIN) {
+        return 0;  /* Lock is already held */
+      } else if (errno != EINTR) {
+        apc_error("apc_sem_lock: semop(%d) failed:" TSRMLS_CC, semid);
+      }
+    }
+
+    return 1;  /* Lock obtained */
+}
+
+void apc_sem_unlock(int semid TSRMLS_DC)
+{
+    struct sembuf op;
+
+    op.sem_num = 0;
+    op.sem_op  = 1;
+    op.sem_flg = UNDO;
+
+    if (semop(semid, &op, 1) < 0) {
+        if (errno != EINTR) {
+            apc_error("apc_sem_unlock: semop(%d) failed:" TSRMLS_CC, semid);
+        }
+    }
+}
+
+void apc_sem_wait_for_zero(int semid TSRMLS_DC)
+{
+    struct sembuf op;
+
+    op.sem_num = 0;
+    op.sem_op  = 0;
+    op.sem_flg = UNDO;
+
+    if (semop(semid, &op, 1) < 0) {
+        if (errno != EINTR) {
+            apc_error("apc_sem_waitforzero: semop(%d) failed:" TSRMLS_CC, semid);
+        }
+    }
+}
+
+int apc_sem_get_value(int semid TSRMLS_DC)
+{
+    union semun arg;
+    unsigned short val[1];
+
+    arg.array = val;
+    if (semctl(semid, 0, GETALL, arg) < 0) {
+        apc_error("apc_sem_getvalue: semctl(%d,...) failed:" TSRMLS_CC, semid);
+    }
+    return val[0];
+}
+
+#endif /* APC_SEM_LOCKS */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_sem.h php-5.4.19.bak/ext/apc/apc_sem.h
--- php-5.4.19/ext/apc/apc_sem.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_sem.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,52 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_sem.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_SEM_H
+#define APC_SEM_H
+
+/* Wrapper functions for SysV sempahores */
+
+extern int apc_sem_create(int proj, int initval TSRMLS_DC);
+extern void apc_sem_destroy(int semid);
+extern void apc_sem_lock(int semid TSRMLS_DC);
+extern int apc_sem_nonblocking_lock(int semid TSRMLS_DC); 
+extern void apc_sem_unlock(int semid TSRMLS_DC);
+extern void apc_sem_wait_for_zero(int semid TSRMLS_DC);
+extern int apc_sem_get_value(int semid TSRMLS_DC);
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_serializer.h php-5.4.19.bak/ext/apc/apc_serializer.h
--- php-5.4.19/ext/apc/apc_serializer.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_serializer.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,84 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt.                                 |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Gopal Vijayaraghavan <gopalv@php.net>                       |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: $ */
+
+#ifndef APC_SERIALIZER_H
+#define APC_SERIALIZER_H
+
+/* this is a shipped .h file, do not include any other header in this file */
+#define APC_SERIALIZER_NAME(module) module##_apc_serializer
+#define APC_UNSERIALIZER_NAME(module) module##_apc_unserializer
+
+#define APC_SERIALIZER_ARGS unsigned char **buf, size_t *buf_len, const zval *value, void *config TSRMLS_DC
+#define APC_UNSERIALIZER_ARGS zval **value, unsigned char *buf, size_t buf_len, void *config TSRMLS_DC
+
+typedef int (*apc_serialize_t)(APC_SERIALIZER_ARGS);
+typedef int (*apc_unserialize_t)(APC_UNSERIALIZER_ARGS);
+
+typedef int (*apc_register_serializer_t)(const char* name,
+                                        apc_serialize_t serialize,
+                                        apc_unserialize_t unserialize,
+                                        void *config TSRMLS_DC);
+
+/*
+ * ABI version for constant hooks. Increment this any time you make any changes
+ * to any function in this file.
+ */
+#define APC_SERIALIZER_ABI "0"
+#define APC_SERIALIZER_CONSTANT "\000apc_register_serializer-" APC_SERIALIZER_ABI
+
+#if !defined(APC_UNUSED)
+# if defined(__GNUC__)
+#  define APC_UNUSED __attribute__((unused))
+# else
+# define APC_UNUSED
+# endif
+#endif
+
+static APC_UNUSED int apc_register_serializer(const char* name,
+                                    apc_serialize_t serialize,
+                                    apc_unserialize_t unserialize,
+                                    void *config TSRMLS_DC)
+{
+    zval apc_magic_constant;
+    int retval = 0;
+
+    /* zend_get_constant will return 1 on success, otherwise apc_magic_constant wouldn't be touched at all */
+    if (zend_get_constant(APC_SERIALIZER_CONSTANT, sizeof(APC_SERIALIZER_CONSTANT)-1, &apc_magic_constant TSRMLS_CC)) {
+        apc_register_serializer_t register_func = (apc_register_serializer_t)(Z_LVAL(apc_magic_constant));
+        if(register_func) {
+            retval = register_func(name, serialize, unserialize, NULL TSRMLS_CC);
+        }
+        zval_dtor(&apc_magic_constant);
+    }
+
+    return retval;
+}
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_shm.c php-5.4.19.bak/ext/apc/apc_shm.c
--- php-5.4.19/ext/apc/apc_shm.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_shm.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,116 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_shm.c 307259 2011-01-08 12:05:24Z gopalv $ */
+
+#include "apc_shm.h"
+#include "apc.h"
+#ifdef PHP_WIN32
+/* shm functions are available in TSRM */
+#include <tsrm/tsrm_win32.h>
+#define key_t long
+#else
+#include <sys/ipc.h>
+#include <sys/shm.h>
+#include <sys/stat.h>
+#endif
+
+#ifndef SHM_R
+# define SHM_R 0444 /* read permission */
+#endif
+#ifndef SHM_A
+# define SHM_A 0222 /* write permission */
+#endif
+
+int apc_shm_create(int proj, size_t size TSRMLS_DC)
+{
+    int shmid;			/* shared memory id */
+    int oflag;			/* permissions on shm */
+    key_t key = IPC_PRIVATE;	/* shm key */
+
+    oflag = IPC_CREAT | SHM_R | SHM_A;
+    if ((shmid = shmget(key, size, oflag)) < 0) {
+        apc_error("apc_shm_create: shmget(%d, %d, %d) failed: %s. It is possible that the chosen SHM segment size is higher than the operation system allows. Linux has usually a default limit of 32MB per segment." TSRMLS_CC, key, size, oflag, strerror(errno));
+    }
+
+    return shmid;
+}
+
+void apc_shm_destroy(int shmid)
+{
+    /* we expect this call to fail often, so we do not check */
+    shmctl(shmid, IPC_RMID, 0);
+}
+
+apc_segment_t apc_shm_attach(int shmid, size_t size TSRMLS_DC)
+{
+    apc_segment_t segment; /* shm segment */
+
+    if ((long)(segment.shmaddr = shmat(shmid, 0, 0)) == -1) {
+        apc_error("apc_shm_attach: shmat failed:" TSRMLS_CC);
+    }
+
+#ifdef APC_MEMPROTECT
+    
+    if ((long)(segment.roaddr = shmat(shmid, 0, SHM_RDONLY)) == -1) {
+        segment.roaddr = NULL;
+    }
+
+#endif
+
+    segment.size = size;
+
+    /*
+     * We set the shmid for removal immediately after attaching to it. The
+     * segment won't disappear until all processes have detached from it.
+     */
+    apc_shm_destroy(shmid);
+    return segment;
+}
+
+void apc_shm_detach(apc_segment_t* segment TSRMLS_DC)
+{
+    if (shmdt(segment->shmaddr) < 0) {
+        apc_error("apc_shm_detach: shmdt failed:" TSRMLS_CC);
+    }
+
+#ifdef APC_MEMPROTECT
+    if (segment->roaddr && shmdt(segment->roaddr) < 0) {
+        apc_error("apc_shm_detach: shmdt failed:" TSRMLS_CC);
+    }
+#endif
+}
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_shm.h php-5.4.19.bak/ext/apc/apc_shm.h
--- php-5.4.19/ext/apc/apc_shm.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_shm.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,56 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_shm.h 307259 2011-01-08 12:05:24Z gopalv $ */
+
+#ifndef APC_SHM_H
+#define APC_SHM_H
+
+#include <sys/types.h>
+#ifdef PHP_WIN32
+#include <time.h>
+#endif
+
+#include "apc_sma.h"
+
+/* Wrapper functions for unix shared memory */
+
+extern int apc_shm_create(int proj, size_t size TSRMLS_DC);
+extern void apc_shm_destroy(int shmid);
+extern apc_segment_t apc_shm_attach(int shmid, size_t size TSRMLS_DC);
+extern void apc_shm_detach(apc_segment_t* segment TSRMLS_DC);
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_signal.c php-5.4.19.bak/ext/apc/apc_signal.c
--- php-5.4.19/ext/apc/apc_signal.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_signal.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,198 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Lucas Nealan <lucas@php.net>                                |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Facebook Inc. in 2007.
+
+   Future revisions and derivatives of this source code must acknowledge
+   Facebook Inc. as the original contributor of this module by leaving
+   this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+ */
+
+ /* $Id: apc_signal.c 327066 2012-08-12 07:48:48Z laruence $ */
+
+ /* Allows apc to install signal handlers and maintain signalling
+    to already registered handlers. Registers all signals that
+    coredump by default and unmaps the shared memory segment
+    before the coredump. Note: PHP module init is called before 
+    signals are set by Apache and thus apc_set_signals should
+    be called in request init (RINIT)
+  */
+
+#include "apc.h"
+
+#if HAVE_SIGACTION
+#include <signal.h>
+#include "apc_globals.h"
+#include "apc_sma.h"
+#include "apc_signal.h"
+
+static apc_signal_info_t apc_signal_info = {0};
+
+static int apc_register_signal(int signo, void (*handler)(int, siginfo_t*, void*) TSRMLS_DC);
+static void apc_rehandle_signal(int signo, siginfo_t *siginfo, void *context);
+static void apc_core_unmap(int signo, siginfo_t *siginfo, void *context);
+
+/* {{{ apc_core_unmap 
+ *  Coredump signal handler, unmaps shm and calls previously installed handlers 
+ */
+static void apc_core_unmap(int signo, siginfo_t *siginfo, void *context) 
+{
+    TSRMLS_FETCH();
+	
+    apc_sma_cleanup(TSRMLS_C);
+    apc_rehandle_signal(signo, siginfo, context);
+
+#if !defined(WIN32) && !defined(NETWARE)
+    kill(getpid(), signo);
+#else
+    raise(signo);
+#endif
+} /* }}} */
+
+/* {{{ apc_rehandle_signal
+ *  Call the previously registered handler for a signal
+ */
+static void apc_rehandle_signal(int signo, siginfo_t *siginfo, void *context)
+{
+    int i;
+    apc_signal_entry_t p_sig = {0};
+
+    for (i=0;  (i < apc_signal_info.installed && p_sig.signo != signo);  i++) {
+        p_sig = *apc_signal_info.prev[i];
+        if (p_sig.signo == signo) {
+            if (p_sig.siginfo) {
+                (*(void (*)(int, siginfo_t*, void*))p_sig.handler)(signo, siginfo, context);
+            } else {
+                (*(void (*)(int))p_sig.handler)(signo);
+            }
+        }
+    }
+
+} /* }}} */
+
+/* {{{ apc_register_signal
+ *  Set a handler for a previously installed signal and save so we can 
+ *  callback when handled 
+ */
+static int apc_register_signal(int signo, void (*handler)(int, siginfo_t*, void*) TSRMLS_DC)
+{
+    struct sigaction sa = {{0}};
+    apc_signal_entry_t p_sig = {0};
+
+    if (sigaction(signo, NULL, &sa) == 0) {
+        if ((void*)sa.sa_handler == (void*)handler) {
+            return SUCCESS;
+        }
+
+        if (sa.sa_handler != SIG_ERR && sa.sa_handler != SIG_DFL && sa.sa_handler != SIG_IGN) {
+            p_sig.signo = signo;
+            p_sig.siginfo = ((sa.sa_flags & SA_SIGINFO) == SA_SIGINFO);
+            p_sig.handler = (void *)sa.sa_handler;
+
+            apc_signal_info.prev = (apc_signal_entry_t **)apc_erealloc(apc_signal_info.prev, (apc_signal_info.installed+1)*sizeof(apc_signal_entry_t *) TSRMLS_CC);
+            apc_signal_info.prev[apc_signal_info.installed] = (apc_signal_entry_t *)apc_emalloc(sizeof(apc_signal_entry_t) TSRMLS_CC);
+            *apc_signal_info.prev[apc_signal_info.installed++] = p_sig;
+        } else {
+            /* inherit flags and mask if already set */
+            sigemptyset(&sa.sa_mask);
+            sa.sa_flags = 0;
+            sa.sa_flags |= SA_SIGINFO; /* we'll use a siginfo handler */
+#if defined(SA_ONESHOT)
+            sa.sa_flags = SA_ONESHOT;
+#elif defined(SA_RESETHAND)
+            sa.sa_flags = SA_RESETHAND;
+#endif
+        }
+        sa.sa_handler = (void*)handler;
+
+        if (sigaction(signo, &sa, NULL) < 0) {
+            apc_warning("Error installing apc signal handler for %d" TSRMLS_CC, signo);
+        }
+
+        return SUCCESS;
+    }
+    return FAILURE;
+} /* }}} */
+
+/* {{{ apc_set_signals
+ *  Install our signal handlers */
+void apc_set_signals(TSRMLS_D) 
+{
+    if (APCG(coredump_unmap) && apc_signal_info.installed == 0) {
+        /* ISO C standard signals that coredump */
+        apc_register_signal(SIGSEGV, apc_core_unmap TSRMLS_CC);
+        apc_register_signal(SIGABRT, apc_core_unmap TSRMLS_CC);
+        apc_register_signal(SIGFPE, apc_core_unmap TSRMLS_CC);
+        apc_register_signal(SIGILL, apc_core_unmap TSRMLS_CC);
+        /* extended signals that coredump */
+#ifdef SIGBUS
+        apc_register_signal(SIGBUS, apc_core_unmap TSRMLS_CC);
+#endif
+#ifdef SIGABORT
+        apc_register_signal(SIGABORT, apc_core_unmap TSRMLS_CC);
+#endif
+#ifdef SIGEMT
+        apc_register_signal(SIGEMT, apc_core_unmap TSRMLS_CC);
+#endif
+#ifdef SIGIOT
+        apc_register_signal(SIGIOT, apc_core_unmap TSRMLS_CC);
+#endif
+#ifdef SIGQUIT
+        apc_register_signal(SIGQUIT, apc_core_unmap TSRMLS_CC);
+#endif
+#ifdef SIGSYS
+        apc_register_signal(SIGSYS, apc_core_unmap TSRMLS_CC);
+#endif
+#ifdef SIGTRAP
+        apc_register_signal(SIGTRAP, apc_core_unmap TSRMLS_CC);
+#endif
+#ifdef SIGXCPU
+        apc_register_signal(SIGXCPU, apc_core_unmap TSRMLS_CC);
+#endif
+#ifdef SIGXFSZ
+        apc_register_signal(SIGXFSZ, apc_core_unmap TSRMLS_CC);
+#endif
+    }
+} /* }}} */
+
+/* {{{ apc_set_signals
+ *  cleanup signals for shutdown */
+void apc_shutdown_signals(TSRMLS_D) 
+{
+    int i=0;
+    if (apc_signal_info.installed > 0) {
+        for (i=0;  (i < apc_signal_info.installed);  i++) {
+            apc_efree(apc_signal_info.prev[i] TSRMLS_CC);
+        }
+        apc_efree(apc_signal_info.prev TSRMLS_CC);
+        apc_signal_info.installed = 0; /* just in case */
+    }
+}
+/* }}} */
+
+#endif  /* HAVE_SIGACTION */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_signal.h php-5.4.19.bak/ext/apc/apc_signal.h
--- php-5.4.19/ext/apc/apc_signal.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_signal.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,51 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Lucas Nealan <lucas@php.net>                                |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: apc_signal.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_SIGNAL_H
+#define APC_SIGNAL_H
+
+#include "apc.h"
+#include "apc_php.h"
+
+typedef struct apc_signal_entry_t {
+    int signo;          /* signal number */
+    int siginfo;        /* siginfo style handler calling */
+    void* handler;      /* signal handler */
+} apc_signal_entry_t;
+
+typedef struct apc_signal_info_t {
+    int installed;                  /* How many signals we've installed handles for */
+    apc_signal_entry_t **prev;      /* Previous signal handlers */
+} apc_signal_info_t;
+
+void apc_set_signals(TSRMLS_D);
+void apc_shutdown_signals(TSRMLS_D);
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_sma.c php-5.4.19.bak/ext/apc/apc_sma.c
--- php-5.4.19/ext/apc/apc_sma.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_sma.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,766 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_sma.c 327066 2012-08-12 07:48:48Z laruence $ */
+
+#include "apc_sma.h"
+#include "apc.h"
+#include "apc_globals.h"
+#include "apc_lock.h"
+#include "apc_shm.h"
+#include "apc_cache.h"
+
+#include <limits.h>
+#include "apc_mmap.h"
+
+#ifdef HAVE_VALGRIND_MEMCHECK_H
+#include <valgrind/memcheck.h>
+#endif
+
+enum { DEFAULT_NUMSEG=1, DEFAULT_SEGSIZE=30*1024*1024 };
+
+static int sma_initialized = 0;     /* true if the sma has been initialized */
+static uint sma_numseg;     /* number of shm segments to allow */
+static size_t sma_segsize;          /* size of each shm segment */
+static apc_segment_t* sma_segments; /* array of shm segments */
+static int sma_lastseg = 0;         /* index of MRU segment */
+
+typedef struct sma_header_t sma_header_t;
+struct sma_header_t {
+    apc_lck_t sma_lock;     /* segment lock, MUST BE ALIGNED for futex locks */
+    size_t segsize;         /* size of entire segment */
+    size_t avail;           /* bytes available (not necessarily contiguous) */
+#if ALLOC_DISTRIBUTION
+    size_t adist[30];
+#endif
+};
+
+#define SMA_HDR(i)  ((sma_header_t*)((sma_segments[i]).shmaddr))
+#define SMA_ADDR(i) ((char*)(SMA_HDR(i)))
+#define SMA_RO(i)   ((char*)(sma_segments[i]).roaddr)
+#define SMA_LCK(i)  ((SMA_HDR(i))->sma_lock)
+
+
+/* do not enable for threaded http servers */
+/* #define __APC_SMA_DEBUG__ 1 */
+
+#ifdef __APC_SMA_DEBUG__
+/* global counter for identifying blocks
+ * Technically it is possible to do the same
+ * using offsets, but double allocations of the
+ * same offset can happen. */
+static volatile size_t block_id = 0;
+#endif
+
+#define APC_SMA_CANARIES 1
+
+typedef struct block_t block_t;
+struct block_t {
+    size_t size;       /* size of this block */
+    size_t prev_size;  /* size of sequentially previous block, 0 if prev is allocated */
+    size_t fnext;      /* offset in segment of next free block */
+    size_t fprev;      /* offset in segment of prev free block */
+#ifdef APC_SMA_CANARIES
+    size_t canary;     /* canary to check for memory overwrites */
+#endif
+#ifdef __APC_SMA_DEBUG__
+    size_t id;         /* identifier for the memory block */
+#endif
+};
+
+/* The macros BLOCKAT and OFFSET are used for convenience throughout this
+ * module. Both assume the presence of a variable shmaddr that points to the
+ * beginning of the shared memory segment in question. */
+
+#define BLOCKAT(offset) ((block_t*)((char *)shmaddr + offset))
+#define OFFSET(block) ((size_t)(((char*)block) - (char*)shmaddr))
+
+/* macros for getting the next or previous sequential block */
+#define NEXT_SBLOCK(block) ((block_t*)((char*)block + block->size))
+#define PREV_SBLOCK(block) (block->prev_size ? ((block_t*)((char*)block - block->prev_size)) : NULL)
+
+/* Canary macros for setting, checking and resetting memory canaries */
+#ifdef APC_SMA_CANARIES
+    #define SET_CANARY(v) (v)->canary = 0x42424242
+    #define CHECK_CANARY(v) assert((v)->canary == 0x42424242)
+    #define RESET_CANARY(v) (v)->canary = -42
+#else
+    #define SET_CANARY(v) 
+    #define CHECK_CANARY(v)
+    #define RESET_CANARY(v)
+#endif
+
+/* {{{ MINBLOCKSIZE */
+#define MINBLOCKSIZE (ALIGNWORD(1) + ALIGNWORD(sizeof(block_t)))
+/* }}} */
+
+#if 0
+/* {{{ sma_debug_state(apc_sma_segment_t *segment, int canary_check, int verbose)
+ *        useful for debuging state of memory blocks and free list, and sanity checking
+ */
+static void sma_debug_state(void* shmaddr, int canary_check, int verbose TSRMLS_DC) {
+    sma_header_t *header = (sma_header_t*)shmaddr;
+    block_t *cur = BLOCKAT(ALIGNWORD(sizeof(sma_header_t)));
+    block_t *prv = NULL;
+    size_t avail;
+
+    /* Verify free list */
+    if (verbose) apc_warning("Free List: " TSRMLS_CC);
+    while(1) {
+        if (verbose) apc_warning(" 0x%x[%d] (s%d)" TSRMLS_CC, cur, OFFSET(cur), cur->size);
+        if (canary_check) CHECK_CANARY(cur);
+        if (!cur->fnext) break;
+        cur = BLOCKAT(cur->fnext);
+        avail += cur->size;
+        if (prv == cur) {
+            apc_warning("Circular list detected!" TSRMLS_CC);
+            assert(0);
+        }
+        if (prv && cur->fprev != OFFSET(prv)) {
+            apc_warning("Previous pointer does not point to previous!" TSRMLS_CC);
+            assert(0);
+        }
+        prv = cur;
+    }
+    assert(avail == header->avail);
+
+    /* Verify each block */
+    if (verbose) apc_warning("Block List: " TSRMLS_CC);
+    cur = BLOCKAT(ALIGNWORD(sizeof(sma_header_t)));
+    while(1) {
+        if(!cur->fnext) {
+            if (verbose) apc_warning(" 0x%x[%d] (s%d) (u)" TSRMLS_CC, cur, OFFSET(cur), cur->size);
+        } else {
+            if (verbose) apc_warning(" 0x%x[%d] (s%d) (f)" TSRMLS_CC, cur, OFFSET(cur), cur->size);
+        }
+        if (canary_check) CHECK_CANARY(cur);
+        if (!cur->size && !cur->fnext) break;
+        if (!cur->size) {
+            cur = BLOCKAT(OFFSET(cur) + ALIGNWORD(sizeof(block_t)));
+        } else {
+            cur = NEXT_SBLOCK(cur);
+        }
+        if (prv == cur) {
+            apc_warning("Circular list detected!" TSRMLS_CC);
+            assert(0);
+        }
+        prv = cur;
+    }
+}
+/* }}} */
+#endif
+
+/* {{{ sma_allocate: tries to allocate at least size bytes in a segment */
+static APC_HOTSPOT size_t sma_allocate(sma_header_t* header, size_t size, size_t fragment, size_t *allocated)
+{
+    void* shmaddr;          /* header of shared memory segment */
+    block_t* prv;           /* block prior to working block */
+    block_t* cur;           /* working block in list */
+    block_t* prvnextfit;    /* block before next fit */
+    size_t realsize;        /* actual size of block needed, including header */
+    const size_t block_size = ALIGNWORD(sizeof(struct block_t));
+
+    realsize = ALIGNWORD(size + block_size);
+
+    /*
+     * First, insure that the segment contains at least realsize free bytes,
+     * even if they are not contiguous.
+     */
+    shmaddr = header;
+
+    if (header->avail < realsize) {
+        return -1;
+    }
+
+    prvnextfit = 0;     /* initially null (no fit) */
+    prv = BLOCKAT(ALIGNWORD(sizeof(sma_header_t)));
+    CHECK_CANARY(prv);
+
+    while (prv->fnext != 0) {
+        cur = BLOCKAT(prv->fnext);
+#ifdef __APC_SMA_DEBUG__
+        CHECK_CANARY(cur);
+#endif
+        /* If it can fit realsize bytes in cur block, stop searching */
+        if (cur->size >= realsize) {
+            prvnextfit = prv;
+            break;
+        }
+        prv = cur;
+    }
+
+    if (prvnextfit == 0) {
+        return -1;
+    }
+
+    prv = prvnextfit;
+    cur = BLOCKAT(prv->fnext);
+
+    CHECK_CANARY(prv);
+    CHECK_CANARY(cur);
+
+    if (cur->size == realsize || (cur->size > realsize && cur->size < (realsize + (MINBLOCKSIZE + fragment)))) {
+        /* cur is big enough for realsize, but too small to split - unlink it */
+        *(allocated) = cur->size - block_size;
+        prv->fnext = cur->fnext;
+        BLOCKAT(cur->fnext)->fprev = OFFSET(prv);
+        NEXT_SBLOCK(cur)->prev_size = 0;  /* block is alloc'd */
+    } else {
+        /* nextfit is too big; split it into two smaller blocks */
+        block_t* nxt;      /* the new block (chopped part of cur) */
+        size_t oldsize;    /* size of cur before split */
+
+        oldsize = cur->size;
+        cur->size = realsize;
+        *(allocated) = cur->size - block_size;
+        nxt = NEXT_SBLOCK(cur);
+        nxt->prev_size = 0;                       /* block is alloc'd */
+        nxt->size = oldsize - realsize;           /* and fix the size */
+        NEXT_SBLOCK(nxt)->prev_size = nxt->size;  /* adjust size */
+        SET_CANARY(nxt);
+
+        /* replace cur with next in free list */
+        nxt->fnext = cur->fnext;
+        nxt->fprev = cur->fprev;
+        BLOCKAT(nxt->fnext)->fprev = OFFSET(nxt);
+        BLOCKAT(nxt->fprev)->fnext = OFFSET(nxt);
+#ifdef __APC_SMA_DEBUG__
+        nxt->id = -1;
+#endif
+    }
+
+    cur->fnext = 0;
+
+    /* update the block header */
+    header->avail -= cur->size;
+#if ALLOC_DISTRIBUTION
+    header->adist[(int)(log(size)/log(2))]++;
+#endif
+
+    SET_CANARY(cur);
+#ifdef __APC_SMA_DEBUG__
+    cur->id = ++block_id;
+    fprintf(stderr, "allocate(realsize=%d,size=%d,id=%d)\n", (int)(size), (int)(cur->size), cur->id);
+#endif
+
+    return OFFSET(cur) + block_size;
+}
+/* }}} */
+
+/* {{{ sma_deallocate: deallocates the block at the given offset */
+static APC_HOTSPOT size_t sma_deallocate(void* shmaddr, size_t offset)
+{
+    sma_header_t* header;   /* header of shared memory segment */
+    block_t* cur;       /* the new block to insert */
+    block_t* prv;       /* the block before cur */
+    block_t* nxt;       /* the block after cur */
+    size_t size;        /* size of deallocated block */
+
+    offset -= ALIGNWORD(sizeof(struct block_t));
+    assert(offset >= 0);
+
+    /* find position of new block in free list */
+    cur = BLOCKAT(offset);
+
+    /* update the block header */
+    header = (sma_header_t*) shmaddr;
+    header->avail += cur->size;
+    size = cur->size;
+
+    if (cur->prev_size != 0) {
+        /* remove prv from list */
+        prv = PREV_SBLOCK(cur);
+        BLOCKAT(prv->fnext)->fprev = prv->fprev;
+        BLOCKAT(prv->fprev)->fnext = prv->fnext;
+        /* cur and prv share an edge, combine them */
+        prv->size +=cur->size;
+        RESET_CANARY(cur);
+        cur = prv;
+    }
+
+    nxt = NEXT_SBLOCK(cur);
+    if (nxt->fnext != 0) {
+        assert(NEXT_SBLOCK(NEXT_SBLOCK(cur))->prev_size == nxt->size);
+        /* cur and nxt shared an edge, combine them */
+        BLOCKAT(nxt->fnext)->fprev = nxt->fprev;
+        BLOCKAT(nxt->fprev)->fnext = nxt->fnext;
+        cur->size += nxt->size;
+#ifdef __APC_SMA_DEBUG__
+        CHECK_CANARY(nxt);
+        nxt->id = -1; /* assert this or set it ? */
+#endif
+        RESET_CANARY(nxt);
+    }
+
+    NEXT_SBLOCK(cur)->prev_size = cur->size;
+
+    /* insert new block after prv */
+    prv = BLOCKAT(ALIGNWORD(sizeof(sma_header_t)));
+    cur->fnext = prv->fnext;
+    prv->fnext = OFFSET(cur);
+    cur->fprev = OFFSET(prv);
+    BLOCKAT(cur->fnext)->fprev = OFFSET(cur);
+
+    return size;
+}
+/* }}} */
+
+/* {{{ apc_sma_init */
+
+void apc_sma_init(int numseg, size_t segsize, char *mmap_file_mask TSRMLS_DC)
+{
+    uint i;
+
+    if (sma_initialized) {
+        return;
+    }
+    sma_initialized = 1;
+
+#if APC_MMAP
+    /*
+     * I don't think multiple anonymous mmaps makes any sense
+     * so force sma_numseg to 1 in this case
+     */
+    if(!mmap_file_mask || 
+       (mmap_file_mask && !strlen(mmap_file_mask)) ||
+       (mmap_file_mask && !strcmp(mmap_file_mask, "/dev/zero"))) {
+        sma_numseg = 1;
+    } else {
+        sma_numseg = numseg > 0 ? numseg : DEFAULT_NUMSEG;
+    }
+#else
+    sma_numseg = numseg > 0 ? numseg : DEFAULT_NUMSEG;
+#endif
+
+    sma_segsize = segsize > 0 ? segsize : DEFAULT_SEGSIZE;
+
+    sma_segments = (apc_segment_t*) apc_emalloc((sma_numseg * sizeof(apc_segment_t)) TSRMLS_CC);
+
+    for (i = 0; i < sma_numseg; i++) {
+        sma_header_t*   header;
+        block_t     *first, *empty, *last;
+        void*       shmaddr;
+
+#if APC_MMAP
+        sma_segments[i] = apc_mmap(mmap_file_mask, sma_segsize TSRMLS_CC);
+        if(sma_numseg != 1) memcpy(&mmap_file_mask[strlen(mmap_file_mask)-6], "XXXXXX", 6);
+#else
+        sma_segments[i] = apc_shm_attach(apc_shm_create(i, sma_segsize TSRMLS_CC), sma_segsize TSRMLS_CC);
+#endif
+        
+        sma_segments[i].size = sma_segsize;
+
+        shmaddr = sma_segments[i].shmaddr;
+
+        header = (sma_header_t*) shmaddr;
+        apc_lck_create(NULL, 0, 1, header->sma_lock);
+        header->segsize = sma_segsize;
+        header->avail = sma_segsize - ALIGNWORD(sizeof(sma_header_t)) - ALIGNWORD(sizeof(block_t)) - ALIGNWORD(sizeof(block_t));
+#if ALLOC_DISTRIBUTION
+        {
+           int j;
+           for(j=0; j<30; j++) header->adist[j] = 0;
+        }
+#endif
+        first = BLOCKAT(ALIGNWORD(sizeof(sma_header_t)));
+        first->size = 0;
+        first->fnext = ALIGNWORD(sizeof(sma_header_t)) + ALIGNWORD(sizeof(block_t));
+        first->fprev = 0;
+        first->prev_size = 0;
+        SET_CANARY(first);
+#ifdef __APC_SMA_DEBUG__
+        block->id = -1;
+#endif
+        empty = BLOCKAT(first->fnext);
+        empty->size = header->avail - ALIGNWORD(sizeof(block_t));
+        empty->fnext = OFFSET(empty) + empty->size;
+        empty->fprev = ALIGNWORD(sizeof(sma_header_t));
+        empty->prev_size = 0;
+        SET_CANARY(empty);
+#ifdef __APC_SMA_DEBUG__
+        empty->id = -1;
+#endif
+        last = BLOCKAT(empty->fnext);
+        last->size = 0;
+        last->fnext = 0;
+        last->fprev =  OFFSET(empty);
+        last->prev_size = empty->size;
+        SET_CANARY(last);
+#ifdef __APC_SMA_DEBUG__
+        last->id = -1;
+#endif
+    }
+}
+/* }}} */
+
+/* {{{ apc_sma_cleanup */
+void apc_sma_cleanup(TSRMLS_D)
+{
+    uint i;
+
+    assert(sma_initialized);
+
+    for (i = 0; i < sma_numseg; i++) {
+        apc_lck_destroy(SMA_LCK(i));
+#if APC_MMAP
+        apc_unmap(&sma_segments[i] TSRMLS_CC);
+#else
+        apc_shm_detach(&sma_segments[i] TSRMLS_CC);
+#endif
+    }
+    sma_initialized = 0;
+    apc_efree(sma_segments TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ apc_sma_malloc_ex */
+void* apc_sma_malloc_ex(size_t n, size_t fragment, size_t* allocated TSRMLS_DC)
+{
+    size_t off;
+    uint i;
+    int nuked = 0;
+
+restart:
+    assert(sma_initialized);
+    LOCK(SMA_LCK(sma_lastseg));
+
+    off = sma_allocate(SMA_HDR(sma_lastseg), n, fragment, allocated);
+
+    if(off == -1 && APCG(current_cache)) { 
+        /* retry failed allocation after we expunge */
+        UNLOCK(SMA_LCK(sma_lastseg));
+        APCG(current_cache)->expunge_cb(APCG(current_cache), (n+fragment) TSRMLS_CC);
+        LOCK(SMA_LCK(sma_lastseg));
+        off = sma_allocate(SMA_HDR(sma_lastseg), n, fragment, allocated);
+    }
+
+    if (off != -1) {
+        void* p = (void *)(SMA_ADDR(sma_lastseg) + off);
+        UNLOCK(SMA_LCK(sma_lastseg));
+#ifdef VALGRIND_MALLOCLIKE_BLOCK
+        VALGRIND_MALLOCLIKE_BLOCK(p, n, 0, 0);
+#endif
+        return p;
+    }
+    
+    UNLOCK(SMA_LCK(sma_lastseg));
+
+    for (i = 0; i < sma_numseg; i++) {
+        if (i == sma_lastseg) {
+            continue;
+        }
+        LOCK(SMA_LCK(i));
+        off = sma_allocate(SMA_HDR(i), n, fragment, allocated);
+        if(off == -1 && APCG(current_cache)) { 
+            /* retry failed allocation after we expunge */
+            UNLOCK(SMA_LCK(i));
+            APCG(current_cache)->expunge_cb(APCG(current_cache), (n+fragment) TSRMLS_CC);
+            LOCK(SMA_LCK(i));
+            off = sma_allocate(SMA_HDR(i), n, fragment, allocated);
+        }
+        if (off != -1) {
+            void* p = (void *)(SMA_ADDR(i) + off);
+            UNLOCK(SMA_LCK(i));
+            sma_lastseg = i;
+#ifdef VALGRIND_MALLOCLIKE_BLOCK
+            VALGRIND_MALLOCLIKE_BLOCK(p, n, 0, 0);
+#endif
+            return p;
+        }
+        UNLOCK(SMA_LCK(i));
+    }
+
+    /* I've tried being nice, but now you're just asking for it */
+    if(!nuked) {
+        apc_cache->expunge_cb(apc_cache, (n+fragment) TSRMLS_CC);
+        apc_user_cache->expunge_cb(apc_user_cache, (n+fragment) TSRMLS_CC);
+        nuked = 1;
+        goto restart;
+    }
+
+    /* now, I've truly and well given up */
+
+    return NULL;
+}
+/* }}} */
+
+/* {{{ apc_sma_malloc */
+void* apc_sma_malloc(size_t n TSRMLS_DC)
+{
+    size_t allocated;
+    void *p = apc_sma_malloc_ex(n, MINBLOCKSIZE, &allocated TSRMLS_CC);
+
+    return p;
+}
+/* }}} */
+
+/* {{{ apc_sma_realloc */
+void* apc_sma_realloc(void *p, size_t n TSRMLS_DC)
+{
+    apc_sma_free(p TSRMLS_CC);
+    return apc_sma_malloc(n TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ apc_sma_strdup */
+char* apc_sma_strdup(const char* s TSRMLS_DC)
+{
+    void* q;
+    int len;
+
+    if(!s) return NULL;
+
+    len = strlen(s)+1;
+    q = apc_sma_malloc(len TSRMLS_CC);
+    if(!q) return NULL;
+    memcpy(q, s, len);
+    return q;
+}
+/* }}} */
+
+/* {{{ apc_sma_free */
+void apc_sma_free(void* p TSRMLS_DC)
+{
+    uint i;
+    size_t offset;
+    size_t d_size;
+
+    if (p == NULL) {
+        return;
+    }
+
+    assert(sma_initialized);
+
+    
+    for (i = 0; i < sma_numseg; i++) {
+        offset = (size_t)((char *)p - SMA_ADDR(i));
+        if (p >= (void*)SMA_ADDR(i) && offset < sma_segsize) {
+            LOCK(SMA_LCK(i));
+            d_size = sma_deallocate(SMA_HDR(i), offset);
+            UNLOCK(SMA_LCK(i));
+#ifdef VALGRIND_FREELIKE_BLOCK
+            VALGRIND_FREELIKE_BLOCK(p, 0);
+#endif
+            return;
+        }
+    }
+
+    apc_error("apc_sma_free: could not locate address %p" TSRMLS_CC, p);
+}
+/* }}} */
+
+#ifdef APC_MEMPROTECT
+/* {{{ apc_sma_protect */
+void* apc_sma_protect(void *p)
+{
+    unsigned int i = 0;
+    size_t offset;
+
+    if (p == NULL) {
+        return NULL;
+    }
+
+    if(SMA_RO(sma_lastseg) == NULL) return p;
+
+    offset = (size_t)((char *)p - SMA_ADDR(sma_lastseg));
+
+    if(p >= (void*)SMA_ADDR(sma_lastseg) && offset < sma_segsize) {
+        return SMA_RO(sma_lastseg) + offset;
+    }
+
+    for (i = 0; i < sma_numseg; i++) {
+        offset = (size_t)((char *)p - SMA_ADDR(i));
+        if (p >= (void*)SMA_ADDR(i) && offset < sma_segsize) {
+            return SMA_RO(i) + offset;
+        }
+    }
+
+    return NULL;
+}
+/* }}} */
+
+/* {{{ apc_sma_unprotect */
+void* apc_sma_unprotect(void *p)
+{
+    unsigned int i = 0;
+    size_t offset;
+
+    if (p == NULL) {
+        return NULL;
+    }
+
+    if(SMA_RO(sma_lastseg) == NULL) return p;
+
+    offset = (size_t)((char *)p - SMA_RO(sma_lastseg));
+
+    if(p >= (void*)SMA_RO(sma_lastseg) && offset < sma_segsize) {
+        return SMA_ADDR(sma_lastseg) + offset;
+    }
+
+    for (i = 0; i < sma_numseg; i++) {
+        offset = (size_t)((char *)p - SMA_RO(i));
+        if (p >= (void*)SMA_RO(i) && offset < sma_segsize) {
+            return SMA_ADDR(i) + offset;
+        }
+    }
+
+    return NULL;
+}
+/* }}} */
+#else
+/* {{{ apc_sma_protect */
+void* apc_sma_protect(void *p) { return p; }
+/* }}} */
+
+/* {{{ apc_sma_unprotect */
+void* apc_sma_unprotect(void *p) { return p; }
+/* }}} */
+#endif
+
+/* {{{ apc_sma_info */
+apc_sma_info_t* apc_sma_info(zend_bool limited TSRMLS_DC)
+{
+    apc_sma_info_t* info;
+    apc_sma_link_t** link;
+    uint i;
+    char* shmaddr;
+    block_t* prv;
+
+    if (!sma_initialized) {
+        return NULL;
+    }
+
+    info = (apc_sma_info_t*) apc_emalloc(sizeof(apc_sma_info_t) TSRMLS_CC);
+    info->num_seg = sma_numseg;
+    info->seg_size = sma_segsize - (ALIGNWORD(sizeof(sma_header_t)) + ALIGNWORD(sizeof(block_t)) + ALIGNWORD(sizeof(block_t)));
+
+    info->list = apc_emalloc(info->num_seg * sizeof(apc_sma_link_t*) TSRMLS_CC);
+    for (i = 0; i < sma_numseg; i++) {
+        info->list[i] = NULL;
+    }
+
+    if(limited) return info;
+
+    /* For each segment */
+    for (i = 0; i < sma_numseg; i++) {
+        RDLOCK(SMA_LCK(i));
+        shmaddr = SMA_ADDR(i);
+        prv = BLOCKAT(ALIGNWORD(sizeof(sma_header_t)));
+
+        link = &info->list[i];
+
+        /* For each block in this segment */
+        while (BLOCKAT(prv->fnext)->fnext != 0) {
+            block_t* cur = BLOCKAT(prv->fnext);
+#ifdef __APC_SMA_DEBUG__
+            CHECK_CANARY(cur);
+#endif
+
+            *link = apc_emalloc(sizeof(apc_sma_link_t) TSRMLS_CC);
+            (*link)->size = cur->size;
+            (*link)->offset = prv->fnext;
+            (*link)->next = NULL;
+            link = &(*link)->next;
+
+            prv = cur;
+
+#if ALLOC_DISTRIBUTION
+            sma_header_t* header = (sma_header_t*) segment->shmaddr;
+            memcpy(info->seginfo[i].adist, header->adist, sizeof(size_t) * 30);
+#endif
+
+        }
+        RDUNLOCK(SMA_LCK(i));
+    }
+
+    return info;
+}
+/* }}} */
+
+/* {{{ apc_sma_free_info */
+void apc_sma_free_info(apc_sma_info_t* info TSRMLS_DC)
+{
+    int i;
+
+    for (i = 0; i < info->num_seg; i++) {
+        apc_sma_link_t* p = info->list[i];
+        while (p) {
+            apc_sma_link_t* q = p;
+            p = p->next;
+            apc_efree(q TSRMLS_CC);
+        }
+    }
+    apc_efree(info->list TSRMLS_CC);
+    apc_efree(info TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ apc_sma_get_avail_mem */
+size_t apc_sma_get_avail_mem()
+{
+    size_t avail_mem = 0;
+    uint i;
+
+    for (i = 0; i < sma_numseg; i++) {
+        sma_header_t* header = SMA_HDR(i);
+        avail_mem += header->avail;
+    }
+    return avail_mem;
+}
+/* }}} */
+
+/* {{{ apc_sma_get_avail_size */
+zend_bool apc_sma_get_avail_size(size_t size)
+{
+    uint i;
+
+    for (i = 0; i < sma_numseg; i++) {
+    	sma_header_t* header = SMA_HDR(i);
+		if (header->avail > size) {
+			return 1;
+		}
+    }
+    return 0;
+}
+/* }}} */
+
+#if ALLOC_DISTRIBUTION
+size_t *apc_sma_get_alloc_distribution(void) {
+    sma_header_t* header = (sma_header_t*) segment->sma_shmaddr;
+    return header->adist;
+}
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_sma.h php-5.4.19.bak/ext/apc/apc_sma.h
--- php-5.4.19/ext/apc/apc_sma.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_sma.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,103 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_sma.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_SMA_H
+#define APC_SMA_H
+
+#define ALLOC_DISTRIBUTION 0
+
+#include "apc.h"
+
+/* Simple shared memory allocator */
+
+typedef struct _apc_segment_t apc_segment_t;
+
+struct _apc_segment_t {
+    size_t size;
+    void* shmaddr;
+#ifdef APC_MEMPROTECT
+    void* roaddr;
+#endif
+};
+
+extern void apc_sma_init(int numseg, size_t segsize, char *mmap_file_mask TSRMLS_DC);
+extern void apc_sma_cleanup(TSRMLS_D);
+extern void* apc_sma_malloc(size_t size TSRMLS_DC);
+extern void* apc_sma_malloc_ex(size_t size, size_t fragment, size_t* allocated TSRMLS_DC);
+extern void* apc_sma_realloc(void* p, size_t size TSRMLS_DC);
+extern char* apc_sma_strdup(const char *s TSRMLS_DC);
+extern void apc_sma_free(void* p TSRMLS_DC);
+#if ALLOC_DISTRIBUTION 
+extern size_t *apc_sma_get_alloc_distribution();
+#endif
+
+extern void* apc_sma_protect(void *p);
+extern void* apc_sma_unprotect(void *p);
+
+/* {{{ struct definition: apc_sma_link_t */
+typedef struct apc_sma_link_t apc_sma_link_t;
+struct apc_sma_link_t {
+    long size;               /* size of this free block */
+    long offset;             /* offset in segment of this block */
+    apc_sma_link_t* next;   /* link to next free block */
+};
+/* }}} */
+
+/* {{{ struct definition: apc_sma_info_t */
+typedef struct apc_sma_info_t apc_sma_info_t;
+struct apc_sma_info_t {
+    int num_seg;            /* number of shared memory segments */
+    size_t seg_size;           /* size of each shared memory segment */
+    apc_sma_link_t** list;  /* there is one list per segment */
+};
+/* }}} */
+
+extern apc_sma_info_t* apc_sma_info(zend_bool limited TSRMLS_DC);
+extern void apc_sma_free_info(apc_sma_info_t* info TSRMLS_DC);
+
+extern size_t apc_sma_get_avail_mem();
+extern zend_bool apc_sma_get_avail_size(size_t size);
+extern void apc_sma_check_integrity();
+
+/* {{{ ALIGNWORD: pad up x, aligned to the system's word boundary */
+typedef union { void* p; int i; long l; double d; void (*f)(); } apc_word_t;
+#define ALIGNSIZE(x, size) ((size) * (1 + (((x)-1)/(size))))
+#define ALIGNWORD(x) ALIGNSIZE(x, sizeof(apc_word_t))
+/* }}} */
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_spin.c php-5.4.19.bak/ext/apc/apc_spin.c
--- php-5.4.19/ext/apc/apc_spin.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_spin.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,66 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Brian Shire <shire@php.net>                                 |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: apc_spin.c 307048 2011-01-03 23:53:17Z kalle $ */
+
+#include "apc_spin.h"
+
+#ifdef APC_SPIN_LOCKS
+
+slock_t *apc_slock_create(slock_t *lock)
+{
+   S_INIT_LOCK(lock);
+   return lock;
+}
+
+void apc_slock_destroy(slock_t *lock)
+{
+    return;
+}
+
+void apc_slock_lock(slock_t *lock TSRMLS_DC)
+{
+    S_LOCK(lock);
+}
+
+void apc_slock_unlock(slock_t *lock)
+{
+    S_UNLOCK(lock);
+}
+
+zend_bool apc_slock_nonblocking_lock(slock_t *lock)
+{
+    /* Technically we aren't supposed to call this directly, but the original
+     *  code provides no method for absolute non-blocking locks, so we'll call into
+     *  the TAS (test and set) functionality directly 
+     */
+    return !(TAS(lock));  /* if TAS returns 0 we obtained the lock, otherwise we failed */
+}
+
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_spin.h php-5.4.19.bak/ext/apc/apc_spin.h
--- php-5.4.19/ext/apc/apc_spin.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_spin.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,48 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Brian Shire <shire@php.net>                                 |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: apc_spin.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_SPIN_H
+#define APC_SPIN_H
+
+#include "apc.h"
+
+#ifdef APC_SPIN_LOCKS
+
+#include "pgsql_s_lock.h"
+
+slock_t *apc_slock_create(slock_t *lock);
+void apc_slock_destroy(slock_t *lock);
+void apc_slock_lock(slock_t *lock TSRMLS_DC);
+zend_bool apc_slock_nonblocking_lock(slock_t *lock);
+void apc_slock_unlock(slock_t *lock);
+
+#endif
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_stack.c php-5.4.19.bak/ext/apc/apc_stack.c
--- php-5.4.19/ext/apc/apc_stack.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_stack.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,106 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_stack.c 307048 2011-01-03 23:53:17Z kalle $ */
+
+#include "apc.h"
+#include "apc_stack.h"
+
+struct apc_stack_t {
+    void** data;
+    int capacity;
+    int size;
+};
+
+apc_stack_t* apc_stack_create(int size_hint TSRMLS_DC)
+{
+    apc_stack_t* stack = (apc_stack_t*) apc_emalloc(sizeof(apc_stack_t) TSRMLS_CC);
+
+    stack->capacity = (size_hint > 0) ? size_hint : 10;
+    stack->size = 0;
+    stack->data = (void**) apc_emalloc(sizeof(void*) * stack->capacity TSRMLS_CC);
+
+    return stack;
+}
+
+void apc_stack_destroy(apc_stack_t* stack TSRMLS_DC)
+{
+    if (stack != NULL) {
+        apc_efree(stack->data TSRMLS_CC);
+        apc_efree(stack TSRMLS_CC);
+    }
+}
+
+void apc_stack_clear(apc_stack_t* stack)
+{
+    assert(stack != NULL);
+    stack->size = 0;
+}
+
+void apc_stack_push(apc_stack_t* stack, void* item TSRMLS_DC)
+{
+    assert(stack != NULL);
+    if (stack->size == stack->capacity) {
+        stack->capacity *= 2;
+        stack->data = apc_erealloc(stack->data, sizeof(void*)*stack->capacity TSRMLS_CC);
+    }
+    stack->data[stack->size++] = item;
+}
+
+void* apc_stack_pop(apc_stack_t* stack)
+{
+    assert(stack != NULL && stack->size > 0);
+    return stack->data[--stack->size];
+}
+
+void* apc_stack_top(apc_stack_t* stack)
+{
+    assert(stack != NULL && stack->size > 0);
+    return stack->data[stack->size-1];
+}
+
+void* apc_stack_get(apc_stack_t* stack, int n)
+{
+    assert(stack != NULL && stack->size > n);
+    return stack->data[n];
+}
+
+int apc_stack_size(apc_stack_t* stack)
+{
+    assert(stack != NULL);
+    return stack->size;
+}
+
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_stack.h php-5.4.19.bak/ext/apc/apc_stack.h
--- php-5.4.19/ext/apc/apc_stack.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_stack.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,58 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          George Schlossnagle <george@omniti.com>                     |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_stack.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+#ifndef APC_STACK_H
+#define APC_STACK_H
+
+/* Basic stack datatype */
+
+#define T apc_stack_t*
+typedef struct apc_stack_t apc_stack_t; /* opaque stack type */
+
+extern T apc_stack_create(int size_hint TSRMLS_DC);
+extern void apc_stack_destroy(T stack TSRMLS_DC);
+extern void apc_stack_clear(T stack);
+extern void apc_stack_push(T stack, void* item TSRMLS_DC);
+extern void* apc_stack_pop(T stack);
+extern void* apc_stack_top(T stack);
+extern void* apc_stack_get(T stack, int n);
+extern int apc_stack_size(T stack);
+
+#undef T
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_string.c php-5.4.19.bak/ext/apc/apc_string.c
--- php-5.4.19/ext/apc/apc_string.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_string.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,265 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Dmitry Stogov <dmitry@zend.com>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_string.c 327244 2012-08-23 09:08:12Z ab $ */
+
+#include "apc.h"
+#include "apc_globals.h"
+#include "apc_php.h"
+#include "apc_lock.h"
+
+#ifdef ZEND_ENGINE_2_4
+
+#ifndef ZTS
+typedef struct _apc_interned_strings_data_t {
+    char *interned_strings_start;
+    char *interned_strings_end;
+    char *interned_strings_top;
+    apc_lck_t lock;
+    HashTable interned_strings;
+} apc_interned_strings_data_t;
+
+apc_interned_strings_data_t *apc_interned_strings_data = NULL;
+
+#define APCSG(v) (apc_interned_strings_data->v)
+
+static char *old_interned_strings_start;
+static char *old_interned_strings_end;
+static const char *(*old_new_interned_string)(const char *str, int len, int free_src TSRMLS_DC);
+static void (*old_interned_strings_snapshot)(TSRMLS_D);
+static void (*old_interned_strings_restore)(TSRMLS_D);
+
+static const char *apc_dummy_new_interned_string_for_php(const char *str, int len, int free_src TSRMLS_DC)
+{
+    return str;
+}
+
+static void apc_dummy_interned_strings_snapshot_for_php(TSRMLS_D)
+{
+}
+
+static void apc_dummy_interned_strings_restore_for_php(TSRMLS_D)
+{
+}
+#endif
+
+const char *apc_new_interned_string(const char *arKey, int nKeyLength TSRMLS_DC)
+{
+#ifndef ZTS
+    ulong h;
+    uint nIndex;
+    Bucket *p;
+
+    if (arKey >= APCSG(interned_strings_start) && arKey < APCSG(interned_strings_end)) {
+        return arKey;
+    }
+
+    h = zend_inline_hash_func(arKey, nKeyLength);
+    nIndex = h & APCSG(interned_strings).nTableMask;
+
+    p = APCSG(interned_strings).arBuckets[nIndex];
+    while (p != NULL) {
+        if ((p->h == h) && (p->nKeyLength == nKeyLength)) {
+            if (!memcmp(p->arKey, arKey, nKeyLength)) {
+                return p->arKey;
+            }
+        }
+        p = p->pNext;
+    }
+   
+    if (APCSG(interned_strings_top) + ZEND_MM_ALIGNED_SIZE(sizeof(Bucket) + nKeyLength + 1) >=
+        APCSG(interned_strings_end)) {
+        /* no memory */
+        return NULL;
+    }
+
+    p = (Bucket *) APCSG(interned_strings_top);
+    APCSG(interned_strings_top) += ZEND_MM_ALIGNED_SIZE(sizeof(Bucket) + nKeyLength + 1);
+
+    p->arKey = (char*)(p+1);
+    memcpy(p->arKey, arKey, nKeyLength);
+    ((char *)p->arKey)[nKeyLength] = '\0';
+    p->nKeyLength = nKeyLength;
+    p->h = h;
+    p->pData = &p->pDataPtr;
+    p->pDataPtr = p;
+
+    p->pNext = APCSG(interned_strings).arBuckets[nIndex];
+    p->pLast = NULL;
+    if (p->pNext) {
+        p->pNext->pLast = p;
+    }
+    APCSG(interned_strings).arBuckets[nIndex] = p;
+
+    p->pListLast = APCSG(interned_strings).pListTail;
+    APCSG(interned_strings).pListTail = p;
+    p->pListNext = NULL;
+    if (p->pListLast != NULL) {
+        p->pListLast->pListNext = p;
+    }
+    if (!APCSG(interned_strings).pListHead) {
+        APCSG(interned_strings).pListHead = p;
+    }
+
+    APCSG(interned_strings).nNumOfElements++;
+
+    return p->arKey;
+#else
+    return zend_new_interned_string(arKey, nKeyLength, 0 TSRMLS_CC);
+#endif
+}
+
+#ifndef ZTS
+static void apc_copy_internal_strings(TSRMLS_D)
+{
+    Bucket *p, *q;
+
+    p = CG(function_table)->pListHead;
+    while (p) {
+        if (p->nKeyLength) {
+            p->arKey = apc_new_interned_string(p->arKey, p->nKeyLength TSRMLS_CC);
+        }
+        p = p->pListNext;
+    }
+
+    p = CG(class_table)->pListHead;
+    while (p) {
+        zend_class_entry *ce = (zend_class_entry*)(p->pDataPtr);
+
+        if (p->nKeyLength) {
+            p->arKey = apc_new_interned_string(p->arKey, p->nKeyLength TSRMLS_CC);
+        }
+
+		if (ce->name) {
+            ce->name = apc_new_interned_string(ce->name, ce->name_length+1 TSRMLS_CC);
+		}
+
+        q = ce->properties_info.pListHead;
+        while (q) {
+            zend_property_info *info = (zend_property_info*)(q->pData);
+
+            if (q->nKeyLength) {
+                q->arKey = apc_new_interned_string(q->arKey, q->nKeyLength TSRMLS_CC);
+            }
+
+            if (info->name) {
+                info->name = apc_new_interned_string(info->name, info->name_length+1 TSRMLS_CC);
+            }
+
+            q = q->pListNext;
+        }
+
+        q = ce->function_table.pListHead;
+        while (q) {
+            if (q->nKeyLength) {
+                q->arKey = apc_new_interned_string(q->arKey, q->nKeyLength TSRMLS_CC);
+            }
+            q = q->pListNext;
+        }
+
+        q = ce->constants_table.pListHead;
+        while (q) {
+            if (q->nKeyLength) {
+                q->arKey = apc_new_interned_string(q->arKey, q->nKeyLength TSRMLS_CC);
+            }
+            q = q->pListNext;
+        }
+
+        p = p->pListNext;
+    }
+
+    p = EG(zend_constants)->pListHead;
+    while (p) {
+        if (p->nKeyLength) {
+            p->arKey = apc_new_interned_string(p->arKey, p->nKeyLength TSRMLS_CC);
+       }
+        p = p->pListNext;
+    }
+}
+
+void apc_interned_strings_init(TSRMLS_D)
+{
+    int count = APCG(shm_strings_buffer) / (sizeof(Bucket) + sizeof(Bucket*) * 2);
+
+    apc_interned_strings_data = (apc_interned_strings_data_t*) apc_sma_malloc(APCG(shm_strings_buffer) TSRMLS_CC);
+    if (apc_interned_strings_data) {
+        memset((void *)apc_interned_strings_data, 0, APCG(shm_strings_buffer));
+
+        CREATE_LOCK(APCSG(lock));
+
+        zend_hash_init(&APCSG(interned_strings), count, NULL, NULL, 1);
+        APCSG(interned_strings).nTableMask = APCSG(interned_strings).nTableSize - 1;
+        APCSG(interned_strings).arBuckets = (Bucket**)((char*)apc_interned_strings_data + sizeof(apc_interned_strings_data_t));
+
+        APCSG(interned_strings_start) = (char*)APCSG(interned_strings).arBuckets + APCSG(interned_strings).nTableSize * sizeof(Bucket *);
+        APCSG(interned_strings_end)   = (char*)apc_interned_strings_data + APCG(shm_strings_buffer);
+        APCSG(interned_strings_top)   = APCSG(interned_strings_start);
+
+        old_interned_strings_start = CG(interned_strings_start);
+        old_interned_strings_end = CG(interned_strings_end);
+        old_new_interned_string = zend_new_interned_string;
+        old_interned_strings_snapshot = zend_interned_strings_snapshot;
+        old_interned_strings_restore = zend_interned_strings_restore;
+
+        CG(interned_strings_start) = APCSG(interned_strings_start);
+        CG(interned_strings_end) = APCSG(interned_strings_end);
+        zend_new_interned_string = apc_dummy_new_interned_string_for_php;
+        zend_interned_strings_snapshot = apc_dummy_interned_strings_snapshot_for_php;
+        zend_interned_strings_restore = apc_dummy_interned_strings_restore_for_php;
+
+        apc_copy_internal_strings(TSRMLS_C);
+    }
+}
+
+void apc_interned_strings_shutdown(TSRMLS_D)
+{	
+    if (apc_interned_strings_data) {
+        zend_hash_clean(CG(function_table));
+        zend_hash_clean(CG(class_table));
+        zend_hash_clean(EG(zend_constants));
+
+        CG(interned_strings_start) = old_interned_strings_start;
+        CG(interned_strings_end) = old_interned_strings_end;
+        zend_new_interned_string = old_new_interned_string;
+        zend_interned_strings_snapshot = old_interned_strings_snapshot;
+        zend_interned_strings_restore = old_interned_strings_restore;
+
+        DESTROY_LOCK(APCSG(lock));
+    }
+}
+#endif
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_string.h php-5.4.19.bak/ext/apc/apc_string.h
--- php-5.4.19/ext/apc/apc_string.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_string.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,51 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Dmitry Stogov <dmitry@zend.com>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_string.h 324145 2012-03-12 11:38:28Z pajoye $ */
+
+#ifndef APC_STRING
+#define APC_STRING
+
+#include "apc.h"
+
+#ifndef ZTS
+void apc_interned_strings_init(TSRMLS_D);
+void apc_interned_strings_shutdown(TSRMLS_D);
+#endif
+
+const char *apc_new_interned_string(const char *arKey, int nKeyLength TSRMLS_DC);
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_windows_srwlock_kernel.c php-5.4.19.bak/ext/apc/apc_windows_srwlock_kernel.c
--- php-5.4.19/ext/apc/apc_windows_srwlock_kernel.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_windows_srwlock_kernel.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,133 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Pierre Joye <pierre@php.net>                                |
+  +----------------------------------------------------------------------+
+ */
+/* $Id$ */
+/*
+ These APIs are not actually exposed nor documented. But should work fine
+ from a binary as available since XP without signature changes.
+*/
+/*
+TODOs:
+non blocking could be possible using the fWait argument (to 0). However
+I'm not sure whether the wait handlers is actually implemented in all
+supported platforms (xp+). could be enabled later once really tested.
+ */
+/* $Id: $ */
+
+#include <php.h>
+
+#ifdef APC_SRWLOCK_KERNEL
+#include "apc_windows_srwlock_kernel.h"
+
+/*
+For references:
+void WINAPI RtlInitializeResource(LPRTL_RWLOCK rwl);
+void WINAPI RtlDeleteResource(LPRTL_RWLOCK rwl);
+BYTE WINAPI RtlAcquireResourceExclusive(LPRTL_RWLOCK rwl, BYTE fWait);
+BYTE WINAPI RtlAcquireResourceShared(LPRTL_RWLOCK rwl, BYTE fWait);
+void WINAPI RtlReleaseResource(LPRTL_RWLOCK rwl);
+*/
+typedef void (WINAPI *tRtlInitializeResource)(LPRTL_RWLOCK rwl);
+typedef void (WINAPI *tRtlDeleteResource)(LPRTL_RWLOCK rwl);
+typedef BYTE (WINAPI *tRtlAcquireResourceExclusive)(LPRTL_RWLOCK rwl, BYTE fWait);
+typedef BYTE (WINAPI *tRtlAcquireResourceShared)(LPRTL_RWLOCK rwl, BYTE fWait);
+typedef void (WINAPI *tRtlReleaseResource)(LPRTL_RWLOCK rwl);
+typedef void (WINAPI *tRtlDumpResource)(LPRTL_RWLOCK rwl);
+
+tRtlInitializeResource        pRtlInitializeResource = 0;
+tRtlDeleteResource            pRtlDeleteResource = 0;
+tRtlAcquireResourceExclusive  pRtlAcquireResourceExclusive = 0;
+tRtlAcquireResourceShared     pRtlAcquireResourceShared = 0;
+tRtlReleaseResource           pRtlReleaseResource = 0;
+tRtlDumpResource              pRtlDumpResource = 0;
+
+HINSTANCE ntdll;
+
+void apc_windows_cs_status(apc_windows_cs_rwlock_t *lock );
+apc_windows_cs_rwlock_t *apc_windows_cs_create(apc_windows_cs_rwlock_t *lock TSRMLS_DC) 
+{
+    ntdll = LoadLibrary("ntdll.dll");
+    if (ntdll == 0) {
+      return NULL;
+    }
+
+    pRtlInitializeResource = (tRtlInitializeResource) GetProcAddress(ntdll, "RtlInitializeResource");
+    pRtlDeleteResource = (tRtlDeleteResource) GetProcAddress(ntdll, "RtlDeleteResource");
+    pRtlAcquireResourceExclusive = (tRtlAcquireResourceExclusive) GetProcAddress(ntdll, "RtlAcquireResourceExclusive");
+    pRtlAcquireResourceShared = (tRtlAcquireResourceShared) GetProcAddress(ntdll, "RtlAcquireResourceShared");
+    pRtlReleaseResource = (tRtlReleaseResource) GetProcAddress(ntdll, "RtlReleaseResource");
+    pRtlDumpResource = (tRtlReleaseResource) GetProcAddress(ntdll, "RtlDumpResource");
+    if (pRtlInitializeResource == 0 || pRtlDeleteResource == 0 || pRtlAcquireResourceExclusive == 0 || 
+        pRtlAcquireResourceShared == 0 || pRtlReleaseResource == 0 || pRtlDumpResource == 0) {
+        return NULL;
+    }
+    pRtlInitializeResource(lock);
+    return lock;
+}
+
+void apc_windows_cs_destroy(apc_windows_cs_rwlock_t *lock)
+{
+    __try
+    {
+        pRtlDeleteResource(lock);
+    }
+        __except(GetExceptionCode() == EXCEPTION_ACCESS_VIOLATION ?
+               EXCEPTION_EXECUTE_HANDLER : EXCEPTION_CONTINUE_SEARCH)
+    {
+        /* Ignore exception (resource was freed during shutdown of another thread) */
+    }
+    FreeLibrary(ntdll);
+    return;
+}
+
+void apc_windows_cs_lock(apc_windows_cs_rwlock_t *lock TSRMLS_DC)
+{
+    pRtlAcquireResourceExclusive(lock, 1);
+}
+
+void apc_windows_cs_rdlock(apc_windows_cs_rwlock_t *lock TSRMLS_DC)
+{
+    pRtlAcquireResourceShared(lock, 1);
+}
+
+void apc_windows_cs_unlock_rd(apc_windows_cs_rwlock_t *lock TSRMLS_DC)
+{
+    pRtlReleaseResource(lock);
+}
+
+void apc_windows_cs_unlock_wr(apc_windows_cs_rwlock_t *lock TSRMLS_DC)
+{
+    pRtlReleaseResource(lock);
+}
+
+/* debugging purposes, output using trace msgs */
+void apc_windows_cs_status(apc_windows_cs_rwlock_t *lock)
+{
+    pRtlDumpResource(lock);
+    return;
+}
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_windows_srwlock_kernel.h php-5.4.19.bak/ext/apc/apc_windows_srwlock_kernel.h
--- php-5.4.19/ext/apc/apc_windows_srwlock_kernel.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_windows_srwlock_kernel.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,74 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Pierre Joye <pierre@php.net>                                |
+  +----------------------------------------------------------------------+
+ */
+/* $Id$ */
+
+#ifndef APC_WINDOWS_CS_RWLOCK_H
+#define APC_WINDOWS_CS_RWLOCK_H
+
+#include "apc.h"
+
+#ifdef APC_SRWLOCK_KERNEL
+
+typedef struct _RTL_RWLOCK {
+   RTL_CRITICAL_SECTION rtlCS;
+
+   HANDLE hSharedReleaseSemaphore;
+   UINT   uSharedWaiters;
+
+   HANDLE hExclusiveReleaseSemaphore;
+   UINT   uExclusiveWaiters;
+
+   INT    iNumberActive;
+   HANDLE hOwningThreadId;
+   DWORD  dwTimeoutBoost;
+   PVOID  pDebugInfo;
+} RTL_RWLOCK, *LPRTL_RWLOCK;
+
+#define apc_windows_cs_rwlock_t RTL_RWLOCK
+
+struct apc_windows_cs_rwlock_t {
+    CRITICAL_SECTION cs;
+    LONG writers_waiting_count;
+    LONG readers_waiting_count;
+    DWORD active_writers_readers_flag;
+    HANDLE ready_to_read;
+    HANDLE ready_to_write;
+    DWORD reader_races_lost;
+};
+
+apc_windows_cs_rwlock_t *apc_windows_cs_create(apc_windows_cs_rwlock_t *lock TSRMLS_DC);
+void apc_windows_cs_destroy(apc_windows_cs_rwlock_t *lock);
+void apc_windows_cs_lock(apc_windows_cs_rwlock_t *lock TSRMLS_DC);
+void apc_windows_cs_rdlock(apc_windows_cs_rwlock_t *lock TSRMLS_DC);
+void apc_windows_cs_unlock_rd(apc_windows_cs_rwlock_t *lock TSRMLS_DC);
+void apc_windows_cs_unlock_wr(apc_windows_cs_rwlock_t *lock TSRMLS_DC);
+# if NONBLOCKING_LOCK_AVAILABLE==1 /* Only in win7/2008 */
+zend_bool apc_pthreadrwlock_nonblocking_lock(apc_windows_cs_rwlock_t *lock TSRMLS_DC);
+# endif
+#endif
+
+#endif
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_zend.c php-5.4.19.bak/ext/apc/apc_zend.c
--- php-5.4.19/ext/apc/apc_zend.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_zend.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,271 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_zend.c 327090 2012-08-13 03:22:02Z laruence $ */
+
+#include "apc_zend.h"
+#include "apc_globals.h"
+
+/* true global */
+int apc_reserved_offset;
+
+void* apc_php_malloc(size_t n TSRMLS_DC)
+{
+    return emalloc(n);
+}
+
+void apc_php_free(void* p TSRMLS_DC)
+{
+    efree(p);
+}
+
+#ifdef APC_OPCODE_OVERRIDE
+
+static opcode_handler_t *apc_original_opcode_handlers;
+static opcode_handler_t apc_opcode_handlers[APC_OPCODE_HANDLER_COUNT];
+
+#define APC_EX_T(offset)                    (*(temp_variable *)((char*)execute_data->Ts + offset))
+
+#ifdef ZEND_ENGINE_2_4
+static zval *apc_get_zval_ptr(zend_uchar op_type, znode_op *node, zval **freeval, zend_execute_data *execute_data TSRMLS_DC)
+{
+    *freeval = NULL;
+
+    switch (op_type) {
+        case IS_CONST:
+            return node->zv;
+        case IS_VAR:
+            return APC_EX_T(node->var).var.ptr;
+        case IS_TMP_VAR:
+            return (*freeval = &APC_EX_T(node->var).tmp_var);
+        case IS_CV:
+        {
+            zval ***ret = &execute_data->CVs[node->var];
+
+            if (!*ret) {
+                zend_compiled_variable *cv = &EG(active_op_array)->vars[node->var];
+
+                if (zend_hash_quick_find(EG(active_symbol_table), cv->name, cv->name_len+1, cv->hash_value, (void**)ret)==FAILURE) {
+                    apc_notice("Undefined variable: %s" TSRMLS_CC, cv->name);
+                    return &EG(uninitialized_zval);
+                }
+            }
+            return **ret;
+        }
+        case IS_UNUSED:
+        default:
+            return NULL;
+    }
+}
+#else
+static zval *apc_get_zval_ptr(znode *node, zval **freeval, zend_execute_data *execute_data TSRMLS_DC)
+{
+    *freeval = NULL;
+
+    switch (node->op_type) {
+        case IS_CONST:
+            return &(node->u.constant);
+        case IS_VAR:
+            return APC_EX_T(node->u.var).var.ptr;
+        case IS_TMP_VAR:
+            return (*freeval = &APC_EX_T(node->u.var).tmp_var);
+#ifdef ZEND_ENGINE_2_1
+        case IS_CV:
+        {
+            zval ***ret = &execute_data->CVs[node->u.var];
+
+            if (!*ret) {
+                zend_compiled_variable *cv = &EG(active_op_array)->vars[node->u.var];
+
+                if (zend_hash_quick_find(EG(active_symbol_table), cv->name, cv->name_len+1, cv->hash_value, (void**)ret)==FAILURE) {
+                    apc_notice("Undefined variable: %s" TSRMLS_CC, cv->name);
+                    return &EG(uninitialized_zval);
+                }
+            }
+            return **ret;
+        }
+#endif
+        case IS_UNUSED:
+        default:
+            return NULL;
+    }
+}
+#endif
+
+static int ZEND_FASTCALL apc_op_ZEND_INCLUDE_OR_EVAL(ZEND_OPCODE_HANDLER_ARGS)
+{
+    APC_ZEND_OPLINE
+    zval *freeop1 = NULL;
+    zval *inc_filename = NULL, tmp_inc_filename;
+    char realpath[MAXPATHLEN] = {0};
+    php_stream_wrapper *wrapper;
+    char *path_for_open;
+    char *full_path = NULL;
+    int ret = 0;
+    apc_opflags_t* flags = NULL;
+
+#ifdef ZEND_ENGINE_2_4
+    if (opline->extended_value != ZEND_INCLUDE_ONCE &&
+        opline->extended_value != ZEND_REQUIRE_ONCE) {
+        return apc_original_opcode_handlers[APC_OPCODE_HANDLER_DECODE(opline)](ZEND_OPCODE_HANDLER_ARGS_PASSTHRU);
+    }
+
+    inc_filename = apc_get_zval_ptr(opline->op1_type, &opline->op1, &freeop1, execute_data TSRMLS_CC);
+#else
+    if (Z_LVAL(opline->op2.u.constant) != ZEND_INCLUDE_ONCE &&
+        Z_LVAL(opline->op2.u.constant) != ZEND_REQUIRE_ONCE) {
+        return apc_original_opcode_handlers[APC_OPCODE_HANDLER_DECODE(opline)](ZEND_OPCODE_HANDLER_ARGS_PASSTHRU);
+    }
+
+    inc_filename = apc_get_zval_ptr(&opline->op1, &freeop1, execute_data TSRMLS_CC);
+#endif
+
+    if (Z_TYPE_P(inc_filename) != IS_STRING) {
+        tmp_inc_filename = *inc_filename;
+        zval_copy_ctor(&tmp_inc_filename);
+        convert_to_string(&tmp_inc_filename);
+        inc_filename = &tmp_inc_filename;
+    }
+
+    wrapper = php_stream_locate_url_wrapper(Z_STRVAL_P(inc_filename), &path_for_open, 0 TSRMLS_CC);
+
+    if (wrapper != &php_plain_files_wrapper || !(IS_ABSOLUTE_PATH(path_for_open, strlen(path_for_open)) || (full_path = expand_filepath(path_for_open, realpath TSRMLS_CC)))) {
+        /* Fallback to original handler */
+        if (inc_filename == &tmp_inc_filename) {
+            zval_dtor(&tmp_inc_filename);
+        }
+        return apc_original_opcode_handlers[APC_OPCODE_HANDLER_DECODE(opline)](ZEND_OPCODE_HANDLER_ARGS_PASSTHRU);
+    }
+
+    if (!full_path) {
+    	full_path = path_for_open;
+    }
+    if (zend_hash_exists(&EG(included_files), realpath, strlen(realpath) + 1)) {
+#ifdef ZEND_ENGINE_2_4
+        if (!(opline->result_type & EXT_TYPE_UNUSED)) {
+            ALLOC_INIT_ZVAL(APC_EX_T(opline->result.var).var.ptr);
+            ZVAL_TRUE(APC_EX_T(opline->result.var).var.ptr);
+        }
+#else
+        if (!(opline->result.u.EA.type & EXT_TYPE_UNUSED)) {
+            ALLOC_INIT_ZVAL(APC_EX_T(opline->result.u.var).var.ptr);
+            ZVAL_TRUE(APC_EX_T(opline->result.u.var).var.ptr);
+        }
+#endif
+        if (inc_filename == &tmp_inc_filename) {
+            zval_dtor(&tmp_inc_filename);
+        }
+        if (freeop1) {
+            zval_dtor(freeop1);
+        }
+        execute_data->opline++;
+        return 0;
+    }
+
+    if (inc_filename == &tmp_inc_filename) {
+        zval_dtor(&tmp_inc_filename);
+    }
+
+    if(apc_reserved_offset != -1) {
+        /* Insanity alert: look into apc_compile.c for why a void** is cast to a apc_opflags_t* */
+        flags = (apc_opflags_t*) & (execute_data->op_array->reserved[apc_reserved_offset]);
+    }
+
+    if(flags && flags->deep_copy == 1) {
+        /* Since the op array is a local copy, we can cheat our way through the file inclusion by temporarily 
+         * changing the op to a plain require/include, calling its handler and finally restoring the opcode.
+         */
+#ifdef ZEND_ENGINE_2_4
+        opline->extended_value = (opline->extended_value == ZEND_INCLUDE_ONCE) ? ZEND_INCLUDE : ZEND_REQUIRE;
+        ret = apc_original_opcode_handlers[APC_OPCODE_HANDLER_DECODE(opline)](ZEND_OPCODE_HANDLER_ARGS_PASSTHRU);
+        opline->extended_value = (opline->extended_value == ZEND_INCLUDE) ? ZEND_INCLUDE_ONCE : ZEND_REQUIRE_ONCE;
+#else
+        Z_LVAL(opline->op2.u.constant) = (Z_LVAL(opline->op2.u.constant) == ZEND_INCLUDE_ONCE) ? ZEND_INCLUDE : ZEND_REQUIRE;
+        ret = apc_original_opcode_handlers[APC_OPCODE_HANDLER_DECODE(opline)](ZEND_OPCODE_HANDLER_ARGS_PASSTHRU);
+        Z_LVAL(opline->op2.u.constant) = (Z_LVAL(opline->op2.u.constant) == ZEND_INCLUDE) ? ZEND_INCLUDE_ONCE : ZEND_REQUIRE_ONCE;
+#endif
+    } else {
+        ret = apc_original_opcode_handlers[APC_OPCODE_HANDLER_DECODE(opline)](ZEND_OPCODE_HANDLER_ARGS_PASSTHRU);
+    }
+
+    return ret;
+}
+
+void apc_zend_init(TSRMLS_D)
+{
+    zend_extension dummy_ext;
+    apc_reserved_offset = zend_get_resource_handle(&dummy_ext); 
+    assert(apc_reserved_offset == dummy_ext.resource_number);
+    assert(apc_reserved_offset != -1);
+    assert(sizeof(apc_opflags_t) <= sizeof(void*));
+    if (!APCG(include_once)) {
+        /* If we're not overriding the INCLUDE_OR_EVAL handler, then just skip this malarkey */
+        return;
+    }
+
+    memcpy(apc_opcode_handlers, zend_opcode_handlers, sizeof(apc_opcode_handlers));
+
+    /* 5.0 exposes zend_opcode_handlers differently than 5.1 and later */
+#ifdef ZEND_ENGINE_2_1
+    apc_original_opcode_handlers = zend_opcode_handlers;
+    zend_opcode_handlers = apc_opcode_handlers;
+#else
+    apc_original_opcode_handlers = apc_opcode_handlers;
+#endif
+
+    APC_REPLACE_OPCODE(ZEND_INCLUDE_OR_EVAL);
+}
+
+void apc_zend_shutdown(TSRMLS_D)
+{
+    if (!APCG(include_once)) {
+        /* Nothing changed, nothing to restore */
+        return;
+    }
+
+#ifdef ZEND_ENGINE_2_1
+    zend_opcode_handlers = apc_original_opcode_handlers;
+#else
+    memcpy(zend_opcode_handlers, apc_original_opcode_handlers, sizeof(apc_opcode_handlers));
+#endif
+}
+
+#else /* Opcode Overrides unavailable */
+
+void apc_zend_init(TSRMLS_D) { }
+void apc_zend_shutdown(TSRMLS_D) { }
+
+#endif /* APC_OPCODE_OVERRIDE */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/apc_zend.h php-5.4.19.bak/ext/apc/apc_zend.h
--- php-5.4.19/ext/apc/apc_zend.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/apc_zend.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,191 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: apc_zend.h 326712 2012-07-19 21:33:27Z rasmus $ */
+
+#ifndef APC_ZEND_H
+#define APC_ZEND_H
+
+/* Utilities for interfacing with the zend engine */
+
+#include "apc.h"
+#include "apc_php.h"
+
+#ifndef Z_REFCOUNT_P
+#define Z_REFCOUNT_P(pz)              (pz)->refcount
+#define Z_REFCOUNT_PP(ppz)            Z_REFCOUNT_P(*(ppz))
+#endif
+
+#ifndef Z_SET_REFCOUNT_P
+#define Z_SET_REFCOUNT_P(pz, rc)      (pz)->refcount = rc
+#define Z_SET_REFCOUNT_PP(ppz, rc)    Z_SET_REFCOUNT_P(*(ppz), rc)
+#endif
+
+#ifndef Z_ADDREF_P
+#define Z_ADDREF_P(pz)                (pz)->refcount++
+#define Z_ADDREF_PP(ppz)              Z_ADDREF_P(*(ppz))
+#endif
+
+#ifndef Z_DELREF_P
+#define Z_DELREF_P(pz)                (pz)->refcount--
+#define Z_DELREF_PP(ppz)              Z_DELREF_P(*(ppz))
+#endif
+
+#ifndef Z_ISREF_P
+#define Z_ISREF_P(pz)                 (pz)->is_ref
+#define Z_ISREF_PP(ppz)               Z_ISREF_P(*(ppz))
+#endif
+
+#ifndef Z_SET_ISREF_P
+#define Z_SET_ISREF_P(pz)             (pz)->is_ref = 1
+#define Z_SET_ISREF_PP(ppz)           Z_SET_ISREF_P(*(ppz))
+#endif
+
+#ifndef Z_UNSET_ISREF_P
+#define Z_UNSET_ISREF_P(pz)           (pz)->is_ref = 0
+#define Z_UNSET_ISREF_PP(ppz)         Z_UNSET_ISREF_P(*(ppz))
+#endif
+
+#ifndef Z_SET_ISREF_TO_P
+#define Z_SET_ISREF_TO_P(pz, isref)   (pz)->is_ref = isref
+#define Z_SET_ISREF_TO_PP(ppz, isref) Z_SET_ISREF_TO_P(*(ppz), isref)
+#endif
+
+
+extern void* apc_php_malloc(size_t n TSRMLS_DC);
+extern void apc_php_free(void* p TSRMLS_DC);
+
+extern void apc_zend_init(TSRMLS_D);
+extern void apc_zend_shutdown(TSRMLS_D);
+
+
+/* offset for apc info in op_array->reserved */
+extern int apc_reserved_offset;
+
+#ifndef ZEND_VM_KIND_CALL /* Not currently defined by any ZE version */
+# define ZEND_VM_KIND_CALL  1
+#endif
+
+#ifndef ZEND_VM_KIND /* Indicates PHP < 5.1 */
+# define ZEND_VM_KIND   ZEND_VM_KIND_CALL
+#endif
+
+#if defined(ZEND_ENGINE_2) && (ZEND_VM_KIND == ZEND_VM_KIND_CALL)
+# define APC_OPCODE_OVERRIDE
+#endif
+
+#ifdef APC_OPCODE_OVERRIDE
+
+#ifdef ZEND_ENGINE_2_1
+/* Taken from Zend/zend_vm_execute.h */
+#define _CONST_CODE  0
+#define _TMP_CODE    1
+#define _VAR_CODE    2
+#define _UNUSED_CODE 3
+#define _CV_CODE     4
+static inline int _apc_opcode_handler_decode(zend_op *opline)
+{
+    static const int apc_vm_decode[] = {
+        _UNUSED_CODE, /* 0              */
+        _CONST_CODE,  /* 1 = IS_CONST   */
+        _TMP_CODE,    /* 2 = IS_TMP_VAR */
+        _UNUSED_CODE, /* 3              */
+        _VAR_CODE,    /* 4 = IS_VAR     */
+        _UNUSED_CODE, /* 5              */
+        _UNUSED_CODE, /* 6              */
+        _UNUSED_CODE, /* 7              */
+        _UNUSED_CODE, /* 8 = IS_UNUSED  */
+        _UNUSED_CODE, /* 9              */
+        _UNUSED_CODE, /* 10             */
+        _UNUSED_CODE, /* 11             */
+        _UNUSED_CODE, /* 12             */
+        _UNUSED_CODE, /* 13             */
+        _UNUSED_CODE, /* 14             */
+        _UNUSED_CODE, /* 15             */
+        _CV_CODE      /* 16 = IS_CV     */
+    };
+#ifdef ZEND_ENGINE_2_4
+    return (opline->opcode * 25) + (apc_vm_decode[opline->op1_type] * 5) + apc_vm_decode[opline->op2_type];
+#else
+    return (opline->opcode * 25) + (apc_vm_decode[opline->op1.op_type] * 5) + apc_vm_decode[opline->op2.op_type];
+#endif
+}
+
+# define APC_ZEND_OPLINE                    zend_op *opline = execute_data->opline;
+# define APC_OPCODE_HANDLER_DECODE(opline)  _apc_opcode_handler_decode(opline)
+# if PHP_MAJOR_VERSION >= 6
+#  define APC_OPCODE_HANDLER_COUNT          ((25 * 152) + 1)
+# elif defined(ZEND_ENGINE_2_4)
+#  define APC_OPCODE_HANDLER_COUNT          ((25 * 159) + 1) /* 5 new opcodes in 5.4 - qm_assign_var, jmp_set_var, separate, bind_trais, add_trait */
+# elif PHP_MAJOR_VERSION >= 5 && PHP_MINOR_VERSION >= 3
+#  define APC_OPCODE_HANDLER_COUNT          ((25 * 154) + 1) /* 3 new opcodes in 5.3 - unused, lambda, jmp_set */
+# else
+#  define APC_OPCODE_HANDLER_COUNT          ((25 * 151) + 1)
+# endif
+# define APC_REPLACE_OPCODE(opname)         { int i; for(i = 0; i < 25; i++) if (zend_opcode_handlers[(opname*25) + i]) zend_opcode_handlers[(opname*25) + i] = apc_op_##opname; }
+
+#else /* ZE2.0 */
+# define APC_ZEND_ONLINE
+# define APC_OPCODE_HANDLER_DECODE(opline)  (opline->opcode)
+# define APC_OPCODE_HANDLER_COUNT           512
+# define APC_REPLACE_OPCODE(opname)         zend_opcode_handlers[opname] = apc_op_##opname;
+#endif
+
+#ifndef ZEND_FASTCALL  /* Added in ZE2.3.0 */
+#define ZEND_FASTCALL
+#endif
+
+/* Added in ZE2.3.0 */
+#ifndef zend_parse_parameters_none
+# define zend_parse_parameters_none() zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "")
+#endif
+
+
+#endif  /* APC_OPCODE_OVERRIDE */
+
+#ifdef ZEND_ENGINE_2_4
+# define ZEND_CE_FILENAME(ce)			(ce)->info.user.filename
+# define ZEND_CE_DOC_COMMENT(ce)        (ce)->info.user.doc_comment
+# define ZEND_CE_DOC_COMMENT_LEN(ce)	(ce)->info.user.doc_comment_len
+# define ZEND_CE_BUILTIN_FUNCTIONS(ce)  (ce)->info.internal.builtin_functions
+#else
+# define ZEND_CE_FILENAME(ce)			(ce)->filename
+# define ZEND_CE_DOC_COMMENT(ce)        (ce)->doc_comment
+# define ZEND_CE_DOC_COMMENT_LEN(ce)	(ce)->doc_comment_len
+# define ZEND_CE_BUILTIN_FUNCTIONS(ce)  (ce)->builtin_functions
+#endif
+
+#endif  /* APC_ZEND_H */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/CHANGELOG php-5.4.19.bak/ext/apc/CHANGELOG
--- php-5.4.19/ext/apc/CHANGELOG	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/CHANGELOG	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,249 @@
+
+3.1.2 : 2008-12-12
+
+- pecl package.xml/build fixes (bjori)
+
+3.1.1 : 2008-12-12
+
+- PHP4 compatibilty break
+- apc_pool allocator (Gopal) 
+- doubly-linked sma allocator (Shire)
+- php 5.3 gc compatibility (Gopal)
+- APCIterator for easy access (Shire)
+- apc_delete_file (Shire)
+- apc_inc/apc_dec/apc_cas functions (Shire)
+- apc.canonicalize (Gopal)
+- apc.preload_path (Gopal)
+- apc.rfc1867_ttl  (Shire)
+- apc.file_md5     (Shire)
+- consolidate locking macros (Shire)
+- remove futex/TSRM locks  (Shire)
+- non-blocking semaphore locks  (Shire)
+- zval* object rework (Gopal)
+
+3.0.19: 2008-05-14
+- Safe-mode and fast-cgi fixes
+- Fix double-free of builtin_functions
+- php 5.3 fixes
+
+3.0.18: 2008-03-29
+- Revert apc_expunge_cb bug-fix
+- Misc memleaks
+
+3.0.17: 2008-03-26
+- Crash fixes
+- Fix apc_add() cache expunge bug (Rasmus)
+- Added parameter to apc_fetch to determine success/failure when fetching booleans (shire)
+- Fix misc. memleaks (shire)
+  
+3.0.16: 2007-12-26
+- Fix for longstanding cache-full crash (Christian Seiler)
+  http://news.php.net/php.pecl.dev/4951 for the details
+- Added optional shm unmap on a fatal signal feature (Lucas Nealan)
+- Added PTHREAD_MUTEX_ADAPTIVE_NP option pthread locks (Paul Saab)
+- Minor cleanups (Lucas Nealan)
+- Added configure option to enable apc_cache_info('filehits') (Shire)
+
+3.0.15: 2007-10-18
+- Eliminate a per-request time() syscall (Rasmus)
+- Added rfc1867 prefix, name, and freq ini options (Shire)
+- Allow deletion of individual user cache entries via apc.php (Sara)
+- Fix overzealous cleanup during RSHUTDOWN (Gopal)
+- Fix memory alignment and locking issues (Gopal) 
+- Make apc_compile insert/replace entries (Shire)
+- Make mixed inheritance recompile & cache afresh  (Gopal)
+- Make nostat mode search include_path for canonicalization (Gopal)
+- ZTS & other compile fixes (Gopal, Edin, Shire)
+  
+3.0.14: 2007-03-21
+- Build fix (Shire)
+- Don't hook the upload hook if APC is disabled (Rasmus)
+- Local shadow cache support (Gopal)
+- Avoid uneccessary loops over op_arrays for "known" auto-globals (Gopal)
+- Fix apc_add() to overwrite timed out user entries (Rasmus)
+- Fix double inclusion of files with conditional classes in php4 (Gopal)
+- Allocator fixes to reduce fragmentation (Gopal)
+
+3.0.13: 2007-02-24
+- File upload progress (Rasmus)
+- Pthread mutex and spin locks (Shire)
+- Recursive zval support for apc_fetch/_store (Shire, Gopal)
+- apc.stat_ctime flag for ctime checks (Rasmus)
+- Multiple key fetches with apc_fetch (Shire)
+- Canary checks for shm memory deallocation (Gopal)
+- Add hooks for external optimizer (Shire)
+- Obsolete and remove apc optimizer (Gopal)
+- APC info changes - cache insert rate, hit and miss rates (Shire)
+- Fix apc_load_constants (Gopal)
+- Rewrite dump opcode code to use vld (Gopal)
+- Use apc_[ewn]print functions for error reporting (Shire) 
+- Auto global fixes and refactoring (Gopal, Shire)
+- Fix memory leaks in object serialization (Ilia)
+- Memory cleanup code for destructor order (Gopal)
+- Win32 build fixes (Ilia, Wez)
+- ZTS and Php 4 build fixes (Bjori)
+- Add apc_add() function (Rasmus)
+- Add optional limited flag to apc_sma_info() (Rasmus)
+
+3.0.12p2: 2006-09-05
+- Package version up
+
+3.0,12p1: 2006-09-05
+- PHP4 build fixes
+
+3.0.12: 2006-09-05
+- PHP 5.2 compatibility (Gopal)
+- TSRM fixes (Gopal)
+- Add extra flags to op_array->reserved to improve op array 
+  processing code (Gopal)
+- Fix crashes in optimizer and cli mode (Ilia)
+- Optimizer fixes for PHP5 (Ilia, Gopal)
+- Allow multiple inclusions of a file with a dynamic class (Gopal)
+- Php 4 function table and properties fixes (Gopal)
+- Fix memory leaks in apc_cache_info (Gopal)
+
+3.0.11: 2006-08-16
+- Made --enable-apc-mmap the default compile option (for real this time)
+- Add an optional flag to apc_cache_info() and some apc.php tweaks to make it
+  only fetch header information to make it useful when you have tens of
+  thousands of entries.  (Brian Shire)
+- 64-bit fixes (George)
+- Don't mix Full Path and Inode keys (George)
+- Override ZEND_INCLUDE_OR_EVAL opcode (when possible) to speed up use of
+  require_once() and include_once() statements. (Sara)
+- Add a non-blocking write_lock for cache inserts.  This is a better approach
+  to prevent cache slams and deprecates the slam_defense setting. (Rasmus)
+- A bit of work on the optimizer.  (Sara)
+- Various memory issues resolved. (Gopal)
+
+3.0.10: 2006-03-11
+- Add apc.stat ini flag which defaults to 1.  If set to 0, the main script and any fullpath
+  includes will not be stat'ed for any changes.  You will have to restart the server if you
+  change anything.  This mode increases performance quite a bit, especially if you have a
+  lot of includes.
+
+- Get rid of the lock safety net hack I added in 3.0.9.  It seems to cause more problems
+  than it solves.  I'll need to revisit locking and signal handling at some point soon.
+
+3.0.9: 2006-03-04
+- Eliminate rand() call when slam_defense is not set (Rasmus)
+- Fix for __isset problem (Gopal)
+- Rewrite allocator from a "best fit" to a "next fit" algorithm (Rasmus)
+- Added a Cache Full counter so we have an idea how many times the segment has filled up causing an expunge (Rasmus)
+- Report back the correct number of available bytes in the segment instead of the allocated bytes. (Rasmus)
+- Add cache busy flag which is set when an expunge is underway (Rasmus)
+- Add automatic serialization of objects in apc_store() (Marcus)
+- 64-bit .ini flag fix (Rasmus)
+- Static members fix (Gopal)
+- sma_cleanup() mem leak fix (Rasmus)
+- Fix for http://pecl.php.net/bugs/5311 (Rasmus)
+- Fix autoglobals JIT bug (Gopal)
+- Fix instance bug (Gopal)
+- Add a lock cleanup safety net to request shutdown (Rasmus)
+- Fix apc.slam_defense edge-case bug (Rasmus)
+- User entry memory usage tracking support (Ilia)
+- Allow keys used in apc_store/apc_fetch/apc_delete to be binary safe and prevent conflicts between keys that are found at the start of other keys. (Ilia)
+
+3.0.8: 2005-08-24
+Fix invalid free in globals destructor introduced in 3.0.7 (Rasmus)
+Cache corruption fix in cache-full cleanup code (Gopal)
+
+3.0.7: 2005-08-16
+- Fix to apc.php to show final segment in frag chart. (Ilia)
+- A couple of win32 fixes. (Frank)
+- Add apc.enable_cli ini directive. (Rasmus)
+- Add test cases. (Marcus)
+- Fix apc_define_constants() bug - http://pecl.php.net/bugs/5084 (Rasmus)
+- Simplify user cache handling by removing the user_cache_stack (Rasmus)
+- Fix apc_fetch() memory corruption (Andrei,Rasmus)
+- Added apc.max_file_size INI setting that allows exclusion of large files from being cached. Default file size limit, 1 megabyte. (Ilia)
+
+3.0.6: 2005-07-30
+- Added apc.php to package.xml file.
+- Track per-entry memory usage. (Val)
+- Various apc.php fixes and enhancements. (Ralf, Ilia, Rasmus)
+- fcntl locking robustness fixes. (Rasmus)
+- Shared read-locks where possible. (Rasmus)
+- Added file_update_protection configuration parameter. (Rasmus)
+- Windows ZTS fixes (Frank)
+
+3.0.5: 2005-07-27
+- Make it easier for sapis that only populate file_handle->filename to use APC. (Rasmus)
+- Support extensions such as bcompiler that need to hook into compile_file. (Val)
+- Ralf Becker's apcgui code has now become the default apc.php status page. (Ralf, Rasmus, Ilia)
+- Segfault in cache cleanup code (Ilia, Rasmus)
+
+3.0.4: 2005-07-18
+- Add win32 support (Edin )
+- Add --with-apxs switch to work around problem when loading APC into Apache binary compiled with LFS switches (Rasmus)
+- A couple of other minor fixes
+
+3.0.3: 2005-07-05
+- Fix compile problem against PHP 5.0.x
+
+3.0.2: 2005-07-05
+- Better shm error message
+
+3.0.1: 2005-07-05
+- PHP4 build fix
+
+3.0: 2005-06-23
+- PHP 5.1 support (Arun, Gopal, Rasmus)
+- Major Inheritance bug fix (Arun, Gopal)
+
+2.0: 2003-02-10
+- ground-up rewrite sharing none of the original source code (djc)
+
+1.0.10:
+- merge mmap / shm code to be in one file, module supports both modes now [mpb 2001-05-15]
+- added apc.mode config parameter [mpb 2001-05-15] NOTE: You'll have to add
+  this parameter to your php.ini file to activate apc shm or mmap caching
+- generic source cleanup (missing includes, PATH_MAX usage etc) [mpb
+  2001-05-15]
+- fixed: realpath return result checking in generate_key [mpb 2001-05-15]
+- updated: gui updated (extras/apc_gui-1.0.2.tar.gz)
+- experminental 'fast' cache-retrieval [djc 2001-05-20]
+- fixed regex support [gws 2001-05-16]
+- enhanced reader-writer lock support [rg 2001-05-07]
+
+1.0.9:
+- fixed (?) memory alignment bug on 64 bit archiecures 
+- added many cache visibiliy functions 
+- added opional fcntl locks under shm version 
+- numerous bug fixes 
+
+1.0.8:
+- added ability to detect and decompile compiled files placed as 'source'
+  [gws,dw 2001-01-30]
+- fixed apc_rstat bug [gws 2001-01-29]
+- added hack to support included urls [gws 2001-01-30]
+- fixed apc_cache_index [mb 2001-01-31]
+- added multiple regex support [gs 2001-02-03]
+- added apc_cache_info [mb,gs 2001-02-03]
+
+1.0.7:
+- partially fixed for Solaris [gws 2001-01-29]
+- fixed mtime support for relative includes [gws 2001-01-29]
+- code cleanup [yg,ta,gws 2001-01-29]
+
+1.0.6:
+- support for mtime in mmap [yg,gws 2001-01-27]
+- fixed indexed-array initialization bug [djc,gws 2001-01-27]
+
+1.0.5:
+- support for relative include paths [djc,gws 2001-01-19]
+- class member array support fixed [djc 2001-01-18]
+- added apc_cache_index [gws 2001-01-18]
+
+1.0.4:
+- support for class hierarchies greater than two levels deep [djc 2001-01-17]
+
+1.0.3:
+- fixed support for class inheritance [djc 2001-01-16]
+
+1.0.2:
+- support for inherited classes [gws 2001-01-15]
+- support for intialization of class variables and objects [gws 2001-01-13]
+
+1.0.1:
+- added optional file modification time check [djc 2001-01-12]
diff -Nru php-5.4.19/ext/apc/config.m4 php-5.4.19.bak/ext/apc/config.m4
--- php-5.4.19/ext/apc/config.m4	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/config.m4	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,404 @@
+dnl
+dnl $Id: config.m4 326700 2012-07-19 11:56:57Z ab $
+dnl
+
+PHP_ARG_ENABLE(apc, whether to enable APC support,
+[  --enable-apc           Enable APC support])
+
+AC_ARG_ENABLE(apc-debug,
+[  --enable-apc-debug     Enable APC debugging], 
+[
+  PHP_APC_DEBUG=$enableval
+], 
+[
+  PHP_APC_DEBUG=no
+])
+
+AC_MSG_CHECKING(whether we should enable cache request file info)
+AC_ARG_ENABLE(apc-filehits,
+[  --enable-apc-filehits   Enable per request file info about files used from the APC cache (ie: apc_cache_info('filehits')) ],
+[
+  PHP_APC_FILEHITS=$enableval
+	AC_MSG_RESULT($enableval)
+], 
+[
+  PHP_APC_FILEHITS=no
+	AC_MSG_RESULT(no)
+])
+
+AC_MSG_CHECKING(whether we should use mmap)
+AC_ARG_ENABLE(apc-mmap,
+[  --disable-apc-mmap
+                          Disable mmap support and use IPC shm instead],
+[
+  PHP_APC_MMAP=$enableval
+  AC_MSG_RESULT($enableval)
+], [
+  PHP_APC_MMAP=yes
+  AC_MSG_RESULT(yes)
+])
+
+AC_MSG_CHECKING(whether we should use semaphore locking instead of fcntl)
+AC_ARG_ENABLE(apc-sem,
+[  --enable-apc-sem
+                          Enable semaphore locks instead of fcntl],
+[
+  PHP_APC_SEM=$enableval
+  AC_MSG_RESULT($enableval)
+], [
+  PHP_APC_SEM=no
+  AC_MSG_RESULT(no)
+])
+
+AC_MSG_CHECKING(whether we should use pthread mutex locking)
+AC_ARG_ENABLE(apc-pthreadmutex,
+[  --disable-apc-pthreadmutex
+                          Disable pthread mutex locking ],
+[
+  PHP_APC_PTHREADMUTEX=$enableval
+  AC_MSG_RESULT($enableval)
+],
+[
+  PHP_APC_PTHREADMUTEX=yes
+  AC_MSG_RESULT(yes)
+])
+
+if test "$PHP_APC_PTHREADMUTEX" != "no"; then
+	orig_LIBS="$LIBS"
+	LIBS="$LIBS -lpthread"
+	AC_TRY_RUN(
+			[
+				#include <sys/types.h>
+				#include <pthread.h>
+                                main() {
+				pthread_mutex_t mutex;
+				pthread_mutexattr_t attr;	
+
+				if(pthread_mutexattr_init(&attr)) { 
+					puts("Unable to initialize pthread attributes (pthread_mutexattr_init).");
+					return -1; 
+				}
+				if(pthread_mutexattr_setpshared(&attr, PTHREAD_PROCESS_SHARED)) { 
+					puts("Unable to set PTHREAD_PROCESS_SHARED (pthread_mutexattr_setpshared), your system may not support shared mutex's.");
+					return -1; 
+				}	
+				if(pthread_mutex_init(&mutex, &attr)) { 
+					puts("Unable to initialize the mutex (pthread_mutex_init).");
+					return -1; 
+				}
+				if(pthread_mutexattr_destroy(&attr)) { 
+					puts("Unable to destroy mutex attributes (pthread_mutexattr_destroy).");
+					return -1; 
+				}
+				if(pthread_mutex_destroy(&mutex)) { 
+					puts("Unable to destroy mutex (pthread_mutex_destroy).");
+					return -1; 
+				}
+
+				puts("pthread mutexs are supported!");
+				return 0;
+                                }
+			],
+			[ dnl -Success-
+				PHP_ADD_LIBRARY(pthread)
+			],
+			[ dnl -Failure-
+				AC_MSG_WARN([It doesn't appear that pthread mutexes are supported on your system])
+  			PHP_APC_PTHREADMUTEX=no
+			],
+			[
+				PHP_ADD_LIBRARY(pthread)
+			]
+	)
+	LIBS="$orig_LIBS"
+fi
+
+AC_MSG_CHECKING(whether we should use pthread read/write locking)
+AC_ARG_ENABLE(apc-pthreadrwlocks,
+[  --enable-apc-pthreadrwlocks
+                          Enable pthread read/write locking ],
+[
+  PHP_APC_PTHREADRWLOCK=$enableval
+  AC_MSG_RESULT($enableval)
+],
+[
+  PHP_APC_PTHREADRWLOCK=no
+  AC_MSG_RESULT(no)
+])
+
+if test "$PHP_APC_PTHREADRWLOCK" != "no"; then
+	orig_LIBS="$LIBS"
+	LIBS="$LIBS -lpthread"
+	AC_TRY_RUN(
+			[
+				#include <sys/types.h>
+				#include <pthread.h>
+                                main() {
+				pthread_rwlock_t rwlock;
+				pthread_rwlockattr_t attr;	
+
+				if(pthread_rwlockattr_init(&attr)) { 
+					puts("Unable to initialize pthread attributes (pthread_rwlockattr_init).");
+					return -1; 
+				}
+				if(pthread_rwlockattr_setpshared(&attr, PTHREAD_PROCESS_SHARED)) { 
+					puts("Unable to set PTHREAD_PROCESS_SHARED (pthread_rwlockattr_setpshared), your system may not support shared rwlock's.");
+					return -1; 
+				}	
+				if(pthread_rwlock_init(&rwlock, &attr)) { 
+					puts("Unable to initialize the rwlock (pthread_rwlock_init).");
+					return -1; 
+				}
+				if(pthread_rwlockattr_destroy(&attr)) { 
+					puts("Unable to destroy rwlock attributes (pthread_rwlockattr_destroy).");
+					return -1; 
+				}
+				if(pthread_rwlock_destroy(&rwlock)) { 
+					puts("Unable to destroy rwlock (pthread_rwlock_destroy).");
+					return -1; 
+				}
+
+				puts("pthread rwlocks are supported!");
+				return 0;
+                                }
+			],
+			[ dnl -Success-
+				PHP_ADD_LIBRARY(pthread)
+				APC_CFLAGS="-D_GNU_SOURCE"
+			],
+			[ dnl -Failure-
+				AC_MSG_WARN([It doesn't appear that pthread rwlocks are supported on your system])
+  				PHP_APC_PTHREADRWLOCK=no
+			],
+			[
+				PHP_ADD_LIBRARY(pthread)
+			]
+	)
+	LIBS="$orig_LIBS"
+fi
+
+	AC_CACHE_CHECK([whether the target compiler supports builtin atomics], PHP_cv_APC_GCC_ATOMICS, [
+
+			AC_TRY_LINK([],[
+					int foo = 0;
+					__sync_fetch_and_add(&foo, 1);
+					__sync_bool_compare_and_swap(&foo, 0, 1);
+					return __sync_fetch_and_add(&foo, 1);
+				],
+				[PHP_cv_APC_GCC_ATOMICS=yes],
+				[PHP_cv_APC_GCC_ATOMICS=no])
+		])
+
+	if test "x${PHP_cv_APC_GCC_ATOMICS}" != "xno"; then
+			AC_DEFINE(HAVE_ATOMIC_OPERATIONS, 1,
+				[Define this if your target compiler supports builtin atomics])
+		else
+			if test "$PHP_APC_PTHREADRWLOCK" != "no"; then
+				AC_MSG_WARN([Disabling pthread rwlocks, because of missing atomic operations])
+				dnl - fall back would most likely be pthread mutexes 
+				PHP_APC_PTHREADRWLOCK=no
+			fi
+	fi
+
+AC_MSG_CHECKING(whether we should use spin locks)
+AC_ARG_ENABLE(apc-spinlocks,
+[  --enable-apc-spinlocks
+                          Enable spin locks  EXPERIMENTAL ],
+[
+  PHP_APC_SPINLOCKS=$enableval
+  AC_MSG_RESULT($enableval)
+],
+[
+  PHP_APC_SPINLOCKS=no
+  AC_MSG_RESULT(no)
+])
+
+
+AC_MSG_CHECKING(whether we should enable memory protection)
+AC_ARG_ENABLE(apc-memprotect,
+[  --enable-apc-memprotect
+                          Enable mmap/shm memory protection],
+[
+  PHP_APC_MEMPROTECT=$enableval
+  AC_MSG_RESULT($enableval)
+], [
+  PHP_APC_MEMPROTECT=no
+  AC_MSG_RESULT(no)
+])
+
+if test "$PHP_APC" != "no"; then
+  test "$PHP_APC_MMAP" != "no" && AC_DEFINE(APC_MMAP, 1, [ ])
+  test "$PHP_APC_FILEHITS" != "no" && AC_DEFINE(APC_FILEHITS, 1, [ ])
+
+	if test "$PHP_APC_DEBUG" != "no"; then
+		AC_DEFINE(__DEBUG_APC__, 1, [ ])
+	fi
+
+	if test "$PHP_APC_SEM" != "no"; then
+		AC_DEFINE(APC_SEM_LOCKS, 1, [ ])
+	elif test "$PHP_APC_SPINLOCKS" != "no"; then
+		AC_DEFINE(APC_SPIN_LOCKS, 1, [ ]) 
+	elif test "$PHP_APC_PTHREADRWLOCK" != "no"; then
+		AC_DEFINE(APC_PTHREADRW_LOCKS, 1, [ ]) 
+	elif test "$PHP_APC_PTHREADMUTEX" != "no"; then 
+		AC_DEFINE(APC_PTHREADMUTEX_LOCKS, 1, [ ])
+	else 
+		AC_DEFINE(APC_FCNTL_LOCKS, 1, [ ])
+	fi
+  
+	if test "$PHP_APC_MEMPROTECT" != "no"; then
+		AC_DEFINE(APC_MEMPROTECT, 1, [ shm/mmap memory protection ])
+	fi
+
+  AC_CACHE_CHECK(for zend_set_lookup_function_hook, php_cv_zend_set_lookup_function_hook,
+  [
+    orig_cflags=$CFLAGS
+    CFLAGS="$INCLUDES $EXTRA_INCLUDES"
+    AC_TRY_COMPILE([
+#include "main/php.h"
+#include "Zend/zend_API.h"
+    ], [#ifndef zend_set_lookup_function_hook
+	(void) zend_set_lookup_function_hook;
+#endif], [
+      php_cv_zend_set_lookup_function_hook=yes
+    ],[
+      php_cv_zend_set_lookup_function_hook=no
+    ])
+    CFLAGS=$orig_cflags
+  ])
+  if test "$php_cv_zend_set_lookup_function_hook" = "yes"; then
+    AC_DEFINE(APC_HAVE_LOOKUP_HOOKS, 1, [ ])
+  else
+    AC_DEFINE(APC_HAVE_LOOKUP_HOOKS, 0, [ ])
+  fi
+
+  AC_CHECK_FUNCS(sigaction)
+  AC_CACHE_CHECK(for union semun, php_cv_semun,
+  [
+    AC_TRY_COMPILE([
+#include <sys/types.h>
+#include <sys/ipc.h>
+#include <sys/sem.h>
+    ], [union semun x; x.val=1], [
+      php_cv_semun=yes
+    ],[
+      php_cv_semun=no
+    ])
+  ])
+  if test "$php_cv_semun" = "yes"; then
+    AC_DEFINE(HAVE_SEMUN, 1, [ ])
+  else
+    AC_DEFINE(HAVE_SEMUN, 0, [ ])
+  fi
+
+  AC_MSG_CHECKING(whether we should enable valgrind support)
+  AC_ARG_ENABLE(valgrind-checks,
+  [  --disable-valgrind-checks
+                          Disable valgrind based memory checks],
+  [
+    PHP_APC_VALGRIND=$enableval
+    AC_MSG_RESULT($enableval)
+  ], [
+    PHP_APC_VALGRIND=yes
+    AC_MSG_RESULT(yes)
+    AC_CHECK_HEADER(valgrind/memcheck.h, 
+  		[AC_DEFINE([HAVE_VALGRIND_MEMCHECK_H],1, [enable valgrind memchecks])])
+  ])
+
+  apc_sources="apc.c php_apc.c \
+               apc_cache.c \
+               apc_compile.c \
+               apc_debug.c \
+               apc_fcntl.c \
+               apc_main.c \
+               apc_mmap.c \
+               apc_sem.c \
+               apc_shm.c \
+               apc_pthreadmutex.c \
+               apc_pthreadrwlock.c \
+               apc_spin.c \
+               pgsql_s_lock.c \
+               apc_sma.c \
+               apc_stack.c \
+               apc_zend.c \
+               apc_rfc1867.c \
+               apc_signal.c \
+               apc_pool.c \
+               apc_iterator.c \
+               apc_bin.c \
+               apc_string.c "
+
+  PHP_CHECK_LIBRARY(rt, shm_open, [PHP_ADD_LIBRARY(rt,,APC_SHARED_LIBADD)])
+  PHP_NEW_EXTENSION(apc, $apc_sources, $ext_shared,, \\$(APC_CFLAGS))
+  PHP_SUBST(APC_SHARED_LIBADD)
+  PHP_SUBST(APC_CFLAGS)
+  PHP_INSTALL_HEADERS(ext/apc, [apc_serializer.h])
+  AC_DEFINE(HAVE_APC, 1, [ ])
+fi
+
+PHP_ARG_ENABLE(coverage,  whether to include code coverage symbols,
+[  --enable-coverage           DEVELOPERS ONLY!!], no, no)
+
+if test "$PHP_COVERAGE" = "yes"; then
+
+  if test "$GCC" != "yes"; then
+    AC_MSG_ERROR([GCC is required for --enable-coverage])
+  fi
+  
+  dnl Check if ccache is being used
+  case `$php_shtool path $CC` in
+    *ccache*[)] gcc_ccache=yes;;
+    *[)] gcc_ccache=no;;
+  esac
+
+  if test "$gcc_ccache" = "yes" && (test -z "$CCACHE_DISABLE" || test "$CCACHE_DISABLE" != "1"); then
+    AC_MSG_ERROR([ccache must be disabled when --enable-coverage option is used. You can disable ccache by setting environment variable CCACHE_DISABLE=1.])
+  fi
+  
+  lcov_version_list="1.5 1.6 1.7 1.9"
+
+  AC_CHECK_PROG(LCOV, lcov, lcov)
+  AC_CHECK_PROG(GENHTML, genhtml, genhtml)
+  PHP_SUBST(LCOV)
+  PHP_SUBST(GENHTML)
+
+  if test "$LCOV"; then
+    AC_CACHE_CHECK([for lcov version], php_cv_lcov_version, [
+      php_cv_lcov_version=invalid
+      lcov_version=`$LCOV -v 2>/dev/null | $SED -e 's/^.* //'` #'
+      for lcov_check_version in $lcov_version_list; do
+        if test "$lcov_version" = "$lcov_check_version"; then
+          php_cv_lcov_version="$lcov_check_version (ok)"
+        fi
+      done
+    ])
+  else
+    lcov_msg="To enable code coverage reporting you must have one of the following LCOV versions installed: $lcov_version_list"      
+    AC_MSG_ERROR([$lcov_msg])
+  fi
+
+  case $php_cv_lcov_version in
+    ""|invalid[)]
+      lcov_msg="You must have one of the following versions of LCOV: $lcov_version_list (found: $lcov_version)."
+      AC_MSG_ERROR([$lcov_msg])
+      LCOV="exit 0;"
+      ;;
+  esac
+
+  if test -z "$GENHTML"; then
+    AC_MSG_ERROR([Could not find genhtml from the LCOV package])
+  fi
+
+  PHP_ADD_MAKEFILE_FRAGMENT
+
+  dnl Remove all optimization flags from CFLAGS
+  changequote({,})
+  CFLAGS=`echo "$CFLAGS" | $SED -e 's/-O[0-9s]*//g'`
+  CXXFLAGS=`echo "$CXXFLAGS" | $SED -e 's/-O[0-9s]*//g'`
+  changequote([,])
+
+  dnl Add the special gcc flags
+  CFLAGS="$CFLAGS -O0 -ggdb -fprofile-arcs -ftest-coverage"
+  CXXFLAGS="$CXXFLAGS -ggdb -O0 -fprofile-arcs -ftest-coverage"
+fi
+dnl vim: set ts=2 
diff -Nru php-5.4.19/ext/apc/config.w32 php-5.4.19.bak/ext/apc/config.w32
--- php-5.4.19/ext/apc/config.w32	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/config.w32	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,60 @@
+// $Id: config.w32 309203 2011-03-14 06:47:16Z pajoye $
+// vim:ft=javascript
+
+ARG_ENABLE('apc', 'Whether to enable APC support', 'no');
+ARG_ENABLE('apc-debug', 'Whether to enable APC debugging', 'no');
+ARG_ENABLE('apc-filehits', 'Whether to enable cache request file info', 'no');
+ARG_ENABLE('apc-spinlocks', 'Whether to use spin locks (experimental)', 'no');
+ARG_ENABLE('apc-memprotect', 'Whether to enable memory protection (experimental)', 'no');
+ARG_ENABLE('apc-srwlock-native', 'Whether to use SRWLOCK locks native (win7/2008 only)', 'no');
+ARG_ENABLE('apc-srwlock-kernel', 'Whether to use SRWLOCK locks (loaded at runtime)', 'no');
+
+if(PHP_APC != 'no')
+{
+	var apc_sources = 	'apc.c php_apc.c apc_cache.c apc_compile.c apc_debug.c ' + 
+				'apc_fcntl_win32.c apc_iterator.c apc_main.c apc_shm.c ' + 
+				'apc_sma.c apc_stack.c apc_rfc1867.c apc_zend.c apc_pool.c ' +
+				'apc_bin.c apc_string.c';
+
+	if(PHP_APC_DEBUG != 'no')
+	{
+		ADD_FLAG('CFLAGS_APC', '/D __DEBUG_APC__=1');
+	}
+
+	if(PHP_APC_FILEHITS != 'no')
+	{
+		AC_DEFINE('APC_FILEHITS', 1);
+	}
+
+	if(PHP_APC_MEMPROTECT != 'no')
+	{
+		AC_DEFINE('APC_MEMPROTECT', 1);
+	}
+
+	if(PHP_APC_SRWLOCK_NATIVE != 'no') {
+		AC_DEFINE('APC_SRWLOCK_NATIVE', 1);
+	} else {
+		if(PHP_APC_SRWLOCK_KERNEL != 'no') {
+			AC_DEFINE('APC_SRWLOCK_KERNEL', 1);
+			ADD_FLAG('CFLAGS_APC', '/D WIN32_ONLY_COMPILER=1');
+
+			apc_sources += ' apc_windows_srwlock_kernel.c';
+		} else {
+			if(PHP_APC_SPINLOCKS != 'no') {
+				AC_DEFINE('APC_SPIN_LOCKS', 1);
+				ADD_FLAG('CFLAGS_APC', '/D WIN32_ONLY_COMPILER=1');
+
+				apc_sources += ' apc_spin.c pgsql_s_lock.c';
+			} else {
+				AC_DEFINE('APC_FCNTL_LOCKS', 1);
+			}
+		}
+	}
+
+	AC_DEFINE('HAVE_APC', 1);
+	AC_DEFINE('HAVE_ATOMIC_OPERATIONS', 1);
+
+	PHP_INSTALL_HEADERS("ext/apc", "apc_serializer.h");
+
+	EXTENSION('apc', apc_sources);
+}
diff -Nru php-5.4.19/ext/apc/INSTALL php-5.4.19.bak/ext/apc/INSTALL
--- php-5.4.19/ext/apc/INSTALL	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/INSTALL	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,407 @@
+Installation Instructions for APC
+---------------------------------
+
+This version of APC should work on PHP 4.3.0 - 4.4.x and
+5.1.0 - 5.2.x.  Yes, that means PHP 5.0.x is no longer 
+supported.  Upgrade to PHP 5.1.x or 5.2.x and you will 
+notice all sorts of performance increases.
+
+CVS Instructions
+----------------
+Building from CVS can be done like this:
+
+  svn co http://svn.php.net/repository/pecl/apc/trunk apc
+  cd apc
+  phpize
+  ./configure --with-php-config=/usr/local/php/bin/php-config
+  make
+  export TEST_PHP_ARGS='-n'
+  make test
+  make install
+
+Suggested Configuration (in your php.ini file)
+----------------------------------------------
+  extension=apc.so
+  apc.enabled=1
+  apc.shm_size=128M
+  apc.ttl=7200
+  apc.user_ttl=7200
+  apc.enable_cli=1
+
+These are fully described at the bottom of this file.
+
++---------------------+
+| QUICK INSTALL (DSO) |
++---------------------+
+
+These instructions assume your PHP installation is located in /usr/local/php and you
+want Apache optimizations (--with-apxs).
+
+$ gunzip -c apc_x.y.tar.gz | tar xf -
+$ cd apc_x.y
+$ /usr/local/php/bin/phpize
+$ ./configure --with-php-config=/usr/local/php/bin/php-config
+$ make
+$ make install
+
+You will probably need to run the final command (make install) as root.
+
+The above sequence of commands will install a .so file in your PHP
+installation extension directory. The output of make install should display
+that path to the screen.
+
+Next you must edit your php.ini file, which is normally located in
+/usr/local/php/lib/php.ini, and add the following line:
+
+    extension="apc.so"
+
+Replace "/path/to/php/extensions" with whatever path was displayed when you
+ran make install above.
+
+Then restart your web server and consult the output of phpinfo(). If there is
+an informational section for APC, the installation was successful.
+
++------------------------+
+| QUICK INSTALL (Static) |
++------------------------+
+
+APC will not successfully compile on all systems as a DSO. If you run into
+problems using the DSO quick install, you can try to compile it statically
+into PHP. (The DSO install is recommended, though.)
+
+These instructions assume the current directory is the root of the PHP source
+tree, and that you have already configured PHP by running its bundled
+configure script.
+
+$ cd ext
+$ gunzip -c apc_x.y.tar.gz | tar xf -
+$ cd ..
+$ ./buildconf
+$ ./config.nice
+$ make
+$ make install
+
+Once this is complete, simply restart your web server. You do not need to
+modify your php.ini file to enable APC.
+
++-----------------+
+| VERBOSE INSTALL |
++-----------------+
+
+These instructions assume your PHP installation is located in /usr/local/php.
+
+1.  Unpack your distribution file.
+
+    You will have downloaded a file named something like apc_x.y.tar.gz.
+    Unzip this file with a command like
+    
+        gunzip apc_x.y.tar.gz
+    
+    Next you have to untar it with
+    
+        tar xvf apc_x.y.tar
+
+    This will create an apc_x.y directory. cd into this new directory:
+
+        cd apc_x.y
+
+2.  Run phpize.
+
+    phpize is a script that should have been installed with PHP, and is
+    normally located in /usr/local/php/bin assuming you installed PHP in
+    /usr/local/php. (If you do not have the phpize script, you must reinstall
+    PHP and be sure not to disable PEAR.)
+
+    Run the phpize command:
+    
+        /usr/local/php/bin/phpize
+
+    Its output should resemble this:
+
+        autoheader: `config.h.in' is created
+        You should update your `aclocal.m4' by running aclocal.
+        Configuring for:
+          PHP Api Version:   20020918
+          Zend Module Api No:   20020429
+          Zend Extension Api No:   20021010
+ 
+    phpize should create a configure script in the current directory. If you
+    get errors instead, you might be missing some required development tools,
+    such as autoconf or libtool. You can try downloading the latest versions
+    of those tools and running phpize again.
+ 
+3.  Run the configure script.
+ 
+    phpize creates a configure script. The only option you need to specify is
+    the location of your php-config script:
+
+        ./configure --enable-apc
+
+    php-config should be located in the same directory as phpize.
+
+    If you prefer to use mmap instead of the default IPC shared memory support,
+    add --enable-apc-mmap to your configure line. 
+
+	If you prefer to use sysv IPC semaphores over the safer fcntl() locks, add
+	--enable-sem to your configure line.  If you don't have a problem
+	with your server segaulting, or any other unnatural accumulation of
+	semaphores on your system, the semaphore based locking is slightly faster.
+
+4.  Compile and install the files. Simply type: make install
+
+    (You may need to be root in order to install)
+
+    If you encounter errors from libtool or gcc during this step, please
+    contact the project maintainer (dcowgill@php.net).
+
+5.  Edit your php.ini
+
+    make install should have printed a line resembling the following:
+
+        Installing shared extensions: /path/to/extension/
+
+    Copy the path /path/to/extension/ and add the following line to your
+    php.ini file (normally located in /usr/local/php/lib/php.ini):
+
+        extension="apc.so"
+
+    If you don't have a php.ini file in that location, you can create it now.
+
+6.  Restart the web server and test the installation.
+
+    Restart your web server now (for apache, it's apachectl restart) and
+    create a small test PHP file in your document root. The file should
+    contain just the following line:
+
+        <?php phpinfo() ?>
+
+    Request that file in a web browser. If there is an entry for APC in the
+    list of installed modules, the installation was successful.
+
+    If APC is not listed, consult your web server error log. If it contains an
+    error message saying that it can't load the APC extension, your system
+    might not be able to load shared libraries created with PHP's build
+    system. One alternative would be to compile APC statically into PHP. See
+    the Quick Install (Static) instructions above.
+
+    You should consult your error log anyway to see if APC generated any
+    errors. On BSD-based platforms, it is typical for APC to be unable to
+    allocate the default-sized shared memory segment. See below for hints on
+    raising your system's shared memory limitations.
+
++-----------------+
+| CONFIGURING APC |
++-----------------+
+
+Although the default APC settings are fine for many installations, serious
+users should consider tuning the following parameters:
+
+    OPTION                  DESCRIPTION
+    ------------------      --------------------------------------------------
+    apc.enabled             This can be set to 0 to disable APC. This is
+                            primarily useful when APC is statically compiled
+                            into PHP, since there is no other way to disable
+                            it (when compiled as a DSO, the zend_extension
+                            line can just be commented-out).
+                            (Default: 1)
+                            
+    apc.shm_segments        The number of shared memory segments to allocate
+                            for the compiler cache. If APC is running out of
+                            shared memory but you have already set
+                            apc.shm_size as high as your system allows, you
+                            can try raising this value.  Setting this to a
+                            value other than 1 has no effect in mmap mode
+                            since mmap'ed shm segments don't have size limits.
+                            (Default: 1)
+                            
+    apc.shm_size            The size of each shared memory segment in MB.
+                            By default, some systems (including most BSD
+                            variants) have very low limits on the size of a
+                            shared memory segment. M/G suffixes must be used.
+                            (Default: 30)
+
+                            
+    apc.optimization        This option has been deprecated.
+                            (Default: 0)
+    
+    apc.num_files_hint      A "hint" about the number of distinct source files
+                            that will be included or requested on your web
+                            server. Set to zero or omit if you're not sure;
+                            this setting is mainly useful for sites that have
+                            many thousands of source files.
+                            (Default: 1000)
+
+    apc.user_entries_hint   Just like num_files_hint, a "hint" about the number
+                            of distinct user cache variables to store. 
+                            Set to zero or omit if you're not sure;
+                            (Default: 4096)
+
+    apc.ttl                 The number of seconds a cache entry is allowed to
+                            idle in a slot in case this cache entry slot is 
+                            needed by another entry.  Leaving this at zero
+                            means that your cache could potentially fill up
+                            with stale entries while newer entries won't be
+                            cached.  
+                            (Default: 0)
+
+    apc.user_ttl            The number of seconds a user cache entry is allowed 
+                            to idle in a slot in case this cache entry slot is 
+                            needed by another entry.  Leaving this at zero
+                            means that your cache could potentially fill up
+                            with stale entries while newer entries won't be
+                            cached.  
+                            (Default: 0)
+
+
+    apc.gc_ttl              The number of seconds that a cache entry may
+                            remain on the garbage-collection list. This value
+                            provides a failsafe in the event that a server
+                            process dies while executing a cached source file;
+                            if that source file is modified, the memory
+                            allocated for the old version will not be
+                            reclaimed until this TTL reached. Set to zero to
+                            disable this feature.
+                            (Default: 3600)
+
+    apc.cache_by_default    On by default, but can be set to off and used in
+                            conjunction with positive apc.filters so that files
+                            are only cached if matched by a positive filter.
+                            (Default: On)
+
+    apc.filters             A comma-separated list of POSIX extended regular
+                            expressions. If any pattern matches the source
+                            filename, the file will not be cached. Note that
+                            the filename used for matching is the one passed
+                            to include/require, not the absolute path.  If the
+                            first character of the expression is a + then the
+                            expression will be additive in the sense that any
+                            files matched by the expression will be cached, and
+                            if the first character is a - then anything matched
+                            will not be cached.  The - case is the default, so
+                            it can be left off.
+                            (Default: "")
+
+    apc.mmap_file_mask      If compiled with MMAP support by using --enable-mmap
+                            this is the mktemp-style file_mask to pass to the
+                            mmap module for determing whether your mmap'ed memory
+                            region is going to be file-backed or shared memory
+                            backed.  For straight file-backed mmap, set it to
+                            something like /tmp/apc.XXXXXX (exactly 6 X's).
+                            To use POSIX-style shm_open/mmap put a ".shm"
+                            somewhere in your mask.  eg.  "/apc.shm.XXXXXX"
+                            You can also set it to "/dev/zero" to use your 
+                            kernel's /dev/zero interface to anonymous mmap'ed 
+                            memory.  Leaving it undefined will force an 
+                            anonymous mmap.
+                            (Default: "")
+
+    apc.slam_defense        ** DEPRECATED - Use apc.write_lock instead **
+                            On very busy servers whenever you start the server or
+                            modify files you can create a race of many processes
+                            all trying to cache the same file at the same time.
+                            This option sets the percentage of processes that will
+                            skip trying to cache an uncached file.  Or think of it
+                            as the probability of a single process to skip caching.
+                            For example, setting this to 75 would mean that there is
+                            a 75% chance that the process will not cache an uncached
+                            file.  So the higher the setting the greater the defense
+                            against cache slams.  Setting this to 0 disables this
+                            feature.
+                            (Default: 0)
+
+    apc.file_update_protection
+                            When you modify a file on a live web server you really
+                            should do so in an atomic manner.  That is, write to a
+                            temporary file and rename (mv) the file into its permanent
+                            position when it is ready.  Many text editors, cp, tar and
+                            other such programs don't do this.  This means that there
+                            is a chance that a file is accessed (and cached) while it
+                            is still being written to.  This file_update_protection
+                            setting puts a delay on caching brand new files.  The
+                            default is 2 seconds which means that if the modification
+                            timestamp (mtime) on a file shows that it is less than 2
+                            seconds old when it is accessed, it will not be cached.  
+                            The unfortunate person who accessed this half-written file
+                            will still see weirdness, but at least it won't persist.
+                            If you are certain you always atomically update your files
+                            by using something like rsync which does this correctly, you
+                            can turn this protection off by setting it to 0.  If you
+                            have a system that is flooded with io causing some update
+                            procedure to take longer than 2 seconds, you may want to
+                            increase this a bit.
+                            (Default: 2)
+
+    apc.enable_cli          Mostly for testing and debugging.  Setting this enables APC
+                            for the CLI version of PHP.  Normally you wouldn't want to
+                            create, populate and tear down the APC cache on every CLI
+                            request, but for various test scenarios it is handy to be
+                            able to enable APC for the CLI version of APC easily.
+                            (Default: 0)
+
+    apc.max_file_size       Prevents large files from being cached.  
+                            (Default: 1M)
+
+    apc.stat                Whether to stat the main script file and the fullpath
+                            includes.  If you turn this off you will need to restart
+                            your server in order to update scripts.
+                            (Default: 1)
+
+    apc.canonicalize        Whether to canonicalize paths in stat=0 mode or
+                            fall back to stat behaviour if set to 0
+                            (Default: 0)
+
+    apc.write_lock          On busy servers when you first start up the server, or when
+                            many files are modified, you can end up with all your processes
+                            trying to compile and cache the same files.  With write_lock 
+                            enabled, only one process at a time will try to compile an
+                            uncached script while the other processes will run uncached
+                            instead of sitting around waiting on a lock.
+                            (Default: 1)
+
+    apc.report_autofilter   Logs any scripts that were automatically excluded from being
+                            cached due to early/late binding issues.
+                            (Default: 0)
+
+    apc.rfc1867             RFC1867 File Upload Progress hook handler is only available
+                            if you compiled APC against PHP 5.2.0 or later.  When enabled
+                            any file uploads which includes a field called 
+                            APC_UPLOAD_PROGRESS before the file field in an upload form
+                            will cause APC to automatically create an upload_<key>
+                            user cache entry where <key> is the value of the 
+                            APC_UPLOAD_PROGRESS form entry.
+
+                            Note that the file upload tracking is not threadsafe at this
+                            point, so new uploads that happen while a previous one is 
+                            still going will disable the tracking for the previous.
+                            (Default: 0)
+
+    apc.rfc1867_prefix      Key prefix to use for the user cache entry generated by
+                            rfc1867 upload progress functionality.  
+                            (Default: "upload_")
+
+    apc.rfc1867_name        Specify the hidden form entry name that activates APC upload
+                            progress and specifies the user cache key suffix.
+                            (Default: "APC_UPLOAD_PROGRESS")
+
+    apc.rfc1867_freq        The frequency that updates should be made to the user cache
+                            entry for upload progress.  This can take the form of a 
+                            percentage of the total file size or a size in bytes 
+                            optionally suffixed with 'k', 'm', or 'g' for kilobytes, 
+                            megabytes, or gigabytes respectively (case insensitive).  
+                            A setting of 0 updates as often as possible, which may cause 
+                            slower uploads.
+                            (Default: 0)
+
+    apc.localcache         ** REMOVED 
+    apc.localcache.size    ** REMOVED
+    
+    apc.include_once_override 
+                            Optimize include_once and require_once calls and avoid the 
+                            expensive system calls used.
+                            (Default: 0)
+
+    apc.serializer 
+                            Defines which serializer should be used. Default is the 
+                            standard PHP serializer. Other can be used without having
+                            to re compile apc, like igbinary for example.
+                            (apc.serializer=igbinary)
diff -Nru php-5.4.19/ext/apc/LICENSE php-5.4.19.bak/ext/apc/LICENSE
--- php-5.4.19/ext/apc/LICENSE	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/LICENSE	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,68 @@
+-------------------------------------------------------------------- 
+                  The PHP License, version 3.01
+Copyright (c) 1999 - 2011 The PHP Group. All rights reserved.
+-------------------------------------------------------------------- 
+
+Redistribution and use in source and binary forms, with or without
+modification, is permitted provided that the following conditions
+are met:
+
+  1. Redistributions of source code must retain the above copyright
+     notice, this list of conditions and the following disclaimer.
+ 
+  2. Redistributions in binary form must reproduce the above copyright
+     notice, this list of conditions and the following disclaimer in
+     the documentation and/or other materials provided with the
+     distribution.
+ 
+  3. The name "PHP" must not be used to endorse or promote products
+     derived from this software without prior written permission. For
+     written permission, please contact group@php.net.
+  
+  4. Products derived from this software may not be called "PHP", nor
+     may "PHP" appear in their name, without prior written permission
+     from group@php.net.  You may indicate that your software works in
+     conjunction with PHP by saying "Foo for PHP" instead of calling
+     it "PHP Foo" or "phpfoo"
+ 
+  5. The PHP Group may publish revised and/or new versions of the
+     license from time to time. Each version will be given a
+     distinguishing version number.
+     Once covered code has been published under a particular version
+     of the license, you may always continue to use it under the terms
+     of that version. You may also choose to use such covered code
+     under the terms of any subsequent version of the license
+     published by the PHP Group. No one other than the PHP Group has
+     the right to modify the terms applicable to covered code created
+     under this License.
+
+  6. Redistributions of any form whatsoever must retain the following
+     acknowledgment:
+     "This product includes PHP software, freely available from
+     <http://www.php.net/software/>".
+
+THIS SOFTWARE IS PROVIDED BY THE PHP DEVELOPMENT TEAM ``AS IS'' AND 
+ANY EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
+THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A 
+PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE PHP
+DEVELOPMENT TEAM OR ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, 
+INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES 
+(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR 
+SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
+HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
+STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
+OF THE POSSIBILITY OF SUCH DAMAGE.
+
+-------------------------------------------------------------------- 
+
+This software consists of voluntary contributions made by many
+individuals on behalf of the PHP Group.
+
+The PHP Group can be contacted via Email at group@php.net.
+
+For more information on the PHP Group and the PHP project, 
+please see <http://www.php.net>.
+
+PHP includes the Zend Engine, freely available at
+<http://www.zend.com>.
diff -Nru php-5.4.19/ext/apc/NOTICE php-5.4.19.bak/ext/apc/NOTICE
--- php-5.4.19/ext/apc/NOTICE	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/NOTICE	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,43 @@
+This is the NOTICE file that holds acknowledgements and stuff.
+
+The Alternative PHP Cache (APC) is a free and open opcode cache for PHP.
+This extension is being released under the PHP License for complete compliance
+with PHP and to encourage wide-spread use.  It is our intention that this
+project be kept open source and that all commercial spin-offs contribute their
+modifications back into the public source-tree.
+
+Creators:
+    Daniel Cowgill
+    George Schlossnagle
+
+PHP5 support and major features by:
+    Arun C. Murthy 
+    Gopal Vijayaraghavan
+    Rasmus Lerdorf
+
+This software was contributed to PHP by Community Connect Inc. in 2002
+and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+Future revisions and derivatives of this source code must acknowledge
+Community Connect Inc. as the original contributor of this module by
+leaving this note intact in the source code.
+
+All other licensing and usage conditions are those of the PHP Group.
+
+We would like to thank Community Connect Inc. and Yahoo! Inc. for supporting 
+this project and providing a challenging and stimulating environment in 
+which exciting projects can happen.
+
+Contributors:
+    Mike Bretz          bug fixes, GUI, and lots of work
+    Ricardo Galli       changed read-write locks to prefer readers
+    Yann Grossel        bug fixes
+    Thies Arntzen       bug fixes
+    Sara Golemon        optimizer work
+
+Special Thanks:
+    Florian Baumert     help debugging phplib problems
+    Thomas Duffey       help debugging inheritance issues
+    Vibol Hou           help debugging phplib problems
+    Angel Li            diffs for ANSI comment compliance
+    Christian Rishj    help debugging phplib problems
+    Sascha Schumann     memory error bug fix
diff -Nru php-5.4.19/ext/apc/pgsql_s_lock.c php-5.4.19.bak/ext/apc/pgsql_s_lock.c
--- php-5.4.19/ext/apc/pgsql_s_lock.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/pgsql_s_lock.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,391 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | The following code was ported from the PostgreSQL project, please    |
+  |  see appropriate copyright notices that follow.                      |
+  | Initial conversion by Brian Shire <shire@php.net>                    |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: pgsql_s_lock.c 307048 2011-01-03 23:53:17Z kalle $ */
+
+/*-------------------------------------------------------------------------
+ *
+ * s_lock.c
+ *	   Hardware-dependent implementation of spinlocks.
+ *
+ *
+ * Portions Copyright (c) 1996-2006, PostgreSQL Global Development Group
+ * Portions Copyright (c) 1994, Regents of the University of California
+ *
+ *
+ * IDENTIFICATION
+ *	  $PostgreSQL: pgsql/src/backend/storage/lmgr/s_lock.c,v 1.47 2006/10/04 00:29:58 momjian Exp $
+ *
+ *-------------------------------------------------------------------------
+ */
+/* #include "postgres.h"  -- Removed for APC */
+
+/* -- Added for APC -- */
+#include "apc.h"
+#ifdef APC_SPIN_LOCKS
+
+#ifdef S_LOCK_TEST
+#include <stdio.h>
+#endif
+#ifndef WIN32
+#include <sys/select.h>
+#endif
+/* ---- */
+
+#include <time.h>
+#ifdef WIN32
+#include "win32/unistd.h"
+#else
+#include <unistd.h>
+#endif
+
+/* #include "storage/s_lock.h" -- Removed for APC */
+#include "pgsql_s_lock.h"
+
+static int	spins_per_delay = DEFAULT_SPINS_PER_DELAY;
+
+
+/* -- APC specific additions ------------------------------*/
+/* The following dependencies have been copied from 
+ * other pgsql source files.  The original locations 
+ * have been noted.
+ */
+
+/* -- from include/c.h -- */
+#ifndef TRUE
+#define TRUE  1
+#endif
+
+#ifndef FALSE
+#define FALSE 0
+#endif
+
+/* -- from include/pg_config_manual.h -- */
+#define MAX_RANDOM_VALUE (0x7FFFFFFF) 
+
+/*
+ * Max
+ *    Return the maximum of two numbers.
+ */
+#define Max(x, y)   ((x) > (y) ? (x) : (y))
+
+/* -- from include/c.h -- */
+/*
+ * Min
+ *    Return the minimum of two numbers.
+ */
+#define Min(x, y)   ((x) < (y) ? (x) : (y))
+
+
+/* -- from backend/port/win32/signal.c -- */
+/*
+ * pg_usleep --- delay the specified number of microseconds.
+ *
+ * NOTE: although the delay is specified in microseconds, the effective
+ * resolution is only 1/HZ, or 10 milliseconds, on most Unixen.  Expect
+ * the requested delay to be rounded up to the next resolution boundary.
+ *
+ * On machines where "long" is 32 bits, the maximum delay is ~2000 seconds.
+ */
+void
+pg_usleep(long microsec)
+{
+	if (microsec > 0)
+	{
+#ifndef WIN32
+		struct timeval delay;
+
+		delay.tv_sec = microsec / 1000000L;
+		delay.tv_usec = microsec % 1000000L;
+		(void) select(0, NULL, NULL, NULL, &delay);
+#else
+		SleepEx((microsec < 500 ? 1 : (microsec + 500) / 1000), FALSE);
+#endif
+	}
+}
+
+/* -- End APC specific additions ------------------------------*/
+
+
+/*
+ * s_lock_stuck() - complain about a stuck spinlock
+ */
+static void
+s_lock_stuck(volatile slock_t *lock, const char *file, int line TSRMLS_DC)
+{
+#if defined(S_LOCK_TEST)
+	fprintf(stderr,
+			"\nStuck spinlock (%p) detected at %s:%d.\n",
+			lock, file, line);
+	exit(1);
+#else
+  /* -- Removed for APC
+	elog(PANIC, "stuck spinlock (%p) detected at %s:%d",
+		 lock, file, line);
+  */
+  apc_error("Stuck spinlock (%p) detected" TSRMLS_CC, lock);
+#endif
+}
+
+
+/*
+ * s_lock(lock) - platform-independent portion of waiting for a spinlock.
+ */
+void
+s_lock(volatile slock_t *lock, const char *file, int line TSRMLS_DC)
+{
+	/*
+	 * We loop tightly for awhile, then delay using pg_usleep() and try again.
+	 * Preferably, "awhile" should be a small multiple of the maximum time we
+	 * expect a spinlock to be held.  100 iterations seems about right as an
+	 * initial guess.  However, on a uniprocessor the loop is a waste of
+	 * cycles, while in a multi-CPU scenario it's usually better to spin a bit
+	 * longer than to call the kernel, so we try to adapt the spin loop count
+	 * depending on whether we seem to be in a uniprocessor or multiprocessor.
+	 *
+	 * Note: you might think MIN_SPINS_PER_DELAY should be just 1, but you'd
+	 * be wrong; there are platforms where that can result in a "stuck
+	 * spinlock" failure.  This has been seen particularly on Alphas; it seems
+	 * that the first TAS after returning from kernel space will always fail
+	 * on that hardware.
+	 *
+	 * Once we do decide to block, we use randomly increasing pg_usleep()
+	 * delays. The first delay is 1 msec, then the delay randomly increases to
+	 * about one second, after which we reset to 1 msec and start again.  The
+	 * idea here is that in the presence of heavy contention we need to
+	 * increase the delay, else the spinlock holder may never get to run and
+	 * release the lock.  (Consider situation where spinlock holder has been
+	 * nice'd down in priority by the scheduler --- it will not get scheduled
+	 * until all would-be acquirers are sleeping, so if we always use a 1-msec
+	 * sleep, there is a real possibility of starvation.)  But we can't just
+	 * clamp the delay to an upper bound, else it would take a long time to
+	 * make a reasonable number of tries.
+	 *
+	 * We time out and declare error after NUM_DELAYS delays (thus, exactly
+	 * that many tries).  With the given settings, this will usually take 2 or
+	 * so minutes.	It seems better to fix the total number of tries (and thus
+	 * the probability of unintended failure) than to fix the total time
+	 * spent.
+	 *
+	 * The pg_usleep() delays are measured in milliseconds because 1 msec is a
+	 * common resolution limit at the OS level for newer platforms. On older
+	 * platforms the resolution limit is usually 10 msec, in which case the
+	 * total delay before timeout will be a bit more.
+	 */
+#define MIN_SPINS_PER_DELAY 10
+#define MAX_SPINS_PER_DELAY 1000
+#define NUM_DELAYS			1000
+#define MIN_DELAY_MSEC		1
+#define MAX_DELAY_MSEC		1000
+
+	int			spins = 0;
+	int			delays = 0;
+	int			cur_delay = 0;
+  
+	while (TAS(lock))
+	{
+		/* CPU-specific delay each time through the loop */
+		SPIN_DELAY();
+
+		/* Block the process every spins_per_delay tries */
+		if (++spins >= spins_per_delay)
+		{
+			if (++delays > NUM_DELAYS)
+				s_lock_stuck(lock, file, line TSRMLS_CC);
+
+			if (cur_delay == 0) /* first time to delay? */
+				cur_delay = MIN_DELAY_MSEC;
+
+			pg_usleep(cur_delay * 1000L);
+
+#if defined(S_LOCK_TEST)
+			fprintf(stdout, "*");
+			fflush(stdout);
+#endif
+
+			/* increase delay by a random fraction between 1X and 2X */
+			cur_delay += (int) (cur_delay *
+					  ((double) rand() / (double) MAX_RANDOM_VALUE) + 0.5);
+			/* wrap back to minimum delay when max is exceeded */
+			if (cur_delay > MAX_DELAY_MSEC)
+				cur_delay = MIN_DELAY_MSEC;
+
+			spins = 0;
+		}
+	}
+
+	/*
+	 * If we were able to acquire the lock without delaying, it's a good
+	 * indication we are in a multiprocessor.  If we had to delay, it's a sign
+	 * (but not a sure thing) that we are in a uniprocessor. Hence, we
+	 * decrement spins_per_delay slowly when we had to delay, and increase it
+	 * rapidly when we didn't.  It's expected that spins_per_delay will
+	 * converge to the minimum value on a uniprocessor and to the maximum
+	 * value on a multiprocessor.
+	 *
+	 * Note: spins_per_delay is local within our current process. We want to
+	 * average these observations across multiple backends, since it's
+	 * relatively rare for this function to even get entered, and so a single
+	 * backend might not live long enough to converge on a good value.	That
+	 * is handled by the two routines below.
+	 */
+	if (cur_delay == 0)
+	{
+		/* we never had to delay */
+		if (spins_per_delay < MAX_SPINS_PER_DELAY)
+			spins_per_delay = Min(spins_per_delay + 100, MAX_SPINS_PER_DELAY);
+	}
+	else
+	{
+		if (spins_per_delay > MIN_SPINS_PER_DELAY)
+			spins_per_delay = Max(spins_per_delay - 1, MIN_SPINS_PER_DELAY);
+	}
+}
+
+
+#if 0  /* -- APC doesn't use the set_spins_per_delay or update_spins_per_delay -- */
+/*
+ * Set local copy of spins_per_delay during backend startup.
+ *
+ * NB: this has to be pretty fast as it is called while holding a spinlock
+ */
+void
+set_spins_per_delay(int shared_spins_per_delay)
+{
+	spins_per_delay = shared_spins_per_delay;
+}
+
+/*
+ * Update shared estimate of spins_per_delay during backend exit.
+ *
+ * NB: this has to be pretty fast as it is called while holding a spinlock
+ */
+int
+update_spins_per_delay(int shared_spins_per_delay)
+{
+	/*
+	 * We use an exponential moving average with a relatively slow adaption
+	 * rate, so that noise in any one backend's result won't affect the shared
+	 * value too much.	As long as both inputs are within the allowed range,
+	 * the result must be too, so we need not worry about clamping the result.
+	 *
+	 * We deliberately truncate rather than rounding; this is so that single
+	 * adjustments inside a backend can affect the shared estimate (see the
+	 * asymmetric adjustment rules above).
+	 */
+	return (shared_spins_per_delay * 15 + spins_per_delay) / 16;
+}
+#endif
+
+/*
+ * Various TAS implementations that cannot live in s_lock.h as no inline
+ * definition exists (yet).
+ * In the future, get rid of tas.[cso] and fold it into this file.
+ *
+ * If you change something here, you will likely need to modify s_lock.h too,
+ * because the definitions for these are split between this file and s_lock.h.
+ */
+
+
+#ifdef HAVE_SPINLOCKS			/* skip spinlocks if requested */
+
+
+#if defined(__GNUC__)
+
+/*
+ * All the gcc flavors that are not inlined
+ */
+
+
+/*
+ * Note: all the if-tests here probably ought to be testing gcc version
+ * rather than platform, but I don't have adequate info to know what to
+ * write.  Ideally we'd flush all this in favor of the inline version.
+ */
+#if defined(__m68k__) && !defined(__linux__)
+/* really means: extern int tas(slock_t* **lock); */
+static void
+tas_dummy()
+{
+	__asm__		__volatile__(
+#if defined(__NetBSD__) && defined(__ELF__)
+/* no underscore for label and % for registers */
+										 "\
+.global		tas 				\n\
+tas:							\n\
+			movel	%sp@(0x4),%a0	\n\
+			tas 	%a0@		\n\
+			beq 	_success	\n\
+			moveq	#-128,%d0	\n\
+			rts 				\n\
+_success:						\n\
+			moveq	#0,%d0		\n\
+			rts 				\n"
+#else
+										 "\
+.global		_tas				\n\
+_tas:							\n\
+			movel	sp@(0x4),a0	\n\
+			tas 	a0@			\n\
+			beq 	_success	\n\
+			moveq 	#-128,d0	\n\
+			rts					\n\
+_success:						\n\
+			moveq 	#0,d0		\n\
+			rts					\n"
+#endif   /* __NetBSD__ && __ELF__ */
+	);
+}
+#endif   /* __m68k__ && !__linux__ */
+#else							/* not __GNUC__ */
+
+/*
+ * All non gcc
+ */
+
+
+#if defined(sun3)
+static void
+tas_dummy()						/* really means: extern int tas(slock_t
+								 * *lock); */
+{
+	asm("LLA0:");
+	asm("   .data");
+	asm("   .text");
+	asm("|#PROC# 04");
+	asm("   .globl  _tas");
+	asm("_tas:");
+	asm("|#PROLOGUE# 1");
+	asm("   movel   sp@(0x4),a0");
+	asm("   tas a0@");
+	asm("   beq LLA1");
+	asm("   moveq   #-128,d0");
+	asm("   rts");
+	asm("LLA1:");
+	asm("   moveq   #0,d0");
+	asm("   rts");
+	asm("   .data");
+}
+#endif   /* sun3 */
+#endif   /* not __GNUC__ */
+#endif   /* HAVE_SPINLOCKS */
+
+#endif /* APC_SPIN_LOCKS */
diff -Nru php-5.4.19/ext/apc/pgsql_s_lock.h php-5.4.19.bak/ext/apc/pgsql_s_lock.h
--- php-5.4.19/ext/apc/pgsql_s_lock.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/pgsql_s_lock.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,928 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | The following code was ported from the PostgreSQL project, please    |
+  |  see appropriate copyright notices that follow.                      |
+  | Initial conversion by Brian Shire <shire@php.net>                    |
+  +----------------------------------------------------------------------+
+
+ */
+
+/* $Id: pgsql_s_lock.h 307048 2011-01-03 23:53:17Z kalle $ */
+
+/*-------------------------------------------------------------------------
+ *
+ * s_lock.h
+ *	   Hardware-dependent implementation of spinlocks.
+ *
+ *	NOTE: none of the macros in this file are intended to be called directly.
+ *	Call them through the hardware-independent macros in spin.h.
+ *
+ *	The following hardware-dependent macros must be provided for each
+ *	supported platform:
+ *
+ *	void S_INIT_LOCK(slock_t *lock)
+ *		Initialize a spinlock (to the unlocked state).
+ *
+ *	void S_LOCK(slock_t *lock)
+ *		Acquire a spinlock, waiting if necessary.
+ *		Time out and abort() if unable to acquire the lock in a
+ *		"reasonable" amount of time --- typically ~ 1 minute.
+ *
+ *	void S_UNLOCK(slock_t *lock)
+ *		Unlock a previously acquired lock.
+ *
+ *	bool S_LOCK_FREE(slock_t *lock)
+ *		Tests if the lock is free. Returns TRUE if free, FALSE if locked.
+ *		This does *not* change the state of the lock.
+ *
+ *	void SPIN_DELAY(void)
+ *		Delay operation to occur inside spinlock wait loop.
+ *
+ *	Note to implementors: there are default implementations for all these
+ *	macros at the bottom of the file.  Check if your platform can use
+ *	these or needs to override them.
+ *
+ *  Usually, S_LOCK() is implemented in terms of an even lower-level macro
+ *	TAS():
+ *
+ *	int TAS(slock_t *lock)
+ *		Atomic test-and-set instruction.  Attempt to acquire the lock,
+ *		but do *not* wait.	Returns 0 if successful, nonzero if unable
+ *		to acquire the lock.
+ *
+ *	TAS() is NOT part of the API, and should never be called directly.
+ *
+ *	CAUTION: on some platforms TAS() may sometimes report failure to acquire
+ *	a lock even when the lock is not locked.  For example, on Alpha TAS()
+ *	will "fail" if interrupted.  Therefore TAS() should always be invoked
+ *	in a retry loop, even if you are certain the lock is free.
+ *
+ *	ANOTHER CAUTION: be sure that TAS() and S_UNLOCK() represent sequence
+ *	points, ie, loads and stores of other values must not be moved across
+ *	a lock or unlock.  In most cases it suffices to make the operation be
+ *	done through a "volatile" pointer.
+ *
+ *	On most supported platforms, TAS() uses a tas() function written
+ *	in assembly language to execute a hardware atomic-test-and-set
+ *	instruction.  Equivalent OS-supplied mutex routines could be used too.
+ *
+ *	If no system-specific TAS() is available (ie, HAVE_SPINLOCKS is not
+ *	defined), then we fall back on an emulation that uses SysV semaphores
+ *	(see spin.c).  This emulation will be MUCH MUCH slower than a proper TAS()
+ *	implementation, because of the cost of a kernel call per lock or unlock.
+ *	An old report is that Postgres spends around 40% of its time in semop(2)
+ *	when using the SysV semaphore code.
+ *
+ *
+ * Portions Copyright (c) 1996-2006, PostgreSQL Global Development Group
+ * Portions Copyright (c) 1994, Regents of the University of California
+ *
+ *	  $PostgreSQL: pgsql/src/include/storage/s_lock.h,v 1.157 2006/06/07 22:24:45 momjian Exp $
+ *
+ *-------------------------------------------------------------------------
+ */
+#ifndef S_LOCK_H
+#define S_LOCK_H
+
+/** APC namespace protection ************************************************/
+/* hack to protect against any possible runtime namespace collisions...*/
+#define pg_usleep               apc_spin_pg_usleep
+#define s_lock                  apc_spin_s_lock
+#define spins_per_delay         apc_spin_spins_per_delay
+/****************************************************************************/
+
+
+/* #include "storage/pg_sema.h"   -- Removed for APC */
+
+#define HAVE_SPINLOCKS 1 /* -- Added for APC */
+
+#ifdef HAVE_SPINLOCKS	/* skip spinlocks if requested */
+
+
+#if defined(__GNUC__) || defined(__ICC)
+/*************************************************************************
+ * All the gcc inlines
+ * Gcc consistently defines the CPU as __cpu__.
+ * Other compilers use __cpu or __cpu__ so we test for both in those cases.
+ */
+
+/*----------
+ * Standard gcc asm format (assuming "volatile slock_t *lock"):
+
+	__asm__ __volatile__(
+		"	instruction	\n"
+		"	instruction	\n"
+		"	instruction	\n"
+:		"=r"(_res), "+m"(*lock)		// return register, in/out lock value
+:		"r"(lock)					// lock pointer, in input register
+:		"memory", "cc");			// show clobbered registers here
+
+ * The output-operands list (after first colon) should always include
+ * "+m"(*lock), whether or not the asm code actually refers to this
+ * operand directly.  This ensures that gcc believes the value in the
+ * lock variable is used and set by the asm code.  Also, the clobbers
+ * list (after third colon) should always include "memory"; this prevents
+ * gcc from thinking it can cache the values of shared-memory fields
+ * across the asm code.  Add "cc" if your asm code changes the condition
+ * code register, and also list any temp registers the code uses.
+ *----------
+ */
+
+
+#ifdef __i386__		/* 32-bit i386 */
+#define HAS_TEST_AND_SET
+
+typedef unsigned char slock_t;
+
+#define TAS(lock) tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	register slock_t _res = 1;
+
+	/*
+	 * Use a non-locking test before asserting the bus lock.  Note that the
+	 * extra test appears to be a small loss on some x86 platforms and a small
+	 * win on others; it's by no means clear that we should keep it.
+	 */
+	__asm__ __volatile__(
+		"	cmpb	$0,%1	\n"
+		"	jne		1f		\n"
+		"	lock			\n"
+		"	xchgb	%0,%1	\n"
+		"1: \n"
+:		"+q"(_res), "+m"(*lock)
+:
+:		"memory", "cc");
+	return (int) _res;
+}
+
+#define SPIN_DELAY() spin_delay()
+
+static __inline__ void
+spin_delay(void)
+{
+	/*
+	 * This sequence is equivalent to the PAUSE instruction ("rep" is
+	 * ignored by old IA32 processors if the following instruction is
+	 * not a string operation); the IA-32 Architecture Software
+	 * Developer's Manual, Vol. 3, Section 7.7.2 describes why using
+	 * PAUSE in the inner loop of a spin lock is necessary for good
+	 * performance:
+	 *
+	 *     The PAUSE instruction improves the performance of IA-32
+	 *     processors supporting Hyper-Threading Technology when
+	 *     executing spin-wait loops and other routines where one
+	 *     thread is accessing a shared lock or semaphore in a tight
+	 *     polling loop. When executing a spin-wait loop, the
+	 *     processor can suffer a severe performance penalty when
+	 *     exiting the loop because it detects a possible memory order
+	 *     violation and flushes the core processor's pipeline. The
+	 *     PAUSE instruction provides a hint to the processor that the
+	 *     code sequence is a spin-wait loop. The processor uses this
+	 *     hint to avoid the memory order violation and prevent the
+	 *     pipeline flush. In addition, the PAUSE instruction
+	 *     de-pipelines the spin-wait loop to prevent it from
+	 *     consuming execution resources excessively.
+	 */
+	__asm__ __volatile__(
+		" rep; nop			\n");
+}
+
+#endif	 /* __i386__ */
+
+
+#ifdef __x86_64__		/* AMD Opteron, Intel EM64T */
+#define HAS_TEST_AND_SET
+
+typedef unsigned char slock_t;
+
+#define TAS(lock) tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	register slock_t _res = 1;
+
+	/*
+	 * On Opteron, using a non-locking test before the locking instruction
+	 * is a huge loss.  On EM64T, it appears to be a wash or small loss,
+	 * so we needn't bother to try to distinguish the sub-architectures.
+	 */
+	__asm__ __volatile__(
+		"	lock			\n"
+		"	xchgb	%0,%1	\n"
+:		"+q"(_res), "+m"(*lock)
+:
+:		"memory", "cc");
+	return (int) _res;
+}
+
+#define SPIN_DELAY() spin_delay()
+
+static __inline__ void
+spin_delay(void)
+{
+	/*
+	 * Adding a PAUSE in the spin delay loop is demonstrably a no-op on
+	 * Opteron, but it may be of some use on EM64T, so we keep it.
+	 */
+	__asm__ __volatile__(
+		" rep; nop			\n");
+}
+
+#endif	 /* __x86_64__ */
+
+
+#if defined(__ia64__) || defined(__ia64)	/* Intel Itanium */
+#define HAS_TEST_AND_SET
+
+typedef unsigned int slock_t;
+
+#define TAS(lock) tas(lock)
+
+#ifndef __INTEL_COMPILER
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	long int	ret;
+
+	__asm__ __volatile__(
+		"	xchg4 	%0=%1,%2	\n"
+:		"=r"(ret), "+m"(*lock)
+:		"r"(1)
+:		"memory");
+	return (int) ret;
+}
+
+#else /* __INTEL_COMPILER */
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	int		ret;
+
+	ret = _InterlockedExchange(lock,1);	/* this is a xchg asm macro */
+
+	return ret;
+}
+
+#endif /* __INTEL_COMPILER */
+#endif	 /* __ia64__ || __ia64 */
+
+
+#if defined(__arm__) || defined(__arm)
+#define HAS_TEST_AND_SET
+
+typedef unsigned char slock_t;
+
+#define TAS(lock) tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	register slock_t _res = 1;
+
+	__asm__ __volatile__(
+		"	swpb 	%0, %0, [%2]	\n"
+:		"+r"(_res), "+m"(*lock)
+:		"r"(lock)
+:		"memory");
+	return (int) _res;
+}
+
+#endif	 /* __arm__ */
+
+
+/* S/390 and S/390x Linux (32- and 64-bit zSeries) */
+#if defined(__s390__) || defined(__s390x__)
+#define HAS_TEST_AND_SET
+
+typedef unsigned int slock_t;
+
+#define TAS(lock)	   tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	int			_res = 0;
+
+	__asm__	__volatile__(
+		"	cs 	%0,%3,0(%2)		\n"
+:		"+d"(_res), "+m"(*lock)
+:		"a"(lock), "d"(1)
+:		"memory", "cc");
+	return _res;
+}
+
+#endif	 /* __s390__ || __s390x__ */
+
+
+#if defined(__sparc__)		/* Sparc */
+#define HAS_TEST_AND_SET
+
+typedef unsigned char slock_t;
+
+#define TAS(lock) tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	register slock_t _res;
+
+	/*
+	 *	See comment in /pg/backend/port/tas/solaris_sparc.s for why this
+	 *	uses "ldstub", and that file uses "cas".  gcc currently generates
+	 *	sparcv7-targeted binaries, so "cas" use isn't possible.
+	 */
+	__asm__ __volatile__(
+		"	ldstub	[%2], %0	\n"
+:		"=r"(_res), "+m"(*lock)
+:		"r"(lock)
+:		"memory");
+	return (int) _res;
+}
+
+#endif	 /* __sparc__ */
+
+
+/* PowerPC */
+#if defined(__ppc__) || defined(__powerpc__) || defined(__ppc64__) || defined(__powerpc64__)
+#define HAS_TEST_AND_SET
+
+#if defined(__ppc64__) || defined(__powerpc64__)
+typedef unsigned long slock_t;
+#else
+typedef unsigned int slock_t;
+#endif
+
+#define TAS(lock) tas(lock)
+/*
+ * NOTE: per the Enhanced PowerPC Architecture manual, v1.0 dated 7-May-2002,
+ * an isync is a sufficient synchronization barrier after a lwarx/stwcx loop.
+ */
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	slock_t _t;
+	int _res;
+
+	__asm__ __volatile__(
+"	lwarx   %0,0,%3		\n"
+"	cmpwi   %0,0		\n"
+"	bne     1f			\n"
+"	addi    %0,%0,1		\n"
+"	stwcx.  %0,0,%3		\n"
+"	beq     2f         	\n"
+"1:	li      %1,1		\n"
+"	b		3f			\n"
+"2:						\n"
+"	isync				\n"
+"	li      %1,0		\n"
+"3:						\n"
+
+:	"=&r"(_t), "=r"(_res), "+m"(*lock)
+:	"r"(lock)
+:	"memory", "cc");
+	return _res;
+}
+
+/* PowerPC S_UNLOCK is almost standard but requires a "sync" instruction */
+#define S_UNLOCK(lock)	\
+do \
+{ \
+	__asm__ __volatile__ ("	sync \n"); \
+	*((volatile slock_t *) (lock)) = 0; \
+} while (0)
+
+#endif /* powerpc */
+
+
+/* Linux Motorola 68k */
+#if (defined(__mc68000__) || defined(__m68k__)) && defined(__linux__)
+#define HAS_TEST_AND_SET
+
+typedef unsigned char slock_t;
+
+#define TAS(lock) tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	register int rv;
+
+	__asm__	__volatile__(
+		"	clrl	%0		\n"
+		"	tas		%1		\n"
+		"	sne		%0		\n"
+:		"=d"(rv), "+m"(*lock)
+:
+:		"memory", "cc");
+	return rv;
+}
+
+#endif	 /* (__mc68000__ || __m68k__) && __linux__ */
+
+
+/*
+ * VAXen -- even multiprocessor ones
+ * (thanks to Tom Ivar Helbekkmo)
+ */
+#if defined(__vax__)
+#define HAS_TEST_AND_SET
+
+typedef unsigned char slock_t;
+
+#define TAS(lock) tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	register int	_res;
+
+	__asm__ __volatile__(
+		"	movl 	$1, %0			\n"
+		"	bbssi	$0, (%2), 1f	\n"
+		"	clrl	%0				\n"
+		"1: \n"
+:		"=&r"(_res), "+m"(*lock)
+:		"r"(lock)
+:		"memory");
+	return _res;
+}
+
+#endif	 /* __vax__ */
+
+
+#if defined(__ns32k__)		/* National Semiconductor 32K */
+#define HAS_TEST_AND_SET
+
+typedef unsigned char slock_t;
+
+#define TAS(lock) tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	register int	_res;
+
+	__asm__ __volatile__(
+		"	sbitb	0, %1	\n"
+		"	sfsd	%0		\n"
+:		"=r"(_res), "+m"(*lock)
+:
+:		"memory");
+	return _res;
+}
+
+#endif	 /* __ns32k__ */
+
+
+#if defined(__alpha) || defined(__alpha__)	/* Alpha */
+/*
+ * Correct multi-processor locking methods are explained in section 5.5.3
+ * of the Alpha AXP Architecture Handbook, which at this writing can be
+ * found at ftp://ftp.netbsd.org/pub/NetBSD/misc/dec-docs/index.html.
+ * For gcc we implement the handbook's code directly with inline assembler.
+ */
+#define HAS_TEST_AND_SET
+
+typedef unsigned long slock_t;
+
+#define TAS(lock)  tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	register slock_t _res;
+
+	__asm__	__volatile__(
+		"	ldq		$0, %1	\n"
+		"	bne		$0, 2f	\n"
+		"	ldq_l	%0, %1	\n"
+		"	bne		%0, 2f	\n"
+		"	mov		1,  $0	\n"
+		"	stq_c	$0, %1	\n"
+		"	beq		$0, 2f	\n"
+		"	mb				\n"
+		"	br		3f		\n"
+		"2:	mov		1, %0	\n"
+		"3:					\n"
+:		"=&r"(_res), "+m"(*lock)
+:
+:		"memory", "0");
+	return (int) _res;
+}
+
+#define S_UNLOCK(lock)	\
+do \
+{\
+	__asm__ __volatile__ ("	mb \n"); \
+	*((volatile slock_t *) (lock)) = 0; \
+} while (0)
+
+#endif /* __alpha || __alpha__ */
+
+
+#if defined(__mips__) && !defined(__sgi)	/* non-SGI MIPS */
+/* Note: on SGI we use the OS' mutex ABI, see below */
+/* Note: R10000 processors require a separate SYNC */
+#define HAS_TEST_AND_SET
+
+typedef unsigned int slock_t;
+
+#define TAS(lock) tas(lock)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	register volatile slock_t *_l = lock;
+	register int _res;
+	register int _tmp;
+
+	__asm__ __volatile__(
+		"       .set push           \n"
+		"       .set mips2          \n"
+		"       .set noreorder      \n"
+		"       .set nomacro        \n"
+		"       ll      %0, %2      \n"
+		"       or      %1, %0, 1   \n"
+		"       sc      %1, %2      \n"
+		"       xori    %1, 1       \n"
+		"       or      %0, %0, %1  \n"
+		"       sync                \n"
+		"       .set pop              "
+:		"=&r" (_res), "=&r" (_tmp), "+R" (*_l)
+:
+:		"memory");
+	return _res;
+}
+
+/* MIPS S_UNLOCK is almost standard but requires a "sync" instruction */
+#define S_UNLOCK(lock)	\
+do \
+{ \
+	__asm__ __volatile__( \
+		"       .set push           \n" \
+		"       .set mips2          \n" \
+		"       .set noreorder      \n" \
+		"       .set nomacro        \n" \
+		"       sync                \n" \
+		"       .set pop              "); \
+	*((volatile slock_t *) (lock)) = 0; \
+} while (0)
+
+#endif /* __mips__ && !__sgi */
+
+
+/* These live in s_lock.c, but only for gcc */
+
+
+#if defined(__m68k__) && !defined(__linux__)	/* non-Linux Motorola 68k */
+#define HAS_TEST_AND_SET
+
+typedef unsigned char slock_t;
+#endif
+
+
+#endif	/* __GNUC__ */
+
+
+
+/*
+ * ---------------------------------------------------------------------
+ * Platforms that use non-gcc inline assembly:
+ * ---------------------------------------------------------------------
+ */
+
+#if !defined(HAS_TEST_AND_SET)	/* We didn't trigger above, let's try here */
+
+
+#if defined(USE_UNIVEL_CC)		/* Unixware compiler */
+#define HAS_TEST_AND_SET
+
+typedef unsigned char slock_t;
+
+#define TAS(lock)	tas(lock)
+
+asm int
+tas(volatile slock_t *s_lock)
+{
+/* UNIVEL wants %mem in column 1, so we don't pg_indent this file */
+%mem s_lock
+	pushl %ebx
+	movl s_lock, %ebx
+	movl $255, %eax
+	lock
+	xchgb %al, (%ebx)
+	popl %ebx
+}
+
+#endif	 /* defined(USE_UNIVEL_CC) */
+
+
+#if defined(__alpha) || defined(__alpha__)	/* Tru64 Unix Alpha compiler */
+/*
+ * The Tru64 compiler doesn't support gcc-style inline asm, but it does
+ * have some builtin functions that accomplish much the same results.
+ * For simplicity, slock_t is defined as long (ie, quadword) on Alpha
+ * regardless of the compiler in use.  LOCK_LONG and UNLOCK_LONG only
+ * operate on an int (ie, longword), but that's OK as long as we define
+ * S_INIT_LOCK to zero out the whole quadword.
+ */
+#define HAS_TEST_AND_SET
+
+typedef unsigned long slock_t;
+
+#include <alpha/builtins.h>
+#define S_INIT_LOCK(lock)  (*(lock) = 0)
+#define TAS(lock)		   (__LOCK_LONG_RETRY((lock), 1) == 0)
+#define S_UNLOCK(lock)	   __UNLOCK_LONG(lock)
+
+#endif	 /* __alpha || __alpha__ */
+
+
+#if defined(__hppa) || defined(__hppa__)	/* HP PA-RISC, GCC and HP compilers */
+/*
+ * HP's PA-RISC
+ *
+ * See src/backend/port/hpux/tas.c.template for details about LDCWX.  Because
+ * LDCWX requires a 16-byte-aligned address, we declare slock_t as a 16-byte
+ * struct.  The active word in the struct is whichever has the aligned address;
+ * the other three words just sit at -1.
+ *
+ * When using gcc, we can inline the required assembly code.
+ */
+#define HAS_TEST_AND_SET
+
+typedef struct
+{
+	int			sema[4];
+} slock_t;
+
+#define TAS_ACTIVE_WORD(lock)	((volatile int *) (((long) (lock) + 15) & ~15))
+
+#if defined(__GNUC__)
+
+static __inline__ int
+tas(volatile slock_t *lock)
+{
+	volatile int *lockword = TAS_ACTIVE_WORD(lock);
+	register int lockval;
+
+	__asm__ __volatile__(
+		"	ldcwx	0(0,%2),%0	\n"
+:		"=r"(lockval), "+m"(*lockword)
+:		"r"(lockword)
+:		"memory");
+	return (lockval == 0);
+}
+
+#endif /* __GNUC__ */
+
+#define S_UNLOCK(lock)	(*TAS_ACTIVE_WORD(lock) = -1)
+
+#define S_INIT_LOCK(lock) \
+	do { \
+		volatile slock_t *lock_ = (lock); \
+		lock_->sema[0] = -1; \
+		lock_->sema[1] = -1; \
+		lock_->sema[2] = -1; \
+		lock_->sema[3] = -1; \
+	} while (0)
+
+#define S_LOCK_FREE(lock)	(*TAS_ACTIVE_WORD(lock) != 0)
+
+#endif	 /* __hppa || __hppa__ */
+
+
+#if defined(__hpux) && defined(__ia64) && !defined(__GNUC__)
+
+#define HAS_TEST_AND_SET
+
+typedef unsigned int slock_t;
+
+#include <ia64/sys/inline.h>
+#define TAS(lock) _Asm_xchg(_SZ_W, lock, 1, _LDHINT_NONE)
+
+#endif	/* HPUX on IA64, non gcc */
+
+
+#if defined(__sgi)	/* SGI compiler */
+/*
+ * SGI IRIX 5
+ * slock_t is defined as a unsigned long. We use the standard SGI
+ * mutex API.
+ *
+ * The following comment is left for historical reasons, but is probably
+ * not a good idea since the mutex ABI is supported.
+ *
+ * This stuff may be supplemented in the future with Masato Kataoka's MIPS-II
+ * assembly from his NECEWS SVR4 port, but we probably ought to retain this
+ * for the R3000 chips out there.
+ */
+#define HAS_TEST_AND_SET
+
+typedef unsigned long slock_t;
+
+#include "mutex.h"
+#define TAS(lock)	(test_and_set(lock,1))
+#define S_UNLOCK(lock)	(test_then_and(lock,0))
+#define S_INIT_LOCK(lock)	(test_then_and(lock,0))
+#define S_LOCK_FREE(lock)	(test_then_add(lock,0) == 0)
+#endif	 /* __sgi */
+
+
+#if defined(sinix)		/* Sinix */
+/*
+ * SINIX / Reliant UNIX
+ * slock_t is defined as a struct abilock_t, which has a single unsigned long
+ * member. (Basically same as SGI)
+ */
+#define HAS_TEST_AND_SET
+
+#include "abi_mutex.h"
+typedef abilock_t slock_t;
+
+#define TAS(lock)	(!acquire_lock(lock))
+#define S_UNLOCK(lock)	release_lock(lock)
+#define S_INIT_LOCK(lock)	init_lock(lock)
+#define S_LOCK_FREE(lock)	(stat_lock(lock) == UNLOCKED)
+#endif	 /* sinix */
+
+
+#if defined(_AIX)	/* AIX */
+/*
+ * AIX (POWER)
+ */
+#define HAS_TEST_AND_SET
+
+typedef unsigned int slock_t;
+
+#define TAS(lock)			_check_lock(lock, 0, 1)
+#define S_UNLOCK(lock)		_clear_lock(lock, 0)
+#endif	 /* _AIX */
+
+
+#if defined (nextstep)		/* Nextstep */
+#define HAS_TEST_AND_SET
+
+typedef struct mutex slock_t;
+
+#define APC_SLOCK_NONBLOCKING_LOCK_AVAILABLE 0  /* -- APC: non-blocking lock not available in this case -- */
+
+#define S_LOCK(lock)	mutex_lock(lock)
+#define S_UNLOCK(lock)	mutex_unlock(lock)
+#define S_INIT_LOCK(lock)	mutex_init(lock)
+/* For Mach, we have to delve inside the entrails of `struct mutex'.  Ick! */
+#define S_LOCK_FREE(alock)	((alock)->lock == 0)
+#endif	 /* nextstep */
+
+
+/* These are in s_lock.c */
+
+
+#if defined(sun3)		/* Sun3 */
+#define HAS_TEST_AND_SET
+
+typedef unsigned char slock_t;
+#endif
+
+
+#if defined(__sun) && (defined(__i386) || defined(__x86_64__) || defined(__sparc__) || defined(__sparc))
+#define HAS_TEST_AND_SET
+
+#if defined(__i386) || defined(__x86_64__) || defined(__sparcv9) || defined(__sparcv8plus)
+typedef unsigned int slock_t;
+#else
+typedef unsigned char slock_t;
+#endif
+
+extern slock_t pg_atomic_cas(volatile slock_t *lock, slock_t with,
+									  slock_t cmp);
+
+#define TAS(a) (pg_atomic_cas((a), 1, 0) != 0)
+#endif
+
+
+#ifdef WIN32_ONLY_COMPILER
+typedef LONG slock_t;
+
+#define HAS_TEST_AND_SET
+#define TAS(lock) (InterlockedCompareExchange(lock, 1, 0))
+
+#define SPIN_DELAY() spin_delay()
+
+static __forceinline void
+spin_delay(void)
+{
+	/* See comment for gcc code. Same code, MASM syntax */
+	__asm rep nop;
+}
+
+#endif
+
+  
+#endif	/* !defined(HAS_TEST_AND_SET) */
+
+
+/* Blow up if we didn't have any way to do spinlocks */
+#ifndef HAS_TEST_AND_SET
+/* -- APC: We have better options in APC than this, that should be specified explicitly so just fail out and notify the user -- */
+#error Spin locking is not available on your platform, please select another locking method (see ./configure --help).
+/* #error PostgreSQL does not have native spinlock support on this platform.  To continue the compilation, rerun configure using --disable-spinlocks.  However, performance will be poor.  Please report this to pgsql-bugs@postgresql.org. */ 
+#endif
+
+
+#else	/* !HAVE_SPINLOCKS */
+
+
+/*
+ * Fake spinlock implementation using semaphores --- slow and prone
+ * to fall foul of kernel limits on number of semaphores, so don't use this
+ * unless you must!  The subroutines appear in spin.c.
+ */
+
+/* -- Removed for APC
+typedef PGSemaphoreData slock_t;
+
+extern bool s_lock_free_sema(volatile slock_t *lock);
+extern void s_unlock_sema(volatile slock_t *lock);
+extern void s_init_lock_sema(volatile slock_t *lock);
+extern int	tas_sema(volatile slock_t *lock);
+
+#define S_LOCK_FREE(lock)	s_lock_free_sema(lock)
+#define S_UNLOCK(lock)	 s_unlock_sema(lock)
+#define S_INIT_LOCK(lock)	s_init_lock_sema(lock)
+#define TAS(lock)	tas_sema(lock)
+*/
+
+#endif	/* HAVE_SPINLOCKS */
+
+
+/*
+ * Default Definitions - override these above as needed.
+ */
+
+#define APC_SLOCK_NONBLOCKING_LOCK_AVAILABLE 1 /* -- APC: Non-blocking lock available for this case -- */
+
+#if !defined(S_LOCK)
+#define S_LOCK(lock) \
+	do { \
+		if (TAS(lock)) \
+			s_lock((lock), __FILE__, __LINE__ TSRMLS_CC); \
+	} while (0)
+#endif	 /* S_LOCK */
+
+#if !defined(S_LOCK_FREE)
+#define S_LOCK_FREE(lock)	(*(lock) == 0)
+#endif	 /* S_LOCK_FREE */
+
+#if !defined(S_UNLOCK)
+#define S_UNLOCK(lock)		(*((volatile slock_t *) (lock)) = 0)
+#endif	 /* S_UNLOCK */
+
+#if !defined(S_INIT_LOCK)
+#define S_INIT_LOCK(lock)	S_UNLOCK(lock)
+#endif	 /* S_INIT_LOCK */
+
+#if !defined(SPIN_DELAY)
+#define SPIN_DELAY()	((void) 0)
+#endif	 /* SPIN_DELAY */
+
+#if !defined(TAS)
+extern int	tas(volatile slock_t *lock);		/* in port/.../tas.s, or
+												 * s_lock.c */
+
+#define TAS(lock)		tas(lock)
+#endif	 /* TAS */
+
+
+/*
+ * Platform-independent out-of-line support routines
+ */
+extern void s_lock(volatile slock_t *lock, const char *file, int line TSRMLS_DC);
+
+/* Support for dynamic adjustment of spins_per_delay */
+#define DEFAULT_SPINS_PER_DELAY  100
+
+#if 0  /* -- Removed from APC use -- */
+extern void set_spins_per_delay(int shared_spins_per_delay);
+extern int	update_spins_per_delay(int shared_spins_per_delay);
+#endif
+
+#endif	 /* S_LOCK_H */
diff -Nru php-5.4.19/ext/apc/php_apc.c php-5.4.19.bak/ext/apc/php_apc.c
--- php-5.4.19/ext/apc/php_apc.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/php_apc.c	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,1721 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: php_apc.c 327136 2012-08-15 16:41:18Z laruence $ */
+
+#include "apc_zend.h"
+#include "apc_cache.h"
+#include "apc_iterator.h"
+#include "apc_main.h"
+#include "apc_sma.h"
+#include "apc_lock.h"
+#include "apc_bin.h"
+#include "php_globals.h"
+#include "php_ini.h"
+#include "ext/standard/info.h"
+#include "ext/standard/file.h"
+#include "ext/standard/flock_compat.h"
+#ifdef HAVE_SYS_FILE_H
+#include <sys/file.h>
+#endif
+#include "SAPI.h"
+#include "rfc1867.h"
+#include "php_apc.h"
+#include "ext/standard/md5.h"
+
+#if HAVE_SIGACTION
+#include "apc_signal.h"
+#endif
+
+/* {{{ PHP_FUNCTION declarations */
+PHP_FUNCTION(apc_cache_info);
+PHP_FUNCTION(apc_clear_cache);
+PHP_FUNCTION(apc_sma_info);
+PHP_FUNCTION(apc_store);
+PHP_FUNCTION(apc_fetch);
+PHP_FUNCTION(apc_delete);
+PHP_FUNCTION(apc_delete_file);
+PHP_FUNCTION(apc_compile_file);
+PHP_FUNCTION(apc_define_constants);
+PHP_FUNCTION(apc_load_constants);
+PHP_FUNCTION(apc_add);
+PHP_FUNCTION(apc_inc);
+PHP_FUNCTION(apc_dec);
+PHP_FUNCTION(apc_cas);
+PHP_FUNCTION(apc_bin_dump);
+PHP_FUNCTION(apc_bin_load);
+PHP_FUNCTION(apc_bin_dumpfile);
+PHP_FUNCTION(apc_bin_loadfile);
+PHP_FUNCTION(apc_exists);
+/* }}} */
+
+/* {{{ ZEND_DECLARE_MODULE_GLOBALS(apc) */
+ZEND_DECLARE_MODULE_GLOBALS(apc)
+
+/* True globals */
+apc_cache_t* apc_cache = NULL;
+apc_cache_t* apc_user_cache = NULL;
+
+static void php_apc_init_globals(zend_apc_globals* apc_globals TSRMLS_DC)
+{
+    apc_globals->filters = NULL;
+    apc_globals->compiled_filters = NULL;
+    apc_globals->initialized = 0;
+    apc_globals->cache_stack = apc_stack_create(0 TSRMLS_CC);
+    apc_globals->cache_by_default = 1;
+    apc_globals->fpstat = 1;
+    apc_globals->canonicalize = 1;
+    apc_globals->stat_ctime = 0;
+    apc_globals->write_lock = 1;
+    apc_globals->slam_defense = 1;
+    apc_globals->report_autofilter = 0;
+    apc_globals->include_once = 0;
+    apc_globals->apc_optimize_function = NULL;
+#ifdef MULTIPART_EVENT_FORMDATA
+    apc_globals->rfc1867 = 0;
+    memset(&(apc_globals->rfc1867_data), 0, sizeof(apc_rfc1867_data));
+#endif
+    memset(&apc_globals->copied_zvals, 0, sizeof(HashTable));
+    apc_globals->force_file_update = 0;
+    apc_globals->coredump_unmap = 0;
+    apc_globals->preload_path = NULL;
+    apc_globals->use_request_time = 1;
+    apc_globals->lazy_class_table = NULL;
+    apc_globals->lazy_function_table = NULL;
+    apc_globals->serializer_name = NULL;
+    apc_globals->serializer = NULL;
+}
+
+static void php_apc_shutdown_globals(zend_apc_globals* apc_globals TSRMLS_DC)
+{
+    /* deallocate the ignore patterns */
+    if (apc_globals->filters != NULL) {
+        int i;
+        for (i=0; apc_globals->filters[i] != NULL; i++) {
+            apc_efree(apc_globals->filters[i] TSRMLS_CC);
+        }
+        apc_efree(apc_globals->filters TSRMLS_CC);
+    }
+
+    /* the stack should be empty */
+    assert(apc_stack_size(apc_globals->cache_stack) == 0);
+
+    /* apc cleanup */
+    apc_stack_destroy(apc_globals->cache_stack TSRMLS_CC);
+
+    /* the rest of the globals are cleaned up in apc_module_shutdown() */
+}
+
+static long apc_atol(const char *str, int str_len)
+{
+#if PHP_MAJOR_VERSION >= 6 || PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION >= 3
+    return zend_atol(str, str_len);
+#else
+    /* Re-implement zend_atol() for 5.2.x */
+    long retval;
+
+    if (!str_len) {
+        str_len = strlen(str);
+    }
+
+    retval = strtol(str, NULL, 0);
+
+    if (str_len > 0) {
+        switch (str[str_len - 1]) {
+            case 'g':
+            case 'G':
+                retval *= 1024;
+                /* break intentionally missing */
+            case 'm':
+            case 'M':
+                retval *= 1024;
+                /* break intentionally missing */
+            case 'k':
+            case 'K':
+                retval *= 1024;
+                break;
+        }
+    }
+
+    return retval;
+#endif
+}
+
+/* }}} */
+
+/* {{{ PHP_INI */
+
+static PHP_INI_MH(OnUpdate_filters) /* {{{ */
+{
+    APCG(filters) = apc_tokenize(new_value, ',' TSRMLS_CC);
+    return SUCCESS;
+}
+/* }}} */
+
+static PHP_INI_MH(OnUpdateShmSegments) /* {{{ */
+{
+#if APC_MMAP
+    if(zend_atoi(new_value, new_value_length)!=1) {
+        php_error_docref(NULL TSRMLS_CC, E_WARNING, "apc.shm_segments setting ignored in MMAP mode");
+    }
+    APCG(shm_segments) = 1;
+#else
+    APCG(shm_segments) = zend_atoi(new_value, new_value_length);
+#endif
+    return SUCCESS;
+}
+/* }}} */
+
+static PHP_INI_MH(OnUpdateShmSize) /* {{{ */
+{
+    long s = apc_atol(new_value, new_value_length);
+
+    if(s <= 0) {
+        return FAILURE;
+    }
+
+    if(s < 1048576L) {
+        /* if it's less than 1Mb, they are probably using the old syntax */
+        php_error_docref(NULL TSRMLS_CC, E_WARNING, "apc.shm_size now uses M/G suffixes, please update your ini files");
+        s = s * 1048576L;
+    }
+
+    APCG(shm_size) = s;
+
+    return SUCCESS;
+}
+/* }}} */
+
+#ifdef MULTIPART_EVENT_FORMDATA
+static PHP_INI_MH(OnUpdateRfc1867Freq) /* {{{ */
+{
+    int tmp;
+    tmp = zend_atoi(new_value, new_value_length);
+    if(tmp < 0) {
+        apc_error("rfc1867_freq must be greater than or equal to zero." TSRMLS_CC);
+        return FAILURE;
+    }
+    if(new_value[new_value_length-1] == '%') {
+        if(tmp > 100) {
+            apc_error("rfc1867_freq cannot be over 100%%" TSRMLS_CC);
+            return FAILURE;
+        }
+        APCG(rfc1867_freq) = tmp / 100.0;
+    } else {
+        APCG(rfc1867_freq) = tmp;
+    }
+    return SUCCESS;
+}
+/* }}} */
+#endif
+
+PHP_INI_BEGIN()
+STD_PHP_INI_BOOLEAN("apc.enabled",      "1",    PHP_INI_SYSTEM, OnUpdateBool,              enabled,         zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.shm_segments",   "1",    PHP_INI_SYSTEM, OnUpdateShmSegments,       shm_segments,    zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.shm_size",       "32M",  PHP_INI_SYSTEM, OnUpdateShmSize,           shm_size,        zend_apc_globals, apc_globals)
+#ifdef ZEND_ENGINE_2_4
+STD_PHP_INI_ENTRY("apc.shm_strings_buffer", "4M",   PHP_INI_SYSTEM, OnUpdateLong,           shm_strings_buffer,        zend_apc_globals, apc_globals)
+#endif
+STD_PHP_INI_BOOLEAN("apc.include_once_override", "0", PHP_INI_SYSTEM, OnUpdateBool,     include_once,    zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.num_files_hint", "1000", PHP_INI_SYSTEM, OnUpdateLong,            num_files_hint,  zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.user_entries_hint", "4096", PHP_INI_SYSTEM, OnUpdateLong,          user_entries_hint, zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.gc_ttl",         "3600", PHP_INI_SYSTEM, OnUpdateLong,            gc_ttl,           zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.ttl",            "0",    PHP_INI_SYSTEM, OnUpdateLong,            ttl,              zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.user_ttl",       "0",    PHP_INI_SYSTEM, OnUpdateLong,            user_ttl,         zend_apc_globals, apc_globals)
+#if APC_MMAP
+STD_PHP_INI_ENTRY("apc.mmap_file_mask",  NULL,  PHP_INI_SYSTEM, OnUpdateString,         mmap_file_mask,   zend_apc_globals, apc_globals)
+#endif
+PHP_INI_ENTRY("apc.filters",        NULL,     PHP_INI_SYSTEM, OnUpdate_filters)
+STD_PHP_INI_BOOLEAN("apc.cache_by_default", "1",  PHP_INI_ALL, OnUpdateBool,         cache_by_default, zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.file_update_protection", "2", PHP_INI_SYSTEM, OnUpdateLong,file_update_protection,  zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.enable_cli", "0",      PHP_INI_SYSTEM, OnUpdateBool,           enable_cli,       zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.max_file_size", "1M",    PHP_INI_SYSTEM, OnUpdateLong,            max_file_size,    zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.stat", "1",            PHP_INI_SYSTEM, OnUpdateBool,           fpstat,           zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.canonicalize", "1",    PHP_INI_SYSTEM, OnUpdateBool,           canonicalize,     zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.stat_ctime", "0",      PHP_INI_SYSTEM, OnUpdateBool,           stat_ctime,       zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.write_lock", "1",      PHP_INI_SYSTEM, OnUpdateBool,           write_lock,       zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.slam_defense", "1",    PHP_INI_SYSTEM, OnUpdateBool,           slam_defense,     zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.report_autofilter", "0", PHP_INI_SYSTEM, OnUpdateBool,         report_autofilter,zend_apc_globals, apc_globals)
+#ifdef MULTIPART_EVENT_FORMDATA
+STD_PHP_INI_BOOLEAN("apc.rfc1867", "0", PHP_INI_SYSTEM, OnUpdateBool, rfc1867, zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.rfc1867_prefix", "upload_", PHP_INI_SYSTEM, OnUpdateStringUnempty, rfc1867_prefix, zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.rfc1867_name", "APC_UPLOAD_PROGRESS", PHP_INI_SYSTEM, OnUpdateStringUnempty, rfc1867_name, zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.rfc1867_freq", "0", PHP_INI_SYSTEM, OnUpdateRfc1867Freq, rfc1867_freq, zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.rfc1867_ttl", "3600", PHP_INI_SYSTEM, OnUpdateLong, rfc1867_ttl, zend_apc_globals, apc_globals)
+#endif
+STD_PHP_INI_BOOLEAN("apc.coredump_unmap", "0", PHP_INI_SYSTEM, OnUpdateBool, coredump_unmap, zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.preload_path", (char*)NULL,              PHP_INI_SYSTEM, OnUpdateString,       preload_path,  zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.file_md5", "0", PHP_INI_SYSTEM, OnUpdateBool, file_md5,  zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.use_request_time", "1", PHP_INI_ALL, OnUpdateBool, use_request_time,  zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.lazy_functions", "0", PHP_INI_SYSTEM, OnUpdateBool, lazy_functions, zend_apc_globals, apc_globals)
+STD_PHP_INI_BOOLEAN("apc.lazy_classes", "0", PHP_INI_SYSTEM, OnUpdateBool, lazy_classes, zend_apc_globals, apc_globals)
+STD_PHP_INI_ENTRY("apc.serializer", "default", PHP_INI_SYSTEM, OnUpdateStringUnempty, serializer_name, zend_apc_globals, apc_globals)
+PHP_INI_END()
+
+/* }}} */
+
+/* {{{ PHP_MINFO_FUNCTION(apc) */
+static PHP_MINFO_FUNCTION(apc)
+{
+    apc_serializer_t *serializer = NULL;
+    smart_str names = {0,};
+    int i;
+
+    php_info_print_table_start();
+    php_info_print_table_header(2, "APC Support", APCG(enabled) ? "enabled" : "disabled");
+    php_info_print_table_row(2, "Version", PHP_APC_VERSION);
+#ifdef __DEBUG_APC__
+    php_info_print_table_row(2, "APC Debugging", "Enabled");
+#else
+    php_info_print_table_row(2, "APC Debugging", "Disabled");
+#endif
+#if APC_MMAP
+    php_info_print_table_row(2, "MMAP Support", "Enabled");
+    php_info_print_table_row(2, "MMAP File Mask", APCG(mmap_file_mask));
+#else
+    php_info_print_table_row(2, "MMAP Support", "Disabled");
+#endif
+    php_info_print_table_row(2, "Locking type", APC_LOCK_TYPE);
+
+    for( i = 0, serializer = apc_get_serializers(TSRMLS_C); 
+                serializer->name != NULL; 
+                serializer++, i++) {
+        if(i != 0) smart_str_appends(&names, ", ");
+        smart_str_appends(&names, serializer->name);
+    }
+
+    if(names.c) {
+        smart_str_0(&names);
+        php_info_print_table_row(2, "Serialization Support", names.c);
+        smart_str_free(&names);
+    } else {
+        php_info_print_table_row(2, "Serialization Support", "broken");
+    }
+
+    php_info_print_table_row(2, "Revision", "$Revision: 327136 $");
+    php_info_print_table_row(2, "Build Date", __DATE__ " " __TIME__);
+    php_info_print_table_end();
+    DISPLAY_INI_ENTRIES();
+}
+/* }}} */
+
+#ifdef MULTIPART_EVENT_FORMDATA
+extern int apc_rfc1867_progress(unsigned int event, void *event_data, void **extra TSRMLS_DC);
+#endif
+
+/* {{{ PHP_MINIT_FUNCTION(apc) */
+static PHP_MINIT_FUNCTION(apc)
+{
+    ZEND_INIT_MODULE_GLOBALS(apc, php_apc_init_globals, php_apc_shutdown_globals);
+
+    REGISTER_INI_ENTRIES();
+
+    /* Disable APC in cli mode unless overridden by apc.enable_cli */
+    if(!APCG(enable_cli) && !strcmp(sapi_module.name, "cli")) {
+        APCG(enabled) = 0;
+    }
+
+    if (APCG(enabled)) {
+        if(APCG(initialized)) {
+            apc_process_init(module_number TSRMLS_CC);
+        } else {
+            apc_module_init(module_number TSRMLS_CC);
+            apc_zend_init(TSRMLS_C);
+            apc_process_init(module_number TSRMLS_CC);
+#ifdef MULTIPART_EVENT_FORMDATA
+            /* File upload progress tracking */
+            if(APCG(rfc1867)) {
+                php_rfc1867_callback = apc_rfc1867_progress;
+            }
+#endif
+            apc_iterator_init(module_number TSRMLS_CC);
+        }
+
+        zend_register_long_constant("APC_BIN_VERIFY_MD5", sizeof("APC_BIN_VERIFY_MD5"), APC_BIN_VERIFY_MD5, (CONST_CS | CONST_PERSISTENT), module_number TSRMLS_CC);
+        zend_register_long_constant("APC_BIN_VERIFY_CRC32", sizeof("APC_BIN_VERIFY_CRC32"), APC_BIN_VERIFY_CRC32, (CONST_CS | CONST_PERSISTENT), module_number TSRMLS_CC);
+    }
+
+    return SUCCESS;
+}
+/* }}} */
+
+/* {{{ PHP_MSHUTDOWN_FUNCTION(apc) */
+static PHP_MSHUTDOWN_FUNCTION(apc)
+{
+    if(APCG(enabled)) {
+        apc_process_shutdown(TSRMLS_C);
+        apc_zend_shutdown(TSRMLS_C);
+        apc_module_shutdown(TSRMLS_C);
+#ifndef ZTS
+        php_apc_shutdown_globals(&apc_globals);
+#endif
+#if HAVE_SIGACTION
+        apc_shutdown_signals(TSRMLS_C);
+#endif
+    }
+#ifdef ZTS
+    ts_free_id(apc_globals_id);
+#endif
+    UNREGISTER_INI_ENTRIES();
+    return SUCCESS;
+}
+/* }}} */
+
+/* {{{ PHP_RINIT_FUNCTION(apc) */
+static PHP_RINIT_FUNCTION(apc)
+{
+    if(APCG(enabled)) {
+        apc_request_init(TSRMLS_C);
+
+#if HAVE_SIGACTION
+        apc_set_signals(TSRMLS_C);
+#endif
+    }
+    return SUCCESS;
+}
+/* }}} */
+
+/* {{{ PHP_RSHUTDOWN_FUNCTION(apc) */
+static PHP_RSHUTDOWN_FUNCTION(apc)
+{
+    if(APCG(enabled)) {
+        apc_request_shutdown(TSRMLS_C);
+    }
+    return SUCCESS;
+}
+/* }}} */
+
+/* {{{ proto array apc_cache_info([string type [, bool limited]]) */
+PHP_FUNCTION(apc_cache_info)
+{
+    zval* info;
+    char *cache_type;
+    int ct_len;
+    zend_bool limited = 0;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|sb", &cache_type, &ct_len, &limited) == FAILURE) {
+        return;
+    }
+
+    if(ZEND_NUM_ARGS()) {
+        if(!strcasecmp(cache_type,"user")) {
+            info = apc_cache_info(apc_user_cache, limited TSRMLS_CC);
+        } else if(!strcasecmp(cache_type,"filehits")) {
+#ifdef APC_FILEHITS
+            RETVAL_ZVAL(APCG(filehits), 1, 0);
+            return;
+#else
+            RETURN_FALSE;
+#endif
+        } else {
+            info = apc_cache_info(apc_cache, limited TSRMLS_CC);
+        }
+    } else {
+        info = apc_cache_info(apc_cache, limited TSRMLS_CC);
+    }
+
+    if(!info) {
+        php_error_docref(NULL TSRMLS_CC, E_WARNING, "No APC info available.  Perhaps APC is not enabled? Check apc.enabled in your ini file");
+        RETURN_FALSE;
+    }
+
+    RETURN_ZVAL(info, 0, 1);
+
+}
+/* }}} */
+
+/* {{{ proto void apc_clear_cache([string cache]) */
+PHP_FUNCTION(apc_clear_cache)
+{
+    char *cache_type;
+    int ct_len = 0;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|s", &cache_type, &ct_len) == FAILURE) {
+        return;
+    }
+
+    if(ct_len) {
+        if(!strcasecmp(cache_type, "user")) {
+            apc_cache_clear(apc_user_cache TSRMLS_CC);
+            RETURN_TRUE;
+        }
+    }
+    apc_cache_clear(apc_cache TSRMLS_CC);
+    RETURN_TRUE;
+}
+/* }}} */
+
+/* {{{ proto array apc_sma_info([bool limited]) */
+PHP_FUNCTION(apc_sma_info)
+{
+    apc_sma_info_t* info;
+    zval* block_lists;
+    int i;
+    zend_bool limited = 0;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|b", &limited) == FAILURE) {
+        return;
+    }
+
+    info = apc_sma_info(limited TSRMLS_CC);
+
+    if(!info) {
+        php_error_docref(NULL TSRMLS_CC, E_WARNING, "No APC SMA info available.  Perhaps APC is disabled via apc.enabled?");
+        RETURN_FALSE;
+    }
+
+    array_init(return_value);
+    add_assoc_long(return_value, "num_seg", info->num_seg);
+    add_assoc_double(return_value, "seg_size", (double)info->seg_size);
+    add_assoc_double(return_value, "avail_mem", (double)apc_sma_get_avail_mem());
+
+    if(limited) {
+        apc_sma_free_info(info TSRMLS_CC);
+        return;
+    }
+
+#if ALLOC_DISTRIBUTION
+    {
+        size_t *adist = apc_sma_get_alloc_distribution();
+        zval* list;
+        ALLOC_INIT_ZVAL(list);
+        array_init(list);
+        for(i=0; i<30; i++) {
+            add_next_index_long(list, adist[i]);
+        }
+        add_assoc_zval(return_value, "adist", list);
+    }
+#endif
+    ALLOC_INIT_ZVAL(block_lists);
+    array_init(block_lists);
+
+    for (i = 0; i < info->num_seg; i++) {
+        apc_sma_link_t* p;
+        zval* list;
+
+        ALLOC_INIT_ZVAL(list);
+        array_init(list);
+
+        for (p = info->list[i]; p != NULL; p = p->next) {
+            zval* link;
+
+            ALLOC_INIT_ZVAL(link);
+            array_init(link);
+
+            add_assoc_long(link, "size", p->size);
+            add_assoc_long(link, "offset", p->offset);
+            add_next_index_zval(list, link);
+        }
+        add_next_index_zval(block_lists, list);
+    }
+    add_assoc_zval(return_value, "block_lists", block_lists);
+    apc_sma_free_info(info TSRMLS_CC);
+}
+/* }}} */
+
+/* {{{ _apc_update  */
+int _apc_update(char *strkey, int strkey_len, apc_cache_updater_t updater, void* data TSRMLS_DC) 
+{
+    if(!APCG(enabled)) {
+        return 0;
+    }
+
+    if (!APCG(serializer) && APCG(serializer_name)) {
+        /* Avoid race conditions between MINIT of apc and serializer exts like igbinary */
+        APCG(serializer) = apc_find_serializer(APCG(serializer_name) TSRMLS_CC);
+    }
+
+    HANDLE_BLOCK_INTERRUPTIONS();
+    APCG(current_cache) = apc_user_cache;
+    
+    if (!_apc_cache_user_update(apc_user_cache, strkey, strkey_len + 1, updater, data TSRMLS_CC)) {
+        HANDLE_UNBLOCK_INTERRUPTIONS();
+        return 0;
+    }
+
+    APCG(current_cache) = NULL;
+    HANDLE_UNBLOCK_INTERRUPTIONS();
+
+    return 1;
+}
+/* }}} */
+    
+/* {{{ _apc_store */
+int _apc_store(char *strkey, int strkey_len, const zval *val, const unsigned int ttl, const int exclusive TSRMLS_DC) {
+    apc_cache_entry_t *entry;
+    apc_cache_key_t key;
+    time_t t;
+    apc_context_t ctxt={0,};
+    int ret = 1;
+
+    t = apc_time();
+
+    if(!APCG(enabled)) return 0;
+
+    if (!APCG(serializer) && APCG(serializer_name)) {
+        /* Avoid race conditions between MINIT of apc and serializer exts like igbinary */
+        APCG(serializer) = apc_find_serializer(APCG(serializer_name) TSRMLS_CC);
+    }
+
+    HANDLE_BLOCK_INTERRUPTIONS();
+
+    APCG(current_cache) = apc_user_cache;
+
+    ctxt.pool = apc_pool_create(APC_SMALL_POOL, apc_sma_malloc, apc_sma_free, apc_sma_protect, apc_sma_unprotect TSRMLS_CC);
+    if (!ctxt.pool) {
+        HANDLE_UNBLOCK_INTERRUPTIONS();
+        apc_warning("Unable to allocate memory for pool." TSRMLS_CC);
+        return 0;
+    }
+    ctxt.copy = APC_COPY_IN_USER;
+    ctxt.force_update = 0;
+
+    if(!ctxt.pool) {
+        ret = 0;
+        goto nocache;
+    }
+
+    if (!apc_cache_make_user_key(&key, strkey, strkey_len, t)) {
+        goto freepool;
+    }
+
+    if (apc_cache_is_last_key(apc_user_cache, &key, t TSRMLS_CC)) {
+        goto freepool;
+    }
+
+    if (!(entry = apc_cache_make_user_entry(strkey, strkey_len, val, &ctxt, ttl TSRMLS_CC))) {
+        goto freepool;
+    }
+
+    if (!apc_cache_user_insert(apc_user_cache, key, entry, &ctxt, t, exclusive TSRMLS_CC)) {
+freepool:
+        apc_pool_destroy(ctxt.pool TSRMLS_CC);
+        ret = 0;
+    }
+
+nocache:
+
+    APCG(current_cache) = NULL;
+
+    HANDLE_UNBLOCK_INTERRUPTIONS();
+
+    return ret;
+}
+/* }}} */
+
+/* {{{ apc_store_helper(INTERNAL_FUNCTION_PARAMETERS, const int exclusive)
+ */
+static void apc_store_helper(INTERNAL_FUNCTION_PARAMETERS, const int exclusive)
+{
+    zval *key = NULL;
+    zval *val = NULL;
+    long ttl = 0L;
+    HashTable *hash;
+    HashPosition hpos;
+    zval **hentry;
+    char *hkey=NULL;
+    uint hkey_len;
+    ulong hkey_idx;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "z|zl", &key, &val, &ttl) == FAILURE) {
+        return;
+    }
+
+    if (!key) RETURN_FALSE;
+
+    if (Z_TYPE_P(key) == IS_ARRAY) {
+        hash = Z_ARRVAL_P(key);
+        array_init(return_value);
+        zend_hash_internal_pointer_reset_ex(hash, &hpos);
+        while(zend_hash_get_current_data_ex(hash, (void**)&hentry, &hpos) == SUCCESS) {
+            zend_hash_get_current_key_ex(hash, &hkey, &hkey_len, &hkey_idx, 0, &hpos);
+            if (hkey) {
+                if(!_apc_store(hkey, hkey_len, *hentry, (unsigned int)ttl, exclusive TSRMLS_CC)) {
+                    add_assoc_long_ex(return_value, hkey, hkey_len, -1);  /* -1: insertion error */
+                }
+                hkey = NULL;
+            } else {
+                add_index_long(return_value, hkey_idx, -1);  /* -1: insertion error */
+            }
+            zend_hash_move_forward_ex(hash, &hpos);
+        }
+        return;
+    } else if (Z_TYPE_P(key) == IS_STRING) {
+        if (!val) RETURN_FALSE;
+        if(_apc_store(Z_STRVAL_P(key), Z_STRLEN_P(key) + 1, val, (unsigned int)ttl, exclusive TSRMLS_CC))
+            RETURN_TRUE;
+    } else {
+        apc_warning("apc_store expects key parameter to be a string or an array of key/value pairs." TSRMLS_CC);
+    }
+
+    RETURN_FALSE;
+}
+/* }}} */
+
+/* {{{ proto int apc_store(mixed key, mixed var [, long ttl ])
+ */
+PHP_FUNCTION(apc_store) {
+    apc_store_helper(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);
+}
+/* }}} */
+
+/* {{{ proto int apc_add(mixed key, mixed var [, long ttl ])
+ */
+PHP_FUNCTION(apc_add) {
+    apc_store_helper(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);
+}
+/* }}} */
+
+/* {{{ inc_updater */
+
+struct _inc_update_args {
+    long step;
+    long lval;
+};
+
+static int inc_updater(apc_cache_t* cache, apc_cache_entry_t* entry, void* data) {
+
+    struct _inc_update_args *args = (struct _inc_update_args*) data;
+    
+    zval* val = entry->data.user.val;
+
+    if(Z_TYPE_P(val) == IS_LONG) {
+        Z_LVAL_P(val) += args->step;
+        args->lval = Z_LVAL_P(val);
+        return 1;
+    }
+
+    return 0;
+}
+/* }}} */
+
+/* {{{ proto long apc_inc(string key [, long step [, bool& success]])
+ */
+PHP_FUNCTION(apc_inc) {
+    char *strkey;
+    int strkey_len;
+    struct _inc_update_args args = {1L, -1};
+    zval *success = NULL;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|lz", &strkey, &strkey_len, &(args.step), &success) == FAILURE) {
+        return;
+    }
+    
+	if (success) {
+		zval_dtor(success);
+	}
+
+    if(_apc_update(strkey, strkey_len, inc_updater, &args TSRMLS_CC)) {
+        if(success) ZVAL_TRUE(success);
+        RETURN_LONG(args.lval);
+    }
+    
+    if(success) ZVAL_FALSE(success);
+    
+    RETURN_FALSE;
+}
+/* }}} */
+
+/* {{{ proto long apc_dec(string key [, long step [, bool &success]])
+ */
+PHP_FUNCTION(apc_dec) {
+    char *strkey;
+    int strkey_len;
+    struct _inc_update_args args = {1L, -1};
+    zval *success = NULL;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|lz", &strkey, &strkey_len, &(args.step), &success) == FAILURE) {
+        return;
+    }
+    
+	if (success) {
+		zval_dtor(success);
+	}
+
+    args.step = args.step * -1;
+
+    if(_apc_update(strkey, strkey_len, inc_updater, &args TSRMLS_CC)) {
+        if(success) ZVAL_TRUE(success);
+        RETURN_LONG(args.lval);
+    }
+    
+    if(success) ZVAL_FALSE(success);
+    
+    RETURN_FALSE;
+}
+/* }}} */
+
+/* {{{ cas_updater */
+static int cas_updater(apc_cache_t* cache, apc_cache_entry_t* entry, void* data) {
+    long* vals = ((long*)data);
+    long old = vals[0];
+    long new = vals[1];
+    zval* val = entry->data.user.val;
+
+    if(Z_TYPE_P(val) == IS_LONG) {
+        if(Z_LVAL_P(val) == old) {
+            Z_LVAL_P(val) = new;
+            return 1;
+        }
+    }
+
+    return 0;
+}
+/* }}} */
+
+/* {{{ proto int apc_cas(string key, int old, int new)
+ */
+PHP_FUNCTION(apc_cas) {
+    char *strkey;
+    int strkey_len;
+    long vals[2];
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "sll", &strkey, &strkey_len, &vals[0], &vals[1]) == FAILURE) {
+        return;
+    }
+
+    if(_apc_update(strkey, strkey_len, cas_updater, &vals TSRMLS_CC)) RETURN_TRUE;
+    RETURN_FALSE;
+}
+/* }}} */
+
+void *apc_erealloc_wrapper(void *ptr, size_t size) {
+    return _erealloc(ptr, size, 0 ZEND_FILE_LINE_CC ZEND_FILE_LINE_EMPTY_CC);
+}
+
+/* {{{ proto mixed apc_fetch(mixed key[, bool &success])
+ */
+PHP_FUNCTION(apc_fetch) {
+    zval *key;
+    zval *success = NULL;
+    HashTable *hash;
+    HashPosition hpos;
+    zval **hentry;
+    zval *result;
+    zval *result_entry;
+    char *strkey;
+    int strkey_len;
+    apc_cache_entry_t* entry;
+    time_t t;
+    apc_context_t ctxt = {0,};
+
+    if(!APCG(enabled)) RETURN_FALSE;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "z|z", &key, &success) == FAILURE) {
+        return;
+    }
+
+    t = apc_time();
+
+    if (success) {
+        ZVAL_BOOL(success, 0);
+    }
+
+    ctxt.pool = apc_pool_create(APC_UNPOOL, apc_php_malloc, apc_php_free, NULL, NULL TSRMLS_CC);
+    if (!ctxt.pool) {
+        apc_warning("Unable to allocate memory for pool." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+    ctxt.copy = APC_COPY_OUT_USER;
+    ctxt.force_update = 0;
+
+    if(Z_TYPE_P(key) != IS_STRING && Z_TYPE_P(key) != IS_ARRAY) {
+        convert_to_string(key);
+    }
+
+    if(Z_TYPE_P(key) == IS_STRING) {
+        strkey = Z_STRVAL_P(key);
+        strkey_len = Z_STRLEN_P(key);
+        if(!strkey_len) RETURN_FALSE;
+        entry = apc_cache_user_find(apc_user_cache, strkey, (strkey_len + 1), t TSRMLS_CC);
+        if(entry) {
+            /* deep-copy returned shm zval to emalloc'ed return_value */
+            apc_cache_fetch_zval(return_value, entry->data.user.val, &ctxt TSRMLS_CC);
+            apc_cache_release(apc_user_cache, entry TSRMLS_CC);
+        } else {
+            goto freepool;
+        }
+    } else if(Z_TYPE_P(key) == IS_ARRAY) {
+        hash = Z_ARRVAL_P(key);
+        MAKE_STD_ZVAL(result);
+        array_init(result); 
+        zend_hash_internal_pointer_reset_ex(hash, &hpos);
+        while(zend_hash_get_current_data_ex(hash, (void**)&hentry, &hpos) == SUCCESS) {
+            if(Z_TYPE_PP(hentry) != IS_STRING) {
+                apc_warning("apc_fetch() expects a string or array of strings." TSRMLS_CC);
+                goto freepool;
+            }
+            entry = apc_cache_user_find(apc_user_cache, Z_STRVAL_PP(hentry), (Z_STRLEN_PP(hentry) + 1), t TSRMLS_CC);
+            if(entry) {
+                /* deep-copy returned shm zval to emalloc'ed return_value */
+                MAKE_STD_ZVAL(result_entry);
+                apc_cache_fetch_zval(result_entry, entry->data.user.val, &ctxt TSRMLS_CC);
+                apc_cache_release(apc_user_cache, entry TSRMLS_CC);
+                zend_hash_add(Z_ARRVAL_P(result), Z_STRVAL_PP(hentry), Z_STRLEN_PP(hentry) +1, &result_entry, sizeof(zval*), NULL);
+            } /* don't set values we didn't find */
+            zend_hash_move_forward_ex(hash, &hpos);
+        }
+        RETVAL_ZVAL(result, 0, 1);
+    } else {
+        apc_warning("apc_fetch() expects a string or array of strings." TSRMLS_CC);
+freepool:
+        apc_pool_destroy(ctxt.pool TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+    if (success) {
+        ZVAL_BOOL(success, 1);
+    }
+
+    apc_pool_destroy(ctxt.pool TSRMLS_CC);
+    return;
+}
+/* }}} */
+
+/* {{{ proto mixed apc_exists(mixed key)
+ */
+PHP_FUNCTION(apc_exists) {
+    zval *key;
+    HashTable *hash;
+    HashPosition hpos;
+    zval **hentry;
+    char *strkey;
+    int strkey_len;
+    apc_cache_entry_t* entry;
+    zval *result;
+    zval *result_entry;
+    time_t t;
+
+    if(!APCG(enabled)) RETURN_FALSE;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "z", &key) == FAILURE) {
+        return;
+    }
+
+    t = apc_time();
+
+    if(Z_TYPE_P(key) != IS_STRING && Z_TYPE_P(key) != IS_ARRAY) {
+        convert_to_string(key);
+    }
+
+    if(Z_TYPE_P(key) == IS_STRING) {
+        strkey = Z_STRVAL_P(key);
+        strkey_len = Z_STRLEN_P(key);
+        if(!strkey_len) RETURN_FALSE;
+        entry = apc_cache_user_exists(apc_user_cache, strkey, strkey_len + 1, t TSRMLS_CC);
+        if(entry) {
+            RETURN_TRUE;
+        }
+    } else if(Z_TYPE_P(key) == IS_ARRAY) {
+        hash = Z_ARRVAL_P(key);
+        MAKE_STD_ZVAL(result);
+        array_init(result); 
+        zend_hash_internal_pointer_reset_ex(hash, &hpos);
+        while(zend_hash_get_current_data_ex(hash, (void**)&hentry, &hpos) == SUCCESS) {
+            if(Z_TYPE_PP(hentry) != IS_STRING) {
+                apc_warning("apc_exists() expects a string or array of strings." TSRMLS_CC);
+                RETURN_FALSE;
+            }
+
+            entry = apc_cache_user_exists(apc_user_cache, Z_STRVAL_PP(hentry), Z_STRLEN_PP(hentry) + 1, t TSRMLS_CC);
+            if(entry) {
+                MAKE_STD_ZVAL(result_entry);
+                ZVAL_BOOL(result_entry, 1);
+                zend_hash_add(Z_ARRVAL_P(result), Z_STRVAL_PP(hentry), Z_STRLEN_PP(hentry) +1, &result_entry, sizeof(zval*), NULL);
+            } /* don't set values we didn't find */
+            zend_hash_move_forward_ex(hash, &hpos);
+        }
+        RETURN_ZVAL(result, 0, 1);
+    } else {
+        apc_warning("apc_exists() expects a string or array of strings." TSRMLS_CC);
+    }
+
+    RETURN_FALSE;
+}
+/* }}} */
+
+/* {{{ proto mixed apc_delete(mixed keys)
+ */
+PHP_FUNCTION(apc_delete) {
+    zval *keys;
+
+    if(!APCG(enabled)) RETURN_FALSE;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "z", &keys) == FAILURE) {
+        return;
+    }
+
+    if (Z_TYPE_P(keys) == IS_STRING) {
+        if (!Z_STRLEN_P(keys)) RETURN_FALSE;
+        if(apc_cache_user_delete(apc_user_cache, Z_STRVAL_P(keys), (Z_STRLEN_P(keys) + 1) TSRMLS_CC)) {
+            RETURN_TRUE;
+        } else {
+            RETURN_FALSE;
+        }
+    } else if (Z_TYPE_P(keys) == IS_ARRAY) {
+        HashTable *hash = Z_ARRVAL_P(keys);
+        HashPosition hpos;
+        zval **hentry;
+        array_init(return_value);
+        zend_hash_internal_pointer_reset_ex(hash, &hpos);
+        while(zend_hash_get_current_data_ex(hash, (void**)&hentry, &hpos) == SUCCESS) {
+            if(Z_TYPE_PP(hentry) != IS_STRING) {
+                apc_warning("apc_delete() expects a string, array of strings, or APCIterator instance." TSRMLS_CC);
+                add_next_index_zval(return_value, *hentry);
+                Z_ADDREF_PP(hentry);
+            } else if(apc_cache_user_delete(apc_user_cache, Z_STRVAL_PP(hentry), (Z_STRLEN_PP(hentry) + 1) TSRMLS_CC) != 1) {
+                add_next_index_zval(return_value, *hentry);
+                Z_ADDREF_PP(hentry);
+            }
+            zend_hash_move_forward_ex(hash, &hpos);
+        }
+        return;
+    } else if (Z_TYPE_P(keys) == IS_OBJECT) {
+        if (apc_iterator_delete(keys TSRMLS_CC)) {
+            RETURN_TRUE;
+        } else {
+            RETURN_FALSE;
+        }
+    } else {
+        apc_warning("apc_delete() expects a string, array of strings, or APCIterator instance." TSRMLS_CC);
+    }
+}
+/* }}} */
+
+/* {{{ proto mixed apc_delete_file(mixed keys)
+ *       Deletes the given files from the opcode cache.  
+ *       Accepts a string, array of strings, or APCIterator object. 
+ *       Returns True/False, or for an Array an Array of failed files.
+ */
+PHP_FUNCTION(apc_delete_file) {
+    zval *keys;
+
+    if(!APCG(enabled)) RETURN_FALSE;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "z", &keys) == FAILURE) {
+        return;
+    }
+
+    if (Z_TYPE_P(keys) == IS_STRING) {
+        if (!Z_STRLEN_P(keys)) RETURN_FALSE;
+        if(apc_cache_delete(apc_cache, Z_STRVAL_P(keys), Z_STRLEN_P(keys) + 1 TSRMLS_CC) != 1) {
+            RETURN_FALSE;
+        } else {
+            RETURN_TRUE;
+        }
+    } else if (Z_TYPE_P(keys) == IS_ARRAY) {
+        HashTable *hash = Z_ARRVAL_P(keys);
+        HashPosition hpos;
+        zval **hentry;
+        array_init(return_value);
+        zend_hash_internal_pointer_reset_ex(hash, &hpos);
+        while(zend_hash_get_current_data_ex(hash, (void**)&hentry, &hpos) == SUCCESS) {
+            if(Z_TYPE_PP(hentry) != IS_STRING) {
+                apc_warning("apc_delete_file() expects a string, array of strings, or APCIterator instance." TSRMLS_CC);
+                add_next_index_zval(return_value, *hentry);
+                Z_ADDREF_PP(hentry);
+            } else if(apc_cache_delete(apc_cache, Z_STRVAL_PP(hentry), Z_STRLEN_PP(hentry) + 1 TSRMLS_CC) != 1) {
+                add_next_index_zval(return_value, *hentry);
+                Z_ADDREF_PP(hentry);
+            }
+            zend_hash_move_forward_ex(hash, &hpos);
+        }
+        return;
+    } else if (Z_TYPE_P(keys) == IS_OBJECT) {
+        if (apc_iterator_delete(keys TSRMLS_CC)) {
+            RETURN_TRUE;
+        } else {
+            RETURN_FALSE;
+        }
+    } else {
+        apc_warning("apc_delete_file() expects a string, array of strings, or APCIterator instance." TSRMLS_CC);
+    }
+}
+/* }}} */
+
+/* {{{ _apc_define_constants */
+static void _apc_define_constants(zval *constants, zend_bool case_sensitive TSRMLS_DC) {
+    char *const_key;
+    unsigned int const_key_len;
+    zval **entry;
+    HashPosition pos;
+
+    zend_hash_internal_pointer_reset_ex(Z_ARRVAL_P(constants), &pos);
+    while (zend_hash_get_current_data_ex(Z_ARRVAL_P(constants), (void**)&entry, &pos) == SUCCESS) {
+        zend_constant c;
+        int key_type;
+        ulong num_key;
+
+        key_type = zend_hash_get_current_key_ex(Z_ARRVAL_P(constants), &const_key, &const_key_len, &num_key, 0, &pos);
+        if(key_type != HASH_KEY_IS_STRING) {
+            zend_hash_move_forward_ex(Z_ARRVAL_P(constants), &pos);
+            continue;
+        }
+        switch(Z_TYPE_PP(entry)) {
+            case IS_LONG:
+            case IS_DOUBLE:
+            case IS_STRING:
+            case IS_BOOL:
+            case IS_RESOURCE:
+            case IS_NULL:
+                break;
+            default:
+                zend_hash_move_forward_ex(Z_ARRVAL_P(constants), &pos);
+                continue;
+        }
+        c.value = **entry;
+        zval_copy_ctor(&c.value);
+        c.flags = case_sensitive;
+        c.name = zend_strndup(const_key, const_key_len);
+        c.name_len = const_key_len;
+        c.module_number = PHP_USER_CONSTANT;
+        zend_register_constant(&c TSRMLS_CC);
+
+        zend_hash_move_forward_ex(Z_ARRVAL_P(constants), &pos);
+    }
+}
+/* }}} */
+
+/* {{{ proto mixed apc_define_constants(string key, array constants [, bool case_sensitive])
+ */
+PHP_FUNCTION(apc_define_constants) {
+    char *strkey;
+    int strkey_len;
+    zval *constants = NULL;
+    zend_bool case_sensitive = 1;
+    int argc = ZEND_NUM_ARGS();
+
+    if (zend_parse_parameters(argc TSRMLS_CC, "sa|b", &strkey, &strkey_len, &constants, &case_sensitive) == FAILURE) {
+        return;
+    }
+
+    if(!strkey_len) RETURN_FALSE;
+
+    _apc_define_constants(constants, case_sensitive TSRMLS_CC);
+    if(_apc_store(strkey, strkey_len + 1, constants, 0, 0 TSRMLS_CC)) RETURN_TRUE;
+    RETURN_FALSE;
+} /* }}} */
+
+/* {{{ proto mixed apc_load_constants(string key [, bool case_sensitive])
+ */
+PHP_FUNCTION(apc_load_constants) {
+    char *strkey;
+    int strkey_len;
+    apc_cache_entry_t* entry;
+    time_t t;
+    zend_bool case_sensitive = 1;
+
+    if(!APCG(enabled)) RETURN_FALSE;
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|b", &strkey, &strkey_len, &case_sensitive) == FAILURE) {
+        return;
+    }
+
+    if(!strkey_len) RETURN_FALSE;
+
+    t = apc_time();
+
+    entry = apc_cache_user_find(apc_user_cache, strkey, (strkey_len + 1), t TSRMLS_CC);
+
+    if(entry) {
+        _apc_define_constants(entry->data.user.val, case_sensitive TSRMLS_CC);
+        apc_cache_release(apc_user_cache, entry TSRMLS_CC);
+        RETURN_TRUE;
+    } else {
+        RETURN_FALSE;
+    }
+}
+/* }}} */
+
+/* {{{ proto mixed apc_compile_file(mixed filenames [, bool atomic])
+ */
+PHP_FUNCTION(apc_compile_file) {
+    zval *file;
+    zend_file_handle file_handle;
+    zend_op_array *op_array;
+    char** filters = NULL;
+    zend_bool cache_by_default = 1;
+    HashTable cg_function_table, cg_class_table;
+    HashTable *cg_orig_function_table, *cg_orig_class_table, *eg_orig_function_table, *eg_orig_class_table;
+    apc_cache_entry_t** cache_entries;
+    apc_cache_key_t* keys;
+    zend_op_array **op_arrays;
+    time_t t;
+    zval **hentry;
+    HashPosition hpos;
+    int i=0, c=0;
+    int *rval=NULL;
+    int count=0;
+    zend_bool atomic=1;
+    apc_context_t ctxt = {0,};
+    zend_execute_data *orig_current_execute_data;
+    int atomic_fail;
+
+    if(!APCG(enabled)) RETURN_FALSE;
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "z|b", &file, &atomic) == FAILURE) {
+        return;
+    }
+
+    if (Z_TYPE_P(file) != IS_ARRAY && Z_TYPE_P(file) != IS_STRING) {
+        apc_warning("apc_compile_file argument must be a string or an array of strings" TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+    HANDLE_BLOCK_INTERRUPTIONS();
+    APCG(current_cache) = apc_cache;
+
+    /* reset filters and cache_by_default */
+    filters = APCG(filters);
+    APCG(filters) = NULL;
+
+    cache_by_default = APCG(cache_by_default);
+    APCG(cache_by_default) = 1;
+
+    /* Replace function/class tables to avoid namespace conflicts */
+    zend_hash_init_ex(&cg_function_table, 100, NULL, ZEND_FUNCTION_DTOR, 1, 0);
+    cg_orig_function_table = CG(function_table);
+    CG(function_table) = &cg_function_table;
+    zend_hash_init_ex(&cg_class_table, 10, NULL, ZEND_CLASS_DTOR, 1, 0);
+    cg_orig_class_table = CG(class_table);
+    CG(class_table) = &cg_class_table;
+    eg_orig_function_table = EG(function_table);
+    EG(function_table) = CG(function_table);
+    eg_orig_class_table = EG(class_table);
+    EG(class_table) = CG(class_table);
+    APCG(force_file_update) = 1;
+
+    /* Compile the file(s), loading it into the cache */
+    if (Z_TYPE_P(file) == IS_STRING) {
+        file_handle.type = ZEND_HANDLE_FILENAME;
+        file_handle.filename = Z_STRVAL_P(file);
+        file_handle.free_filename = 0;
+        file_handle.opened_path = NULL;
+
+        orig_current_execute_data = EG(current_execute_data);
+        zend_try {
+            op_array = zend_compile_file(&file_handle, ZEND_INCLUDE TSRMLS_CC);
+        } zend_catch {
+            EG(current_execute_data) = orig_current_execute_data;
+            EG(in_execution) = 1;
+            CG(unclean_shutdown) = 0;
+            apc_warning("Error compiling %s in apc_compile_file." TSRMLS_CC, file_handle.filename);
+            op_array = NULL;
+        } zend_end_try();
+        if(op_array != NULL) {
+            /* Free up everything */
+            destroy_op_array(op_array TSRMLS_CC);
+            efree(op_array);
+            RETVAL_TRUE;
+        } else {
+            RETVAL_FALSE;
+        }
+        zend_destroy_file_handle(&file_handle TSRMLS_CC);
+
+    } else { /* IS_ARRAY */
+
+        array_init(return_value);
+
+        t = apc_time();
+
+        op_arrays = ecalloc(Z_ARRVAL_P(file)->nNumOfElements, sizeof(zend_op_array*));
+        cache_entries = ecalloc(Z_ARRVAL_P(file)->nNumOfElements, sizeof(apc_cache_entry_t*));
+        keys = ecalloc(Z_ARRVAL_P(file)->nNumOfElements, sizeof(apc_cache_key_t));
+        zend_hash_internal_pointer_reset_ex(Z_ARRVAL_P(file), &hpos);
+        while(zend_hash_get_current_data_ex(Z_ARRVAL_P(file), (void**)&hentry, &hpos) == SUCCESS) {
+            if (Z_TYPE_PP(hentry) != IS_STRING) {
+                apc_warning("apc_compile_file array values must be strings, aborting." TSRMLS_CC);
+                break;
+            }
+            file_handle.type = ZEND_HANDLE_FILENAME;
+            file_handle.filename = Z_STRVAL_PP(hentry);
+            file_handle.free_filename = 0;
+            file_handle.opened_path = NULL;
+
+            if (!apc_cache_make_file_key(&(keys[i]), file_handle.filename, PG(include_path), t TSRMLS_CC)) {
+                add_assoc_long(return_value, Z_STRVAL_PP(hentry), -1);  /* -1: compilation error */
+                apc_warning("Error compiling %s in apc_compile_file." TSRMLS_CC, file_handle.filename);
+                break;
+            }
+
+            if (keys[i].type == APC_CACHE_KEY_FPFILE) {
+                keys[i].data.fpfile.fullpath = estrndup(keys[i].data.fpfile.fullpath, keys[i].data.fpfile.fullpath_len);
+            } else if (keys[i].type == APC_CACHE_KEY_USER) {
+                keys[i].data.user.identifier = estrndup(keys[i].data.user.identifier, keys[i].data.user.identifier_len);
+            }
+
+            orig_current_execute_data = EG(current_execute_data);
+            zend_try {
+                if (apc_compile_cache_entry(&keys[i], &file_handle, ZEND_INCLUDE, t, &op_arrays[i], &cache_entries[i] TSRMLS_CC) != SUCCESS) {
+                    op_arrays[i] = NULL;
+                    cache_entries[i] = NULL;
+                    add_assoc_long(return_value, Z_STRVAL_PP(hentry), -2);  /* -2: input or cache insertion error */
+                    apc_warning("Error compiling %s in apc_compile_file." TSRMLS_CC, file_handle.filename);
+                }
+            } zend_catch {
+                EG(current_execute_data) = orig_current_execute_data;
+                EG(in_execution) = 1;
+                CG(unclean_shutdown) = 0;
+                op_arrays[i] = NULL;
+                cache_entries[i] = NULL;
+                add_assoc_long(return_value, Z_STRVAL_PP(hentry), -1);  /* -1: compilation error */
+                apc_warning("Error compiling %s in apc_compile_file." TSRMLS_CC, file_handle.filename);
+            } zend_end_try();
+
+            zend_destroy_file_handle(&file_handle TSRMLS_CC);
+            if(op_arrays[i] != NULL) {
+                count++;
+            }
+
+            /* clean out the function/class tables */
+            zend_hash_clean(&cg_function_table);
+            zend_hash_clean(&cg_class_table);
+
+            zend_hash_move_forward_ex(Z_ARRVAL_P(file), &hpos);
+            i++;
+        }
+
+        /* atomically update the cache if no errors or not atomic */
+        ctxt.copy = APC_COPY_IN_OPCODE;
+        ctxt.force_update = 1;
+        if (count == i || !atomic) {
+            rval = apc_cache_insert_mult(apc_cache, keys, cache_entries, &ctxt, t, i TSRMLS_CC);
+            atomic_fail = 0;
+        } else {
+            atomic_fail = 1;
+        }
+
+        zend_hash_internal_pointer_reset_ex(Z_ARRVAL_P(file), &hpos);
+        for(c=0; c < i; c++) {
+            zend_hash_get_current_data_ex(Z_ARRVAL_P(file), (void**)&hentry, &hpos);
+            if (rval && rval[c] != 1) {
+                add_assoc_long(return_value, Z_STRVAL_PP(hentry), -2);  /* -2: input or cache insertion error */
+                if (cache_entries[c]) {
+                    apc_pool_destroy(cache_entries[c]->pool TSRMLS_CC);
+                }
+            }
+            if (op_arrays[c]) {
+                destroy_op_array(op_arrays[c] TSRMLS_CC);
+                efree(op_arrays[c]);
+            }
+            if (atomic_fail && cache_entries[c]) {
+                apc_pool_destroy(cache_entries[c]->pool TSRMLS_CC);
+            }
+            if (keys[c].type == APC_CACHE_KEY_FPFILE) {
+                efree((void*)keys[c].data.fpfile.fullpath);
+            } else if (keys[c].type == APC_CACHE_KEY_USER) {
+                efree((void*)keys[c].data.user.identifier);
+            }
+            zend_hash_move_forward_ex(Z_ARRVAL_P(file), &hpos);
+        }
+        efree(op_arrays);
+        efree(keys);
+        efree(cache_entries);
+        if (rval) {
+            efree(rval);
+        }
+
+    }
+
+    /* Return class/function tables to previous states, destroy temp tables */
+    APCG(force_file_update) = 0;
+    CG(function_table) = cg_orig_function_table;
+    zend_hash_destroy(&cg_function_table);
+    CG(class_table) = cg_orig_class_table;
+    zend_hash_destroy(&cg_class_table);
+    EG(function_table) = eg_orig_function_table;
+    EG(class_table) = eg_orig_class_table;
+
+    /* Restore global settings */
+    APCG(filters) = filters;
+    APCG(cache_by_default) = cache_by_default;
+
+    APCG(current_cache) = NULL;
+    HANDLE_UNBLOCK_INTERRUPTIONS();
+
+}
+/* }}} */
+
+/* {{{ proto mixed apc_bin_dump([array files [, array user_vars]])
+    Returns a binary dump of the given files and user variables from the APC cache.
+    A NULL for files or user_vars signals a dump of every entry, while array() will dump nothing.
+ */
+PHP_FUNCTION(apc_bin_dump) {
+
+    zval *z_files = NULL, *z_user_vars = NULL;
+    HashTable *h_files, *h_user_vars;
+    apc_bd_t *bd;
+
+    if(!APCG(enabled)) {
+        apc_warning("APC is not enabled, apc_bin_dump not available." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|a!a!", &z_files, &z_user_vars) == FAILURE) {
+        return;
+    }
+
+    h_files = z_files ? Z_ARRVAL_P(z_files) : NULL;
+    h_user_vars = z_user_vars ? Z_ARRVAL_P(z_user_vars) : NULL;
+    bd = apc_bin_dump(h_files, h_user_vars TSRMLS_CC);
+    if(bd) {
+        RETVAL_STRINGL((char*)bd, bd->size-1, 0);
+    } else {
+        apc_error("Unknown error encountered during apc_bin_dump." TSRMLS_CC);
+        RETVAL_NULL();
+    }
+
+    return;
+}
+/* }}} */
+
+/* {{{ proto mixed apc_bin_dumpfile(array files, array user_vars, string filename, [int flags [, resource context]])
+    Output a binary dump of the given files and user variables from the APC cache to the named file.
+ */
+PHP_FUNCTION(apc_bin_dumpfile) {
+
+    zval *z_files = NULL, *z_user_vars = NULL;
+    HashTable *h_files, *h_user_vars;
+    char *filename = NULL;
+    int filename_len;
+    long flags=0;
+    zval *zcontext = NULL;
+    php_stream_context *context = NULL;
+    php_stream *stream;
+    int numbytes = 0;
+    apc_bd_t *bd;
+
+    if(!APCG(enabled)) {
+        apc_warning("APC is not enabled, apc_bin_dumpfile not available." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "a!a!s|lr!", &z_files, &z_user_vars, &filename, &filename_len, &flags, &zcontext) == FAILURE) {
+        return;
+    }
+
+    if(!filename_len) {
+        apc_error("apc_bin_dumpfile filename argument must be a valid filename." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+    h_files = z_files ? Z_ARRVAL_P(z_files) : NULL;
+    h_user_vars = z_user_vars ? Z_ARRVAL_P(z_user_vars) : NULL;
+    bd = apc_bin_dump(h_files, h_user_vars TSRMLS_CC);
+    if(!bd) {
+        apc_error("Unknown error encountered during apc_bin_dumpfile." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+
+    /* Most of the following has been taken from the file_get/put_contents functions */
+
+    context = php_stream_context_from_zval(zcontext, flags & PHP_FILE_NO_DEFAULT_CONTEXT);
+    stream = php_stream_open_wrapper_ex(filename, (flags & PHP_FILE_APPEND) ? "ab" : "wb",
+                                            ENFORCE_SAFE_MODE | REPORT_ERRORS, NULL, context);
+    if (stream == NULL) {
+        efree(bd);
+        apc_error("Unable to write to file in apc_bin_dumpfile." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+    if (flags & LOCK_EX && php_stream_lock(stream, LOCK_EX)) {
+        php_stream_close(stream);
+        efree(bd);
+        apc_error("Unable to get a lock on file in apc_bin_dumpfile." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+    numbytes = php_stream_write(stream, (char*)bd, bd->size);
+    if(numbytes != bd->size) {
+        numbytes = -1;
+    }
+
+    php_stream_close(stream);
+    efree(bd);
+
+    if(numbytes < 0) {
+        apc_error("Only %d of %d bytes written, possibly out of free disk space" TSRMLS_CC, numbytes, bd->size);
+        RETURN_FALSE;
+    }
+
+    RETURN_LONG(numbytes);
+}
+/* }}} */
+
+/* {{{ proto mixed apc_bin_load(string data, [int flags])
+    Load the given binary dump into the APC file/user cache.
+ */
+PHP_FUNCTION(apc_bin_load) {
+
+    int data_len;
+    char *data;
+    long flags = 0;
+
+    if(!APCG(enabled)) {
+        apc_warning("APC is not enabled, apc_bin_load not available." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|l", &data, &data_len, &flags) == FAILURE) {
+        return;
+    }
+
+    if(!data_len || data_len != ((apc_bd_t*)data)->size -1) {
+        apc_error("apc_bin_load string argument does not appear to be a valid APC binary dump due to size (%d vs expected %d)." TSRMLS_CC, data_len, ((apc_bd_t*)data)->size -1);
+        RETURN_FALSE;
+    }
+
+    apc_bin_load((apc_bd_t*)data, (int)flags TSRMLS_CC);
+
+    RETURN_TRUE;
+}
+/* }}} */
+
+/* {{{ proto mixed apc_bin_loadfile(string filename, [resource context, [int flags]])
+    Load the given binary dump from the named file into the APC file/user cache.
+ */
+PHP_FUNCTION(apc_bin_loadfile) {
+
+    char *filename;
+    int filename_len;
+    zval *zcontext = NULL;
+    long flags = 0;
+    php_stream_context *context = NULL;
+    php_stream *stream;
+    char *data;
+    int len;
+
+    if(!APCG(enabled)) {
+        apc_warning("APC is not enabled, apc_bin_loadfile not available." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|r!l", &filename, &filename_len, &zcontext, &flags) == FAILURE) {
+        return;
+    }
+
+    if(!filename_len) {
+        apc_error("apc_bin_loadfile filename argument must be a valid filename." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+    context = php_stream_context_from_zval(zcontext, 0);
+    stream = php_stream_open_wrapper_ex(filename, "rb",
+            ENFORCE_SAFE_MODE | REPORT_ERRORS, NULL, context);
+    if (!stream) {
+        apc_error("Unable to read from file in apc_bin_loadfile." TSRMLS_CC);
+        RETURN_FALSE;
+    }
+
+    len = php_stream_copy_to_mem(stream, &data, PHP_STREAM_COPY_ALL, 0);
+    if(len == 0) {
+        apc_warning("File passed to apc_bin_loadfile was empty: %s." TSRMLS_CC, filename);
+        RETURN_FALSE;
+    } else if(len < 0) {
+        apc_warning("Error reading file passed to apc_bin_loadfile: %s." TSRMLS_CC, filename);
+        RETURN_FALSE;
+    } else if(len != ((apc_bd_t*)data)->size) {
+        apc_warning("file passed to apc_bin_loadfile does not appear to be valid due to size (%d vs expected %d)." TSRMLS_CC, len, ((apc_bd_t*)data)->size -1);
+        RETURN_FALSE;
+    }
+    php_stream_close(stream);
+
+    apc_bin_load((apc_bd_t*)data, (int)flags TSRMLS_CC);
+    efree(data);
+
+    RETURN_TRUE;
+}
+/* }}} */
+
+/* {{{ arginfo */
+#if (PHP_MAJOR_VERSION >= 6 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION >= 3))
+# define PHP_APC_ARGINFO
+#else
+# define PHP_APC_ARGINFO static
+#endif
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_store, 0, 0, 2)
+    ZEND_ARG_INFO(0, key)
+    ZEND_ARG_INFO(0, var)
+    ZEND_ARG_INFO(0, ttl)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_clear_cache, 0, 0, 0)
+    ZEND_ARG_INFO(0, info)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_sma_info, 0, 0, 0)
+    ZEND_ARG_INFO(0, limited)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_cache_info, 0, 0, 0)
+    ZEND_ARG_INFO(0, type)
+    ZEND_ARG_INFO(0, limited)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_define_constants, 0, 0, 2)
+    ZEND_ARG_INFO(0, key)
+    ZEND_ARG_INFO(0, constants)
+    ZEND_ARG_INFO(0, case_sensitive)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO(arginfo_apc_delete_file, 0)
+    ZEND_ARG_INFO(0, keys)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO(arginfo_apc_delete, 0)
+    ZEND_ARG_INFO(0, keys)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_fetch, 0, 0, 1)
+    ZEND_ARG_INFO(0, key)
+    ZEND_ARG_INFO(1, success)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_inc, 0, 0, 1)
+    ZEND_ARG_INFO(0, key)
+    ZEND_ARG_INFO(0, step)
+    ZEND_ARG_INFO(1, success)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO(arginfo_apc_cas, 0)
+    ZEND_ARG_INFO(0, key)
+    ZEND_ARG_INFO(0, old)
+    ZEND_ARG_INFO(0, new)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_load_constants, 0, 0, 1)
+    ZEND_ARG_INFO(0, key)
+    ZEND_ARG_INFO(0, case_sensitive)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_compile_file, 0, 0, 1)
+    ZEND_ARG_INFO(0, filenames)
+    ZEND_ARG_INFO(0, atomic)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_bin_dump, 0, 0, 0)
+    ZEND_ARG_INFO(0, files)
+    ZEND_ARG_INFO(0, user_vars)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_bin_dumpfile, 0, 0, 3)
+    ZEND_ARG_INFO(0, files)
+    ZEND_ARG_INFO(0, user_vars)
+    ZEND_ARG_INFO(0, filename)
+    ZEND_ARG_INFO(0, flags)
+    ZEND_ARG_INFO(0, context)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_bin_load, 0, 0, 1)
+    ZEND_ARG_INFO(0, data)
+    ZEND_ARG_INFO(0, flags)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO_EX(arginfo_apc_bin_loadfile, 0, 0, 1)
+    ZEND_ARG_INFO(0, filename)
+    ZEND_ARG_INFO(0, context)
+    ZEND_ARG_INFO(0, flags)
+ZEND_END_ARG_INFO()
+
+PHP_APC_ARGINFO
+ZEND_BEGIN_ARG_INFO(arginfo_apc_exists, 0)
+    ZEND_ARG_INFO(0, keys)
+ZEND_END_ARG_INFO()
+/* }}} */
+
+/* {{{ apc_functions[] */
+zend_function_entry apc_functions[] = {
+    PHP_FE(apc_cache_info,          arginfo_apc_cache_info)
+    PHP_FE(apc_clear_cache,         arginfo_apc_clear_cache)
+    PHP_FE(apc_sma_info,            arginfo_apc_sma_info)
+    PHP_FE(apc_store,               arginfo_apc_store)
+    PHP_FE(apc_fetch,               arginfo_apc_fetch)
+    PHP_FE(apc_delete,              arginfo_apc_delete)
+    PHP_FE(apc_delete_file,         arginfo_apc_delete_file)
+    PHP_FE(apc_define_constants,    arginfo_apc_define_constants)
+    PHP_FE(apc_load_constants,      arginfo_apc_load_constants)
+    PHP_FE(apc_compile_file,        arginfo_apc_compile_file)
+    PHP_FE(apc_add,                 arginfo_apc_store)
+    PHP_FE(apc_inc,                 arginfo_apc_inc)
+    PHP_FE(apc_dec,                 arginfo_apc_inc)
+    PHP_FE(apc_cas,                 arginfo_apc_cas)
+    PHP_FE(apc_bin_dump,            arginfo_apc_bin_dump)
+    PHP_FE(apc_bin_load,            arginfo_apc_bin_load)
+    PHP_FE(apc_bin_dumpfile,        arginfo_apc_bin_dumpfile)
+    PHP_FE(apc_bin_loadfile,        arginfo_apc_bin_loadfile)
+    PHP_FE(apc_exists,              arginfo_apc_exists)
+    {NULL, NULL, NULL}
+};
+/* }}} */
+
+/* {{{ module definition structure */
+
+zend_module_entry apc_module_entry = {
+    STANDARD_MODULE_HEADER,
+    "apc",
+    apc_functions,
+    PHP_MINIT(apc),
+    PHP_MSHUTDOWN(apc),
+    PHP_RINIT(apc),
+    PHP_RSHUTDOWN(apc),
+    PHP_MINFO(apc),
+    PHP_APC_VERSION,
+    STANDARD_MODULE_PROPERTIES
+};
+
+#ifdef COMPILE_DL_APC
+ZEND_GET_MODULE(apc)
+#endif
+/* }}} */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/php_apc.h php-5.4.19.bak/ext/apc/php_apc.h
--- php-5.4.19/ext/apc/php_apc.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/php_apc.h	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,54 @@
+/*
+  +----------------------------------------------------------------------+
+  | APC                                                                  |
+  +----------------------------------------------------------------------+
+  | Copyright (c) 2006-2011 The PHP Group                                |
+  +----------------------------------------------------------------------+
+  | This source file is subject to version 3.01 of the PHP license,      |
+  | that is bundled with this package in the file LICENSE, and is        |
+  | available through the world-wide-web at the following url:           |
+  | http://www.php.net/license/3_01.txt                                  |
+  | If you did not receive a copy of the PHP license and are unable to   |
+  | obtain it through the world-wide-web, please send a note to          |
+  | license@php.net so we can mail you a copy immediately.               |
+  +----------------------------------------------------------------------+
+  | Authors: Daniel Cowgill <dcowgill@communityconnect.com>              |
+  |          George Schlossnagle <george@omniti.com>                     |
+  |          Rasmus Lerdorf <rasmus@php.net>                             |
+  +----------------------------------------------------------------------+
+
+   This software was contributed to PHP by Community Connect Inc. in 2002
+   and revised in 2005 by Yahoo! Inc. to add support for PHP 5.1.
+   Future revisions and derivatives of this source code must acknowledge
+   Community Connect Inc. as the original contributor of this module by
+   leaving this note intact in the source code.
+
+   All other licensing and usage conditions are those of the PHP Group.
+
+ */
+
+/* $Id: php_apc.h 327154 2012-08-16 16:01:08Z rasmus $ */
+
+#ifndef PHP_APC_H
+#define PHP_APC_H
+
+#include "apc_php.h"
+#include "apc_globals.h"
+
+#define PHP_APC_VERSION "3.1.13"
+
+extern zend_module_entry apc_module_entry;
+#define apc_module_ptr &apc_module_entry
+
+#define phpext_apc_ptr apc_module_ptr
+
+#endif /* PHP_APC_H */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ * vim>600: expandtab sw=4 ts=4 sts=4 fdm=marker
+ * vim<600: expandtab sw=4 ts=4 sts=4
+ */
diff -Nru php-5.4.19/ext/apc/TECHNOTES.txt php-5.4.19.bak/ext/apc/TECHNOTES.txt
--- php-5.4.19/ext/apc/TECHNOTES.txt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/TECHNOTES.txt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,361 @@
+APC Quick-Start Braindump
+
+This is a rapidly written braindump of how APC currently works in the
+form of a quick-start guide to start hacking on APC.
+
+1. Install and use APC a bit so you know what it does from the end-user's
+   perspective.  
+   user-space functions are all explained here: 
+
+2. Grab the current APC code from CVS:
+    
+    cvs -d:pserver:cvsread@cvs.php.net:/repository login
+    Password: phpfi
+    cvs -d:pserver:cvsread@cvs.php.net:/repository co pecl/apc
+
+   apc/php_apc.c has most of the code for the user-visible stuff.  It is
+   also a regular PHP extension in the sense that there are MINIT, MINFO, 
+   MSHUTDOWN, RSHUTDOWN, etc. functions.  
+
+3. Build it.
+
+   cd pecl/apc
+   phpize
+   ./configure --enable-apc --enable-mmap
+   make
+   cp modules/apc.so /usr/local/lib/php
+   apachectl restart
+
+4. Debugging Hints
+
+     apachectl stop
+     gdb /usr/bin/httpd
+     break ??
+     run -X
+
+   Grab the .gdbinit from the PHP source tree and have a look at the macros.
+
+5. Look through apc/apc_sma.c
+   It is a pretty standard memory allocator.
+
+   apc_sma_malloc, apc_sma_realloc, apc_sma_strdup and apc_sma_free behave to the
+   caller just like malloc, realloc, strdup and free
+
+   On server startup the MINIT hook in php_apc.c calls apc_module_init() in
+   apc_main.c which in turn calls apc_sma_init().  apc_sma_init calls into
+   apc_mmap.c to mmap the specified sized segment (I tend to just use a single
+   segment).  apc_mmap.c should be self-explanatory.  It mmaps a temp file and
+   then unlinks that file right after the mmap to provide automatic shared memory
+   cleanup in case the process dies.
+
+   Once the region has been initialized we stick a header_t at the beginning
+   of the region.  It contains the total size in header->segsize and the number 
+   of bytes available in header->avail.  
+
+   After the header comes a bit of a hack.  A zero-sized block is inserted just
+   to make things easier later on.  And then a huge block that is basically
+   the size of the entire segment minus the two (for the 0-sized block, and this one)
+   block headers.
+
+   The code for this is:
+
+     header = (header_t*) shmaddr;
+     header->segsize = sma_segsize;
+     header->avail = sma_segsize - sizeof(header_t) - sizeof(block_t) - alignword(sizeof(int));
+     memset(&header->lock,0,sizeof(header->lock));
+     sma_lock = &header->lock;
+     block = BLOCKAT(sizeof(header_t));
+     block->size = 0;
+     block->next = sizeof(header_t) + sizeof(block_t);
+     block = BLOCKAT(block->next);
+     block->size = header->avail;
+     block->next = 0;
+
+   So the shared memory looks like this:
+
+     +--------+-------+---------------------------------+
+     | header | block |             block               |
+     +--------+-------+---------------------------------+
+
+   sma_shmaddrs[0] gives you the address of header
+
+   The blocks are just a simple offset-based linked list (so no pointers):
+
+     typedef struct block_t block_t;
+     struct block_t {
+         size_t size;       /* size of this block */
+         size_t next;       /* offset in segment of next free block */
+         size_t canary;     /* canary to check for memory overwrites */
+#ifdef __APC_SMA_DEBUG__
+         int id;         /* identifier for the memory block */
+#endif
+     };
+
+   The BLOCKAT macro turns an offset into an actual address for you:
+
+     #define BLOCKAT(offset) ((block_t*)((char *)shmaddr + offset))
+
+   where shmaddr = sma_shaddrs[0]
+
+   And the OFFSET macro goes the other way:
+
+     #define OFFSET(block) ((int)(((char*)block) - (char*)shmaddr))
+
+   Allocating a block with a call to apc_sma_allocate() walks through the
+   linked list of blocks until it finds one that is >= to the requested size.
+   The first call to apc_sma_allocate() will hit the second block.  We then
+   chop up that block so it looks like this:
+
+     +--------+-------+-------+-------------------------+
+     | header | block | block |         block           |
+     +--------+-------+-------+-------------------------+
+
+   Then we unlink that block from the linked list so it won't show up
+   as an available block on the next allocate.  So we actually have:
+
+     +--------+-------+       +-------------------------+
+     | header | block |------>|         block           |
+     +--------+-------+       +-------------------------+
+
+   And header->avail along with block->size of the remaining large
+   block are updated accordingly.  The arrow there representing the
+   link which now points to a block with an offset further along in
+   the segment.
+
+   When the block is freed using apc_sma_deallocate() the steps are
+   basically just reversed.  The block is put back and then the deallocate
+   code looks at the block before and after to see if the block immediately
+   before and after are free and if so the blocks are combined.  So you never
+   have 2 free blocks next to each other, apart from at the front with that
+   0-sized dummy block.  This mostly prevents fragmentation.  I have been
+   toying with the idea of always allocating block at 2^n boundaries to make
+   it more likely that they will be re-used to cut down on fragmentation further.
+   That's what the POWER_OF_TWO_BLOCKSIZE you see in apc_sma.c is all about.
+  
+   Of course, anytime we fiddle with our shared memory segment we lock using
+   the locking macros, LOCK() and UNLOCK().
+
+   That should mostly take care of the low-level shared memory handling.
+
+6. Next up is apc_main.c and apc_cache.c which implement the meat of the
+   cache logic.
+
+   The apc_main.c file mostly calls functions in apc_sma.c to allocate memory
+   and apc_cache.c for actual cache manipulation.  
+  
+   After the shared memory segment is created and the caches are initialized,
+   apc_module_init() installs the my_compile_file() function overriding Zend's
+   version.  I'll talk about my_compile_file() and the rest of apc_compile.c
+   in the next section.  For now I will stick with apc_main.c and apc_cache.c
+   and talk about the actual caches.  A cache consists of a block of shared
+   memory returned by apc_sma_allocate() via apc_sma_malloc().  You will 
+   notice references to apc_emalloc().  apc_emalloc() is just a thin wrapper
+   around PHP's own emalloc() function which allocates per-process memory from
+   PHP's pool-based memory allocator.  Don't confuse apc_emalloc() and 
+   apc_sma_malloc() as the first is per-process and the second is shared memory.
+
+   The cache is stored in/described by this struct allocated locally using
+   emalloc():
+
+     struct apc_cache_t {
+         void* shmaddr;              /* process (local) address of shared cache */
+         header_t* header;           /* cache header (stored in SHM) */
+         slot_t** slots;             /* array of cache slots (stored in SHM) */
+         int num_slots;              /* number of slots in cache */
+         int gc_ttl;                 /* maximum time on GC list for a slot */
+         int ttl;                    /* if slot is needed and entry's access time is older than this ttl, remove it */
+     };
+
+   Whenever you see functions that take a 'cache' argument, this is what they
+   take.  And apc_cache_create() returns a pointer to this populated struct.
+
+   At the beginning of the cache we have a header.  Remember, we are down a level now
+   from the sma stuff.  The sma stuff is the low-level shared-memory allocator which
+   has its own header which is completely separate and invisible to apc_cache.c.  
+   As far as apc_cache.c is concerned the block of memory it is working with could 
+   have come from a call to malloc().
+
+   The header looks like this:
+
+     typedef struct header_t header_t;
+     struct header_t {
+         int num_hits;               /* total successful hits in cache */
+         int num_misses;             /* total unsuccessful hits in cache */
+         slot_t* deleted_list;       /* linked list of to-be-deleted slots */
+     };
+
+   Since this is at the start of the shared memory segment, these values are accessible
+   across all the apache processes and hence access to them has to be locked.
+
+   After the header we have an array of slots.  The number of slots is user-defined
+   through the apc.num_slots ini hint.  Each slot is described by:
+
+     typedef struct slot_t slot_t;
+     struct slot_t {
+         apc_cache_key_t key;        /* slot key */
+         apc_cache_entry_t* value;   /* slot value */
+         slot_t* next;               /* next slot in linked list */
+         int num_hits;               /* number of hits to this bucket */
+	 time_t creation_time;       /* time slot was initialized */
+	 time_t deletion_time;       /* time slot was removed from cache */
+	 time_t access_time;         /* time slot was last accessed */
+     };
+
+   The slot_t *next there is a linked list to other slots that happened to hash to the
+   same array position.
+
+   apc_cache_insert() shows what happens on a new cache insert.
+
+     slot = &cache->slots[hash(key) % cache->num_slots];
+
+   cache->slots is our array of slots in the segment.  hash() is simply:
+
+     static unsigned int hash(apc_cache_key_t key)
+     {
+         return key.data.file.device + key.data.file.inode;
+     }
+
+   That is, we use the file's device and inode to uniquely identify it.  Initially
+   we had used the file's full path, but getting that requires a realpath() call which
+   is amazingly expensive since it has to stat each component of the path to resolve
+   symlinks and get rid of relative path components.  By using the device+inode we
+   can uniquely identify a file with a single stat.
+
+   So, on an insert we find the array position in the slots array by hashing the device+inode.
+   If there are currently no other slots there, we just create the slot and stick it into
+   the array:
+
+     *slot = make_slot(key, value, *slot, t)
+
+   If there are other slots already at this position we walk the link list to get to
+   the end.  Here is the loop:
+
+     while (*slot) {
+         if (key_equals((*slot)->key.data.file, key.data.file)) {
+	     /* If existing slot for the same device+inode is different, remove it and insert the new version */
+	     if ((*slot)->key.mtime != key.mtime) {
+	         remove_slot(cache, slot);
+	         break;
+	     }
+	     UNLOCK(cache);
+	     return 0;
+	 } else if(cache->ttl && (*slot)->access_time < (t - cache->ttl)) {
+             remove_slot(cache, slot);
+             continue;
+         }
+         slot = &(*slot)->next;
+     }
+
+   That first key_equals() check sees if we have an exact match meaning the file
+   is already in the cache.  Since we try to find the file in the cache before doing
+   an insert, this will generally only happen if another process managed to beat us
+   to inserting it.  If we have a newer version of the file at this point we remove
+   it an insert the new version.  If our version is not newer we just return without
+   doing anything.
+
+   While walking the linked list we also check to see if the cache has a TTL defined.
+   If while walking the linked list we see a slot that has expired, we remove it
+   since we are right there looking at it.  This is the only place we remove stale
+   entries unless the shared memory segment fills up and we force a full expunge via
+   apc_cache_expunge().  apc_cache_expunge() walks the entire slots array and walks
+   down every linked list removing stale slots to free up room.  This is obviously
+   slow and thus only happens when we have run out of room.
+
+   apc_cache_find() simply hashes and returns the entry if it is there.  If it is there
+   but older than the mtime in the entry we are looking for, we delete the one that is
+   there and return indicating we didn't find it.
+
+   Next we need to understand what an actual cache entry looks like.  Have a look at
+   apc_cache.h for the structs.  I sort of glossed over the key part earlier saying
+   that we just used the device+inode to find a hash slot.  It is actually a bit more
+   complex than that because we have two kinds of caches.  We have the standard file
+   cache containing opcode arrays, but we also have a user-controlled cache that the
+   user can insert whatever they want into via apc_store().  For the user cache we
+   obviously don't have a device+inode.  The actual identifier is provided by the user
+   as a char *.  So the key is actually a union that looks like this:
+
+     typedef union _apc_cache_key_data_t {
+         struct {
+             int device;             /* the filesystem device */
+             int inode;              /* the filesystem inode */
+         } file;
+         struct {
+             char *identifier;
+         } user;
+     } apc_cache_key_data_t;
+
+     struct apc_cache_key_t {
+         apc_cache_key_data_t data;
+         int mtime;                  /* the mtime of this cached entry */
+     };   
+
+   And we have two sets of functions to do inserts and finds.  apc_cache_user_find() 
+   and apc_cache_user_insert() operate on the user cache.
+
+   Ok, on to the actual cache entry.  Again, because we have two kinds of caches, we
+   also have the corresponding two kinds of cache entries described by this union:
+
+     typedef union _apc_cache_entry_value_t {
+         struct {
+             char *filename;             /* absolute path to source file */
+             zend_op_array* op_array;    /* op_array allocated in shared memory */
+             apc_function_t* functions;  /* array of apc_function_t's */
+             apc_class_t* classes;       /* array of apc_class_t's */
+         } file;
+         struct {
+             char *info;
+             zval *val;
+             unsigned int ttl;
+         } user;
+     } apc_cache_entry_value_t;
+
+   And then the actual cache entry:
+
+     struct apc_cache_entry_t {
+         apc_cache_entry_value_t data;
+         unsigned char type;
+         int ref_count;
+     };
+
+   The user entry is pretty simple and not all that important for now.  I will
+   concentrate on the file entries since that is what holds the actual compiled
+   opcode arrays along with the functions and classes required by the executor.
+
+   apc_cache_make_file_entry() in apc_cache.c shows how an entry is constructed.
+   The main thing to understand here is that we need more than just the opcode
+   array, we also need the functions and classes created by the compiler when it
+   created the opcode array.  As far as the executor is concerned, it doesn't know
+   that it isn't operating in normal mode being called right after the parse/compile
+   phase, so we need to recreate everything so it looks exactly like it would at
+   that point. 
+
+7. my_compile_file() and apc_compile.c
+
+   my_compile_file() in apc_main.c controls where we get the opcodes from.  If
+   the user-specified filters exclude the file from being cached, then we just
+   call the original compile function and return.  Otherwise we fetch the request
+   time from Apache to avoid an extra syscall, create the key so we can look up
+   the file in the cache.  If we find it we stick it on a local stack which we
+   use at cleanup time to make sure we return everything back to normal after a 
+   request and call cached_compile() which installs the functions and classes
+   associated with the op_array in this entry and then copy the op_array down
+   into our memory space for execution.
+
+   If we didn't find the file in the cache, we need to compile it and insert it.
+   To compile it we simply call the original compile function:
+
+      op_array = old_compile_file(h, type TSRMLS_CC);
+
+   To do the insert we need to copy the functions, classes and the opcode array
+   the compile phase created into shared memory.  This all happens in apc_compile.c
+   in the apc_copy_op_array(), apc_copy_new_functions() and apc_copy_new_classes()
+   functions.  Then we make the file entry and do the insert.  Both of these
+   operations were described in the previous section.  
+
+8. The Optimizer
+   
+   The optimizer has been deprecated.
+
+If you made it to the end of this, you should have a pretty good idea of where things are in
+the code.  I skimmed over a lot of things, so plan on spending some time reading through the code.
+
diff -Nru php-5.4.19/ext/apc/tests/apc_001.phpt php-5.4.19.bak/ext/apc/tests/apc_001.phpt
--- php-5.4.19/ext/apc/tests/apc_001.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_001.phpt	2012-09-04 00:52:50.000000000 +0800
@@ -0,0 +1,32 @@
+--TEST--
+APC: apc_store/fetch with strings
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$foo = 'hello world';
+var_dump($foo);
+apc_store('foo',$foo);
+$bar = apc_fetch('foo');
+var_dump($bar);
+$bar = 'nice';
+var_dump($bar);
+
+apc_store('foo\x00bar', $foo);
+$bar = apc_fetch('foo\x00bar');
+var_dump($bar);
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+string(11) "hello world"
+string(11) "hello world"
+string(4) "nice"
+string(11) "hello world"
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_002.phpt php-5.4.19.bak/ext/apc/tests/apc_002.phpt
--- php-5.4.19/ext/apc/tests/apc_002.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_002.phpt	2012-09-04 00:52:50.000000000 +0800
@@ -0,0 +1,34 @@
+--TEST--
+APC: apc_store/fetch with objects
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+class foo { }
+$foo = new foo;
+var_dump($foo);
+apc_store('foo',$foo);
+unset($foo);
+$bar = apc_fetch('foo');
+var_dump($bar);
+$bar->a = true;
+var_dump($bar);
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+object(foo)#%d (0) {
+}
+object(foo)#%d (0) {
+}
+object(foo)#%d (1) {
+  ["a"]=>
+  bool(true)
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_003b.phpt php-5.4.19.bak/ext/apc/tests/apc_003b.phpt
--- php-5.4.19/ext/apc/tests/apc_003b.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_003b.phpt	2012-09-04 00:52:50.000000000 +0800
@@ -0,0 +1,117 @@
+--TEST--
+APC: apc_store/fetch with objects (php 5.3)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if(version_compare(zend_version(), '2.3.0') < 0) {
+		echo "skip\n";
+	}
+?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+class foo { }
+$foo = new foo;
+var_dump($foo);
+apc_store('foo',$foo);
+unset($foo);
+$bar = apc_fetch('foo');
+var_dump($bar);
+$bar->a = true;
+var_dump($bar);
+
+class bar extends foo
+{
+	public    $pub = 'bar';
+	protected $pro = 'bar';
+	private   $pri = 'bar'; // we don't see this, we'd need php 5.1 new serialization
+	
+	function __construct()
+	{
+		$this->bar = true;
+	}
+	
+	function change()
+	{
+		$this->pri = 'mod';
+	}
+}
+
+class baz extends bar
+{
+	private $pri = 'baz';
+
+	function __construct()
+	{
+		parent::__construct();
+		$this->baz = true;
+	}
+}
+
+$baz = new baz;
+var_dump($baz);
+$baz->change();
+var_dump($baz);
+apc_store('baz', $baz);
+unset($baz);
+var_dump(apc_fetch('baz'));
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+object(foo)#%d (0) {
+}
+object(foo)#%d (0) {
+}
+object(foo)#%d (1) {
+  ["a"]=>
+  bool(true)
+}
+object(baz)#%d (6) {
+  ["pri":"baz":private]=>
+  string(3) "baz"
+  ["pub"]=>
+  string(3) "bar"
+  ["pro":protected]=>
+  string(3) "bar"
+  ["pri":"bar":private]=>
+  string(3) "bar"
+  ["bar"]=>
+  bool(true)
+  ["baz"]=>
+  bool(true)
+}
+object(baz)#%d (6) {
+  ["pri":"baz":private]=>
+  string(3) "baz"
+  ["pub"]=>
+  string(3) "bar"
+  ["pro":protected]=>
+  string(3) "bar"
+  ["pri":"bar":private]=>
+  string(3) "mod"
+  ["bar"]=>
+  bool(true)
+  ["baz"]=>
+  bool(true)
+}
+object(baz)#%d (6) {
+  ["pri":"baz":private]=>
+  string(3) "baz"
+  ["pub"]=>
+  string(3) "bar"
+  ["pro":protected]=>
+  string(3) "bar"
+  ["pri":"bar":private]=>
+  string(3) "mod"
+  ["bar"]=>
+  bool(true)
+  ["baz"]=>
+  bool(true)
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_003.phpt php-5.4.19.bak/ext/apc/tests/apc_003.phpt
--- php-5.4.19/ext/apc/tests/apc_003.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_003.phpt	2012-09-04 00:52:50.000000000 +0800
@@ -0,0 +1,117 @@
+--TEST--
+APC: apc_store/fetch with objects (php pre-5.3)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if(version_compare(zend_version(), '2.3.0') >= 0) {
+		echo "skip\n";
+	}
+?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+class foo { }
+$foo = new foo;
+var_dump($foo);
+apc_store('foo',$foo);
+unset($foo);
+$bar = apc_fetch('foo');
+var_dump($bar);
+$bar->a = true;
+var_dump($bar);
+
+class bar extends foo
+{
+	public    $pub = 'bar';
+	protected $pro = 'bar';
+	private   $pri = 'bar'; // we don't see this, we'd need php 5.1 new serialization
+	
+	function __construct()
+	{
+		$this->bar = true;
+	}
+	
+	function change()
+	{
+		$this->pri = 'mod';
+	}
+}
+
+class baz extends bar
+{
+	private $pri = 'baz';
+
+	function __construct()
+	{
+		parent::__construct();
+		$this->baz = true;
+	}
+}
+
+$baz = new baz;
+var_dump($baz);
+$baz->change();
+var_dump($baz);
+apc_store('baz', $baz);
+unset($baz);
+var_dump(apc_fetch('baz'));
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+object(foo)#%d (0) {
+}
+object(foo)#%d (0) {
+}
+object(foo)#%d (1) {
+  ["a"]=>
+  bool(true)
+}
+object(baz)#%d (6) {
+  ["pri:private"]=>
+  string(3) "baz"
+  ["pub"]=>
+  string(3) "bar"
+  ["pro:protected"]=>
+  string(3) "bar"
+  ["pri:private"]=>
+  string(3) "bar"
+  ["bar"]=>
+  bool(true)
+  ["baz"]=>
+  bool(true)
+}
+object(baz)#%d (6) {
+  ["pri:private"]=>
+  string(3) "baz"
+  ["pub"]=>
+  string(3) "bar"
+  ["pro:protected"]=>
+  string(3) "bar"
+  ["pri:private"]=>
+  string(3) "mod"
+  ["bar"]=>
+  bool(true)
+  ["baz"]=>
+  bool(true)
+}
+object(baz)#%d (6) {
+  ["pri:private"]=>
+  string(3) "baz"
+  ["pub"]=>
+  string(3) "bar"
+  ["pro:protected"]=>
+  string(3) "bar"
+  ["pri:private"]=>
+  string(3) "mod"
+  ["bar"]=>
+  bool(true)
+  ["baz"]=>
+  bool(true)
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_004.phpt php-5.4.19.bak/ext/apc/tests/apc_004.phpt
--- php-5.4.19/ext/apc/tests/apc_004.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_004.phpt	2012-09-04 00:52:50.000000000 +0800
@@ -0,0 +1,38 @@
+--TEST--
+APC: apc_store/fetch with bools 
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$foo = false;
+var_dump($foo);     /* false */
+apc_store('foo',$foo);
+//$success = "some string";
+
+$bar = apc_fetch('foo', $success);
+var_dump($foo);     /* false */
+var_dump($bar);     /* false */
+var_dump($success); /* true  */
+
+$bar = apc_fetch('not foo', $success);
+var_dump($foo);     /* false */
+var_dump($bar);     /* false */
+var_dump($success); /* false */
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+bool(false)
+bool(false)
+bool(false)
+bool(true)
+bool(false)
+bool(false)
+bool(false)
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_005.phpt php-5.4.19.bak/ext/apc/tests/apc_005.phpt
--- php-5.4.19/ext/apc/tests/apc_005.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_005.phpt	2012-09-04 00:52:50.000000000 +0800
@@ -0,0 +1,50 @@
+--TEST--
+APC: apc_store/fetch with arrays of objects 
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$foo = array(new stdclass(), new stdclass());
+
+var_dump($foo);
+
+apc_store('foo',$foo);
+
+$bar = apc_fetch('foo');
+var_dump($foo);
+var_dump($bar);
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+array(2) {
+  [0]=>
+  object(stdClass)#1 (0) {
+  }
+  [1]=>
+  object(stdClass)#2 (0) {
+  }
+}
+array(2) {
+  [0]=>
+  object(stdClass)#1 (0) {
+  }
+  [1]=>
+  object(stdClass)#2 (0) {
+  }
+}
+array(2) {
+  [0]=>
+  object(stdClass)#3 (0) {
+  }
+  [1]=>
+  object(stdClass)#4 (0) {
+  }
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_006.phpt php-5.4.19.bak/ext/apc/tests/apc_006.phpt
--- php-5.4.19/ext/apc/tests/apc_006.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_006.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,73 @@
+--TEST--
+APC: apc_store/fetch reference test
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+apc.serializer=default
+report_memleaks=0
+--FILE--
+<?php
+
+$a = 'a';
+$b = array($a);
+$c = array('c');
+$b[] = &$c;
+$b[] = &$c;
+$d = 'd';
+$b[] = &$d;
+$b[] = &$d;
+$b[] = &$d;
+$e = 'e';
+$b[] = $e;
+$b[] = $e;
+$f = array('f');
+$f[] = &$f;
+$b[] = &$f;
+apc_store('test', $b);
+$x = apc_fetch('test');
+debug_zval_dump($x);
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+array(9) refcount(2){
+  [0]=>
+  string(1) "a" refcount(1)
+  [1]=>
+  &array(1) refcount(2){
+    [0]=>
+    string(1) "c" refcount(1)
+  }
+  [2]=>
+  &array(1) refcount(2){
+    [0]=>
+    string(1) "c" refcount(1)
+  }
+  [3]=>
+  &string(1) "d" refcount(3)
+  [4]=>
+  &string(1) "d" refcount(3)
+  [5]=>
+  &string(1) "d" refcount(3)
+  [6]=>
+  string(1) "e" refcount(2)
+  [7]=>
+  string(1) "e" refcount(2)
+  [8]=>
+  &array(2) refcount(2){
+    [0]=>
+    string(1) "f" refcount(1)
+    [1]=>
+    &array(2) refcount(2){
+      [0]=>
+      string(1) "f" refcount(1)
+      [1]=>
+      *RECURSION*
+    }
+  }
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_007.phpt php-5.4.19.bak/ext/apc/tests/apc_007.phpt
--- php-5.4.19/ext/apc/tests/apc_007.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_007.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,46 @@
+--TEST--
+APC: apc_inc/apc_dec test
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+apc_store('foobar',2);
+echo "\$foobar = 2 \n";
+echo "\$foobar += 1 = ".apc_inc('foobar')."\n";
+echo "\$foobar += 10 = ".apc_inc('foobar', 10)."\n";
+
+echo "\$foobar -= 1 = ".apc_dec('foobar')."\n";
+echo "\$foobar -= 10 = ".apc_dec('foobar',10)."\n";
+
+echo "\$f__bar += 1 = ".(apc_inc('f__bar')?"ok":"fail")."\n";
+
+apc_store('perfection', "xyz");
+echo "\$perfection -= 1 = ".(apc_inc('perfection')?"ok":"epic fail")."\n";
+
+$success = false;
+
+echo "\$foobar += 1 = ".apc_inc('foobar', 1, $success)."\n";
+echo "pass by ref success ". $success . "\n";
+echo "\$foobar -= 1 = ".apc_dec('foobar', 1, $success)."\n";
+echo "pass by ref success ". $success . "\n";
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+$foobar = 2 
+$foobar += 1 = 3
+$foobar += 10 = 13
+$foobar -= 1 = 12
+$foobar -= 10 = 2
+$f__bar += 1 = fail
+$perfection -= 1 = epic fail
+$foobar += 1 = 3
+pass by ref success 1
+$foobar -= 1 = 2
+pass by ref success 1
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_008.phpt php-5.4.19.bak/ext/apc/tests/apc_008.phpt
--- php-5.4.19/ext/apc/tests/apc_008.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_008.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,34 @@
+--TEST--
+APC: apc_cas test
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+apc_store('foobar',2);
+echo "\$foobar = 2\n";
+echo "\$foobar == 1 ? 2 : 1 = ".(apc_cas('foobar', 1, 2)?"ok":"fail")."\n";
+echo "\$foobar == 2 ? 1 : 2 = ".(apc_cas('foobar', 2, 1)?"ok":"fail")."\n";
+echo "\$foobar = ".apc_fetch("foobar")."\n";
+
+echo "\$f__bar == 1 ? 2 : 1 = ".(apc_cas('f__bar', 1, 2)?"ok":"fail")."\n";
+
+apc_store('perfection', "xyz");
+echo "\$perfection == 2 ? 1 : 2 = ".(apc_cas('perfection', 2, 1)?"ok":"epic fail")."\n";
+
+echo "\$foobar = ".apc_fetch("foobar")."\n";
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+$foobar = 2
+$foobar == 1 ? 2 : 1 = fail
+$foobar == 2 ? 1 : 2 = ok
+$foobar = 1
+$f__bar == 1 ? 2 : 1 = fail
+$perfection == 2 ? 1 : 2 = epic fail
+$foobar = 1
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_009.phpt php-5.4.19.bak/ext/apc/tests/apc_009.phpt
--- php-5.4.19/ext/apc/tests/apc_009.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_009.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,97 @@
+--TEST--
+APC: apc_delete_file test
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+apc.stat=On
+report_memleaks=0
+--FILE--
+<?php
+
+$files = array( 'apc_009.php',
+                'apc_009-1.php',
+                'apc_009-2.php',
+                'nofile.php',
+              );
+
+file_put_contents(dirname(__FILE__).'/apc_009-1.php', '<?php echo "test file";');
+file_put_contents(dirname(__FILE__).'/apc_009-2.php', '<?php syntaxerrorhere!');
+
+apc_compile_file($files[0]);
+check_file($files[0]);
+apc_delete_file($files[0]);
+check_file($files[0]);
+
+apc_compile_file($files[0]);
+apc_delete_file(array($files[0]));
+check_file($files[0]);
+
+apc_compile_file($files[0]);
+$it = new APCIterator('file');
+apc_delete_file($it);
+check_file($files[0]);
+
+var_dump(apc_compile_file(array($files[0], $files[1])));
+check_file(array($files[0], $files[1]));
+
+var_dump(apc_compile_file($files));
+check_file($files);
+
+function check_file($files) {
+
+  if (!is_array($files)) {
+    $files = array($files);
+  }
+
+  $info = apc_cache_info('file');
+
+  foreach ($files as $file) {
+    $match = 0;
+    foreach($info['cache_list'] as $cached_file) {
+      if (stristr($cached_file['filename'], $file)) $match = 1;
+    }
+    if ($match) {
+      echo "$file Found File\n";
+    } else {
+      echo "$file Not Found\n";
+    }
+  }
+}
+
+?>
+===DONE===
+<?php exit(0); ?>
+--CLEAN--
+<?php
+unlink('apc_009-1.php');
+unlink('apc_009-2.php');
+?>
+--EXPECTF--
+apc_009.php Found File
+apc_009.php Not Found
+apc_009.php Not Found
+apc_009.php Not Found
+array(0) {
+}
+apc_009.php Found File
+apc_009-1.php Found File
+
+Parse error: syntax error, unexpected '!' in %s/apc_009-2.php on line 1
+
+Warning: apc_compile_file(): Error compiling apc_009-2.php in apc_compile_file. in %s/apc_009.php on line 29
+
+Warning: apc_compile_file(): Error compiling nofile.php in apc_compile_file. in %s/apc_009.php on line 29
+array(2) {
+  ["apc_009-2.php"]=>
+  int(-1)
+  ["nofile.php"]=>
+  int(-1)
+}
+apc_009.php Found File
+apc_009-1.php Found File
+apc_009-2.php Not Found
+nofile.php Not Found
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_010.phpt php-5.4.19.bak/ext/apc/tests/apc_010.phpt
--- php-5.4.19/ext/apc/tests/apc_010.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_010.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,83 @@
+--TEST--
+APC: apc_store/fetch/add with array of key/value pairs.
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$entries = array();
+$entries['key1'] = 'value1';
+$entries['key2'] = 'value2';
+$entries['key3'] = array('value3a','value3b');
+$entries['key4'] = 4;
+
+var_dump(apc_store($entries));
+$cached_values = apc_fetch(array_keys($entries));
+var_dump($cached_values);
+
+apc_delete('key2');
+apc_delete('key4');
+$cached_values = apc_fetch(array_keys($entries));
+var_dump($cached_values);
+var_dump(apc_add($entries));
+$cached_values = apc_fetch(array_keys($entries));
+var_dump($cached_values);
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+array(0) {
+}
+array(4) {
+  ["key1"]=>
+  string(6) "value1"
+  ["key2"]=>
+  string(6) "value2"
+  ["key3"]=>
+  array(2) {
+    [0]=>
+    string(7) "value3a"
+    [1]=>
+    string(7) "value3b"
+  }
+  ["key4"]=>
+  int(4)
+}
+array(2) {
+  ["key1"]=>
+  string(6) "value1"
+  ["key3"]=>
+  array(2) {
+    [0]=>
+    string(7) "value3a"
+    [1]=>
+    string(7) "value3b"
+  }
+}
+array(2) {
+  ["key1"]=>
+  int(-1)
+  ["key3"]=>
+  int(-1)
+}
+array(4) {
+  ["key1"]=>
+  string(6) "value1"
+  ["key2"]=>
+  string(6) "value2"
+  ["key3"]=>
+  array(2) {
+    [0]=>
+    string(7) "value3a"
+    [1]=>
+    string(7) "value3b"
+  }
+  ["key4"]=>
+  int(4)
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc53_001.phpt php-5.4.19.bak/ext/apc/tests/apc53_001.phpt
--- php-5.4.19/ext/apc/tests/apc53_001.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc53_001.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,33 @@
+--TEST--
+APC: classes with namespaces (php 5.3)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if(version_compare(zend_version(), '2.3.0') < 0) {
+		echo "skip\n";
+	}
+?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+require_once(dirname(__FILE__) . '/php_5_3_ns.inc'); 
+
+$a = new Foo\Bar\Baz();
+var_dump($a);
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+object(Foo\Bar\Baz)#1 (3) {
+  ["i"]=>
+  int(1)
+  ["f":protected]=>
+  float(3.14)
+  ["s":"Foo\Bar\Baz":private]=>
+  string(11) "hello world"
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc53_002.phpt php-5.4.19.bak/ext/apc/tests/apc53_002.phpt
--- php-5.4.19/ext/apc/tests/apc53_002.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc53_002.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,47 @@
+--TEST--
+APC: global spaces (php 5.3)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if(version_compare(zend_version(), '2.3.0') < 0) {
+		echo "skip\n";
+	}
+?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+require_once(dirname(__FILE__) . '/php_5_3_ns.inc'); 
+
+$a = new Foo\Bar\Baz();
+$a->foo();
+var_dump(Foo\Bar\sort());
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+array(4) {
+  [0]=>
+  int(1)
+  [1]=>
+  int(2)
+  [2]=>
+  int(3)
+  [3]=>
+  int(4)
+}
+array(4) {
+  [0]=>
+  int(1)
+  [1]=>
+  int(2)
+  [2]=>
+  int(3)
+  [3]=>
+  int(4)
+}
+string(8) "IT WORKS"
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc53_003.phpt php-5.4.19.bak/ext/apc/tests/apc53_003.phpt
--- php-5.4.19/ext/apc/tests/apc53_003.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc53_003.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,31 @@
+--TEST--
+APC: anonymous functions (php 5.3)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if(version_compare(zend_version(), '2.3.0') < 0) {
+		echo "skip\n";
+	}
+?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$greet = function($name)
+{
+    printf("Hello %s\r\n", $name);
+};
+
+$greet('World');
+$greet('PHP');
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+Hello World
+Hello PHP
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc53_004.phpt php-5.4.19.bak/ext/apc/tests/apc53_004.phpt
--- php-5.4.19/ext/apc/tests/apc53_004.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc53_004.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,33 @@
+--TEST--
+APC: closures (php 5.3)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if(version_compare(zend_version(), '2.3.0') < 0) {
+		echo "skip\n";
+	}
+?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+function multiplier($n) {
+	return function($i) use ($n) {
+		return $n * $i;
+	};
+}
+
+$doubler = multiplier(2);
+$tripler = multiplier(3);
+
+echo "double of 9 is ".$doubler(9)."\n";
+echo "triple of 4 is ".$tripler(4)."\n";
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+double of 9 is 18
+triple of 4 is 12
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc53_005.phpt php-5.4.19.bak/ext/apc/tests/apc53_005.phpt
--- php-5.4.19/ext/apc/tests/apc53_005.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc53_005.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,35 @@
+--TEST--
+APC: goto (php 5.3)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if(version_compare(zend_version(), '2.3.0') < 0) {
+		echo "skip\n";
+	}
+?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$i = 0;
+a: 
+$i++;
+if($i % 3 == 0) goto b;
+echo "$i\n";
+b:
+if($i < 10) goto a;
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+1
+2
+4
+5
+7
+8
+10
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc54_001.phpt php-5.4.19.bak/ext/apc/tests/apc54_001.phpt
--- php-5.4.19/ext/apc/tests/apc54_001.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_001.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,56 @@
+--TEST--
+APC: bug #62398 (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip for PHP >= 5.4');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+file_put_contents(dirname(__FILE__) . '/base.php', "<?php\nclass FOO{}\necho 'hello\n';");
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+	'apc.stat=0',
+	'apc.shm_size=50M',
+	'apc.max_file_size=1M',
+	'apc.ttl=0',
+	'apc.gc_ttl=3600',
+	'apc.file_update_protection=0',
+	'apc.cache_by_default=1',
+	'apc.include_once_override=0',
+	'apc.localcache=0',
+	'apc.localcache.size=512',
+	'apc.num_files_hint=1000',
+	'apc.report_autofilter=0',
+	'apc.rfc1867=0',
+	'apc.slam_defense=0',
+	'apc.stat=0',
+	'apc.stat_ctime=0',
+	'apc.write_lock=1',
+);
+server_start('include "base.php";', $args);
+
+list($host, $port) = explode(':', PHP_CLI_SERVER_ADDRESS);
+$port = intval($port)?:80;
+
+$send = "GET / HTTP/1.1\nHost: {$host}\r\n\r\n";
+for ($i = 0; $i < 5; $i++) {
+	run_test($host, $port, $send);
+}
+echo 'done';
+
+--CLEAN--
+<?php
+//	unlink(dirname(__FILE__) . '/base.php');
+--EXPECTF--
+hello
+hello
+hello
+hello
+hello
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_002.phpt php-5.4.19.bak/ext/apc/tests/apc54_002.phpt
--- php-5.4.19/ext/apc/tests/apc54_002.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_002.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,150 @@
+--TEST--
+APC: interned strings same method names (php 5.4 nts)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+	if (PHP_ZTS) {
+		die('skip NTS only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+function hello()
+{
+	echo "hello function\n";
+}
+
+class one {
+	protected \$hello;
+	function hello() {
+		echo "hello class one\n";
+	}
+}
+
+class two {
+	public \$hello;
+	function hello() {
+		echo "hello class two\n";
+	}
+}
+
+\$one = new one;
+\$two = new two;
+\$one->hello();
+\$two->hello();
+hello();
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+	'apc.stat=0',
+);
+
+server_start($file, $args);
+
+list($host, $port) = explode(':', PHP_CLI_SERVER_ADDRESS);
+$port = intval($port)?:80;
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECT--
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+hello class one
+hello class two
+hello function
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_003.phpt php-5.4.19.bak/ext/apc/tests/apc54_003.phpt
--- php-5.4.19/ext/apc/tests/apc54_003.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_003.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,64 @@
+--TEST--
+APC: Bug #62190	Couldn't fetch DOMProcessingInstruction with APC and native obj (php 5.4 nts)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+\$node = new DOMDocument;
+\$node->loadHTML('<?foo>');
+echo "{\$node->firstChild->nextSibling->nodeType}\n";
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+	'apc.stat=0',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+
+--EXPECT--
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+7
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_004.phpt php-5.4.19.bak/ext/apc/tests/apc54_004.phpt
--- php-5.4.19/ext/apc/tests/apc54_004.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_004.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,93 @@
+--TEST--
+APC: Bug #62456	Incorrect description of notice variation 1 (php 5.4 nts)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+error_reporting(E_ALL);
+\$test = new StdClass();
+echo \$test->qwerty;
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+
+--EXPECTF--
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+<br />
+<b>Notice</b>:  Undefined property: stdClass::$qwerty in <b>/home/weltling/dws/src/apc_trunk/tests/index.php</b> on line <b>3</b><br />
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_005.phpt php-5.4.19.bak/ext/apc/tests/apc54_005.phpt
--- php-5.4.19/ext/apc/tests/apc54_005.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_005.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,216 @@
+--TEST--
+APC: Bug #62456	Incorrect description of notice variation 2 (php 5.4 nts)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+error_reporting(E_ALL);
+set_error_handler(function(\$errno, \$errstr, \$errfile, \$errline){
+	throw new ErrorException(\$errstr, 0, \$errno, \$errfile, \$errline);
+});
+\$test = new StdClass();
+echo \$test->qwerty;
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+
+--EXPECTF--
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'ErrorException' with message 'Undefined property: stdClass::$qwerty' in %sindex.php:6
+Stack trace:
+#0 %sindex.php(6): {closure}(8, 'Undefined prope...', '%s', 6, Array)
+#1 {main}
+  thrown in <b>%sindex.php</b> on line <b>6</b><br />
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_006.phpt php-5.4.19.bak/ext/apc/tests/apc54_006.phpt
--- php-5.4.19/ext/apc/tests/apc54_006.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_006.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,302 @@
+--TEST--
+APC: Bug #62419	RuntimeException throws fatal error if passing a previous exception to the ctor (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+error_reporting(E_ALL);
+throw new RuntimeException("Exception message", 0, new Exception());
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+
+--EXPECTF--
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+<br />
+<b>Fatal error</b>:  Uncaught exception 'Exception' in %sindex.php:2
+Stack trace:
+#0 {main}
+
+Next exception 'RuntimeException' with message 'Exception message' in %sindex.php:2
+Stack trace:
+#0 {main}
+  thrown in <b>%sindex.php</b> on line <b>2</b><br />
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_007.phpt php-5.4.19.bak/ext/apc/tests/apc54_007.phpt
--- php-5.4.19/ext/apc/tests/apc54_007.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_007.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,62 @@
+--TEST--
+APC: bug #62302 apc.include_once_override=1 made everything crash
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+	echo 1 == 1 ? sprintf("%s\n","This is me") : sprintf("%s\n","This is not me");
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+	'apc.include_once_override=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+
+--EXPECTF--
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+This is me
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_008.phpt php-5.4.19.bak/ext/apc/tests/apc54_008.phpt
--- php-5.4.19/ext/apc/tests/apc54_008.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_008.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,577 @@
+--TEST--
+APC: Bug #61912 Memory corruption in ext/dom (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+\$doc = new DOMDocument();
+\$doc->loadXML('<?xml version="1.0" encoding="UTF-8"?><root/>');
+
+\$xpath = new DOMXPath(\$doc);
+\$namespaces = \$xpath->query('namespace::*');
+
+var_dump(\$namespaces->item(0));
+print \$namespaces->item(0)->localName;
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECT--
+object(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmlobject(DOMNameSpaceNode)#3 (8) {
+  ["nodeName"]=>
+  string(9) "xmlns:xml"
+  ["nodeValue"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["nodeType"]=>
+  int(18)
+  ["prefix"]=>
+  string(3) "xml"
+  ["localName"]=>
+  string(3) "xml"
+  ["namespaceURI"]=>
+  string(36) "http://www.w3.org/XML/1998/namespace"
+  ["ownerDocument"]=>
+  string(22) "(object value omitted)"
+  ["parentNode"]=>
+  string(22) "(object value omitted)"
+}
+xmldone
diff -Nru php-5.4.19/ext/apc/tests/apc54_009.phpt php-5.4.19.bak/ext/apc/tests/apc54_009.phpt
--- php-5.4.19/ext/apc/tests/apc54_009.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_009.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,94 @@
+--TEST--
+APC: Bug #61824 apc produces strange notice (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+ini_set('display_errors', 1);
+\$d = new DOMDocument;
+\$d = new DOMXPath(\$d);
+var_export(\$d->document);
+echo "\n";
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECT--
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+DOMDocument::__set_state(array(
+))
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_010.phpt php-5.4.19.bak/ext/apc/tests/apc54_010.phpt
--- php-5.4.19/ext/apc/tests/apc54_010.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_010.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,71 @@
+--TEST--
+APC: Bug #61515 Cached script shows different result from uncached (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+abstract class Dog {
+    public abstract function bark();
+}
+abstract class SmallDog extends Dog {
+}
+class Charlie extends SmallDog {
+    function bark() {
+        echo "woof!\n";
+    }
+}
+\$charlie = new Charlie();
+\$charlie->bark();
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECT--
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+woof!
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_011.phpt php-5.4.19.bak/ext/apc/tests/apc54_011.phpt
--- php-5.4.19/ext/apc/tests/apc54_011.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_011.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,77 @@
+--TEST--
+APC: Bug #61219	method not found on 2nd request (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+\$there = 'world';
+
+class hello
+{
+    function __construct(\$p)
+    {   
+        \$this->testme(\$p);
+    }   
+
+    function testme(\$p)
+    {   
+        echo "testme \$p\n";
+    }   
+}
+
+\$h = new hello(\$there);
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.cache_by_default=1',
+	'apc.enable_cli=1',
+	'apc.slam_defense=0',
+	'apc.write_lock=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+--EXPECT--
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+testme world
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_012.phpt php-5.4.19.bak/ext/apc/tests/apc54_012.phpt
--- php-5.4.19/ext/apc/tests/apc54_012.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_012.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,61 @@
+--TEST--
+APC: Bug #61164 Crash with $_SERVER and ?: operator (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+\$_SERVER['HTTP_HOST'] ?: "foo";
+exit("mommy\n");
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.cache_by_default=1',
+	'apc.enable_cli=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+--EXPECT--
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+mommy
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_013.phpt php-5.4.19.bak/ext/apc/tests/apc54_013.phpt
--- php-5.4.19/ext/apc/tests/apc54_013.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_013.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,136 @@
+--TEST--
+APC: Closures basic test
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+error_reporting(E_ALL);
+class Hello
+{
+	public function say() {
+		\$cb = function() {
+			return "hello";
+		};
+
+		return \$cb();
+	}
+}
+
+\$h = new Hello;
+\$f = function() {return "world";};
+
+var_dump(\$h->say() . ' ' . \$f());
+var_dump(\$f);
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECTF--
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+string(11) "hello world"
+object(Closure)#2 (0) {
+}
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_014.phpt php-5.4.19.bak/ext/apc/tests/apc54_014.phpt
--- php-5.4.19/ext/apc/tests/apc54_014.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_014.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,97 @@
+--TEST--
+APC: Bug #61742 preload_path does not work due to incorrect string length (variant 1) (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+\$key = 'abc';
+\$b = apc_exists(\$key);
+var_dump(\$b);
+if (\$b) {
+	\$\$key = apc_fetch(\$key);
+	var_dump(\$\$key);
+}
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+	'apc.preload_path=' . dirname(__FILE__) . '/data',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECT--
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+bool(true)
+string(3) "123"
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_015.phpt php-5.4.19.bak/ext/apc/tests/apc54_015.phpt
--- php-5.4.19/ext/apc/tests/apc54_015.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_015.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,292 @@
+--TEST--
+APC: Test parent class properties in child class (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+class Hello
+{
+	protected \$one = '123aoeu';
+	protected \$two = array(10, 'jaga');
+}
+
+class World extends Hello
+{
+	public function loud0()
+	{
+		return \$this->one;
+	}
+	public function loud1()
+	{
+		return \$this->two;
+	}
+}
+
+\$w = new World;
+var_dump(\$w->loud0());
+var_dump(\$w->loud1());
+FL;
+
+$args = array(
+'apc.cache_by_default=On',
+'apc.canonicalize=On',
+'apc.coredump_unmap=Off',
+'apc.enable_cli=On',
+'apc.enabled=On',
+'apc.file_md5=Off',
+'apc.file_update_protection=2',
+'apc.filters=no',
+'apc.gc_ttl=3600',
+'apc.include_once_override=Off',
+'apc.lazy_classes=Off',
+'apc.lazy_functions=Off',
+'apc.max_file_size=1M',
+'apc.mmap_file_mask=no',
+'apc.num_files_hint=1000',
+'apc.preload_path=no',
+'apc.report_autofilter=Off',
+'apc.rfc1867=Off',
+'apc.rfc1867_freq=0',
+'apc.rfc1867_name=APC_UPLOAD_PROGRESS',
+'apc.rfc1867_prefix=upload_',
+'apc.rfc1867_ttl=3600',
+'apc.serializer=default',
+'apc.shm_segments=1',
+'apc.shm_size=128M',
+'apc.shm_strings_buffer=4M',
+'apc.slam_defense=On',
+'apc.stat=On',
+'apc.stat_ctime=Off',
+'apc.ttl=0',
+'apc.use_request_time=On',
+'apc.user_entries_hint=4096',
+'apc.user_ttl=0',
+'apc.write_lock=On',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECT--
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+string(7) "123aoeu"
+array(2) {
+  [0]=>
+  int(10)
+  [1]=>
+  string(4) "jaga"
+}
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_016.phpt php-5.4.19.bak/ext/apc/tests/apc54_016.phpt
--- php-5.4.19/ext/apc/tests/apc54_016.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_016.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,107 @@
+--TEST--
+APC: Test trait properties in using class (simple) (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+trait Hello
+{
+	protected \$one = '123aoeu';
+}
+
+class World
+{
+	use Hello;
+	public function loud()
+	{
+		return \$this->one;
+	}
+}
+
+\$w = new World;
+var_dump(\$w->loud());
+FL;
+
+$args = array(
+'apc.cache_by_default=On',
+'apc.canonicalize=On',
+'apc.coredump_unmap=Off',
+'apc.enable_cli=On',
+'apc.enabled=On',
+'apc.file_md5=Off',
+'apc.file_update_protection=2',
+'apc.filters=no',
+'apc.gc_ttl=3600',
+'apc.include_once_override=Off',
+'apc.lazy_classes=Off',
+'apc.lazy_functions=Off',
+'apc.max_file_size=1M',
+'apc.mmap_file_mask=no',
+'apc.num_files_hint=1000',
+'apc.preload_path=no',
+'apc.report_autofilter=Off',
+'apc.rfc1867=Off',
+'apc.rfc1867_freq=0',
+'apc.rfc1867_name=APC_UPLOAD_PROGRESS',
+'apc.rfc1867_prefix=upload_',
+'apc.rfc1867_ttl=3600',
+'apc.serializer=default',
+'apc.shm_segments=1',
+'apc.shm_size=128M',
+'apc.shm_strings_buffer=4M',
+'apc.slam_defense=On',
+'apc.stat=On',
+'apc.stat_ctime=Off',
+'apc.ttl=0',
+'apc.use_request_time=On',
+'apc.user_entries_hint=4096',
+'apc.user_ttl=0',
+'apc.write_lock=On',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECT--
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+string(7) "123aoeu"
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_017.phpt php-5.4.19.bak/ext/apc/tests/apc54_017.phpt
--- php-5.4.19/ext/apc/tests/apc54_017.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_017.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,119 @@
+--TEST--
+APC: Test use trait properties in a class and its parent (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+trait ParentHello
+{
+	protected \$three = 'parent trait';
+}
+
+trait Hello
+{
+	protected \$one = 'trait';
+}
+
+class ParentWorld
+{
+	use ParentHello;
+	protected \$two = 'parent';
+}
+
+class World extends ParentWorld
+{
+	use Hello;
+	protected \$me = 'self';
+	public function loud()
+	{
+		return \$this->me . ' | ' . \$this->one . ' | ' . \$this->two . ' | ' . \$this->three;
+	}
+}
+
+\$w = new World;
+var_dump(\$w->loud());
+FL;
+
+$args = array(
+'apc.cache_by_default=On',
+'apc.canonicalize=On',
+'apc.coredump_unmap=Off',
+'apc.enable_cli=On',
+'apc.enabled=On',
+'apc.file_md5=Off',
+'apc.file_update_protection=2',
+'apc.filters=no',
+'apc.gc_ttl=3600',
+'apc.include_once_override=Off',
+'apc.lazy_classes=Off',
+'apc.lazy_functions=Off',
+'apc.max_file_size=1M',
+'apc.mmap_file_mask=no',
+'apc.num_files_hint=1000',
+'apc.preload_path=no',
+'apc.report_autofilter=Off',
+'apc.rfc1867=Off',
+'apc.rfc1867_freq=0',
+'apc.rfc1867_name=APC_UPLOAD_PROGRESS',
+'apc.rfc1867_prefix=upload_',
+'apc.rfc1867_ttl=3600',
+'apc.serializer=default',
+'apc.shm_segments=1',
+'apc.shm_size=128M',
+'apc.shm_strings_buffer=4M',
+'apc.slam_defense=On',
+'apc.stat=On',
+'apc.stat_ctime=Off',
+'apc.ttl=0',
+'apc.use_request_time=On',
+'apc.user_entries_hint=4096',
+'apc.user_ttl=0',
+'apc.write_lock=On',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECT--
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+string(36) "self | trait | parent | parent trait"
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_018.phpt php-5.4.19.bak/ext/apc/tests/apc54_018.phpt
--- php-5.4.19/ext/apc/tests/apc54_018.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_018.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,265 @@
+--TEST--
+APC: Bug #59938 APCIterator fails with large user cache
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+//to fill apc cache (~200MB):
+for(\$i=0;\$i<50000;\$i++) {
+    \$value = str_repeat(md5(microtime()), 100);
+    apc_store('test-niko-asdfasdfasdfkjasdflkasjdfasf'.\$i, \$value);
+}
+
+//then later (usually after a few minutes) this won't work correctly:
+\$it = new ApcIterator('user', '#^test-niko-asdfasdfasdfkjasdflkasjdfasf#');
+var_dump(\$it->getTotalCount()); //returns 50000
+var_dump(\$it->current()); //returns false on error
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+	'apc.shm_size=256M',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 3; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECTF--
+int(50000)
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(42) "test-niko-asdfasdfasdfkjasdflkasjdfasf5675"
+  ["value"]=>
+  string(%d) "%s"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+int(50000)
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(42) "test-niko-asdfasdfasdfkjasdflkasjdfasf5675"
+  ["value"]=>
+  string(%d) "%s"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+int(50000)
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(42) "test-niko-asdfasdfasdfkjasdflkasjdfasf5675"
+  ["value"]=>
+  string(%d) "%s"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+int(50000)
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(42) "test-niko-asdfasdfasdfkjasdflkasjdfasf5675"
+  ["value"]=>
+  string(%d) "%s"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+int(50000)
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(42) "test-niko-asdfasdfasdfkjasdflkasjdfasf5675"
+  ["value"]=>
+  string(%d) "%s"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+int(50000)
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(42) "test-niko-asdfasdfasdfkjasdflkasjdfasf5675"
+  ["value"]=>
+  string(%d) "%s"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+int(50000)
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(42) "test-niko-asdfasdfasdfkjasdflkasjdfasf5675"
+  ["value"]=>
+  string(%d) "%s"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+int(50000)
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(42) "test-niko-asdfasdfasdfkjasdflkasjdfasf5675"
+  ["value"]=>
+  string(%d) "%s"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+int(50000)
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(42) "test-niko-asdfasdfasdfkjasdflkasjdfasf5675"
+  ["value"]=>
+  string(%d) "%s"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_019.phpt php-5.4.19.bak/ext/apc/tests/apc54_019.phpt
--- php-5.4.19/ext/apc/tests/apc54_019.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_019.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,169 @@
+--TEST--
+APC: Bug #59907	Issue with custom stream wrapper, include and APC
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+class StreamWrapper {
+    const PROTOCOL = 'mfx';
+    
+    private static \$data = array();
+    private \$path = null;
+    private \$position = 0;
+    
+    public function stream_open(\$path, \$mode , \$options , &\$opened_path) {
+        
+        \$this->path = \$path;
+        
+        return true;
+    }
+            	
+    public function stream_read(\$count) {
+        
+        \$ret = substr(self::\$data[\$this->path], \$this->position, \$count);
+        \$this->position += strlen(\$ret);
+        
+        return \$ret;
+    }
+    
+    public function stream_write(\$data) {
+        
+        self::\$data[\$this->path] = \$data;
+        
+        return strlen(\$data);
+    }
+    
+    public function stream_tell() {
+        
+        return \$this->position;
+    }
+    
+    public function stream_eof() {
+        
+        return \$this->position >= strlen(self::\$data[\$this->path]);
+    }
+    
+    public function url_stat(\$path, \$flags) {
+        
+        return \$this->stream_stat();
+    }
+    
+    public function stream_stat() {
+        
+        \$stat = array(
+            'dev' => 1,
+            'ino' => 1,
+            'mode' => 1,
+            'nlink' => 1,
+            'uid' => 1,
+            'gid' => 1,
+            'rdev' => 1,
+            'size' => 1,
+            'atime' => 1,
+            'mtime' => 1,
+            'ctime' => 1,
+            'blksize' => 1,
+            'blocks' => 1
+        );
+        
+        return array_merge(array_values(\$stat), \$stat);
+    }
+}
+
+stream_wrapper_register(StreamWrapper::PROTOCOL, 'StreamWrapper');
+
+\$class1 = '<?php class test1 {function __construct(){echo "test1\n";}}';
+\$class2 = '<?php class test2 {function __construct(){echo "test2\n";}}';
+
+file_put_contents('mfx://test1', \$class1);
+file_put_contents('mfx://test2', \$class2);
+
+include 'mfx://test1';
+include 'mfx://test2';
+
+new test1;
+new test2;
+
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.enable_cli=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+
+--EXPECTF--
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+test1
+test2
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_020.phpt php-5.4.19.bak/ext/apc/tests/apc54_020.phpt
--- php-5.4.19/ext/apc/tests/apc54_020.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_020.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,849 @@
+--TEST--
+APC: APCIterater basic test on file (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+\$fl = dirname(__FILE__) . '/file.php';
+file_put_contents(\$fl, '<?php echo "hello";');
+apc_compile_file(\$fl);
+\$it = new APCIterator('file');
+foreach (\$it as \$i) {
+	var_dump(\$i);
+}
+FL;
+
+$args = array(
+	'apc.cache_by_default=On',
+	'apc.canonicalize=On',
+	'apc.coredump_unmap=Off',
+	'apc.enable_cli=On',
+	'apc.enabled=On',
+	'apc.file_md5=Off',
+	'apc.file_update_protection=2',
+	'apc.filters=no',
+	'apc.gc_ttl=3600',
+	'apc.include_once_override=Off',
+	'apc.lazy_classes=Off',
+	'apc.lazy_functions=Off',
+	'apc.max_file_size=1M',
+	'apc.mmap_file_mask=no',
+	'apc.num_files_hint=1000',
+	'apc.preload_path=no',
+	'apc.report_autofilter=Off',
+	'apc.rfc1867=Off',
+	'apc.rfc1867_freq=0',
+	'apc.rfc1867_name=APC_UPLOAD_PROGRESS',
+	'apc.rfc1867_prefix=upload_',
+	'apc.rfc1867_ttl=3600',
+	'apc.serializer=default',
+	'apc.shm_segments=1',
+	'apc.shm_size=128M',
+	'apc.shm_strings_buffer=4M',
+	'apc.slam_defense=On',
+	'apc.stat=On',
+	'apc.stat_ctime=Off',
+	'apc.ttl=0',
+	'apc.use_request_time=On',
+	'apc.user_entries_hint=4096',
+	'apc.user_ttl=0',
+	'apc.write_lock=On',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+--CLEAN--
+unlink(dirname(__FILE__) . '/file.php');
+--EXPECTF--
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+array(12) {
+  ["type"]=>
+  string(4) "file"
+  ["filename"]=>
+  string(%d) "%sfile.php"
+  ["device"]=>
+  int(%d)
+  ["inode"]=>
+  int(%d)
+  ["key"]=>
+  string(%d) "%d %d"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_021.phpt php-5.4.19.bak/ext/apc/tests/apc54_021.phpt
--- php-5.4.19/ext/apc/tests/apc54_021.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_021.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,101 @@
+--TEST--
+APC: APCIterator file + apc_delete_file() (php 5.4)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+\$fl = dirname(__FILE__) . '/file.php';
+file_put_contents(\$fl, '<?php echo "hello";');
+
+apc_compile_file(\$fl);
+
+\$it = new APCIterator('file', ',file\.*,');
+foreach (\$it as \$i) {
+	var_dump(apc_delete_file(\$i['filename']));
+}
+FL;
+
+$args = array(
+	'apc.cache_by_default=On',
+	'apc.canonicalize=On',
+	'apc.coredump_unmap=Off',
+	'apc.enable_cli=On',
+	'apc.enabled=On',
+	'apc.file_md5=Off',
+	'apc.file_update_protection=0',
+	'apc.filters=no',
+	'apc.gc_ttl=3600',
+	'apc.include_once_override=Off',
+	'apc.lazy_classes=Off',
+	'apc.lazy_functions=Off',
+	'apc.max_file_size=1M',
+	'apc.mmap_file_mask=no',
+	'apc.num_files_hint=1000',
+	'apc.preload_path=no',
+	'apc.report_autofilter=Off',
+	'apc.rfc1867=Off',
+	'apc.rfc1867_freq=0',
+	'apc.rfc1867_name=APC_UPLOAD_PROGRESS',
+	'apc.rfc1867_prefix=upload_',
+	'apc.rfc1867_ttl=3600',
+	'apc.serializer=default',
+	'apc.shm_segments=1',
+	'apc.shm_size=128M',
+	'apc.shm_strings_buffer=4M',
+	'apc.slam_defense=On',
+	'apc.stat=On',
+	'apc.stat_ctime=Off',
+	'apc.ttl=0',
+	'apc.use_request_time=On',
+	'apc.user_entries_hint=4096',
+	'apc.user_ttl=0',
+	'apc.write_lock=On',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+--CLEAN--
+unlink(dirname(__FILE__) . '/file.php');
+--EXPECT--
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+bool(true)
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_bug62699_2.phpt php-5.4.19.bak/ext/apc/tests/apc54_bug62699_2.phpt
--- php-5.4.19/ext/apc/tests/apc54_bug62699_2.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_bug62699_2.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,110 @@
+--TEST--
+APC: Bug #62699 Wrong behavior with traits (variant 2)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+
+trait A {
+	static \$foo = 42;
+}
+class Foo {
+    use A;
+	static \$foo = 24;
+    public function test() {
+        var_dump(self::\$foo);
+    }
+}
+\$foo = new Foo;
+\$foo->test();
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.cache_by_default=1',
+	'apc.enable_cli=1',
+	'apc.shm_segments=1',
+	'apc.optimization=0',
+	'apc.shm_size=384M',
+	'apc.ttl=0',
+	'apc.user_ttl=0',
+	'apc.num_files_hint=4096',
+	'apc.canonicalize=0',
+	'apc.write_lock=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+--EXPECTF--
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+<br />
+<b>Fatal error</b>:  Foo and A define the same property ($foo) in the composition of Foo. However, the definition differs and is considered incompatible. Class was composed in <b>%sindex.php</b> on line <b>11</b><br />
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_bug62699.phpt php-5.4.19.bak/ext/apc/tests/apc54_bug62699.phpt
--- php-5.4.19/ext/apc/tests/apc54_bug62699.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_bug62699.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,149 @@
+--TEST--
+APC: Bug #62699 Wrong behavior with traits
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+
+trait A {
+    public function test() {
+        var_dump(__TRAIT__);
+    }
+	public function tast() {
+		var_dump(__TRAIT__);
+	}
+}
+class Foo {
+    use A {
+        A::test as test2;
+        A::tast as public;
+    }
+    public function test() {
+        var_dump(__CLASS__);
+    }
+}
+\$foo = new Foo;
+\$foo->test();
+\$foo->test2();
+\$foo->tast();
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.cache_by_default=1',
+	'apc.enable_cli=1',
+	'apc.shm_segments=1',
+	'apc.optimization=0',
+	'apc.shm_size=384M',
+	'apc.ttl=0',
+	'apc.user_ttl=0',
+	'apc.num_files_hint=4096',
+	'apc.canonicalize=0',
+	'apc.write_lock=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+--EXPECT--
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+string(3) "Foo"
+string(1) "A"
+string(1) "A"
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_error_010_2.phpt php-5.4.19.bak/ext/apc/tests/apc54_error_010_2.phpt
--- php-5.4.19/ext/apc/tests/apc54_error_010_2.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_error_010_2.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,83 @@
+--TEST--
+Exclude trait method 
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+trait foo {
+	public function test() { return 3; }
+}
+trait c {
+	public function test() { return 2; }
+}
+
+trait b {
+	public function test() { return 1; }
+}
+
+class bar {
+	use foo, c { c::test insteadof foo, b; }
+}
+
+\$x = new bar;
+var_dump(\$x->test());
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.cache_by_default=1',
+	'apc.enable_cli=1',
+	'apc.shm_segments=1',
+	'apc.optimization=0',
+	'apc.ttl=0',
+	'apc.user_ttl=0',
+	'apc.num_files_hint=4096',
+	'apc.canonicalize=0',
+	'apc.write_lock=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+--EXPECTF--
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+int(2)
+done
diff -Nru php-5.4.19/ext/apc/tests/apc54_error_010.phpt php-5.4.19.bak/ext/apc/tests/apc54_error_010.phpt
--- php-5.4.19/ext/apc/tests/apc54_error_010.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc54_error_010.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,114 @@
+--TEST--
+Trying to exclude trait method multiple times (origin Zend/tests/traits/error_010.phpt)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$file = <<<FL
+trait foo {
+	public function test() { return 3; }
+}
+trait c {
+	public function test() { return 2; }
+}
+
+trait b {
+	public function test() { return 1; }
+}
+
+class bar {
+	use foo, c { c::test insteadof foo, b; }
+	use foo, c { c::test insteadof foo, b; }
+}
+
+\$x = new bar;
+var_dump(\$x->test());
+FL;
+
+$args = array(
+	'apc.enabled=1',
+	'apc.cache_by_default=1',
+	'apc.enable_cli=1',
+	'apc.shm_segments=1',
+	'apc.optimization=0',
+	'apc.ttl=0',
+	'apc.user_ttl=0',
+	'apc.num_files_hint=4096',
+	'apc.canonicalize=0',
+	'apc.write_lock=1',
+);
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+--EXPECTF--
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+<br />
+<b>Fatal error</b>:  Failed to evaluate a trait precedence (test). Method of trait foo was defined to be excluded multiple times in <b>%sindex.php</b> on line <b>15</b><br />
+done
diff -Nru php-5.4.19/ext/apc/tests/apc_bin_001.phpt php-5.4.19.bak/ext/apc/tests/apc_bin_001.phpt
--- php-5.4.19/ext/apc/tests/apc_bin_001.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_bin_001.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,24 @@
+--TEST--
+APC: bindump user cache
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+--FILE--
+<?php
+apc_clear_cache('file');
+apc_store('testkey','testvalue');
+apc_bin_dump();
+$dump = apc_bin_dump(array(), NULL);
+apc_clear_cache('user');
+var_dump(apc_fetch('testkey'));
+apc_bin_load($dump, APC_BIN_VERIFY_MD5 | APC_BIN_VERIFY_CRC32);
+var_dump(apc_fetch('testkey'));
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+bool(false)
+string(9) "testvalue"
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/apc_bin_002-1.inc php-5.4.19.bak/ext/apc/tests/apc_bin_002-1.inc
--- php-5.4.19/ext/apc/tests/apc_bin_002-1.inc	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_bin_002-1.inc	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,42 @@
+<?php
+
+$my_class = New my_class();
+$my_i_class = New my_i_class();
+
+echo "apc bindump 002 test\n";
+echo "\n";
+echo "global scope execution:            Success\n";
+echo "\n";
+echo "function execution:                ".my_function()."\n";
+echo "\n";
+
+echo "class static method:               ".my_class::my_static_method()."\n";
+echo "class dynamic method:              ".$my_class->my_method()."\n";
+echo "class static property:             ".my_class::$my_static_property."\n";
+echo "class dynamic property:            ".$my_class->my_property."\n";
+echo "class constant:                    ".my_class::my_constant."\n";
+echo "\n";
+echo "inherited class static method:     ".my_i_class::my_static_method()."\n";
+echo "inherited class dynamic method:    ".$my_i_class->my_method()."\n";
+echo "inherited class static property:   ".my_i_class::$my_static_property."\n";
+echo "inherited class dynamic property:  ".$my_i_class->my_property."\n";
+echo "inherited class constant:          ".my_i_class::my_constant."\n";
+echo "\n";
+
+
+
+function my_function() { return "Success"; }
+
+
+class my_class {
+  static $my_static_property = "Success";
+  var $my_property = "Success";
+  const my_constant = "Success";
+  static function my_static_method() { return "Success"; }
+  function my_method() { return "Success"; }
+}
+
+class my_i_class extends my_class {
+  function dummy() { return 1; }
+}
+
diff -Nru php-5.4.19/ext/apc/tests/apc_bin_002-2.inc php-5.4.19.bak/ext/apc/tests/apc_bin_002-2.inc
--- php-5.4.19/ext/apc/tests/apc_bin_002-2.inc	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_bin_002-2.inc	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,5 @@
+<?php
+
+echo "Failed to use cached version!\n";
+
+?>
diff -Nru php-5.4.19/ext/apc/tests/apc_bin_002.phpt php-5.4.19.bak/ext/apc/tests/apc_bin_002.phpt
--- php-5.4.19/ext/apc/tests/apc_bin_002.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/apc_bin_002.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,53 @@
+--TEST--
+APC: bindump file cache part 1
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.stat=0
+apc.cache_by_default=1
+apc.filters=
+report_memleaks = Off
+--FILE--
+<?php
+
+define('filename',dirname(__FILE__).'/apc_bin_002.inc');
+define('filename1',dirname(__FILE__).'/apc_bin_002-1.inc');
+define('filename2',dirname(__FILE__).'/apc_bin_002-2.inc');
+
+copy(filename1, filename);
+apc_compile_file(filename);
+$data = apc_bin_dump(NULL, NULL);
+
+apc_clear_cache();
+
+copy(filename2, filename);
+apc_bin_load($data, APC_BIN_VERIFY_MD5 | APC_BIN_VERIFY_CRC32);
+include(filename);
+
+unlink(filename);
+
+?>
+===DONE===
+<?  php exit(0); ?>
+--EXPECTF--
+apc bindump 002 test
+
+global scope execution:            Success
+
+function execution:                Success
+
+class static method:               Success
+class dynamic method:              Success
+class static property:             Success
+class dynamic property:            Success
+class constant:                    Success
+
+inherited class static method:     Success
+inherited class dynamic method:    Success
+inherited class static property:   Success
+inherited class dynamic property:  Success
+inherited class constant:          Success
+
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/bug38779.phpt php-5.4.19.bak/ext/apc/tests/bug38779.phpt
--- php-5.4.19/ext/apc/tests/bug38779.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/bug38779.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,65 @@
+--TEST--
+Bug #61398 APC fails to find class methods on user stream wrappers
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$args = array(
+	'apc.enabled=1',
+	'apc.cache_by_default=1',
+	'apc.enable_cli=1',
+	'apc.canonicalize=1',
+	'apc.stat=1',
+	'allow_url_include=1',
+);
+
+$file = <<<FL
+\$s = '<?php echo "hello\n";';
+include "data://text/plain,\$s";
+FL;
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+?>
+--EXPECT--
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+hello
+done
diff -Nru php-5.4.19/ext/apc/tests/bug61398_2.phpt php-5.4.19.bak/ext/apc/tests/bug61398_2.phpt
--- php-5.4.19/ext/apc/tests/bug61398_2.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/bug61398_2.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,123 @@
+--TEST--
+Bug #61398 APC fails to find class methods (based on ext/standard/tests/file/fopencookie.phpt)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$args = array(
+	'apc.enabled=1',
+	'apc.cache_by_default=1',
+	'apc.enable_cli=1',
+);
+
+$file = <<<FL
+class userstream {
+	public \$position = 0;
+	public \$data = "If you can read this, it worked\n";
+	
+	function stream_open(\$path, \$mode, \$options, &\$opened_path)
+	{
+		return true;
+	}
+	
+	function stream_read(\$count)
+	{
+		\$ret = substr(\$this->data, \$this->position, \$count);
+		\$this->position += strlen(\$ret);
+		return \$ret;
+	}
+
+	function stream_tell()
+	{
+		return \$this->position;
+	}
+
+	function stream_eof()
+	{
+		return \$this->position >= strlen(\$this->data);
+	}
+
+	function stream_seek(\$offset, \$whence)
+	{
+		switch(\$whence) {
+			case SEEK_SET:
+				if (\$offset < strlen(\$this->data) && \$offset >= 0) {
+					\$this->position = \$offset;
+					return true;
+				} else {
+					return false;
+				}
+				break;
+			case SEEK_CUR:
+				if (\$offset >= 0) {
+					\$this->position += \$offset;
+					return true;
+				} else {
+					return false;
+				}
+				break;
+			case SEEK_END:
+				if (strlen(\$this->data) + \$offset >= 0) {
+					\$this->position = strlen(\$this->data) + \$offset;
+					return true;
+				} else {
+					return false;
+				}
+				break;
+			default:
+				return false;
+		}
+	}
+	function stream_stat() {
+		return array('size' => strlen(\$this->data));
+	}
+}
+stream_wrapper_register("cookietest", "userstream");
+include("cookietest://foo");
+FL;
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+?>
+--EXPECT--
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+If you can read this, it worked
+done
diff -Nru php-5.4.19/ext/apc/tests/bug61398.phpt php-5.4.19.bak/ext/apc/tests/bug61398.phpt
--- php-5.4.19/ext/apc/tests/bug61398.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/bug61398.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,113 @@
+--TEST--
+Bug #61398 APC fails to find class methods (based on bug #38779)
+--SKIPIF--
+<?php
+    require_once(dirname(__FILE__) . '/skipif.inc'); 
+    if (PHP_MAJOR_VERSION < 5 || (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION < 4)) {
+		die('skip PHP 5.4+ only');
+	}
+--FILE--
+<?php
+include "server_test.inc";
+
+$args = array(
+	'apc.enabled=1',
+	'apc.cache_by_default=1',
+	'apc.enable_cli=1',
+);
+
+$data = '<' . "?php \n\"\";ll l\n ?" . '>';
+$file = <<<FL
+class Loader {
+	private \$position;
+	private \$data;
+	public function stream_open(\$path, \$mode, \$options, &\$opened_path)  {
+		\$this->data = '$data';
+		\$this->position = 0;
+		return true;
+	}
+	function stream_read(\$count) {
+		\$ret = substr(\$this->data, \$this->position, \$count);
+		\$this->position += strlen(\$ret);
+		return \$ret;
+	}
+	function stream_eof() {
+		return \$this->position >= strlen(\$this->data);
+	}
+	function stream_stat() {
+		return array('size' => strlen(\$this->data));
+	}
+}
+stream_wrapper_register('Loader', 'Loader');
+require 'Loader://qqq.php';
+FL;
+
+server_start($file, $args);
+
+for ($i = 0; $i < 10; $i++) {
+	run_test_simple();
+}
+echo 'done';
+?>
+--EXPECTF--	
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+<br />
+<b>Parse error</b>:  syntax error, unexpected 'l' (T_STRING) in <b>Loader://qqq.php</b> on line <b>2</b><br />
+done
diff -Nru php-5.4.19/ext/apc/tests/bug62757.phpt php-5.4.19.bak/ext/apc/tests/bug62757.phpt
--- php-5.4.19/ext/apc/tests/bug62757.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/bug62757.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,54 @@
+--TEST--
+Bug #62757 (php-fpm carshed when used apc_bin_dumpfile with apc.serializer)
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.stat=0
+apc.cache_by_default=1
+apc.serializer=php
+report_memleaks=0
+--FILE--
+<?php
+$filename = dirname(__FILE__) . '/bug62757_file.php';
+$bin_filename = dirname(__FILE__)  . "/bug62757.bin";
+$file_contents = '<?php
+function test($arr=array()) {
+    return $arr;
+}
+
+class ApiLib {
+    private $arr = array( \'abcd\' => array() );
+    protected $str = "constant string";
+    public function test() {
+         var_dump($this->str);
+         return $this->arr;
+    }
+}
+';
+file_put_contents($filename, $file_contents);
+apc_compile_file($filename);
+apc_bin_dumpfile(array($filename), null, $bin_filename);
+apc_clear_cache();
+apc_bin_loadfile($bin_filename);
+include $filename;
+
+var_dump(test());
+$lib = new ApiLib();
+var_dump($lib->test());
+echo "okey\n";
+?>
+--CLEAN--
+<?php
+unlink(dirname(__FILE__) . '/bug62757_file.php');
+unlink(dirname(__FILE__)  . "/bug62757.bin");
+?>
+--EXPECT--
+array(0) {
+}
+string(15) "constant string"
+array(1) {
+  ["abcd"]=>
+  array(0) {
+  }
+}
+okey
diff -Nru php-5.4.19/ext/apc/tests/bug62765.phpt php-5.4.19.bak/ext/apc/tests/bug62765.phpt
--- php-5.4.19/ext/apc/tests/bug62765.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/bug62765.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,42 @@
+--TEST--
+Bug #62765 (apc_bin_dumpfile report Fatal error when there is "goto" in function)
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.stat=0
+apc.cache_by_default=1
+apc.filters=
+report_memleaks=0
+--FILE--
+<?php
+$filename = dirname(__FILE__) . '/bug62765_file.php';
+$bin_filename = dirname(__FILE__)  . "/bug62765.bin";
+$file_contents = '<?php
+function dummy ($a) {
+    if ($a) {
+        echo 1;
+    } else {
+        echo 2;
+    }
+    goto ret;
+ret:
+    return 2;
+}
+';
+file_put_contents($filename, $file_contents);
+apc_compile_file($filename);
+apc_bin_dumpfile(array($filename), null, $bin_filename);
+apc_bin_loadfile($bin_filename);
+include $filename;
+
+echo dummy(0) . "\n";
+echo "okey\n";
+?>
+--CLEAN--
+<?php
+unlink(dirname(__FILE__) . '/bug62765_file.php');
+unlink(dirname(__FILE__)  . "/bug62765.bin");
+?>
+--EXPECT--
+22
+okey
diff -Nru php-5.4.19/ext/apc/tests/bug62802.phpt php-5.4.19.bak/ext/apc/tests/bug62802.phpt
--- php-5.4.19/ext/apc/tests/bug62802.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/bug62802.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,35 @@
+--TEST--
+Bug #62802 (Crash when use apc_bin_dump/load)
+--SKIPIF--
+<?php
+require_once(dirname(__FILE__) . '/skipif.inc');
+if (version_compare(PHP_VERSION, "5.4.0") < 0) {
+    die('skip for PHP < 5.4');
+}
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.stat=0
+apc.cache_by_default=1
+report_memleaks=0
+--FILE--
+<?php
+$filename = dirname(__FILE__) . '/bug62802_file.php';
+$file_contents = '<?php
+$a = "uuu";
+';
+file_put_contents($filename, $file_contents);
+apc_compile_file($filename);
+$data = apc_bin_dump(null, null);
+apc_clear_cache();
+apc_bin_load($data, APC_BIN_VERIFY_MD5 | APC_BIN_VERIFY_CRC32);
+include $filename;
+
+var_dump($a);
+?>
+--CLEAN--
+<?php
+unlink(dirname(__FILE__) . '/bug62802_file.php');
+?>
+--EXPECT--
+string(3) "uuu"
diff -Nru php-5.4.19/ext/apc/tests/data/abc.data php-5.4.19.bak/ext/apc/tests/data/abc.data
--- php-5.4.19/ext/apc/tests/data/abc.data	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/data/abc.data	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1 @@
+s:3:"123"
diff -Nru php-5.4.19/ext/apc/tests/iterator_001.phpt php-5.4.19.bak/ext/apc/tests/iterator_001.phpt
--- php-5.4.19/ext/apc/tests/iterator_001.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/iterator_001.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,110 @@
+--TEST--
+APC: APCIterator general
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$it = new APCIterator('user');
+for($i = 0; $i < 41; $i++) {
+  apc_store("key$i", "value$i");
+}
+foreach($it as $key=>$value) {
+  $vals[$key] = $value['key'];
+}
+ksort($vals);
+var_dump($vals);
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECT--
+array(41) {
+  ["key0"]=>
+  string(4) "key0"
+  ["key1"]=>
+  string(4) "key1"
+  ["key10"]=>
+  string(5) "key10"
+  ["key11"]=>
+  string(5) "key11"
+  ["key12"]=>
+  string(5) "key12"
+  ["key13"]=>
+  string(5) "key13"
+  ["key14"]=>
+  string(5) "key14"
+  ["key15"]=>
+  string(5) "key15"
+  ["key16"]=>
+  string(5) "key16"
+  ["key17"]=>
+  string(5) "key17"
+  ["key18"]=>
+  string(5) "key18"
+  ["key19"]=>
+  string(5) "key19"
+  ["key2"]=>
+  string(4) "key2"
+  ["key20"]=>
+  string(5) "key20"
+  ["key21"]=>
+  string(5) "key21"
+  ["key22"]=>
+  string(5) "key22"
+  ["key23"]=>
+  string(5) "key23"
+  ["key24"]=>
+  string(5) "key24"
+  ["key25"]=>
+  string(5) "key25"
+  ["key26"]=>
+  string(5) "key26"
+  ["key27"]=>
+  string(5) "key27"
+  ["key28"]=>
+  string(5) "key28"
+  ["key29"]=>
+  string(5) "key29"
+  ["key3"]=>
+  string(4) "key3"
+  ["key30"]=>
+  string(5) "key30"
+  ["key31"]=>
+  string(5) "key31"
+  ["key32"]=>
+  string(5) "key32"
+  ["key33"]=>
+  string(5) "key33"
+  ["key34"]=>
+  string(5) "key34"
+  ["key35"]=>
+  string(5) "key35"
+  ["key36"]=>
+  string(5) "key36"
+  ["key37"]=>
+  string(5) "key37"
+  ["key38"]=>
+  string(5) "key38"
+  ["key39"]=>
+  string(5) "key39"
+  ["key4"]=>
+  string(4) "key4"
+  ["key40"]=>
+  string(5) "key40"
+  ["key5"]=>
+  string(4) "key5"
+  ["key6"]=>
+  string(4) "key6"
+  ["key7"]=>
+  string(4) "key7"
+  ["key8"]=>
+  string(4) "key8"
+  ["key9"]=>
+  string(4) "key9"
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/iterator_002.phpt php-5.4.19.bak/ext/apc/tests/iterator_002.phpt
--- php-5.4.19/ext/apc/tests/iterator_002.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/iterator_002.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,36 @@
+--TEST--
+APC: APCIterator regex
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$it = new APCIterator('user', '/key[0-9]0/');
+for($i = 0; $i < 41; $i++) {
+  apc_store("key$i", "value$i");
+}
+foreach($it as $key=>$value) {
+  $vals[$key] = $value['key'];
+}
+ksort($vals);
+var_dump($vals);
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECT--
+array(4) {
+  ["key10"]=>
+  string(5) "key10"
+  ["key20"]=>
+  string(5) "key20"
+  ["key30"]=>
+  string(5) "key30"
+  ["key40"]=>
+  string(5) "key40"
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/iterator_003.phpt php-5.4.19.bak/ext/apc/tests/iterator_003.phpt
--- php-5.4.19/ext/apc/tests/iterator_003.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/iterator_003.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,110 @@
+--TEST--
+APC: APCIterator chunk size
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$it = new APCIterator('user', NULL, APC_ITER_ALL, 10);
+for($i = 0; $i < 41; $i++) {
+  apc_store("key$i", "value$i");
+}
+foreach($it as $key=>$value) {
+  $vals[$key] = $value['key'];
+}
+ksort($vals);
+var_dump($vals);
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECT--
+array(41) {
+  ["key0"]=>
+  string(4) "key0"
+  ["key1"]=>
+  string(4) "key1"
+  ["key10"]=>
+  string(5) "key10"
+  ["key11"]=>
+  string(5) "key11"
+  ["key12"]=>
+  string(5) "key12"
+  ["key13"]=>
+  string(5) "key13"
+  ["key14"]=>
+  string(5) "key14"
+  ["key15"]=>
+  string(5) "key15"
+  ["key16"]=>
+  string(5) "key16"
+  ["key17"]=>
+  string(5) "key17"
+  ["key18"]=>
+  string(5) "key18"
+  ["key19"]=>
+  string(5) "key19"
+  ["key2"]=>
+  string(4) "key2"
+  ["key20"]=>
+  string(5) "key20"
+  ["key21"]=>
+  string(5) "key21"
+  ["key22"]=>
+  string(5) "key22"
+  ["key23"]=>
+  string(5) "key23"
+  ["key24"]=>
+  string(5) "key24"
+  ["key25"]=>
+  string(5) "key25"
+  ["key26"]=>
+  string(5) "key26"
+  ["key27"]=>
+  string(5) "key27"
+  ["key28"]=>
+  string(5) "key28"
+  ["key29"]=>
+  string(5) "key29"
+  ["key3"]=>
+  string(4) "key3"
+  ["key30"]=>
+  string(5) "key30"
+  ["key31"]=>
+  string(5) "key31"
+  ["key32"]=>
+  string(5) "key32"
+  ["key33"]=>
+  string(5) "key33"
+  ["key34"]=>
+  string(5) "key34"
+  ["key35"]=>
+  string(5) "key35"
+  ["key36"]=>
+  string(5) "key36"
+  ["key37"]=>
+  string(5) "key37"
+  ["key38"]=>
+  string(5) "key38"
+  ["key39"]=>
+  string(5) "key39"
+  ["key4"]=>
+  string(4) "key4"
+  ["key40"]=>
+  string(5) "key40"
+  ["key5"]=>
+  string(4) "key5"
+  ["key6"]=>
+  string(4) "key6"
+  ["key7"]=>
+  string(4) "key7"
+  ["key8"]=>
+  string(4) "key8"
+  ["key9"]=>
+  string(4) "key9"
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/iterator_004.phpt php-5.4.19.bak/ext/apc/tests/iterator_004.phpt
--- php-5.4.19/ext/apc/tests/iterator_004.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/iterator_004.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,36 @@
+--TEST--
+APC: APCIterator regex & chunk size & list
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$it = new APCIterator('user', '/key[0-9]0/', APC_ITER_ALL, 1, APC_LIST_ACTIVE);
+for($i = 0; $i < 41; $i++) {
+  apc_store("key$i", "value$i");
+}
+foreach($it as $key=>$value) {
+  $vals[$key] = $value['key'];
+}
+ksort($vals);
+var_dump($vals);
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECT--
+array(4) {
+  ["key10"]=>
+  string(5) "key10"
+  ["key20"]=>
+  string(5) "key20"
+  ["key30"]=>
+  string(5) "key30"
+  ["key40"]=>
+  string(5) "key40"
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/iterator_005.phpt php-5.4.19.bak/ext/apc/tests/iterator_005.phpt
--- php-5.4.19/ext/apc/tests/iterator_005.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/iterator_005.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,112 @@
+--TEST--
+APC: APCIterator delete
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+--FILE--
+<?php
+
+$vals = array();
+$vals2 = array();
+$it = new APCIterator('user', '/key[0-9]0/');
+for($i = 0; $i < 41; $i++) {
+  apc_store("key$i", "value$i");
+}
+apc_delete($it);
+$it2 = new APCIterator('user');
+foreach($it as $key=>$value) {
+  $vals[$key] = $value['key'];
+}
+foreach($it2 as $key=>$value) {
+  $vals2[$key] = $value['key'];
+}
+ksort($vals2);
+var_dump($vals);
+var_dump($vals2);
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECT--
+array(0) {
+}
+array(37) {
+  ["key0"]=>
+  string(4) "key0"
+  ["key1"]=>
+  string(4) "key1"
+  ["key11"]=>
+  string(5) "key11"
+  ["key12"]=>
+  string(5) "key12"
+  ["key13"]=>
+  string(5) "key13"
+  ["key14"]=>
+  string(5) "key14"
+  ["key15"]=>
+  string(5) "key15"
+  ["key16"]=>
+  string(5) "key16"
+  ["key17"]=>
+  string(5) "key17"
+  ["key18"]=>
+  string(5) "key18"
+  ["key19"]=>
+  string(5) "key19"
+  ["key2"]=>
+  string(4) "key2"
+  ["key21"]=>
+  string(5) "key21"
+  ["key22"]=>
+  string(5) "key22"
+  ["key23"]=>
+  string(5) "key23"
+  ["key24"]=>
+  string(5) "key24"
+  ["key25"]=>
+  string(5) "key25"
+  ["key26"]=>
+  string(5) "key26"
+  ["key27"]=>
+  string(5) "key27"
+  ["key28"]=>
+  string(5) "key28"
+  ["key29"]=>
+  string(5) "key29"
+  ["key3"]=>
+  string(4) "key3"
+  ["key31"]=>
+  string(5) "key31"
+  ["key32"]=>
+  string(5) "key32"
+  ["key33"]=>
+  string(5) "key33"
+  ["key34"]=>
+  string(5) "key34"
+  ["key35"]=>
+  string(5) "key35"
+  ["key36"]=>
+  string(5) "key36"
+  ["key37"]=>
+  string(5) "key37"
+  ["key38"]=>
+  string(5) "key38"
+  ["key39"]=>
+  string(5) "key39"
+  ["key4"]=>
+  string(4) "key4"
+  ["key5"]=>
+  string(4) "key5"
+  ["key6"]=>
+  string(4) "key6"
+  ["key7"]=>
+  string(4) "key7"
+  ["key8"]=>
+  string(4) "key8"
+  ["key9"]=>
+  string(4) "key9"
+}
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/iterator_006.phpt php-5.4.19.bak/ext/apc/tests/iterator_006.phpt
--- php-5.4.19/ext/apc/tests/iterator_006.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/iterator_006.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,1536 @@
+--TEST--
+APC: APCIterator formats 
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+apc.file_update_protection=0
+apc.user_entries_hint=4096
+--FILE--
+<?php
+
+$formats = array( 
+                  APC_ITER_TYPE,
+                  APC_ITER_KEY,
+                  APC_ITER_FILENAME,
+                  APC_ITER_DEVICE,
+                  APC_ITER_INODE,
+                  APC_ITER_VALUE,
+                  APC_ITER_MD5,
+                  APC_ITER_NUM_HITS,
+                  APC_ITER_MTIME,
+                  APC_ITER_CTIME,
+                  APC_ITER_DTIME,
+                  APC_ITER_ATIME,
+                  APC_ITER_REFCOUNT,
+                  APC_ITER_MEM_SIZE,
+                  APC_ITER_TTL,
+                  APC_ITER_NONE,
+                  APC_ITER_ALL,
+                  APC_ITER_ALL & ~APC_ITER_TTL,
+                  APC_ITER_KEY | APC_ITER_NUM_HITS | APC_ITER_MEM_SIZE,
+                );
+
+$it_array = array();
+
+foreach ($formats as $idx => $format) {
+  $it_array[$idx] = new APCIterator('user', NULL, $format);
+}
+
+for($i = 0; $i < 11; $i++) {
+  apc_store("key$i", "value$i");
+}
+
+foreach ($it_array as $idx => $it) {
+  print_it($it, $idx);
+}
+
+function print_it($it, $idx) {
+  echo "IT #$idx\n";
+  echo "============================\n";
+  foreach ($it as $key=>$value) {
+    var_dump($key);
+    var_dump($value);
+  }
+  echo "============================\n\n";
+}
+
+?>
+===DONE===
+<?php exit(0); ?>
+--EXPECTF--
+IT #0
+============================
+string(5) "key10"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+string(4) "key0"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+string(4) "key1"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+string(4) "key2"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+string(4) "key3"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+string(4) "key4"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+string(4) "key5"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+string(4) "key6"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+string(4) "key7"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+string(4) "key8"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+string(4) "key9"
+array(1) {
+  ["type"]=>
+  string(4) "user"
+}
+============================
+
+IT #1
+============================
+string(5) "key10"
+array(1) {
+  ["key"]=>
+  string(5) "key10"
+}
+string(4) "key0"
+array(1) {
+  ["key"]=>
+  string(4) "key0"
+}
+string(4) "key1"
+array(1) {
+  ["key"]=>
+  string(4) "key1"
+}
+string(4) "key2"
+array(1) {
+  ["key"]=>
+  string(4) "key2"
+}
+string(4) "key3"
+array(1) {
+  ["key"]=>
+  string(4) "key3"
+}
+string(4) "key4"
+array(1) {
+  ["key"]=>
+  string(4) "key4"
+}
+string(4) "key5"
+array(1) {
+  ["key"]=>
+  string(4) "key5"
+}
+string(4) "key6"
+array(1) {
+  ["key"]=>
+  string(4) "key6"
+}
+string(4) "key7"
+array(1) {
+  ["key"]=>
+  string(4) "key7"
+}
+string(4) "key8"
+array(1) {
+  ["key"]=>
+  string(4) "key8"
+}
+string(4) "key9"
+array(1) {
+  ["key"]=>
+  string(4) "key9"
+}
+============================
+
+IT #2
+============================
+string(5) "key10"
+array(0) {
+}
+string(4) "key0"
+array(0) {
+}
+string(4) "key1"
+array(0) {
+}
+string(4) "key2"
+array(0) {
+}
+string(4) "key3"
+array(0) {
+}
+string(4) "key4"
+array(0) {
+}
+string(4) "key5"
+array(0) {
+}
+string(4) "key6"
+array(0) {
+}
+string(4) "key7"
+array(0) {
+}
+string(4) "key8"
+array(0) {
+}
+string(4) "key9"
+array(0) {
+}
+============================
+
+IT #3
+============================
+string(5) "key10"
+array(0) {
+}
+string(4) "key0"
+array(0) {
+}
+string(4) "key1"
+array(0) {
+}
+string(4) "key2"
+array(0) {
+}
+string(4) "key3"
+array(0) {
+}
+string(4) "key4"
+array(0) {
+}
+string(4) "key5"
+array(0) {
+}
+string(4) "key6"
+array(0) {
+}
+string(4) "key7"
+array(0) {
+}
+string(4) "key8"
+array(0) {
+}
+string(4) "key9"
+array(0) {
+}
+============================
+
+IT #4
+============================
+string(5) "key10"
+array(0) {
+}
+string(4) "key0"
+array(0) {
+}
+string(4) "key1"
+array(0) {
+}
+string(4) "key2"
+array(0) {
+}
+string(4) "key3"
+array(0) {
+}
+string(4) "key4"
+array(0) {
+}
+string(4) "key5"
+array(0) {
+}
+string(4) "key6"
+array(0) {
+}
+string(4) "key7"
+array(0) {
+}
+string(4) "key8"
+array(0) {
+}
+string(4) "key9"
+array(0) {
+}
+============================
+
+IT #5
+============================
+string(5) "key10"
+array(1) {
+  ["value"]=>
+  string(7) "value10"
+}
+string(4) "key0"
+array(1) {
+  ["value"]=>
+  string(6) "value0"
+}
+string(4) "key1"
+array(1) {
+  ["value"]=>
+  string(6) "value1"
+}
+string(4) "key2"
+array(1) {
+  ["value"]=>
+  string(6) "value2"
+}
+string(4) "key3"
+array(1) {
+  ["value"]=>
+  string(6) "value3"
+}
+string(4) "key4"
+array(1) {
+  ["value"]=>
+  string(6) "value4"
+}
+string(4) "key5"
+array(1) {
+  ["value"]=>
+  string(6) "value5"
+}
+string(4) "key6"
+array(1) {
+  ["value"]=>
+  string(6) "value6"
+}
+string(4) "key7"
+array(1) {
+  ["value"]=>
+  string(6) "value7"
+}
+string(4) "key8"
+array(1) {
+  ["value"]=>
+  string(6) "value8"
+}
+string(4) "key9"
+array(1) {
+  ["value"]=>
+  string(6) "value9"
+}
+============================
+
+IT #6
+============================
+string(5) "key10"
+array(0) {
+}
+string(4) "key0"
+array(0) {
+}
+string(4) "key1"
+array(0) {
+}
+string(4) "key2"
+array(0) {
+}
+string(4) "key3"
+array(0) {
+}
+string(4) "key4"
+array(0) {
+}
+string(4) "key5"
+array(0) {
+}
+string(4) "key6"
+array(0) {
+}
+string(4) "key7"
+array(0) {
+}
+string(4) "key8"
+array(0) {
+}
+string(4) "key9"
+array(0) {
+}
+============================
+
+IT #7
+============================
+string(5) "key10"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+string(4) "key0"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+string(4) "key1"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+string(4) "key2"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+string(4) "key3"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+string(4) "key4"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+string(4) "key5"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+string(4) "key6"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+string(4) "key7"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+string(4) "key8"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+string(4) "key9"
+array(1) {
+  ["num_hits"]=>
+  int(0)
+}
+============================
+
+IT #8
+============================
+string(5) "key10"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+string(4) "key0"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+string(4) "key1"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+string(4) "key2"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+string(4) "key3"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+string(4) "key4"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+string(4) "key5"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+string(4) "key6"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+string(4) "key7"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+string(4) "key8"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+string(4) "key9"
+array(1) {
+  ["mtime"]=>
+  int(%d)
+}
+============================
+
+IT #9
+============================
+string(5) "key10"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+string(4) "key0"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+string(4) "key1"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+string(4) "key2"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+string(4) "key3"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+string(4) "key4"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+string(4) "key5"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+string(4) "key6"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+string(4) "key7"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+string(4) "key8"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+string(4) "key9"
+array(1) {
+  ["creation_time"]=>
+  int(%d)
+}
+============================
+
+IT #10
+============================
+string(5) "key10"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+string(4) "key0"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+string(4) "key1"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+string(4) "key2"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+string(4) "key3"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+string(4) "key4"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+string(4) "key5"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+string(4) "key6"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+string(4) "key7"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+string(4) "key8"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+string(4) "key9"
+array(1) {
+  ["deletion_time"]=>
+  int(0)
+}
+============================
+
+IT #11
+============================
+string(5) "key10"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+string(4) "key0"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+string(4) "key1"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+string(4) "key2"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+string(4) "key3"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+string(4) "key4"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+string(4) "key5"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+string(4) "key6"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+string(4) "key7"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+string(4) "key8"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+string(4) "key9"
+array(1) {
+  ["access_time"]=>
+  int(%d)
+}
+============================
+
+IT #12
+============================
+string(5) "key10"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+string(4) "key0"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+string(4) "key1"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+string(4) "key2"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+string(4) "key3"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+string(4) "key4"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+string(4) "key5"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+string(4) "key6"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+string(4) "key7"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+string(4) "key8"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+string(4) "key9"
+array(1) {
+  ["ref_count"]=>
+  int(0)
+}
+============================
+
+IT #13
+============================
+string(5) "key10"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key0"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key1"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key2"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key3"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key4"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key5"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key6"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key7"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key8"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key9"
+array(1) {
+  ["mem_size"]=>
+  int(%d)
+}
+============================
+
+IT #14
+============================
+string(5) "key10"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key0"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key1"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key2"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key3"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key4"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key5"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key6"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key7"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key8"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key9"
+array(1) {
+  ["ttl"]=>
+  int(0)
+}
+============================
+
+IT #15
+============================
+string(5) "key10"
+array(0) {
+}
+string(4) "key0"
+array(0) {
+}
+string(4) "key1"
+array(0) {
+}
+string(4) "key2"
+array(0) {
+}
+string(4) "key3"
+array(0) {
+}
+string(4) "key4"
+array(0) {
+}
+string(4) "key5"
+array(0) {
+}
+string(4) "key6"
+array(0) {
+}
+string(4) "key7"
+array(0) {
+}
+string(4) "key8"
+array(0) {
+}
+string(4) "key9"
+array(0) {
+}
+============================
+
+IT #16
+============================
+string(5) "key10"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(5) "key10"
+  ["value"]=>
+  string(7) "value10"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key0"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key0"
+  ["value"]=>
+  string(6) "value0"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key1"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key1"
+  ["value"]=>
+  string(6) "value1"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key2"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key2"
+  ["value"]=>
+  string(6) "value2"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key3"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key3"
+  ["value"]=>
+  string(6) "value3"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key4"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key4"
+  ["value"]=>
+  string(6) "value4"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key5"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key5"
+  ["value"]=>
+  string(6) "value5"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key6"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key6"
+  ["value"]=>
+  string(6) "value6"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key7"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key7"
+  ["value"]=>
+  string(6) "value7"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key8"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key8"
+  ["value"]=>
+  string(6) "value8"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+string(4) "key9"
+array(11) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key9"
+  ["value"]=>
+  string(6) "value9"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+  ["ttl"]=>
+  int(0)
+}
+============================
+
+IT #17
+============================
+string(5) "key10"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(5) "key10"
+  ["value"]=>
+  string(7) "value10"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key0"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key0"
+  ["value"]=>
+  string(6) "value0"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key1"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key1"
+  ["value"]=>
+  string(6) "value1"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key2"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key2"
+  ["value"]=>
+  string(6) "value2"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key3"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key3"
+  ["value"]=>
+  string(6) "value3"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key4"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key4"
+  ["value"]=>
+  string(6) "value4"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key5"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key5"
+  ["value"]=>
+  string(6) "value5"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key6"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key6"
+  ["value"]=>
+  string(6) "value6"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key7"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key7"
+  ["value"]=>
+  string(6) "value7"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key8"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key8"
+  ["value"]=>
+  string(6) "value8"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key9"
+array(10) {
+  ["type"]=>
+  string(4) "user"
+  ["key"]=>
+  string(4) "key9"
+  ["value"]=>
+  string(6) "value9"
+  ["num_hits"]=>
+  int(0)
+  ["mtime"]=>
+  int(%d)
+  ["creation_time"]=>
+  int(%d)
+  ["deletion_time"]=>
+  int(0)
+  ["access_time"]=>
+  int(%d)
+  ["ref_count"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+============================
+
+IT #18
+============================
+string(5) "key10"
+array(3) {
+  ["key"]=>
+  string(5) "key10"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key0"
+array(3) {
+  ["key"]=>
+  string(4) "key0"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key1"
+array(3) {
+  ["key"]=>
+  string(4) "key1"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key2"
+array(3) {
+  ["key"]=>
+  string(4) "key2"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key3"
+array(3) {
+  ["key"]=>
+  string(4) "key3"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key4"
+array(3) {
+  ["key"]=>
+  string(4) "key4"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key5"
+array(3) {
+  ["key"]=>
+  string(4) "key5"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key6"
+array(3) {
+  ["key"]=>
+  string(4) "key6"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key7"
+array(3) {
+  ["key"]=>
+  string(4) "key7"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key8"
+array(3) {
+  ["key"]=>
+  string(4) "key8"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+string(4) "key9"
+array(3) {
+  ["key"]=>
+  string(4) "key9"
+  ["num_hits"]=>
+  int(0)
+  ["mem_size"]=>
+  int(%d)
+}
+============================
+
+===DONE===
diff -Nru php-5.4.19/ext/apc/tests/iterator_007.phpt php-5.4.19.bak/ext/apc/tests/iterator_007.phpt
--- php-5.4.19/ext/apc/tests/iterator_007.phpt	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/iterator_007.phpt	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,36 @@
+--TEST--
+APC: APCIterator Overwriting the ctor
+--SKIPIF--
+<?php require_once(dirname(__FILE__) . '/skipif.inc'); ?>
+--INI--
+apc.enabled=1
+apc.enable_cli=1
+--FILE--
+<?php
+class foobar extends APCIterator {
+	public function __construct() {}
+}
+$obj = new foobar;
+var_dump(
+	$obj->rewind(),
+	$obj->current(),
+	$obj->key(),
+	$obj->next(),
+	$obj->valid(),
+	$obj->getTotalHits(),
+	$obj->getTotalSize(),
+	$obj->getTotalCount(),
+	apc_delete($obj)
+);
+?>
+--EXPECTF--
+bool(false)
+bool(false)
+bool(false)
+bool(false)
+bool(false)
+bool(false)
+bool(false)
+bool(false)
+bool(false)
+
diff -Nru php-5.4.19/ext/apc/tests/php_5_3_ns.inc php-5.4.19.bak/ext/apc/tests/php_5_3_ns.inc
--- php-5.4.19/ext/apc/tests/php_5_3_ns.inc	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/php_5_3_ns.inc	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,18 @@
+<?php
+namespace Foo\Bar;
+
+function sort() {
+	$a = array(3,2,1,4);
+	\sort($a);  // global scoping
+	var_dump($a);
+	return "IT WORKS";
+}
+class Baz {
+	public $i = 1;
+	protected $f = 3.14;
+	private $s = "hello world";
+
+	public function foo() {
+		sort();
+	}
+}
diff -Nru php-5.4.19/ext/apc/tests/server_test.inc php-5.4.19.bak/ext/apc/tests/server_test.inc
--- php-5.4.19/ext/apc/tests/server_test.inc	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/server_test.inc	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,150 @@
+<?php
+/* based on sapi/cli/tests/php_cli_server.inc */
+define ("PHP_CLI_SERVER_HOSTNAME", "localhost");
+define ("PHP_CLI_SERVER_PORT", 8964);
+define ("PHP_CLI_SERVER_ADDRESS", PHP_CLI_SERVER_HOSTNAME.":".PHP_CLI_SERVER_PORT);
+define ("NUM_SERVERS", 3);
+
+/* XXX incapsulate all this globals into a class when have a favourable minute */
+$doc_root = __DIR__;
+$router = "index.php";
+$handles = array();
+$ports = array();
+
+function server_start_one($host, $port, $code = 'echo "Hello world";', $php_opts = array(), $no_router = FALSE)
+{
+	global $doc_root, $router, $handles, $ports;
+
+	$php_executable = getenv('TEST_PHP_EXECUTABLE');
+
+	$descriptorspec = array(
+		0 => STDIN,
+		1 => STDOUT,
+		2 => STDERR,
+	);
+
+	$ext = (substr(PHP_OS, 0, 3) == 'WIN') ? 'php_apc.dll' : 'apc.so';
+	$php_args = "-d extension_dir=$doc_root/../modules -d extension=$ext";
+	if ($php_opts) {
+		$php_args = "$php_args -d " . implode(' -d ', $php_opts);;
+	}
+
+	if (substr(PHP_OS, 0, 3) == 'WIN') {
+		$cmd = "{$php_executable} -n $php_args -t {$doc_root} -S $host:$port";
+		if (!$no_router) {
+			$cmd .= " {$router}";
+		}
+
+		$handle = proc_open(addslashes($cmd), $descriptorspec, $pipes, $doc_root, NULL, array("bypass_shell" => true,  "suppress_errors" => true));
+	} else {
+		$cmd = "exec {$php_executable} -n $php_args -t {$doc_root} -S $host:$port";
+		if (!$no_router) {
+			$cmd .= " {$doc_root}/{$router}";
+		}
+		$cmd .= " 2>/dev/null";
+
+		$handle = proc_open($cmd, $descriptorspec, $pipes, $doc_root);
+	}
+	
+	// note: even when server prints 'Listening on localhost:8964...Press Ctrl-C to quit.'
+	//       it might not be listening yet...need to wait until fsockopen() call returns
+    $i = 0;
+    while (($i++ < 10) && !connection_test($host, $port)) {
+        usleep(10000);
+    }
+
+	return $handle;
+}
+
+function server_start($code = 'echo "Hello world";', $php_opts = array(), $no_router = FALSE)
+{
+	global $doc_root, $router, $handles, $ports;
+
+
+	if ($code) {
+		file_put_contents($doc_root . '/' . $router, '<?php ' . $code . ' ?>');
+	}
+
+	for ($i = 0; $i < NUM_SERVERS; $i++) {
+		$h = server_start_one(PHP_CLI_SERVER_HOSTNAME, PHP_CLI_SERVER_PORT+$i, $code, $php_opts, $no_router);
+		$handles[] = $h;
+	}	
+
+	register_shutdown_function(
+		function($handles) use($router) {
+			foreach ($handles as $handle) {
+				proc_terminate($handle);
+			}
+			@unlink(__DIR__ . "/{$router}");
+		},
+			$handles
+		);
+	// don't bother sleeping, server is already up
+	// server can take a variable amount of time to be up, so just sleeping a guessed amount of time
+	// does not work. this is why tests sometimes pass and sometimes fail. to get a reliable pass
+	// sleeping doesn't work.
+}
+
+function get_response($fp, $data_only = true)
+{
+	$s = '';
+
+	while (!feof($fp)) {
+		$s .= fgets($fp);
+	}
+
+	if ($data_only) {
+		$parts = explode("\r\n\r\n", $s);
+		$s = $parts[1];
+	}
+
+	return $s;
+}
+
+
+function connection_test($host, $port)
+{
+	$port = intval($port)?:80;
+
+	$fp = @fsockopen($host, $port, $errno, $errstr, 0.5);
+	if (!$fp) {
+		return false;
+	}
+
+	$send = "GET / HTTP/1.1\nHost: {$host}\r\n\r\n";
+
+	/* will not out here, just test if the connection has worked*/
+	if(@fwrite($fp, $send)) {
+		get_response($fp);
+		fclose($fp);
+
+		return true;
+	}
+
+	@fclose($fp);
+
+	return false;
+}
+
+function run_test_simple()
+{
+	$send = "GET / HTTP/1.1\nHost: " . PHP_CLI_SERVER_HOSTNAME . "\r\n\r\n";
+
+	for ($i = 0; $i < NUM_SERVERS; $i++) {
+		run_test(PHP_CLI_SERVER_HOSTNAME, PHP_CLI_SERVER_PORT+$i, $send);
+	}
+}
+
+function run_test($host, $port, $send)
+{
+	$fp = fsockopen($host, $port, $errno, $errstr, 0.5);
+	if (!$fp) {
+	  die(sprintf("connect failed errno=%d errstr='%s'", $errno, $errstr));
+	}
+
+	if(fwrite($fp, $send)) {
+		echo get_response($fp);
+	}
+
+	fclose($fp);
+}
diff -Nru php-5.4.19/ext/apc/tests/skipif.inc php-5.4.19.bak/ext/apc/tests/skipif.inc
--- php-5.4.19/ext/apc/tests/skipif.inc	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/tests/skipif.inc	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,6 @@
+<?php
+
+if (!extension_loaded("apc")) die("skip");
+//if (!ini_get('apc.enabled')) die("skip apc not enabled");
+
+?>
diff -Nru php-5.4.19/ext/apc/TODO php-5.4.19.bak/ext/apc/TODO
--- php-5.4.19/ext/apc/TODO	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak/ext/apc/TODO	2012-09-04 00:52:51.000000000 +0800
@@ -0,0 +1,35 @@
+Known Bugs
+ 
+1.   Gallery2 doesn't work with PHP5+APC.  There is something wrong
+     with the way methods are restored in some edge case I haven't
+     been able to figure out yet.
+     To reproduce install gallery2 and click down to an individual photo.
+
+2.   apc_store() probably needs some checks to skip trying to store
+     internal classes.  Something along the lines of:
+
+     if(Z_TYPE_P(val) == IS_OBJECT) {
+        zend_class_entry *ce = Z_OBJCE_P(val);
+        if(ce->type == ZEND_INTERNAL_CLASS) {
+            php_error_docref(NULL TSRMLS_CC, E_WARNING, "Cannot cache internal objects");
+            RETURN_FALSE;
+        }
+     }
+
+     in the apc_store() function in php_apc.c but I am wondering if it needs to do more
+     than that.
+
+Windows
+
+1.   The following configurations (build arguments) have not been implemented yet
+
+          (*) --enable-apc-mmap         	Memory mapping support
+          (*) --enable-apc-sem         		Semaphore locking support (FCNTL replacement)
+          (*) --enable-apc-phreadmutex		Thread mutexes, while implemented we should probably rename the internals to thread
+	  (*) --enable-apc-pthreadrwlocks	Thread mutexes, read/write locking
+
+2.   Non-blocking locks is not supported either
+
+3.   Update fileinfo to support stat info in a more portable way (see PECL #17903)
+
+4.   Check whether the signal handling needs to be enabled, and if it makes sense on Windows
\ No newline at end of file
--- php-5.4.19.ori/config.guess	2013-08-20 12:42:41.000000000 +0800
+++ php-5.4.19.bak.ori/config.guess	2013-08-26 21:15:11.000000000 +0800
@@ -1,10 +1,10 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008
-#   Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
+#   2011, 2012 Free Software Foundation, Inc.
 
-timestamp='2008-01-23'
+timestamp='2012-09-25'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -17,9 +17,7 @@
 # General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
-# 02110-1301, USA.
+# along with this program; if not, see <http://www.gnu.org/licenses/>.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
@@ -27,16 +25,16 @@
 # the same distribution terms that you use for the rest of that program.
 
 
-# Originally written by Per Bothner <per@bothner.com>.
-# Please send patches to <config-patches@gnu.org>.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+# Originally written by Per Bothner.  Please send patches (context
+# diff format) to <config-patches@gnu.org> and include a ChangeLog
+# entry.
 #
 # This script attempts to guess a canonical system name similar to
 # config.sub.  If it succeeds, it prints the system name on stdout, and
 # exits with 0.  Otherwise, it exits with 1.
 #
-# The plan is that this can be called by configure scripts if you
-# don't specify an explicit build system type.
+# You can get the latest version of this script from:
+# http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD
 
 me=`echo "$0" | sed -e 's,.*/,,'`
 
@@ -56,8 +54,9 @@
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012
+Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
@@ -139,12 +138,29 @@
 UNAME_SYSTEM=`(uname -s) 2>/dev/null`  || UNAME_SYSTEM=unknown
 UNAME_VERSION=`(uname -v) 2>/dev/null` || UNAME_VERSION=unknown
 
+if [ "${UNAME_SYSTEM}" = "Linux" ] ; then
+	eval $set_cc_for_build
+	cat << EOF > $dummy.c
+	#include <features.h>
+	#ifdef __UCLIBC__
+	# ifdef __UCLIBC_CONFIG_VERSION__
+	LIBC=uclibc __UCLIBC_CONFIG_VERSION__
+	# else
+	LIBC=uclibc
+	# endif
+	#else
+	LIBC=gnu
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep LIBC= | sed -e 's: ::g'`
+fi
+
 # Note: order is significant - the case branches are not exclusive.
 
 case "${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}" in
     *:NetBSD:*:*)
 	# NetBSD (nbsd) targets should (where applicable) match one or
-	# more of the tupples: *-*-netbsdelf*, *-*-netbsdaout*,
+	# more of the tuples: *-*-netbsdelf*, *-*-netbsdaout*,
 	# *-*-netbsdecoff* and *-*-netbsd*.  For targets that recently
 	# switched to ELF, *-*-netbsd* would select the old
 	# object file format.  This provides both forward
@@ -170,7 +186,7 @@
 	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
 		eval $set_cc_for_build
 		if echo __ELF__ | $CC_FOR_BUILD -E - 2>/dev/null \
-			| grep __ELF__ >/dev/null
+			| grep -q __ELF__
 		then
 		    # Once all utilities can be ECOFF (netbsdecoff) or a.out (netbsdaout).
 		    # Return netbsd for either.  FIX?
@@ -180,7 +196,7 @@
 		fi
 		;;
 	    *)
-	        os=netbsd
+		os=netbsd
 		;;
 	esac
 	# The OS release
@@ -201,6 +217,10 @@
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
 	echo "${machine}-${os}${release}"
 	exit ;;
+    *:Bitrig:*:*)
+	UNAME_MACHINE_ARCH=`arch | sed 's/Bitrig.//'`
+	echo ${UNAME_MACHINE_ARCH}-unknown-bitrig${UNAME_RELEASE}
+	exit ;;
     *:OpenBSD:*:*)
 	UNAME_MACHINE_ARCH=`arch | sed 's/OpenBSD.//'`
 	echo ${UNAME_MACHINE_ARCH}-unknown-openbsd${UNAME_RELEASE}
@@ -223,7 +243,7 @@
 		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`
 		;;
 	*5.*)
-	        UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
+		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
 		;;
 	esac
 	# According to Compaq, /usr/sbin/psrinfo has been available on
@@ -269,7 +289,10 @@
 	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses "1.2" for uname -r.
 	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-	exit ;;
+	# Reset EXIT trap before exiting to avoid spurious non-zero exit code.
+	exitcode=$?
+	trap '' 0
+	exit $exitcode ;;
     Alpha\ *:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# Should we change UNAME_MACHINE based on the output of uname instead
@@ -295,12 +318,12 @@
 	echo s390-ibm-zvmoe
 	exit ;;
     *:OS400:*:*)
-        echo powerpc-ibm-os400
+	echo powerpc-ibm-os400
 	exit ;;
     arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
 	echo arm-acorn-riscix${UNAME_RELEASE}
 	exit ;;
-    arm:riscos:*:*|arm:RISCOS:*:*)
+    arm*:riscos:*:*|arm*:RISCOS:*:*)
 	echo arm-unknown-riscos
 	exit ;;
     SR2?01:HI-UX/MPP:*:* | SR8000:HI-UX/MPP:*:*)
@@ -324,14 +347,33 @@
 	case `/usr/bin/uname -p` in
 	    sparc) echo sparc-icl-nx7; exit ;;
 	esac ;;
+    s390x:SunOS:*:*)
+	echo ${UNAME_MACHINE}-ibm-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
     sun4H:SunOS:5.*:*)
 	echo sparc-hal-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit ;;
     sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)
 	echo sparc-sun-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit ;;
+    i86pc:AuroraUX:5.*:* | i86xen:AuroraUX:5.*:*)
+	echo i386-pc-auroraux${UNAME_RELEASE}
+	exit ;;
     i86pc:SunOS:5.*:* | i86xen:SunOS:5.*:*)
-	echo i386-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	eval $set_cc_for_build
+	SUN_ARCH="i386"
+	# If there is a compiler, see if it is configured for 64-bit objects.
+	# Note that the Sun cc does not turn __LP64__ into 1 like gcc does.
+	# This test works for both compilers.
+	if [ "$CC_FOR_BUILD" != 'no_compiler_found' ]; then
+	    if (echo '#ifdef __amd64'; echo IS_64BIT_ARCH; echo '#endif') | \
+		(CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) | \
+		grep IS_64BIT_ARCH >/dev/null
+	    then
+		SUN_ARCH="x86_64"
+	    fi
+	fi
+	echo ${SUN_ARCH}-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit ;;
     sun4*:SunOS:6*:*)
 	# According to config.sub, this is the proper way to canonicalize
@@ -375,23 +417,23 @@
     # MiNT.  But MiNT is downward compatible to TOS, so this should
     # be no problem.
     atarist[e]:*MiNT:*:* | atarist[e]:*mint:*:* | atarist[e]:*TOS:*:*)
-        echo m68k-atari-mint${UNAME_RELEASE}
+	echo m68k-atari-mint${UNAME_RELEASE}
 	exit ;;
     atari*:*MiNT:*:* | atari*:*mint:*:* | atarist[e]:*TOS:*:*)
 	echo m68k-atari-mint${UNAME_RELEASE}
-        exit ;;
+	exit ;;
     *falcon*:*MiNT:*:* | *falcon*:*mint:*:* | *falcon*:*TOS:*:*)
-        echo m68k-atari-mint${UNAME_RELEASE}
+	echo m68k-atari-mint${UNAME_RELEASE}
 	exit ;;
     milan*:*MiNT:*:* | milan*:*mint:*:* | *milan*:*TOS:*:*)
-        echo m68k-milan-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-milan-mint${UNAME_RELEASE}
+	exit ;;
     hades*:*MiNT:*:* | hades*:*mint:*:* | *hades*:*TOS:*:*)
-        echo m68k-hades-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-hades-mint${UNAME_RELEASE}
+	exit ;;
     *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
-        echo m68k-unknown-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-unknown-mint${UNAME_RELEASE}
+	exit ;;
     m68k:machten:*:*)
 	echo m68k-apple-machten${UNAME_RELEASE}
 	exit ;;
@@ -461,8 +503,8 @@
 	echo m88k-motorola-sysv3
 	exit ;;
     AViiON:dgux:*:*)
-        # DG/UX returns AViiON for all architectures
-        UNAME_PROCESSOR=`/usr/bin/uname -p`
+	# DG/UX returns AViiON for all architectures
+	UNAME_PROCESSOR=`/usr/bin/uname -p`
 	if [ $UNAME_PROCESSOR = mc88100 ] || [ $UNAME_PROCESSOR = mc88110 ]
 	then
 	    if [ ${TARGET_BINARY_INTERFACE}x = m88kdguxelfx ] || \
@@ -475,7 +517,7 @@
 	else
 	    echo i586-dg-dgux${UNAME_RELEASE}
 	fi
- 	exit ;;
+	exit ;;
     M88*:DolphinOS:*:*)	# DolphinOS (SVR3)
 	echo m88k-dolphin-sysv3
 	exit ;;
@@ -575,52 +617,52 @@
 	    9000/[678][0-9][0-9])
 		if [ -x /usr/bin/getconf ]; then
 		    sc_cpu_version=`/usr/bin/getconf SC_CPU_VERSION 2>/dev/null`
-                    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`
-                    case "${sc_cpu_version}" in
-                      523) HP_ARCH="hppa1.0" ;; # CPU_PA_RISC1_0
-                      528) HP_ARCH="hppa1.1" ;; # CPU_PA_RISC1_1
-                      532)                      # CPU_PA_RISC2_0
-                        case "${sc_kernel_bits}" in
-                          32) HP_ARCH="hppa2.0n" ;;
-                          64) HP_ARCH="hppa2.0w" ;;
+		    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`
+		    case "${sc_cpu_version}" in
+		      523) HP_ARCH="hppa1.0" ;; # CPU_PA_RISC1_0
+		      528) HP_ARCH="hppa1.1" ;; # CPU_PA_RISC1_1
+		      532)                      # CPU_PA_RISC2_0
+			case "${sc_kernel_bits}" in
+			  32) HP_ARCH="hppa2.0n" ;;
+			  64) HP_ARCH="hppa2.0w" ;;
 			  '') HP_ARCH="hppa2.0" ;;   # HP-UX 10.20
-                        esac ;;
-                    esac
+			esac ;;
+		    esac
 		fi
 		if [ "${HP_ARCH}" = "" ]; then
 		    eval $set_cc_for_build
-		    sed 's/^              //' << EOF >$dummy.c
+		    sed 's/^		//' << EOF >$dummy.c
+
+		#define _HPUX_SOURCE
+		#include <stdlib.h>
+		#include <unistd.h>
+
+		int main ()
+		{
+		#if defined(_SC_KERNEL_BITS)
+		    long bits = sysconf(_SC_KERNEL_BITS);
+		#endif
+		    long cpu  = sysconf (_SC_CPU_VERSION);
 
-              #define _HPUX_SOURCE
-              #include <stdlib.h>
-              #include <unistd.h>
-
-              int main ()
-              {
-              #if defined(_SC_KERNEL_BITS)
-                  long bits = sysconf(_SC_KERNEL_BITS);
-              #endif
-                  long cpu  = sysconf (_SC_CPU_VERSION);
-
-                  switch (cpu)
-              	{
-              	case CPU_PA_RISC1_0: puts ("hppa1.0"); break;
-              	case CPU_PA_RISC1_1: puts ("hppa1.1"); break;
-              	case CPU_PA_RISC2_0:
-              #if defined(_SC_KERNEL_BITS)
-              	    switch (bits)
-              		{
-              		case 64: puts ("hppa2.0w"); break;
-              		case 32: puts ("hppa2.0n"); break;
-              		default: puts ("hppa2.0"); break;
-              		} break;
-              #else  /* !defined(_SC_KERNEL_BITS) */
-              	    puts ("hppa2.0"); break;
-              #endif
-              	default: puts ("hppa1.0"); break;
-              	}
-                  exit (0);
-              }
+		    switch (cpu)
+			{
+			case CPU_PA_RISC1_0: puts ("hppa1.0"); break;
+			case CPU_PA_RISC1_1: puts ("hppa1.1"); break;
+			case CPU_PA_RISC2_0:
+		#if defined(_SC_KERNEL_BITS)
+			    switch (bits)
+				{
+				case 64: puts ("hppa2.0w"); break;
+				case 32: puts ("hppa2.0n"); break;
+				default: puts ("hppa2.0"); break;
+				} break;
+		#else  /* !defined(_SC_KERNEL_BITS) */
+			    puts ("hppa2.0"); break;
+		#endif
+			default: puts ("hppa1.0"); break;
+			}
+		    exit (0);
+		}
 EOF
 		    (CCOPTS= $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null) && HP_ARCH=`$dummy`
 		    test -z "$HP_ARCH" && HP_ARCH=hppa
@@ -640,7 +682,7 @@
 	    # => hppa64-hp-hpux11.23
 
 	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) |
-		grep __LP64__ >/dev/null
+		grep -q __LP64__
 	    then
 		HP_ARCH="hppa2.0w"
 	    else
@@ -711,22 +753,22 @@
 	exit ;;
     C1*:ConvexOS:*:* | convex:ConvexOS:C1*:*)
 	echo c1-convex-bsd
-        exit ;;
+	exit ;;
     C2*:ConvexOS:*:* | convex:ConvexOS:C2*:*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-        exit ;;
+	exit ;;
     C34*:ConvexOS:*:* | convex:ConvexOS:C34*:*)
 	echo c34-convex-bsd
-        exit ;;
+	exit ;;
     C38*:ConvexOS:*:* | convex:ConvexOS:C38*:*)
 	echo c38-convex-bsd
-        exit ;;
+	exit ;;
     C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
 	echo c4-convex-bsd
-        exit ;;
+	exit ;;
     CRAY*Y-MP:*:*:*)
 	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit ;;
@@ -750,14 +792,14 @@
 	exit ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
-        FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
-        echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
-        exit ;;
+	FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+	FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
+	echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	exit ;;
     5000:UNIX_System_V:4.*:*)
-        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
-        FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
-        echo "sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+	FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
+	echo "sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
 	exit ;;
     i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
 	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
@@ -769,34 +811,39 @@
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
 	exit ;;
     *:FreeBSD:*:*)
-	case ${UNAME_MACHINE} in
-	    pc98)
-		echo i386-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	UNAME_PROCESSOR=`/usr/bin/uname -p`
+	case ${UNAME_PROCESSOR} in
 	    amd64)
 		echo x86_64-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
 	    *)
-		echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+		echo ${UNAME_PROCESSOR}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
 	esac
 	exit ;;
     i*:CYGWIN*:*)
 	echo ${UNAME_MACHINE}-pc-cygwin
 	exit ;;
+    *:MINGW64*:*)
+	echo ${UNAME_MACHINE}-pc-mingw64
+	exit ;;
     *:MINGW*:*)
 	echo ${UNAME_MACHINE}-pc-mingw32
 	exit ;;
+    i*:MSYS*:*)
+	echo ${UNAME_MACHINE}-pc-msys
+	exit ;;
     i*:windows32*:*)
-    	# uname -m includes "-pc" on this system.
-    	echo ${UNAME_MACHINE}-mingw32
+	# uname -m includes "-pc" on this system.
+	echo ${UNAME_MACHINE}-mingw32
 	exit ;;
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
 	exit ;;
-    *:Interix*:[3456]*)
-    	case ${UNAME_MACHINE} in
+    *:Interix*:*)
+	case ${UNAME_MACHINE} in
 	    x86)
 		echo i586-pc-interix${UNAME_RELEASE}
 		exit ;;
-	    EM64T | authenticamd)
+	    authenticamd | genuineintel | EM64T)
 		echo x86_64-unknown-interix${UNAME_RELEASE}
 		exit ;;
 	    IA64)
@@ -806,6 +853,9 @@
     [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
 	echo i${UNAME_MACHINE}-pc-mks
 	exit ;;
+    8664:Windows_NT:*)
+	echo x86_64-pc-mks
+	exit ;;
     i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# It also conflicts with pre-2.0 versions of AT&T UWIN. Should we
@@ -835,201 +885,143 @@
     i*86:Minix:*:*)
 	echo ${UNAME_MACHINE}-pc-minix
 	exit ;;
+    aarch64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
+    aarch64_be:Linux:*:*)
+	UNAME_MACHINE=aarch64_be
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
+    alpha:Linux:*:*)
+	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' < /proc/cpuinfo` in
+	  EV5)   UNAME_MACHINE=alphaev5 ;;
+	  EV56)  UNAME_MACHINE=alphaev56 ;;
+	  PCA56) UNAME_MACHINE=alphapca56 ;;
+	  PCA57) UNAME_MACHINE=alphapca56 ;;
+	  EV6)   UNAME_MACHINE=alphaev6 ;;
+	  EV67)  UNAME_MACHINE=alphaev67 ;;
+	  EV68*) UNAME_MACHINE=alphaev68 ;;
+	esac
+	objdump --private-headers /bin/sh | grep -q ld.so.1
+	if test "$?" = 0 ; then LIBC="gnulibc1" ; fi
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
     arm*:Linux:*:*)
 	eval $set_cc_for_build
 	if echo __ARM_EABI__ | $CC_FOR_BUILD -E - 2>/dev/null \
 	    | grep -q __ARM_EABI__
 	then
-	    echo ${UNAME_MACHINE}-unknown-linux-gnu
+	    echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	else
-	    echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	    if echo __ARM_PCS_VFP | $CC_FOR_BUILD -E - 2>/dev/null \
+		| grep -q __ARM_PCS_VFP
+	    then
+		echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	    else
+		echo ${UNAME_MACHINE}-unknown-linux-gnueabihf
+	    fi
 	fi
 	exit ;;
     avr32*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     cris:Linux:*:*)
-	echo cris-axis-linux-gnu
+	echo ${UNAME_MACHINE}-axis-linux-${LIBC}
 	exit ;;
     crisv32:Linux:*:*)
-	echo crisv32-axis-linux-gnu
+	echo ${UNAME_MACHINE}-axis-linux-${LIBC}
 	exit ;;
     frv:Linux:*:*)
-    	echo frv-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
+    hexagon:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
+    i*86:Linux:*:*)
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+	#ifdef __dietlibc__
+	LIBC=dietlibc
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^LIBC'`
+	echo "${UNAME_MACHINE}-pc-linux-${LIBC}"
 	exit ;;
     ia64:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     m32r*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     m68*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
-    mips:Linux:*:*)
+    mips:Linux:*:* | mips64:Linux:*:*)
 	eval $set_cc_for_build
 	sed 's/^	//' << EOF >$dummy.c
 	#undef CPU
-	#undef mips
-	#undef mipsel
+	#undef ${UNAME_MACHINE}
+	#undef ${UNAME_MACHINE}el
 	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mipsel
+	CPU=${UNAME_MACHINE}el
 	#else
 	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips
+	CPU=${UNAME_MACHINE}
 	#else
 	CPU=
 	#endif
 	#endif
 EOF
-	eval "`$CC_FOR_BUILD -E $dummy.c 2>/dev/null | sed -n '
-	    /^CPU/{
-		s: ::g
-		p
-	    }'`"
-	test x"${CPU}" != x && { echo "${CPU}-unknown-linux-gnu"; exit; }
-	;;
-    mips64:Linux:*:*)
-	eval $set_cc_for_build
-	sed 's/^	//' << EOF >$dummy.c
-	#undef CPU
-	#undef mips64
-	#undef mips64el
-	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mips64el
-	#else
-	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips64
-	#else
-	CPU=
-	#endif
-	#endif
-EOF
-	eval "`$CC_FOR_BUILD -E $dummy.c 2>/dev/null | sed -n '
-	    /^CPU/{
-		s: ::g
-		p
-	    }'`"
-	test x"${CPU}" != x && { echo "${CPU}-unknown-linux-gnu"; exit; }
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^CPU'`
+	test x"${CPU}" != x && { echo "${CPU}-unknown-linux-${LIBC}"; exit; }
 	;;
     or32:Linux:*:*)
-	echo or32-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
-    ppc:Linux:*:*)
-	echo powerpc-unknown-linux-gnu
+    padre:Linux:*:*)
+	echo sparc-unknown-linux-gnu
 	exit ;;
-    ppc64:Linux:*:*)
-	echo powerpc64-unknown-linux-gnu
-	exit ;;
-    alpha:Linux:*:*)
-	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' < /proc/cpuinfo` in
-	  EV5)   UNAME_MACHINE=alphaev5 ;;
-	  EV56)  UNAME_MACHINE=alphaev56 ;;
-	  PCA56) UNAME_MACHINE=alphapca56 ;;
-	  PCA57) UNAME_MACHINE=alphapca56 ;;
-	  EV6)   UNAME_MACHINE=alphaev6 ;;
-	  EV67)  UNAME_MACHINE=alphaev67 ;;
-	  EV68*) UNAME_MACHINE=alphaev68 ;;
-        esac
-	objdump --private-headers /bin/sh | grep ld.so.1 >/dev/null
-	if test "$?" = 0 ; then LIBC="libc1" ; else LIBC="" ; fi
-	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+    parisc64:Linux:*:* | hppa64:Linux:*:*)
+	echo hppa64-unknown-linux-gnu
 	exit ;;
     parisc:Linux:*:* | hppa:Linux:*:*)
 	# Look for CPU level
 	case `grep '^cpu[^a-z]*:' /proc/cpuinfo 2>/dev/null | cut -d' ' -f2` in
-	  PA7*) echo hppa1.1-unknown-linux-gnu ;;
-	  PA8*) echo hppa2.0-unknown-linux-gnu ;;
-	  *)    echo hppa-unknown-linux-gnu ;;
+	  PA7*) echo hppa1.1-unknown-linux-${LIBC} ;;
+	  PA8*) echo hppa2.0-unknown-linux-${LIBC} ;;
+	  *)    echo hppa-unknown-linux-${LIBC} ;;
 	esac
 	exit ;;
-    parisc64:Linux:*:* | hppa64:Linux:*:*)
-	echo hppa64-unknown-linux-gnu
+    ppc64:Linux:*:*)
+	echo powerpc64-unknown-linux-${LIBC}
+	exit ;;
+    ppc:Linux:*:*)
+	echo powerpc-unknown-linux-${LIBC}
 	exit ;;
     s390:Linux:*:* | s390x:Linux:*:*)
 	echo ${UNAME_MACHINE}-ibm-linux
 	exit ;;
     sh64*:Linux:*:*)
-    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     sh*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     sparc:Linux:*:* | sparc64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
+    tile*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
     vax:Linux:*:*)
-	echo ${UNAME_MACHINE}-dec-linux-gnu
+	echo ${UNAME_MACHINE}-dec-linux-${LIBC}
 	exit ;;
     x86_64:Linux:*:*)
-	echo x86_64-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     xtensa*:Linux:*:*)
-    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
-    i*86:Linux:*:*)
-	# The BFD linker knows what the default object file format is, so
-	# first see if it will tell us. cd to the root directory to prevent
-	# problems with other programs or directories called `ld' in the path.
-	# Set LC_ALL=C to ensure ld outputs messages in English.
-	ld_supported_targets=`cd /; LC_ALL=C ld --help 2>&1 \
-			 | sed -ne '/supported targets:/!d
-				    s/[ 	][ 	]*/ /g
-				    s/.*supported targets: *//
-				    s/ .*//
-				    p'`
-        case "$ld_supported_targets" in
-	  elf32-i386)
-		TENTATIVE="${UNAME_MACHINE}-pc-linux-gnu"
-		;;
-	  a.out-i386-linux)
-		echo "${UNAME_MACHINE}-pc-linux-gnuaout"
-		exit ;;
-	  coff-i386)
-		echo "${UNAME_MACHINE}-pc-linux-gnucoff"
-		exit ;;
-	  "")
-		# Either a pre-BFD a.out linker (linux-gnuoldld) or
-		# one that does not give us useful --help.
-		echo "${UNAME_MACHINE}-pc-linux-gnuoldld"
-		exit ;;
-	esac
-	# Determine whether the default compiler is a.out or elf
-	eval $set_cc_for_build
-	sed 's/^	//' << EOF >$dummy.c
-	#include <features.h>
-	#ifdef __ELF__
-	# ifdef __GLIBC__
-	#  if __GLIBC__ >= 2
-	LIBC=gnu
-	#  else
-	LIBC=gnulibc1
-	#  endif
-	# else
-	LIBC=gnulibc1
-	# endif
-	#else
-	#if defined(__INTEL_COMPILER) || defined(__PGI) || defined(__SUNPRO_C) || defined(__SUNPRO_CC)
-	LIBC=gnu
-	#else
-	LIBC=gnuaout
-	#endif
-	#endif
-	#ifdef __dietlibc__
-	LIBC=dietlibc
-	#endif
-EOF
-	eval "`$CC_FOR_BUILD -E $dummy.c 2>/dev/null | sed -n '
-	    /^LIBC/{
-		s: ::g
-		p
-	    }'`"
-	test x"${LIBC}" != x && {
-		echo "${UNAME_MACHINE}-pc-linux-${LIBC}"
-		exit
-	}
-	test x"${TENTATIVE}" != x && { echo "${TENTATIVE}"; exit; }
-	;;
     i*86:DYNIX/ptx:4*:*)
 	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
 	# earlier versions are messed up and put the nodename in both
@@ -1037,11 +1029,11 @@
 	echo i386-sequent-sysv4
 	exit ;;
     i*86:UNIX_SV:4.2MP:2.*)
-        # Unixware is an offshoot of SVR4, but it has its own version
-        # number series starting with 2...
-        # I am not positive that other SVR4 systems won't match this,
+	# Unixware is an offshoot of SVR4, but it has its own version
+	# number series starting with 2...
+	# I am not positive that other SVR4 systems won't match this,
 	# I just have to hope.  -- rms.
-        # Use sysv4.2uw... so that sysv4* matches it.
+	# Use sysv4.2uw... so that sysv4* matches it.
 	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
 	exit ;;
     i*86:OS/2:*:*)
@@ -1058,7 +1050,7 @@
     i*86:syllable:*:*)
 	echo ${UNAME_MACHINE}-pc-syllable
 	exit ;;
-    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
+    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.[02]*:*)
 	echo i386-unknown-lynxos${UNAME_RELEASE}
 	exit ;;
     i*86:*DOS:*:*)
@@ -1073,7 +1065,7 @@
 	fi
 	exit ;;
     i*86:*:5:[678]*)
-    	# UnixWare 7.x, OpenUNIX and OpenServer 6.
+	# UnixWare 7.x, OpenUNIX and OpenServer 6.
 	case `/bin/uname -X | grep "^Machine"` in
 	    *486*)	     UNAME_MACHINE=i486 ;;
 	    *Pentium)	     UNAME_MACHINE=i586 ;;
@@ -1101,10 +1093,13 @@
 	exit ;;
     pc:*:*:*)
 	# Left here for compatibility:
-        # uname -m prints for DJGPP always 'pc', but it prints nothing about
-        # the processor, so we play safe by assuming i386.
-	echo i386-pc-msdosdjgpp
-        exit ;;
+	# uname -m prints for DJGPP always 'pc', but it prints nothing about
+	# the processor, so we play safe by assuming i586.
+	# Note: whatever this is, it MUST be the same as what config.sub
+	# prints for the "djgpp" host, or else GDB configury will decide that
+	# this is a cross-build.
+	echo i586-pc-msdosdjgpp
+	exit ;;
     Intel:Mach:3*:*)
 	echo i386-pc-mach3
 	exit ;;
@@ -1139,8 +1134,18 @@
 	/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \
 	  && { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
-        /bin/uname -p 2>/dev/null | grep 86 >/dev/null \
-          && { echo i486-ncr-sysv4; exit; } ;;
+	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
+	  && { echo i486-ncr-sysv4; exit; } ;;
+    NCR*:*:4.2:* | MPRAS*:*:4.2:*)
+	OS_REL='.3'
+	test -r /etc/.relid \
+	    && OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' < /etc/.relid`
+	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
+	    && { echo i486-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \
+	    && { echo i586-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2>/dev/null | /bin/grep pteron >/dev/null \
+	    && { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     m68*:LynxOS:2.*:* | m68*:LynxOS:3.0*:*)
 	echo m68k-unknown-lynxos${UNAME_RELEASE}
 	exit ;;
@@ -1153,7 +1158,7 @@
     rs6000:LynxOS:2.*:*)
 	echo rs6000-unknown-lynxos${UNAME_RELEASE}
 	exit ;;
-    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.0*:*)
+    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.[02]*:*)
 	echo powerpc-unknown-lynxos${UNAME_RELEASE}
 	exit ;;
     SM[BE]S:UNIX_SV:*:*)
@@ -1173,10 +1178,10 @@
 		echo ns32k-sni-sysv
 	fi
 	exit ;;
-    PENTIUM:*:4.0*:*) # Unisys `ClearPath HMP IX 4000' SVR4/MP effort
-                      # says <Richard.M.Bartel@ccMail.Census.GOV>
-        echo i586-unisys-sysv4
-        exit ;;
+    PENTIUM:*:4.0*:*)	# Unisys `ClearPath HMP IX 4000' SVR4/MP effort
+			# says <Richard.M.Bartel@ccMail.Census.GOV>
+	echo i586-unisys-sysv4
+	exit ;;
     *:UNIX_System_V:4*:FTX*)
 	# From Gerald Hewes <hewes@openmarket.com>.
 	# How about differentiating between stratus architectures? -djm
@@ -1202,11 +1207,11 @@
 	exit ;;
     R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)
 	if [ -d /usr/nec ]; then
-	        echo mips-nec-sysv${UNAME_RELEASE}
+		echo mips-nec-sysv${UNAME_RELEASE}
 	else
-	        echo mips-unknown-sysv${UNAME_RELEASE}
+		echo mips-unknown-sysv${UNAME_RELEASE}
 	fi
-        exit ;;
+	exit ;;
     BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
 	echo powerpc-be-beos
 	exit ;;
@@ -1216,6 +1221,12 @@
     BePC:BeOS:*:*)	# BeOS running on Intel PC compatible.
 	echo i586-pc-beos
 	exit ;;
+    BePC:Haiku:*:*)	# Haiku running on Intel PC compatible.
+	echo i586-pc-haiku
+	exit ;;
+    x86_64:Haiku:*:*)
+	echo x86_64-unknown-haiku
+	exit ;;
     SX-4:SUPER-UX:*:*)
 	echo sx4-nec-superux${UNAME_RELEASE}
 	exit ;;
@@ -1243,6 +1254,16 @@
     *:Darwin:*:*)
 	UNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown
 	case $UNAME_PROCESSOR in
+	    i386)
+		eval $set_cc_for_build
+		if [ "$CC_FOR_BUILD" != 'no_compiler_found' ]; then
+		  if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
+		      (CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) | \
+		      grep IS_64BIT_ARCH >/dev/null
+		  then
+		      UNAME_PROCESSOR="x86_64"
+		  fi
+		fi ;;
 	    unknown) UNAME_PROCESSOR=powerpc ;;
 	esac
 	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
@@ -1258,7 +1279,10 @@
     *:QNX:*:4*)
 	echo i386-pc-qnx
 	exit ;;
-    NSE-?:NONSTOP_KERNEL:*:*)
+    NEO-?:NONSTOP_KERNEL:*:*)
+	echo neo-tandem-nsk${UNAME_RELEASE}
+	exit ;;
+    NSE-*:NONSTOP_KERNEL:*:*)
 	echo nse-tandem-nsk${UNAME_RELEASE}
 	exit ;;
     NSR-?:NONSTOP_KERNEL:*:*)
@@ -1303,13 +1327,13 @@
 	echo pdp10-unknown-its
 	exit ;;
     SEI:*:*:SEIUX)
-        echo mips-sei-seiux${UNAME_RELEASE}
+	echo mips-sei-seiux${UNAME_RELEASE}
 	exit ;;
     *:DragonFly:*:*)
 	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
 	exit ;;
     *:*VMS:*:*)
-    	UNAME_MACHINE=`(uname -p) 2>/dev/null`
+	UNAME_MACHINE=`(uname -p) 2>/dev/null`
 	case "${UNAME_MACHINE}" in
 	    A*) echo alpha-dec-vms ; exit ;;
 	    I*) echo ia64-dec-vms ; exit ;;
@@ -1324,11 +1348,14 @@
     i*86:rdos:*:*)
 	echo ${UNAME_MACHINE}-pc-rdos
 	exit ;;
+    i*86:AROS:*:*)
+	echo ${UNAME_MACHINE}-pc-aros
+	exit ;;
+    x86_64:VMkernel:*:*)
+	echo ${UNAME_MACHINE}-unknown-esx
+	exit ;;
 esac
 
-#echo '(No uname command or uname output not recognized.)' 1>&2
-#echo "${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}" 1>&2
-
 eval $set_cc_for_build
 cat >$dummy.c <<EOF
 #ifdef _SEQUENT_
@@ -1346,11 +1373,11 @@
 #include <sys/param.h>
   printf ("m68k-sony-newsos%s\n",
 #ifdef NEWSOS4
-          "4"
+	"4"
 #else
-	  ""
+	""
 #endif
-         ); exit (0);
+	); exit (0);
 #endif
 #endif
 
--- php-5.4.19.ori/config.sub	2013-08-20 12:42:41.000000000 +0800
+++ php-5.4.19.bak.ori/config.sub	2013-08-26 21:15:11.000000000 +0800
@@ -1,10 +1,10 @@
 #! /bin/sh
 # Configuration validation subroutine script.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008
-#   Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
+#   2011, 2012 Free Software Foundation, Inc.
 
-timestamp='2008-01-16'
+timestamp='2012-10-10'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -21,9 +21,7 @@
 # GNU General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
-# 02110-1301, USA.
+# along with this program; if not, see <http://www.gnu.org/licenses/>.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
@@ -32,13 +30,16 @@
 
 
 # Please send patches to <config-patches@gnu.org>.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+# diff and a properly formatted GNU ChangeLog entry.
 #
 # Configuration subroutine to validate and canonicalize a configuration type.
 # Supply the specified configuration type as an argument.
 # If it is invalid, we print an error message on stderr and exit with code 1.
 # Otherwise, we print the canonical config type on stdout and succeed.
 
+# You can get the latest version of this script from:
+# http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD
+
 # This file is supposed to be the same for all GNU packages
 # and recognize all the CPU types, system types and aliases
 # that are meaningful with *any* GNU software.
@@ -72,8 +73,9 @@
 version="\
 GNU config.sub ($timestamp)
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012
+Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
@@ -120,12 +122,18 @@
 # Here we must recognize all the valid KERNEL-OS combinations.
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
-  nto-qnx* | linux-gnu* | linux-dietlibc | linux-newlib* | linux-uclibc* | \
-  uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | \
+  nto-qnx* | linux-gnu* | linux-android* | linux-dietlibc | linux-newlib* | \
+  linux-musl* | linux-uclibc* | uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | \
+  knetbsd*-gnu* | netbsd*-gnu* | \
+  kopensolaris*-gnu* | \
   storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
     basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
     ;;
+  android-linux)
+    os=-linux-android
+    basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`-unknown
+    ;;
   *)
     basic_machine=`echo $1 | sed 's/-[^-]*$//'`
     if [ $basic_machine != $1 ]
@@ -148,10 +156,13 @@
 	-convergent* | -ncr* | -news | -32* | -3600* | -3100* | -hitachi* |\
 	-c[123]* | -convex* | -sun | -crds | -omron* | -dg | -ultra | -tti* | \
 	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp | \
-	-apple | -axis | -knuth | -cray)
+	-apple | -axis | -knuth | -cray | -microblaze*)
 		os=
 		basic_machine=$1
 		;;
+	-bluegene*)
+		os=-cnk
+		;;
 	-sim | -cisco | -oki | -wec | -winbond)
 		os=
 		basic_machine=$1
@@ -166,10 +177,10 @@
 		os=-chorusos
 		basic_machine=$1
 		;;
- 	-chorusrdb)
- 		os=-chorusrdb
+	-chorusrdb)
+		os=-chorusrdb
 		basic_machine=$1
- 		;;
+		;;
 	-hiux*)
 		os=-hiuxwe2
 		;;
@@ -214,6 +225,12 @@
 	-isc*)
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
+	-lynx*178)
+		os=-lynxos178
+		;;
+	-lynx*5)
+		os=-lynxos5
+		;;
 	-lynx*)
 		os=-lynxos
 		;;
@@ -238,24 +255,34 @@
 	# Some are omitted here because they have special meanings below.
 	1750a | 580 \
 	| a29k \
+	| aarch64 | aarch64_be \
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
 	| am33_2.0 \
-	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr | avr32 \
+	| arc | arceb \
+	| arm | arm[bl]e | arme[lb] | armv[2-8] | armv[3-8][lb] | armv7[arm] \
+	| avr | avr32 \
+	| be32 | be64 \
 	| bfin \
 	| c4x | clipper \
-	| d10v | d30v | dlx | dsp16xx \
+	| d10v | d30v | dlx | dsp16xx | dvp \
+	| epiphany \
 	| fido | fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
+	| hexagon \
 	| i370 | i860 | i960 | ia64 \
 	| ip2k | iq2000 \
+	| le32 | le64 \
+	| lm32 \
 	| m32c | m32r | m32rle | m68000 | m68k | m88k \
-	| maxq | mb | microblaze | mcore | mep \
+	| maxq | mb | microblaze | microblazeel | mcore | mep | metag \
 	| mips | mipsbe | mipseb | mipsel | mipsle \
 	| mips16 \
 	| mips64 | mips64el \
-	| mips64vr | mips64vrel \
+	| mips64octeon | mips64octeonel \
 	| mips64orion | mips64orionel \
+	| mips64r5900 | mips64r5900el \
+	| mips64vr | mips64vrel \
 	| mips64vr4100 | mips64vr4100el \
 	| mips64vr4300 | mips64vr4300el \
 	| mips64vr5000 | mips64vr5000el \
@@ -268,29 +295,42 @@
 	| mipsisa64sr71k | mipsisa64sr71kel \
 	| mipstx39 | mipstx39el \
 	| mn10200 | mn10300 \
+	| moxie \
 	| mt \
 	| msp430 \
+	| nds32 | nds32le | nds32be \
 	| nios | nios2 \
 	| ns16k | ns32k \
+	| open8 \
 	| or32 \
 	| pdp10 | pdp11 | pj | pjl \
-	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
+	| powerpc | powerpc64 | powerpc64le | powerpcle \
 	| pyramid \
+	| rl78 | rx \
 	| score \
-	| sh | sh[1234] | sh[24]a | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
+	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
 	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
 	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
-	| spu | strongarm \
-	| tahoe | thumb | tic4x | tic80 | tron \
-	| v850 | v850e \
+	| spu \
+	| tahoe | tic4x | tic54x | tic55x | tic6x | tic80 | tron \
+	| ubicom32 \
+	| v850 | v850e | v850e1 | v850e2 | v850es | v850e2v3 \
 	| we32k \
-	| x86 | xc16x | xscale | xscalee[bl] | xstormy16 | xtensa \
-	| z8k)
+	| x86 | xc16x | xstormy16 | xtensa \
+	| z8k | z80)
 		basic_machine=$basic_machine-unknown
 		;;
-	m6811 | m68hc11 | m6812 | m68hc12)
-		# Motorola 68HC11/12.
+	c54x)
+		basic_machine=tic54x-unknown
+		;;
+	c55x)
+		basic_machine=tic55x-unknown
+		;;
+	c6x)
+		basic_machine=tic6x-unknown
+		;;
+	m6811 | m68hc11 | m6812 | m68hc12 | m68hcs12x | picochip)
 		basic_machine=$basic_machine-unknown
 		os=-none
 		;;
@@ -300,6 +340,21 @@
 		basic_machine=mt-unknown
 		;;
 
+	strongarm | thumb | xscale)
+		basic_machine=arm-unknown
+		;;
+	xgate)
+		basic_machine=$basic_machine-unknown
+		os=-none
+		;;
+	xscaleeb)
+		basic_machine=armeb-unknown
+		;;
+
+	xscaleel)
+		basic_machine=armel-unknown
+		;;
+
 	# We use `pc' rather than `unknown'
 	# because (1) that's what they normally are, and
 	# (2) the word "unknown" tends to confuse beginning users.
@@ -314,29 +369,37 @@
 	# Recognize the basic CPU types with company name.
 	580-* \
 	| a29k-* \
+	| aarch64-* | aarch64_be-* \
 	| alpha-* | alphaev[4-8]-* | alphaev56-* | alphaev6[78]-* \
 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
-	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
+	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* | arceb-* \
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
 	| avr-* | avr32-* \
+	| be32-* | be64-* \
 	| bfin-* | bs2000-* \
-	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
+	| c[123]* | c30-* | [cjt]90-* | c4x-* \
 	| clipper-* | craynv-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
 	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
+	| hexagon-* \
 	| i*86-* | i860-* | i960-* | ia64-* \
 	| ip2k-* | iq2000-* \
+	| le32-* | le64-* \
+	| lm32-* \
 	| m32c-* | m32r-* | m32rle-* \
 	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
-	| m88110-* | m88k-* | maxq-* | mcore-* \
+	| m88110-* | m88k-* | maxq-* | mcore-* | metag-* \
+	| microblaze-* | microblazeel-* \
 	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
 	| mips16-* \
 	| mips64-* | mips64el-* \
-	| mips64vr-* | mips64vrel-* \
+	| mips64octeon-* | mips64octeonel-* \
 	| mips64orion-* | mips64orionel-* \
+	| mips64r5900-* | mips64r5900el-* \
+	| mips64vr-* | mips64vrel-* \
 	| mips64vr4100-* | mips64vr4100el-* \
 	| mips64vr4300-* | mips64vr4300el-* \
 	| mips64vr5000-* | mips64vr5000el-* \
@@ -351,27 +414,32 @@
 	| mmix-* \
 	| mt-* \
 	| msp430-* \
+	| nds32-* | nds32le-* | nds32be-* \
 	| nios-* | nios2-* \
 	| none-* | np1-* | ns16k-* | ns32k-* \
+	| open8-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
-	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
+	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* \
 	| pyramid-* \
-	| romp-* | rs6000-* \
-	| sh-* | sh[1234]-* | sh[24]a-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
+	| rl78-* | romp-* | rs6000-* | rx-* \
+	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]aeb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
 	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
 	| sparclite-* \
-	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | strongarm-* | sv1-* | sx?-* \
-	| tahoe-* | thumb-* \
+	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | sv1-* | sx?-* \
+	| tahoe-* \
 	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tile*-* \
 	| tron-* \
-	| v850-* | v850e-* | vax-* \
+	| ubicom32-* \
+	| v850-* | v850e-* | v850e1-* | v850es-* | v850e2-* | v850e2v3-* \
+	| vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xc16x-* | xps100-* | xscale-* | xscalee[bl]-* \
+	| x86-* | x86_64-* | xc16x-* | xps100-* \
 	| xstormy16-* | xtensa*-* \
 	| ymp-* \
-	| z8k-*)
+	| z8k-* | z80-*)
 		;;
 	# Recognize the basic CPU types without company name, with glob match.
 	xtensa*)
@@ -393,7 +461,7 @@
 		basic_machine=a29k-amd
 		os=-udi
 		;;
-    	abacus)
+	abacus)
 		basic_machine=abacus-unknown
 		;;
 	adobe68k)
@@ -439,6 +507,10 @@
 		basic_machine=m68k-apollo
 		os=-bsd
 		;;
+	aros)
+		basic_machine=i386-pc
+		os=-aros
+		;;
 	aux)
 		basic_machine=m68k-apple
 		os=-aux
@@ -455,10 +527,27 @@
 		basic_machine=bfin-`echo $basic_machine | sed 's/^[^-]*-//'`
 		os=-linux
 		;;
+	bluegene*)
+		basic_machine=powerpc-ibm
+		os=-cnk
+		;;
+	c54x-*)
+		basic_machine=tic54x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	c55x-*)
+		basic_machine=tic55x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	c6x-*)
+		basic_machine=tic6x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	c90)
 		basic_machine=c90-cray
 		os=-unicos
 		;;
+	cegcc)
+		basic_machine=arm-unknown
+		os=-cegcc
+		;;
 	convex-c1)
 		basic_machine=c1-convex
 		os=-bsd
@@ -487,7 +576,7 @@
 		basic_machine=craynv-cray
 		os=-unicosmp
 		;;
-	cr16)
+	cr16 | cr16-*)
 		basic_machine=cr16-unknown
 		os=-elf
 		;;
@@ -526,6 +615,10 @@
 		basic_machine=m88k-motorola
 		os=-sysv3
 		;;
+	dicos)
+		basic_machine=i686-pc
+		os=-dicos
+		;;
 	djgpp)
 		basic_machine=i586-pc
 		os=-msdosdjgpp
@@ -641,7 +734,6 @@
 	i370-ibm* | ibm*)
 		basic_machine=i370-ibm
 		;;
-# I'm not sure what "Sysv32" means.  Should this be sysv3.2?
 	i*86v32)
 		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-sysv32
@@ -699,6 +791,13 @@
 		basic_machine=ns32k-utek
 		os=-sysv
 		;;
+	microblaze*)
+		basic_machine=microblaze-xilinx
+		;;
+	mingw64)
+		basic_machine=x86_64-pc
+		os=-mingw64
+		;;
 	mingw32)
 		basic_machine=i386-pc
 		os=-mingw32
@@ -714,6 +813,24 @@
 		basic_machine=m68k-atari
 		os=-mint
 		;;
+	mipsEE* | ee | ps2)
+		basic_machine=mips64r5900el-scei
+		case $os in
+		    -linux*)
+			;;
+		    *)
+			os=-elf
+			;;
+		esac
+		;;
+	iop)
+		basic_machine=mipsel-scei
+		os=-irx
+		;;
+	dvp)
+		basic_machine=dvp-scei
+		os=-elf
+		;;
 	mips3*-*)
 		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`
 		;;
@@ -735,10 +852,18 @@
 	ms1-*)
 		basic_machine=`echo $basic_machine | sed -e 's/ms1-/mt-/'`
 		;;
+	msys)
+		basic_machine=i386-pc
+		os=-msys
+		;;
 	mvs)
 		basic_machine=i370-ibm
 		os=-mvs
 		;;
+	nacl)
+		basic_machine=le32-unknown
+		os=-nacl
+		;;
 	ncr3000)
 		basic_machine=i486-ncr
 		os=-sysv4
@@ -803,6 +928,12 @@
 	np1)
 		basic_machine=np1-gould
 		;;
+	neo-tandem)
+		basic_machine=neo-tandem
+		;;
+	nse-tandem)
+		basic_machine=nse-tandem
+		;;
 	nsr-tandem)
 		basic_machine=nsr-tandem
 		;;
@@ -885,9 +1016,10 @@
 		;;
 	power)	basic_machine=power-ibm
 		;;
-	ppc)	basic_machine=powerpc-unknown
+	ppc | ppcbe)	basic_machine=powerpc-unknown
 		;;
-	ppc-*)	basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
+	ppc-* | ppcbe-*)
+		basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppcle | powerpclittle | ppc-le | powerpc-little)
 		basic_machine=powerpcle-unknown
@@ -897,7 +1029,7 @@
 		;;
 	ppc64)	basic_machine=powerpc64-unknown
 		;;
-	ppc64-* | ppc64p7-*) basic_machine=powerpc64-`echo $basic_machine | sed 's/^[^-]*-//'`
+	ppc64-*) basic_machine=powerpc64-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppc64le | powerpc64little | ppc64-le | powerpc64-little)
 		basic_machine=powerpc64le-unknown
@@ -981,6 +1113,9 @@
 		basic_machine=i860-stratus
 		os=-sysv4
 		;;
+	strongarm-* | thumb-*)
+		basic_machine=arm-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	sun2)
 		basic_machine=m68000-sun
 		;;
@@ -1037,20 +1172,8 @@
 		basic_machine=t90-cray
 		os=-unicos
 		;;
-	tic54x | c54x*)
-		basic_machine=tic54x-unknown
-		os=-coff
-		;;
-	tic55x | c55x*)
-		basic_machine=tic55x-unknown
-		os=-coff
-		;;
-	tic6x | c6x*)
-		basic_machine=tic6x-unknown
-		os=-coff
-		;;
 	tile*)
-		basic_machine=tile-unknown
+		basic_machine=$basic_machine-unknown
 		os=-linux-gnu
 		;;
 	tx39)
@@ -1120,6 +1243,9 @@
 	xps | xps100)
 		basic_machine=xps100-honeywell
 		;;
+	xscale-* | xscalee[bl]-*)
+		basic_machine=`echo $basic_machine | sed 's/^xscale/arm/'`
+		;;
 	ymp)
 		basic_machine=ymp-cray
 		os=-unicos
@@ -1128,6 +1254,10 @@
 		basic_machine=z8k-unknown
 		os=-sim
 		;;
+	z80-*-coff)
+		basic_machine=z80-unknown
+		os=-sim
+		;;
 	none)
 		basic_machine=none-none
 		os=-none
@@ -1166,7 +1296,7 @@
 	we32k)
 		basic_machine=we32k-att
 		;;
-	sh[1234] | sh[24]a | sh[34]eb | sh[1234]le | sh[23]ele)
+	sh[1234] | sh[24]a | sh[24]aeb | sh[34]eb | sh[1234]le | sh[23]ele)
 		basic_machine=sh-unknown
 		;;
 	sparc | sparcv8 | sparcv9 | sparcv9b | sparcv9v)
@@ -1213,9 +1343,12 @@
 if [ x"$os" != x"" ]
 then
 case $os in
-        # First match some system type aliases
-        # that might get confused with valid system types.
+	# First match some system type aliases
+	# that might get confused with valid system types.
 	# -solaris* is a basic system type, with this one exception.
+	-auroraux)
+		os=-auroraux
+		;;
 	-solaris1 | -solaris1.*)
 		os=`echo $os | sed -e 's|solaris1|sunos4|'`
 		;;
@@ -1236,21 +1369,23 @@
 	# Each alternative MUST END IN A *, to match a version number.
 	# -sysv* is not here because it comes later, after sysvr4.
 	-gnu* | -bsd* | -mach* | -minix* | -genix* | -ultrix* | -irix* \
-	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -sunos | -sunos[34]*\
-	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -solaris* | -sym* \
+	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -cnk* | -sunos | -sunos[34]*\
+	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -auroraux* | -solaris* \
+	      | -sym* | -kopensolaris* \
 	      | -amigaos* | -amigados* | -msdos* | -newsos* | -unicos* | -aof* \
-	      | -aos* \
+	      | -aos* | -aros* \
 	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
 	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
 	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* \
-	      | -openbsd* | -solidbsd* \
+	      | -bitrig* | -openbsd* | -solidbsd* \
 	      | -ekkobsd* | -kfreebsd* | -freebsd* | -riscix* | -lynxos* \
 	      | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
 	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
-	      | -chorusos* | -chorusrdb* \
-	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
-	      | -mingw32* | -linux-gnu* | -linux-newlib* | -linux-uclibc* \
+	      | -chorusos* | -chorusrdb* | -cegcc* \
+	      | -cygwin* | -msys* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
+	      | -mingw32* | -mingw64* | -linux-gnu* | -linux-android* \
+	      | -linux-newlib* | -linux-musl* | -linux-uclibc* \
 	      | -uxpv* | -beos* | -mpeix* | -udk* \
 	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
@@ -1258,7 +1393,7 @@
 	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
 	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
 	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly* \
-	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops*)
+	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -es* | -irx*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
 	-qnx*)
@@ -1297,7 +1432,7 @@
 	-opened*)
 		os=-openedition
 		;;
-        -os400*)
+	-os400*)
 		os=-os400
 		;;
 	-wince*)
@@ -1346,7 +1481,7 @@
 	-sinix*)
 		os=-sysv4
 		;;
-        -tpf*)
+	-tpf*)
 		os=-tpf
 		;;
 	-triton*)
@@ -1388,6 +1523,11 @@
 	-zvmoe)
 		os=-zvmoe
 		;;
+	-dicos*)
+		os=-dicos
+		;;
+	-nacl*)
+		;;
 	-none)
 		;;
 	*)
@@ -1410,10 +1550,10 @@
 # system, and we'll never get to this point.
 
 case $basic_machine in
-        score-*)
+	score-*)
 		os=-elf
 		;;
-        spu-*)
+	spu-*)
 		os=-elf
 		;;
 	*-acorn)
@@ -1425,8 +1565,20 @@
 	arm*-semi)
 		os=-aout
 		;;
-        c4x-* | tic4x-*)
-        	os=-coff
+	c4x-* | tic4x-*)
+		os=-coff
+		;;
+	hexagon-*)
+		os=-elf
+		;;
+	tic54x-*)
+		os=-coff
+		;;
+	tic55x-*)
+		os=-coff
+		;;
+	tic6x-*)
+		os=-coff
 		;;
 	# This must come before the *-dec entry.
 	pdp10-*)
@@ -1446,14 +1598,11 @@
 		;;
 	m68000-sun)
 		os=-sunos3
-		# This also exists in the configure program, but was not the
-		# default.
-		# os=-sunos4
 		;;
 	m68*-cisco)
 		os=-aout
 		;;
-        mep-*)
+	mep-*)
 		os=-elf
 		;;
 	mips*-cisco)
@@ -1480,7 +1629,7 @@
 	*-ibm)
 		os=-aix
 		;;
-    	*-knuth)
+	*-knuth)
 		os=-mmixware
 		;;
 	*-wec)
@@ -1585,7 +1734,7 @@
 			-sunos*)
 				vendor=sun
 				;;
-			-aix*)
+			-cnk*|-aix*)
 				vendor=ibm
 				;;
 			-beos*)
--- php-5.4.19.ori/configure	2013-08-20 13:14:41.000000000 +0800
+++ php-5.4.19.bak.ori/configure	2013-08-28 17:05:06.000000000 +0800
@@ -1,11 +1,11 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.65.
+# Generated by GNU Autoconf 2.68.
 #
 #
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009 Free Software Foundation,
-# Inc.
+# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free Software
+# Foundation, Inc.
 #
 #
 # This configure script is free software; the Free Software Foundation
@@ -89,6 +89,7 @@
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
+as_myself=
 case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
@@ -214,11 +215,18 @@
   # We cannot yet assume a decent shell, so we have to provide a
 	# neutralization value for shells without unset; and this also
 	# works around shells that cannot unset nonexistent variables.
+	# Preserve -v and -x to the replacement shell.
 	BASH_ENV=/dev/null
 	ENV=/dev/null
 	(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
 	export CONFIG_SHELL
-	exec "$CONFIG_SHELL" "$as_myself" ${1+"$@"}
+	case $- in # ((((
+	  *v*x* | *x*v* ) as_opts=-vx ;;
+	  *v* ) as_opts=-v ;;
+	  *x* ) as_opts=-x ;;
+	  * ) as_opts= ;;
+	esac
+	exec "$CONFIG_SHELL" $as_opts "$as_myself" ${1+"$@"}
 fi
 
     if test x$as_have_required = xno; then :
@@ -316,7 +324,7 @@
       test -d "$as_dir" && break
     done
     test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || as_fn_error "cannot create directory $as_dir"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
 
 
 } # as_fn_mkdir_p
@@ -356,19 +364,19 @@
 fi # as_fn_arith
 
 
-# as_fn_error ERROR [LINENO LOG_FD]
-# ---------------------------------
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
 # Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
 # provided, also output the error to LOG_FD, referencing LINENO. Then exit the
-# script with status $?, using 1 if that was 0.
+# script with STATUS, using 1 if that was 0.
 as_fn_error ()
 {
-  as_status=$?; test $as_status -eq 0 && as_status=1
-  if test "$3"; then
-    as_lineno=${as_lineno-"$2"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-    $as_echo "$as_me:${as_lineno-$LINENO}: error: $1" >&$3
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
   fi
-  $as_echo "$as_me: error: $1" >&2
+  $as_echo "$as_me: error: $2" >&2
   as_fn_exit $as_status
 } # as_fn_error
 
@@ -682,7 +690,7 @@
 exec 6>&1
 
 # Name of the host.
-# hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
+# hostname on some systems (SVR3.2, old GNU/Linux) returns a bogus exit status,
 # so uname gets run too.
 ac_hostname=`(hostname || uname -n) 2>/dev/null | sed 1q`
 
@@ -807,6 +815,8 @@
 CXXFLAGS
 CXX
 ICU_CONFIG
+GENHTML
+LCOV
 OPENSSL_INCDIR_OPT
 PKG_CONFIG
 KRB5_CONFIG
@@ -948,6 +958,17 @@
 with_sqlite3
 with_zlib
 with_zlib_dir
+enable_apc
+enable_apc_debug
+enable_apc_filehits
+enable_apc_mmap
+enable_apc_sem
+enable_apc_pthreadmutex
+enable_apc_pthreadrwlocks
+enable_apc_spinlocks
+enable_apc_memprotect
+enable_valgrind_checks
+enable_coverage
 enable_bcmath
 with_bz2
 enable_calendar
@@ -1155,8 +1176,9 @@
   fi
 
   case $ac_option in
-  *=*)	ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
-  *)	ac_optarg=yes ;;
+  *=?*) ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
+  *=)   ac_optarg= ;;
+  *)    ac_optarg=yes ;;
   esac
 
   # Accept the important Cygnus configure options, so we can diagnose typos.
@@ -1201,7 +1223,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error "invalid feature name: $ac_useropt"
+      as_fn_error $? "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1227,7 +1249,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error "invalid feature name: $ac_useropt"
+      as_fn_error $? "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1431,7 +1453,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error "invalid package name: $ac_useropt"
+      as_fn_error $? "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1447,7 +1469,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*without-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error "invalid package name: $ac_useropt"
+      as_fn_error $? "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1477,8 +1499,8 @@
   | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
     x_libraries=$ac_optarg ;;
 
-  -*) as_fn_error "unrecognized option: \`$ac_option'
-Try \`$0 --help' for more information."
+  -*) as_fn_error $? "unrecognized option: \`$ac_option'
+Try \`$0 --help' for more information"
     ;;
 
   *=*)
@@ -1486,7 +1508,7 @@
     # Reject names that are not valid shell variable names.
     case $ac_envvar in #(
       '' | [0-9]* | *[!_$as_cr_alnum]* )
-      as_fn_error "invalid variable name: \`$ac_envvar'" ;;
+      as_fn_error $? "invalid variable name: \`$ac_envvar'" ;;
     esac
     eval $ac_envvar=\$ac_optarg
     export $ac_envvar ;;
@@ -1496,7 +1518,7 @@
     $as_echo "$as_me: WARNING: you should use --build, --host, --target" >&2
     expr "x$ac_option" : ".*[^-._$as_cr_alnum]" >/dev/null &&
       $as_echo "$as_me: WARNING: invalid host type: $ac_option" >&2
-    : ${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}
+    : "${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}"
     ;;
 
   esac
@@ -1504,13 +1526,13 @@
 
 if test -n "$ac_prev"; then
   ac_option=--`echo $ac_prev | sed 's/_/-/g'`
-  as_fn_error "missing argument to $ac_option"
+  as_fn_error $? "missing argument to $ac_option"
 fi
 
 if test -n "$ac_unrecognized_opts"; then
   case $enable_option_checking in
     no) ;;
-    fatal) as_fn_error "unrecognized options: $ac_unrecognized_opts" ;;
+    fatal) as_fn_error $? "unrecognized options: $ac_unrecognized_opts" ;;
     *)     $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2 ;;
   esac
 fi
@@ -1533,7 +1555,7 @@
     [\\/$]* | ?:[\\/]* )  continue;;
     NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
   esac
-  as_fn_error "expected an absolute directory name for --$ac_var: $ac_val"
+  as_fn_error $? "expected an absolute directory name for --$ac_var: $ac_val"
 done
 
 # There might be people who depend on the old broken behavior: `$host'
@@ -1547,8 +1569,8 @@
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    $as_echo "$as_me: WARNING: If you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used." >&2
+    $as_echo "$as_me: WARNING: if you wanted to set the --build type, don't use --host.
+    If a cross compiler is detected then cross compile mode will be used" >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1563,9 +1585,9 @@
 ac_pwd=`pwd` && test -n "$ac_pwd" &&
 ac_ls_di=`ls -di .` &&
 ac_pwd_ls_di=`cd "$ac_pwd" && ls -di .` ||
-  as_fn_error "working directory cannot be determined"
+  as_fn_error $? "working directory cannot be determined"
 test "X$ac_ls_di" = "X$ac_pwd_ls_di" ||
-  as_fn_error "pwd does not report name of working directory"
+  as_fn_error $? "pwd does not report name of working directory"
 
 
 # Find the source files, if location was not specified.
@@ -1604,11 +1626,11 @@
 fi
 if test ! -r "$srcdir/$ac_unique_file"; then
   test "$ac_srcdir_defaulted" = yes && srcdir="$ac_confdir or .."
-  as_fn_error "cannot find sources ($ac_unique_file) in $srcdir"
+  as_fn_error $? "cannot find sources ($ac_unique_file) in $srcdir"
 fi
 ac_msg="sources are in $srcdir, but \`cd $srcdir' does not work"
 ac_abs_confdir=`(
-	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error "$ac_msg"
+	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error $? "$ac_msg"
 	pwd)`
 # When building in place, set srcdir=.
 if test "$ac_abs_confdir" = "$ac_pwd"; then
@@ -1648,7 +1670,7 @@
       --help=short        display options specific to this package
       --help=recursive    display the short help of all the included packages
   -V, --version           display version information and exit
-  -q, --quiet, --silent   do not print \`checking...' messages
+  -q, --quiet, --silent   do not print \`checking ...' messages
       --cache-file=FILE   cache test results in FILE [disabled]
   -C, --config-cache      alias for \`--cache-file=config.cache'
   -n, --no-create         do not create output files
@@ -1804,6 +1826,24 @@
                           SQLite3 installation directory.
   --with-zlib=DIR       Include ZLIB support (requires zlib >= 1.0.9)
   --with-zlib-dir=<DIR>   Define the location of zlib install directory
+  --enable-apc           Enable APC support
+  --enable-apc-debug     Enable APC debugging
+  --enable-apc-filehits   Enable per request file info about files used from the APC cache (ie: apc_cache_info('filehits'))
+  --disable-apc-mmap
+                          Disable mmap support and use IPC shm instead
+  --enable-apc-sem
+                          Enable semaphore locks instead of fcntl
+  --disable-apc-pthreadmutex
+                          Disable pthread mutex locking
+  --enable-apc-pthreadrwlocks
+                          Enable pthread read/write locking
+  --enable-apc-spinlocks
+                          Enable spin locks  EXPERIMENTAL
+  --enable-apc-memprotect
+                          Enable mmap/shm memory protection
+  --disable-valgrind-checks
+                          Disable valgrind based memory checks
+  --enable-coverage           DEVELOPERS ONLY!!
   --enable-bcmath         Enable bc style precision math functions
   --with-bz2=DIR        Include BZip2 support
   --enable-calendar       Enable support for calendar conversion
@@ -2039,8 +2079,9 @@
   CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if
               you have headers in a nonstandard directory <include dir>
   CPP         C preprocessor
-  YACC        The `Yet Another C Compiler' implementation to use. Defaults to
-              the first program found out of: `bison -y', `byacc', `yacc'.
+  YACC        The `Yet Another Compiler Compiler' implementation to use.
+              Defaults to the first program found out of: `bison -y', `byacc',
+              `yacc'.
   YFLAGS      The list of arguments that will be passed by default to $YACC.
               This script will default YFLAGS to the empty string to avoid a
               default value of `-d' given by some make applications.
@@ -2115,9 +2156,9 @@
 if $ac_init_version; then
   cat <<\_ACEOF
 configure
-generated by GNU Autoconf 2.65
+generated by GNU Autoconf 2.68
 
-Copyright (C) 2009 Free Software Foundation, Inc.
+Copyright (C) 2010 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -2161,7 +2202,7 @@
 
 	ac_retval=1
 fi
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
   as_fn_set_status $ac_retval
 
 } # ac_fn_c_try_compile
@@ -2187,7 +2228,7 @@
     mv -f conftest.er1 conftest.err
   fi
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } >/dev/null && {
+  test $ac_status = 0; } > conftest.i && {
 	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
 	 test ! -s conftest.err
        }; then :
@@ -2198,7 +2239,7 @@
 
     ac_retval=1
 fi
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
   as_fn_set_status $ac_retval
 
 } # ac_fn_c_try_cpp
@@ -2211,10 +2252,10 @@
 ac_fn_c_check_header_mongrel ()
 {
   as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+  if eval \${$3+:} false; then :
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
 $as_echo_n "checking for $2... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$3+:} false; then :
   $as_echo_n "(cached) " >&6
 fi
 eval ac_res=\$$3
@@ -2250,7 +2291,7 @@
 else
   ac_header_preproc=no
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc" >&5
 $as_echo "$ac_header_preproc" >&6; }
 
@@ -2277,7 +2318,7 @@
 esac
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
 $as_echo_n "checking for $2... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$3+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   eval "$3=\$ac_header_compiler"
@@ -2286,7 +2327,7 @@
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
 fi
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
 } # ac_fn_c_check_header_mongrel
 
@@ -2327,7 +2368,7 @@
        ac_retval=$ac_status
 fi
   rm -rf conftest.dSYM conftest_ipa8_conftest.oo
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
   as_fn_set_status $ac_retval
 
 } # ac_fn_c_try_run
@@ -2341,7 +2382,7 @@
   as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
 $as_echo_n "checking for $2... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$3+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -2359,7 +2400,7 @@
 eval ac_res=\$$3
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
 } # ac_fn_c_check_header_compile
 
@@ -2404,7 +2445,7 @@
   # interfere with the next link command; also delete a directory that is
   # left behind by Apple's compiler.  We do this before executing the actions.
   rm -rf conftest.dSYM conftest_ipa8_conftest.oo
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
   as_fn_set_status $ac_retval
 
 } # ac_fn_c_try_link
@@ -2417,7 +2458,7 @@
   as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
 $as_echo_n "checking for $2... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$3+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -2472,7 +2513,7 @@
 eval ac_res=\$$3
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
 } # ac_fn_c_check_func
 
@@ -2485,7 +2526,7 @@
   as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2.$3" >&5
 $as_echo_n "checking for $2.$3... " >&6; }
-if { as_var=$4; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$4+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -2529,19 +2570,22 @@
 eval ac_res=\$$4
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
 } # ac_fn_c_check_member
 
-# ac_fn_c_check_decl LINENO SYMBOL VAR
-# ------------------------------------
-# Tests whether SYMBOL is declared, setting cache variable VAR accordingly.
+# ac_fn_c_check_decl LINENO SYMBOL VAR INCLUDES
+# ---------------------------------------------
+# Tests whether SYMBOL is declared in INCLUDES, setting cache variable VAR
+# accordingly.
 ac_fn_c_check_decl ()
 {
   as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $2 is declared" >&5
-$as_echo_n "checking whether $2 is declared... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+  as_decl_name=`echo $2|sed 's/ *(.*//'`
+  as_decl_use=`echo $2|sed -e 's/(/((/' -e 's/)/) 0&/' -e 's/,/) 0& (/g'`
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $as_decl_name is declared" >&5
+$as_echo_n "checking whether $as_decl_name is declared... " >&6; }
+if eval \${$3+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -2550,8 +2594,12 @@
 int
 main ()
 {
-#ifndef $2
-  (void) $2;
+#ifndef $as_decl_name
+#ifdef __cplusplus
+  (void) $as_decl_use;
+#else
+  (void) $as_decl_name;
+#endif
 #endif
 
   ;
@@ -2568,7 +2616,7 @@
 eval ac_res=\$$3
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
 } # ac_fn_c_check_decl
 
@@ -2745,7 +2793,7 @@
 rm -f conftest.val
 
   fi
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
   as_fn_set_status $ac_retval
 
 } # ac_fn_c_compute_int
@@ -2759,7 +2807,7 @@
   as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
 $as_echo_n "checking for $2... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$3+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   eval "$3=no"
@@ -2800,7 +2848,7 @@
 eval ac_res=\$$3
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
 } # ac_fn_c_check_type
 
@@ -2837,7 +2885,7 @@
 
 	ac_retval=1
 fi
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
   as_fn_set_status $ac_retval
 
 } # ac_fn_cxx_try_compile
@@ -2863,7 +2911,7 @@
     mv -f conftest.er1 conftest.err
   fi
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } >/dev/null && {
+  test $ac_status = 0; } > conftest.i && {
 	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
 	 test ! -s conftest.err
        }; then :
@@ -2874,7 +2922,7 @@
 
     ac_retval=1
 fi
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
   as_fn_set_status $ac_retval
 
 } # ac_fn_cxx_try_cpp
@@ -2883,7 +2931,7 @@
 running configure, to aid debugging if configure makes a mistake.
 
 It was created by $as_me, which was
-generated by GNU Autoconf 2.65.  Invocation command line was
+generated by GNU Autoconf 2.68.  Invocation command line was
 
   $ $0 $@
 
@@ -2993,11 +3041,9 @@
   {
     echo
 
-    cat <<\_ASBOX
-## ---------------- ##
+    $as_echo "## ---------------- ##
 ## Cache variables. ##
-## ---------------- ##
-_ASBOX
+## ---------------- ##"
     echo
     # The following way of writing the cache mishandles newlines in values,
 (
@@ -3031,11 +3077,9 @@
 )
     echo
 
-    cat <<\_ASBOX
-## ----------------- ##
+    $as_echo "## ----------------- ##
 ## Output variables. ##
-## ----------------- ##
-_ASBOX
+## ----------------- ##"
     echo
     for ac_var in $ac_subst_vars
     do
@@ -3048,11 +3092,9 @@
     echo
 
     if test -n "$ac_subst_files"; then
-      cat <<\_ASBOX
-## ------------------- ##
+      $as_echo "## ------------------- ##
 ## File substitutions. ##
-## ------------------- ##
-_ASBOX
+## ------------------- ##"
       echo
       for ac_var in $ac_subst_files
       do
@@ -3066,11 +3108,9 @@
     fi
 
     if test -s confdefs.h; then
-      cat <<\_ASBOX
-## ----------- ##
+      $as_echo "## ----------- ##
 ## confdefs.h. ##
-## ----------- ##
-_ASBOX
+## ----------- ##"
       echo
       cat confdefs.h
       echo
@@ -3125,7 +3165,12 @@
 ac_site_file1=NONE
 ac_site_file2=NONE
 if test -n "$CONFIG_SITE"; then
-  ac_site_file1=$CONFIG_SITE
+  # We do not want a PATH search for config.site.
+  case $CONFIG_SITE in #((
+    -*)  ac_site_file1=./$CONFIG_SITE;;
+    */*) ac_site_file1=$CONFIG_SITE;;
+    *)   ac_site_file1=./$CONFIG_SITE;;
+  esac
 elif test "x$prefix" != xNONE; then
   ac_site_file1=$prefix/share/config.site
   ac_site_file2=$prefix/etc/config.site
@@ -3140,7 +3185,11 @@
     { $as_echo "$as_me:${as_lineno-$LINENO}: loading site script $ac_site_file" >&5
 $as_echo "$as_me: loading site script $ac_site_file" >&6;}
     sed 's/^/| /' "$ac_site_file" >&5
-    . "$ac_site_file"
+    . "$ac_site_file" \
+      || { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "failed to load site script $ac_site_file
+See \`config.log' for more details" "$LINENO" 5; }
   fi
 done
 
@@ -3217,7 +3266,7 @@
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
   { $as_echo "$as_me:${as_lineno-$LINENO}: error: changes in the environment can compromise the build" >&5
 $as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
-  as_fn_error "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
+  as_fn_error $? "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
 fi
 ## -------------------- ##
 ## Main body of script. ##
@@ -3236,7 +3285,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for grep that handles long lines and -e" >&5
 $as_echo_n "checking for grep that handles long lines and -e... " >&6; }
-if test "${ac_cv_path_GREP+set}" = set; then :
+if ${ac_cv_path_GREP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$GREP"; then
@@ -3285,7 +3334,7 @@
   done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_GREP"; then
-    as_fn_error "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+    as_fn_error $? "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_GREP=$GREP
@@ -3299,7 +3348,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
 $as_echo_n "checking for egrep... " >&6; }
-if test "${ac_cv_path_EGREP+set}" = set; then :
+if ${ac_cv_path_EGREP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
@@ -3351,7 +3400,7 @@
   done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_EGREP"; then
-    as_fn_error "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_EGREP=$EGREP
@@ -3366,7 +3415,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for a sed that does not truncate output" >&5
 $as_echo_n "checking for a sed that does not truncate output... " >&6; }
-if test "${lt_cv_path_SED+set}" = set; then :
+if ${lt_cv_path_SED+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   # Loop through the user's path and test for sed and gsed.
@@ -3492,16 +3541,22 @@
 
 ac_aux_dir=
 for ac_dir in "$srcdir" "$srcdir/.." "$srcdir/../.."; do
-  for ac_t in install-sh install.sh shtool; do
-    if test -f "$ac_dir/$ac_t"; then
-      ac_aux_dir=$ac_dir
-      ac_install_sh="$ac_aux_dir/$ac_t -c"
-      break 2
-    fi
-  done
+  if test -f "$ac_dir/install-sh"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install-sh -c"
+    break
+  elif test -f "$ac_dir/install.sh"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install.sh -c"
+    break
+  elif test -f "$ac_dir/shtool"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/shtool install -c"
+    break
+  fi
 done
 if test -z "$ac_aux_dir"; then
-  as_fn_error "cannot find install-sh, install.sh, or shtool in \"$srcdir\" \"$srcdir/..\" \"$srcdir/../..\"" "$LINENO" 5
+  as_fn_error $? "cannot find install-sh, install.sh, or shtool in \"$srcdir\" \"$srcdir/..\" \"$srcdir/../..\"" "$LINENO" 5
 fi
 
 # These three variables are undocumented and unsupported,
@@ -3515,27 +3570,27 @@
 
 # Make sure we can run config.sub.
 $SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
-  as_fn_error "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
+  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
 $as_echo_n "checking build system type... " >&6; }
-if test "${ac_cv_build+set}" = set; then :
+if ${ac_cv_build+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_build_alias=$build_alias
 test "x$ac_build_alias" = x &&
   ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
 test "x$ac_build_alias" = x &&
-  as_fn_error "cannot guess build type; you must specify one" "$LINENO" 5
+  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
 ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
-  as_fn_error "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
+  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
 
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
 $as_echo "$ac_cv_build" >&6; }
 case $ac_cv_build in
 *-*-*) ;;
-*) as_fn_error "invalid value of canonical build" "$LINENO" 5;;
+*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5;;
 esac
 build=$ac_cv_build
 ac_save_IFS=$IFS; IFS='-'
@@ -3553,14 +3608,14 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
 $as_echo_n "checking host system type... " >&6; }
-if test "${ac_cv_host+set}" = set; then :
+if ${ac_cv_host+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "x$host_alias" = x; then
   ac_cv_host=$ac_cv_build
 else
   ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
-    as_fn_error "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
 fi
 
 fi
@@ -3568,7 +3623,7 @@
 $as_echo "$ac_cv_host" >&6; }
 case $ac_cv_host in
 *-*-*) ;;
-*) as_fn_error "invalid value of canonical host" "$LINENO" 5;;
+*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5;;
 esac
 host=$ac_cv_host
 ac_save_IFS=$IFS; IFS='-'
@@ -3586,14 +3641,14 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking target system type" >&5
 $as_echo_n "checking target system type... " >&6; }
-if test "${ac_cv_target+set}" = set; then :
+if ${ac_cv_target+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "x$target_alias" = x; then
   ac_cv_target=$ac_cv_host
 else
   ac_cv_target=`$SHELL "$ac_aux_dir/config.sub" $target_alias` ||
-    as_fn_error "$SHELL $ac_aux_dir/config.sub $target_alias failed" "$LINENO" 5
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $target_alias failed" "$LINENO" 5
 fi
 
 fi
@@ -3601,7 +3656,7 @@
 $as_echo "$ac_cv_target" >&6; }
 case $ac_cv_target in
 *-*-*) ;;
-*) as_fn_error "invalid value of canonical target" "$LINENO" 5;;
+*) as_fn_error $? "invalid value of canonical target" "$LINENO" 5;;
 esac
 target=$ac_cv_target
 ac_save_IFS=$IFS; IFS='-'
@@ -3628,7 +3683,7 @@
     host_alias=$host
   fi
   if test -z "$host_alias"; then
-    as_fn_error "host_alias is not set!" "$LINENO" 5
+    as_fn_error $? "host_alias is not set!" "$LINENO" 5
   fi
 
 
@@ -3678,15 +3733,15 @@
 
 
 if test "$with_shared_apache" != "no" && test -n "$with_shared_apache" ; then
-  as_fn_error "--with-shared-apache is not supported. Please refer to the documentation for using APXS" "$LINENO" 5
+  as_fn_error $? "--with-shared-apache is not supported. Please refer to the documentation for using APXS" "$LINENO" 5
 fi
 
 if test -n "$with_apache" && test -n "$with_apxs"; then
-  as_fn_error "--with-apache and --with-apxs cannot be used together" "$LINENO" 5
+  as_fn_error $? "--with-apache and --with-apxs cannot be used together" "$LINENO" 5
 fi
 
 if test -n "$with_apxs2filter" && test -n "$with_apxs2"; then
-  as_fn_error "--with-apxs2filter and --with-apxs2 cannot be used together" "$LINENO" 5
+  as_fn_error $? "--with-apxs2filter and --with-apxs2 cannot be used together" "$LINENO" 5
 fi
 
 
@@ -3730,7 +3785,7 @@
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then :
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -3774,7 +3829,7 @@
 set dummy $ac_prog; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then :
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -3826,8 +3881,8 @@
 
 test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "no acceptable C compiler found in \$PATH
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
 
 # Provide some information about the compiler.
 $as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
@@ -3941,9 +3996,8 @@
 
 { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "C compiler cannot create executables
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "C compiler cannot create executables
+See \`config.log' for more details" "$LINENO" 5; }
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
@@ -3985,8 +4039,8 @@
 else
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "cannot compute suffix of executables: cannot compile and link
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 rm -f conftest conftest$ac_cv_exeext
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_exeext" >&5
@@ -4043,9 +4097,9 @@
     else
 	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "cannot run C compiled programs.
+as_fn_error $? "cannot run C compiled programs.
 If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." "$LINENO" 5; }
+See \`config.log' for more details" "$LINENO" 5; }
     fi
   fi
 fi
@@ -4056,7 +4110,7 @@
 ac_clean_files=$ac_clean_files_save
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of object files" >&5
 $as_echo_n "checking for suffix of object files... " >&6; }
-if test "${ac_cv_objext+set}" = set; then :
+if ${ac_cv_objext+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -4096,8 +4150,8 @@
 
 { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "cannot compute suffix of object files: cannot compile
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 rm -f conftest.$ac_cv_objext conftest.$ac_ext
 fi
@@ -4107,7 +4161,7 @@
 ac_objext=$OBJEXT
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
 $as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then :
+if ${ac_cv_c_compiler_gnu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -4144,7 +4198,7 @@
 ac_save_CFLAGS=$CFLAGS
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
 $as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then :
+if ${ac_cv_prog_cc_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_save_c_werror_flag=$ac_c_werror_flag
@@ -4222,7 +4276,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
 $as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then :
+if ${ac_cv_prog_cc_c89+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_cv_prog_cc_c89=no
@@ -4330,7 +4384,7 @@
   CPP=
 fi
 if test -z "$CPP"; then
-  if test "${ac_cv_prog_CPP+set}" = set; then :
+  if ${ac_cv_prog_CPP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
       # Double quotes because CPP needs to be expanded
@@ -4360,7 +4414,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -4376,11 +4430,11 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
   break
 fi
@@ -4419,7 +4473,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -4435,18 +4489,18 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
 
 else
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 
 ac_ext=c
@@ -4513,7 +4567,7 @@
 fi
 set dummy $CC; ac_cc=`$as_echo "$2" |
 		      sed 's/[^a-zA-Z0-9_]/_/g;s/^[0-9]/_/'`
-if { as_var=ac_cv_prog_cc_${ac_cc}_c_o; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${ac_cv_prog_cc_${ac_cc}_c_o+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -4627,7 +4681,7 @@
   CPP=
 fi
 if test -z "$CPP"; then
-  if test "${ac_cv_prog_CPP+set}" = set; then :
+  if ${ac_cv_prog_CPP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
       # Double quotes because CPP needs to be expanded
@@ -4657,7 +4711,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -4673,11 +4727,11 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
   break
 fi
@@ -4716,7 +4770,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -4732,18 +4786,18 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
 
 else
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 
 ac_ext=c
@@ -4754,7 +4808,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
 $as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then :
+if ${ac_cv_header_stdc+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -4871,8 +4925,7 @@
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
 "
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -4884,7 +4937,7 @@
 
 
   ac_fn_c_check_header_mongrel "$LINENO" "minix/config.h" "ac_cv_header_minix_config_h" "$ac_includes_default"
-if test "x$ac_cv_header_minix_config_h" = x""yes; then :
+if test "x$ac_cv_header_minix_config_h" = xyes; then :
   MINIX=yes
 else
   MINIX=
@@ -4906,7 +4959,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether it is safe to define __EXTENSIONS__" >&5
 $as_echo_n "checking whether it is safe to define __EXTENSIONS__... " >&6; }
-if test "${ac_cv_safe_to_define___extensions__+set}" = set; then :
+if ${ac_cv_safe_to_define___extensions__+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -5006,7 +5059,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if compiler supports -R" >&5
 $as_echo_n "checking if compiler supports -R... " >&6; }
-if test "${php_cv_cc_dashr+set}" = set; then :
+if ${php_cv_cc_dashr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -5040,7 +5093,7 @@
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking if compiler supports -Wl,-rpath," >&5
 $as_echo_n "checking if compiler supports -Wl,-rpath,... " >&6; }
-  if test "${php_cv_cc_rpath+set}" = set; then :
+  if ${php_cv_cc_rpath+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -5087,7 +5140,7 @@
 set dummy $ac_prog; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_AWK+set}" = set; then :
+if ${ac_cv_prog_AWK+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$AWK"; then
@@ -5133,7 +5186,7 @@
     *gawk)
       ;;
     bork)
-      as_fn_error "Could not find awk; Install GNU awk" "$LINENO" 5
+      as_fn_error $? "Could not find awk; Install GNU awk" "$LINENO" 5
       ;;
     *)
       { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $AWK is broken" >&5
@@ -5141,7 +5194,7 @@
       if ! $AWK 'function foo() {}' >/dev/null 2>&1 ; then
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-        as_fn_error "You should install GNU awk" "$LINENO" 5
+        as_fn_error $? "You should install GNU awk" "$LINENO" 5
       else
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
@@ -5159,7 +5212,7 @@
 set dummy $ac_prog; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_YACC+set}" = set; then :
+if ${ac_cv_prog_YACC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$YACC"; then
@@ -5207,7 +5260,7 @@
   if test "$YACC"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for bison version" >&5
 $as_echo_n "checking for bison version... " >&6; }
-if test "${php_cv_bison_version+set}" = set; then :
+if ${php_cv_bison_version+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -5246,7 +5299,7 @@
 set dummy re2c; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_RE2C+set}" = set; then :
+if ${ac_cv_prog_RE2C+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$RE2C"; then
@@ -5282,7 +5335,7 @@
   if test -n "$RE2C"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for re2c version" >&5
 $as_echo_n "checking for re2c version... " >&6; }
-if test "${php_cv_re2c_version+set}" = set; then :
+if ${php_cv_re2c_version+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -5312,7 +5365,7 @@
 case $php_cv_bison_version in
   ""|invalid)
     if ! test -f "$abs_srcdir/Zend/zend_language_parser.h" || ! test -f "$abs_srcdir/Zend/zend_language_parser.c" ; then
-      as_fn_error "bison is required to build PHP/Zend when building a GIT checkout!" "$LINENO" 5
+      as_fn_error $? "bison is required to build PHP/Zend when building a GIT checkout!" "$LINENO" 5
     fi
     ;;
 esac
@@ -5432,7 +5485,7 @@
   gcc_arg_name=ac_cv_gcc_arg_no_cpp_precomp
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC supports -no-cpp-precomp" >&5
 $as_echo_n "checking whether $CC supports -no-cpp-precomp... " >&6; }
-if test "${ac_cv_gcc_arg_no_cpp_precomp+set}" = set; then :
+if ${ac_cv_gcc_arg_no_cpp_precomp+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -5770,7 +5823,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthreads_cflags" >&5
 $as_echo_n "checking for pthreads_cflags... " >&6; }
-if test "${ac_cv_pthreads_cflags+set}" = set; then :
+if ${ac_cv_pthreads_cflags+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -5836,7 +5889,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthreads_lib" >&5
 $as_echo_n "checking for pthreads_lib... " >&6; }
-if test "${ac_cv_pthreads_lib+set}" = set; then :
+if ${ac_cv_pthreads_lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -6007,15 +6060,15 @@
     PHP_AOLSERVER_SRC=$PHP_AOLSERVER
   fi
   if test -z "$PHP_AOLSERVER_SRC" || test ! -d $PHP_AOLSERVER_SRC/include; then
-    as_fn_error "Please specify the path to the source distribution of AOLserver using --with-aolserver-src=DIR" "$LINENO" 5
+    as_fn_error $? "Please specify the path to the source distribution of AOLserver using --with-aolserver-src=DIR" "$LINENO" 5
   fi
   if test ! -d $PHP_AOLSERVER/bin ; then
-    as_fn_error "Please specify the path to the root of AOLserver using --with-aolserver=DIR" "$LINENO" 5
+    as_fn_error $? "Please specify the path to the root of AOLserver using --with-aolserver=DIR" "$LINENO" 5
   fi
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
 
@@ -6056,7 +6109,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES aolserver"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -6285,7 +6338,7 @@
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: The output of $APXS follows" >&5
 $as_echo "The output of $APXS follows" >&6; }
     $APXS -q CFLAGS
-    as_fn_error "Aborting" "$LINENO" 5
+    as_fn_error $? "Aborting" "$LINENO" 5
   fi
 
   APXS_LDFLAGS="@SYBASE_LFLAGS@ @SYBASE_LIBS@ @SYBASE_CT_LFLAGS@ @SYBASE_CT_LIBS@"
@@ -6306,7 +6359,7 @@
   APACHE_VERSION=`expr $4 \* 1000000 + $5 \* 1000 + $6`
 
   if test "$APACHE_VERSION" -ge 2000000; then
-    as_fn_error "You have enabled Apache 1.3 support while your server is Apache 2.  Please use the appropiate switch --with-apxs2" "$LINENO" 5
+    as_fn_error $? "You have enabled Apache 1.3 support while your server is Apache 2.  Please use the appropiate switch --with-apxs2" "$LINENO" 5
   fi
 
   for flag in $APXS_CFLAGS; do
@@ -6339,7 +6392,7 @@
   if test "$build_type" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -6593,7 +6646,7 @@
   if test "static" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -6760,7 +6813,7 @@
     fi
   # For Apache 2.0.x
   elif test -f $PHP_APACHE/include/httpd.h && test -f $PHP_APACHE/srclib/apr/include/apr_general.h ; then
-    as_fn_error "Use --with-apxs2 with Apache 2.x!" "$LINENO" 5
+    as_fn_error $? "Use --with-apxs2 with Apache 2.x!" "$LINENO" 5
   # For Apache 1.3.x
   elif test -f $PHP_APACHE/src/main/httpd.h; then
     APACHE_HAS_REGEX=1
@@ -6773,7 +6826,7 @@
   if test "static" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -6943,7 +6996,7 @@
 $as_echo "#define HAVE_AP_COMPAT_H 1" >>confdefs.h
 
       if test ! -f $PHP_APACHE/src/include/ap_config_auto.h; then
-        as_fn_error "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
+        as_fn_error $? "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
       fi
     elif test -f $PHP_APACHE/src/include/compat.h; then
 
@@ -6962,7 +7015,7 @@
   if test "static" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -7132,7 +7185,7 @@
 $as_echo "#define HAVE_AP_COMPAT_H 1" >>confdefs.h
 
       if test ! -f $PHP_APACHE/src/include/ap_config_auto.h; then
-        as_fn_error "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
+        as_fn_error $? "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
       fi
     elif test -f $PHP_APACHE/src/include/compat.h; then
 
@@ -7147,7 +7200,7 @@
   if test "static" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -7317,7 +7370,7 @@
 $as_echo "#define HAVE_AP_COMPAT_H 1" >>confdefs.h
 
       if test ! -f $PHP_APACHE/src/include/ap_config_auto.h; then
-        as_fn_error "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
+        as_fn_error $? "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
       fi
     elif test -f $PHP_APACHE/src/compat.h; then
 
@@ -7327,7 +7380,7 @@
   else
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-    as_fn_error "Invalid Apache directory - unable to find httpd.h under $PHP_APACHE" "$LINENO" 5
+    as_fn_error $? "Invalid Apache directory - unable to find httpd.h under $PHP_APACHE" "$LINENO" 5
   fi
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
@@ -7375,7 +7428,7 @@
   gcc_arg_name=ac_cv_gcc_arg_rdynamic
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC supports -rdynamic" >&5
 $as_echo_n "checking whether $CC supports -rdynamic... " >&6; }
-if test "${ac_cv_gcc_arg_rdynamic+set}" = set; then :
+if ${ac_cv_gcc_arg_rdynamic+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -7418,7 +7471,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for member fd in BUFF *" >&5
 $as_echo_n "checking for member fd in BUFF *... " >&6; }
-if test "${ac_cv_php_fd_in_buff+set}" = set; then :
+if ${ac_cv_php_fd_in_buff+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -7551,7 +7604,7 @@
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: The output of $APXS follows:" >&5
 $as_echo "The output of $APXS follows:" >&6; }
     $APXS -q CFLAGS
-    as_fn_error "Aborting" "$LINENO" 5
+    as_fn_error $? "Aborting" "$LINENO" 5
   fi
 
   APXS_INCLUDEDIR=`$APXS -q INCLUDEDIR`
@@ -7590,9 +7643,9 @@
   APACHE_VERSION=`expr $4 \* 1000000 + $5 \* 1000 + $6`
 
   if test "$APACHE_VERSION" -le 2000000; then
-    as_fn_error "You have enabled Apache 2 support while your server is Apache 1.3.  Please use the appropiate switch --with-apxs (without the 2)" "$LINENO" 5
+    as_fn_error $? "You have enabled Apache 2 support while your server is Apache 1.3.  Please use the appropiate switch --with-apxs (without the 2)" "$LINENO" 5
   elif test "$APACHE_VERSION" -lt 2000040; then
-    as_fn_error "Please note that Apache version >= 2.0.40 is required" "$LINENO" 5
+    as_fn_error $? "Please note that Apache version >= 2.0.40 is required" "$LINENO" 5
   fi
 
   APXS_LIBEXECDIR='$(INSTALL_ROOT)'`$APXS -q LIBEXECDIR`
@@ -7616,7 +7669,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache2filter"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -7788,7 +7841,7 @@
   if test "bundle" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache2filter"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -7954,7 +8007,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache2filter"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -8116,7 +8169,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache2filter"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -8281,7 +8334,7 @@
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
     fi
@@ -8291,7 +8344,7 @@
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
     fi
@@ -8375,7 +8428,7 @@
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: The output of $APXS follows:" >&5
 $as_echo "The output of $APXS follows:" >&6; }
     $APXS -q CFLAGS
-    as_fn_error "Aborting" "$LINENO" 5
+    as_fn_error $? "Aborting" "$LINENO" 5
   fi
 
   APXS_INCLUDEDIR=`$APXS -q INCLUDEDIR`
@@ -8414,9 +8467,9 @@
   APACHE_VERSION=`expr $4 \* 1000000 + $5 \* 1000 + $6`
 
   if test "$APACHE_VERSION" -le 2000000; then
-    as_fn_error "You have enabled Apache 2 support while your server is Apache 1.3.  Please use the appropiate switch --with-apxs (without the 2)" "$LINENO" 5
+    as_fn_error $? "You have enabled Apache 2 support while your server is Apache 1.3.  Please use the appropiate switch --with-apxs (without the 2)" "$LINENO" 5
   elif test "$APACHE_VERSION" -lt 2000044; then
-    as_fn_error "Please note that Apache version >= 2.0.44 is required" "$LINENO" 5
+    as_fn_error $? "Please note that Apache version >= 2.0.44 is required" "$LINENO" 5
   fi
 
   APXS_LIBEXECDIR='$(INSTALL_ROOT)'`$APXS -q LIBEXECDIR`
@@ -8440,7 +8493,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache2handler"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -8612,7 +8665,7 @@
   if test "bundle" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache2handler"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -8778,7 +8831,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache2handler"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -8940,7 +8993,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache2handler"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -9105,7 +9158,7 @@
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
     fi
@@ -9115,7 +9168,7 @@
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
     fi
@@ -9198,7 +9251,7 @@
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: The output of $APXS follows" >&5
 $as_echo "The output of $APXS follows" >&6; }
     $APXS -q CFLAGS
-    as_fn_error "Aborting" "$LINENO" 5
+    as_fn_error $? "Aborting" "$LINENO" 5
   fi
 
   APXS_LDFLAGS="@SYBASE_LFLAGS@ @SYBASE_LIBS@ @SYBASE_CT_LFLAGS@ @SYBASE_CT_LIBS@"
@@ -9219,7 +9272,7 @@
   APACHE_VERSION=`expr $4 \* 1000000 + $5 \* 1000 + $6`
 
   if test "$APACHE_VERSION" -ge 2000000; then
-    as_fn_error "You have enabled Apache 1.3 support while your server is Apache 2.  Please use the appropiate switch --with-apxs2" "$LINENO" 5
+    as_fn_error $? "You have enabled Apache 1.3 support while your server is Apache 2.  Please use the appropiate switch --with-apxs2" "$LINENO" 5
   fi
 
   for flag in $APXS_CFLAGS; do
@@ -9252,7 +9305,7 @@
   if test "$build_type" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache_hooks"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -9506,7 +9559,7 @@
   if test "static" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache_hooks"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -9673,7 +9726,7 @@
     fi
   # For Apache 2.0.x
   elif test -f $PHP_APACHE_HOOKS_STATIC/include/httpd.h && test -f $PHP_APACHE_HOOKS_STATIC/srclib/apr/include/apr_general.h ; then
-    as_fn_error "Use --with-apxs2 with Apache 2.x!" "$LINENO" 5
+    as_fn_error $? "Use --with-apxs2 with Apache 2.x!" "$LINENO" 5
   # For Apache 1.3.x
   elif test -f $PHP_APACHE_HOOKS_STATIC/src/main/httpd.h; then
     APACHE_HAS_REGEX=1
@@ -9686,7 +9739,7 @@
   if test "static" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache_hooks"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -9856,7 +9909,7 @@
 $as_echo "#define HAVE_AP_COMPAT_H 1" >>confdefs.h
 
       if test ! -f $PHP_APACHE_HOOKS_STATIC/src/include/ap_config_auto.h; then
-        as_fn_error "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
+        as_fn_error $? "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
       fi
     elif test -f $PHP_APACHE_HOOKS_STATIC/src/include/compat.h; then
 
@@ -9875,7 +9928,7 @@
   if test "static" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache_hooks"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -10045,7 +10098,7 @@
 $as_echo "#define HAVE_AP_COMPAT_H 1" >>confdefs.h
 
       if test ! -f $PHP_APACHE_HOOKS_STATIC/src/include/ap_config_auto.h; then
-        as_fn_error "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
+        as_fn_error $? "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
       fi
     elif test -f $PHP_APACHE_HOOKS_STATIC/src/include/compat.h; then
 
@@ -10060,7 +10113,7 @@
   if test "static" = "program"; then
     PHP_BINARIES="$PHP_BINARIES apache_hooks"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -10230,7 +10283,7 @@
 $as_echo "#define HAVE_AP_COMPAT_H 1" >>confdefs.h
 
       if test ! -f $PHP_APACHE_HOOKS_STATIC/src/include/ap_config_auto.h; then
-        as_fn_error "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
+        as_fn_error $? "Please run Apache\'s configure or src/Configure program once and try again" "$LINENO" 5
       fi
     elif test -f $PHP_APACHE_HOOKS_STATIC/src/compat.h; then
 
@@ -10240,7 +10293,7 @@
   else
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-    as_fn_error "Invalid Apache directory - unable to find httpd.h under $PHP_APACHE_HOOKS_STATIC" "$LINENO" 5
+    as_fn_error $? "Invalid Apache directory - unable to find httpd.h under $PHP_APACHE_HOOKS_STATIC" "$LINENO" 5
   fi
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
@@ -10288,7 +10341,7 @@
   gcc_arg_name=ac_cv_gcc_arg_rdynamic
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC supports -rdynamic" >&5
 $as_echo_n "checking whether $CC supports -rdynamic... " >&6; }
-if test "${ac_cv_gcc_arg_rdynamic+set}" = set; then :
+if ${ac_cv_gcc_arg_rdynamic+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -10331,7 +10384,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for member fd in BUFF *" >&5
 $as_echo_n "checking for member fd in BUFF *... " >&6; }
-if test "${ac_cv_php_fd_in_buff+set}" = set; then :
+if ${ac_cv_php_fd_in_buff+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -10437,13 +10490,13 @@
   elif test -f $PHP_CAUDIUM/bin/pike; then
     PIKE=$PHP_CAUDIUM/bin/pike
   else
-    as_fn_error "Could not find a pike in $PHP_CAUDIUM/bin/" "$LINENO" 5
+    as_fn_error $? "Could not find a pike in $PHP_CAUDIUM/bin/" "$LINENO" 5
   fi
   if $PIKE -e 'float v; int rel;sscanf(version(), "Pike v%f release %d", v, rel);v += rel/10000.0; if(v < 7.0268) exit(1); exit(0);'; then
     PIKE_MODULE_DIR=`$PIKE --show-paths 2>&1| grep '^Module' | sed -e 's/.*: //'`
     PIKE_INCLUDE_DIR=`echo $PIKE_MODULE_DIR | sed -e 's,lib/pike/modules,include/pike,' -e 's,lib/modules,include/pike,' `
     if test -z "$PIKE_INCLUDE_DIR" || test -z "$PIKE_MODULE_DIR"; then
-      as_fn_error "Failed to figure out Pike module and include directories" "$LINENO" 5
+      as_fn_error $? "Failed to figure out Pike module and include directories" "$LINENO" 5
     fi
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
@@ -10558,7 +10611,7 @@
 $as_echo "not found" >&6; }
     fi
   else
-    as_fn_error "Caudium PHP5 requires Pike 7.0 or newer" "$LINENO" 5
+    as_fn_error $? "Caudium PHP5 requires Pike 7.0 or newer" "$LINENO" 5
   fi
   PIKE_VERSION=`$PIKE -e 'string v; int rel;sscanf(version(), "Pike v%s release %d", v, rel); write(v+"."+rel);'`
 
@@ -10568,7 +10621,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES caudium"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -10730,7 +10783,7 @@
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
 fi
@@ -10776,7 +10829,7 @@
   if test "program" = "program"; then
     PHP_BINARIES="$PHP_BINARIES cli"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -10952,7 +11005,7 @@
 
 if test "$PHP_CONTINUITY" != "no"; then
   if test ! -d $PHP_CONTINUITY; then
-    as_fn_error "Please specify the path to the root of your Continuity server using --with-continuity=DIR" "$LINENO" 5
+    as_fn_error $? "Please specify the path to the root of your Continuity server using --with-continuity=DIR" "$LINENO" 5
   fi
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for Continuity include files" >&5
 $as_echo_n "checking for Continuity include files... " >&6; }
@@ -10961,14 +11014,14 @@
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: Continuity Binary Distribution" >&5
 $as_echo "Continuity Binary Distribution" >&6; }
   else
-    as_fn_error "Cannot find your CAPI include files in either DIR/src or DIR/include" "$LINENO" 5
+    as_fn_error $? "Cannot find your CAPI include files in either DIR/src or DIR/include" "$LINENO" 5
   fi
 
 
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES continuity"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -11157,7 +11210,7 @@
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
 
@@ -11211,7 +11264,7 @@
   if test "$PHP_EMBED_TYPE" = "program"; then
     PHP_BINARIES="$PHP_BINARIES embed"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -11455,8 +11508,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -11467,7 +11519,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing socket" >&5
 $as_echo_n "checking for library containing socket... " >&6; }
-if test "${ac_cv_search_socket+set}" = set; then :
+if ${ac_cv_search_socket+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_func_search_save_LIBS=$LIBS
@@ -11501,11 +11553,11 @@
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext
-  if test "${ac_cv_search_socket+set}" = set; then :
+  if ${ac_cv_search_socket+:} false; then :
   break
 fi
 done
-if test "${ac_cv_search_socket+set}" = set; then :
+if ${ac_cv_search_socket+:} false; then :
 
 else
   ac_cv_search_socket=no
@@ -11523,7 +11575,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing inet_addr" >&5
 $as_echo_n "checking for library containing inet_addr... " >&6; }
-if test "${ac_cv_search_inet_addr+set}" = set; then :
+if ${ac_cv_search_inet_addr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_func_search_save_LIBS=$LIBS
@@ -11557,11 +11609,11 @@
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext
-  if test "${ac_cv_search_inet_addr+set}" = set; then :
+  if ${ac_cv_search_inet_addr+:} false; then :
   break
 fi
 done
-if test "${ac_cv_search_inet_addr+set}" = set; then :
+if ${ac_cv_search_inet_addr+:} false; then :
 
 else
   ac_cv_search_inet_addr=no
@@ -11582,8 +11634,7 @@
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -11596,8 +11647,7 @@
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -11610,8 +11660,7 @@
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -11623,7 +11672,7 @@
   for ac_header in sysexits.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "sysexits.h" "ac_cv_header_sysexits_h" "$ac_includes_default"
-if test "x$ac_cv_header_sysexits_h" = x""yes; then :
+if test "x$ac_cv_header_sysexits_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_SYSEXITS_H 1
 _ACEOF
@@ -11746,8 +11795,8 @@
     if test "$cross_compiling" = yes; then :
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "cannot run test program while cross compiling
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -12579,7 +12628,7 @@
   if test "$PHP_FPM_SYSTEMD" != "no" ; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sd_notify in -lsystemd-daemon" >&5
 $as_echo_n "checking for sd_notify in -lsystemd-daemon... " >&6; }
-if test "${ac_cv_lib_systemd_daemon_sd_notify+set}" = set; then :
+if ${ac_cv_lib_systemd_daemon_sd_notify+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -12613,14 +12662,14 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_systemd_daemon_sd_notify" >&5
 $as_echo "$ac_cv_lib_systemd_daemon_sd_notify" >&6; }
-if test "x$ac_cv_lib_systemd_daemon_sd_notify" = x""yes; then :
+if test "x$ac_cv_lib_systemd_daemon_sd_notify" = xyes; then :
   SYSTEMD_LIBS="-lsystemd-daemon"
 fi
 
     for ac_header in systemd/sd-daemon.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "systemd/sd-daemon.h" "ac_cv_header_systemd_sd_daemon_h" "$ac_includes_default"
-if test "x$ac_cv_header_systemd_sd_daemon_h" = x""yes; then :
+if test "x$ac_cv_header_systemd_sd_daemon_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_SYSTEMD_SD_DAEMON_H 1
 _ACEOF
@@ -12632,7 +12681,7 @@
 done
 
     if test $HAVE_SD_DAEMON_H = "no" || test -z "${SYSTEMD_LIBS}"; then
-      as_fn_error "Your system does not support systemd." "$LINENO" 5
+      as_fn_error $? "Your system does not support systemd." "$LINENO" 5
     else
 
 $as_echo "#define HAVE_SYSTEMD 1" >>confdefs.h
@@ -12797,7 +12846,7 @@
   if test "program" = "program"; then
     PHP_BINARIES="$PHP_BINARIES fpm"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -12944,11 +12993,11 @@
   else
     ZEUSPATH=$PHP_ISAPI
   fi
-  test -f "$ZEUSPATH/web/include/httpext.h" || as_fn_error "Unable to find httpext.h in $ZEUSPATH/web/include" "$LINENO" 5
+  test -f "$ZEUSPATH/web/include/httpext.h" || as_fn_error $? "Unable to find httpext.h in $ZEUSPATH/web/include" "$LINENO" 5
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
 
@@ -12989,7 +13038,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES isapi"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -13207,7 +13256,7 @@
   if test "program" = "program"; then
     PHP_BINARIES="$PHP_BINARIES litespeed"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -13355,7 +13404,7 @@
       if test -f /usr/lib/libmilter/libmilter.a ; then
         MILTERPATH=/usr/lib/libmilter
       else
-        as_fn_error "Unable to find libmilter.a" "$LINENO" 5
+        as_fn_error $? "Unable to find libmilter.a" "$LINENO" 5
       fi
     fi
   else
@@ -13366,7 +13415,7 @@
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
 
@@ -13379,7 +13428,7 @@
   if test "program" = "program"; then
     PHP_BINARIES="$PHP_BINARIES milter"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -13555,7 +13604,7 @@
 
 if test "$PHP_NSAPI" != "no"; then
   if test ! -d $PHP_NSAPI/bin ; then
-    as_fn_error "Please specify the path to the root of your Netscape/iPlanet/Sun Webserver using --with-nsapi=DIR" "$LINENO" 5
+    as_fn_error $? "Please specify the path to the root of your Netscape/iPlanet/Sun Webserver using --with-nsapi=DIR" "$LINENO" 5
   fi
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for NSAPI include files" >&5
 $as_echo_n "checking for NSAPI include files... " >&6; }
@@ -13567,8 +13616,7 @@
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -13587,8 +13635,7 @@
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -13600,7 +13647,7 @@
     NSAPI_INCLUDE="$NSAPI_INCLUDE -I$NSAPI_INC_DIR"
   fi
   if test -z "$NSAPI_INCLUDE"; then
-    as_fn_error "Please check you have nsapi.h in either $PHP_NSAPI/include or $PHP_NSAPI/plugins/include" "$LINENO" 5
+    as_fn_error $? "Please check you have nsapi.h in either $PHP_NSAPI/include or $PHP_NSAPI/plugins/include" "$LINENO" 5
   fi
 
 
@@ -13646,7 +13693,7 @@
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
 
@@ -13656,7 +13703,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES nsapi"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -13843,12 +13890,12 @@
 
 if test "$PHP_PHTTPD" != "no"; then
   if test ! -d $PHP_PHTTPD ; then
-    as_fn_error "You did not specify a directory" "$LINENO" 5
+    as_fn_error $? "You did not specify a directory" "$LINENO" 5
   fi
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
 
@@ -13889,7 +13936,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES phttpd"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -14079,11 +14126,11 @@
   else
     PI3PATH=$PHP_PI3WEB
   fi
-  test -f "$PI3PATH/PiAPI/PiAPI.h" || as_fn_error "Unable to find PiAPI.h in $PI3PATH/PiAPI" "$LINENO" 5
+  test -f "$PI3PATH/PiAPI/PiAPI.h" || as_fn_error $? "Unable to find PiAPI.h in $PI3PATH/PiAPI" "$LINENO" 5
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
 
@@ -14217,7 +14264,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES pi3web"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -14427,24 +14474,24 @@
 $as_echo_n "checking for Roxen/Pike support... " >&6; }
 if test "$PHP_ROXEN" != "no"; then
   if test ! -d $PHP_ROXEN ; then
-    as_fn_error "You did not specify a directory" "$LINENO" 5
+    as_fn_error $? "You did not specify a directory" "$LINENO" 5
   fi
   if test -f $PHP_ROXEN/bin/roxen; then
     PIKE=$PHP_ROXEN/bin/roxen
   elif test -f $PHP_ROXEN/bin/pike; then
     PIKE=$PHP_ROXEN/bin/pike
   else
-    as_fn_error "Could not find a pike in $PHP_ROXEN/bin/" "$LINENO" 5
+    as_fn_error $? "Could not find a pike in $PHP_ROXEN/bin/" "$LINENO" 5
   fi
 
   if $PIKE -e 'float v; catch(v = __VERSION__ + (__BUILD__/10000.0)); if(v < 0.7079) exit(1); exit(0);'; then
     PIKE_MODULE_DIR=`$PIKE --show-paths 2>&1| grep '^Module' | sed -e 's/.*: //'`
     PIKE_INCLUDE_DIR=`echo $PIKE_MODULE_DIR | sed -e 's,lib/pike/modules,include/pike,' -e 's,lib/modules,include/pike,'`
     if test -z "$PIKE_INCLUDE_DIR" || test -z "$PIKE_MODULE_DIR"; then
-      as_fn_error "Failed to figure out Pike module and include directories" "$LINENO" 5
+      as_fn_error $? "Failed to figure out Pike module and include directories" "$LINENO" 5
     fi
   else
-    as_fn_error "Roxen/PHP requires Pike 0.7.79 or newer" "$LINENO" 5
+    as_fn_error $? "Roxen/PHP requires Pike 0.7.79 or newer" "$LINENO" 5
   fi
 
 
@@ -14485,7 +14532,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES roxen"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -14651,7 +14698,7 @@
 
   enable_maintainer_zts=yes
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
+    as_fn_error $? "ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." "$LINENO" 5
   fi
 
 
@@ -14714,7 +14761,7 @@
   elif grep Premium $PHP_THTTPD/version.h >/dev/null; then
     patch=
   else
-    as_fn_error "This version only supports thttpd-2.21b and Premium thttpd" "$LINENO" 5
+    as_fn_error $? "This version only supports thttpd-2.21b and Premium thttpd" "$LINENO" 5
   fi
 
   if test -n "$GCC"; then
@@ -14722,7 +14769,7 @@
   gcc_arg_name=ac_cv_gcc_arg_rdynamic
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC supports -rdynamic" >&5
 $as_echo_n "checking whether $CC supports -rdynamic... " >&6; }
-if test "${ac_cv_gcc_arg_rdynamic+set}" = set; then :
+if ${ac_cv_gcc_arg_rdynamic+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -14795,7 +14842,7 @@
   if test "static" = "program"; then
     PHP_BINARIES="$PHP_BINARIES thttpd"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -14942,13 +14989,13 @@
   for ac_header in tuxmodule.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "tuxmodule.h" "ac_cv_header_tuxmodule_h" "$ac_includes_default"
-if test "x$ac_cv_header_tuxmodule_h" = x""yes; then :
+if test "x$ac_cv_header_tuxmodule_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_TUXMODULE_H 1
 _ACEOF
  :
 else
-  as_fn_error "Cannot find tuxmodule.h" "$LINENO" 5
+  as_fn_error $? "Cannot find tuxmodule.h" "$LINENO" 5
 fi
 
 done
@@ -14957,7 +15004,7 @@
   if test "shared" = "program"; then
     PHP_BINARIES="$PHP_BINARIES tux"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -15196,7 +15243,7 @@
   if test "static" = "program"; then
     PHP_BINARIES="$PHP_BINARIES webjames"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -15463,7 +15510,7 @@
   if test "program" = "program"; then
     PHP_BINARIES="$PHP_BINARIES cgi"
   elif test "$PHP_SAPI" != "none"; then
-    as_fn_error "
+    as_fn_error $? "
 +--------------------------------------------------------------------+
 |                        *** ATTENTION ***                           |
 |                                                                    |
@@ -15604,7 +15651,7 @@
 fi
 
 if test -z "$PHP_INSTALLED_SAPIS"; then
-  as_fn_error "Nothing to build." "$LINENO" 5
+  as_fn_error $? "Nothing to build." "$LINENO" 5
 fi
 
 if test "$enable_maintainer_zts" = "yes"; then
@@ -15622,7 +15669,7 @@
     host_alias=$host
   fi
   if test -z "$host_alias"; then
-    as_fn_error "host_alias is not set. Make sure to run config.guess" "$LINENO" 5
+    as_fn_error $? "host_alias is not set. Make sure to run config.guess" "$LINENO" 5
   fi
   case $host_alias in
   *solaris*)
@@ -15661,7 +15708,7 @@
 set dummy sendmail; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_PROG_SENDMAIL+set}" = set; then :
+if ${ac_cv_path_PROG_SENDMAIL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $PROG_SENDMAIL in
@@ -15706,7 +15753,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether system uses EBCDIC" >&5
 $as_echo_n "checking whether system uses EBCDIC... " >&6; }
-if test "${ac_cv_ebcdic+set}" = set; then :
+if ${ac_cv_ebcdic+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -15748,7 +15795,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether byte ordering is bigendian" >&5
 $as_echo_n "checking whether byte ordering is bigendian... " >&6; }
-if test "${ac_cv_c_bigendian_php+set}" = set; then :
+if ${ac_cv_c_bigendian_php+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -15795,7 +15842,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether writing to stdout works" >&5
 $as_echo_n "checking whether writing to stdout works... " >&6; }
-if test "${ac_cv_write_stdout+set}" = set; then :
+if ${ac_cv_write_stdout+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -15893,11 +15940,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "socket" "ac_cv_func_socket"
-if test "x$ac_cv_func_socket" = x""yes; then :
+if test "x$ac_cv_func_socket" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__socket" "ac_cv_func___socket"
-if test "x$ac_cv_func___socket" = x""yes; then :
+if test "x$ac_cv_func___socket" = xyes; then :
   found=yes
 else
   found=no
@@ -15921,7 +15968,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for socket in -lsocket" >&5
 $as_echo_n "checking for socket in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket_socket+set}" = set; then :
+if ${ac_cv_lib_socket_socket+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -15955,13 +16002,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_socket" >&5
 $as_echo "$ac_cv_lib_socket_socket" >&6; }
-if test "x$ac_cv_lib_socket_socket" = x""yes; then :
+if test "x$ac_cv_lib_socket_socket" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __socket in -lsocket" >&5
 $as_echo_n "checking for __socket in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket___socket+set}" = set; then :
+if ${ac_cv_lib_socket___socket+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -15995,7 +16042,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket___socket" >&5
 $as_echo "$ac_cv_lib_socket___socket" >&6; }
-if test "x$ac_cv_lib_socket___socket" = x""yes; then :
+if test "x$ac_cv_lib_socket___socket" = xyes; then :
   found=yes
 else
   found=no
@@ -16061,11 +16108,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "socketpair" "ac_cv_func_socketpair"
-if test "x$ac_cv_func_socketpair" = x""yes; then :
+if test "x$ac_cv_func_socketpair" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__socketpair" "ac_cv_func___socketpair"
-if test "x$ac_cv_func___socketpair" = x""yes; then :
+if test "x$ac_cv_func___socketpair" = xyes; then :
   found=yes
 else
   found=no
@@ -16089,7 +16136,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for socketpair in -lsocket" >&5
 $as_echo_n "checking for socketpair in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket_socketpair+set}" = set; then :
+if ${ac_cv_lib_socket_socketpair+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16123,13 +16170,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_socketpair" >&5
 $as_echo "$ac_cv_lib_socket_socketpair" >&6; }
-if test "x$ac_cv_lib_socket_socketpair" = x""yes; then :
+if test "x$ac_cv_lib_socket_socketpair" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __socketpair in -lsocket" >&5
 $as_echo_n "checking for __socketpair in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket___socketpair+set}" = set; then :
+if ${ac_cv_lib_socket___socketpair+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16163,7 +16210,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket___socketpair" >&5
 $as_echo "$ac_cv_lib_socket___socketpair" >&6; }
-if test "x$ac_cv_lib_socket___socketpair" = x""yes; then :
+if test "x$ac_cv_lib_socket___socketpair" = xyes; then :
   found=yes
 else
   found=no
@@ -16229,11 +16276,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "htonl" "ac_cv_func_htonl"
-if test "x$ac_cv_func_htonl" = x""yes; then :
+if test "x$ac_cv_func_htonl" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__htonl" "ac_cv_func___htonl"
-if test "x$ac_cv_func___htonl" = x""yes; then :
+if test "x$ac_cv_func___htonl" = xyes; then :
   found=yes
 else
   found=no
@@ -16257,7 +16304,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for htonl in -lsocket" >&5
 $as_echo_n "checking for htonl in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket_htonl+set}" = set; then :
+if ${ac_cv_lib_socket_htonl+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16291,13 +16338,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_htonl" >&5
 $as_echo "$ac_cv_lib_socket_htonl" >&6; }
-if test "x$ac_cv_lib_socket_htonl" = x""yes; then :
+if test "x$ac_cv_lib_socket_htonl" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __htonl in -lsocket" >&5
 $as_echo_n "checking for __htonl in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket___htonl+set}" = set; then :
+if ${ac_cv_lib_socket___htonl+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16331,7 +16378,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket___htonl" >&5
 $as_echo "$ac_cv_lib_socket___htonl" >&6; }
-if test "x$ac_cv_lib_socket___htonl" = x""yes; then :
+if test "x$ac_cv_lib_socket___htonl" = xyes; then :
   found=yes
 else
   found=no
@@ -16397,11 +16444,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "gethostname" "ac_cv_func_gethostname"
-if test "x$ac_cv_func_gethostname" = x""yes; then :
+if test "x$ac_cv_func_gethostname" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__gethostname" "ac_cv_func___gethostname"
-if test "x$ac_cv_func___gethostname" = x""yes; then :
+if test "x$ac_cv_func___gethostname" = xyes; then :
   found=yes
 else
   found=no
@@ -16425,7 +16472,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gethostname in -lnsl" >&5
 $as_echo_n "checking for gethostname in -lnsl... " >&6; }
-if test "${ac_cv_lib_nsl_gethostname+set}" = set; then :
+if ${ac_cv_lib_nsl_gethostname+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16459,13 +16506,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_nsl_gethostname" >&5
 $as_echo "$ac_cv_lib_nsl_gethostname" >&6; }
-if test "x$ac_cv_lib_nsl_gethostname" = x""yes; then :
+if test "x$ac_cv_lib_nsl_gethostname" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __gethostname in -lnsl" >&5
 $as_echo_n "checking for __gethostname in -lnsl... " >&6; }
-if test "${ac_cv_lib_nsl___gethostname+set}" = set; then :
+if ${ac_cv_lib_nsl___gethostname+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16499,7 +16546,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_nsl___gethostname" >&5
 $as_echo "$ac_cv_lib_nsl___gethostname" >&6; }
-if test "x$ac_cv_lib_nsl___gethostname" = x""yes; then :
+if test "x$ac_cv_lib_nsl___gethostname" = xyes; then :
   found=yes
 else
   found=no
@@ -16565,11 +16612,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "gethostbyaddr" "ac_cv_func_gethostbyaddr"
-if test "x$ac_cv_func_gethostbyaddr" = x""yes; then :
+if test "x$ac_cv_func_gethostbyaddr" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__gethostbyaddr" "ac_cv_func___gethostbyaddr"
-if test "x$ac_cv_func___gethostbyaddr" = x""yes; then :
+if test "x$ac_cv_func___gethostbyaddr" = xyes; then :
   found=yes
 else
   found=no
@@ -16593,7 +16640,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gethostbyaddr in -lnsl" >&5
 $as_echo_n "checking for gethostbyaddr in -lnsl... " >&6; }
-if test "${ac_cv_lib_nsl_gethostbyaddr+set}" = set; then :
+if ${ac_cv_lib_nsl_gethostbyaddr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16627,13 +16674,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_nsl_gethostbyaddr" >&5
 $as_echo "$ac_cv_lib_nsl_gethostbyaddr" >&6; }
-if test "x$ac_cv_lib_nsl_gethostbyaddr" = x""yes; then :
+if test "x$ac_cv_lib_nsl_gethostbyaddr" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __gethostbyaddr in -lnsl" >&5
 $as_echo_n "checking for __gethostbyaddr in -lnsl... " >&6; }
-if test "${ac_cv_lib_nsl___gethostbyaddr+set}" = set; then :
+if ${ac_cv_lib_nsl___gethostbyaddr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16667,7 +16714,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_nsl___gethostbyaddr" >&5
 $as_echo "$ac_cv_lib_nsl___gethostbyaddr" >&6; }
-if test "x$ac_cv_lib_nsl___gethostbyaddr" = x""yes; then :
+if test "x$ac_cv_lib_nsl___gethostbyaddr" = xyes; then :
   found=yes
 else
   found=no
@@ -16733,11 +16780,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "yp_get_default_domain" "ac_cv_func_yp_get_default_domain"
-if test "x$ac_cv_func_yp_get_default_domain" = x""yes; then :
+if test "x$ac_cv_func_yp_get_default_domain" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__yp_get_default_domain" "ac_cv_func___yp_get_default_domain"
-if test "x$ac_cv_func___yp_get_default_domain" = x""yes; then :
+if test "x$ac_cv_func___yp_get_default_domain" = xyes; then :
   found=yes
 else
   found=no
@@ -16761,7 +16808,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for yp_get_default_domain in -lnsl" >&5
 $as_echo_n "checking for yp_get_default_domain in -lnsl... " >&6; }
-if test "${ac_cv_lib_nsl_yp_get_default_domain+set}" = set; then :
+if ${ac_cv_lib_nsl_yp_get_default_domain+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16795,13 +16842,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_nsl_yp_get_default_domain" >&5
 $as_echo "$ac_cv_lib_nsl_yp_get_default_domain" >&6; }
-if test "x$ac_cv_lib_nsl_yp_get_default_domain" = x""yes; then :
+if test "x$ac_cv_lib_nsl_yp_get_default_domain" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __yp_get_default_domain in -lnsl" >&5
 $as_echo_n "checking for __yp_get_default_domain in -lnsl... " >&6; }
-if test "${ac_cv_lib_nsl___yp_get_default_domain+set}" = set; then :
+if ${ac_cv_lib_nsl___yp_get_default_domain+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16835,7 +16882,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_nsl___yp_get_default_domain" >&5
 $as_echo "$ac_cv_lib_nsl___yp_get_default_domain" >&6; }
-if test "x$ac_cv_lib_nsl___yp_get_default_domain" = x""yes; then :
+if test "x$ac_cv_lib_nsl___yp_get_default_domain" = xyes; then :
   found=yes
 else
   found=no
@@ -16902,11 +16949,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "dlopen" "ac_cv_func_dlopen"
-if test "x$ac_cv_func_dlopen" = x""yes; then :
+if test "x$ac_cv_func_dlopen" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__dlopen" "ac_cv_func___dlopen"
-if test "x$ac_cv_func___dlopen" = x""yes; then :
+if test "x$ac_cv_func___dlopen" = xyes; then :
   found=yes
 else
   found=no
@@ -16930,7 +16977,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
 $as_echo_n "checking for dlopen in -ldl... " >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then :
+if ${ac_cv_lib_dl_dlopen+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -16964,13 +17011,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
 $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
-if test "x$ac_cv_lib_dl_dlopen" = x""yes; then :
+if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __dlopen in -ldl" >&5
 $as_echo_n "checking for __dlopen in -ldl... " >&6; }
-if test "${ac_cv_lib_dl___dlopen+set}" = set; then :
+if ${ac_cv_lib_dl___dlopen+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -17004,7 +17051,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl___dlopen" >&5
 $as_echo "$ac_cv_lib_dl___dlopen" >&6; }
-if test "x$ac_cv_lib_dl___dlopen" = x""yes; then :
+if test "x$ac_cv_lib_dl___dlopen" = xyes; then :
   found=yes
 else
   found=no
@@ -17071,7 +17118,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sin in -lm" >&5
 $as_echo_n "checking for sin in -lm... " >&6; }
-if test "${ac_cv_lib_m_sin+set}" = set; then :
+if ${ac_cv_lib_m_sin+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -17105,7 +17152,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_m_sin" >&5
 $as_echo "$ac_cv_lib_m_sin" >&6; }
-if test "x$ac_cv_lib_m_sin" = x""yes; then :
+if test "x$ac_cv_lib_m_sin" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_LIBM 1
 _ACEOF
@@ -17121,11 +17168,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "inet_aton" "ac_cv_func_inet_aton"
-if test "x$ac_cv_func_inet_aton" = x""yes; then :
+if test "x$ac_cv_func_inet_aton" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__inet_aton" "ac_cv_func___inet_aton"
-if test "x$ac_cv_func___inet_aton" = x""yes; then :
+if test "x$ac_cv_func___inet_aton" = xyes; then :
   found=yes
 else
   found=no
@@ -17149,7 +17196,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for inet_aton in -lresolv" >&5
 $as_echo_n "checking for inet_aton in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv_inet_aton+set}" = set; then :
+if ${ac_cv_lib_resolv_inet_aton+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -17183,13 +17230,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv_inet_aton" >&5
 $as_echo "$ac_cv_lib_resolv_inet_aton" >&6; }
-if test "x$ac_cv_lib_resolv_inet_aton" = x""yes; then :
+if test "x$ac_cv_lib_resolv_inet_aton" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __inet_aton in -lresolv" >&5
 $as_echo_n "checking for __inet_aton in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv___inet_aton+set}" = set; then :
+if ${ac_cv_lib_resolv___inet_aton+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -17223,7 +17270,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv___inet_aton" >&5
 $as_echo "$ac_cv_lib_resolv___inet_aton" >&6; }
-if test "x$ac_cv_lib_resolv___inet_aton" = x""yes; then :
+if test "x$ac_cv_lib_resolv___inet_aton" = xyes; then :
   found=yes
 else
   found=no
@@ -17281,7 +17328,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for inet_aton in -lbind" >&5
 $as_echo_n "checking for inet_aton in -lbind... " >&6; }
-if test "${ac_cv_lib_bind_inet_aton+set}" = set; then :
+if ${ac_cv_lib_bind_inet_aton+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -17315,13 +17362,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind_inet_aton" >&5
 $as_echo "$ac_cv_lib_bind_inet_aton" >&6; }
-if test "x$ac_cv_lib_bind_inet_aton" = x""yes; then :
+if test "x$ac_cv_lib_bind_inet_aton" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __inet_aton in -lbind" >&5
 $as_echo_n "checking for __inet_aton in -lbind... " >&6; }
-if test "${ac_cv_lib_bind___inet_aton+set}" = set; then :
+if ${ac_cv_lib_bind___inet_aton+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -17355,7 +17402,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind___inet_aton" >&5
 $as_echo "$ac_cv_lib_bind___inet_aton" >&6; }
-if test "x$ac_cv_lib_bind___inet_aton" = x""yes; then :
+if test "x$ac_cv_lib_bind___inet_aton" = xyes; then :
   found=yes
 else
   found=no
@@ -17422,7 +17469,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
 $as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then :
+if ${ac_cv_header_stdc+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -17537,7 +17584,7 @@
   as_ac_Header=`$as_echo "ac_cv_header_dirent_$ac_hdr" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_hdr that defines DIR" >&5
 $as_echo_n "checking for $ac_hdr that defines DIR... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Header+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -17564,8 +17611,7 @@
 eval ac_res=\$$as_ac_Header
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_hdr" | $as_tr_cpp` 1
 _ACEOF
@@ -17578,7 +17624,7 @@
 if test $ac_header_dirent = dirent.h; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing opendir" >&5
 $as_echo_n "checking for library containing opendir... " >&6; }
-if test "${ac_cv_search_opendir+set}" = set; then :
+if ${ac_cv_search_opendir+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_func_search_save_LIBS=$LIBS
@@ -17612,11 +17658,11 @@
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext
-  if test "${ac_cv_search_opendir+set}" = set; then :
+  if ${ac_cv_search_opendir+:} false; then :
   break
 fi
 done
-if test "${ac_cv_search_opendir+set}" = set; then :
+if ${ac_cv_search_opendir+:} false; then :
 
 else
   ac_cv_search_opendir=no
@@ -17635,7 +17681,7 @@
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing opendir" >&5
 $as_echo_n "checking for library containing opendir... " >&6; }
-if test "${ac_cv_search_opendir+set}" = set; then :
+if ${ac_cv_search_opendir+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_func_search_save_LIBS=$LIBS
@@ -17669,11 +17715,11 @@
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext
-  if test "${ac_cv_search_opendir+set}" = set; then :
+  if ${ac_cv_search_opendir+:} false; then :
   break
 fi
 done
-if test "${ac_cv_search_opendir+set}" = set; then :
+if ${ac_cv_search_opendir+:} false; then :
 
 else
   ac_cv_search_opendir=no
@@ -17768,8 +17814,7 @@
 #endif
 
 "
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -17781,7 +17826,7 @@
 
 
   ac_fn_c_check_func "$LINENO" "fopencookie" "ac_cv_func_fopencookie"
-if test "x$ac_cv_func_fopencookie" = x""yes; then :
+if test "x$ac_cv_func_fopencookie" = xyes; then :
   have_glibc_fopencookie=yes
 fi
 
@@ -17923,7 +17968,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for broken libc stdio" >&5
 $as_echo_n "checking for broken libc stdio... " >&6; }
-  if test "${_cv_have_broken_glibc_fopen_append+set}" = set; then :
+  if ${_cv_have_broken_glibc_fopen_append+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -18008,7 +18053,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether struct tm is in sys/time.h or time.h" >&5
 $as_echo_n "checking whether struct tm is in sys/time.h or time.h... " >&6; }
-if test "${ac_cv_struct_tm+set}" = set; then :
+if ${ac_cv_struct_tm+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -18045,7 +18090,7 @@
 #include <$ac_cv_struct_tm>
 
 "
-if test "x$ac_cv_member_struct_tm_tm_zone" = x""yes; then :
+if test "x$ac_cv_member_struct_tm_tm_zone" = xyes; then :
 
 cat >>confdefs.h <<_ACEOF
 #define HAVE_STRUCT_TM_TM_ZONE 1
@@ -18061,7 +18106,7 @@
 else
   ac_fn_c_check_decl "$LINENO" "tzname" "ac_cv_have_decl_tzname" "#include <time.h>
 "
-if test "x$ac_cv_have_decl_tzname" = x""yes; then :
+if test "x$ac_cv_have_decl_tzname" = xyes; then :
   ac_have_decl=1
 else
   ac_have_decl=0
@@ -18073,7 +18118,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tzname" >&5
 $as_echo_n "checking for tzname... " >&6; }
-if test "${ac_cv_var_tzname+set}" = set; then :
+if ${ac_cv_var_tzname+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -18267,7 +18312,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tm_gmtoff in struct tm" >&5
 $as_echo_n "checking for tm_gmtoff in struct tm... " >&6; }
-if test "${ac_cv_struct_tm_gmtoff+set}" = set; then :
+if ${ac_cv_struct_tm_gmtoff+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -18301,7 +18346,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for struct flock" >&5
 $as_echo_n "checking for struct flock... " >&6; }
-if test "${ac_cv_struct_flock+set}" = set; then :
+if ${ac_cv_struct_flock+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -18341,7 +18386,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for socklen_t" >&5
 $as_echo_n "checking for socklen_t... " >&6; }
-if test "${ac_cv_socklen_t+set}" = set; then :
+if ${ac_cv_socklen_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -18386,7 +18431,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of size_t" >&5
 $as_echo_n "checking size of size_t... " >&6; }
-if test "${ac_cv_sizeof_size_t+set}" = set; then :
+if ${ac_cv_sizeof_size_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (size_t))" "ac_cv_sizeof_size_t"        "$ac_includes_default"; then :
@@ -18395,9 +18440,8 @@
   if test "$ac_cv_type_size_t" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (size_t)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (size_t)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_size_t=0
    fi
@@ -18420,7 +18464,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long long" >&5
 $as_echo_n "checking size of long long... " >&6; }
-if test "${ac_cv_sizeof_long_long+set}" = set; then :
+if ${ac_cv_sizeof_long_long+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long long))" "ac_cv_sizeof_long_long"        "$ac_includes_default"; then :
@@ -18429,9 +18473,8 @@
   if test "$ac_cv_type_long_long" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long long)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long long)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long_long=0
    fi
@@ -18454,7 +18497,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long long int" >&5
 $as_echo_n "checking size of long long int... " >&6; }
-if test "${ac_cv_sizeof_long_long_int+set}" = set; then :
+if ${ac_cv_sizeof_long_long_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long long int))" "ac_cv_sizeof_long_long_int"        "$ac_includes_default"; then :
@@ -18463,9 +18506,8 @@
   if test "$ac_cv_type_long_long_int" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long long int)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long long int)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long_long_int=0
    fi
@@ -18488,7 +18530,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long" >&5
 $as_echo_n "checking size of long... " >&6; }
-if test "${ac_cv_sizeof_long+set}" = set; then :
+if ${ac_cv_sizeof_long+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long))" "ac_cv_sizeof_long"        "$ac_includes_default"; then :
@@ -18497,9 +18539,8 @@
   if test "$ac_cv_type_long" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long=0
    fi
@@ -18522,7 +18563,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of int" >&5
 $as_echo_n "checking size of int... " >&6; }
-if test "${ac_cv_sizeof_int+set}" = set; then :
+if ${ac_cv_sizeof_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (int))" "ac_cv_sizeof_int"        "$ac_includes_default"; then :
@@ -18531,9 +18572,8 @@
   if test "$ac_cv_type_int" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (int)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (int)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_int=0
    fi
@@ -18556,7 +18596,7 @@
 $as_echo_n "checking size of intmax_t... " >&6; }
 
   php_cache_value=php_cv_sizeof_intmax_t
-  if test "${php_cv_sizeof_intmax_t+set}" = set; then :
+  if ${php_cv_sizeof_intmax_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -18635,7 +18675,7 @@
 $as_echo_n "checking size of ssize_t... " >&6; }
 
   php_cache_value=php_cv_sizeof_ssize_t
-  if test "${php_cv_sizeof_ssize_t+set}" = set; then :
+  if ${php_cv_sizeof_ssize_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -18714,7 +18754,7 @@
 $as_echo_n "checking size of ptrdiff_t... " >&6; }
 
   php_cache_value=php_cv_sizeof_ptrdiff_t
-  if test "${php_cv_sizeof_ptrdiff_t+set}" = set; then :
+  if ${php_cv_sizeof_ptrdiff_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -18790,7 +18830,7 @@
 
 
 ac_fn_c_check_member "$LINENO" "struct stat" "st_blksize" "ac_cv_member_struct_stat_st_blksize" "$ac_includes_default"
-if test "x$ac_cv_member_struct_stat_st_blksize" = x""yes; then :
+if test "x$ac_cv_member_struct_stat_st_blksize" = xyes; then :
 
 cat >>confdefs.h <<_ACEOF
 #define HAVE_STRUCT_STAT_ST_BLKSIZE 1
@@ -18804,7 +18844,7 @@
 
 if test "`uname -s 2>/dev/null`" != "QNX"; then
   ac_fn_c_check_member "$LINENO" "struct stat" "st_blocks" "ac_cv_member_struct_stat_st_blocks" "$ac_includes_default"
-if test "x$ac_cv_member_struct_stat_st_blocks" = x""yes; then :
+if test "x$ac_cv_member_struct_stat_st_blocks" = xyes; then :
 
 cat >>confdefs.h <<_ACEOF
 #define HAVE_STRUCT_STAT_ST_BLOCKS 1
@@ -18829,7 +18869,7 @@
   WARNING_LEVEL=0
 fi
 ac_fn_c_check_member "$LINENO" "struct stat" "st_rdev" "ac_cv_member_struct_stat_st_rdev" "$ac_includes_default"
-if test "x$ac_cv_member_struct_stat_st_rdev" = x""yes; then :
+if test "x$ac_cv_member_struct_stat_st_rdev" = xyes; then :
 
 cat >>confdefs.h <<_ACEOF
 #define HAVE_STRUCT_STAT_ST_RDEV 1
@@ -18843,7 +18883,7 @@
 
 
 ac_fn_c_check_type "$LINENO" "size_t" "ac_cv_type_size_t" "$ac_includes_default"
-if test "x$ac_cv_type_size_t" = x""yes; then :
+if test "x$ac_cv_type_size_t" = xyes; then :
 
 else
 
@@ -18855,7 +18895,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for uid_t in sys/types.h" >&5
 $as_echo_n "checking for uid_t in sys/types.h... " >&6; }
-if test "${ac_cv_type_uid_t+set}" = set; then :
+if ${ac_cv_type_uid_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -18887,7 +18927,7 @@
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for struct sockaddr_storage" >&5
 $as_echo_n "checking for struct sockaddr_storage... " >&6; }
-if test "${ac_cv_sockaddr_storage+set}" = set; then :
+if ${ac_cv_sockaddr_storage+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -18919,7 +18959,7 @@
   fi
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for field sa_len in struct sockaddr" >&5
 $as_echo_n "checking for field sa_len in struct sockaddr... " >&6; }
-if test "${ac_cv_sockaddr_sa_len+set}" = set; then :
+if ${ac_cv_sockaddr_sa_len+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -18954,7 +18994,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for IPv6 support" >&5
 $as_echo_n "checking for IPv6 support... " >&6; }
-if test "${ac_cv_ipv6_support+set}" = set; then :
+if ${ac_cv_ipv6_support+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -18985,13 +19025,13 @@
 for ac_func in vprintf
 do :
   ac_fn_c_check_func "$LINENO" "vprintf" "ac_cv_func_vprintf"
-if test "x$ac_cv_func_vprintf" = x""yes; then :
+if test "x$ac_cv_func_vprintf" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_VPRINTF 1
 _ACEOF
 
 ac_fn_c_check_func "$LINENO" "_doprnt" "ac_cv_func__doprnt"
-if test "x$ac_cv_func__doprnt" = x""yes; then :
+if test "x$ac_cv_func__doprnt" = xyes; then :
 
 $as_echo "#define HAVE_DOPRNT 1" >>confdefs.h
 
@@ -19087,8 +19127,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -19104,7 +19143,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for nanosleep in -lrt" >&5
 $as_echo_n "checking for nanosleep in -lrt... " >&6; }
-if test "${ac_cv_lib_rt_nanosleep+set}" = set; then :
+if ${ac_cv_lib_rt_nanosleep+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -19138,13 +19177,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_rt_nanosleep" >&5
 $as_echo "$ac_cv_lib_rt_nanosleep" >&6; }
-if test "x$ac_cv_lib_rt_nanosleep" = x""yes; then :
+if test "x$ac_cv_lib_rt_nanosleep" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __nanosleep in -lrt" >&5
 $as_echo_n "checking for __nanosleep in -lrt... " >&6; }
-if test "${ac_cv_lib_rt___nanosleep+set}" = set; then :
+if ${ac_cv_lib_rt___nanosleep+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -19178,7 +19217,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_rt___nanosleep" >&5
 $as_echo "$ac_cv_lib_rt___nanosleep" >&6; }
-if test "x$ac_cv_lib_rt___nanosleep" = x""yes; then :
+if test "x$ac_cv_lib_rt___nanosleep" = xyes; then :
   found=yes
 else
   found=no
@@ -19238,7 +19277,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for getaddrinfo" >&5
 $as_echo_n "checking for getaddrinfo... " >&6; }
-if test "${ac_cv_func_getaddrinfo+set}" = set; then :
+if ${ac_cv_func_getaddrinfo+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -19321,7 +19360,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __sync_fetch_and_add" >&5
 $as_echo_n "checking for __sync_fetch_and_add... " >&6; }
-if test "${ac_cv_func_sync_fetch_and_add+set}" = set; then :
+if ${ac_cv_func_sync_fetch_and_add+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -19351,25 +19390,44 @@
 
 fi
 
-for ac_func in strlcat strlcpy getopt
-do :
-  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
-_ACEOF
+ac_fn_c_check_func "$LINENO" "strlcat" "ac_cv_func_strlcat"
+if test "x$ac_cv_func_strlcat" = xyes; then :
+  $as_echo "#define HAVE_STRLCAT 1" >>confdefs.h
 
 else
   case " $LIBOBJS " in
-  *" $ac_func.$ac_objext "* ) ;;
-  *) LIBOBJS="$LIBOBJS $ac_func.$ac_objext"
+  *" strlcat.$ac_objext "* ) ;;
+  *) LIBOBJS="$LIBOBJS strlcat.$ac_objext"
+ ;;
+esac
+
+fi
+
+ac_fn_c_check_func "$LINENO" "strlcpy" "ac_cv_func_strlcpy"
+if test "x$ac_cv_func_strlcpy" = xyes; then :
+  $as_echo "#define HAVE_STRLCPY 1" >>confdefs.h
+
+else
+  case " $LIBOBJS " in
+  *" strlcpy.$ac_objext "* ) ;;
+  *) LIBOBJS="$LIBOBJS strlcpy.$ac_objext"
+ ;;
+esac
+
+fi
+
+ac_fn_c_check_func "$LINENO" "getopt" "ac_cv_func_getopt"
+if test "x$ac_cv_func_getopt" = xyes; then :
+  $as_echo "#define HAVE_GETOPT 1" >>confdefs.h
+
+else
+  case " $LIBOBJS " in
+  *" getopt.$ac_objext "* ) ;;
+  *) LIBOBJS="$LIBOBJS getopt.$ac_objext"
  ;;
 esac
 
 fi
-done
 
 
 
@@ -19380,8 +19438,7 @@
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
 "
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -19395,7 +19452,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether utime accepts a null argument" >&5
 $as_echo_n "checking whether utime accepts a null argument... " >&6; }
-if test "${ac_cv_func_utime_null+set}" = set; then :
+if ${ac_cv_func_utime_null+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   rm -f conftest.data; >conftest.data
@@ -19446,7 +19503,7 @@
 # for constant arguments.  Useless!
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working alloca.h" >&5
 $as_echo_n "checking for working alloca.h... " >&6; }
-if test "${ac_cv_working_alloca_h+set}" = set; then :
+if ${ac_cv_working_alloca_h+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -19479,7 +19536,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for alloca" >&5
 $as_echo_n "checking for alloca... " >&6; }
-if test "${ac_cv_func_alloca_works+set}" = set; then :
+if ${ac_cv_func_alloca_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -19498,7 +19555,7 @@
  #pragma alloca
 #   else
 #    ifndef alloca /* predefined by HP cc +Olibcalls */
-char *alloca ();
+void *alloca (size_t);
 #    endif
 #   endif
 #  endif
@@ -19542,7 +19599,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether \`alloca.c' needs Cray hooks" >&5
 $as_echo_n "checking whether \`alloca.c' needs Cray hooks... " >&6; }
-if test "${ac_cv_os_cray+set}" = set; then :
+if ${ac_cv_os_cray+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -19569,8 +19626,7 @@
   for ac_func in _getb67 GETB67 getb67; do
     as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
 
 cat >>confdefs.h <<_ACEOF
 #define CRAY_STACKSEG_END $ac_func
@@ -19584,7 +19640,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking stack direction for C alloca" >&5
 $as_echo_n "checking stack direction for C alloca... " >&6; }
-if test "${ac_cv_c_stack_direction+set}" = set; then :
+if ${ac_cv_c_stack_direction+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "$cross_compiling" = yes; then :
@@ -19635,7 +19691,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for declared timezone" >&5
 $as_echo_n "checking for declared timezone... " >&6; }
-if test "${ac_cv_declared_timezone+set}" = set; then :
+if ${ac_cv_declared_timezone+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -19680,7 +19736,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for type of reentrant time-related functions" >&5
 $as_echo_n "checking for type of reentrant time-related functions... " >&6; }
-if test "${ac_cv_time_r_type+set}" = set; then :
+if ${ac_cv_time_r_type+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -19768,7 +19824,7 @@
 
 
     ac_fn_c_check_func "$LINENO" "readdir_r" "ac_cv_func_readdir_r"
-if test "x$ac_cv_func_readdir_r" = x""yes; then :
+if test "x$ac_cv_func_readdir_r" = xyes; then :
   ac_cv_func_readdir_r=yes
 else
   ac_cv_func_readdir=no
@@ -19777,7 +19833,7 @@
   if test "$ac_cv_func_readdir_r" = "yes"; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for type of readdir_r" >&5
 $as_echo_n "checking for type of readdir_r... " >&6; }
-if test "${ac_cv_what_readdir_r+set}" = set; then :
+if ${ac_cv_what_readdir_r+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -19835,7 +19891,7 @@
           ac_cv_what_readdir_r=none
 
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 fi
 rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
@@ -19861,7 +19917,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for in_addr_t" >&5
 $as_echo_n "checking for in_addr_t... " >&6; }
-if test "${ac_cv_type_in_addr_t+set}" = set; then :
+if ${ac_cv_type_in_addr_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -19896,7 +19952,7 @@
 for ac_func in crypt_r
 do :
   ac_fn_c_check_func "$LINENO" "crypt_r" "ac_cv_func_crypt_r"
-if test "x$ac_cv_func_crypt_r" = x""yes; then :
+if test "x$ac_cv_func_crypt_r" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_CRYPT_R 1
 _ACEOF
@@ -19910,7 +19966,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking which data struct is used by crypt_r" >&5
 $as_echo_n "checking which data struct is used by crypt_r... " >&6; }
-if test "${php_cv_crypt_r_style+set}" = set; then :
+if ${php_cv_crypt_r_style+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -20006,7 +20062,7 @@
 
   fi
   if test "$php_cv_crypt_r_style" = "none"; then
-    as_fn_error "Unable to detect data struct used by crypt_r" "$LINENO" 5
+    as_fn_error $? "Unable to detect data struct used by crypt_r" "$LINENO" 5
   fi
 
 fi
@@ -20052,7 +20108,7 @@
 if test "$PHP_GCOV" = "yes"; then
 
   if test "$GCC" != "yes"; then
-    as_fn_error "GCC is required for --enable-gcov" "$LINENO" 5
+    as_fn_error $? "GCC is required for --enable-gcov" "$LINENO" 5
   fi
 
     case `$php_shtool path $CC` in
@@ -20061,7 +20117,7 @@
   esac
 
   if test "$gcc_ccache" = "yes" && (test -z "$CCACHE_DISABLE" || test "$CCACHE_DISABLE" != "1"); then
-    as_fn_error "ccache must be disabled when --enable-gcov option is used. You can disable ccache by setting environment variable CCACHE_DISABLE=1." "$LINENO" 5
+    as_fn_error $? "ccache must be disabled when --enable-gcov option is used. You can disable ccache by setting environment variable CCACHE_DISABLE=1." "$LINENO" 5
   fi
 
   ltp_version_list="1.5 1.6 1.7 1.9 1.10"
@@ -20070,7 +20126,7 @@
 set dummy lcov; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_LTP+set}" = set; then :
+if ${ac_cv_prog_LTP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$LTP"; then
@@ -20107,7 +20163,7 @@
 set dummy genhtml; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_LTP_GENHTML+set}" = set; then :
+if ${ac_cv_prog_LTP_GENHTML+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$LTP_GENHTML"; then
@@ -20150,7 +20206,7 @@
   if test "$LTP"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ltp version" >&5
 $as_echo_n "checking for ltp version... " >&6; }
-if test "${php_cv_ltp_version+set}" = set; then :
+if ${php_cv_ltp_version+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -20167,19 +20223,19 @@
 $as_echo "$php_cv_ltp_version" >&6; }
   else
     ltp_msg="To enable code coverage reporting you must have one of the following LTP versions installed: $ltp_version_list"
-    as_fn_error "$ltp_msg" "$LINENO" 5
+    as_fn_error $? "$ltp_msg" "$LINENO" 5
   fi
 
   case $php_cv_ltp_version in
     ""|invalid)
       ltp_msg="You must have one of the following versions of LTP: $ltp_version_list (found: $ltp_version)."
-      as_fn_error "$ltp_msg" "$LINENO" 5
+      as_fn_error $? "$ltp_msg" "$LINENO" 5
       LTP="exit 0;"
       ;;
   esac
 
   if test -z "$LTP_GENHTML"; then
-    as_fn_error "Could not find genhtml from the LTP package" "$LINENO" 5
+    as_fn_error $? "Could not find genhtml from the LTP package" "$LINENO" 5
   fi
 
 
@@ -20411,7 +20467,7 @@
 
 
   if test -z "$libgcc_libpath"; then
-    as_fn_error "Cannot locate libgcc. Make sure that gcc is in your path" "$LINENO" 5
+    as_fn_error $? "Cannot locate libgcc. Make sure that gcc is in your path" "$LINENO" 5
   fi
 
   if test "$libgcc_libpath" != "/usr/$PHP_LIBDIR" && test "$libgcc_libpath" != "/usr/lib"; then
@@ -20517,7 +20573,7 @@
 if test "$PHP_DMALLOC" = "yes"; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dmalloc_error in -ldmalloc" >&5
 $as_echo_n "checking for dmalloc_error in -ldmalloc... " >&6; }
-if test "${ac_cv_lib_dmalloc_dmalloc_error+set}" = set; then :
+if ${ac_cv_lib_dmalloc_dmalloc_error+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -20551,7 +20607,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dmalloc_dmalloc_error" >&5
 $as_echo "$ac_cv_lib_dmalloc_dmalloc_error" >&6; }
-if test "x$ac_cv_lib_dmalloc_dmalloc_error" = x""yes; then :
+if test "x$ac_cv_lib_dmalloc_dmalloc_error" = xyes; then :
 
 
 
@@ -20570,7 +20626,7 @@
 
 else
 
-    as_fn_error "Problem with enabling dmalloc. Please check config.log for details." "$LINENO" 5
+    as_fn_error $? "Problem with enabling dmalloc. Please check config.log for details." "$LINENO" 5
 
 fi
 
@@ -20632,7 +20688,7 @@
   for ac_header in sys/sdt.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "sys/sdt.h" "ac_cv_header_sys_sdt_h" "$ac_includes_default"
-if test "x$ac_cv_header_sys_sdt_h" = x""yes; then :
+if test "x$ac_cv_header_sys_sdt_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_SYS_SDT_H 1
 _ACEOF
@@ -20707,7 +20763,7 @@
 
 else
 
-    as_fn_error "Cannot find sys/sdt.h which is required for DTrace support" "$LINENO" 5
+    as_fn_error $? "Cannot find sys/sdt.h which is required for DTrace support" "$LINENO" 5
 
 fi
 
@@ -20744,7 +20800,7 @@
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: using $PHP_FD_SETSIZE" >&5
 $as_echo "using $PHP_FD_SETSIZE" >&6; }
   else
-    as_fn_error "Invalid value passed to --enable-fd-setsize!" "$LINENO" 5
+    as_fn_error $? "Invalid value passed to --enable-fd-setsize!" "$LINENO" 5
   fi
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: using system default" >&5
@@ -20787,7 +20843,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long" >&5
 $as_echo_n "checking size of long... " >&6; }
-if test "${ac_cv_sizeof_long+set}" = set; then :
+if ${ac_cv_sizeof_long+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long))" "ac_cv_sizeof_long"        "$ac_includes_default"; then :
@@ -20796,9 +20852,8 @@
   if test "$ac_cv_type_long" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long=0
    fi
@@ -20821,7 +20876,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of int" >&5
 $as_echo_n "checking size of int... " >&6; }
-if test "${ac_cv_sizeof_int+set}" = set; then :
+if ${ac_cv_sizeof_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (int))" "ac_cv_sizeof_int"        "$ac_includes_default"; then :
@@ -20830,9 +20885,8 @@
   if test "$ac_cv_type_int" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (int)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (int)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_int=0
    fi
@@ -20852,7 +20906,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for int32_t" >&5
 $as_echo_n "checking for int32_t... " >&6; }
-if test "${ac_cv_int_type_int32_t+set}" = set; then :
+if ${ac_cv_int_type_int32_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -20898,7 +20952,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for uint32_t" >&5
 $as_echo_n "checking for uint32_t... " >&6; }
-if test "${ac_cv_int_type_uint32_t+set}" = set; then :
+if ${ac_cv_int_type_uint32_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -20952,8 +21006,7 @@
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -20967,8 +21020,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -21792,7 +21844,7 @@
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether field re_magic exists in struct regex_t" >&5
 $as_echo_n "checking whether field re_magic exists in struct regex_t... " >&6; }
-if test "${ac_cv_regex_t_re_magic+set}" = set; then :
+if ${ac_cv_regex_t_re_magic+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -21902,7 +21954,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for xml2-config path" >&5
 $as_echo_n "checking for xml2-config path... " >&6; }
-if test "${ac_cv_php_xml2_config_path+set}" = set; then :
+if ${ac_cv_php_xml2_config_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -22060,7 +22112,7 @@
 
             { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether libxml build works" >&5
 $as_echo_n "checking whether libxml build works... " >&6; }
-if test "${php_cv_libxml_build_works+set}" = set; then :
+if ${php_cv_libxml_build_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -22098,7 +22150,7 @@
 
           { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-          as_fn_error "build test failed.  Please check the config.log for details." "$LINENO" 5
+          as_fn_error $? "build test failed.  Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -22433,10 +22485,10 @@
 
 
     else
-      as_fn_error "libxml2 version 2.6.11 or greater required." "$LINENO" 5
+      as_fn_error $? "libxml2 version 2.6.11 or greater required." "$LINENO" 5
     fi
 else
-    as_fn_error "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
+    as_fn_error $? "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
 
   fi
 
@@ -22821,7 +22873,7 @@
 set dummy krb5-config; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_KRB5_CONFIG+set}" = set; then :
+if ${ac_cv_path_KRB5_CONFIG+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $KRB5_CONFIG in
@@ -23187,7 +23239,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for DSA_get_default_method in -lssl" >&5
 $as_echo_n "checking for DSA_get_default_method in -lssl... " >&6; }
-if test "${ac_cv_lib_ssl_DSA_get_default_method+set}" = set; then :
+if ${ac_cv_lib_ssl_DSA_get_default_method+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -23221,7 +23273,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ssl_DSA_get_default_method" >&5
 $as_echo "$ac_cv_lib_ssl_DSA_get_default_method" >&6; }
-if test "x$ac_cv_lib_ssl_DSA_get_default_method" = x""yes; then :
+if test "x$ac_cv_lib_ssl_DSA_get_default_method" = xyes; then :
 
 $as_echo "#define HAVE_DSA_DEFAULT_METHOD 1" >>confdefs.h
 
@@ -23229,7 +23281,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for X509_free in -lcrypto" >&5
 $as_echo_n "checking for X509_free in -lcrypto... " >&6; }
-if test "${ac_cv_lib_crypto_X509_free+set}" = set; then :
+if ${ac_cv_lib_crypto_X509_free+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -23263,7 +23315,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_crypto_X509_free" >&5
 $as_echo "$ac_cv_lib_crypto_X509_free" >&6; }
-if test "x$ac_cv_lib_crypto_X509_free" = x""yes; then :
+if test "x$ac_cv_lib_crypto_X509_free" = xyes; then :
 
 $as_echo "#define HAVE_DSA_DEFAULT_METHOD 1" >>confdefs.h
 
@@ -23289,7 +23341,7 @@
 set dummy pkg-config; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_PKG_CONFIG+set}" = set; then :
+if ${ac_cv_path_PKG_CONFIG+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $PKG_CONFIG in
@@ -23335,7 +23387,7 @@
       OPENSSL_INCS=`$PKG_CONFIG --cflags-only-I openssl`
       OPENSSL_INCDIR=`$PKG_CONFIG --variable=includedir openssl`
     else
-      as_fn_error "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
+      as_fn_error $? "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
     fi
 
     if test -n "$OPENSSL_LIBS"; then
@@ -23490,11 +23542,11 @@
     done
 
     if test -z "$OPENSSL_INCDIR"; then
-      as_fn_error "Cannot find OpenSSL's <evp.h>" "$LINENO" 5
+      as_fn_error $? "Cannot find OpenSSL's <evp.h>" "$LINENO" 5
     fi
 
     if test -z "$OPENSSL_LIBDIR"; then
-      as_fn_error "Cannot find OpenSSL's libraries" "$LINENO" 5
+      as_fn_error $? "Cannot find OpenSSL's libraries" "$LINENO" 5
     fi
 
     old_CPPFLAGS=$CPPFLAGS
@@ -23518,7 +23570,7 @@
 
 else
 
-      as_fn_error "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
+      as_fn_error $? "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
 
 fi
 rm -f conftest*
@@ -23656,7 +23708,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CRYPTO_free in -lcrypto" >&5
 $as_echo_n "checking for CRYPTO_free in -lcrypto... " >&6; }
-if test "${ac_cv_lib_crypto_CRYPTO_free+set}" = set; then :
+if ${ac_cv_lib_crypto_CRYPTO_free+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -23690,7 +23742,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_crypto_CRYPTO_free" >&5
 $as_echo "$ac_cv_lib_crypto_CRYPTO_free" >&6; }
-if test "x$ac_cv_lib_crypto_CRYPTO_free" = x""yes; then :
+if test "x$ac_cv_lib_crypto_CRYPTO_free" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -23726,7 +23778,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_crypto_CRYPTO_free
 
-      as_fn_error "libcrypto not found!" "$LINENO" 5
+      as_fn_error $? "libcrypto not found!" "$LINENO" 5
 
 
 fi
@@ -23833,7 +23885,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SSL_CTX_set_ssl_version in -lssl" >&5
 $as_echo_n "checking for SSL_CTX_set_ssl_version in -lssl... " >&6; }
-if test "${ac_cv_lib_ssl_SSL_CTX_set_ssl_version+set}" = set; then :
+if ${ac_cv_lib_ssl_SSL_CTX_set_ssl_version+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -23867,7 +23919,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ssl_SSL_CTX_set_ssl_version" >&5
 $as_echo "$ac_cv_lib_ssl_SSL_CTX_set_ssl_version" >&6; }
-if test "x$ac_cv_lib_ssl_SSL_CTX_set_ssl_version" = x""yes; then :
+if test "x$ac_cv_lib_ssl_SSL_CTX_set_ssl_version" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -23881,7 +23933,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_ssl_SSL_CTX_set_ssl_version
 
-      as_fn_error "libssl not found!" "$LINENO" 5
+      as_fn_error $? "libssl not found!" "$LINENO" 5
 
 
 fi
@@ -23984,7 +24036,7 @@
 
 
 else
-    as_fn_error "OpenSSL check failed. Please check config.log for more information." "$LINENO" 5
+    as_fn_error $? "OpenSSL check failed. Please check config.log for more information." "$LINENO" 5
 
   fi
 
@@ -24022,7 +24074,7 @@
     done
 
     if test -z "$PCRE_INCDIR"; then
-      as_fn_error "Could not find pcre.h in $PHP_PCRE_REGEX" "$LINENO" 5
+      as_fn_error $? "Could not find pcre.h in $PHP_PCRE_REGEX" "$LINENO" 5
     fi
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PCRE_INCDIR" >&5
 $as_echo "$PCRE_INCDIR" >&6; }
@@ -24034,7 +24086,7 @@
     done
 
     if test -z "$PCRE_LIBDIR" ; then
-      as_fn_error "Could not find libpcre.(a|$SHLIB_SUFFIX_NAME) in $PHP_PCRE_REGEX" "$LINENO" 5
+      as_fn_error $? "Could not find libpcre.(a|$SHLIB_SUFFIX_NAME) in $PHP_PCRE_REGEX" "$LINENO" 5
     fi
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PCRE_LIBDIR" >&5
 $as_echo "$PCRE_LIBDIR" >&6; }
@@ -24049,7 +24101,7 @@
     fi
     pcre_version=$pcre_major$pcre_minor
     if test "$pcre_version" -lt 660; then
-      as_fn_error "The PCRE extension requires PCRE library version >= 6.6" "$LINENO" 5
+      as_fn_error $? "The PCRE extension requires PCRE library version >= 6.6" "$LINENO" 5
     fi
 
 
@@ -24859,7 +24911,7 @@
     if test -z "$SQLITE3_DIR"; then
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
-      as_fn_error "Please reinstall the sqlite distribution from http://www.sqlite.org" "$LINENO" 5
+      as_fn_error $? "Please reinstall the sqlite distribution from http://www.sqlite.org" "$LINENO" 5
     fi
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SQLite 3.3.9+" >&5
@@ -24963,7 +25015,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sqlite3_prepare_v2 in -lsqlite3" >&5
 $as_echo_n "checking for sqlite3_prepare_v2 in -lsqlite3... " >&6; }
-if test "${ac_cv_lib_sqlite3_sqlite3_prepare_v2+set}" = set; then :
+if ${ac_cv_lib_sqlite3_sqlite3_prepare_v2+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -24997,7 +25049,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sqlite3_sqlite3_prepare_v2" >&5
 $as_echo "$ac_cv_lib_sqlite3_sqlite3_prepare_v2" >&6; }
-if test "x$ac_cv_lib_sqlite3_sqlite3_prepare_v2" = x""yes; then :
+if test "x$ac_cv_lib_sqlite3_sqlite3_prepare_v2" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -25142,7 +25194,7 @@
 
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
-      as_fn_error "Please install SQLite 3.3.9 first or check libsqlite3 is present" "$LINENO" 5
+      as_fn_error $? "Please install SQLite 3.3.9 first or check libsqlite3 is present" "$LINENO" 5
 
 
 fi
@@ -25245,7 +25297,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sqlite3_key in -lsqlite3" >&5
 $as_echo_n "checking for sqlite3_key in -lsqlite3... " >&6; }
-if test "${ac_cv_lib_sqlite3_sqlite3_key+set}" = set; then :
+if ${ac_cv_lib_sqlite3_sqlite3_key+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -25279,7 +25331,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sqlite3_sqlite3_key" >&5
 $as_echo "$ac_cv_lib_sqlite3_sqlite3_key" >&6; }
-if test "x$ac_cv_lib_sqlite3_sqlite3_key" = x""yes; then :
+if test "x$ac_cv_lib_sqlite3_sqlite3_key" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -25395,7 +25447,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sqlite3_column_table_name in -lsqlite3" >&5
 $as_echo_n "checking for sqlite3_column_table_name in -lsqlite3... " >&6; }
-if test "${ac_cv_lib_sqlite3_sqlite3_column_table_name+set}" = set; then :
+if ${ac_cv_lib_sqlite3_sqlite3_column_table_name+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -25429,7 +25481,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sqlite3_sqlite3_column_table_name" >&5
 $as_echo "$ac_cv_lib_sqlite3_sqlite3_column_table_name" >&6; }
-if test "x$ac_cv_lib_sqlite3_sqlite3_column_table_name" = x""yes; then :
+if test "x$ac_cv_lib_sqlite3_sqlite3_column_table_name" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -25546,7 +25598,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sqlite3_load_extension in -lsqlite3" >&5
 $as_echo_n "checking for sqlite3_load_extension in -lsqlite3... " >&6; }
-if test "${ac_cv_lib_sqlite3_sqlite3_load_extension+set}" = set; then :
+if ${ac_cv_lib_sqlite3_sqlite3_load_extension+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -25580,7 +25632,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sqlite3_sqlite3_load_extension" >&5
 $as_echo "$ac_cv_lib_sqlite3_sqlite3_load_extension" >&6; }
-if test "x$ac_cv_lib_sqlite3_sqlite3_load_extension" = x""yes; then :
+if test "x$ac_cv_lib_sqlite3_sqlite3_load_extension" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -26342,7 +26394,7 @@
   fi
 
   if test -z "$ZLIB_DIR"; then
-    as_fn_error "Cannot find libz" "$LINENO" 5
+    as_fn_error $? "Cannot find libz" "$LINENO" 5
   fi
 
   case $ZLIB_DIR in
@@ -26356,7 +26408,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ZLIB_VERSION" >&5
 $as_echo "$ZLIB_VERSION" >&6; }
   if test `echo $ZLIB_VERSION | $SED -e 's/[^0-9]/ /g' | $AWK '{print $1*1000000 + $2*10000 + $3*100 + $4}'` -lt 1020004; then
-    as_fn_error "libz version greater or equal to 1.2.0.4 required" "$LINENO" 5
+    as_fn_error $? "libz version greater or equal to 1.2.0.4 required" "$LINENO" 5
   fi
 
 
@@ -26458,7 +26510,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gzgets in -lz" >&5
 $as_echo_n "checking for gzgets in -lz... " >&6; }
-if test "${ac_cv_lib_z_gzgets+set}" = set; then :
+if ${ac_cv_lib_z_gzgets+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -26492,7 +26544,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_z_gzgets" >&5
 $as_echo "$ac_cv_lib_z_gzgets" >&6; }
-if test "x$ac_cv_lib_z_gzgets" = x""yes; then :
+if test "x$ac_cv_lib_z_gzgets" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -26508,7 +26560,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_z_gzgets
 
-    as_fn_error "ZLIB extension requires gzgets in zlib" "$LINENO" 5
+    as_fn_error $? "ZLIB extension requires gzgets in zlib" "$LINENO" 5
 
 
 fi
@@ -26613,6 +26665,1254 @@
 
 
 
+php_enable_apc=no
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to enable APC support" >&5
+$as_echo_n "checking whether to enable APC support... " >&6; }
+# Check whether --enable-apc was given.
+if test "${enable_apc+set}" = set; then :
+  enableval=$enable_apc; PHP_APC=$enableval
+else
+
+  PHP_APC=no
+  test "$PHP_ENABLE_ALL" && PHP_APC=$PHP_ENABLE_ALL
+
+fi
+
+
+
+ext_output="yes, shared"
+ext_shared=yes
+case $PHP_APC in
+shared,*)
+  PHP_APC=`echo "$PHP_APC"|$SED 's/^shared,//'`
+  ;;
+shared)
+  PHP_APC=yes
+  ;;
+no)
+  ext_output=no
+  ext_shared=no
+  ;;
+*)
+  ext_output=yes
+  ext_shared=no
+  ;;
+esac
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ext_output" >&5
+$as_echo "$ext_output" >&6; }
+
+
+
+
+# Check whether --enable-apc-debug was given.
+if test "${enable_apc_debug+set}" = set; then :
+  enableval=$enable_apc_debug;
+  PHP_APC_DEBUG=$enableval
+
+else
+
+  PHP_APC_DEBUG=no
+
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we should enable cache request file info" >&5
+$as_echo_n "checking whether we should enable cache request file info... " >&6; }
+# Check whether --enable-apc-filehits was given.
+if test "${enable_apc_filehits+set}" = set; then :
+  enableval=$enable_apc_filehits;
+  PHP_APC_FILEHITS=$enableval
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enableval" >&5
+$as_echo "$enableval" >&6; }
+
+else
+
+  PHP_APC_FILEHITS=no
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we should use mmap" >&5
+$as_echo_n "checking whether we should use mmap... " >&6; }
+# Check whether --enable-apc-mmap was given.
+if test "${enable_apc_mmap+set}" = set; then :
+  enableval=$enable_apc_mmap;
+  PHP_APC_MMAP=$enableval
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enableval" >&5
+$as_echo "$enableval" >&6; }
+
+else
+
+  PHP_APC_MMAP=yes
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we should use semaphore locking instead of fcntl" >&5
+$as_echo_n "checking whether we should use semaphore locking instead of fcntl... " >&6; }
+# Check whether --enable-apc-sem was given.
+if test "${enable_apc_sem+set}" = set; then :
+  enableval=$enable_apc_sem;
+  PHP_APC_SEM=$enableval
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enableval" >&5
+$as_echo "$enableval" >&6; }
+
+else
+
+  PHP_APC_SEM=no
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we should use pthread mutex locking" >&5
+$as_echo_n "checking whether we should use pthread mutex locking... " >&6; }
+# Check whether --enable-apc-pthreadmutex was given.
+if test "${enable_apc_pthreadmutex+set}" = set; then :
+  enableval=$enable_apc_pthreadmutex;
+  PHP_APC_PTHREADMUTEX=$enableval
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enableval" >&5
+$as_echo "$enableval" >&6; }
+
+else
+
+  PHP_APC_PTHREADMUTEX=yes
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+fi
+
+
+if test "$PHP_APC_PTHREADMUTEX" != "no"; then
+	orig_LIBS="$LIBS"
+	LIBS="$LIBS -lpthread"
+	if test "$cross_compiling" = yes; then :
+
+
+
+  case pthread in
+  c|c_r|pthread*) ;;
+  *)
+      LIBS="-lpthread $LIBS"
+   ;;
+  esac
+
+
+
+
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+				#include <sys/types.h>
+				#include <pthread.h>
+                                main() {
+				pthread_mutex_t mutex;
+				pthread_mutexattr_t attr;
+
+				if(pthread_mutexattr_init(&attr)) {
+					puts("Unable to initialize pthread attributes (pthread_mutexattr_init).");
+					return -1;
+				}
+				if(pthread_mutexattr_setpshared(&attr, PTHREAD_PROCESS_SHARED)) {
+					puts("Unable to set PTHREAD_PROCESS_SHARED (pthread_mutexattr_setpshared), your system may not support shared mutex's.");
+					return -1;
+				}
+				if(pthread_mutex_init(&mutex, &attr)) {
+					puts("Unable to initialize the mutex (pthread_mutex_init).");
+					return -1;
+				}
+				if(pthread_mutexattr_destroy(&attr)) {
+					puts("Unable to destroy mutex attributes (pthread_mutexattr_destroy).");
+					return -1;
+				}
+				if(pthread_mutex_destroy(&mutex)) {
+					puts("Unable to destroy mutex (pthread_mutex_destroy).");
+					return -1;
+				}
+
+				puts("pthread mutexs are supported!");
+				return 0;
+                                }
+
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+
+
+  case pthread in
+  c|c_r|pthread*) ;;
+  *)
+      LIBS="-lpthread $LIBS"
+   ;;
+  esac
+
+
+
+else
+   				{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: It doesn't appear that pthread mutexes are supported on your system" >&5
+$as_echo "$as_me: WARNING: It doesn't appear that pthread mutexes are supported on your system" >&2;}
+  			PHP_APC_PTHREADMUTEX=no
+
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+	LIBS="$orig_LIBS"
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we should use pthread read/write locking" >&5
+$as_echo_n "checking whether we should use pthread read/write locking... " >&6; }
+# Check whether --enable-apc-pthreadrwlocks was given.
+if test "${enable_apc_pthreadrwlocks+set}" = set; then :
+  enableval=$enable_apc_pthreadrwlocks;
+  PHP_APC_PTHREADRWLOCK=$enableval
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enableval" >&5
+$as_echo "$enableval" >&6; }
+
+else
+
+  PHP_APC_PTHREADRWLOCK=no
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+fi
+
+
+if test "$PHP_APC_PTHREADRWLOCK" != "no"; then
+	orig_LIBS="$LIBS"
+	LIBS="$LIBS -lpthread"
+	if test "$cross_compiling" = yes; then :
+
+
+
+  case pthread in
+  c|c_r|pthread*) ;;
+  *)
+      LIBS="-lpthread $LIBS"
+   ;;
+  esac
+
+
+
+
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+				#include <sys/types.h>
+				#include <pthread.h>
+                                main() {
+				pthread_rwlock_t rwlock;
+				pthread_rwlockattr_t attr;
+
+				if(pthread_rwlockattr_init(&attr)) {
+					puts("Unable to initialize pthread attributes (pthread_rwlockattr_init).");
+					return -1;
+				}
+				if(pthread_rwlockattr_setpshared(&attr, PTHREAD_PROCESS_SHARED)) {
+					puts("Unable to set PTHREAD_PROCESS_SHARED (pthread_rwlockattr_setpshared), your system may not support shared rwlock's.");
+					return -1;
+				}
+				if(pthread_rwlock_init(&rwlock, &attr)) {
+					puts("Unable to initialize the rwlock (pthread_rwlock_init).");
+					return -1;
+				}
+				if(pthread_rwlockattr_destroy(&attr)) {
+					puts("Unable to destroy rwlock attributes (pthread_rwlockattr_destroy).");
+					return -1;
+				}
+				if(pthread_rwlock_destroy(&rwlock)) {
+					puts("Unable to destroy rwlock (pthread_rwlock_destroy).");
+					return -1;
+				}
+
+				puts("pthread rwlocks are supported!");
+				return 0;
+                                }
+
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+
+
+  case pthread in
+  c|c_r|pthread*) ;;
+  *)
+      LIBS="-lpthread $LIBS"
+   ;;
+  esac
+
+
+				APC_CFLAGS="-D_GNU_SOURCE"
+
+else
+   				{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: It doesn't appear that pthread rwlocks are supported on your system" >&5
+$as_echo "$as_me: WARNING: It doesn't appear that pthread rwlocks are supported on your system" >&2;}
+  				PHP_APC_PTHREADRWLOCK=no
+
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+	LIBS="$orig_LIBS"
+fi
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the target compiler supports builtin atomics" >&5
+$as_echo_n "checking whether the target compiler supports builtin atomics... " >&6; }
+if ${PHP_cv_APC_GCC_ATOMICS+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+
+			cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+					int foo = 0;
+					__sync_fetch_and_add(&foo, 1);
+					__sync_bool_compare_and_swap(&foo, 0, 1);
+					return __sync_fetch_and_add(&foo, 1);
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  PHP_cv_APC_GCC_ATOMICS=yes
+else
+  PHP_cv_APC_GCC_ATOMICS=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $PHP_cv_APC_GCC_ATOMICS" >&5
+$as_echo "$PHP_cv_APC_GCC_ATOMICS" >&6; }
+
+	if test "x${PHP_cv_APC_GCC_ATOMICS}" != "xno"; then
+
+$as_echo "#define HAVE_ATOMIC_OPERATIONS 1" >>confdefs.h
+
+		else
+			if test "$PHP_APC_PTHREADRWLOCK" != "no"; then
+				{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Disabling pthread rwlocks, because of missing atomic operations" >&5
+$as_echo "$as_me: WARNING: Disabling pthread rwlocks, because of missing atomic operations" >&2;}
+								PHP_APC_PTHREADRWLOCK=no
+			fi
+	fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we should use spin locks" >&5
+$as_echo_n "checking whether we should use spin locks... " >&6; }
+# Check whether --enable-apc-spinlocks was given.
+if test "${enable_apc_spinlocks+set}" = set; then :
+  enableval=$enable_apc_spinlocks;
+  PHP_APC_SPINLOCKS=$enableval
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enableval" >&5
+$as_echo "$enableval" >&6; }
+
+else
+
+  PHP_APC_SPINLOCKS=no
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+fi
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we should enable memory protection" >&5
+$as_echo_n "checking whether we should enable memory protection... " >&6; }
+# Check whether --enable-apc-memprotect was given.
+if test "${enable_apc_memprotect+set}" = set; then :
+  enableval=$enable_apc_memprotect;
+  PHP_APC_MEMPROTECT=$enableval
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enableval" >&5
+$as_echo "$enableval" >&6; }
+
+else
+
+  PHP_APC_MEMPROTECT=no
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+fi
+
+
+if test "$PHP_APC" != "no"; then
+  test "$PHP_APC_MMAP" != "no" &&
+$as_echo "#define APC_MMAP 1" >>confdefs.h
+
+  test "$PHP_APC_FILEHITS" != "no" &&
+$as_echo "#define APC_FILEHITS 1" >>confdefs.h
+
+
+	if test "$PHP_APC_DEBUG" != "no"; then
+
+$as_echo "#define __DEBUG_APC__ 1" >>confdefs.h
+
+	fi
+
+	if test "$PHP_APC_SEM" != "no"; then
+
+$as_echo "#define APC_SEM_LOCKS 1" >>confdefs.h
+
+	elif test "$PHP_APC_SPINLOCKS" != "no"; then
+
+$as_echo "#define APC_SPIN_LOCKS 1" >>confdefs.h
+
+	elif test "$PHP_APC_PTHREADRWLOCK" != "no"; then
+
+$as_echo "#define APC_PTHREADRW_LOCKS 1" >>confdefs.h
+
+	elif test "$PHP_APC_PTHREADMUTEX" != "no"; then
+
+$as_echo "#define APC_PTHREADMUTEX_LOCKS 1" >>confdefs.h
+
+	else
+
+$as_echo "#define APC_FCNTL_LOCKS 1" >>confdefs.h
+
+	fi
+
+	if test "$PHP_APC_MEMPROTECT" != "no"; then
+
+$as_echo "#define APC_MEMPROTECT 1" >>confdefs.h
+
+	fi
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for zend_set_lookup_function_hook" >&5
+$as_echo_n "checking for zend_set_lookup_function_hook... " >&6; }
+if ${php_cv_zend_set_lookup_function_hook+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    orig_cflags=$CFLAGS
+    CFLAGS="$INCLUDES $EXTRA_INCLUDES"
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include "main/php.h"
+#include "Zend/zend_API.h"
+
+int
+main ()
+{
+#ifndef zend_set_lookup_function_hook
+	(void) zend_set_lookup_function_hook;
+#endif
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+
+      php_cv_zend_set_lookup_function_hook=yes
+
+else
+
+      php_cv_zend_set_lookup_function_hook=no
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+    CFLAGS=$orig_cflags
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $php_cv_zend_set_lookup_function_hook" >&5
+$as_echo "$php_cv_zend_set_lookup_function_hook" >&6; }
+  if test "$php_cv_zend_set_lookup_function_hook" = "yes"; then
+
+$as_echo "#define APC_HAVE_LOOKUP_HOOKS 1" >>confdefs.h
+
+  else
+
+$as_echo "#define APC_HAVE_LOOKUP_HOOKS 0" >>confdefs.h
+
+  fi
+
+  for ac_func in sigaction
+do :
+  ac_fn_c_check_func "$LINENO" "sigaction" "ac_cv_func_sigaction"
+if test "x$ac_cv_func_sigaction" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SIGACTION 1
+_ACEOF
+
+fi
+done
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for union semun" >&5
+$as_echo_n "checking for union semun... " >&6; }
+if ${php_cv_semun+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <sys/types.h>
+#include <sys/ipc.h>
+#include <sys/sem.h>
+
+int
+main ()
+{
+union semun x; x.val=1
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+
+      php_cv_semun=yes
+
+else
+
+      php_cv_semun=no
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $php_cv_semun" >&5
+$as_echo "$php_cv_semun" >&6; }
+  if test "$php_cv_semun" = "yes"; then
+
+$as_echo "#define HAVE_SEMUN 1" >>confdefs.h
+
+  else
+
+$as_echo "#define HAVE_SEMUN 0" >>confdefs.h
+
+  fi
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we should enable valgrind support" >&5
+$as_echo_n "checking whether we should enable valgrind support... " >&6; }
+  # Check whether --enable-valgrind-checks was given.
+if test "${enable_valgrind_checks+set}" = set; then :
+  enableval=$enable_valgrind_checks;
+    PHP_APC_VALGRIND=$enableval
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enableval" >&5
+$as_echo "$enableval" >&6; }
+
+else
+
+    PHP_APC_VALGRIND=yes
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+    ac_fn_c_check_header_mongrel "$LINENO" "valgrind/memcheck.h" "ac_cv_header_valgrind_memcheck_h" "$ac_includes_default"
+if test "x$ac_cv_header_valgrind_memcheck_h" = xyes; then :
+
+$as_echo "#define HAVE_VALGRIND_MEMCHECK_H 1" >>confdefs.h
+
+fi
+
+
+
+fi
+
+
+  apc_sources="apc.c php_apc.c \
+               apc_cache.c \
+               apc_compile.c \
+               apc_debug.c \
+               apc_fcntl.c \
+               apc_main.c \
+               apc_mmap.c \
+               apc_sem.c \
+               apc_shm.c \
+               apc_pthreadmutex.c \
+               apc_pthreadrwlock.c \
+               apc_spin.c \
+               pgsql_s_lock.c \
+               apc_sma.c \
+               apc_stack.c \
+               apc_zend.c \
+               apc_rfc1867.c \
+               apc_signal.c \
+               apc_pool.c \
+               apc_iterator.c \
+               apc_bin.c \
+               apc_string.c "
+
+
+  save_old_LDFLAGS=$LDFLAGS
+  ac_stuff=""
+
+  save_ext_shared=$ext_shared
+  ext_shared=yes
+
+  for ac_i in $ac_stuff; do
+    case $ac_i in
+    -pthread)
+      if test "$ext_shared" = "yes"; then
+        LDFLAGS="$LDFLAGS -pthread"
+      else
+
+
+  unique=`echo $ac_i|$SED 's/[^a-zA-Z0-9]/_/g'`
+
+  cmd="echo $ac_n \"\$EXTRA_LDFLAGS$unique$ac_c\""
+  if test -n "$unique" && test "`eval $cmd`" = "" ; then
+    eval "EXTRA_LDFLAGS$unique=set"
+    EXTRA_LDFLAGS="$EXTRA_LDFLAGS $ac_i"
+  fi
+
+      fi
+    ;;
+    -l*)
+      ac_ii=`echo $ac_i|cut -c 3-`
+
+
+  case $ac_ii in
+  c|c_r|pthread*) ;;
+  *)
+    if test "$ext_shared" = "yes"; then
+        LDFLAGS="$LDFLAGS -l$ac_ii"
+    else
+
+
+  case $ac_ii in
+  c|c_r|pthread*) ;;
+  *)
+      LIBS="$LIBS -l$ac_ii"
+   ;;
+  esac
+
+
+    fi
+   ;;
+  esac
+
+
+    ;;
+    -L*)
+      ac_ii=`echo $ac_i|cut -c 3-`
+
+  if test "$ac_ii" != "/usr/$PHP_LIBDIR" && test "$ac_ii" != "/usr/lib"; then
+
+  if test -z "$ac_ii" || echo "$ac_ii" | grep '^/' >/dev/null ; then
+    ai_p=$ac_ii
+  else
+
+    ep_dir=`echo $ac_ii|$SED 's%/*[^/][^/]*/*$%%'`
+
+    ep_realdir=`(cd "$ep_dir" && pwd)`
+    ai_p="$ep_realdir"/`basename "$ac_ii"`
+  fi
+
+
+      if test "$ext_shared" = "yes"; then
+        LDFLAGS="-L$ai_p $LDFLAGS"
+        test -n "$ld_runpath_switch" && LDFLAGS="$ld_runpath_switch$ai_p $LDFLAGS"
+      else
+
+
+
+  unique=`echo $ai_p|$SED 's/[^a-zA-Z0-9]/_/g'`
+
+  cmd="echo $ac_n \"\$LIBPATH$unique$ac_c\""
+  if test -n "$unique" && test "`eval $cmd`" = "" ; then
+    eval "LIBPATH$unique=set"
+
+    test -n "$ld_runpath_switch" && LDFLAGS="$LDFLAGS $ld_runpath_switch$ai_p"
+    LDFLAGS="$LDFLAGS -L$ai_p"
+    PHP_RPATHS="$PHP_RPATHS $ai_p"
+
+  fi
+
+
+      fi
+
+  fi
+
+    ;;
+    esac
+  done
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for shm_open in -lrt" >&5
+$as_echo_n "checking for shm_open in -lrt... " >&6; }
+if ${ac_cv_lib_rt_shm_open+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lrt  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char shm_open ();
+int
+main ()
+{
+return shm_open ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_rt_shm_open=yes
+else
+  ac_cv_lib_rt_shm_open=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_rt_shm_open" >&5
+$as_echo "$ac_cv_lib_rt_shm_open" >&6; }
+if test "x$ac_cv_lib_rt_shm_open" = xyes; then :
+
+    LDFLAGS=$save_old_LDFLAGS
+    ext_shared=$save_ext_shared
+
+
+  case rt in
+  c|c_r|pthread*) ;;
+  *)
+    if test "$ext_shared" = "yes"; then
+        APC_SHARED_LIBADD="-lrt $APC_SHARED_LIBADD"
+    else
+
+
+  case rt in
+  c|c_r|pthread*) ;;
+  *)
+      LIBS="-lrt $LIBS"
+   ;;
+  esac
+
+
+    fi
+   ;;
+  esac
+
+
+
+else
+
+    LDFLAGS=$save_old_LDFLAGS
+    ext_shared=$save_ext_shared
+    unset ac_cv_lib_rt_shm_open
+
+
+fi
+
+
+  ext_builddir=ext/apc
+  ext_srcdir=$abs_srcdir/ext/apc
+
+  ac_extra=`echo "\\$(APC_CFLAGS)"|$SED s#@ext_srcdir@#$ext_srcdir#g|$SED s#@ext_builddir@#$ext_builddir#g`
+
+  if test "$ext_shared" != "shared" && test "$ext_shared" != "yes" && test "" != "cli"; then
+    PHP_APC_SHARED=no
+
+
+  case ext/apc in
+  "") ac_srcdir="$abs_srcdir/"; unset ac_bdir; ac_inc="-I. -I$abs_srcdir" ;;
+  /*) ac_srcdir=`echo "ext/apc"|cut -c 2-`"/"; ac_bdir=$ac_srcdir; ac_inc="-I$ac_bdir -I$abs_srcdir/$ac_bdir" ;;
+  *) ac_srcdir="$abs_srcdir/ext/apc/"; ac_bdir="ext/apc/"; ac_inc="-I$ac_bdir -I$ac_srcdir" ;;
+  esac
+
+
+
+  b_c_pre=$php_c_pre
+  b_cxx_pre=$php_cxx_pre
+  b_c_meta=$php_c_meta
+  b_cxx_meta=$php_cxx_meta
+  b_c_post=$php_c_post
+  b_cxx_post=$php_cxx_post
+  b_lo=$php_lo
+
+
+  old_IFS=$IFS
+  for ac_src in $apc_sources; do
+
+      IFS=.
+      set $ac_src
+      ac_obj=$1
+      IFS=$old_IFS
+
+      PHP_GLOBAL_OBJS="$PHP_GLOBAL_OBJS $ac_bdir$ac_obj.lo"
+
+      case $ac_src in
+        *.c) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.s) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.S) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.cpp|*.cc|*.cxx) ac_comp="$b_cxx_pre $ac_extra $ac_inc $b_cxx_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_cxx_post" ;;
+      esac
+
+    cat >>Makefile.objects<<EOF
+$ac_bdir$ac_obj.lo: $ac_srcdir$ac_src
+	$ac_comp
+EOF
+  done
+
+
+    EXT_STATIC="$EXT_STATIC apc"
+    if test "$ext_shared" != "nocli"; then
+      EXT_CLI_STATIC="$EXT_CLI_STATIC apc"
+    fi
+  else
+    if test "$ext_shared" = "shared" || test "$ext_shared" = "yes"; then
+      PHP_APC_SHARED=yes
+
+  case ext/apc in
+  "") ac_srcdir="$abs_srcdir/"; unset ac_bdir; ac_inc="-I. -I$abs_srcdir" ;;
+  /*) ac_srcdir=`echo "ext/apc"|cut -c 2-`"/"; ac_bdir=$ac_srcdir; ac_inc="-I$ac_bdir -I$abs_srcdir/$ac_bdir" ;;
+  *) ac_srcdir="$abs_srcdir/ext/apc/"; ac_bdir="ext/apc/"; ac_inc="-I$ac_bdir -I$ac_srcdir" ;;
+  esac
+
+
+
+  b_c_pre=$shared_c_pre
+  b_cxx_pre=$shared_cxx_pre
+  b_c_meta=$shared_c_meta
+  b_cxx_meta=$shared_cxx_meta
+  b_c_post=$shared_c_post
+  b_cxx_post=$shared_cxx_post
+  b_lo=$shared_lo
+
+
+  old_IFS=$IFS
+  for ac_src in $apc_sources; do
+
+      IFS=.
+      set $ac_src
+      ac_obj=$1
+      IFS=$old_IFS
+
+      shared_objects_apc="$shared_objects_apc $ac_bdir$ac_obj.lo"
+
+      case $ac_src in
+        *.c) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.s) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.S) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.cpp|*.cc|*.cxx) ac_comp="$b_cxx_pre $ac_extra $ac_inc $b_cxx_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_cxx_post" ;;
+      esac
+
+    cat >>Makefile.objects<<EOF
+$ac_bdir$ac_obj.lo: $ac_srcdir$ac_src
+	$ac_comp
+EOF
+  done
+
+      case $host_alias in
+        *netware*)
+
+  install_modules="install-modules"
+
+  case $host_alias in
+    *aix*)
+      suffix=so
+      link_cmd='$(LIBTOOL) --mode=link $(CC) $(COMMON_FLAGS) $(CFLAGS_CLEAN) $(EXTRA_CFLAGS) $(LDFLAGS) -Wl,-G -o '$ext_builddir'/phpapc.la -export-dynamic -avoid-version -prefer-pic -module -rpath $(phplibdir) $(EXTRA_LDFLAGS) $(shared_objects_apc) $(PHPAPC_SHARED_LIBADD) && mv -f '$ext_builddir'/.libs/phpapc.so '$ext_builddir'/phpapc.so'
+      ;;
+    *netware*)
+      suffix=nlm
+      link_cmd='$(LIBTOOL) --mode=link $(CC) $(COMMON_FLAGS) $(CFLAGS_CLEAN) $(EXTRA_CFLAGS) $(LDFLAGS) -o $@ -shared -export-dynamic -avoid-version -prefer-pic -module -rpath $(phplibdir) $(EXTRA_LDFLAGS) $(shared_objects_apc) -L$(top_builddir)/netware -lphp5lib $(APC_SHARED_LIBADD)'
+      ;;
+    *)
+      suffix=la
+      link_cmd='$(LIBTOOL) --mode=link $(CC) $(COMMON_FLAGS) $(CFLAGS_CLEAN) $(EXTRA_CFLAGS) $(LDFLAGS) -o $@ -export-dynamic -avoid-version -prefer-pic -module -rpath $(phplibdir) $(EXTRA_LDFLAGS) $(shared_objects_apc) $(PHPAPC_SHARED_LIBADD)'
+      ;;
+  esac
+
+  if test "x" = "xyes"; then
+    PHP_ZEND_EX="$PHP_ZEND_EX \$(phplibdir)/phpapc.$suffix"
+  else
+    PHP_MODULES="$PHP_MODULES \$(phplibdir)/phpapc.$suffix"
+  fi
+
+  PHP_VAR_SUBST="$PHP_VAR_SUBST shared_objects_apc"
+
+  cat >>Makefile.objects<<EOF
+\$(phplibdir)/phpapc.$suffix: $ext_builddir/phpapc.$suffix
+	\$(LIBTOOL) --mode=install cp $ext_builddir/phpapc.$suffix \$(phplibdir)
+
+$ext_builddir/phpapc.$suffix: \$(shared_objects_apc) \$(PHPAPC_SHARED_DEPENDENCIES)
+	$link_cmd
+
+EOF
+
+          ;;
+        *)
+
+  install_modules="install-modules"
+
+  case $host_alias in
+    *aix*)
+      suffix=so
+      link_cmd='$(LIBTOOL) --mode=link $(CC) $(COMMON_FLAGS) $(CFLAGS_CLEAN) $(EXTRA_CFLAGS) $(LDFLAGS) -Wl,-G -o '$ext_builddir'/apc.la -export-dynamic -avoid-version -prefer-pic -module -rpath $(phplibdir) $(EXTRA_LDFLAGS) $(shared_objects_apc) $(APC_SHARED_LIBADD) && mv -f '$ext_builddir'/.libs/apc.so '$ext_builddir'/apc.so'
+      ;;
+    *netware*)
+      suffix=nlm
+      link_cmd='$(LIBTOOL) --mode=link $(CC) $(COMMON_FLAGS) $(CFLAGS_CLEAN) $(EXTRA_CFLAGS) $(LDFLAGS) -o $@ -shared -export-dynamic -avoid-version -prefer-pic -module -rpath $(phplibdir) $(EXTRA_LDFLAGS) $(shared_objects_apc) -L$(top_builddir)/netware -lphp5lib $(_SHARED_LIBADD)'
+      ;;
+    *)
+      suffix=la
+      link_cmd='$(LIBTOOL) --mode=link $(CC) $(COMMON_FLAGS) $(CFLAGS_CLEAN) $(EXTRA_CFLAGS) $(LDFLAGS) -o $@ -export-dynamic -avoid-version -prefer-pic -module -rpath $(phplibdir) $(EXTRA_LDFLAGS) $(shared_objects_apc) $(APC_SHARED_LIBADD)'
+      ;;
+  esac
+
+  if test "x" = "xyes"; then
+    PHP_ZEND_EX="$PHP_ZEND_EX \$(phplibdir)/apc.$suffix"
+  else
+    PHP_MODULES="$PHP_MODULES \$(phplibdir)/apc.$suffix"
+  fi
+
+  PHP_VAR_SUBST="$PHP_VAR_SUBST shared_objects_apc"
+
+  cat >>Makefile.objects<<EOF
+\$(phplibdir)/apc.$suffix: $ext_builddir/apc.$suffix
+	\$(LIBTOOL) --mode=install cp $ext_builddir/apc.$suffix \$(phplibdir)
+
+$ext_builddir/apc.$suffix: \$(shared_objects_apc) \$(APC_SHARED_DEPENDENCIES)
+	$link_cmd
+
+EOF
+
+          ;;
+      esac
+
+cat >>confdefs.h <<_ACEOF
+#define COMPILE_DL_APC 1
+_ACEOF
+
+    fi
+  fi
+
+  if test "$ext_shared" != "shared" && test "$ext_shared" != "yes" && test "" = "cli"; then
+    PHP_APC_SHARED=no
+    case "$PHP_SAPI" in
+      cgi|embed)
+
+
+  case ext/apc in
+  "") ac_srcdir="$abs_srcdir/"; unset ac_bdir; ac_inc="-I. -I$abs_srcdir" ;;
+  /*) ac_srcdir=`echo "ext/apc"|cut -c 2-`"/"; ac_bdir=$ac_srcdir; ac_inc="-I$ac_bdir -I$abs_srcdir/$ac_bdir" ;;
+  *) ac_srcdir="$abs_srcdir/ext/apc/"; ac_bdir="ext/apc/"; ac_inc="-I$ac_bdir -I$ac_srcdir" ;;
+  esac
+
+
+
+  b_c_pre=$php_c_pre
+  b_cxx_pre=$php_cxx_pre
+  b_c_meta=$php_c_meta
+  b_cxx_meta=$php_cxx_meta
+  b_c_post=$php_c_post
+  b_cxx_post=$php_cxx_post
+  b_lo=$php_lo
+
+
+  old_IFS=$IFS
+  for ac_src in $apc_sources; do
+
+      IFS=.
+      set $ac_src
+      ac_obj=$1
+      IFS=$old_IFS
+
+      PHP_GLOBAL_OBJS="$PHP_GLOBAL_OBJS $ac_bdir$ac_obj.lo"
+
+      case $ac_src in
+        *.c) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.s) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.S) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.cpp|*.cc|*.cxx) ac_comp="$b_cxx_pre $ac_extra $ac_inc $b_cxx_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_cxx_post" ;;
+      esac
+
+    cat >>Makefile.objects<<EOF
+$ac_bdir$ac_obj.lo: $ac_srcdir$ac_src
+	$ac_comp
+EOF
+  done
+
+
+        EXT_STATIC="$EXT_STATIC apc"
+        ;;
+      *)
+
+
+  case ext/apc in
+  "") ac_srcdir="$abs_srcdir/"; unset ac_bdir; ac_inc="-I. -I$abs_srcdir" ;;
+  /*) ac_srcdir=`echo "ext/apc"|cut -c 2-`"/"; ac_bdir=$ac_srcdir; ac_inc="-I$ac_bdir -I$abs_srcdir/$ac_bdir" ;;
+  *) ac_srcdir="$abs_srcdir/ext/apc/"; ac_bdir="ext/apc/"; ac_inc="-I$ac_bdir -I$ac_srcdir" ;;
+  esac
+
+
+
+  b_c_pre=$php_c_pre
+  b_cxx_pre=$php_cxx_pre
+  b_c_meta=$php_c_meta
+  b_cxx_meta=$php_cxx_meta
+  b_c_post=$php_c_post
+  b_cxx_post=$php_cxx_post
+  b_lo=$php_lo
+
+
+  old_IFS=$IFS
+  for ac_src in $apc_sources; do
+
+      IFS=.
+      set $ac_src
+      ac_obj=$1
+      IFS=$old_IFS
+
+      PHP_GLOBAL_OBJS="$PHP_GLOBAL_OBJS $ac_bdir$ac_obj.lo"
+
+      case $ac_src in
+        *.c) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.s) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.S) ac_comp="$b_c_pre $ac_extra $ac_inc $b_c_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_c_post" ;;
+        *.cpp|*.cc|*.cxx) ac_comp="$b_cxx_pre $ac_extra $ac_inc $b_cxx_meta -c $ac_srcdir$ac_src -o $ac_bdir$ac_obj.$b_lo $b_cxx_post" ;;
+      esac
+
+    cat >>Makefile.objects<<EOF
+$ac_bdir$ac_obj.lo: $ac_srcdir$ac_src
+	$ac_comp
+EOF
+  done
+
+
+        ;;
+    esac
+    EXT_CLI_STATIC="$EXT_CLI_STATIC apc"
+  fi
+
+
+    BUILD_DIR="$BUILD_DIR $ext_builddir"
+
+
+
+  if test "$ext_builddir" = "."; then
+    PHP_PECL_EXTENSION=apc
+
+  PHP_VAR_SUBST="$PHP_VAR_SUBST PHP_PECL_EXTENSION"
+
+  fi
+
+
+  PHP_VAR_SUBST="$PHP_VAR_SUBST APC_SHARED_LIBADD"
+
+
+  PHP_VAR_SUBST="$PHP_VAR_SUBST APC_CFLAGS"
+
+
+
+    header_path=ext/apc
+    for header_file in apc_serializer.h; do
+      hp_hf="$header_path/$header_file"
+
+
+  unique=`echo $hp_hf|$SED 's/[^a-zA-Z0-9]/_/g'`
+
+  cmd="echo $ac_n \"\$INSTALLHEADERS$unique$ac_c\""
+  if test -n "$unique" && test "`eval $cmd`" = "" ; then
+    eval "INSTALLHEADERS$unique=set"
+
+        INSTALL_HEADERS="$INSTALL_HEADERS $hp_hf"
+
+  fi
+
+    done
+
+
+
+$as_echo "#define HAVE_APC 1" >>confdefs.h
+
+fi
+
+
+php_enable_coverage=no
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to include code coverage symbols" >&5
+$as_echo_n "checking whether to include code coverage symbols... " >&6; }
+# Check whether --enable-coverage was given.
+if test "${enable_coverage+set}" = set; then :
+  enableval=$enable_coverage; PHP_COVERAGE=$enableval
+else
+
+  PHP_COVERAGE=no
+
+
+fi
+
+
+ext_output=$PHP_COVERAGE
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ext_output" >&5
+$as_echo "$ext_output" >&6; }
+
+
+
+
+if test "$PHP_COVERAGE" = "yes"; then
+
+  if test "$GCC" != "yes"; then
+    as_fn_error $? "GCC is required for --enable-coverage" "$LINENO" 5
+  fi
+
+    case `$php_shtool path $CC` in
+    *ccache*) gcc_ccache=yes;;
+    *) gcc_ccache=no;;
+  esac
+
+  if test "$gcc_ccache" = "yes" && (test -z "$CCACHE_DISABLE" || test "$CCACHE_DISABLE" != "1"); then
+    as_fn_error $? "ccache must be disabled when --enable-coverage option is used. You can disable ccache by setting environment variable CCACHE_DISABLE=1." "$LINENO" 5
+  fi
+
+  lcov_version_list="1.5 1.6 1.7 1.9"
+
+  # Extract the first word of "lcov", so it can be a program name with args.
+set dummy lcov; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_LCOV+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$LCOV"; then
+  ac_cv_prog_LCOV="$LCOV" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    ac_cv_prog_LCOV="lcov"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+LCOV=$ac_cv_prog_LCOV
+if test -n "$LCOV"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LCOV" >&5
+$as_echo "$LCOV" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  # Extract the first word of "genhtml", so it can be a program name with args.
+set dummy genhtml; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_GENHTML+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$GENHTML"; then
+  ac_cv_prog_GENHTML="$GENHTML" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    ac_cv_prog_GENHTML="genhtml"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+GENHTML=$ac_cv_prog_GENHTML
+if test -n "$GENHTML"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $GENHTML" >&5
+$as_echo "$GENHTML" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+
+  PHP_VAR_SUBST="$PHP_VAR_SUBST LCOV"
+
+
+  PHP_VAR_SUBST="$PHP_VAR_SUBST GENHTML"
+
+
+  if test "$LCOV"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for lcov version" >&5
+$as_echo_n "checking for lcov version... " >&6; }
+if ${php_cv_lcov_version+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+      php_cv_lcov_version=invalid
+      lcov_version=`$LCOV -v 2>/dev/null | $SED -e 's/^.* //'` #'
+      for lcov_check_version in $lcov_version_list; do
+        if test "$lcov_version" = "$lcov_check_version"; then
+          php_cv_lcov_version="$lcov_check_version (ok)"
+        fi
+      done
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $php_cv_lcov_version" >&5
+$as_echo "$php_cv_lcov_version" >&6; }
+  else
+    lcov_msg="To enable code coverage reporting you must have one of the following LCOV versions installed: $lcov_version_list"
+    as_fn_error $? "$lcov_msg" "$LINENO" 5
+  fi
+
+  case $php_cv_lcov_version in
+    ""|invalid)
+      lcov_msg="You must have one of the following versions of LCOV: $lcov_version_list (found: $lcov_version)."
+      as_fn_error $? "$lcov_msg" "$LINENO" 5
+      LCOV="exit 0;"
+      ;;
+  esac
+
+  if test -z "$GENHTML"; then
+    as_fn_error $? "Could not find genhtml from the LCOV package" "$LINENO" 5
+  fi
+
+
+  src=$ext_srcdir/Makefile.frag
+  ac_srcdir=$ext_srcdir
+  ac_builddir=$ext_builddir
+  test -f "$src" && $SED -e "s#\$(srcdir)#$ac_srcdir#g" -e "s#\$(builddir)#$ac_builddir#g" $src  >> Makefile.fragments
+
+
+
+  CFLAGS=`echo "$CFLAGS" | $SED -e 's/-O[0-9s]*//g'`
+  CXXFLAGS=`echo "$CXXFLAGS" | $SED -e 's/-O[0-9s]*//g'`
+
+
+    CFLAGS="$CFLAGS -O0 -ggdb -fprofile-arcs -ftest-coverage"
+  CXXFLAGS="$CXXFLAGS -ggdb -O0 -fprofile-arcs -ftest-coverage"
+fi
+
+
+
 php_enable_bcmath=no
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to enable bc style precision math functions" >&5
@@ -27041,7 +28341,7 @@
   if test -z "$BZIP_DIR"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
-    as_fn_error "Please reinstall the BZip2 distribution" "$LINENO" 5
+    as_fn_error $? "Please reinstall the BZip2 distribution" "$LINENO" 5
   fi
 
 
@@ -27143,7 +28443,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for BZ2_bzerror in -lbz2" >&5
 $as_echo_n "checking for BZ2_bzerror in -lbz2... " >&6; }
-if test "${ac_cv_lib_bz2_BZ2_bzerror+set}" = set; then :
+if ${ac_cv_lib_bz2_BZ2_bzerror+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -27177,7 +28477,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bz2_BZ2_bzerror" >&5
 $as_echo "$ac_cv_lib_bz2_BZ2_bzerror" >&6; }
-if test "x$ac_cv_lib_bz2_BZ2_bzerror" = x""yes; then :
+if test "x$ac_cv_lib_bz2_BZ2_bzerror" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -27321,7 +28621,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_bz2_BZ2_bzerror
 
-    as_fn_error "bz2 module requires libbz2 >= 1.0.0" "$LINENO" 5
+    as_fn_error $? "bz2 module requires libbz2 >= 1.0.0" "$LINENO" 5
 
 
 fi
@@ -28402,7 +29702,7 @@
   if test -z "$CURL_DIR"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
-    as_fn_error "Please reinstall the libcurl distribution -
+    as_fn_error $? "Please reinstall the libcurl distribution -
     easy.h should be in <curl-dir>/include/curl/" "$LINENO" 5
   fi
 
@@ -28425,7 +29725,7 @@
 $as_echo "$curl_version_full" >&6; }
     CURL_LIBS=`$CURL_CONFIG --libs`
   else
-    as_fn_error "cURL version 7.10.5 or later is required to compile php with cURL support" "$LINENO" 5
+    as_fn_error $? "cURL version 7.10.5 or later is required to compile php with cURL support" "$LINENO" 5
   fi
 
 
@@ -28671,7 +29971,7 @@
   CPP=
 fi
 if test -z "$CPP"; then
-  if test "${ac_cv_prog_CPP+set}" = set; then :
+  if ${ac_cv_prog_CPP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
       # Double quotes because CPP needs to be expanded
@@ -28701,7 +30001,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -28717,11 +30017,11 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
   break
 fi
@@ -28760,7 +30060,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -28776,18 +30076,18 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
 
 else
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 
 ac_ext=c
@@ -28830,7 +30130,7 @@
       for ac_header in openssl/crypto.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "openssl/crypto.h" "ac_cv_header_openssl_crypto_h" "$ac_includes_default"
-if test "x$ac_cv_header_openssl_crypto_h" = x""yes; then :
+if test "x$ac_cv_header_openssl_crypto_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_OPENSSL_CRYPTO_H 1
 _ACEOF
@@ -28887,7 +30187,7 @@
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
       ac_fn_c_check_header_mongrel "$LINENO" "gcrypt.h" "ac_cv_header_gcrypt_h" "$ac_includes_default"
-if test "x$ac_cv_header_gcrypt_h" = x""yes; then :
+if test "x$ac_cv_header_gcrypt_h" = xyes; then :
 
 
 $as_echo "#define HAVE_CURL_GNUTLS 1" >>confdefs.h
@@ -29013,7 +30313,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for curl_easy_perform in -lcurl" >&5
 $as_echo_n "checking for curl_easy_perform in -lcurl... " >&6; }
-if test "${ac_cv_lib_curl_curl_easy_perform+set}" = set; then :
+if ${ac_cv_lib_curl_curl_easy_perform+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -29047,7 +30347,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_curl_curl_easy_perform" >&5
 $as_echo "$ac_cv_lib_curl_curl_easy_perform" >&6; }
-if test "x$ac_cv_lib_curl_curl_easy_perform" = x""yes; then :
+if test "x$ac_cv_lib_curl_curl_easy_perform" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -29063,7 +30363,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_curl_curl_easy_perform
 
-    as_fn_error "There is something wrong. Please check config.log for more information." "$LINENO" 5
+    as_fn_error $? "There is something wrong. Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -29168,7 +30468,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for curl_version_info in -lcurl" >&5
 $as_echo_n "checking for curl_version_info in -lcurl... " >&6; }
-if test "${ac_cv_lib_curl_curl_version_info+set}" = set; then :
+if ${ac_cv_lib_curl_curl_version_info+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -29202,7 +30502,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_curl_curl_version_info" >&5
 $as_echo "$ac_cv_lib_curl_curl_version_info" >&6; }
-if test "x$ac_cv_lib_curl_curl_version_info" = x""yes; then :
+if test "x$ac_cv_lib_curl_curl_version_info" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -29321,7 +30621,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for curl_easy_strerror in -lcurl" >&5
 $as_echo_n "checking for curl_easy_strerror in -lcurl... " >&6; }
-if test "${ac_cv_lib_curl_curl_easy_strerror+set}" = set; then :
+if ${ac_cv_lib_curl_curl_easy_strerror+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -29355,7 +30655,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_curl_curl_easy_strerror" >&5
 $as_echo "$ac_cv_lib_curl_curl_easy_strerror" >&6; }
-if test "x$ac_cv_lib_curl_curl_easy_strerror" = x""yes; then :
+if test "x$ac_cv_lib_curl_curl_easy_strerror" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -29474,7 +30774,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for curl_multi_strerror in -lcurl" >&5
 $as_echo_n "checking for curl_multi_strerror in -lcurl... " >&6; }
-if test "${ac_cv_lib_curl_curl_multi_strerror+set}" = set; then :
+if ${ac_cv_lib_curl_curl_multi_strerror+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -29508,7 +30808,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_curl_curl_multi_strerror" >&5
 $as_echo "$ac_cv_lib_curl_curl_multi_strerror" >&6; }
-if test "x$ac_cv_lib_curl_curl_multi_strerror" = x""yes; then :
+if test "x$ac_cv_lib_curl_curl_multi_strerror" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -30202,7 +31502,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$LIB''_dpopen" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dpopen in -l$LIB" >&5
 $as_echo_n "checking for dpopen in -l$LIB... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -30237,8 +31537,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -30277,10 +31576,10 @@
 
   THIS_RESULT=yes
   if test -z "$THIS_INCLUDE"; then
-    as_fn_error "DBA: Could not find necessary header file(s)." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary header file(s)." "$LINENO" 5
   fi
   if test -z "$THIS_LIBS"; then
-    as_fn_error "DBA: Could not find necessary library." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary library." "$LINENO" 5
   fi
 
 
@@ -30394,7 +31693,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -30424,7 +31723,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n "You cannot combine --with-gdbm with --with-qdbm"; then
-    as_fn_error "You cannot combine --with-gdbm with --with-qdbm" "$LINENO" 5
+    as_fn_error $? "You cannot combine --with-gdbm with --with-qdbm" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -30544,7 +31843,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdbm_open in -lgdbm" >&5
 $as_echo_n "checking for gdbm_open in -lgdbm... " >&6; }
-if test "${ac_cv_lib_gdbm_gdbm_open+set}" = set; then :
+if ${ac_cv_lib_gdbm_gdbm_open+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -30578,7 +31877,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gdbm_gdbm_open" >&5
 $as_echo "$ac_cv_lib_gdbm_gdbm_open" >&6; }
-if test "x$ac_cv_lib_gdbm_gdbm_open" = x""yes; then :
+if test "x$ac_cv_lib_gdbm_gdbm_open" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -30613,10 +31912,10 @@
 
   THIS_RESULT=yes
   if test -z "$THIS_INCLUDE"; then
-    as_fn_error "DBA: Could not find necessary header file(s)." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary header file(s)." "$LINENO" 5
   fi
   if test -z "$THIS_LIBS"; then
-    as_fn_error "DBA: Could not find necessary library." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary library." "$LINENO" 5
   fi
 
 
@@ -30730,7 +32029,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -30861,7 +32160,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$LIB''_dbm_open" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dbm_open in -l$LIB" >&5
 $as_echo_n "checking for dbm_open in -l$LIB... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -30896,8 +32195,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -30936,10 +32234,10 @@
 
   THIS_RESULT=yes
   if test -z "$THIS_INCLUDE"; then
-    as_fn_error "DBA: Could not find necessary header file(s)." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary header file(s)." "$LINENO" 5
   fi
   if test -z "$THIS_LIBS"; then
-    as_fn_error "DBA: Could not find necessary library." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary library." "$LINENO" 5
   fi
 
 
@@ -31053,7 +32351,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -31210,7 +32508,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$LIB''_tcadbopen" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tcadbopen in -l$LIB" >&5
 $as_echo_n "checking for tcadbopen in -l$LIB... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -31245,8 +32543,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -31285,10 +32582,10 @@
 
   THIS_RESULT=yes
   if test -z "$THIS_INCLUDE"; then
-    as_fn_error "DBA: Could not find necessary header file(s)." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary header file(s)." "$LINENO" 5
   fi
   if test -z "$THIS_LIBS"; then
-    as_fn_error "DBA: Could not find necessary library." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary library." "$LINENO" 5
   fi
 
 
@@ -31402,7 +32699,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -31478,7 +32775,7 @@
   done
 
   if test -z "$THIS_INCLUDE"; then
-    as_fn_error "DBA: Could not find necessary header file(s)." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary header file(s)." "$LINENO" 5
   fi
   for LIB in db-5.1 db-5.0 db-4.8 db-4.7 db-4.6 db-4.5 db-4.4 db-4.3 db-4.2 db-4.1 db-4.0 db-4 db4 db; do
     if test -f $THIS_PREFIX/$PHP_LIBDIR/lib$LIB.a || test -f $THIS_PREFIX/$PHP_LIBDIR/lib$LIB.$SHLIB_SUFFIX_NAME; then
@@ -31541,7 +32838,7 @@
   if test -z "$THIS_LIBS"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for DB4 major version" >&5
 $as_echo_n "checking for DB4 major version... " >&6; }
-    as_fn_error "Header contains different version" "$LINENO" 5
+    as_fn_error $? "Header contains different version" "$LINENO" 5
   fi
   if test "4" = "4"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for DB4 minor version and patch level" >&5
@@ -31563,7 +32860,7 @@
 
 else
 
-      as_fn_error "Version 4.1 requires patch level 25" "$LINENO" 5
+      as_fn_error $? "Version 4.1 requires patch level 25" "$LINENO" 5
 
 fi
 rm -f conftest*
@@ -31589,7 +32886,7 @@
 
 else
 
-      as_fn_error "At least version 3.3 is required" "$LINENO" 5
+      as_fn_error $? "At least version 3.3 is required" "$LINENO" 5
 
 fi
 rm -f conftest*
@@ -31607,7 +32904,7 @@
 
     fi
   else
-    as_fn_error "DBA: Could not find necessary library." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary library." "$LINENO" 5
   fi
   THIS_RESULT=yes
   DB4_LIBS=$THIS_LIBS
@@ -31730,7 +33027,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -31760,7 +33057,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n "You cannot combine --with-db3 with --with-db4"; then
-    as_fn_error "You cannot combine --with-db3 with --with-db4" "$LINENO" 5
+    as_fn_error $? "You cannot combine --with-db3 with --with-db4" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -31799,7 +33096,7 @@
   done
 
   if test -z "$THIS_INCLUDE"; then
-    as_fn_error "DBA: Could not find necessary header file(s)." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary header file(s)." "$LINENO" 5
   fi
   for LIB in db-3.3 db-3.2 db-3.1 db-3.0 db-3 db3 db; do
     if test -f $THIS_PREFIX/$PHP_LIBDIR/lib$LIB.a || test -f $THIS_PREFIX/$PHP_LIBDIR/lib$LIB.$SHLIB_SUFFIX_NAME; then
@@ -31862,7 +33159,7 @@
   if test -z "$THIS_LIBS"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for DB3 major version" >&5
 $as_echo_n "checking for DB3 major version... " >&6; }
-    as_fn_error "Header contains different version" "$LINENO" 5
+    as_fn_error $? "Header contains different version" "$LINENO" 5
   fi
   if test "3" = "4"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for DB4 minor version and patch level" >&5
@@ -31884,7 +33181,7 @@
 
 else
 
-      as_fn_error "Version 4.1 requires patch level 25" "$LINENO" 5
+      as_fn_error $? "Version 4.1 requires patch level 25" "$LINENO" 5
 
 fi
 rm -f conftest*
@@ -31910,7 +33207,7 @@
 
 else
 
-      as_fn_error "At least version 3.3 is required" "$LINENO" 5
+      as_fn_error $? "At least version 3.3 is required" "$LINENO" 5
 
 fi
 rm -f conftest*
@@ -31928,7 +33225,7 @@
 
     fi
   else
-    as_fn_error "DBA: Could not find necessary library." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary library." "$LINENO" 5
   fi
   THIS_RESULT=yes
   DB3_LIBS=$THIS_LIBS
@@ -32051,7 +33348,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -32081,7 +33378,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n "You cannot combine --with-db2 with --with-db3 or --with-db4"; then
-    as_fn_error "You cannot combine --with-db2 with --with-db3 or --with-db4" "$LINENO" 5
+    as_fn_error $? "You cannot combine --with-db2 with --with-db3 or --with-db4" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -32120,7 +33417,7 @@
   done
 
   if test -z "$THIS_INCLUDE"; then
-    as_fn_error "DBA: Could not find necessary header file(s)." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary header file(s)." "$LINENO" 5
   fi
   for LIB in db-2 db2 db; do
     if test -f $THIS_PREFIX/$PHP_LIBDIR/lib$LIB.a || test -f $THIS_PREFIX/$PHP_LIBDIR/lib$LIB.$SHLIB_SUFFIX_NAME; then
@@ -32183,7 +33480,7 @@
   if test -z "$THIS_LIBS"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for DB2 major version" >&5
 $as_echo_n "checking for DB2 major version... " >&6; }
-    as_fn_error "Header contains different version" "$LINENO" 5
+    as_fn_error $? "Header contains different version" "$LINENO" 5
   fi
   if test "2" = "4"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for DB4 minor version and patch level" >&5
@@ -32205,7 +33502,7 @@
 
 else
 
-      as_fn_error "Version 4.1 requires patch level 25" "$LINENO" 5
+      as_fn_error $? "Version 4.1 requires patch level 25" "$LINENO" 5
 
 fi
 rm -f conftest*
@@ -32231,7 +33528,7 @@
 
 else
 
-      as_fn_error "At least version 3.3 is required" "$LINENO" 5
+      as_fn_error $? "At least version 3.3 is required" "$LINENO" 5
 
 fi
 rm -f conftest*
@@ -32249,7 +33546,7 @@
 
     fi
   else
-    as_fn_error "DBA: Could not find necessary library." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary library." "$LINENO" 5
   fi
   THIS_RESULT=yes
   DB2_LIBS=$THIS_LIBS
@@ -32372,7 +33669,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -32500,10 +33797,10 @@
 
   THIS_RESULT=yes
   if test -z "$THIS_INCLUDE"; then
-    as_fn_error "DBA: Could not find necessary header file(s)." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary header file(s)." "$LINENO" 5
   fi
   if test -z "$THIS_LIBS"; then
-    as_fn_error "DBA: Could not find necessary library." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary library." "$LINENO" 5
   fi
 
 
@@ -32617,7 +33914,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -32647,7 +33944,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n "You cannot combine --with-dbm with --with-qdbm"; then
-    as_fn_error "You cannot combine --with-dbm with --with-qdbm" "$LINENO" 5
+    as_fn_error $? "You cannot combine --with-dbm with --with-qdbm" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -32773,7 +34070,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$LIB''_dbminit" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dbminit in -l$LIB" >&5
 $as_echo_n "checking for dbminit in -l$LIB... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -32808,8 +34105,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -32867,10 +34163,10 @@
 
   THIS_RESULT=yes
   if test -z "$THIS_INCLUDE"; then
-    as_fn_error "DBA: Could not find necessary header file(s)." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary header file(s)." "$LINENO" 5
   fi
   if test -z "$THIS_LIBS"; then
-    as_fn_error "DBA: Could not find necessary library." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary library." "$LINENO" 5
   fi
 
 
@@ -32984,7 +34280,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -33193,7 +34489,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$LIB''_cdb_read" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for cdb_read in -l$LIB" >&5
 $as_echo_n "checking for cdb_read in -l$LIB... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -33228,8 +34524,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -33268,10 +34563,10 @@
 
   THIS_RESULT=yes
   if test -z "$THIS_INCLUDE"; then
-    as_fn_error "DBA: Could not find necessary header file(s)." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary header file(s)." "$LINENO" 5
   fi
   if test -z "$THIS_LIBS"; then
-    as_fn_error "DBA: Could not find necessary library." "$LINENO" 5
+    as_fn_error $? "DBA: Could not find necessary library." "$LINENO" 5
   fi
 
 
@@ -33385,7 +34680,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -33417,7 +34712,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -33449,7 +34744,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $THIS_FULL_NAME support" >&5
 $as_echo_n "checking for $THIS_FULL_NAME support... " >&6; }
   if test -n ""; then
-    as_fn_error "" "$LINENO" 5
+    as_fn_error $? "" "$LINENO" 5
   fi
   if test "$THIS_RESULT" = "yes" || test "$THIS_RESULT" = "builtin"; then
     HAVE_DBA=1
@@ -33866,13 +35161,13 @@
 if test "$PHP_DOM" != "no"; then
 
   if test "$PHP_LIBXML" = "no"; then
-    as_fn_error "DOM extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
+    as_fn_error $? "DOM extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
   fi
 
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for xml2-config path" >&5
 $as_echo_n "checking for xml2-config path... " >&6; }
-if test "${ac_cv_php_xml2_config_path+set}" = set; then :
+if ${ac_cv_php_xml2_config_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -34030,7 +35325,7 @@
 
             { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether libxml build works" >&5
 $as_echo_n "checking whether libxml build works... " >&6; }
-if test "${php_cv_libxml_build_works+set}" = set; then :
+if ${php_cv_libxml_build_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -34068,7 +35363,7 @@
 
           { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-          as_fn_error "build test failed.  Please check the config.log for details." "$LINENO" 5
+          as_fn_error $? "build test failed.  Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -34445,7 +35740,7 @@
   is_it_shared=$PHP_LIBXML_SHARED
   is_it_enabled=$PHP_LIBXML
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension dom to build statically, but it
 depends on extension libxml, which you've configured to build shared.
 You either need to build dom shared or build libxml statically for the
@@ -34453,7 +35748,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension dom, which depends on extension libxml,
 but you've either not enabled libxml, or have disabled it.
 " "$LINENO" 5
@@ -34461,10 +35756,10 @@
 
 
     else
-      as_fn_error "libxml2 version 2.6.11 or greater required." "$LINENO" 5
+      as_fn_error $? "libxml2 version 2.6.11 or greater required." "$LINENO" 5
     fi
 else
-    as_fn_error "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
+    as_fn_error $? "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
 
   fi
 
@@ -34826,7 +36121,7 @@
 	done
 
 	if test -z "$ENCHANT_DIR"; then
-		as_fn_error "Cannot find enchant" "$LINENO" 5
+		as_fn_error $? "Cannot find enchant" "$LINENO" 5
 	fi
 
 	ENCHANT_LIBDIR=$ENCHANT_DIR/lib
@@ -35062,7 +36357,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for enchant_broker_set_param in -lenchant" >&5
 $as_echo_n "checking for enchant_broker_set_param in -lenchant... " >&6; }
-if test "${ac_cv_lib_enchant_enchant_broker_set_param+set}" = set; then :
+if ${ac_cv_lib_enchant_enchant_broker_set_param+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -35096,7 +36391,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_enchant_enchant_broker_set_param" >&5
 $as_echo "$ac_cv_lib_enchant_enchant_broker_set_param" >&6; }
-if test "x$ac_cv_lib_enchant_enchant_broker_set_param" = x""yes; then :
+if test "x$ac_cv_lib_enchant_enchant_broker_set_param" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -35822,8 +37117,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -36280,7 +37574,7 @@
   is_it_shared=$PHP_PCRE_SHARED
   is_it_enabled=$PHP_PCRE
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension filter to build statically, but it
 depends on extension pcre, which you've configured to build shared.
 You either need to build filter shared or build pcre statically for the
@@ -36288,7 +37582,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension filter, which depends on extension pcre,
 but you've either not enabled pcre, or have disabled it.
 " "$LINENO" 5
@@ -36685,7 +37979,7 @@
 set dummy pkg-config; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_PKG_CONFIG+set}" = set; then :
+if ${ac_cv_path_PKG_CONFIG+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $PKG_CONFIG in
@@ -36731,7 +38025,7 @@
       OPENSSL_INCS=`$PKG_CONFIG --cflags-only-I openssl`
       OPENSSL_INCDIR=`$PKG_CONFIG --variable=includedir openssl`
     else
-      as_fn_error "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
+      as_fn_error $? "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
     fi
 
     if test -n "$OPENSSL_LIBS"; then
@@ -36886,11 +38180,11 @@
     done
 
     if test -z "$OPENSSL_INCDIR"; then
-      as_fn_error "Cannot find OpenSSL's <evp.h>" "$LINENO" 5
+      as_fn_error $? "Cannot find OpenSSL's <evp.h>" "$LINENO" 5
     fi
 
     if test -z "$OPENSSL_LIBDIR"; then
-      as_fn_error "Cannot find OpenSSL's libraries" "$LINENO" 5
+      as_fn_error $? "Cannot find OpenSSL's libraries" "$LINENO" 5
     fi
 
     old_CPPFLAGS=$CPPFLAGS
@@ -36914,7 +38208,7 @@
 
 else
 
-      as_fn_error "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
+      as_fn_error $? "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
 
 fi
 rm -f conftest*
@@ -37052,7 +38346,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CRYPTO_free in -lcrypto" >&5
 $as_echo_n "checking for CRYPTO_free in -lcrypto... " >&6; }
-if test "${ac_cv_lib_crypto_CRYPTO_free+set}" = set; then :
+if ${ac_cv_lib_crypto_CRYPTO_free+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -37086,7 +38380,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_crypto_CRYPTO_free" >&5
 $as_echo "$ac_cv_lib_crypto_CRYPTO_free" >&6; }
-if test "x$ac_cv_lib_crypto_CRYPTO_free" = x""yes; then :
+if test "x$ac_cv_lib_crypto_CRYPTO_free" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -37122,7 +38416,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_crypto_CRYPTO_free
 
-      as_fn_error "libcrypto not found!" "$LINENO" 5
+      as_fn_error $? "libcrypto not found!" "$LINENO" 5
 
 
 fi
@@ -37229,7 +38523,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SSL_CTX_set_ssl_version in -lssl" >&5
 $as_echo_n "checking for SSL_CTX_set_ssl_version in -lssl... " >&6; }
-if test "${ac_cv_lib_ssl_SSL_CTX_set_ssl_version+set}" = set; then :
+if ${ac_cv_lib_ssl_SSL_CTX_set_ssl_version+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -37263,7 +38557,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ssl_SSL_CTX_set_ssl_version" >&5
 $as_echo "$ac_cv_lib_ssl_SSL_CTX_set_ssl_version" >&6; }
-if test "x$ac_cv_lib_ssl_SSL_CTX_set_ssl_version" = x""yes; then :
+if test "x$ac_cv_lib_ssl_SSL_CTX_set_ssl_version" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -37277,7 +38571,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_ssl_SSL_CTX_set_ssl_version
 
-      as_fn_error "libssl not found!" "$LINENO" 5
+      as_fn_error $? "libssl not found!" "$LINENO" 5
 
 
 fi
@@ -37689,8 +38983,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -37710,7 +39003,7 @@
 			PHP_ZLIB_DIR="$PHP_ZLIB_DIR"
 			PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/include"
 		else
-			as_fn_error "Can't find zlib headers under \"$PHP_ZLIB_DIR\"" "$LINENO" 5
+			as_fn_error $? "Can't find zlib headers under \"$PHP_ZLIB_DIR\"" "$LINENO" 5
 		fi
 	else
 		for i in /usr/local /usr; do
@@ -37744,7 +39037,7 @@
     done
 
     if test -z "$GD_JPEG_DIR"; then
-      as_fn_error "jpeglib.h not found." "$LINENO" 5
+      as_fn_error $? "jpeglib.h not found." "$LINENO" 5
     fi
 
 
@@ -37846,7 +39139,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for jpeg_read_header in -ljpeg" >&5
 $as_echo_n "checking for jpeg_read_header in -ljpeg... " >&6; }
-if test "${ac_cv_lib_jpeg_jpeg_read_header+set}" = set; then :
+if ${ac_cv_lib_jpeg_jpeg_read_header+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -37880,7 +39173,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_jpeg_jpeg_read_header" >&5
 $as_echo "$ac_cv_lib_jpeg_jpeg_read_header" >&6; }
-if test "x$ac_cv_lib_jpeg_jpeg_read_header" = x""yes; then :
+if test "x$ac_cv_lib_jpeg_jpeg_read_header" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -38021,7 +39314,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_jpeg_jpeg_read_header
 
-      as_fn_error "Problem with libjpeg.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libjpeg.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -38039,7 +39332,7 @@
     done
 
     if test -z "$GD_VPX_DIR"; then
-      as_fn_error "vpx_codec.h not found." "$LINENO" 5
+      as_fn_error $? "vpx_codec.h not found." "$LINENO" 5
     fi
 
 
@@ -38141,7 +39434,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for vpx_codec_destroy in -lvpx" >&5
 $as_echo_n "checking for vpx_codec_destroy in -lvpx... " >&6; }
-if test "${ac_cv_lib_vpx_vpx_codec_destroy+set}" = set; then :
+if ${ac_cv_lib_vpx_vpx_codec_destroy+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -38175,7 +39468,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_vpx_vpx_codec_destroy" >&5
 $as_echo "$ac_cv_lib_vpx_vpx_codec_destroy" >&6; }
-if test "x$ac_cv_lib_vpx_vpx_codec_destroy" = x""yes; then :
+if test "x$ac_cv_lib_vpx_vpx_codec_destroy" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -38326,7 +39619,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_vpx_vpx_codec_destroy
 
-      as_fn_error "Problem with libvpx.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libvpx.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -38344,11 +39637,11 @@
     done
 
     if test -z "$GD_PNG_DIR"; then
-      as_fn_error "png.h not found." "$LINENO" 5
+      as_fn_error $? "png.h not found." "$LINENO" 5
     fi
 
     if test "$PHP_ZLIB_DIR" = "no"; then
-      as_fn_error "PNG support requires ZLIB. Use --with-zlib-dir=<DIR>" "$LINENO" 5
+      as_fn_error $? "PNG support requires ZLIB. Use --with-zlib-dir=<DIR>" "$LINENO" 5
     fi
 
 
@@ -38450,7 +39743,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for png_write_image in -lpng" >&5
 $as_echo_n "checking for png_write_image in -lpng... " >&6; }
-if test "${ac_cv_lib_png_png_write_image+set}" = set; then :
+if ${ac_cv_lib_png_png_write_image+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -38484,7 +39777,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_png_png_write_image" >&5
 $as_echo "$ac_cv_lib_png_png_write_image" >&6; }
-if test "x$ac_cv_lib_png_png_write_image" = x""yes; then :
+if test "x$ac_cv_lib_png_png_write_image" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -38722,7 +40015,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_png_png_write_image
 
-      as_fn_error "Problem with libpng.(a|so) or libz.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libpng.(a|so) or libz.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -38741,7 +40034,7 @@
     done
 
     if test -z "$GD_XPM_DIR"; then
-      as_fn_error "libXpm.(a|so) not found." "$LINENO" 5
+      as_fn_error $? "libXpm.(a|so) not found." "$LINENO" 5
     fi
 
     for i in include include/X11; do
@@ -38749,7 +40042,7 @@
     done
 
     if test -z "$GD_XPM_INC"; then
-      as_fn_error "xpm.h not found." "$LINENO" 5
+      as_fn_error $? "xpm.h not found." "$LINENO" 5
     fi
 
 
@@ -38851,7 +40144,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for XpmFreeXpmImage in -lXpm" >&5
 $as_echo_n "checking for XpmFreeXpmImage in -lXpm... " >&6; }
-if test "${ac_cv_lib_Xpm_XpmFreeXpmImage+set}" = set; then :
+if ${ac_cv_lib_Xpm_XpmFreeXpmImage+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -38885,7 +40178,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_Xpm_XpmFreeXpmImage" >&5
 $as_echo "$ac_cv_lib_Xpm_XpmFreeXpmImage" >&6; }
-if test "x$ac_cv_lib_Xpm_XpmFreeXpmImage" = x""yes; then :
+if test "x$ac_cv_lib_Xpm_XpmFreeXpmImage" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -39123,7 +40416,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_Xpm_XpmFreeXpmImage
 
-      as_fn_error "Problem with libXpm.(a|so) or libX11.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libXpm.(a|so) or libX11.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -39145,7 +40438,7 @@
     done
 
     if test -z "$FREETYPE2_DIR"; then
-      as_fn_error "freetype.h not found." "$LINENO" 5
+      as_fn_error $? "freetype.h not found." "$LINENO" 5
     fi
 
 
@@ -39247,7 +40540,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for FT_New_Face in -lfreetype" >&5
 $as_echo_n "checking for FT_New_Face in -lfreetype... " >&6; }
-if test "${ac_cv_lib_freetype_FT_New_Face+set}" = set; then :
+if ${ac_cv_lib_freetype_FT_New_Face+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -39281,7 +40574,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_freetype_FT_New_Face" >&5
 $as_echo "$ac_cv_lib_freetype_FT_New_Face" >&6; }
-if test "x$ac_cv_lib_freetype_FT_New_Face" = x""yes; then :
+if test "x$ac_cv_lib_freetype_FT_New_Face" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -39462,7 +40755,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_freetype_FT_New_Face
 
-      as_fn_error "Problem with freetype.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with freetype.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -39480,7 +40773,7 @@
     done
 
     if test -z "$GD_T1_DIR"; then
-      as_fn_error "Your t1lib distribution is not installed correctly. Please reinstall it." "$LINENO" 5
+      as_fn_error $? "Your t1lib distribution is not installed correctly. Please reinstall it." "$LINENO" 5
     fi
 
 
@@ -39582,7 +40875,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for T1_StrError in -lt1" >&5
 $as_echo_n "checking for T1_StrError in -lt1... " >&6; }
-if test "${ac_cv_lib_t1_T1_StrError+set}" = set; then :
+if ${ac_cv_lib_t1_T1_StrError+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -39616,7 +40909,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_t1_T1_StrError" >&5
 $as_echo "$ac_cv_lib_t1_T1_StrError" >&6; }
-if test "x$ac_cv_lib_t1_T1_StrError" = x""yes; then :
+if test "x$ac_cv_lib_t1_T1_StrError" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -39760,7 +41053,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_t1_T1_StrError
 
-      as_fn_error "Problem with libt1.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libt1.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -39892,7 +41185,7 @@
 			PHP_ZLIB_DIR="$PHP_ZLIB_DIR"
 			PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/include"
 		else
-			as_fn_error "Can't find zlib headers under \"$PHP_ZLIB_DIR\"" "$LINENO" 5
+			as_fn_error $? "Can't find zlib headers under \"$PHP_ZLIB_DIR\"" "$LINENO" 5
 		fi
 	else
 		for i in /usr/local /usr; do
@@ -39921,7 +41214,7 @@
     done
 
     if test -z "$GD_VPX_DIR"; then
-      as_fn_error "vpx_codec.h not found." "$LINENO" 5
+      as_fn_error $? "vpx_codec.h not found." "$LINENO" 5
     fi
 
 
@@ -40023,7 +41316,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for vpx_codec_destroy in -lvpx" >&5
 $as_echo_n "checking for vpx_codec_destroy in -lvpx... " >&6; }
-if test "${ac_cv_lib_vpx_vpx_codec_destroy+set}" = set; then :
+if ${ac_cv_lib_vpx_vpx_codec_destroy+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -40057,7 +41350,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_vpx_vpx_codec_destroy" >&5
 $as_echo "$ac_cv_lib_vpx_vpx_codec_destroy" >&6; }
-if test "x$ac_cv_lib_vpx_vpx_codec_destroy" = x""yes; then :
+if test "x$ac_cv_lib_vpx_vpx_codec_destroy" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -40208,7 +41501,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_vpx_vpx_codec_destroy
 
-      as_fn_error "Problem with libvpx.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libvpx.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -40226,7 +41519,7 @@
     done
 
     if test -z "$GD_JPEG_DIR"; then
-      as_fn_error "jpeglib.h not found." "$LINENO" 5
+      as_fn_error $? "jpeglib.h not found." "$LINENO" 5
     fi
 
 
@@ -40328,7 +41621,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for jpeg_read_header in -ljpeg" >&5
 $as_echo_n "checking for jpeg_read_header in -ljpeg... " >&6; }
-if test "${ac_cv_lib_jpeg_jpeg_read_header+set}" = set; then :
+if ${ac_cv_lib_jpeg_jpeg_read_header+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -40362,7 +41655,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_jpeg_jpeg_read_header" >&5
 $as_echo "$ac_cv_lib_jpeg_jpeg_read_header" >&6; }
-if test "x$ac_cv_lib_jpeg_jpeg_read_header" = x""yes; then :
+if test "x$ac_cv_lib_jpeg_jpeg_read_header" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -40503,7 +41796,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_jpeg_jpeg_read_header
 
-      as_fn_error "Problem with libjpeg.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libjpeg.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -40521,11 +41814,11 @@
     done
 
     if test -z "$GD_PNG_DIR"; then
-      as_fn_error "png.h not found." "$LINENO" 5
+      as_fn_error $? "png.h not found." "$LINENO" 5
     fi
 
     if test "$PHP_ZLIB_DIR" = "no"; then
-      as_fn_error "PNG support requires ZLIB. Use --with-zlib-dir=<DIR>" "$LINENO" 5
+      as_fn_error $? "PNG support requires ZLIB. Use --with-zlib-dir=<DIR>" "$LINENO" 5
     fi
 
 
@@ -40627,7 +41920,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for png_write_image in -lpng" >&5
 $as_echo_n "checking for png_write_image in -lpng... " >&6; }
-if test "${ac_cv_lib_png_png_write_image+set}" = set; then :
+if ${ac_cv_lib_png_png_write_image+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -40661,7 +41954,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_png_png_write_image" >&5
 $as_echo "$ac_cv_lib_png_png_write_image" >&6; }
-if test "x$ac_cv_lib_png_png_write_image" = x""yes; then :
+if test "x$ac_cv_lib_png_png_write_image" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -40899,7 +42192,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_png_png_write_image
 
-      as_fn_error "Problem with libpng.(a|so) or libz.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libpng.(a|so) or libz.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -40918,7 +42211,7 @@
     done
 
     if test -z "$GD_XPM_DIR"; then
-      as_fn_error "libXpm.(a|so) not found." "$LINENO" 5
+      as_fn_error $? "libXpm.(a|so) not found." "$LINENO" 5
     fi
 
     for i in include include/X11; do
@@ -40926,7 +42219,7 @@
     done
 
     if test -z "$GD_XPM_INC"; then
-      as_fn_error "xpm.h not found." "$LINENO" 5
+      as_fn_error $? "xpm.h not found." "$LINENO" 5
     fi
 
 
@@ -41028,7 +42321,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for XpmFreeXpmImage in -lXpm" >&5
 $as_echo_n "checking for XpmFreeXpmImage in -lXpm... " >&6; }
-if test "${ac_cv_lib_Xpm_XpmFreeXpmImage+set}" = set; then :
+if ${ac_cv_lib_Xpm_XpmFreeXpmImage+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -41062,7 +42355,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_Xpm_XpmFreeXpmImage" >&5
 $as_echo "$ac_cv_lib_Xpm_XpmFreeXpmImage" >&6; }
-if test "x$ac_cv_lib_Xpm_XpmFreeXpmImage" = x""yes; then :
+if test "x$ac_cv_lib_Xpm_XpmFreeXpmImage" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -41300,7 +42593,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_Xpm_XpmFreeXpmImage
 
-      as_fn_error "Problem with libXpm.(a|so) or libX11.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libXpm.(a|so) or libX11.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -41322,7 +42615,7 @@
     done
 
     if test -z "$FREETYPE2_DIR"; then
-      as_fn_error "freetype.h not found." "$LINENO" 5
+      as_fn_error $? "freetype.h not found." "$LINENO" 5
     fi
 
 
@@ -41424,7 +42717,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for FT_New_Face in -lfreetype" >&5
 $as_echo_n "checking for FT_New_Face in -lfreetype... " >&6; }
-if test "${ac_cv_lib_freetype_FT_New_Face+set}" = set; then :
+if ${ac_cv_lib_freetype_FT_New_Face+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -41458,7 +42751,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_freetype_FT_New_Face" >&5
 $as_echo "$ac_cv_lib_freetype_FT_New_Face" >&6; }
-if test "x$ac_cv_lib_freetype_FT_New_Face" = x""yes; then :
+if test "x$ac_cv_lib_freetype_FT_New_Face" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -41639,7 +42932,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_freetype_FT_New_Face
 
-      as_fn_error "Problem with freetype.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with freetype.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -41657,7 +42950,7 @@
     done
 
     if test -z "$GD_T1_DIR"; then
-      as_fn_error "Your t1lib distribution is not installed correctly. Please reinstall it." "$LINENO" 5
+      as_fn_error $? "Your t1lib distribution is not installed correctly. Please reinstall it." "$LINENO" 5
     fi
 
 
@@ -41759,7 +43052,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for T1_StrError in -lt1" >&5
 $as_echo_n "checking for T1_StrError in -lt1... " >&6; }
-if test "${ac_cv_lib_t1_T1_StrError+set}" = set; then :
+if ${ac_cv_lib_t1_T1_StrError+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -41793,7 +43086,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_t1_T1_StrError" >&5
 $as_echo "$ac_cv_lib_t1_T1_StrError" >&6; }
-if test "x$ac_cv_lib_t1_T1_StrError" = x""yes; then :
+if test "x$ac_cv_lib_t1_T1_StrError" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -41937,7 +43230,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_t1_T1_StrError
 
-      as_fn_error "Problem with libt1.(a|so). Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libt1.(a|so). Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -42152,7 +43445,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageString16 in -lgd" >&5
 $as_echo_n "checking for gdImageString16 in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageString16+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageString16+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -42186,7 +43479,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageString16" >&5
 $as_echo "$ac_cv_lib_gd_gdImageString16" >&6; }
-if test "x$ac_cv_lib_gd_gdImageString16" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageString16" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -42300,7 +43593,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImagePaletteCopy in -lgd" >&5
 $as_echo_n "checking for gdImagePaletteCopy in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImagePaletteCopy+set}" = set; then :
+if ${ac_cv_lib_gd_gdImagePaletteCopy+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -42334,7 +43627,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImagePaletteCopy" >&5
 $as_echo "$ac_cv_lib_gd_gdImagePaletteCopy" >&6; }
-if test "x$ac_cv_lib_gd_gdImagePaletteCopy" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImagePaletteCopy" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -42448,7 +43741,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageCreateFromPng in -lgd" >&5
 $as_echo_n "checking for gdImageCreateFromPng in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageCreateFromPng+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageCreateFromPng+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -42482,7 +43775,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageCreateFromPng" >&5
 $as_echo "$ac_cv_lib_gd_gdImageCreateFromPng" >&6; }
-if test "x$ac_cv_lib_gd_gdImageCreateFromPng" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageCreateFromPng" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -42596,7 +43889,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageCreateFromGif in -lgd" >&5
 $as_echo_n "checking for gdImageCreateFromGif in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageCreateFromGif+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageCreateFromGif+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -42630,7 +43923,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageCreateFromGif" >&5
 $as_echo "$ac_cv_lib_gd_gdImageCreateFromGif" >&6; }
-if test "x$ac_cv_lib_gd_gdImageCreateFromGif" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageCreateFromGif" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -42744,7 +44037,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageGif in -lgd" >&5
 $as_echo_n "checking for gdImageGif in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageGif+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageGif+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -42778,7 +44071,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageGif" >&5
 $as_echo "$ac_cv_lib_gd_gdImageGif" >&6; }
-if test "x$ac_cv_lib_gd_gdImageGif" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageGif" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -42892,7 +44185,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageWBMP in -lgd" >&5
 $as_echo_n "checking for gdImageWBMP in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageWBMP+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageWBMP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -42926,7 +44219,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageWBMP" >&5
 $as_echo "$ac_cv_lib_gd_gdImageWBMP" >&6; }
-if test "x$ac_cv_lib_gd_gdImageWBMP" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageWBMP" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -43040,7 +44333,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageCreateFromJpeg in -lgd" >&5
 $as_echo_n "checking for gdImageCreateFromJpeg in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageCreateFromJpeg+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageCreateFromJpeg+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -43074,7 +44367,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageCreateFromJpeg" >&5
 $as_echo "$ac_cv_lib_gd_gdImageCreateFromJpeg" >&6; }
-if test "x$ac_cv_lib_gd_gdImageCreateFromJpeg" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageCreateFromJpeg" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -43188,7 +44481,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageCreateFromXpm in -lgd" >&5
 $as_echo_n "checking for gdImageCreateFromXpm in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageCreateFromXpm+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageCreateFromXpm+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -43222,7 +44515,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageCreateFromXpm" >&5
 $as_echo "$ac_cv_lib_gd_gdImageCreateFromXpm" >&6; }
-if test "x$ac_cv_lib_gd_gdImageCreateFromXpm" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageCreateFromXpm" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -43336,7 +44629,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageCreateFromGd2 in -lgd" >&5
 $as_echo_n "checking for gdImageCreateFromGd2 in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageCreateFromGd2+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageCreateFromGd2+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -43370,7 +44663,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageCreateFromGd2" >&5
 $as_echo "$ac_cv_lib_gd_gdImageCreateFromGd2" >&6; }
-if test "x$ac_cv_lib_gd_gdImageCreateFromGd2" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageCreateFromGd2" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -43484,7 +44777,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageCreateTrueColor in -lgd" >&5
 $as_echo_n "checking for gdImageCreateTrueColor in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageCreateTrueColor+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageCreateTrueColor+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -43518,7 +44811,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageCreateTrueColor" >&5
 $as_echo "$ac_cv_lib_gd_gdImageCreateTrueColor" >&6; }
-if test "x$ac_cv_lib_gd_gdImageCreateTrueColor" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageCreateTrueColor" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -43632,7 +44925,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageSetTile in -lgd" >&5
 $as_echo_n "checking for gdImageSetTile in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageSetTile+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageSetTile+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -43666,7 +44959,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageSetTile" >&5
 $as_echo "$ac_cv_lib_gd_gdImageSetTile" >&6; }
-if test "x$ac_cv_lib_gd_gdImageSetTile" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageSetTile" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -43780,7 +45073,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageEllipse in -lgd" >&5
 $as_echo_n "checking for gdImageEllipse in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageEllipse+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageEllipse+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -43814,7 +45107,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageEllipse" >&5
 $as_echo "$ac_cv_lib_gd_gdImageEllipse" >&6; }
-if test "x$ac_cv_lib_gd_gdImageEllipse" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageEllipse" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -43928,7 +45221,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageSetBrush in -lgd" >&5
 $as_echo_n "checking for gdImageSetBrush in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageSetBrush+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageSetBrush+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -43962,7 +45255,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageSetBrush" >&5
 $as_echo "$ac_cv_lib_gd_gdImageSetBrush" >&6; }
-if test "x$ac_cv_lib_gd_gdImageSetBrush" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageSetBrush" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -44076,7 +45369,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageStringTTF in -lgd" >&5
 $as_echo_n "checking for gdImageStringTTF in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageStringTTF+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageStringTTF+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -44110,7 +45403,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageStringTTF" >&5
 $as_echo "$ac_cv_lib_gd_gdImageStringTTF" >&6; }
-if test "x$ac_cv_lib_gd_gdImageStringTTF" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageStringTTF" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -44224,7 +45517,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageStringFT in -lgd" >&5
 $as_echo_n "checking for gdImageStringFT in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageStringFT+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageStringFT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -44258,7 +45551,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageStringFT" >&5
 $as_echo "$ac_cv_lib_gd_gdImageStringFT" >&6; }
-if test "x$ac_cv_lib_gd_gdImageStringFT" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageStringFT" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -44372,7 +45665,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageStringFTEx in -lgd" >&5
 $as_echo_n "checking for gdImageStringFTEx in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageStringFTEx+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageStringFTEx+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -44406,7 +45699,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageStringFTEx" >&5
 $as_echo "$ac_cv_lib_gd_gdImageStringFTEx" >&6; }
-if test "x$ac_cv_lib_gd_gdImageStringFTEx" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageStringFTEx" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -44520,7 +45813,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageColorClosestHWB in -lgd" >&5
 $as_echo_n "checking for gdImageColorClosestHWB in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageColorClosestHWB+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageColorClosestHWB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -44554,7 +45847,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageColorClosestHWB" >&5
 $as_echo "$ac_cv_lib_gd_gdImageColorClosestHWB" >&6; }
-if test "x$ac_cv_lib_gd_gdImageColorClosestHWB" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageColorClosestHWB" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -44668,7 +45961,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageColorResolve in -lgd" >&5
 $as_echo_n "checking for gdImageColorResolve in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageColorResolve+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageColorResolve+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -44702,7 +45995,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageColorResolve" >&5
 $as_echo "$ac_cv_lib_gd_gdImageColorResolve" >&6; }
-if test "x$ac_cv_lib_gd_gdImageColorResolve" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageColorResolve" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -44816,7 +46109,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageGifCtx in -lgd" >&5
 $as_echo_n "checking for gdImageGifCtx in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageGifCtx+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageGifCtx+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -44850,7 +46143,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageGifCtx" >&5
 $as_echo "$ac_cv_lib_gd_gdImageGifCtx" >&6; }
-if test "x$ac_cv_lib_gd_gdImageGifCtx" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageGifCtx" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -44964,7 +46257,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdCacheCreate in -lgd" >&5
 $as_echo_n "checking for gdCacheCreate in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdCacheCreate+set}" = set; then :
+if ${ac_cv_lib_gd_gdCacheCreate+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -44998,7 +46291,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdCacheCreate" >&5
 $as_echo "$ac_cv_lib_gd_gdCacheCreate" >&6; }
-if test "x$ac_cv_lib_gd_gdCacheCreate" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdCacheCreate" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -45112,7 +46405,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdFontCacheShutdown in -lgd" >&5
 $as_echo_n "checking for gdFontCacheShutdown in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdFontCacheShutdown+set}" = set; then :
+if ${ac_cv_lib_gd_gdFontCacheShutdown+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -45146,7 +46439,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdFontCacheShutdown" >&5
 $as_echo "$ac_cv_lib_gd_gdFontCacheShutdown" >&6; }
-if test "x$ac_cv_lib_gd_gdFontCacheShutdown" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdFontCacheShutdown" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -45260,7 +46553,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdFreeFontCache in -lgd" >&5
 $as_echo_n "checking for gdFreeFontCache in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdFreeFontCache+set}" = set; then :
+if ${ac_cv_lib_gd_gdFreeFontCache+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -45294,7 +46587,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdFreeFontCache" >&5
 $as_echo "$ac_cv_lib_gd_gdFreeFontCache" >&6; }
-if test "x$ac_cv_lib_gd_gdFreeFontCache" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdFreeFontCache" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -45408,7 +46701,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdFontCacheMutexSetup in -lgd" >&5
 $as_echo_n "checking for gdFontCacheMutexSetup in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdFontCacheMutexSetup+set}" = set; then :
+if ${ac_cv_lib_gd_gdFontCacheMutexSetup+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -45442,7 +46735,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdFontCacheMutexSetup" >&5
 $as_echo "$ac_cv_lib_gd_gdFontCacheMutexSetup" >&6; }
-if test "x$ac_cv_lib_gd_gdFontCacheMutexSetup" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdFontCacheMutexSetup" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -45556,7 +46849,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdNewDynamicCtxEx in -lgd" >&5
 $as_echo_n "checking for gdNewDynamicCtxEx in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdNewDynamicCtxEx+set}" = set; then :
+if ${ac_cv_lib_gd_gdNewDynamicCtxEx+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -45590,7 +46883,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdNewDynamicCtxEx" >&5
 $as_echo "$ac_cv_lib_gd_gdNewDynamicCtxEx" >&6; }
-if test "x$ac_cv_lib_gd_gdNewDynamicCtxEx" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdNewDynamicCtxEx" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -45704,7 +46997,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageConvolution in -lgd" >&5
 $as_echo_n "checking for gdImageConvolution in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageConvolution+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageConvolution+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -45738,7 +47031,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageConvolution" >&5
 $as_echo "$ac_cv_lib_gd_gdImageConvolution" >&6; }
-if test "x$ac_cv_lib_gd_gdImageConvolution" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageConvolution" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -45852,7 +47145,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImagePixelate in -lgd" >&5
 $as_echo_n "checking for gdImagePixelate in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImagePixelate+set}" = set; then :
+if ${ac_cv_lib_gd_gdImagePixelate+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -45886,7 +47179,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImagePixelate" >&5
 $as_echo "$ac_cv_lib_gd_gdImagePixelate" >&6; }
-if test "x$ac_cv_lib_gd_gdImagePixelate" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImagePixelate" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -45905,9 +47198,9 @@
 
 
   elif test -z "$GD_INCLUDE"; then
-    as_fn_error "Unable to find gd.h anywhere under $PHP_GD" "$LINENO" 5
+    as_fn_error $? "Unable to find gd.h anywhere under $PHP_GD" "$LINENO" 5
   else
-    as_fn_error "Unable to find libgd.(a|so) anywhere under $PHP_GD" "$LINENO" 5
+    as_fn_error $? "Unable to find libgd.(a|so) anywhere under $PHP_GD" "$LINENO" 5
   fi
 
 
@@ -46288,7 +47581,7 @@
 
     LIBS=$old_LIBS
 
-      as_fn_error "GD build test failed. Please check the config.log for details." "$LINENO" 5
+      as_fn_error $? "GD build test failed. Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -46428,7 +47721,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gdImageCreate in -lgd" >&5
 $as_echo_n "checking for gdImageCreate in -lgd... " >&6; }
-if test "${ac_cv_lib_gd_gdImageCreate+set}" = set; then :
+if ${ac_cv_lib_gd_gdImageCreate+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -46462,7 +47755,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gd_gdImageCreate" >&5
 $as_echo "$ac_cv_lib_gd_gdImageCreate" >&6; }
-if test "x$ac_cv_lib_gd_gdImageCreate" = x""yes; then :
+if test "x$ac_cv_lib_gd_gdImageCreate" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -46474,7 +47767,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_gd_gdImageCreate
 
-      as_fn_error "GD build test failed. Please check the config.log for details." "$LINENO" 5
+      as_fn_error $? "GD build test failed. Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -46559,7 +47852,7 @@
   done
 
   if test -z "$GETTEXT_DIR"; then
-    as_fn_error "Cannot locate header file libintl.h" "$LINENO" 5
+    as_fn_error $? "Cannot locate header file libintl.h" "$LINENO" 5
   fi
 
   GETTEXT_LIBDIR=$GETTEXT_DIR/$PHP_LIBDIR
@@ -46569,7 +47862,7 @@
   LDFLAGS="$LDFLAGS -L$GETTEXT_LIBDIR"
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for bindtextdomain in -lintl" >&5
 $as_echo_n "checking for bindtextdomain in -lintl... " >&6; }
-if test "${ac_cv_lib_intl_bindtextdomain+set}" = set; then :
+if ${ac_cv_lib_intl_bindtextdomain+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -46603,7 +47896,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_intl_bindtextdomain" >&5
 $as_echo "$ac_cv_lib_intl_bindtextdomain" >&6; }
-if test "x$ac_cv_lib_intl_bindtextdomain" = x""yes; then :
+if test "x$ac_cv_lib_intl_bindtextdomain" = xyes; then :
 
 	GETTEXT_LIBS=intl
 	GETTEXT_CHECK_IN_LIB=intl
@@ -46611,7 +47904,7 @@
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for bindtextdomain in -lc" >&5
 $as_echo_n "checking for bindtextdomain in -lc... " >&6; }
-if test "${ac_cv_lib_c_bindtextdomain+set}" = set; then :
+if ${ac_cv_lib_c_bindtextdomain+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -46645,14 +47938,14 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_c_bindtextdomain" >&5
 $as_echo "$ac_cv_lib_c_bindtextdomain" >&6; }
-if test "x$ac_cv_lib_c_bindtextdomain" = x""yes; then :
+if test "x$ac_cv_lib_c_bindtextdomain" = xyes; then :
 
 		GETTEXT_LIBS=
 		GETTEXT_CHECK_IN_LIB=c
 
 else
 
-		as_fn_error "Unable to find required gettext library" "$LINENO" 5
+		as_fn_error $? "Unable to find required gettext library" "$LINENO" 5
 
 fi
 
@@ -47096,7 +48389,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$GETTEXT_CHECK_IN_LIB''_ngettext" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ngettext in -l$GETTEXT_CHECK_IN_LIB" >&5
 $as_echo_n "checking for ngettext in -l$GETTEXT_CHECK_IN_LIB... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -47131,8 +48424,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
 $as_echo "#define HAVE_NGETTEXT 1" >>confdefs.h
 
@@ -47141,7 +48433,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$GETTEXT_CHECK_IN_LIB''_dngettext" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dngettext in -l$GETTEXT_CHECK_IN_LIB" >&5
 $as_echo_n "checking for dngettext in -l$GETTEXT_CHECK_IN_LIB... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -47176,8 +48468,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
 $as_echo "#define HAVE_DNGETTEXT 1" >>confdefs.h
 
@@ -47186,7 +48477,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$GETTEXT_CHECK_IN_LIB''_dcngettext" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dcngettext in -l$GETTEXT_CHECK_IN_LIB" >&5
 $as_echo_n "checking for dcngettext in -l$GETTEXT_CHECK_IN_LIB... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -47221,8 +48512,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
 $as_echo "#define HAVE_DCNGETTEXT 1" >>confdefs.h
 
@@ -47231,7 +48521,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$GETTEXT_CHECK_IN_LIB''_bind_textdomain_codeset" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for bind_textdomain_codeset in -l$GETTEXT_CHECK_IN_LIB" >&5
 $as_echo_n "checking for bind_textdomain_codeset in -l$GETTEXT_CHECK_IN_LIB... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -47266,8 +48556,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
 $as_echo "#define HAVE_BIND_TEXTDOMAIN_CODESET 1" >>confdefs.h
 
@@ -47329,7 +48618,7 @@
   done
 
   if test -z "$GMP_DIR"; then
-    as_fn_error "Unable to locate gmp.h" "$LINENO" 5
+    as_fn_error $? "Unable to locate gmp.h" "$LINENO" 5
   fi
 
 
@@ -47431,7 +48720,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __gmp_randinit_lc_2exp_size in -lgmp" >&5
 $as_echo_n "checking for __gmp_randinit_lc_2exp_size in -lgmp... " >&6; }
-if test "${ac_cv_lib_gmp___gmp_randinit_lc_2exp_size+set}" = set; then :
+if ${ac_cv_lib_gmp___gmp_randinit_lc_2exp_size+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -47465,7 +48754,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gmp___gmp_randinit_lc_2exp_size" >&5
 $as_echo "$ac_cv_lib_gmp___gmp_randinit_lc_2exp_size" >&6; }
-if test "x$ac_cv_lib_gmp___gmp_randinit_lc_2exp_size" = x""yes; then :
+if test "x$ac_cv_lib_gmp___gmp_randinit_lc_2exp_size" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -47576,7 +48865,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for gmp_randinit_lc_2exp_size in -lgmp" >&5
 $as_echo_n "checking for gmp_randinit_lc_2exp_size in -lgmp... " >&6; }
-if test "${ac_cv_lib_gmp_gmp_randinit_lc_2exp_size+set}" = set; then :
+if ${ac_cv_lib_gmp_gmp_randinit_lc_2exp_size+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -47610,7 +48899,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gmp_gmp_randinit_lc_2exp_size" >&5
 $as_echo "$ac_cv_lib_gmp_gmp_randinit_lc_2exp_size" >&6; }
-if test "x$ac_cv_lib_gmp_gmp_randinit_lc_2exp_size" = x""yes; then :
+if test "x$ac_cv_lib_gmp_gmp_randinit_lc_2exp_size" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -47622,7 +48911,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_gmp_gmp_randinit_lc_2exp_size
 
-      as_fn_error "GNU MP Library version 4.1.2 or greater required." "$LINENO" 5
+      as_fn_error $? "GNU MP Library version 4.1.2 or greater required." "$LINENO" 5
 
 
 fi
@@ -48169,7 +49458,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether byte ordering is bigendian" >&5
 $as_echo_n "checking whether byte ordering is bigendian... " >&6; }
-if test "${ac_cv_c_bigendian_php+set}" = set; then :
+if ${ac_cv_c_bigendian_php+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -48219,7 +49508,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of short" >&5
 $as_echo_n "checking size of short... " >&6; }
-if test "${ac_cv_sizeof_short+set}" = set; then :
+if ${ac_cv_sizeof_short+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (short))" "ac_cv_sizeof_short"        "$ac_includes_default"; then :
@@ -48228,9 +49517,8 @@
   if test "$ac_cv_type_short" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (short)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (short)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_short=0
    fi
@@ -48253,7 +49541,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of int" >&5
 $as_echo_n "checking size of int... " >&6; }
-if test "${ac_cv_sizeof_int+set}" = set; then :
+if ${ac_cv_sizeof_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (int))" "ac_cv_sizeof_int"        "$ac_includes_default"; then :
@@ -48262,9 +49550,8 @@
   if test "$ac_cv_type_int" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (int)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (int)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_int=0
    fi
@@ -48287,7 +49574,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long" >&5
 $as_echo_n "checking size of long... " >&6; }
-if test "${ac_cv_sizeof_long+set}" = set; then :
+if ${ac_cv_sizeof_long+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long))" "ac_cv_sizeof_long"        "$ac_includes_default"; then :
@@ -48296,9 +49583,8 @@
   if test "$ac_cv_type_long" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long=0
    fi
@@ -48321,7 +49607,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long long" >&5
 $as_echo_n "checking size of long long... " >&6; }
-if test "${ac_cv_sizeof_long_long+set}" = set; then :
+if ${ac_cv_sizeof_long_long+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long long))" "ac_cv_sizeof_long_long"        "$ac_includes_default"; then :
@@ -48330,9 +49616,8 @@
   if test "$ac_cv_type_long_long" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long long)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long long)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long_long=0
    fi
@@ -48745,14 +50030,14 @@
             LIBS_save="$LIBS"
     LIBS=
     ac_fn_c_check_func "$LINENO" "iconv" "ac_cv_func_iconv"
-if test "x$ac_cv_func_iconv" = x""yes; then :
+if test "x$ac_cv_func_iconv" = xyes; then :
 
       found_iconv=yes
 
 else
 
       ac_fn_c_check_func "$LINENO" "libiconv" "ac_cv_func_libiconv"
-if test "x$ac_cv_func_libiconv" = x""yes; then :
+if test "x$ac_cv_func_libiconv" = xyes; then :
 
 
   echo "#define HAVE_LIBICONV 1" > ext/iconv/php_have_libiconv.h
@@ -48788,7 +50073,7 @@
     done
 
     if test -z "$ICONV_DIR"; then
-      as_fn_error "Please specify the install prefix of iconv with --with-iconv=<DIR>" "$LINENO" 5
+      as_fn_error $? "Please specify the install prefix of iconv with --with-iconv=<DIR>" "$LINENO" 5
     fi
 
     if test -f $ICONV_DIR/$PHP_LIBDIR/lib$iconv_lib_name.a ||
@@ -48894,7 +50179,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$iconv_lib_name''_libiconv" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for libiconv in -l$iconv_lib_name" >&5
 $as_echo_n "checking for libiconv in -l$iconv_lib_name... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -48929,8 +50214,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -49056,7 +50340,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$iconv_lib_name''_iconv" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for iconv in -l$iconv_lib_name" >&5
 $as_echo_n "checking for iconv in -l$iconv_lib_name... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -49091,8 +50375,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -49993,7 +51276,7 @@
 
 
   else
-    as_fn_error "Please reinstall the iconv library." "$LINENO" 5
+    as_fn_error $? "Please reinstall the iconv library." "$LINENO" 5
   fi
 fi
 
@@ -50500,7 +51783,7 @@
     CFLAGS="-I$IMAP_INC_DIR"
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for utf8_mime2text signature" >&5
 $as_echo_n "checking for utf8_mime2text signature... " >&6; }
-if test "${ac_cv_utf8_mime2text+set}" = set; then :
+if ${ac_cv_utf8_mime2text+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -50545,7 +51828,7 @@
     CFLAGS="-I$IMAP_INC_DIR"
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for U8T_DECOMPOSE" >&5
 $as_echo_n "checking for U8T_DECOMPOSE... " >&6; }
-if test "${ac_cv_u8t_canonical+set}" = set; then :
+if ${ac_cv_u8t_canonical+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -50580,10 +51863,10 @@
     CFLAGS=$old_CFLAGS
 
     if test "$ac_cv_u8t_decompose" = "no" && test "$ac_cv_utf8_mime2text" = "new"; then
-		as_fn_error "utf8_mime2text() has new signature, but U8T_CANONICAL is missing. This should not happen. Check config.log for additional information." "$LINENO" 5
+		as_fn_error $? "utf8_mime2text() has new signature, but U8T_CANONICAL is missing. This should not happen. Check config.log for additional information." "$LINENO" 5
     fi
     if test "$ac_cv_u8t_decompose" = "yes" && test "$ac_cv_utf8_mime2text" = "old"; then
-		as_fn_error "utf8_mime2text() has old signature, but U8T_CANONICAL is present. This should not happen. Check config.log for additional information." "$LINENO" 5
+		as_fn_error $? "utf8_mime2text() has old signature, but U8T_CANONICAL is present. This should not happen. Check config.log for additional information." "$LINENO" 5
     fi
 
         old_CPPFLAGS=$CPPFLAGS
@@ -50706,7 +51989,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pam_start in -lpam" >&5
 $as_echo_n "checking for pam_start in -lpam... " >&6; }
-if test "${ac_cv_lib_pam_pam_start+set}" = set; then :
+if ${ac_cv_lib_pam_pam_start+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -50740,7 +52023,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pam_pam_start" >&5
 $as_echo "$ac_cv_lib_pam_pam_start" >&6; }
-if test "x$ac_cv_lib_pam_pam_start" = x""yes; then :
+if test "x$ac_cv_lib_pam_pam_start" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -50880,7 +52163,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for crypt in -lcrypt" >&5
 $as_echo_n "checking for crypt in -lcrypt... " >&6; }
-if test "${ac_cv_lib_crypt_crypt+set}" = set; then :
+if ${ac_cv_lib_crypt_crypt+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -50914,7 +52197,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_crypt_crypt" >&5
 $as_echo "$ac_cv_lib_crypt_crypt" >&6; }
-if test "x$ac_cv_lib_crypt_crypt" = x""yes; then :
+if test "x$ac_cv_lib_crypt_crypt" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -50970,7 +52253,7 @@
 
 
     if test -z "$IMAP_DIR"; then
-      as_fn_error "Cannot find rfc822.h. Please check your c-client installation." "$LINENO" 5
+      as_fn_error $? "Cannot find rfc822.h. Please check your c-client installation." "$LINENO" 5
     fi
 
     if test -r "$IMAP_DIR/c-client/c-client.a"; then
@@ -50996,7 +52279,7 @@
     done
 
     if test -z "$IMAP_LIBDIR"; then
-      as_fn_error "Cannot find imap library (libc-client.a). Please check your c-client installation." "$LINENO" 5
+      as_fn_error $? "Cannot find imap library (libc-client.a). Please check your c-client installation." "$LINENO" 5
     fi
 
 
@@ -51103,7 +52386,7 @@
 set dummy krb5-config; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_KRB5_CONFIG+set}" = set; then :
+if ${ac_cv_path_KRB5_CONFIG+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $KRB5_CONFIG in
@@ -51467,7 +52750,7 @@
 
 
 else
-      as_fn_error "Kerberos libraries not found.
+      as_fn_error $? "Kerberos libraries not found.
 
       Check the path given to --with-kerberos (if no path is given, searches in /usr/kerberos, /usr/local and /usr )
       " "$LINENO" 5
@@ -51483,7 +52766,7 @@
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
   $EGREP "auth_gss" >/dev/null 2>&1; then :
 
-      as_fn_error "This c-client library is built with Kerberos support.
+      as_fn_error $? "This c-client library is built with Kerberos support.
 
       Add --with-kerberos to your configure line. Check config.log for details.
       " "$LINENO" 5
@@ -51517,7 +52800,7 @@
 set dummy pkg-config; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_PKG_CONFIG+set}" = set; then :
+if ${ac_cv_path_PKG_CONFIG+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $PKG_CONFIG in
@@ -51563,7 +52846,7 @@
       OPENSSL_INCS=`$PKG_CONFIG --cflags-only-I openssl`
       OPENSSL_INCDIR=`$PKG_CONFIG --variable=includedir openssl`
     else
-      as_fn_error "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
+      as_fn_error $? "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
     fi
 
     if test -n "$OPENSSL_LIBS"; then
@@ -51718,11 +53001,11 @@
     done
 
     if test -z "$OPENSSL_INCDIR"; then
-      as_fn_error "Cannot find OpenSSL's <evp.h>" "$LINENO" 5
+      as_fn_error $? "Cannot find OpenSSL's <evp.h>" "$LINENO" 5
     fi
 
     if test -z "$OPENSSL_LIBDIR"; then
-      as_fn_error "Cannot find OpenSSL's libraries" "$LINENO" 5
+      as_fn_error $? "Cannot find OpenSSL's libraries" "$LINENO" 5
     fi
 
     old_CPPFLAGS=$CPPFLAGS
@@ -51746,7 +53029,7 @@
 
 else
 
-      as_fn_error "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
+      as_fn_error $? "OpenSSL version 0.9.6 or greater required." "$LINENO" 5
 
 fi
 rm -f conftest*
@@ -51884,7 +53167,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CRYPTO_free in -lcrypto" >&5
 $as_echo_n "checking for CRYPTO_free in -lcrypto... " >&6; }
-if test "${ac_cv_lib_crypto_CRYPTO_free+set}" = set; then :
+if ${ac_cv_lib_crypto_CRYPTO_free+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -51918,7 +53201,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_crypto_CRYPTO_free" >&5
 $as_echo "$ac_cv_lib_crypto_CRYPTO_free" >&6; }
-if test "x$ac_cv_lib_crypto_CRYPTO_free" = x""yes; then :
+if test "x$ac_cv_lib_crypto_CRYPTO_free" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -51954,7 +53237,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_crypto_CRYPTO_free
 
-      as_fn_error "libcrypto not found!" "$LINENO" 5
+      as_fn_error $? "libcrypto not found!" "$LINENO" 5
 
 
 fi
@@ -52061,7 +53344,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SSL_CTX_set_ssl_version in -lssl" >&5
 $as_echo_n "checking for SSL_CTX_set_ssl_version in -lssl... " >&6; }
-if test "${ac_cv_lib_ssl_SSL_CTX_set_ssl_version+set}" = set; then :
+if ${ac_cv_lib_ssl_SSL_CTX_set_ssl_version+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -52095,7 +53378,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ssl_SSL_CTX_set_ssl_version" >&5
 $as_echo "$ac_cv_lib_ssl_SSL_CTX_set_ssl_version" >&6; }
-if test "x$ac_cv_lib_ssl_SSL_CTX_set_ssl_version" = x""yes; then :
+if test "x$ac_cv_lib_ssl_SSL_CTX_set_ssl_version" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -52109,7 +53392,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_ssl_SSL_CTX_set_ssl_version
 
-      as_fn_error "libssl not found!" "$LINENO" 5
+      as_fn_error $? "libssl not found!" "$LINENO" 5
 
 
 fi
@@ -52212,7 +53495,7 @@
 
 
 else
-      as_fn_error "OpenSSL libraries not found.
+      as_fn_error $? "OpenSSL libraries not found.
 
       Check the path given to --with-openssl-dir and output in config.log)
       " "$LINENO" 5
@@ -52228,7 +53511,7 @@
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
   $EGREP "ssl_onceonlyinit" >/dev/null 2>&1; then :
 
-      as_fn_error "This c-client library is built with SSL support.
+      as_fn_error $? "This c-client library is built with SSL support.
 
       Add --with-imap-ssl to your configure line. Check config.log for details.
       " "$LINENO" 5
@@ -52501,7 +53784,7 @@
 
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-      as_fn_error "build test failed. Please check the config.log for details." "$LINENO" 5
+      as_fn_error $? "build test failed. Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -52667,7 +53950,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for isc_detach_database in -lfbclient" >&5
 $as_echo_n "checking for isc_detach_database in -lfbclient... " >&6; }
-if test "${ac_cv_lib_fbclient_isc_detach_database+set}" = set; then :
+if ${ac_cv_lib_fbclient_isc_detach_database+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -52701,7 +53984,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_fbclient_isc_detach_database" >&5
 $as_echo "$ac_cv_lib_fbclient_isc_detach_database" >&6; }
-if test "x$ac_cv_lib_fbclient_isc_detach_database" = x""yes; then :
+if test "x$ac_cv_lib_fbclient_isc_detach_database" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -52814,7 +54097,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for isc_detach_database in -lgds" >&5
 $as_echo_n "checking for isc_detach_database in -lgds... " >&6; }
-if test "${ac_cv_lib_gds_isc_detach_database+set}" = set; then :
+if ${ac_cv_lib_gds_isc_detach_database+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -52848,7 +54131,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gds_isc_detach_database" >&5
 $as_echo "$ac_cv_lib_gds_isc_detach_database" >&6; }
-if test "x$ac_cv_lib_gds_isc_detach_database" = x""yes; then :
+if test "x$ac_cv_lib_gds_isc_detach_database" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -52961,7 +54244,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for isc_detach_database in -lib_util" >&5
 $as_echo_n "checking for isc_detach_database in -lib_util... " >&6; }
-if test "${ac_cv_lib_ib_util_isc_detach_database+set}" = set; then :
+if ${ac_cv_lib_ib_util_isc_detach_database+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -52995,7 +54278,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ib_util_isc_detach_database" >&5
 $as_echo "$ac_cv_lib_ib_util_isc_detach_database" >&6; }
-if test "x$ac_cv_lib_ib_util_isc_detach_database" = x""yes; then :
+if test "x$ac_cv_lib_ib_util_isc_detach_database" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -53009,7 +54292,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_ib_util_isc_detach_database
 
-        as_fn_error "libgds, libib_util or libfbclient not found! Check config.log for more information." "$LINENO" 5
+        as_fn_error $? "libgds, libib_util or libfbclient not found! Check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -53530,7 +54813,7 @@
 set dummy icu-config; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_ICU_CONFIG+set}" = set; then :
+if ${ac_cv_path_ICU_CONFIG+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $ICU_CONFIG in
@@ -53579,7 +54862,7 @@
   if test "$?" != "0" || test -z "$icu_install_prefix"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
-    as_fn_error "Unable to detect ICU prefix or $ICU_CONFIG failed. Please verify ICU install prefix and make sure icu-config works." "$LINENO" 5
+    as_fn_error $? "Unable to detect ICU prefix or $ICU_CONFIG failed. Please verify ICU install prefix and make sure icu-config works." "$LINENO" 5
   else
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: $icu_install_prefix" >&5
 $as_echo "$icu_install_prefix" >&6; }
@@ -53596,7 +54879,7 @@
 $as_echo "found $icu_version_full" >&6; }
 
     if test "$icu_version" -lt "3004"; then
-      as_fn_error "ICU version 3.4 or later is required" "$LINENO" 5
+      as_fn_error $? "ICU version 3.4 or later is required" "$LINENO" 5
     fi
 
     ICU_VERSION=$icu_version
@@ -53754,7 +55037,7 @@
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CXX+set}" = set; then :
+if ${ac_cv_prog_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CXX"; then
@@ -53798,7 +55081,7 @@
 set dummy $ac_prog; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CXX+set}" = set; then :
+if ${ac_cv_prog_ac_ct_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CXX"; then
@@ -53876,7 +55159,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C++ compiler" >&5
 $as_echo_n "checking whether we are using the GNU C++ compiler... " >&6; }
-if test "${ac_cv_cxx_compiler_gnu+set}" = set; then :
+if ${ac_cv_cxx_compiler_gnu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -53913,7 +55196,7 @@
 ac_save_CXXFLAGS=$CXXFLAGS
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CXX accepts -g" >&5
 $as_echo_n "checking whether $CXX accepts -g... " >&6; }
-if test "${ac_cv_prog_cxx_g+set}" = set; then :
+if ${ac_cv_prog_cxx_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_save_cxx_werror_flag=$ac_cxx_werror_flag
@@ -54003,7 +55286,7 @@
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C++ preprocessor" >&5
 $as_echo_n "checking how to run the C++ preprocessor... " >&6; }
 if test -z "$CXXCPP"; then
-  if test "${ac_cv_prog_CXXCPP+set}" = set; then :
+  if ${ac_cv_prog_CXXCPP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
       # Double quotes because CXXCPP needs to be expanded
@@ -54033,7 +55316,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -54049,11 +55332,11 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
   break
 fi
@@ -54092,7 +55375,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -54108,18 +55391,18 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
 
 else
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "C++ preprocessor \"$CXXCPP\" fails sanity check
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "C++ preprocessor \"$CXXCPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 
 ac_ext=c
@@ -54751,7 +56034,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
 $as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then :
+if ${ac_cv_header_stdc+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -55587,7 +56870,7 @@
   fi
 
   if test -z "$LDAP_DIR"; then
-    as_fn_error "Cannot find ldap.h" "$LINENO" 5
+    as_fn_error $? "Cannot find ldap.h" "$LINENO" 5
   fi
 
 
@@ -57524,7 +58807,7 @@
 
     fi
   else
-    as_fn_error "Cannot find ldap libraries in $LDAP_LIBDIR." "$LINENO" 5
+    as_fn_error $? "Cannot find ldap libraries in $LDAP_LIBDIR." "$LINENO" 5
   fi
 
 
@@ -57572,7 +58855,7 @@
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for 3 arg ldap_set_rebind_proc" >&5
 $as_echo_n "checking for 3 arg ldap_set_rebind_proc... " >&6; }
-if test "${ac_cv_3arg_setrebindproc+set}" = set; then :
+if ${ac_cv_3arg_setrebindproc+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -57605,8 +58888,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -57643,7 +58925,7 @@
     LDAP_SASL_INCDIR=$LDAP_SASL_DIR/include
     LDAP_SASL_LIBDIR=$LDAP_SASL_DIR/$PHP_LIBDIR
   else
-    as_fn_error "sasl.h not found!" "$LINENO" 5
+    as_fn_error $? "sasl.h not found!" "$LINENO" 5
   fi
 
   if test "$PHP_LDAP_SASL" = "yes"; then
@@ -57751,7 +59033,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sasl_version in -lsasl2" >&5
 $as_echo_n "checking for sasl_version in -lsasl2... " >&6; }
-if test "${ac_cv_lib_sasl2_sasl_version+set}" = set; then :
+if ${ac_cv_lib_sasl2_sasl_version+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -57785,7 +59067,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sasl2_sasl_version" >&5
 $as_echo "$ac_cv_lib_sasl2_sasl_version" >&6; }
-if test "x$ac_cv_lib_sasl2_sasl_version" = x""yes; then :
+if test "x$ac_cv_lib_sasl2_sasl_version" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -57929,7 +59211,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_sasl2_sasl_version
 
-    as_fn_error "LDAP SASL check failed. Please check config.log for more information." "$LINENO" 5
+    as_fn_error $? "LDAP SASL check failed. Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -57938,11 +59220,11 @@
   fi
 
         ac_fn_c_check_func "$LINENO" "ldap_bind_s" "ac_cv_func_ldap_bind_s"
-if test "x$ac_cv_func_ldap_bind_s" = x""yes; then :
+if test "x$ac_cv_func_ldap_bind_s" = xyes; then :
 
 else
 
-    as_fn_error "LDAP build check failed. Please check config.log for more information." "$LINENO" 5
+    as_fn_error $? "LDAP build check failed. Please check config.log for more information." "$LINENO" 5
 
 fi
 
@@ -58132,7 +59414,7 @@
 
       { $as_echo "$as_me:${as_lineno-$LINENO}: checking for variable length prototypes and stdarg.h" >&5
 $as_echo_n "checking for variable length prototypes and stdarg.h... " >&6; }
-if test "${php_cv_mbstring_stdarg+set}" = set; then :
+if ${php_cv_mbstring_stdarg+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -58181,8 +59463,7 @@
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -58197,7 +59478,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of int" >&5
 $as_echo_n "checking size of int... " >&6; }
-if test "${ac_cv_sizeof_int+set}" = set; then :
+if ${ac_cv_sizeof_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (int))" "ac_cv_sizeof_int"        "$ac_includes_default"; then :
@@ -58206,9 +59487,8 @@
   if test "$ac_cv_type_int" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (int)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (int)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_int=0
    fi
@@ -58231,7 +59511,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of short" >&5
 $as_echo_n "checking size of short... " >&6; }
-if test "${ac_cv_sizeof_short+set}" = set; then :
+if ${ac_cv_sizeof_short+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (short))" "ac_cv_sizeof_short"        "$ac_includes_default"; then :
@@ -58240,9 +59520,8 @@
   if test "$ac_cv_type_short" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (short)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (short)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_short=0
    fi
@@ -58265,7 +59544,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long" >&5
 $as_echo_n "checking size of long... " >&6; }
-if test "${ac_cv_sizeof_long+set}" = set; then :
+if ${ac_cv_sizeof_long+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long))" "ac_cv_sizeof_long"        "$ac_includes_default"; then :
@@ -58274,9 +59553,8 @@
   if test "$ac_cv_type_long" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long=0
    fi
@@ -58295,7 +59573,7 @@
 
       { $as_echo "$as_me:${as_lineno-$LINENO}: checking for an ANSI C-conforming const" >&5
 $as_echo_n "checking for an ANSI C-conforming const... " >&6; }
-if test "${ac_cv_c_const+set}" = set; then :
+if ${ac_cv_c_const+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -58375,7 +59653,7 @@
 
       { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether time.h and sys/time.h may both be included" >&5
 $as_echo_n "checking whether time.h and sys/time.h may both be included... " >&6; }
-if test "${ac_cv_header_time+set}" = set; then :
+if ${ac_cv_header_time+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -58412,7 +59690,7 @@
 # for constant arguments.  Useless!
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working alloca.h" >&5
 $as_echo_n "checking for working alloca.h... " >&6; }
-if test "${ac_cv_working_alloca_h+set}" = set; then :
+if ${ac_cv_working_alloca_h+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -58445,7 +59723,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for alloca" >&5
 $as_echo_n "checking for alloca... " >&6; }
-if test "${ac_cv_func_alloca_works+set}" = set; then :
+if ${ac_cv_func_alloca_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -58464,7 +59742,7 @@
  #pragma alloca
 #   else
 #    ifndef alloca /* predefined by HP cc +Olibcalls */
-char *alloca ();
+void *alloca (size_t);
 #    endif
 #   endif
 #  endif
@@ -58508,7 +59786,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether \`alloca.c' needs Cray hooks" >&5
 $as_echo_n "checking whether \`alloca.c' needs Cray hooks... " >&6; }
-if test "${ac_cv_os_cray+set}" = set; then :
+if ${ac_cv_os_cray+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -58535,8 +59813,7 @@
   for ac_func in _getb67 GETB67 getb67; do
     as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
 
 cat >>confdefs.h <<_ACEOF
 #define CRAY_STACKSEG_END $ac_func
@@ -58550,7 +59827,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking stack direction for C alloca" >&5
 $as_echo_n "checking stack direction for C alloca... " >&6; }
-if test "${ac_cv_c_stack_direction+set}" = set; then :
+if ${ac_cv_c_stack_direction+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "$cross_compiling" = yes; then :
@@ -58600,7 +59877,7 @@
 
       { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working memcmp" >&5
 $as_echo_n "checking for working memcmp... " >&6; }
-if test "${ac_cv_func_memcmp_working+set}" = set; then :
+if ${ac_cv_func_memcmp_working+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "$cross_compiling" = yes; then :
@@ -58661,7 +59938,7 @@
 
 
       ac_fn_c_check_header_mongrel "$LINENO" "stdarg.h" "ac_cv_header_stdarg_h" "$ac_includes_default"
-if test "x$ac_cv_header_stdarg_h" = x""yes; then :
+if test "x$ac_cv_header_stdarg_h" = xyes; then :
 
 
 $as_echo "#define HAVE_STDARG_PROTOTYPES 1" >>confdefs.h
@@ -58740,7 +60017,7 @@
 
     else
                         if test ! -f "$PHP_ONIG/include/oniguruma.h"; then
-        as_fn_error "oniguruma.h not found in $PHP_ONIG/include" "$LINENO" 5
+        as_fn_error $? "oniguruma.h not found in $PHP_ONIG/include" "$LINENO" 5
       fi
 
   if test "$PHP_ONIG/include" != "/usr/include"; then
@@ -58873,7 +60150,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for onig_init in -lonig" >&5
 $as_echo_n "checking for onig_init in -lonig... " >&6; }
-if test "${ac_cv_lib_onig_onig_init+set}" = set; then :
+if ${ac_cv_lib_onig_onig_init+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -58907,7 +60184,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_onig_onig_init" >&5
 $as_echo "$ac_cv_lib_onig_onig_init" >&6; }
-if test "x$ac_cv_lib_onig_onig_init" = x""yes; then :
+if test "x$ac_cv_lib_onig_onig_init" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -59020,7 +60297,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_onig_onig_init
 
-        as_fn_error "Problem with oniguruma. Please check config.log for more information." "$LINENO" 5
+        as_fn_error $? "Problem with oniguruma. Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -59303,7 +60580,7 @@
     done
 
     if test -z "$PHP_LIBMBFL_INCLUDE"; then
-      as_fn_error "mbfilter.h not found. Please reinstall libmbfl library." "$LINENO" 5
+      as_fn_error $? "mbfilter.h not found. Please reinstall libmbfl library." "$LINENO" 5
     else
 
   if test "$PHP_LIBMBFL_INCLUDE" != "/usr/include"; then
@@ -59437,7 +60714,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mbfl_buffer_converter_new in -lmbfl" >&5
 $as_echo_n "checking for mbfl_buffer_converter_new in -lmbfl... " >&6; }
-if test "${ac_cv_lib_mbfl_mbfl_buffer_converter_new+set}" = set; then :
+if ${ac_cv_lib_mbfl_mbfl_buffer_converter_new+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -59471,7 +60748,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_mbfl_mbfl_buffer_converter_new" >&5
 $as_echo "$ac_cv_lib_mbfl_mbfl_buffer_converter_new" >&6; }
-if test "x$ac_cv_lib_mbfl_mbfl_buffer_converter_new" = x""yes; then :
+if test "x$ac_cv_lib_mbfl_mbfl_buffer_converter_new" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -59581,7 +60858,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_mbfl_mbfl_buffer_converter_new
 
-      as_fn_error "Problem with libmbfl. Please check config.log for more information." "$LINENO" 5
+      as_fn_error $? "Problem with libmbfl. Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -60141,7 +61418,7 @@
   done
 
   if test -z "$MCRYPT_DIR"; then
-    as_fn_error "mcrypt.h not found. Please reinstall libmcrypt." "$LINENO" 5
+    as_fn_error $? "mcrypt.h not found. Please reinstall libmcrypt." "$LINENO" 5
   fi
 
 
@@ -60166,7 +61443,7 @@
 
 else
 
-    as_fn_error "libmcrypt version 2.5.6 or greater required." "$LINENO" 5
+    as_fn_error $? "libmcrypt version 2.5.6 or greater required." "$LINENO" 5
 
 fi
 rm -f conftest*
@@ -60273,7 +61550,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mcrypt_module_open in -lmcrypt" >&5
 $as_echo_n "checking for mcrypt_module_open in -lmcrypt... " >&6; }
-if test "${ac_cv_lib_mcrypt_mcrypt_module_open+set}" = set; then :
+if ${ac_cv_lib_mcrypt_mcrypt_module_open+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -60307,7 +61584,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_mcrypt_mcrypt_module_open" >&5
 $as_echo "$ac_cv_lib_mcrypt_mcrypt_module_open" >&6; }
-if test "x$ac_cv_lib_mcrypt_mcrypt_module_open" = x""yes; then :
+if test "x$ac_cv_lib_mcrypt_mcrypt_module_open" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -60445,7 +61722,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mcrypt_module_open in -lmcrypt" >&5
 $as_echo_n "checking for mcrypt_module_open in -lmcrypt... " >&6; }
-if test "${ac_cv_lib_mcrypt_mcrypt_module_open+set}" = set; then :
+if ${ac_cv_lib_mcrypt_mcrypt_module_open+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -60479,7 +61756,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_mcrypt_mcrypt_module_open" >&5
 $as_echo "$ac_cv_lib_mcrypt_mcrypt_module_open" >&6; }
-if test "x$ac_cv_lib_mcrypt_mcrypt_module_open" = x""yes; then :
+if test "x$ac_cv_lib_mcrypt_mcrypt_module_open" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -60495,7 +61772,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_mcrypt_mcrypt_module_open
 
-      as_fn_error "Sorry, I was not able to diagnose which libmcrypt version you have installed." "$LINENO" 5
+      as_fn_error $? "Sorry, I was not able to diagnose which libmcrypt version you have installed." "$LINENO" 5
 
 
 fi
@@ -60994,7 +62271,7 @@
     done
 
     if test -z "$FREETDS_INSTALLATION_DIR"; then
-      as_fn_error "Cannot find FreeTDS in known installation directories" "$LINENO" 5
+      as_fn_error $? "Cannot find FreeTDS in known installation directories" "$LINENO" 5
     fi
 
   elif test "$PHP_MSSQL" != "no"; then
@@ -61006,12 +62283,12 @@
       FREETDS_INSTALLATION_DIR=$PHP_MSSQL
       FREETDS_INCLUDE_DIR=$PHP_MSSQL/include/freetds
     else
-      as_fn_error "Directory $PHP_MSSQL is not a FreeTDS installation directory" "$LINENO" 5
+      as_fn_error $? "Directory $PHP_MSSQL is not a FreeTDS installation directory" "$LINENO" 5
     fi
   fi
 
   if test ! -r "$FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.a" && test ! -r "$FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.so"; then
-     as_fn_error "Could not find $FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.a|so" "$LINENO" 5
+     as_fn_error $? "Could not find $FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.a|so" "$LINENO" 5
   fi
 
 
@@ -61438,7 +62715,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dnet_addr in -ldnet_stub" >&5
 $as_echo_n "checking for dnet_addr in -ldnet_stub... " >&6; }
-if test "${ac_cv_lib_dnet_stub_dnet_addr+set}" = set; then :
+if ${ac_cv_lib_dnet_stub_dnet_addr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -61472,7 +62749,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dnet_stub_dnet_addr" >&5
 $as_echo "$ac_cv_lib_dnet_stub_dnet_addr" >&6; }
-if test "x$ac_cv_lib_dnet_stub_dnet_addr" = x""yes; then :
+if test "x$ac_cv_lib_dnet_stub_dnet_addr" = xyes; then :
 
 
   if test "$ext_shared" = "yes"; then
@@ -61706,7 +62983,7 @@
   fi
 
   if test -z "$MYSQL_DIR"; then
-    as_fn_error "Cannot find MySQL header files under $PHP_MYSQL.
+    as_fn_error $? "Cannot find MySQL header files under $PHP_MYSQL.
 Note that the MySQL client library is not bundled anymore!" "$LINENO" 5
   fi
 
@@ -61761,7 +63038,7 @@
   fi
 
   if test -z "$MYSQL_LIB_DIR"; then
-    as_fn_error "Cannot find lib$MYSQL_LIBNAME under $MYSQL_DIR.
+    as_fn_error $? "Cannot find lib$MYSQL_LIBNAME under $MYSQL_DIR.
 Note that the MySQL client library is not bundled anymore!" "$LINENO" 5
   fi
 
@@ -61865,7 +63142,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$MYSQL_LIBNAME''_mysql_close" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mysql_close in -l$MYSQL_LIBNAME" >&5
 $as_echo_n "checking for mysql_close in -l$MYSQL_LIBNAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -61900,8 +63177,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -62111,7 +63387,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$MYSQL_LIBNAME''_mysql_error" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mysql_error in -l$MYSQL_LIBNAME" >&5
 $as_echo_n "checking for mysql_error in -l$MYSQL_LIBNAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -62146,8 +63422,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -62159,7 +63434,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_$MYSQL_LIBNAME_mysql_error
 
-        as_fn_error "mysql configure failed. Please check config.log for more information." "$LINENO" 5
+        as_fn_error $? "mysql configure failed. Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -62289,7 +63564,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$MYSQL_LIBNAME''_mysql_errno" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mysql_errno in -l$MYSQL_LIBNAME" >&5
 $as_echo_n "checking for mysql_errno in -l$MYSQL_LIBNAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -62324,8 +63599,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -62337,7 +63611,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_$MYSQL_LIBNAME_mysql_errno
 
-        as_fn_error "Try adding --with-zlib-dir=<DIR>. Please check config.log for more information." "$LINENO" 5
+        as_fn_error $? "Try adding --with-zlib-dir=<DIR>. Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -62857,7 +64131,7 @@
   is_it_shared=$PHP_MYSQLND_SHARED
   is_it_enabled=$PHP_MYSQLND
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension mysql to build statically, but it
 depends on extension mysqlnd, which you've configured to build shared.
 You either need to build mysql shared or build mysqlnd statically for the
@@ -62865,7 +64139,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension mysql, which depends on extension mysqlnd,
 but you've either not enabled mysqlnd, or have disabled it.
 " "$LINENO" 5
@@ -62973,7 +64247,7 @@
   else
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: mysql_config not found" >&5
 $as_echo "mysql_config not found" >&6; }
-    as_fn_error "Please reinstall the mysql distribution" "$LINENO" 5
+    as_fn_error $? "Please reinstall the mysql distribution" "$LINENO" 5
   fi
 
 
@@ -63076,7 +64350,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$MYSQL_LIB_NAME''_mysql_set_server_option" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mysql_set_server_option in -l$MYSQL_LIB_NAME" >&5
 $as_echo_n "checking for mysql_set_server_option in -l$MYSQL_LIB_NAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -63111,8 +64385,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -63347,7 +64620,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$MYSQL_LIB_NAME''_mysql_set_character_set" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mysql_set_character_set in -l$MYSQL_LIB_NAME" >&5
 $as_echo_n "checking for mysql_set_character_set in -l$MYSQL_LIB_NAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -63382,8 +64655,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -63395,7 +64667,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_$MYSQL_LIB_NAME_mysql_set_character_set
 
-      as_fn_error "MySQLI doesn't support versions < 4.1.13 (for MySQL 4.1.x) and < 5.0.7 for (MySQL 5.0.x) anymore. Please update your libraries." "$LINENO" 5
+      as_fn_error $? "MySQLI doesn't support versions < 4.1.13 (for MySQL 4.1.x) and < 5.0.7 for (MySQL 5.0.x) anymore. Please update your libraries." "$LINENO" 5
 
 
 fi
@@ -63408,7 +64680,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_$MYSQL_LIB_NAME_mysql_set_server_option
 
-    as_fn_error "wrong mysql library version or lib not found. Check config.log for more information." "$LINENO" 5
+    as_fn_error $? "wrong mysql library version or lib not found. Check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -63513,7 +64785,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$MYSQL_LIB_NAME''_mysql_stmt_next_result" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mysql_stmt_next_result in -l$MYSQL_LIB_NAME" >&5
 $as_echo_n "checking for mysql_stmt_next_result in -l$MYSQL_LIB_NAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -63548,8 +64820,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -63896,7 +65167,7 @@
   is_it_shared=$PHP_MYSQLND_SHARED
   is_it_enabled=$PHP_MYSQLND
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension mysqli to build statically, but it
 depends on extension mysqlnd, which you've configured to build shared.
 You either need to build mysqli shared or build mysqlnd statically for the
@@ -63904,7 +65175,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension mysqli, which depends on extension mysqlnd,
 but you've either not enabled mysqlnd, or have disabled it.
 " "$LINENO" 5
@@ -64024,7 +65295,7 @@
 if test "$PHP_OCI8" != "no"; then
 
   if test -z "$PHP_OCI8"; then
-        as_fn_error "Empty parameter value passed to --with-oci8" "$LINENO" 5
+        as_fn_error $? "Empty parameter value passed to --with-oci8" "$LINENO" 5
   fi
 
 
@@ -64034,7 +65305,7 @@
   tmp_version=$PHP_VERSION
   if test -z "$tmp_version"; then
     if test -z "$PHP_CONFIG"; then
-      as_fn_error "php-config not found" "$LINENO" 5
+      as_fn_error $? "php-config not found" "$LINENO" 5
     fi
     php_version=`$PHP_CONFIG --version 2>/dev/null|head -n 1|$PHP_OCI8_SED -e 's#\([0-9]\.[0-9]*\.[0-9]*\)\(.*\)#\1#'`
   else
@@ -64042,7 +65313,7 @@
   fi
 
   if test -z "$php_version"; then
-    as_fn_error "failed to detect PHP version, please report" "$LINENO" 5
+    as_fn_error $? "failed to detect PHP version, please report" "$LINENO" 5
   fi
 
   ac_IFS=$IFS
@@ -64052,9 +65323,9 @@
   oci8_php_version=`expr $1 \* 1000000 + $2 \* 1000 + $3`
 
   if test "$oci8_php_version" -lt "4003009"; then
-    as_fn_error "You need at least PHP 4.3.9 to be able to use this version of OCI8. PHP $php_version found" "$LINENO" 5
+    as_fn_error $? "You need at least PHP 4.3.9 to be able to use this version of OCI8. PHP $php_version found" "$LINENO" 5
   elif test "$oci8_php_version" -ge "6000000"; then
-    as_fn_error "This version of OCI8 is not compatible with PHP 6 or higher" "$LINENO" 5
+    as_fn_error $? "This version of OCI8 is not compatible with PHP 6 or higher" "$LINENO" 5
   else
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: $php_version, ok" >&5
 $as_echo "$php_version, ok" >&6; }
@@ -64067,7 +65338,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long int" >&5
 $as_echo_n "checking size of long int... " >&6; }
-if test "${ac_cv_sizeof_long_int+set}" = set; then :
+if ${ac_cv_sizeof_long_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long int))" "ac_cv_sizeof_long_int"        "$ac_includes_default"; then :
@@ -64076,9 +65347,8 @@
   if test "$ac_cv_type_long_int" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long int)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long int)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long_int=0
    fi
@@ -64157,7 +65427,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking ORACLE_HOME library validity" >&5
 $as_echo_n "checking ORACLE_HOME library validity... " >&6; }
   if test ! -d "$OCI8_DIR"; then
-    as_fn_error "${OCI8_DIR} is not a directory" "$LINENO" 5
+    as_fn_error $? "${OCI8_DIR} is not a directory" "$LINENO" 5
   fi
   if test -d "$OCI8_DIR/lib" && test ! -d "$OCI8_DIR/lib32"; then
     OCI8_LIB_DIR=lib
@@ -64167,9 +65437,9 @@
     OCI8_LIB_DIR=$PHP_OCI8_OH_LIBDIR
   else
         if test -f "$OCI8_DIR/libociei.$SHLIB_SUFFIX_NAME"; then
-      as_fn_error "Expected an ORACLE_HOME top level directory but ${OCI8_DIR} appears to be an Instant Client directory. Try --with-oci8=instantclient,${OCI8_DIR}" "$LINENO" 5
+      as_fn_error $? "Expected an ORACLE_HOME top level directory but ${OCI8_DIR} appears to be an Instant Client directory. Try --with-oci8=instantclient,${OCI8_DIR}" "$LINENO" 5
     else
-      as_fn_error "Oracle library directory not found in ${OCI8_DIR}" "$LINENO" 5
+      as_fn_error $? "Oracle library directory not found in ${OCI8_DIR}" "$LINENO" 5
     fi
   fi
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OCI8_LIB_DIR" >&5
@@ -64518,7 +65788,7 @@
       OCI8_ORACLE_VERSION=8.1
     fi
   else
-    as_fn_error "Oracle libclntsh.$SHLIB_SUFFIX_NAME client library not found" "$LINENO" 5
+    as_fn_error $? "Oracle libclntsh.$SHLIB_SUFFIX_NAME client library not found" "$LINENO" 5
   fi
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OCI8_ORACLE_VERSION" >&5
 $as_echo "$OCI8_ORACLE_VERSION" >&6; }
@@ -64526,7 +65796,7 @@
 
     case $OCI8_ORACLE_VERSION in
       7.3|8.0|8.1)
-	as_fn_error "Oracle client libraries < 9.2 are not supported" "$LINENO" 5
+	as_fn_error $? "Oracle client libraries < 9.2 are not supported" "$LINENO" 5
 	;;
 
       9.0)
@@ -64629,7 +65899,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for OCIEnvNlsCreate in -lclntsh" >&5
 $as_echo_n "checking for OCIEnvNlsCreate in -lclntsh... " >&6; }
-if test "${ac_cv_lib_clntsh_OCIEnvNlsCreate+set}" = set; then :
+if ${ac_cv_lib_clntsh_OCIEnvNlsCreate+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -64663,7 +65933,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_clntsh_OCIEnvNlsCreate" >&5
 $as_echo "$ac_cv_lib_clntsh_OCIEnvNlsCreate" >&6; }
-if test "x$ac_cv_lib_clntsh_OCIEnvNlsCreate" = x""yes; then :
+if test "x$ac_cv_lib_clntsh_OCIEnvNlsCreate" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -64677,7 +65947,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_clntsh_OCIEnvNlsCreate
 
-	  as_fn_error "Oracle client libraries < 9.2 are not supported" "$LINENO" 5
+	  as_fn_error $? "Oracle client libraries < 9.2 are not supported" "$LINENO" 5
 
 
 fi
@@ -65087,7 +66357,7 @@
     if test "$PHP_OCI8_INSTANT_CLIENT" = "yes"; then
                                     PHP_OCI8_INSTANT_CLIENT=`ls -d /usr/lib/oracle/*/client${PHP_OCI8_IC_LIBDIR_SUFFIX}/lib/libclntsh.* 2> /dev/null | $PHP_OCI8_TAIL1 | $PHP_OCI8_SED -e 's#/libclntsh[^/]*##'`
       if test -z "$PHP_OCI8_INSTANT_CLIENT"; then
-	as_fn_error "Oracle Instant Client directory /usr/lib/oracle/.../client${PHP_OCI8_IC_LIBDIR_SUFFIX}/lib libraries not found. Try --with-oci8=instantclient,DIR" "$LINENO" 5
+	as_fn_error $? "Oracle Instant Client directory /usr/lib/oracle/.../client${PHP_OCI8_IC_LIBDIR_SUFFIX}/lib libraries not found. Try --with-oci8=instantclient,DIR" "$LINENO" 5
       fi
     fi
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PHP_OCI8_INSTANT_CLIENT" >&5
@@ -65210,7 +66480,7 @@
 
       OCI8INCDIR=$OCISDKMANINC
     else
-      as_fn_error "Oracle Instant Client SDK header files not found" "$LINENO" 5
+      as_fn_error $? "Oracle Instant Client SDK header files not found" "$LINENO" 5
     fi
 
     OCISYSLIBLIST=`echo "$OCI8INCDIR" | $PHP_OCI8_SED -e 's!\(.*\)/include$!\1/demo/sysliblist!'`
@@ -65314,11 +66584,11 @@
   OCI8_NNZ=`ls $PHP_OCI8_INSTANT_CLIENT/libnnz*.$SHLIB_SUFFIX_NAME 2> /dev/null | $PHP_OCI8_TAIL1`
   if test -f "$OCI8_NNZ" && test -f "$OCI8_LCS"; then
     if test ! -f "$OCI8_LCS_BASE"; then
-      as_fn_error "Link from $OCI8_LCS_BASE to $OCI8_LCS_BASE.*.1 not found" "$LINENO" 5
+      as_fn_error $? "Link from $OCI8_LCS_BASE to $OCI8_LCS_BASE.*.1 not found" "$LINENO" 5
     fi
     OCI8_ORACLE_VERSION=`echo $OCI8_LCS | $PHP_OCI8_SED -e 's/.*\.\(.*\)\.1$/\1.1/'`
   else
-    as_fn_error "Oracle Instant Client libraries libnnz.$SHLIB_SUFFIX_NAME and libclntsh.$SHLIB_SUFFIX_NAME not found" "$LINENO" 5
+    as_fn_error $? "Oracle Instant Client libraries libnnz.$SHLIB_SUFFIX_NAME and libclntsh.$SHLIB_SUFFIX_NAME not found" "$LINENO" 5
   fi
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OCI8_ORACLE_VERSION" >&5
 $as_echo "$OCI8_ORACLE_VERSION" >&6; }
@@ -65914,7 +67184,7 @@
     ODBC_INCDIR=$PHP_ADABAS/incl
 
 if ! test -f "$ODBC_INCDIR/sqlext.h"; then
-  as_fn_error "ODBC header file '$ODBC_INCDIR/sqlext.h' not found!" "$LINENO" 5
+  as_fn_error $? "ODBC header file '$ODBC_INCDIR/sqlext.h' not found!" "$LINENO" 5
 fi
 
 
@@ -66258,7 +67528,7 @@
 
 
 if ! test -f "$ODBC_INCDIR/sqlcli1.h"; then
-  as_fn_error "ODBC header file '$ODBC_INCDIR/sqlcli1.h' not found!" "$LINENO" 5
+  as_fn_error $? "ODBC header file '$ODBC_INCDIR/sqlcli1.h' not found!" "$LINENO" 5
 fi
 
 
@@ -66305,7 +67575,7 @@
 
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-      as_fn_error "
+      as_fn_error $? "
 build test failed. Please check the config.log for details.
 You need to source your DB2 environment before running PHP configure:
 # . \$IBM_DB2/db2profile
@@ -66987,7 +68257,7 @@
     ODBC_TYPE=unixODBC
 
 if ! test -f "$ODBC_INCDIR/sqlext.h"; then
-  as_fn_error "ODBC header file '$ODBC_INCDIR/sqlext.h' not found!" "$LINENO" 5
+  as_fn_error $? "ODBC header file '$ODBC_INCDIR/sqlext.h' not found!" "$LINENO" 5
 fi
 
 
@@ -67650,7 +68920,7 @@
   for ac_func in fork
 do :
   ac_fn_c_check_func "$LINENO" "fork" "ac_cv_func_fork"
-if test "x$ac_cv_func_fork" = x""yes; then :
+if test "x$ac_cv_func_fork" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_FORK 1
 _ACEOF
@@ -67658,14 +68928,14 @@
 $as_echo "#define HAVE_FORK 1" >>confdefs.h
 
 else
-   as_fn_error "pcntl: fork() not supported by this platform" "$LINENO" 5
+   as_fn_error $? "pcntl: fork() not supported by this platform" "$LINENO" 5
 fi
 done
 
   for ac_func in waitpid
 do :
   ac_fn_c_check_func "$LINENO" "waitpid" "ac_cv_func_waitpid"
-if test "x$ac_cv_func_waitpid" = x""yes; then :
+if test "x$ac_cv_func_waitpid" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_WAITPID 1
 _ACEOF
@@ -67673,14 +68943,14 @@
 $as_echo "#define HAVE_WAITPID 1" >>confdefs.h
 
 else
-   as_fn_error "pcntl: waitpid() not supported by this platform" "$LINENO" 5
+   as_fn_error $? "pcntl: waitpid() not supported by this platform" "$LINENO" 5
 fi
 done
 
   for ac_func in sigaction
 do :
   ac_fn_c_check_func "$LINENO" "sigaction" "ac_cv_func_sigaction"
-if test "x$ac_cv_func_sigaction" = x""yes; then :
+if test "x$ac_cv_func_sigaction" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_SIGACTION 1
 _ACEOF
@@ -67688,7 +68958,7 @@
 $as_echo "#define HAVE_SIGACTION 1" >>confdefs.h
 
 else
-   as_fn_error "pcntl: sigaction() not supported by this platform" "$LINENO" 5
+   as_fn_error $? "pcntl: sigaction() not supported by this platform" "$LINENO" 5
 fi
 done
 
@@ -67696,8 +68966,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -68063,7 +69332,7 @@
     # we're running in an environment that smells like pear,
     # and the PHP_PEAR_VERSION env var is not set.  That implies
     # that we're running under a slightly broken pear installer
-    as_fn_error "
+    as_fn_error $? "
 PDO requires that you upgrade your PEAR installer tools. Please
 do so now by running:
 
@@ -68079,7 +69348,7 @@
   if test "$ext_shared" = "yes" ; then
     case $host_alias in
       *darwin*)
-          as_fn_error "
+          as_fn_error $? "
 Due to the way that loadable modules work on OSX/Darwin, you need to
 compile the PDO package statically into the PHP core.
 
@@ -68389,7 +69658,7 @@
   is_it_shared=$PHP_SPL_SHARED
   is_it_enabled=$PHP_SPL
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo to build statically, but it
 depends on extension spl, which you've configured to build shared.
 You either need to build pdo shared or build spl statically for the
@@ -68397,7 +69666,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "xtrue" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo, which depends on extension spl,
 but you've either not enabled spl, or have disabled it.
 " "$LINENO" 5
@@ -68486,7 +69755,7 @@
 if test "$PHP_PDO_DBLIB" != "no"; then
 
   if test "$PHP_PDO" = "no" && test "$ext_shared" = "no"; then
-    as_fn_error "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
+    as_fn_error $? "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
   fi
 
   if test "$PHP_PDO_DBLIB" = "yes"; then
@@ -68504,7 +69773,7 @@
     done
 
     if test -z "$PDO_FREETDS_INSTALLATION_DIR"; then
-      as_fn_error "Cannot find FreeTDS in known installation directories" "$LINENO" 5
+      as_fn_error $? "Cannot find FreeTDS in known installation directories" "$LINENO" 5
     fi
 
   elif test "$PHP_PDO_DBLIB" != "no"; then
@@ -68516,7 +69785,7 @@
       PDO_FREETDS_INSTALLATION_DIR=$PHP_PDO_DBLIB
       PDO_FREETDS_INCLUDE_DIR=$PHP_PDO_DBLIB/include/freetds
     else
-      as_fn_error "Directory $PHP_PDO_DBLIB is not a FreeTDS installation directory" "$LINENO" 5
+      as_fn_error $? "Directory $PHP_PDO_DBLIB is not a FreeTDS installation directory" "$LINENO" 5
     fi
   fi
 
@@ -68525,7 +69794,7 @@
   fi
 
   if test ! -r "$PDO_FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.a" && test ! -r "$PDO_FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.so"; then
-     as_fn_error "Could not find $PDO_FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.a|so" "$LINENO" 5
+     as_fn_error $? "Could not find $PDO_FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.a|so" "$LINENO" 5
   fi
 
 
@@ -68661,7 +69930,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PDO includes" >&5
 $as_echo_n "checking for PDO includes... " >&6; }
-if test "${pdo_cv_inc_path+set}" = set; then :
+if ${pdo_cv_inc_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -68681,7 +69950,7 @@
   if test -n "$pdo_cv_inc_path"; then
 :
   else
-as_fn_error "Cannot find php_pdo_driver.h." "$LINENO" 5
+as_fn_error $? "Cannot find php_pdo_driver.h." "$LINENO" 5
   fi
 
 
@@ -68982,7 +70251,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dnet_addr in -ldnet_stub" >&5
 $as_echo_n "checking for dnet_addr in -ldnet_stub... " >&6; }
-if test "${ac_cv_lib_dnet_stub_dnet_addr+set}" = set; then :
+if ${ac_cv_lib_dnet_stub_dnet_addr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -69016,7 +70285,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dnet_stub_dnet_addr" >&5
 $as_echo "$ac_cv_lib_dnet_stub_dnet_addr" >&6; }
-if test "x$ac_cv_lib_dnet_stub_dnet_addr" = x""yes; then :
+if test "x$ac_cv_lib_dnet_stub_dnet_addr" = xyes; then :
 
 
   if test "$ext_shared" = "yes"; then
@@ -69136,7 +70405,7 @@
   is_it_shared=$PHP_PDO_SHARED
   is_it_enabled=$PHP_PDO
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_dblib to build statically, but it
 depends on extension pdo, which you've configured to build shared.
 You either need to build pdo_dblib shared or build pdo statically for the
@@ -69144,7 +70413,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_dblib, which depends on extension pdo,
 but you've either not enabled pdo, or have disabled it.
 " "$LINENO" 5
@@ -69202,7 +70471,7 @@
 if test "$PHP_PDO_FIREBIRD" != "no"; then
 
   if test "$PHP_PDO" = "no" && test "$ext_shared" = "no"; then
-    as_fn_error "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
+    as_fn_error $? "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
   fi
 
   if test "$PHP_PDO_FIREBIRD" = "yes"; then
@@ -69314,7 +70583,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for isc_detach_database in -lfbclient" >&5
 $as_echo_n "checking for isc_detach_database in -lfbclient... " >&6; }
-if test "${ac_cv_lib_fbclient_isc_detach_database+set}" = set; then :
+if ${ac_cv_lib_fbclient_isc_detach_database+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -69348,7 +70617,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_fbclient_isc_detach_database" >&5
 $as_echo "$ac_cv_lib_fbclient_isc_detach_database" >&6; }
-if test "x$ac_cv_lib_fbclient_isc_detach_database" = x""yes; then :
+if test "x$ac_cv_lib_fbclient_isc_detach_database" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -69461,7 +70730,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for isc_detach_database in -lgds" >&5
 $as_echo_n "checking for isc_detach_database in -lgds... " >&6; }
-if test "${ac_cv_lib_gds_isc_detach_database+set}" = set; then :
+if ${ac_cv_lib_gds_isc_detach_database+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -69495,7 +70764,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gds_isc_detach_database" >&5
 $as_echo "$ac_cv_lib_gds_isc_detach_database" >&6; }
-if test "x$ac_cv_lib_gds_isc_detach_database" = x""yes; then :
+if test "x$ac_cv_lib_gds_isc_detach_database" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -69608,7 +70877,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for isc_detach_database in -lib_util" >&5
 $as_echo_n "checking for isc_detach_database in -lib_util... " >&6; }
-if test "${ac_cv_lib_ib_util_isc_detach_database+set}" = set; then :
+if ${ac_cv_lib_ib_util_isc_detach_database+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -69642,7 +70911,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ib_util_isc_detach_database" >&5
 $as_echo "$ac_cv_lib_ib_util_isc_detach_database" >&6; }
-if test "x$ac_cv_lib_ib_util_isc_detach_database" = x""yes; then :
+if test "x$ac_cv_lib_ib_util_isc_detach_database" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -69656,7 +70925,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_ib_util_isc_detach_database
 
-        as_fn_error "libfbclient, libgds or libib_util not found! Check config.log for more information." "$LINENO" 5
+        as_fn_error $? "libfbclient, libgds or libib_util not found! Check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -69673,7 +70942,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PDO includes" >&5
 $as_echo_n "checking for PDO includes... " >&6; }
-if test "${pdo_cv_inc_path+set}" = set; then :
+if ${pdo_cv_inc_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -69693,7 +70962,7 @@
   if test -n "$pdo_cv_inc_path"; then
 :
   else
-as_fn_error "Cannot find php_pdo_driver.h." "$LINENO" 5
+as_fn_error $? "Cannot find php_pdo_driver.h." "$LINENO" 5
   fi
 
 
@@ -70129,7 +71398,7 @@
   is_it_shared=$PHP_PDO_SHARED
   is_it_enabled=$PHP_PDO
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_firebird to build statically, but it
 depends on extension pdo, which you've configured to build shared.
 You either need to build pdo_firebird shared or build pdo statically for the
@@ -70137,7 +71406,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_firebird, which depends on extension pdo,
 but you've either not enabled pdo, or have disabled it.
 " "$LINENO" 5
@@ -70220,7 +71489,7 @@
 if test "$PHP_PDO_MYSQL" != "no"; then
 
   if test "$PHP_PDO" = "no" && test "$ext_shared" = "no"; then
-    as_fn_error "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
+    as_fn_error $? "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
   fi
 
 
@@ -70259,7 +71528,7 @@
 set dummy sed; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_SED+set}" = set; then :
+if ${ac_cv_path_SED+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $SED in
@@ -70326,7 +71595,7 @@
       else
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: can not find it" >&5
 $as_echo "can not find it" >&6; }
-        as_fn_error "Unable to find your mysql installation" "$LINENO" 5
+        as_fn_error $? "Unable to find your mysql installation" "$LINENO" 5
       fi
 
 
@@ -70364,7 +71633,7 @@
     else
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
-      as_fn_error "Unable to find your mysql installation" "$LINENO" 5
+      as_fn_error $? "Unable to find your mysql installation" "$LINENO" 5
     fi
 
 
@@ -70467,7 +71736,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$PDO_MYSQL_LIBNAME''_mysql_commit" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mysql_commit in -l$PDO_MYSQL_LIBNAME" >&5
 $as_echo_n "checking for mysql_commit in -l$PDO_MYSQL_LIBNAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -70502,8 +71771,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -70843,7 +72111,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$PDO_MYSQL_LIBNAME''_mysql_commit" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mysql_commit in -l$PDO_MYSQL_LIBNAME" >&5
 $as_echo_n "checking for mysql_commit in -l$PDO_MYSQL_LIBNAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -70878,8 +72146,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -70891,7 +72158,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_$PDO_MYSQL_LIBNAME_mysql_commit
 
-          as_fn_error "PDO_MYSQL configure failed, MySQL 4.1 needed. Please check config.log for more information." "$LINENO" 5
+          as_fn_error $? "PDO_MYSQL configure failed, MySQL 4.1 needed. Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -71021,7 +72288,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$PDO_MYSQL_LIBNAME''_mysql_query" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mysql_query in -l$PDO_MYSQL_LIBNAME" >&5
 $as_echo_n "checking for mysql_query in -l$PDO_MYSQL_LIBNAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -71056,8 +72323,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -71069,7 +72335,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_$PDO_MYSQL_LIBNAME_mysql_query
 
-          as_fn_error "Try adding --with-zlib-dir=<DIR>. Please check config.log for more information." "$LINENO" 5
+          as_fn_error $? "Try adding --with-zlib-dir=<DIR>. Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -71216,7 +72482,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PDO includes" >&5
 $as_echo_n "checking for PDO includes... " >&6; }
-if test "${pdo_cv_inc_path+set}" = set; then :
+if ${pdo_cv_inc_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -71236,7 +72502,7 @@
   if test -n "$pdo_cv_inc_path"; then
 :
   else
-as_fn_error "Cannot find php_pdo_driver.h." "$LINENO" 5
+as_fn_error $? "Cannot find php_pdo_driver.h." "$LINENO" 5
   fi
 
 
@@ -71549,7 +72815,7 @@
   is_it_shared=$PHP_PDO_SHARED
   is_it_enabled=$PHP_PDO
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_mysql to build statically, but it
 depends on extension pdo, which you've configured to build shared.
 You either need to build pdo_mysql shared or build pdo statically for the
@@ -71557,7 +72823,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_mysql, which depends on extension pdo,
 but you've either not enabled pdo, or have disabled it.
 " "$LINENO" 5
@@ -71569,7 +72835,7 @@
   is_it_shared=$PHP_MYSQLND_SHARED
   is_it_enabled=$PHP_MYSQLND
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_mysql to build statically, but it
 depends on extension mysqlnd, which you've configured to build shared.
 You either need to build pdo_mysql shared or build mysqlnd statically for the
@@ -71577,7 +72843,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_mysql, which depends on extension mysqlnd,
 but you've either not enabled mysqlnd, or have disabled it.
 " "$LINENO" 5
@@ -71652,7 +72918,7 @@
 if test "$PHP_PDO_OCI" != "no"; then
 
   if test "$PHP_PDO" = "no" && test "$ext_shared" = "no"; then
-    as_fn_error "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
+    as_fn_error $? "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
   fi
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking Oracle Install-Dir" >&5
@@ -71668,7 +72934,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking if that is sane" >&5
 $as_echo_n "checking if that is sane... " >&6; }
   if test -z "$PDO_OCI_DIR"; then
-    as_fn_error "
+    as_fn_error $? "
 You need to tell me where to find your Oracle Instant Client SDK, or set ORACLE_HOME.
 " "$LINENO" 5
   else
@@ -71683,7 +72949,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long int" >&5
 $as_echo_n "checking size of long int... " >&6; }
-if test "${ac_cv_sizeof_long_int+set}" = set; then :
+if ${ac_cv_sizeof_long_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long int))" "ac_cv_sizeof_long_int"        "$ac_includes_default"; then :
@@ -71692,9 +72958,8 @@
   if test "$ac_cv_type_long_int" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long int)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long int)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long_int=0
    fi
@@ -71864,7 +73129,7 @@
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PDO_OCI_IC_PREFIX/$PDO_OCI_CLIENT_DIR/include" >&5
 $as_echo "$PDO_OCI_IC_PREFIX/$PDO_OCI_CLIENT_DIR/include" >&6; }
     else
-      as_fn_error "I'm too dumb to figure out where the include dir is in your Instant Client install" "$LINENO" 5
+      as_fn_error $? "I'm too dumb to figure out where the include dir is in your Instant Client install" "$LINENO" 5
     fi
     if test -f "$PDO_OCI_IC_PREFIX/lib/oracle/$PDO_OCI_IC_VERS/$PDO_OCI_CLIENT_DIR/lib/libclntsh.$SHLIB_SUFFIX_NAME" ; then
     PDO_OCI_LIB_DIR="$PDO_OCI_IC_PREFIX/lib/oracle/$PDO_OCI_IC_VERS/$PDO_OCI_CLIENT_DIR/lib"
@@ -71873,7 +73138,7 @@
     elif test -f "$PDO_OCI_IC_PREFIX/libclntsh.$SHLIB_SUFFIX_NAME" ; then
       PDO_OCI_LIB_DIR="$PDO_OCI_IC_PREFIX"
     else
-      as_fn_error "I'm too dumb to figure out where the libraries are in your Instant Client install" "$LINENO" 5
+      as_fn_error $? "I'm too dumb to figure out where the libraries are in your Instant Client install" "$LINENO" 5
     fi
     PDO_OCI_VERSION="`echo $PDO_OCI_IC_VERS | cut -d. -f1-2`"
   else
@@ -71884,7 +73149,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long int" >&5
 $as_echo_n "checking size of long int... " >&6; }
-if test "${ac_cv_sizeof_long_int+set}" = set; then :
+if ${ac_cv_sizeof_long_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long int))" "ac_cv_sizeof_long_int"        "$ac_includes_default"; then :
@@ -71893,9 +73158,8 @@
   if test "$ac_cv_type_long_int" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long int)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long int)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long_int=0
    fi
@@ -71933,7 +73197,7 @@
   elif test -d "$PDO_OCI_DIR/lib" && test -d "$PDO_OCI_DIR/lib32"; then
     PDO_OCI_LIB_DIR=$TMP_PDO_OCI_LIB_DIR
   else
-    as_fn_error "Oracle required OCI8 libraries not found" "$LINENO" 5
+    as_fn_error $? "Oracle required OCI8 libraries not found" "$LINENO" 5
   fi
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PDO_OCI_LIB_DIR" >&5
 $as_echo "$PDO_OCI_LIB_DIR" >&6; }
@@ -72300,7 +73564,7 @@
     fi
   done
   if test -z "$PDO_OCI_VERSION"; then
-    as_fn_error "Oracle required OCI8 libraries not found under $PDO_OCI_DIR" "$LINENO" 5
+    as_fn_error $? "Oracle required OCI8 libraries not found under $PDO_OCI_DIR" "$LINENO" 5
   fi
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PDO_OCI_VERSION" >&5
 $as_echo "$PDO_OCI_VERSION" >&6; }
@@ -72335,7 +73599,7 @@
       ;;
 
     *)
-      as_fn_error "Unsupported Oracle version $PDO_OCI_VERSION" "$LINENO" 5
+      as_fn_error $? "Unsupported Oracle version $PDO_OCI_VERSION" "$LINENO" 5
       ;;
   esac
 
@@ -72477,7 +73741,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for OCIEnvCreate in -lclntsh" >&5
 $as_echo_n "checking for OCIEnvCreate in -lclntsh... " >&6; }
-if test "${ac_cv_lib_clntsh_OCIEnvCreate+set}" = set; then :
+if ${ac_cv_lib_clntsh_OCIEnvCreate+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -72511,7 +73775,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_clntsh_OCIEnvCreate" >&5
 $as_echo "$ac_cv_lib_clntsh_OCIEnvCreate" >&6; }
-if test "x$ac_cv_lib_clntsh_OCIEnvCreate" = x""yes; then :
+if test "x$ac_cv_lib_clntsh_OCIEnvCreate" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -72630,7 +73894,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for OCIEnvNlsCreate in -lclntsh" >&5
 $as_echo_n "checking for OCIEnvNlsCreate in -lclntsh... " >&6; }
-if test "${ac_cv_lib_clntsh_OCIEnvNlsCreate+set}" = set; then :
+if ${ac_cv_lib_clntsh_OCIEnvNlsCreate+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -72664,7 +73928,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_clntsh_OCIEnvNlsCreate" >&5
 $as_echo "$ac_cv_lib_clntsh_OCIEnvNlsCreate" >&6; }
-if test "x$ac_cv_lib_clntsh_OCIEnvNlsCreate" = x""yes; then :
+if test "x$ac_cv_lib_clntsh_OCIEnvNlsCreate" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -72783,7 +74047,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for OCILobIsTemporary in -lclntsh" >&5
 $as_echo_n "checking for OCILobIsTemporary in -lclntsh... " >&6; }
-if test "${ac_cv_lib_clntsh_OCILobIsTemporary+set}" = set; then :
+if ${ac_cv_lib_clntsh_OCILobIsTemporary+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -72817,7 +74081,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_clntsh_OCILobIsTemporary" >&5
 $as_echo "$ac_cv_lib_clntsh_OCILobIsTemporary" >&6; }
-if test "x$ac_cv_lib_clntsh_OCILobIsTemporary" = x""yes; then :
+if test "x$ac_cv_lib_clntsh_OCILobIsTemporary" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -72932,7 +74196,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for OCILobIsTemporary in -locijdbc8" >&5
 $as_echo_n "checking for OCILobIsTemporary in -locijdbc8... " >&6; }
-if test "${ac_cv_lib_ocijdbc8_OCILobIsTemporary+set}" = set; then :
+if ${ac_cv_lib_ocijdbc8_OCILobIsTemporary+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -72966,7 +74230,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ocijdbc8_OCILobIsTemporary" >&5
 $as_echo "$ac_cv_lib_ocijdbc8_OCILobIsTemporary" >&6; }
-if test "x$ac_cv_lib_ocijdbc8_OCILobIsTemporary" = x""yes; then :
+if test "x$ac_cv_lib_ocijdbc8_OCILobIsTemporary" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -73112,7 +74376,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for OCICollAssign in -lclntsh" >&5
 $as_echo_n "checking for OCICollAssign in -lclntsh... " >&6; }
-if test "${ac_cv_lib_clntsh_OCICollAssign+set}" = set; then :
+if ${ac_cv_lib_clntsh_OCICollAssign+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -73146,7 +74410,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_clntsh_OCICollAssign" >&5
 $as_echo "$ac_cv_lib_clntsh_OCICollAssign" >&6; }
-if test "x$ac_cv_lib_clntsh_OCICollAssign" = x""yes; then :
+if test "x$ac_cv_lib_clntsh_OCICollAssign" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -73265,7 +74529,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for OCIStmtFetch2 in -lclntsh" >&5
 $as_echo_n "checking for OCIStmtFetch2 in -lclntsh... " >&6; }
-if test "${ac_cv_lib_clntsh_OCIStmtFetch2+set}" = set; then :
+if ${ac_cv_lib_clntsh_OCIStmtFetch2+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -73299,7 +74563,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_clntsh_OCIStmtFetch2" >&5
 $as_echo "$ac_cv_lib_clntsh_OCIStmtFetch2" >&6; }
-if test "x$ac_cv_lib_clntsh_OCIStmtFetch2" = x""yes; then :
+if test "x$ac_cv_lib_clntsh_OCIStmtFetch2" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -73323,7 +74587,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PDO includes" >&5
 $as_echo_n "checking for PDO includes... " >&6; }
-if test "${pdo_cv_inc_path+set}" = set; then :
+if ${pdo_cv_inc_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -73343,7 +74607,7 @@
   if test -n "$pdo_cv_inc_path"; then
 :
   else
-as_fn_error "Cannot find php_pdo_driver.h." "$LINENO" 5
+as_fn_error $? "Cannot find php_pdo_driver.h." "$LINENO" 5
   fi
 
 
@@ -73667,7 +74931,7 @@
   is_it_shared=$PHP_PDO_SHARED
   is_it_enabled=$PHP_PDO
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_oci to build statically, but it
 depends on extension pdo, which you've configured to build shared.
 You either need to build pdo_oci shared or build pdo statically for the
@@ -73675,7 +74939,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_oci, which depends on extension pdo,
 but you've either not enabled pdo, or have disabled it.
 " "$LINENO" 5
@@ -73745,14 +75009,14 @@
 if test "$PHP_PDO_ODBC" != "no"; then
 
   if test "$PHP_PDO" = "no" && test "$ext_shared" = "no"; then
-    as_fn_error "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
+    as_fn_error $? "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
   fi
 
 
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PDO includes" >&5
 $as_echo_n "checking for PDO includes... " >&6; }
-if test "${pdo_cv_inc_path+set}" = set; then :
+if ${pdo_cv_inc_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -73772,7 +75036,7 @@
   if test -n "$pdo_cv_inc_path"; then
 :
   else
-as_fn_error "Cannot find php_pdo_driver.h." "$LINENO" 5
+as_fn_error $? "Cannot find php_pdo_driver.h." "$LINENO" 5
   fi
 
 
@@ -73820,7 +75084,7 @@
         ;;
 
       *)
-        as_fn_error "Unknown ODBC flavour $pdo_odbc_flavour
+        as_fn_error $? "Unknown ODBC flavour $pdo_odbc_flavour
                             include and lib dirs are looked for under 'dir'.
 
                             'flavour' can be one of:  ibm-db2, iODBC, unixODBC, generic
@@ -74131,7 +75395,7 @@
 
 
   if test "$php_pdo_have_header" != "yes"; then
-    as_fn_error "Cannot find header file(s) for pdo_odbc" "$LINENO" 5
+    as_fn_error $? "Cannot find header file(s) for pdo_odbc" "$LINENO" 5
   fi
 
   PDO_ODBC_INCLUDE="$pdo_odbc_def_cflags -I$PDO_ODBC_INCDIR -DPDO_ODBC_TYPE=\\\"$pdo_odbc_flavour\\\""
@@ -74325,7 +75589,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$pdo_odbc_def_lib''_SQLBindCol" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SQLBindCol in -l$pdo_odbc_def_lib" >&5
 $as_echo_n "checking for SQLBindCol in -l$pdo_odbc_def_lib... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -74360,8 +75624,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -74464,7 +75727,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$pdo_odbc_def_lib''_SQLAllocHandle" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SQLAllocHandle in -l$pdo_odbc_def_lib" >&5
 $as_echo_n "checking for SQLAllocHandle in -l$pdo_odbc_def_lib... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -74499,8 +75762,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -74512,7 +75774,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_$pdo_odbc_def_lib_SQLAllocHandle
 
-      as_fn_error "
+      as_fn_error $? "
 Your ODBC library does not appear to be ODBC 3 compatible.
 You should consider using iODBC or unixODBC instead, and loading your
 libraries as a driver in that environment; it will emulate the
@@ -74529,7 +75791,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_$pdo_odbc_def_lib_SQLBindCol
 
-    as_fn_error "Your ODBC library does not exist or there was an error. Check config.log for more information" "$LINENO" 5
+    as_fn_error $? "Your ODBC library does not exist or there was an error. Check config.log for more information" "$LINENO" 5
 
 
 fi
@@ -74837,7 +76099,7 @@
   is_it_shared=$PHP_PDO_SHARED
   is_it_enabled=$PHP_PDO
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_odbc to build statically, but it
 depends on extension pdo, which you've configured to build shared.
 You either need to build pdo_odbc shared or build pdo statically for the
@@ -74845,7 +76107,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_odbc, which depends on extension pdo,
 but you've either not enabled pdo, or have disabled it.
 " "$LINENO" 5
@@ -74903,7 +76165,7 @@
 if test "$PHP_PDO_PGSQL" != "no"; then
 
   if test "$PHP_PDO" = "no" && test "$ext_shared" = "no"; then
-    as_fn_error "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
+    as_fn_error $? "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
   fi
 
 
@@ -74966,15 +76228,15 @@
   fi
 
   if test -z "$PGSQL_INCLUDE"; then
-    as_fn_error "Cannot find libpq-fe.h. Please specify correct PostgreSQL installation path" "$LINENO" 5
+    as_fn_error $? "Cannot find libpq-fe.h. Please specify correct PostgreSQL installation path" "$LINENO" 5
   fi
 
   if test -z "$PGSQL_LIBDIR"; then
-    as_fn_error "Cannot find libpq.so. Please specify correct PostgreSQL installation path" "$LINENO" 5
+    as_fn_error $? "Cannot find libpq.so. Please specify correct PostgreSQL installation path" "$LINENO" 5
   fi
 
   if test -z "$PGSQL_INCLUDE" -a -z "$PGSQL_LIBDIR" ; then
-    as_fn_error "Unable to find libpq anywhere under $PGSQL_SEARCH_PATHS" "$LINENO" 5
+    as_fn_error $? "Unable to find libpq anywhere under $PGSQL_SEARCH_PATHS" "$LINENO" 5
   fi
 
 
@@ -74991,7 +76253,7 @@
 set dummy pkg-config; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_PKG_CONFIG+set}" = set; then :
+if ${ac_cv_path_PKG_CONFIG+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $PKG_CONFIG in
@@ -75041,7 +76303,7 @@
   LDFLAGS="-L$PGSQL_LIBDIR $LDFLAGS"
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQparameterStatus in -lpq" >&5
 $as_echo_n "checking for PQparameterStatus in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQparameterStatus+set}" = set; then :
+if ${ac_cv_lib_pq_PQparameterStatus+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -75075,7 +76337,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQparameterStatus" >&5
 $as_echo "$ac_cv_lib_pq_PQparameterStatus" >&6; }
-if test "x$ac_cv_lib_pq_PQparameterStatus" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQparameterStatus" = xyes; then :
 
 $as_echo "#define HAVE_PQPARAMETERSTATUS 1" >>confdefs.h
 
@@ -75089,7 +76351,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQprepare in -lpq" >&5
 $as_echo_n "checking for PQprepare in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQprepare+set}" = set; then :
+if ${ac_cv_lib_pq_PQprepare+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -75123,7 +76385,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQprepare" >&5
 $as_echo "$ac_cv_lib_pq_PQprepare" >&6; }
-if test "x$ac_cv_lib_pq_PQprepare" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQprepare" = xyes; then :
 
 $as_echo "#define HAVE_PQPREPARE 1" >>confdefs.h
 
@@ -75131,7 +76393,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQescapeStringConn in -lpq" >&5
 $as_echo_n "checking for PQescapeStringConn in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQescapeStringConn+set}" = set; then :
+if ${ac_cv_lib_pq_PQescapeStringConn+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -75165,7 +76427,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQescapeStringConn" >&5
 $as_echo "$ac_cv_lib_pq_PQescapeStringConn" >&6; }
-if test "x$ac_cv_lib_pq_PQescapeStringConn" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQescapeStringConn" = xyes; then :
 
 $as_echo "#define HAVE_PQESCAPE_CONN 1" >>confdefs.h
 
@@ -75173,7 +76435,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQescapeByteaConn in -lpq" >&5
 $as_echo_n "checking for PQescapeByteaConn in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQescapeByteaConn+set}" = set; then :
+if ${ac_cv_lib_pq_PQescapeByteaConn+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -75207,7 +76469,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQescapeByteaConn" >&5
 $as_echo "$ac_cv_lib_pq_PQescapeByteaConn" >&6; }
-if test "x$ac_cv_lib_pq_PQescapeByteaConn" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQescapeByteaConn" = xyes; then :
 
 $as_echo "#define HAVE_PQESCAPE_BYTEA_CONN 1" >>confdefs.h
 
@@ -75216,7 +76478,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pg_encoding_to_char in -lpq" >&5
 $as_echo_n "checking for pg_encoding_to_char in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_pg_encoding_to_char+set}" = set; then :
+if ${ac_cv_lib_pq_pg_encoding_to_char+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -75250,7 +76512,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_pg_encoding_to_char" >&5
 $as_echo "$ac_cv_lib_pq_pg_encoding_to_char" >&6; }
-if test "x$ac_cv_lib_pq_pg_encoding_to_char" = x""yes; then :
+if test "x$ac_cv_lib_pq_pg_encoding_to_char" = xyes; then :
 
 $as_echo "#define HAVE_PGSQL_WITH_MULTIBYTE_SUPPORT 1" >>confdefs.h
 
@@ -75398,7 +76660,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PDO includes" >&5
 $as_echo_n "checking for PDO includes... " >&6; }
-if test "${pdo_cv_inc_path+set}" = set; then :
+if ${pdo_cv_inc_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -75418,7 +76680,7 @@
   if test -n "$pdo_cv_inc_path"; then
 :
   else
-as_fn_error "Cannot find php_pdo_driver.h." "$LINENO" 5
+as_fn_error $? "Cannot find php_pdo_driver.h." "$LINENO" 5
   fi
 
 
@@ -75722,7 +76984,7 @@
   is_it_shared=$PHP_PDO_SHARED
   is_it_enabled=$PHP_PDO
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_pgsql to build statically, but it
 depends on extension pdo, which you've configured to build shared.
 You either need to build pdo_pgsql shared or build pdo statically for the
@@ -75730,7 +76992,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_pgsql, which depends on extension pdo,
 but you've either not enabled pdo, or have disabled it.
 " "$LINENO" 5
@@ -75788,14 +77050,14 @@
 if test "$PHP_PDO_SQLITE" != "no"; then
 
   if test "$PHP_PDO" = "no" && test "$ext_shared" = "no"; then
-    as_fn_error "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
+    as_fn_error $? "PDO is not enabled! Add --enable-pdo to your configure line." "$LINENO" 5
   fi
 
 
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PDO includes" >&5
 $as_echo_n "checking for PDO includes... " >&6; }
-if test "${pdo_cv_inc_path+set}" = set; then :
+if ${pdo_cv_inc_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -75815,7 +77077,7 @@
   if test -n "$pdo_cv_inc_path"; then
 :
   else
-as_fn_error "Cannot find php_pdo_driver.h." "$LINENO" 5
+as_fn_error $? "Cannot find php_pdo_driver.h." "$LINENO" 5
   fi
 
 
@@ -75841,7 +77103,7 @@
     if test -z "$PDO_SQLITE_DIR"; then
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
-      as_fn_error "Please reinstall the sqlite3 distribution" "$LINENO" 5
+      as_fn_error $? "Please reinstall the sqlite3 distribution" "$LINENO" 5
     fi
 
 
@@ -75979,7 +77241,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$LIBNAME''_$LIBSYMBOL" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $LIBSYMBOL in -l$LIBNAME" >&5
 $as_echo_n "checking for $LIBSYMBOL in -l$LIBNAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -76014,8 +77276,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -76128,7 +77389,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_$LIBNAME_$LIBSYMBOL
 
-      as_fn_error "wrong sqlite lib version or lib not found" "$LINENO" 5
+      as_fn_error $? "wrong sqlite lib version or lib not found" "$LINENO" 5
 
 
 fi
@@ -76230,7 +77491,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sqlite3_key in -lsqlite3" >&5
 $as_echo_n "checking for sqlite3_key in -lsqlite3... " >&6; }
-if test "${ac_cv_lib_sqlite3_sqlite3_key+set}" = set; then :
+if ${ac_cv_lib_sqlite3_sqlite3_key+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -76264,7 +77525,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sqlite3_sqlite3_key" >&5
 $as_echo "$ac_cv_lib_sqlite3_sqlite3_key" >&6; }
-if test "x$ac_cv_lib_sqlite3_sqlite3_key" = x""yes; then :
+if test "x$ac_cv_lib_sqlite3_sqlite3_key" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -76942,7 +78203,7 @@
   is_it_shared=$PHP_SQLITE3_SHARED
   is_it_enabled=$PHP_SQLITE3
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_sqlite to build statically, but it
 depends on extension sqlite3, which you've configured to build shared.
 You either need to build pdo_sqlite shared or build sqlite3 statically for the
@@ -76950,7 +78211,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_sqlite, which depends on extension sqlite3,
 but you've either not enabled sqlite3, or have disabled it.
 " "$LINENO" 5
@@ -76992,8 +78253,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -77004,7 +78264,7 @@
       for ac_header in time.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "time.h" "ac_cv_header_time_h" "$ac_includes_default"
-if test "x$ac_cv_header_time_h" = x""yes; then :
+if test "x$ac_cv_header_time_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_TIME_H 1
 _ACEOF
@@ -77112,7 +78372,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for fdatasync in -lrt" >&5
 $as_echo_n "checking for fdatasync in -lrt... " >&6; }
-if test "${ac_cv_lib_rt_fdatasync+set}" = set; then :
+if ${ac_cv_lib_rt_fdatasync+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77146,7 +78406,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_rt_fdatasync" >&5
 $as_echo "$ac_cv_lib_rt_fdatasync" >&6; }
-if test "x$ac_cv_lib_rt_fdatasync" = x""yes; then :
+if test "x$ac_cv_lib_rt_fdatasync" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -77190,7 +78450,7 @@
   is_it_shared=$PHP_PDO_SHARED
   is_it_enabled=$PHP_PDO
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_sqlite to build statically, but it
 depends on extension pdo, which you've configured to build shared.
 You either need to build pdo_sqlite shared or build pdo statically for the
@@ -77198,7 +78458,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension pdo_sqlite, which depends on extension pdo,
 but you've either not enabled pdo, or have disabled it.
 " "$LINENO" 5
@@ -77316,15 +78576,15 @@
   fi
 
   if test -z "$PGSQL_INCLUDE"; then
-    as_fn_error "Cannot find libpq-fe.h. Please specify correct PostgreSQL installation path" "$LINENO" 5
+    as_fn_error $? "Cannot find libpq-fe.h. Please specify correct PostgreSQL installation path" "$LINENO" 5
   fi
 
   if test -z "$PGSQL_LIBDIR"; then
-    as_fn_error "Cannot find libpq.so. Please specify correct PostgreSQL installation path" "$LINENO" 5
+    as_fn_error $? "Cannot find libpq.so. Please specify correct PostgreSQL installation path" "$LINENO" 5
   fi
 
   if test -z "$PGSQL_INCLUDE" -a -z "$PGSQL_LIBDIR" ; then
-    as_fn_error "Unable to find libpq anywhere under $PGSQL_SEARCH_PATHS" "$LINENO" 5
+    as_fn_error $? "Unable to find libpq anywhere under $PGSQL_SEARCH_PATHS" "$LINENO" 5
   fi
 
 
@@ -77335,7 +78595,7 @@
   LDFLAGS="-L$PGSQL_LIBDIR $LDFLAGS"
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQescapeString in -lpq" >&5
 $as_echo_n "checking for PQescapeString in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQescapeString+set}" = set; then :
+if ${ac_cv_lib_pq_PQescapeString+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77369,7 +78629,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQescapeString" >&5
 $as_echo "$ac_cv_lib_pq_PQescapeString" >&6; }
-if test "x$ac_cv_lib_pq_PQescapeString" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQescapeString" = xyes; then :
 
 $as_echo "#define HAVE_PQESCAPE 1" >>confdefs.h
 
@@ -77377,7 +78637,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQunescapeBytea in -lpq" >&5
 $as_echo_n "checking for PQunescapeBytea in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQunescapeBytea+set}" = set; then :
+if ${ac_cv_lib_pq_PQunescapeBytea+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77411,7 +78671,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQunescapeBytea" >&5
 $as_echo "$ac_cv_lib_pq_PQunescapeBytea" >&6; }
-if test "x$ac_cv_lib_pq_PQunescapeBytea" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQunescapeBytea" = xyes; then :
 
 $as_echo "#define HAVE_PQUNESCAPEBYTEA 1" >>confdefs.h
 
@@ -77419,7 +78679,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQsetnonblocking in -lpq" >&5
 $as_echo_n "checking for PQsetnonblocking in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQsetnonblocking+set}" = set; then :
+if ${ac_cv_lib_pq_PQsetnonblocking+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77453,7 +78713,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQsetnonblocking" >&5
 $as_echo "$ac_cv_lib_pq_PQsetnonblocking" >&6; }
-if test "x$ac_cv_lib_pq_PQsetnonblocking" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQsetnonblocking" = xyes; then :
 
 $as_echo "#define HAVE_PQSETNONBLOCKING 1" >>confdefs.h
 
@@ -77461,7 +78721,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQcmdTuples in -lpq" >&5
 $as_echo_n "checking for PQcmdTuples in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQcmdTuples+set}" = set; then :
+if ${ac_cv_lib_pq_PQcmdTuples+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77495,7 +78755,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQcmdTuples" >&5
 $as_echo "$ac_cv_lib_pq_PQcmdTuples" >&6; }
-if test "x$ac_cv_lib_pq_PQcmdTuples" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQcmdTuples" = xyes; then :
 
 $as_echo "#define HAVE_PQCMDTUPLES 1" >>confdefs.h
 
@@ -77503,7 +78763,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQoidValue in -lpq" >&5
 $as_echo_n "checking for PQoidValue in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQoidValue+set}" = set; then :
+if ${ac_cv_lib_pq_PQoidValue+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77537,7 +78797,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQoidValue" >&5
 $as_echo "$ac_cv_lib_pq_PQoidValue" >&6; }
-if test "x$ac_cv_lib_pq_PQoidValue" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQoidValue" = xyes; then :
 
 $as_echo "#define HAVE_PQOIDVALUE 1" >>confdefs.h
 
@@ -77545,7 +78805,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQclientEncoding in -lpq" >&5
 $as_echo_n "checking for PQclientEncoding in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQclientEncoding+set}" = set; then :
+if ${ac_cv_lib_pq_PQclientEncoding+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77579,7 +78839,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQclientEncoding" >&5
 $as_echo "$ac_cv_lib_pq_PQclientEncoding" >&6; }
-if test "x$ac_cv_lib_pq_PQclientEncoding" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQclientEncoding" = xyes; then :
 
 $as_echo "#define HAVE_PQCLIENTENCODING 1" >>confdefs.h
 
@@ -77587,7 +78847,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQparameterStatus in -lpq" >&5
 $as_echo_n "checking for PQparameterStatus in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQparameterStatus+set}" = set; then :
+if ${ac_cv_lib_pq_PQparameterStatus+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77621,7 +78881,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQparameterStatus" >&5
 $as_echo "$ac_cv_lib_pq_PQparameterStatus" >&6; }
-if test "x$ac_cv_lib_pq_PQparameterStatus" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQparameterStatus" = xyes; then :
 
 $as_echo "#define HAVE_PQPARAMETERSTATUS 1" >>confdefs.h
 
@@ -77629,7 +78889,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQprotocolVersion in -lpq" >&5
 $as_echo_n "checking for PQprotocolVersion in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQprotocolVersion+set}" = set; then :
+if ${ac_cv_lib_pq_PQprotocolVersion+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77663,7 +78923,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQprotocolVersion" >&5
 $as_echo "$ac_cv_lib_pq_PQprotocolVersion" >&6; }
-if test "x$ac_cv_lib_pq_PQprotocolVersion" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQprotocolVersion" = xyes; then :
 
 $as_echo "#define HAVE_PQPROTOCOLVERSION 1" >>confdefs.h
 
@@ -77671,7 +78931,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQtransactionStatus in -lpq" >&5
 $as_echo_n "checking for PQtransactionStatus in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQtransactionStatus+set}" = set; then :
+if ${ac_cv_lib_pq_PQtransactionStatus+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77705,7 +78965,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQtransactionStatus" >&5
 $as_echo "$ac_cv_lib_pq_PQtransactionStatus" >&6; }
-if test "x$ac_cv_lib_pq_PQtransactionStatus" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQtransactionStatus" = xyes; then :
 
 $as_echo "#define HAVE_PGTRANSACTIONSTATUS 1" >>confdefs.h
 
@@ -77713,7 +78973,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQexecParams in -lpq" >&5
 $as_echo_n "checking for PQexecParams in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQexecParams+set}" = set; then :
+if ${ac_cv_lib_pq_PQexecParams+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77747,7 +79007,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQexecParams" >&5
 $as_echo "$ac_cv_lib_pq_PQexecParams" >&6; }
-if test "x$ac_cv_lib_pq_PQexecParams" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQexecParams" = xyes; then :
 
 $as_echo "#define HAVE_PQEXECPARAMS 1" >>confdefs.h
 
@@ -77755,7 +79015,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQprepare in -lpq" >&5
 $as_echo_n "checking for PQprepare in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQprepare+set}" = set; then :
+if ${ac_cv_lib_pq_PQprepare+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77789,7 +79049,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQprepare" >&5
 $as_echo "$ac_cv_lib_pq_PQprepare" >&6; }
-if test "x$ac_cv_lib_pq_PQprepare" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQprepare" = xyes; then :
 
 $as_echo "#define HAVE_PQPREPARE 1" >>confdefs.h
 
@@ -77797,7 +79057,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQexecPrepared in -lpq" >&5
 $as_echo_n "checking for PQexecPrepared in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQexecPrepared+set}" = set; then :
+if ${ac_cv_lib_pq_PQexecPrepared+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77831,7 +79091,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQexecPrepared" >&5
 $as_echo "$ac_cv_lib_pq_PQexecPrepared" >&6; }
-if test "x$ac_cv_lib_pq_PQexecPrepared" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQexecPrepared" = xyes; then :
 
 $as_echo "#define HAVE_PQEXECPREPARED 1" >>confdefs.h
 
@@ -77839,7 +79099,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQresultErrorField in -lpq" >&5
 $as_echo_n "checking for PQresultErrorField in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQresultErrorField+set}" = set; then :
+if ${ac_cv_lib_pq_PQresultErrorField+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77873,7 +79133,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQresultErrorField" >&5
 $as_echo "$ac_cv_lib_pq_PQresultErrorField" >&6; }
-if test "x$ac_cv_lib_pq_PQresultErrorField" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQresultErrorField" = xyes; then :
 
 $as_echo "#define HAVE_PQRESULTERRORFIELD 1" >>confdefs.h
 
@@ -77881,7 +79141,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQsendQueryParams in -lpq" >&5
 $as_echo_n "checking for PQsendQueryParams in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQsendQueryParams+set}" = set; then :
+if ${ac_cv_lib_pq_PQsendQueryParams+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77915,7 +79175,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQsendQueryParams" >&5
 $as_echo "$ac_cv_lib_pq_PQsendQueryParams" >&6; }
-if test "x$ac_cv_lib_pq_PQsendQueryParams" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQsendQueryParams" = xyes; then :
 
 $as_echo "#define HAVE_PQSENDQUERYPARAMS 1" >>confdefs.h
 
@@ -77923,7 +79183,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQsendPrepare in -lpq" >&5
 $as_echo_n "checking for PQsendPrepare in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQsendPrepare+set}" = set; then :
+if ${ac_cv_lib_pq_PQsendPrepare+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77957,7 +79217,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQsendPrepare" >&5
 $as_echo "$ac_cv_lib_pq_PQsendPrepare" >&6; }
-if test "x$ac_cv_lib_pq_PQsendPrepare" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQsendPrepare" = xyes; then :
 
 $as_echo "#define HAVE_PQSENDPREPARE 1" >>confdefs.h
 
@@ -77965,7 +79225,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQsendQueryPrepared in -lpq" >&5
 $as_echo_n "checking for PQsendQueryPrepared in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQsendQueryPrepared+set}" = set; then :
+if ${ac_cv_lib_pq_PQsendQueryPrepared+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -77999,7 +79259,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQsendQueryPrepared" >&5
 $as_echo "$ac_cv_lib_pq_PQsendQueryPrepared" >&6; }
-if test "x$ac_cv_lib_pq_PQsendQueryPrepared" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQsendQueryPrepared" = xyes; then :
 
 $as_echo "#define HAVE_PQSENDQUERYPREPARED 1" >>confdefs.h
 
@@ -78007,7 +79267,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQputCopyData in -lpq" >&5
 $as_echo_n "checking for PQputCopyData in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQputCopyData+set}" = set; then :
+if ${ac_cv_lib_pq_PQputCopyData+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78041,7 +79301,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQputCopyData" >&5
 $as_echo "$ac_cv_lib_pq_PQputCopyData" >&6; }
-if test "x$ac_cv_lib_pq_PQputCopyData" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQputCopyData" = xyes; then :
 
 $as_echo "#define HAVE_PQPUTCOPYDATA 1" >>confdefs.h
 
@@ -78049,7 +79309,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQputCopyEnd in -lpq" >&5
 $as_echo_n "checking for PQputCopyEnd in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQputCopyEnd+set}" = set; then :
+if ${ac_cv_lib_pq_PQputCopyEnd+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78083,7 +79343,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQputCopyEnd" >&5
 $as_echo "$ac_cv_lib_pq_PQputCopyEnd" >&6; }
-if test "x$ac_cv_lib_pq_PQputCopyEnd" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQputCopyEnd" = xyes; then :
 
 $as_echo "#define HAVE_PQPUTCOPYEND 1" >>confdefs.h
 
@@ -78091,7 +79351,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQgetCopyData in -lpq" >&5
 $as_echo_n "checking for PQgetCopyData in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQgetCopyData+set}" = set; then :
+if ${ac_cv_lib_pq_PQgetCopyData+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78125,7 +79385,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQgetCopyData" >&5
 $as_echo "$ac_cv_lib_pq_PQgetCopyData" >&6; }
-if test "x$ac_cv_lib_pq_PQgetCopyData" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQgetCopyData" = xyes; then :
 
 $as_echo "#define HAVE_PQGETCOPYDATA 1" >>confdefs.h
 
@@ -78133,7 +79393,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQfreemem in -lpq" >&5
 $as_echo_n "checking for PQfreemem in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQfreemem+set}" = set; then :
+if ${ac_cv_lib_pq_PQfreemem+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78167,7 +79427,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQfreemem" >&5
 $as_echo "$ac_cv_lib_pq_PQfreemem" >&6; }
-if test "x$ac_cv_lib_pq_PQfreemem" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQfreemem" = xyes; then :
 
 $as_echo "#define HAVE_PQFREEMEM 1" >>confdefs.h
 
@@ -78175,7 +79435,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQsetErrorVerbosity in -lpq" >&5
 $as_echo_n "checking for PQsetErrorVerbosity in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQsetErrorVerbosity+set}" = set; then :
+if ${ac_cv_lib_pq_PQsetErrorVerbosity+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78209,7 +79469,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQsetErrorVerbosity" >&5
 $as_echo "$ac_cv_lib_pq_PQsetErrorVerbosity" >&6; }
-if test "x$ac_cv_lib_pq_PQsetErrorVerbosity" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQsetErrorVerbosity" = xyes; then :
 
 $as_echo "#define HAVE_PQSETERRORVERBOSITY 1" >>confdefs.h
 
@@ -78217,7 +79477,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQftable in -lpq" >&5
 $as_echo_n "checking for PQftable in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQftable+set}" = set; then :
+if ${ac_cv_lib_pq_PQftable+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78251,7 +79511,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQftable" >&5
 $as_echo "$ac_cv_lib_pq_PQftable" >&6; }
-if test "x$ac_cv_lib_pq_PQftable" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQftable" = xyes; then :
 
 $as_echo "#define HAVE_PQFTABLE 1" >>confdefs.h
 
@@ -78259,7 +79519,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQescapeStringConn in -lpq" >&5
 $as_echo_n "checking for PQescapeStringConn in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQescapeStringConn+set}" = set; then :
+if ${ac_cv_lib_pq_PQescapeStringConn+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78293,7 +79553,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQescapeStringConn" >&5
 $as_echo "$ac_cv_lib_pq_PQescapeStringConn" >&6; }
-if test "x$ac_cv_lib_pq_PQescapeStringConn" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQescapeStringConn" = xyes; then :
 
 $as_echo "#define HAVE_PQESCAPE_CONN 1" >>confdefs.h
 
@@ -78301,7 +79561,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQescapeByteaConn in -lpq" >&5
 $as_echo_n "checking for PQescapeByteaConn in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQescapeByteaConn+set}" = set; then :
+if ${ac_cv_lib_pq_PQescapeByteaConn+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78335,7 +79595,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQescapeByteaConn" >&5
 $as_echo "$ac_cv_lib_pq_PQescapeByteaConn" >&6; }
-if test "x$ac_cv_lib_pq_PQescapeByteaConn" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQescapeByteaConn" = xyes; then :
 
 $as_echo "#define HAVE_PQESCAPE_BYTEA_CONN 1" >>confdefs.h
 
@@ -78343,7 +79603,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pg_encoding_to_char in -lpq" >&5
 $as_echo_n "checking for pg_encoding_to_char in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_pg_encoding_to_char+set}" = set; then :
+if ${ac_cv_lib_pq_pg_encoding_to_char+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78377,7 +79637,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_pg_encoding_to_char" >&5
 $as_echo "$ac_cv_lib_pq_pg_encoding_to_char" >&6; }
-if test "x$ac_cv_lib_pq_pg_encoding_to_char" = x""yes; then :
+if test "x$ac_cv_lib_pq_pg_encoding_to_char" = xyes; then :
 
 $as_echo "#define HAVE_PGSQL_WITH_MULTIBYTE_SUPPORT 1" >>confdefs.h
 
@@ -78385,7 +79645,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for lo_create in -lpq" >&5
 $as_echo_n "checking for lo_create in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_lo_create+set}" = set; then :
+if ${ac_cv_lib_pq_lo_create+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78419,7 +79679,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_lo_create" >&5
 $as_echo "$ac_cv_lib_pq_lo_create" >&6; }
-if test "x$ac_cv_lib_pq_lo_create" = x""yes; then :
+if test "x$ac_cv_lib_pq_lo_create" = xyes; then :
 
 $as_echo "#define HAVE_PG_LO_CREATE 1" >>confdefs.h
 
@@ -78427,7 +79687,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for lo_import_with_oid in -lpq" >&5
 $as_echo_n "checking for lo_import_with_oid in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_lo_import_with_oid+set}" = set; then :
+if ${ac_cv_lib_pq_lo_import_with_oid+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78461,7 +79721,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_lo_import_with_oid" >&5
 $as_echo "$ac_cv_lib_pq_lo_import_with_oid" >&6; }
-if test "x$ac_cv_lib_pq_lo_import_with_oid" = x""yes; then :
+if test "x$ac_cv_lib_pq_lo_import_with_oid" = xyes; then :
 
 $as_echo "#define HAVE_PG_LO_IMPORT_WITH_OID 1" >>confdefs.h
 
@@ -78469,7 +79729,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PQescapeLiteral in -lpq" >&5
 $as_echo_n "checking for PQescapeLiteral in -lpq... " >&6; }
-if test "${ac_cv_lib_pq_PQescapeLiteral+set}" = set; then :
+if ${ac_cv_lib_pq_PQescapeLiteral+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -78503,7 +79763,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pq_PQescapeLiteral" >&5
 $as_echo "$ac_cv_lib_pq_PQescapeLiteral" >&6; }
-if test "x$ac_cv_lib_pq_PQescapeLiteral" = x""yes; then :
+if test "x$ac_cv_lib_pq_PQescapeLiteral" = xyes; then :
 
 $as_echo "#define HAVE_PQESCAPELITERAL 1" >>confdefs.h
 
@@ -79313,7 +80573,7 @@
   is_it_shared=$PHP_HASH_SHARED
   is_it_enabled=$PHP_HASH
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension phar to build statically, but it
 depends on extension hash, which you've configured to build shared.
 You either need to build phar shared or build hash statically for the
@@ -79321,7 +80581,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "xtrue" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension phar, which depends on extension hash,
 but you've either not enabled hash, or have disabled it.
 " "$LINENO" 5
@@ -79332,7 +80592,7 @@
   is_it_shared=$PHP_SPL_SHARED
   is_it_enabled=$PHP_SPL
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension phar to build statically, but it
 depends on extension spl, which you've configured to build shared.
 You either need to build phar shared or build spl statically for the
@@ -79340,7 +80600,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "xtrue" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension phar, which depends on extension spl,
 but you've either not enabled spl, or have disabled it.
 " "$LINENO" 5
@@ -79704,7 +80964,7 @@
   for ac_header in sys/mkdev.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "sys/mkdev.h" "ac_cv_header_sys_mkdev_h" "$ac_includes_default"
-if test "x$ac_cv_header_sys_mkdev_h" = x""yes; then :
+if test "x$ac_cv_header_sys_mkdev_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_SYS_MKDEV_H 1
 _ACEOF
@@ -79718,8 +80978,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -79770,7 +81029,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for utsname.domainname" >&5
 $as_echo_n "checking for utsname.domainname... " >&6; }
-if test "${ac_cv_have_utsname_domainname+set}" = set; then :
+if ${ac_cv_have_utsname_domainname+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -80167,7 +81426,7 @@
 	done
 
 	if test -z "$PSPELL_DIR"; then
-		as_fn_error "Cannot find pspell" "$LINENO" 5
+		as_fn_error $? "Cannot find pspell" "$LINENO" 5
 	fi
 
 	PSPELL_LIBDIR=$PSPELL_DIR/$PHP_LIBDIR
@@ -80369,7 +81628,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for new_aspell_config in -laspell" >&5
 $as_echo_n "checking for new_aspell_config in -laspell... " >&6; }
-if test "${ac_cv_lib_aspell_new_aspell_config+set}" = set; then :
+if ${ac_cv_lib_aspell_new_aspell_config+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -80403,7 +81662,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_aspell_new_aspell_config" >&5
 $as_echo "$ac_cv_lib_aspell_new_aspell_config" >&6; }
-if test "x$ac_cv_lib_aspell_new_aspell_config" = x""yes; then :
+if test "x$ac_cv_lib_aspell_new_aspell_config" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -80657,7 +81916,7 @@
   done
 
   if test -z "$READLINE_DIR"; then
-    as_fn_error "Please reinstall readline - I cannot find readline.h" "$LINENO" 5
+    as_fn_error $? "Please reinstall readline - I cannot find readline.h" "$LINENO" 5
   fi
 
 
@@ -80695,7 +81954,7 @@
   PHP_READLINE_LIBS=""
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in -lncurses" >&5
 $as_echo_n "checking for tgetent in -lncurses... " >&6; }
-if test "${ac_cv_lib_ncurses_tgetent+set}" = set; then :
+if ${ac_cv_lib_ncurses_tgetent+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -80729,7 +81988,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ncurses_tgetent" >&5
 $as_echo "$ac_cv_lib_ncurses_tgetent" >&6; }
-if test "x$ac_cv_lib_ncurses_tgetent" = x""yes; then :
+if test "x$ac_cv_lib_ncurses_tgetent" = xyes; then :
 
 
 
@@ -80760,7 +82019,7 @@
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in -ltermcap" >&5
 $as_echo_n "checking for tgetent in -ltermcap... " >&6; }
-if test "${ac_cv_lib_termcap_tgetent+set}" = set; then :
+if ${ac_cv_lib_termcap_tgetent+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -80794,7 +82053,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_termcap_tgetent" >&5
 $as_echo "$ac_cv_lib_termcap_tgetent" >&6; }
-if test "x$ac_cv_lib_termcap_tgetent" = x""yes; then :
+if test "x$ac_cv_lib_termcap_tgetent" = xyes; then :
 
 
 
@@ -80926,7 +82185,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for readline in -lreadline" >&5
 $as_echo_n "checking for readline in -lreadline... " >&6; }
-if test "${ac_cv_lib_readline_readline+set}" = set; then :
+if ${ac_cv_lib_readline_readline+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -80960,7 +82219,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_readline_readline" >&5
 $as_echo "$ac_cv_lib_readline_readline" >&6; }
-if test "x$ac_cv_lib_readline_readline" = x""yes; then :
+if test "x$ac_cv_lib_readline_readline" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -81070,7 +82329,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_readline_readline
 
-    as_fn_error "readline library not found" "$LINENO" 5
+    as_fn_error $? "readline library not found" "$LINENO" 5
 
 
 fi
@@ -81175,7 +82434,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for rl_pending_input in -lreadline" >&5
 $as_echo_n "checking for rl_pending_input in -lreadline... " >&6; }
-if test "${ac_cv_lib_readline_rl_pending_input+set}" = set; then :
+if ${ac_cv_lib_readline_rl_pending_input+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -81209,7 +82468,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_readline_rl_pending_input" >&5
 $as_echo "$ac_cv_lib_readline_rl_pending_input" >&6; }
-if test "x$ac_cv_lib_readline_rl_pending_input" = x""yes; then :
+if test "x$ac_cv_lib_readline_rl_pending_input" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -81221,7 +82480,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_readline_rl_pending_input
 
-    as_fn_error "invalid readline installation detected. Try --with-libedit instead." "$LINENO" 5
+    as_fn_error $? "invalid readline installation detected. Try --with-libedit instead." "$LINENO" 5
 
 
 fi
@@ -81326,7 +82585,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for rl_callback_read_char in -lreadline" >&5
 $as_echo_n "checking for rl_callback_read_char in -lreadline... " >&6; }
-if test "${ac_cv_lib_readline_rl_callback_read_char+set}" = set; then :
+if ${ac_cv_lib_readline_rl_callback_read_char+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -81360,7 +82619,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_readline_rl_callback_read_char" >&5
 $as_echo "$ac_cv_lib_readline_rl_callback_read_char" >&6; }
-if test "x$ac_cv_lib_readline_rl_callback_read_char" = x""yes; then :
+if test "x$ac_cv_lib_readline_rl_callback_read_char" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -81479,7 +82738,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for rl_on_new_line in -ledit" >&5
 $as_echo_n "checking for rl_on_new_line in -ledit... " >&6; }
-if test "${ac_cv_lib_edit_rl_on_new_line+set}" = set; then :
+if ${ac_cv_lib_edit_rl_on_new_line+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -81513,7 +82772,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_edit_rl_on_new_line" >&5
 $as_echo "$ac_cv_lib_edit_rl_on_new_line" >&6; }
-if test "x$ac_cv_lib_edit_rl_on_new_line" = x""yes; then :
+if test "x$ac_cv_lib_edit_rl_on_new_line" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -81544,7 +82803,7 @@
   done
 
   if test -z "$LIBEDIT_DIR"; then
-    as_fn_error "Please reinstall libedit - I cannot find readline.h" "$LINENO" 5
+    as_fn_error $? "Please reinstall libedit - I cannot find readline.h" "$LINENO" 5
   fi
 
 
@@ -81581,7 +82840,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in -lncurses" >&5
 $as_echo_n "checking for tgetent in -lncurses... " >&6; }
-if test "${ac_cv_lib_ncurses_tgetent+set}" = set; then :
+if ${ac_cv_lib_ncurses_tgetent+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -81615,7 +82874,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ncurses_tgetent" >&5
 $as_echo "$ac_cv_lib_ncurses_tgetent" >&6; }
-if test "x$ac_cv_lib_ncurses_tgetent" = x""yes; then :
+if test "x$ac_cv_lib_ncurses_tgetent" = xyes; then :
 
 
 
@@ -81645,7 +82904,7 @@
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tgetent in -ltermcap" >&5
 $as_echo_n "checking for tgetent in -ltermcap... " >&6; }
-if test "${ac_cv_lib_termcap_tgetent+set}" = set; then :
+if ${ac_cv_lib_termcap_tgetent+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -81679,7 +82938,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_termcap_tgetent" >&5
 $as_echo "$ac_cv_lib_termcap_tgetent" >&6; }
-if test "x$ac_cv_lib_termcap_tgetent" = x""yes; then :
+if test "x$ac_cv_lib_termcap_tgetent" = xyes; then :
 
 
 
@@ -81810,7 +83069,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for readline in -ledit" >&5
 $as_echo_n "checking for readline in -ledit... " >&6; }
-if test "${ac_cv_lib_edit_readline+set}" = set; then :
+if ${ac_cv_lib_edit_readline+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -81844,7 +83103,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_edit_readline" >&5
 $as_echo "$ac_cv_lib_edit_readline" >&6; }
-if test "x$ac_cv_lib_edit_readline" = x""yes; then :
+if test "x$ac_cv_lib_edit_readline" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -81954,7 +83213,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_edit_readline
 
-    as_fn_error "edit library required by readline not found" "$LINENO" 5
+    as_fn_error $? "edit library required by readline not found" "$LINENO" 5
 
 
 fi
@@ -82059,7 +83318,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for rl_callback_read_char in -ledit" >&5
 $as_echo_n "checking for rl_callback_read_char in -ledit... " >&6; }
-if test "${ac_cv_lib_edit_rl_callback_read_char+set}" = set; then :
+if ${ac_cv_lib_edit_rl_callback_read_char+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -82093,7 +83352,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_edit_rl_callback_read_char" >&5
 $as_echo "$ac_cv_lib_edit_rl_callback_read_char" >&6; }
-if test "x$ac_cv_lib_edit_rl_callback_read_char" = x""yes; then :
+if test "x$ac_cv_lib_edit_rl_callback_read_char" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -82212,7 +83471,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for rl_on_new_line in -ledit" >&5
 $as_echo_n "checking for rl_on_new_line in -ledit... " >&6; }
-if test "${ac_cv_lib_edit_rl_on_new_line+set}" = set; then :
+if ${ac_cv_lib_edit_rl_on_new_line+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -82246,7 +83505,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_edit_rl_on_new_line" >&5
 $as_echo "$ac_cv_lib_edit_rl_on_new_line" >&6; }
-if test "x$ac_cv_lib_edit_rl_on_new_line" = x""yes; then :
+if test "x$ac_cv_lib_edit_rl_on_new_line" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -82275,7 +83534,7 @@
   for ac_func in rl_completion_matches
 do :
   ac_fn_c_check_func "$LINENO" "rl_completion_matches" "ac_cv_func_rl_completion_matches"
-if test "x$ac_cv_func_rl_completion_matches" = x""yes; then :
+if test "x$ac_cv_func_rl_completion_matches" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_RL_COMPLETION_MATCHES 1
 _ACEOF
@@ -82650,7 +83909,7 @@
   done
 
   if test -z "$RECODE_DIR"; then
-    as_fn_error "Can not find recode.h anywhere under $RECODE_LIST." "$LINENO" 5
+    as_fn_error $? "Can not find recode.h anywhere under $RECODE_LIST." "$LINENO" 5
   fi
 
 
@@ -82752,7 +84011,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for recode_format_table in -lrecode" >&5
 $as_echo_n "checking for recode_format_table in -lrecode... " >&6; }
-if test "${ac_cv_lib_recode_recode_format_table+set}" = set; then :
+if ${ac_cv_lib_recode_recode_format_table+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -82786,7 +84045,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_recode_recode_format_table" >&5
 $as_echo "$ac_cv_lib_recode_recode_format_table" >&6; }
-if test "x$ac_cv_lib_recode_recode_format_table" = x""yes; then :
+if test "x$ac_cv_lib_recode_recode_format_table" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -83020,7 +84279,7 @@
 
 else
 
-      as_fn_error "I cannot link librecode (-L$RECODE_DIR/$RECODE_LIB -lrecode). Is it installed?" "$LINENO" 5
+      as_fn_error $? "I cannot link librecode (-L$RECODE_DIR/$RECODE_LIB -lrecode). Is it installed?" "$LINENO" 5
 
 fi
 rm -f core conftest.err conftest.$ac_objext \
@@ -83072,7 +84331,7 @@
   for ac_header in stdbool.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "stdbool.h" "ac_cv_header_stdbool_h" "$ac_includes_default"
-if test "x$ac_cv_header_stdbool_h" = x""yes; then :
+if test "x$ac_cv_header_stdbool_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_STDBOOL_H 1
 _ACEOF
@@ -83747,7 +85006,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether pwrite works" >&5
 $as_echo_n "checking whether pwrite works... " >&6; }
-if test "${ac_cv_pwrite+set}" = set; then :
+if ${ac_cv_pwrite+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -83857,7 +85116,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether pread works" >&5
 $as_echo_n "checking whether pread works... " >&6; }
-if test "${ac_cv_pread+set}" = set; then :
+if ${ac_cv_pread+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -84264,7 +85523,7 @@
   is_it_shared=$PHP_HASH_SHARED
   is_it_enabled=$PHP_HASH
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension session to build statically, but it
 depends on extension hash, which you've configured to build shared.
 You either need to build session shared or build hash statically for the
@@ -84272,7 +85531,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "xtrue" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension session, which depends on extension hash,
 but you've either not enabled hash, or have disabled it.
 " "$LINENO" 5
@@ -84283,7 +85542,7 @@
   is_it_shared=$PHP_SPL_SHARED
   is_it_enabled=$PHP_SPL
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension session to build statically, but it
 depends on extension spl, which you've configured to build shared.
 You either need to build session shared or build spl statically for the
@@ -84291,7 +85550,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension session, which depends on extension spl,
 but you've either not enabled spl, or have disabled it.
 " "$LINENO" 5
@@ -84331,7 +85590,7 @@
   done
 
   if test -z "$MM_DIR" ; then
-    as_fn_error "cannot find mm library" "$LINENO" 5
+    as_fn_error $? "cannot find mm library" "$LINENO" 5
   fi
 
 
@@ -84902,13 +86161,13 @@
 if test "$PHP_SIMPLEXML" != "no"; then
 
   if test "$PHP_LIBXML" = "no"; then
-    as_fn_error "SimpleXML extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
+    as_fn_error $? "SimpleXML extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
   fi
 
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for xml2-config path" >&5
 $as_echo_n "checking for xml2-config path... " >&6; }
-if test "${ac_cv_php_xml2_config_path+set}" = set; then :
+if ${ac_cv_php_xml2_config_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -85066,7 +86325,7 @@
 
             { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether libxml build works" >&5
 $as_echo_n "checking whether libxml build works... " >&6; }
-if test "${php_cv_libxml_build_works+set}" = set; then :
+if ${php_cv_libxml_build_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -85104,7 +86363,7 @@
 
           { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-          as_fn_error "build test failed.  Please check the config.log for details." "$LINENO" 5
+          as_fn_error $? "build test failed.  Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -85424,10 +86683,10 @@
 
 
     else
-      as_fn_error "libxml2 version 2.6.11 or greater required." "$LINENO" 5
+      as_fn_error $? "libxml2 version 2.6.11 or greater required." "$LINENO" 5
     fi
 else
-    as_fn_error "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
+    as_fn_error $? "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
 
   fi
 
@@ -85436,7 +86695,7 @@
   is_it_shared=$PHP_LIBXML_SHARED
   is_it_enabled=$PHP_LIBXML
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension simplexml to build statically, but it
 depends on extension libxml, which you've configured to build shared.
 You either need to build simplexml shared or build libxml statically for the
@@ -85444,7 +86703,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension simplexml, which depends on extension libxml,
 but you've either not enabled libxml, or have disabled it.
 " "$LINENO" 5
@@ -85455,7 +86714,7 @@
   is_it_shared=$PHP_SPL_SHARED
   is_it_enabled=$PHP_SPL
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension simplexml to build statically, but it
 depends on extension spl, which you've configured to build shared.
 You either need to build simplexml shared or build spl statically for the
@@ -85463,7 +86722,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "xtrue" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension simplexml, which depends on extension spl,
 but you've either not enabled spl, or have disabled it.
 " "$LINENO" 5
@@ -85548,7 +86807,7 @@
 set dummy net-snmp-config; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_SNMP_CONFIG+set}" = set; then :
+if ${ac_cv_path_SNMP_CONFIG+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $SNMP_CONFIG in
@@ -85723,13 +86982,13 @@
 
         SNMP_LIBNAME=netsnmp
       else
-        as_fn_error "Could not find the required paths. Please check your net-snmp installation." "$LINENO" 5
+        as_fn_error $? "Could not find the required paths. Please check your net-snmp installation." "$LINENO" 5
       fi
     else
-      as_fn_error "Net-SNMP version 5.3 or greater reqired (detected $snmp_full_version)." "$LINENO" 5
+      as_fn_error $? "Net-SNMP version 5.3 or greater reqired (detected $snmp_full_version)." "$LINENO" 5
     fi
   else
-    as_fn_error "Could not find net-snmp-config binary. Please check your net-snmp installation." "$LINENO" 5
+    as_fn_error $? "Could not find net-snmp-config binary. Please check your net-snmp installation." "$LINENO" 5
   fi
 
 
@@ -85832,7 +87091,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$SNMP_LIBNAME''_init_snmp" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for init_snmp in -l$SNMP_LIBNAME" >&5
 $as_echo_n "checking for init_snmp in -l$SNMP_LIBNAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -85867,8 +87126,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -85884,7 +87142,7 @@
     ext_shared=$save_ext_shared
     unset ac_cv_lib_$SNMP_LIBNAME_init_snmp
 
-    as_fn_error "SNMP sanity check failed. Please check config.log for more information." "$LINENO" 5
+    as_fn_error $? "SNMP sanity check failed. Please check config.log for more information." "$LINENO" 5
 
 
 fi
@@ -85990,7 +87248,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$SNMP_LIBNAME''_shutdown_snmp_logging" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for shutdown_snmp_logging in -l$SNMP_LIBNAME" >&5
 $as_echo_n "checking for shutdown_snmp_logging in -l$SNMP_LIBNAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -86025,8 +87283,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -86418,13 +87675,13 @@
 if test "$PHP_SOAP" != "no"; then
 
   if test "$PHP_LIBXML" = "no"; then
-    as_fn_error "SOAP extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
+    as_fn_error $? "SOAP extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
   fi
 
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for xml2-config path" >&5
 $as_echo_n "checking for xml2-config path... " >&6; }
-if test "${ac_cv_php_xml2_config_path+set}" = set; then :
+if ${ac_cv_php_xml2_config_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -86582,7 +87839,7 @@
 
             { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether libxml build works" >&5
 $as_echo_n "checking whether libxml build works... " >&6; }
-if test "${php_cv_libxml_build_works+set}" = set; then :
+if ${php_cv_libxml_build_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -86620,7 +87877,7 @@
 
           { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-          as_fn_error "build test failed.  Please check the config.log for details." "$LINENO" 5
+          as_fn_error $? "build test failed.  Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -86940,10 +88197,10 @@
 
 
     else
-      as_fn_error "libxml2 version 2.6.11 or greater required." "$LINENO" 5
+      as_fn_error $? "libxml2 version 2.6.11 or greater required." "$LINENO" 5
     fi
 else
-    as_fn_error "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
+    as_fn_error $? "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
 
   fi
 
@@ -86997,7 +88254,7 @@
 if test "$PHP_SOCKETS" != "no"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for struct cmsghdr" >&5
 $as_echo_n "checking for struct cmsghdr... " >&6; }
-if test "${ac_cv_cmsghdr+set}" = set; then :
+if ${ac_cv_cmsghdr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -87035,8 +88292,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -87048,8 +88304,7 @@
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -87087,7 +88342,7 @@
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for field ss_family in struct sockaddr_storage" >&5
 $as_echo_n "checking for field ss_family in struct sockaddr_storage... " >&6; }
-if test "${ac_cv_ss_family+set}" = set; then :
+if ${ac_cv_ss_family+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -87803,7 +89058,7 @@
   is_it_shared=$PHP_PCRE_SHARED
   is_it_enabled=$PHP_PCRE
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension spl to build statically, but it
 depends on extension pcre, which you've configured to build shared.
 You either need to build spl shared or build pcre statically for the
@@ -87811,7 +89066,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "xtrue" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension spl, which depends on extension pcre,
 but you've either not enabled pcre, or have disabled it.
 " "$LINENO" 5
@@ -87821,7 +89076,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether flush should be called explicitly after a buffered io" >&5
 $as_echo_n "checking whether flush should be called explicitly after a buffered io... " >&6; }
-if test "${ac_cv_flush_io+set}" = set; then :
+if ${ac_cv_flush_io+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -87893,7 +89148,7 @@
 if test "$ac_cv_func_crypt" = "no"; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for crypt in -lcrypt" >&5
 $as_echo_n "checking for crypt in -lcrypt... " >&6; }
-if test "${ac_cv_lib_crypt_crypt+set}" = set; then :
+if ${ac_cv_lib_crypt_crypt+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -87927,7 +89182,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_crypt_crypt" >&5
 $as_echo "$ac_cv_lib_crypt_crypt" >&6; }
-if test "x$ac_cv_lib_crypt_crypt" = x""yes; then :
+if test "x$ac_cv_lib_crypt_crypt" = xyes; then :
 
     LIBS="-lcrypt $LIBS -lcrypt"
 
@@ -87940,7 +89195,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for standard DES crypt" >&5
 $as_echo_n "checking for standard DES crypt... " >&6; }
-if test "${ac_cv_crypt_des+set}" = set; then :
+if ${ac_cv_crypt_des+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -87987,7 +89242,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for extended DES crypt" >&5
 $as_echo_n "checking for extended DES crypt... " >&6; }
-if test "${ac_cv_crypt_ext_des+set}" = set; then :
+if ${ac_cv_crypt_ext_des+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -88034,7 +89289,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for MD5 crypt" >&5
 $as_echo_n "checking for MD5 crypt... " >&6; }
-if test "${ac_cv_crypt_md5+set}" = set; then :
+if ${ac_cv_crypt_md5+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -88090,7 +89345,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for Blowfish crypt" >&5
 $as_echo_n "checking for Blowfish crypt... " >&6; }
-if test "${ac_cv_crypt_blowfish+set}" = set; then :
+if ${ac_cv_crypt_blowfish+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -88143,7 +89398,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SHA512 crypt" >&5
 $as_echo_n "checking for SHA512 crypt... " >&6; }
-if test "${ac_cv_crypt_SHA512+set}" = set; then :
+if ${ac_cv_crypt_SHA512+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -88195,7 +89450,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SHA256 crypt" >&5
 $as_echo_n "checking for SHA256 crypt... " >&6; }
-if test "${ac_cv_crypt_SHA256+set}" = set; then :
+if ${ac_cv_crypt_SHA256+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -88250,7 +89505,7 @@
 
         { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the compiler supports __alignof__" >&5
 $as_echo_n "checking whether the compiler supports __alignof__... " >&6; }
-if test "${ac_cv_alignof_exists+set}" = set; then :
+if ${ac_cv_alignof_exists+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -88289,7 +89544,7 @@
 
         { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the compiler supports aligned attribute" >&5
 $as_echo_n "checking whether the compiler supports aligned attribute... " >&6; }
-if test "${ac_cv_attribute_aligned+set}" = set; then :
+if ${ac_cv_attribute_aligned+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -88496,8 +89751,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -88507,7 +89761,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working POSIX fnmatch" >&5
 $as_echo_n "checking for working POSIX fnmatch... " >&6; }
-if test "${ac_cv_func_fnmatch_works+set}" = set; then :
+if ${ac_cv_func_fnmatch_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   # Some versions of Solaris, SCO, and the GNU C Library
@@ -88562,8 +89816,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -88625,11 +89878,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "res_nsearch" "ac_cv_func_res_nsearch"
-if test "x$ac_cv_func_res_nsearch" = x""yes; then :
+if test "x$ac_cv_func_res_nsearch" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__res_nsearch" "ac_cv_func___res_nsearch"
-if test "x$ac_cv_func___res_nsearch" = x""yes; then :
+if test "x$ac_cv_func___res_nsearch" = xyes; then :
   found=yes
 else
   found=no
@@ -88653,7 +89906,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for res_nsearch in -lresolv" >&5
 $as_echo_n "checking for res_nsearch in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv_res_nsearch+set}" = set; then :
+if ${ac_cv_lib_resolv_res_nsearch+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -88687,13 +89940,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv_res_nsearch" >&5
 $as_echo "$ac_cv_lib_resolv_res_nsearch" >&6; }
-if test "x$ac_cv_lib_resolv_res_nsearch" = x""yes; then :
+if test "x$ac_cv_lib_resolv_res_nsearch" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __res_nsearch in -lresolv" >&5
 $as_echo_n "checking for __res_nsearch in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv___res_nsearch+set}" = set; then :
+if ${ac_cv_lib_resolv___res_nsearch+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -88727,7 +89980,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv___res_nsearch" >&5
 $as_echo "$ac_cv_lib_resolv___res_nsearch" >&6; }
-if test "x$ac_cv_lib_resolv___res_nsearch" = x""yes; then :
+if test "x$ac_cv_lib_resolv___res_nsearch" = xyes; then :
   found=yes
 else
   found=no
@@ -88785,7 +90038,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for res_nsearch in -lbind" >&5
 $as_echo_n "checking for res_nsearch in -lbind... " >&6; }
-if test "${ac_cv_lib_bind_res_nsearch+set}" = set; then :
+if ${ac_cv_lib_bind_res_nsearch+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -88819,13 +90072,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind_res_nsearch" >&5
 $as_echo "$ac_cv_lib_bind_res_nsearch" >&6; }
-if test "x$ac_cv_lib_bind_res_nsearch" = x""yes; then :
+if test "x$ac_cv_lib_bind_res_nsearch" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __res_nsearch in -lbind" >&5
 $as_echo_n "checking for __res_nsearch in -lbind... " >&6; }
-if test "${ac_cv_lib_bind___res_nsearch+set}" = set; then :
+if ${ac_cv_lib_bind___res_nsearch+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -88859,7 +90112,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind___res_nsearch" >&5
 $as_echo "$ac_cv_lib_bind___res_nsearch" >&6; }
-if test "x$ac_cv_lib_bind___res_nsearch" = x""yes; then :
+if test "x$ac_cv_lib_bind___res_nsearch" = xyes; then :
   found=yes
 else
   found=no
@@ -88917,7 +90170,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for res_nsearch in -lsocket" >&5
 $as_echo_n "checking for res_nsearch in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket_res_nsearch+set}" = set; then :
+if ${ac_cv_lib_socket_res_nsearch+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -88951,13 +90204,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_res_nsearch" >&5
 $as_echo "$ac_cv_lib_socket_res_nsearch" >&6; }
-if test "x$ac_cv_lib_socket_res_nsearch" = x""yes; then :
+if test "x$ac_cv_lib_socket_res_nsearch" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __res_nsearch in -lsocket" >&5
 $as_echo_n "checking for __res_nsearch in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket___res_nsearch+set}" = set; then :
+if ${ac_cv_lib_socket___res_nsearch+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -88991,7 +90244,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket___res_nsearch" >&5
 $as_echo "$ac_cv_lib_socket___res_nsearch" >&6; }
-if test "x$ac_cv_lib_socket___res_nsearch" = x""yes; then :
+if test "x$ac_cv_lib_socket___res_nsearch" = xyes; then :
   found=yes
 else
   found=no
@@ -89063,11 +90316,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "dns_search" "ac_cv_func_dns_search"
-if test "x$ac_cv_func_dns_search" = x""yes; then :
+if test "x$ac_cv_func_dns_search" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__dns_search" "ac_cv_func___dns_search"
-if test "x$ac_cv_func___dns_search" = x""yes; then :
+if test "x$ac_cv_func___dns_search" = xyes; then :
   found=yes
 else
   found=no
@@ -89091,7 +90344,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dns_search in -lresolv" >&5
 $as_echo_n "checking for dns_search in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv_dns_search+set}" = set; then :
+if ${ac_cv_lib_resolv_dns_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89125,13 +90378,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv_dns_search" >&5
 $as_echo "$ac_cv_lib_resolv_dns_search" >&6; }
-if test "x$ac_cv_lib_resolv_dns_search" = x""yes; then :
+if test "x$ac_cv_lib_resolv_dns_search" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __dns_search in -lresolv" >&5
 $as_echo_n "checking for __dns_search in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv___dns_search+set}" = set; then :
+if ${ac_cv_lib_resolv___dns_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89165,7 +90418,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv___dns_search" >&5
 $as_echo "$ac_cv_lib_resolv___dns_search" >&6; }
-if test "x$ac_cv_lib_resolv___dns_search" = x""yes; then :
+if test "x$ac_cv_lib_resolv___dns_search" = xyes; then :
   found=yes
 else
   found=no
@@ -89223,7 +90476,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dns_search in -lbind" >&5
 $as_echo_n "checking for dns_search in -lbind... " >&6; }
-if test "${ac_cv_lib_bind_dns_search+set}" = set; then :
+if ${ac_cv_lib_bind_dns_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89257,13 +90510,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind_dns_search" >&5
 $as_echo "$ac_cv_lib_bind_dns_search" >&6; }
-if test "x$ac_cv_lib_bind_dns_search" = x""yes; then :
+if test "x$ac_cv_lib_bind_dns_search" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __dns_search in -lbind" >&5
 $as_echo_n "checking for __dns_search in -lbind... " >&6; }
-if test "${ac_cv_lib_bind___dns_search+set}" = set; then :
+if ${ac_cv_lib_bind___dns_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89297,7 +90550,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind___dns_search" >&5
 $as_echo "$ac_cv_lib_bind___dns_search" >&6; }
-if test "x$ac_cv_lib_bind___dns_search" = x""yes; then :
+if test "x$ac_cv_lib_bind___dns_search" = xyes; then :
   found=yes
 else
   found=no
@@ -89355,7 +90608,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dns_search in -lsocket" >&5
 $as_echo_n "checking for dns_search in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket_dns_search+set}" = set; then :
+if ${ac_cv_lib_socket_dns_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89389,13 +90642,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_dns_search" >&5
 $as_echo "$ac_cv_lib_socket_dns_search" >&6; }
-if test "x$ac_cv_lib_socket_dns_search" = x""yes; then :
+if test "x$ac_cv_lib_socket_dns_search" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __dns_search in -lsocket" >&5
 $as_echo_n "checking for __dns_search in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket___dns_search+set}" = set; then :
+if ${ac_cv_lib_socket___dns_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89429,7 +90682,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket___dns_search" >&5
 $as_echo "$ac_cv_lib_socket___dns_search" >&6; }
-if test "x$ac_cv_lib_socket___dns_search" = x""yes; then :
+if test "x$ac_cv_lib_socket___dns_search" = xyes; then :
   found=yes
 else
   found=no
@@ -89501,11 +90754,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "dn_expand" "ac_cv_func_dn_expand"
-if test "x$ac_cv_func_dn_expand" = x""yes; then :
+if test "x$ac_cv_func_dn_expand" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__dn_expand" "ac_cv_func___dn_expand"
-if test "x$ac_cv_func___dn_expand" = x""yes; then :
+if test "x$ac_cv_func___dn_expand" = xyes; then :
   found=yes
 else
   found=no
@@ -89529,7 +90782,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dn_expand in -lresolv" >&5
 $as_echo_n "checking for dn_expand in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv_dn_expand+set}" = set; then :
+if ${ac_cv_lib_resolv_dn_expand+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89563,13 +90816,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv_dn_expand" >&5
 $as_echo "$ac_cv_lib_resolv_dn_expand" >&6; }
-if test "x$ac_cv_lib_resolv_dn_expand" = x""yes; then :
+if test "x$ac_cv_lib_resolv_dn_expand" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __dn_expand in -lresolv" >&5
 $as_echo_n "checking for __dn_expand in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv___dn_expand+set}" = set; then :
+if ${ac_cv_lib_resolv___dn_expand+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89603,7 +90856,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv___dn_expand" >&5
 $as_echo "$ac_cv_lib_resolv___dn_expand" >&6; }
-if test "x$ac_cv_lib_resolv___dn_expand" = x""yes; then :
+if test "x$ac_cv_lib_resolv___dn_expand" = xyes; then :
   found=yes
 else
   found=no
@@ -89661,7 +90914,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dn_expand in -lbind" >&5
 $as_echo_n "checking for dn_expand in -lbind... " >&6; }
-if test "${ac_cv_lib_bind_dn_expand+set}" = set; then :
+if ${ac_cv_lib_bind_dn_expand+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89695,13 +90948,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind_dn_expand" >&5
 $as_echo "$ac_cv_lib_bind_dn_expand" >&6; }
-if test "x$ac_cv_lib_bind_dn_expand" = x""yes; then :
+if test "x$ac_cv_lib_bind_dn_expand" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __dn_expand in -lbind" >&5
 $as_echo_n "checking for __dn_expand in -lbind... " >&6; }
-if test "${ac_cv_lib_bind___dn_expand+set}" = set; then :
+if ${ac_cv_lib_bind___dn_expand+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89735,7 +90988,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind___dn_expand" >&5
 $as_echo "$ac_cv_lib_bind___dn_expand" >&6; }
-if test "x$ac_cv_lib_bind___dn_expand" = x""yes; then :
+if test "x$ac_cv_lib_bind___dn_expand" = xyes; then :
   found=yes
 else
   found=no
@@ -89793,7 +91046,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dn_expand in -lsocket" >&5
 $as_echo_n "checking for dn_expand in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket_dn_expand+set}" = set; then :
+if ${ac_cv_lib_socket_dn_expand+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89827,13 +91080,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_dn_expand" >&5
 $as_echo "$ac_cv_lib_socket_dn_expand" >&6; }
-if test "x$ac_cv_lib_socket_dn_expand" = x""yes; then :
+if test "x$ac_cv_lib_socket_dn_expand" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __dn_expand in -lsocket" >&5
 $as_echo_n "checking for __dn_expand in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket___dn_expand+set}" = set; then :
+if ${ac_cv_lib_socket___dn_expand+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -89867,7 +91120,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket___dn_expand" >&5
 $as_echo "$ac_cv_lib_socket___dn_expand" >&6; }
-if test "x$ac_cv_lib_socket___dn_expand" = x""yes; then :
+if test "x$ac_cv_lib_socket___dn_expand" = xyes; then :
   found=yes
 else
   found=no
@@ -89939,11 +91192,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "dn_skipname" "ac_cv_func_dn_skipname"
-if test "x$ac_cv_func_dn_skipname" = x""yes; then :
+if test "x$ac_cv_func_dn_skipname" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__dn_skipname" "ac_cv_func___dn_skipname"
-if test "x$ac_cv_func___dn_skipname" = x""yes; then :
+if test "x$ac_cv_func___dn_skipname" = xyes; then :
   found=yes
 else
   found=no
@@ -89967,7 +91220,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dn_skipname in -lresolv" >&5
 $as_echo_n "checking for dn_skipname in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv_dn_skipname+set}" = set; then :
+if ${ac_cv_lib_resolv_dn_skipname+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90001,13 +91254,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv_dn_skipname" >&5
 $as_echo "$ac_cv_lib_resolv_dn_skipname" >&6; }
-if test "x$ac_cv_lib_resolv_dn_skipname" = x""yes; then :
+if test "x$ac_cv_lib_resolv_dn_skipname" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __dn_skipname in -lresolv" >&5
 $as_echo_n "checking for __dn_skipname in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv___dn_skipname+set}" = set; then :
+if ${ac_cv_lib_resolv___dn_skipname+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90041,7 +91294,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv___dn_skipname" >&5
 $as_echo "$ac_cv_lib_resolv___dn_skipname" >&6; }
-if test "x$ac_cv_lib_resolv___dn_skipname" = x""yes; then :
+if test "x$ac_cv_lib_resolv___dn_skipname" = xyes; then :
   found=yes
 else
   found=no
@@ -90099,7 +91352,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dn_skipname in -lbind" >&5
 $as_echo_n "checking for dn_skipname in -lbind... " >&6; }
-if test "${ac_cv_lib_bind_dn_skipname+set}" = set; then :
+if ${ac_cv_lib_bind_dn_skipname+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90133,13 +91386,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind_dn_skipname" >&5
 $as_echo "$ac_cv_lib_bind_dn_skipname" >&6; }
-if test "x$ac_cv_lib_bind_dn_skipname" = x""yes; then :
+if test "x$ac_cv_lib_bind_dn_skipname" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __dn_skipname in -lbind" >&5
 $as_echo_n "checking for __dn_skipname in -lbind... " >&6; }
-if test "${ac_cv_lib_bind___dn_skipname+set}" = set; then :
+if ${ac_cv_lib_bind___dn_skipname+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90173,7 +91426,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind___dn_skipname" >&5
 $as_echo "$ac_cv_lib_bind___dn_skipname" >&6; }
-if test "x$ac_cv_lib_bind___dn_skipname" = x""yes; then :
+if test "x$ac_cv_lib_bind___dn_skipname" = xyes; then :
   found=yes
 else
   found=no
@@ -90231,7 +91484,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dn_skipname in -lsocket" >&5
 $as_echo_n "checking for dn_skipname in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket_dn_skipname+set}" = set; then :
+if ${ac_cv_lib_socket_dn_skipname+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90265,13 +91518,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_dn_skipname" >&5
 $as_echo "$ac_cv_lib_socket_dn_skipname" >&6; }
-if test "x$ac_cv_lib_socket_dn_skipname" = x""yes; then :
+if test "x$ac_cv_lib_socket_dn_skipname" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __dn_skipname in -lsocket" >&5
 $as_echo_n "checking for __dn_skipname in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket___dn_skipname+set}" = set; then :
+if ${ac_cv_lib_socket___dn_skipname+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90305,7 +91558,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket___dn_skipname" >&5
 $as_echo "$ac_cv_lib_socket___dn_skipname" >&6; }
-if test "x$ac_cv_lib_socket___dn_skipname" = x""yes; then :
+if test "x$ac_cv_lib_socket___dn_skipname" = xyes; then :
   found=yes
 else
   found=no
@@ -90379,11 +91632,11 @@
   unset found
 
   ac_fn_c_check_func "$LINENO" "res_search" "ac_cv_func_res_search"
-if test "x$ac_cv_func_res_search" = x""yes; then :
+if test "x$ac_cv_func_res_search" = xyes; then :
   found=yes
 else
    ac_fn_c_check_func "$LINENO" "__res_search" "ac_cv_func___res_search"
-if test "x$ac_cv_func___res_search" = x""yes; then :
+if test "x$ac_cv_func___res_search" = xyes; then :
   found=yes
 else
   found=no
@@ -90407,7 +91660,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for res_search in -lresolv" >&5
 $as_echo_n "checking for res_search in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv_res_search+set}" = set; then :
+if ${ac_cv_lib_resolv_res_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90441,13 +91694,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv_res_search" >&5
 $as_echo "$ac_cv_lib_resolv_res_search" >&6; }
-if test "x$ac_cv_lib_resolv_res_search" = x""yes; then :
+if test "x$ac_cv_lib_resolv_res_search" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __res_search in -lresolv" >&5
 $as_echo_n "checking for __res_search in -lresolv... " >&6; }
-if test "${ac_cv_lib_resolv___res_search+set}" = set; then :
+if ${ac_cv_lib_resolv___res_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90481,7 +91734,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv___res_search" >&5
 $as_echo "$ac_cv_lib_resolv___res_search" >&6; }
-if test "x$ac_cv_lib_resolv___res_search" = x""yes; then :
+if test "x$ac_cv_lib_resolv___res_search" = xyes; then :
   found=yes
 else
   found=no
@@ -90539,7 +91792,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for res_search in -lbind" >&5
 $as_echo_n "checking for res_search in -lbind... " >&6; }
-if test "${ac_cv_lib_bind_res_search+set}" = set; then :
+if ${ac_cv_lib_bind_res_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90573,13 +91826,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind_res_search" >&5
 $as_echo "$ac_cv_lib_bind_res_search" >&6; }
-if test "x$ac_cv_lib_bind_res_search" = x""yes; then :
+if test "x$ac_cv_lib_bind_res_search" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __res_search in -lbind" >&5
 $as_echo_n "checking for __res_search in -lbind... " >&6; }
-if test "${ac_cv_lib_bind___res_search+set}" = set; then :
+if ${ac_cv_lib_bind___res_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90613,7 +91866,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_bind___res_search" >&5
 $as_echo "$ac_cv_lib_bind___res_search" >&6; }
-if test "x$ac_cv_lib_bind___res_search" = x""yes; then :
+if test "x$ac_cv_lib_bind___res_search" = xyes; then :
   found=yes
 else
   found=no
@@ -90671,7 +91924,7 @@
   unset found
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for res_search in -lsocket" >&5
 $as_echo_n "checking for res_search in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket_res_search+set}" = set; then :
+if ${ac_cv_lib_socket_res_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90705,13 +91958,13 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_res_search" >&5
 $as_echo "$ac_cv_lib_socket_res_search" >&6; }
-if test "x$ac_cv_lib_socket_res_search" = x""yes; then :
+if test "x$ac_cv_lib_socket_res_search" = xyes; then :
   found=yes
 else
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for __res_search in -lsocket" >&5
 $as_echo_n "checking for __res_search in -lsocket... " >&6; }
-if test "${ac_cv_lib_socket___res_search+set}" = set; then :
+if ${ac_cv_lib_socket___res_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -90745,7 +91998,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket___res_search" >&5
 $as_echo "$ac_cv_lib_socket___res_search" >&6; }
-if test "x$ac_cv_lib_socket___res_search" = x""yes; then :
+if test "x$ac_cv_lib_socket___res_search" = xyes; then :
   found=yes
 else
   found=no
@@ -90814,7 +92067,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether atof() accepts NAN" >&5
 $as_echo_n "checking whether atof() accepts NAN... " >&6; }
-if test "${ac_cv_atof_accept_nan+set}" = set; then :
+if ${ac_cv_atof_accept_nan+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -90867,7 +92120,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether atof() accepts INF" >&5
 $as_echo_n "checking whether atof() accepts INF... " >&6; }
-if test "${ac_cv_atof_accept_inf+set}" = set; then :
+if ${ac_cv_atof_accept_inf+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -90923,7 +92176,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether HUGE_VAL == INF" >&5
 $as_echo_n "checking whether HUGE_VAL == INF... " >&6; }
-if test "${ac_cv_huge_val_inf+set}" = set; then :
+if ${ac_cv_huge_val_inf+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -90979,7 +92232,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether HUGE_VAL + -HUGEVAL == NAN" >&5
 $as_echo_n "checking whether HUGE_VAL + -HUGEVAL == NAN... " >&6; }
-if test "${ac_cv_huge_val_nan+set}" = set; then :
+if ${ac_cv_huge_val_nan+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -91037,7 +92290,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether strptime() declaration fails" >&5
 $as_echo_n "checking whether strptime() declaration fails... " >&6; }
-if test "${ac_cv_strptime_decl_fails+set}" = set; then :
+if ${ac_cv_strptime_decl_fails+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -91083,7 +92336,7 @@
 for ac_header in wchar.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "wchar.h" "ac_cv_header_wchar_h" "$ac_includes_default"
-if test "x$ac_cv_header_wchar_h" = x""yes; then :
+if test "x$ac_cv_header_wchar_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_WCHAR_H 1
 _ACEOF
@@ -91095,7 +92348,7 @@
 for ac_func in mblen
 do :
   ac_fn_c_check_func "$LINENO" "mblen" "ac_cv_func_mblen"
-if test "x$ac_cv_func_mblen" = x""yes; then :
+if test "x$ac_cv_func_mblen" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_MBLEN 1
 _ACEOF
@@ -91107,8 +92360,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -91118,7 +92370,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for mbstate_t" >&5
 $as_echo_n "checking for mbstate_t... " >&6; }
-if test "${ac_cv_type_mbstate_t+set}" = set; then :
+if ${ac_cv_type_mbstate_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -91161,7 +92413,7 @@
 for ac_header in atomic.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "atomic.h" "ac_cv_header_atomic_h" "$ac_includes_default"
-if test "x$ac_cv_header_atomic_h" = x""yes; then :
+if test "x$ac_cv_header_atomic_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_ATOMIC_H 1
 _ACEOF
@@ -91579,7 +92831,7 @@
 if test "$PHP_SYBASE_CT" != "no"; then
 
   if test "$PHP_SYBASE" && test "$PHP_SYBASE" != "no" && test "$ext_shared" = "no"; then
-    as_fn_error "You can not use both --with-sybase and --with-sybase-ct in same build!" "$LINENO" 5
+    as_fn_error $? "You can not use both --with-sybase and --with-sybase-ct in same build!" "$LINENO" 5
   fi
 
 
@@ -91896,7 +93148,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long int" >&5
 $as_echo_n "checking size of long int... " >&6; }
-if test "${ac_cv_sizeof_long_int+set}" = set; then :
+if ${ac_cv_sizeof_long_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long int))" "ac_cv_sizeof_long_int"        "$ac_includes_default"; then :
@@ -91905,9 +93157,8 @@
   if test "$ac_cv_type_long_int" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long int)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long int)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long_int=0
    fi
@@ -91974,7 +93225,7 @@
   fi
 
   else
-    as_fn_error "ctpublic.h missing!" "$LINENO" 5
+    as_fn_error $? "ctpublic.h missing!" "$LINENO" 5
   fi
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking Checking Sybase libdir" >&5
@@ -92252,7 +93503,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for netg_errstr in -lsybtcl64" >&5
 $as_echo_n "checking for netg_errstr in -lsybtcl64... " >&6; }
-if test "${ac_cv_lib_sybtcl64_netg_errstr+set}" = set; then :
+if ${ac_cv_lib_sybtcl64_netg_errstr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -92286,7 +93537,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sybtcl64_netg_errstr" >&5
 $as_echo "$ac_cv_lib_sybtcl64_netg_errstr" >&6; }
-if test "x$ac_cv_lib_sybtcl64_netg_errstr" = x""yes; then :
+if test "x$ac_cv_lib_sybtcl64_netg_errstr" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -92447,7 +93698,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for insck__getVdate in -linsck64" >&5
 $as_echo_n "checking for insck__getVdate in -linsck64... " >&6; }
-if test "${ac_cv_lib_insck64_insck__getVdate+set}" = set; then :
+if ${ac_cv_lib_insck64_insck__getVdate+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -92481,7 +93732,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_insck64_insck__getVdate" >&5
 $as_echo "$ac_cv_lib_insck64_insck__getVdate" >&6; }
-if test "x$ac_cv_lib_insck64_insck__getVdate" = x""yes; then :
+if test "x$ac_cv_lib_insck64_insck__getVdate" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -92615,7 +93866,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for bsd_tcp in -linsck64" >&5
 $as_echo_n "checking for bsd_tcp in -linsck64... " >&6; }
-if test "${ac_cv_lib_insck64_bsd_tcp+set}" = set; then :
+if ${ac_cv_lib_insck64_bsd_tcp+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -92649,7 +93900,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_insck64_bsd_tcp" >&5
 $as_echo "$ac_cv_lib_insck64_bsd_tcp" >&6; }
-if test "x$ac_cv_lib_insck64_bsd_tcp" = x""yes; then :
+if test "x$ac_cv_lib_insck64_bsd_tcp" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -92883,7 +94134,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for netg_errstr in -lsybtcl" >&5
 $as_echo_n "checking for netg_errstr in -lsybtcl... " >&6; }
-if test "${ac_cv_lib_sybtcl_netg_errstr+set}" = set; then :
+if ${ac_cv_lib_sybtcl_netg_errstr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -92917,7 +94168,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sybtcl_netg_errstr" >&5
 $as_echo "$ac_cv_lib_sybtcl_netg_errstr" >&6; }
-if test "x$ac_cv_lib_sybtcl_netg_errstr" = x""yes; then :
+if test "x$ac_cv_lib_sybtcl_netg_errstr" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -93078,7 +94329,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for insck__getVdate in -linsck" >&5
 $as_echo_n "checking for insck__getVdate in -linsck... " >&6; }
-if test "${ac_cv_lib_insck_insck__getVdate+set}" = set; then :
+if ${ac_cv_lib_insck_insck__getVdate+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -93112,7 +94363,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_insck_insck__getVdate" >&5
 $as_echo "$ac_cv_lib_insck_insck__getVdate" >&6; }
-if test "x$ac_cv_lib_insck_insck__getVdate" = x""yes; then :
+if test "x$ac_cv_lib_insck_insck__getVdate" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -93246,7 +94497,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for bsd_tcp in -linsck" >&5
 $as_echo_n "checking for bsd_tcp in -linsck... " >&6; }
-if test "${ac_cv_lib_insck_bsd_tcp+set}" = set; then :
+if ${ac_cv_lib_insck_bsd_tcp+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -93280,7 +94531,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_insck_bsd_tcp" >&5
 $as_echo "$ac_cv_lib_insck_bsd_tcp" >&6; }
-if test "x$ac_cv_lib_insck_bsd_tcp" = x""yes; then :
+if test "x$ac_cv_lib_insck_bsd_tcp" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -93514,7 +94765,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for netg_errstr in -ltcl" >&5
 $as_echo_n "checking for netg_errstr in -ltcl... " >&6; }
-if test "${ac_cv_lib_tcl_netg_errstr+set}" = set; then :
+if ${ac_cv_lib_tcl_netg_errstr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -93548,7 +94799,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_tcl_netg_errstr" >&5
 $as_echo "$ac_cv_lib_tcl_netg_errstr" >&6; }
-if test "x$ac_cv_lib_tcl_netg_errstr" = x""yes; then :
+if test "x$ac_cv_lib_tcl_netg_errstr" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -93709,7 +94960,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for insck__getVdate in -linsck" >&5
 $as_echo_n "checking for insck__getVdate in -linsck... " >&6; }
-if test "${ac_cv_lib_insck_insck__getVdate+set}" = set; then :
+if ${ac_cv_lib_insck_insck__getVdate+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -93743,7 +94994,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_insck_insck__getVdate" >&5
 $as_echo "$ac_cv_lib_insck_insck__getVdate" >&6; }
-if test "x$ac_cv_lib_insck_insck__getVdate" = x""yes; then :
+if test "x$ac_cv_lib_insck_insck__getVdate" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -93877,7 +95128,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for bsd_tcp in -linsck" >&5
 $as_echo_n "checking for bsd_tcp in -linsck... " >&6; }
-if test "${ac_cv_lib_insck_bsd_tcp+set}" = set; then :
+if ${ac_cv_lib_insck_bsd_tcp+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -93911,7 +95162,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_insck_bsd_tcp" >&5
 $as_echo "$ac_cv_lib_insck_bsd_tcp" >&6; }
-if test "x$ac_cv_lib_insck_bsd_tcp" = x""yes; then :
+if test "x$ac_cv_lib_insck_bsd_tcp" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -93998,10 +95249,10 @@
 
 if test "$PHP_SYSVMSG" != "no"; then
   ac_fn_c_check_header_mongrel "$LINENO" "sys/msg.h" "ac_cv_header_sys_msg_h" "$ac_includes_default"
-if test "x$ac_cv_header_sys_msg_h" = x""yes; then :
+if test "x$ac_cv_header_sys_msg_h" = xyes; then :
 
 else
-  as_fn_error "Cannot enable System V IPC support, sys/msg.h is missing" "$LINENO" 5
+  as_fn_error $? "Cannot enable System V IPC support, sys/msg.h is missing" "$LINENO" 5
 
 fi
 
@@ -94649,7 +95900,7 @@
 
  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for union semun" >&5
 $as_echo_n "checking for union semun... " >&6; }
-if test "${php_cv_semun+set}" = set; then :
+if ${php_cv_semun+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -95101,7 +96352,7 @@
   done
 
   if test -z "$TIDY_DIR"; then
-    as_fn_error "Cannot find libtidy" "$LINENO" 5
+    as_fn_error $? "Cannot find libtidy" "$LINENO" 5
   fi
 
   TIDY_LIBDIR=$TIDY_DIR/$PHP_LIBDIR
@@ -95332,7 +96583,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for tidyOptGetDoc in -ltidy" >&5
 $as_echo_n "checking for tidyOptGetDoc in -ltidy... " >&6; }
-if test "${ac_cv_lib_tidy_tidyOptGetDoc+set}" = set; then :
+if ${ac_cv_lib_tidy_tidyOptGetDoc+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -95366,7 +96617,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_tidy_tidyOptGetDoc" >&5
 $as_echo "$ac_cv_lib_tidy_tidyOptGetDoc" >&6; }
-if test "x$ac_cv_lib_tidy_tidyOptGetDoc" = x""yes; then :
+if test "x$ac_cv_lib_tidy_tidyOptGetDoc" = xyes; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -96135,13 +97386,13 @@
 
         if test "$PHP_LIBEXPAT_DIR" = "no"; then
     if test "$PHP_LIBXML" = "no"; then
-      as_fn_error "WDDX extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
+      as_fn_error $? "WDDX extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
     fi
 
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for xml2-config path" >&5
 $as_echo_n "checking for xml2-config path... " >&6; }
-if test "${ac_cv_php_xml2_config_path+set}" = set; then :
+if ${ac_cv_php_xml2_config_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -96299,7 +97550,7 @@
 
             { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether libxml build works" >&5
 $as_echo_n "checking whether libxml build works... " >&6; }
-if test "${php_cv_libxml_build_works+set}" = set; then :
+if ${php_cv_libxml_build_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -96337,7 +97588,7 @@
 
           { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-          as_fn_error "build test failed.  Please check the config.log for details." "$LINENO" 5
+          as_fn_error $? "build test failed.  Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -96408,10 +97659,10 @@
       fi
 
     else
-      as_fn_error "libxml2 version 2.6.11 or greater required." "$LINENO" 5
+      as_fn_error $? "libxml2 version 2.6.11 or greater required." "$LINENO" 5
     fi
 else
-      as_fn_error "xml2-config not found. Use --with-libxml-dir=<DIR>" "$LINENO" 5
+      as_fn_error $? "xml2-config not found. Use --with-libxml-dir=<DIR>" "$LINENO" 5
 
   fi
 
@@ -96426,7 +97677,7 @@
     done
 
     if test -z "$EXPAT_DIR"; then
-      as_fn_error "not found. Please reinstall the expat distribution." "$LINENO" 5
+      as_fn_error $? "not found. Please reinstall the expat distribution." "$LINENO" 5
     fi
 
 
@@ -96863,7 +98114,7 @@
   is_it_shared=$PHP_LIBXML_SHARED
   is_it_enabled=$PHP_LIBXML
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension wddx to build statically, but it
 depends on extension libxml, which you've configured to build shared.
 You either need to build wddx shared or build libxml statically for the
@@ -96871,7 +98122,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension wddx, which depends on extension libxml,
 but you've either not enabled libxml, or have disabled it.
 " "$LINENO" 5
@@ -96982,13 +98233,13 @@
         if test "$PHP_LIBEXPAT_DIR" = "no"; then
 
     if test "$PHP_LIBXML" = "no"; then
-      as_fn_error "XML extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
+      as_fn_error $? "XML extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
     fi
 
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for xml2-config path" >&5
 $as_echo_n "checking for xml2-config path... " >&6; }
-if test "${ac_cv_php_xml2_config_path+set}" = set; then :
+if ${ac_cv_php_xml2_config_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -97146,7 +98397,7 @@
 
             { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether libxml build works" >&5
 $as_echo_n "checking whether libxml build works... " >&6; }
-if test "${php_cv_libxml_build_works+set}" = set; then :
+if ${php_cv_libxml_build_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -97184,7 +98435,7 @@
 
           { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-          as_fn_error "build test failed.  Please check the config.log for details." "$LINENO" 5
+          as_fn_error $? "build test failed.  Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -97209,7 +98460,7 @@
   is_it_shared=$PHP_LIBXML_SHARED
   is_it_enabled=$PHP_LIBXML
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension xml to build statically, but it
 depends on extension libxml, which you've configured to build shared.
 You either need to build xml shared or build libxml statically for the
@@ -97217,7 +98468,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension xml, which depends on extension libxml,
 but you've either not enabled libxml, or have disabled it.
 " "$LINENO" 5
@@ -97225,10 +98476,10 @@
 
 
     else
-      as_fn_error "libxml2 version 2.6.11 or greater required." "$LINENO" 5
+      as_fn_error $? "libxml2 version 2.6.11 or greater required." "$LINENO" 5
     fi
 else
-      as_fn_error "xml2-config not found. Use --with-libxml-dir=<DIR>" "$LINENO" 5
+      as_fn_error $? "xml2-config not found. Use --with-libxml-dir=<DIR>" "$LINENO" 5
 
   fi
 
@@ -97243,7 +98494,7 @@
     done
 
     if test -z "$EXPAT_DIR"; then
-      as_fn_error "not found. Please reinstall the expat distribution." "$LINENO" 5
+      as_fn_error $? "not found. Please reinstall the expat distribution." "$LINENO" 5
     fi
 
 
@@ -97772,13 +99023,13 @@
 if test "$PHP_XMLREADER" != "no"; then
 
   if test "$PHP_LIBXML" = "no"; then
-    as_fn_error "XMLReader extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
+    as_fn_error $? "XMLReader extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
   fi
 
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for xml2-config path" >&5
 $as_echo_n "checking for xml2-config path... " >&6; }
-if test "${ac_cv_php_xml2_config_path+set}" = set; then :
+if ${ac_cv_php_xml2_config_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -97936,7 +99187,7 @@
 
             { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether libxml build works" >&5
 $as_echo_n "checking whether libxml build works... " >&6; }
-if test "${php_cv_libxml_build_works+set}" = set; then :
+if ${php_cv_libxml_build_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -97974,7 +99225,7 @@
 
           { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-          as_fn_error "build test failed.  Please check the config.log for details." "$LINENO" 5
+          as_fn_error $? "build test failed.  Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -98294,7 +99545,7 @@
   is_it_shared=$PHP_DOM_SHARED
   is_it_enabled=$PHP_DOM
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension xmlreader to build statically, but it
 depends on extension dom, which you've configured to build shared.
 You either need to build xmlreader shared or build dom statically for the
@@ -98302,7 +99553,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "xtrue" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension xmlreader, which depends on extension dom,
 but you've either not enabled dom, or have disabled it.
 " "$LINENO" 5
@@ -98313,10 +99564,10 @@
 
 
     else
-      as_fn_error "libxml2 version 2.6.11 or greater required." "$LINENO" 5
+      as_fn_error $? "libxml2 version 2.6.11 or greater required." "$LINENO" 5
     fi
 else
-    as_fn_error "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
+    as_fn_error $? "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
 
   fi
 
@@ -98462,7 +99713,7 @@
   is_it_shared=$PHP_LIBXML_SHARED
   is_it_enabled=$PHP_LIBXML
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension xmlrpc to build statically, but it
 depends on extension libxml, which you've configured to build shared.
 You either need to build xmlrpc shared or build libxml statically for the
@@ -98470,7 +99721,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension xmlrpc, which depends on extension libxml,
 but you've either not enabled libxml, or have disabled it.
 " "$LINENO" 5
@@ -98486,13 +99737,13 @@
         if test "$PHP_LIBEXPAT_DIR" = "no"; then
 
     if test "$PHP_LIBXML" = "no"; then
-      as_fn_error "XML-RPC extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
+      as_fn_error $? "XML-RPC extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
     fi
 
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for xml2-config path" >&5
 $as_echo_n "checking for xml2-config path... " >&6; }
-if test "${ac_cv_php_xml2_config_path+set}" = set; then :
+if ${ac_cv_php_xml2_config_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -98650,7 +99901,7 @@
 
             { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether libxml build works" >&5
 $as_echo_n "checking whether libxml build works... " >&6; }
-if test "${php_cv_libxml_build_works+set}" = set; then :
+if ${php_cv_libxml_build_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -98688,7 +99939,7 @@
 
           { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-          as_fn_error "build test failed.  Please check the config.log for details." "$LINENO" 5
+          as_fn_error $? "build test failed.  Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -98759,10 +100010,10 @@
       fi
 
     else
-      as_fn_error "libxml2 version 2.6.11 or greater required." "$LINENO" 5
+      as_fn_error $? "libxml2 version 2.6.11 or greater required." "$LINENO" 5
     fi
 else
-      as_fn_error "xml2-config not found. Use --with-libxml-dir=<DIR>" "$LINENO" 5
+      as_fn_error $? "xml2-config not found. Use --with-libxml-dir=<DIR>" "$LINENO" 5
 
   fi
 
@@ -98907,7 +100158,7 @@
     done
 
     if test "$testval" = "no"; then
-      as_fn_error "XML-RPC support requires libexpat. Use --with-libexpat-dir=<DIR> (deprecated!)" "$LINENO" 5
+      as_fn_error $? "XML-RPC support requires libexpat. Use --with-libexpat-dir=<DIR> (deprecated!)" "$LINENO" 5
     fi
   fi
 
@@ -98943,14 +100194,14 @@
             LIBS_save="$LIBS"
     LIBS=
     ac_fn_c_check_func "$LINENO" "iconv" "ac_cv_func_iconv"
-if test "x$ac_cv_func_iconv" = x""yes; then :
+if test "x$ac_cv_func_iconv" = xyes; then :
 
       found_iconv=yes
 
 else
 
       ac_fn_c_check_func "$LINENO" "libiconv" "ac_cv_func_libiconv"
-if test "x$ac_cv_func_libiconv" = x""yes; then :
+if test "x$ac_cv_func_libiconv" = xyes; then :
 
 
   echo "#define HAVE_LIBICONV 1" > ext/iconv/php_have_libiconv.h
@@ -98986,7 +100237,7 @@
     done
 
     if test -z "$ICONV_DIR"; then
-      as_fn_error "Please specify the install prefix of iconv with --with-iconv=<DIR>" "$LINENO" 5
+      as_fn_error $? "Please specify the install prefix of iconv with --with-iconv=<DIR>" "$LINENO" 5
     fi
 
     if test -f $ICONV_DIR/$PHP_LIBDIR/lib$iconv_lib_name.a ||
@@ -99092,7 +100343,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$iconv_lib_name''_libiconv" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for libiconv in -l$iconv_lib_name" >&5
 $as_echo_n "checking for libiconv in -l$iconv_lib_name... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -99127,8 +100378,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -99254,7 +100504,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$iconv_lib_name''_iconv" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for iconv in -l$iconv_lib_name" >&5
 $as_echo_n "checking for iconv in -l$iconv_lib_name... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -99289,8 +100539,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -99453,7 +100702,7 @@
     fi
 
 else
-      as_fn_error "iconv not found, in order to build xmlrpc you need the iconv library" "$LINENO" 5
+      as_fn_error $? "iconv not found, in order to build xmlrpc you need the iconv library" "$LINENO" 5
 
   fi
 
@@ -99466,7 +100715,7 @@
 set dummy ${ac_tool_prefix}ranlib; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_RANLIB+set}" = set; then :
+if ${ac_cv_prog_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$RANLIB"; then
@@ -99506,7 +100755,7 @@
 set dummy ranlib; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then :
+if ${ac_cv_prog_ac_ct_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_RANLIB"; then
@@ -99555,7 +100804,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for inline" >&5
 $as_echo_n "checking for inline... " >&6; }
-if test "${ac_cv_c_inline+set}" = set; then :
+if ${ac_cv_c_inline+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_cv_c_inline=no
@@ -99608,7 +100857,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
 $as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then :
+if ${ac_cv_header_stdc+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -99722,8 +100971,7 @@
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -99743,7 +100991,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of char" >&5
 $as_echo_n "checking size of char... " >&6; }
-if test "${ac_cv_sizeof_char+set}" = set; then :
+if ${ac_cv_sizeof_char+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (char))" "ac_cv_sizeof_char"        "$ac_includes_default"; then :
@@ -99752,9 +101000,8 @@
   if test "$ac_cv_type_char" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (char)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (char)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_char=0
    fi
@@ -99778,7 +101025,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of int" >&5
 $as_echo_n "checking size of int... " >&6; }
-if test "${ac_cv_sizeof_int+set}" = set; then :
+if ${ac_cv_sizeof_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (int))" "ac_cv_sizeof_int"        "$ac_includes_default"; then :
@@ -99787,9 +101034,8 @@
   if test "$ac_cv_type_int" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (int)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (int)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_int=0
    fi
@@ -99812,7 +101058,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long" >&5
 $as_echo_n "checking size of long... " >&6; }
-if test "${ac_cv_sizeof_long+set}" = set; then :
+if ${ac_cv_sizeof_long+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long))" "ac_cv_sizeof_long"        "$ac_includes_default"; then :
@@ -99821,9 +101067,8 @@
   if test "$ac_cv_type_long" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long=0
    fi
@@ -99846,7 +101091,7 @@
 # This bug is HP SR number 8606223364.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long long" >&5
 $as_echo_n "checking size of long long... " >&6; }
-if test "${ac_cv_sizeof_long_long+set}" = set; then :
+if ${ac_cv_sizeof_long_long+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (long long))" "ac_cv_sizeof_long_long"        "$ac_includes_default"; then :
@@ -99855,9 +101100,8 @@
   if test "$ac_cv_type_long_long" = yes; then
      { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "cannot compute sizeof (long long)
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "cannot compute sizeof (long long)
+See \`config.log' for more details" "$LINENO" 5; }
    else
      ac_cv_sizeof_long_long=0
    fi
@@ -99875,7 +101119,7 @@
 
 
 ac_fn_c_check_type "$LINENO" "size_t" "ac_cv_type_size_t" "$ac_includes_default"
-if test "x$ac_cv_type_size_t" = x""yes; then :
+if test "x$ac_cv_type_size_t" = xyes; then :
 
 else
 
@@ -99887,7 +101131,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether time.h and sys/time.h may both be included" >&5
 $as_echo_n "checking whether time.h and sys/time.h may both be included... " >&6; }
-if test "${ac_cv_header_time+set}" = set; then :
+if ${ac_cv_header_time+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -99922,7 +101166,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for uid_t in sys/types.h" >&5
 $as_echo_n "checking for uid_t in sys/types.h... " >&6; }
-if test "${ac_cv_type_uid_t+set}" = set; then :
+if ${ac_cv_type_uid_t+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -99963,8 +101207,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -100317,7 +101560,7 @@
   if test -z "$XMLRPC_DIR"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
 $as_echo "not found" >&6; }
-    as_fn_error "Please reinstall the XMLRPC-EPI distribution" "$LINENO" 5
+    as_fn_error $? "Please reinstall the XMLRPC-EPI distribution" "$LINENO" 5
   fi
 
 
@@ -100818,13 +102061,13 @@
 if test "$PHP_XMLWRITER" != "no"; then
 
   if test "$PHP_LIBXML" = "no"; then
-    as_fn_error "XMLWriter extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
+    as_fn_error $? "XMLWriter extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
   fi
 
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for xml2-config path" >&5
 $as_echo_n "checking for xml2-config path... " >&6; }
-if test "${ac_cv_php_xml2_config_path+set}" = set; then :
+if ${ac_cv_php_xml2_config_path+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -100982,7 +102225,7 @@
 
             { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether libxml build works" >&5
 $as_echo_n "checking whether libxml build works... " >&6; }
-if test "${php_cv_libxml_build_works+set}" = set; then :
+if ${php_cv_libxml_build_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -101020,7 +102263,7 @@
 
           { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-          as_fn_error "build test failed.  Please check the config.log for details." "$LINENO" 5
+          as_fn_error $? "build test failed.  Please check the config.log for details." "$LINENO" 5
 
 
 fi
@@ -101340,10 +102583,10 @@
 
 
     else
-      as_fn_error "libxml2 version 2.6.11 or greater required." "$LINENO" 5
+      as_fn_error $? "libxml2 version 2.6.11 or greater required." "$LINENO" 5
     fi
 else
-    as_fn_error "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
+    as_fn_error $? "xml2-config not found. Please check your libxml2 installation." "$LINENO" 5
 
   fi
 
@@ -101398,11 +102641,11 @@
 if test "$PHP_XSL" != "no"; then
 
   if test "$PHP_LIBXML" = "no"; then
-    as_fn_error "XSL extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
+    as_fn_error $? "XSL extension requires LIBXML extension, add --enable-libxml" "$LINENO" 5
   fi
 
   if test "$PHP_DOM" = "no"; then
-    as_fn_error "XSL extension requires DOM extension, add --enable-dom" "$LINENO" 5
+    as_fn_error $? "XSL extension requires DOM extension, add --enable-dom" "$LINENO" 5
   fi
 
   for i in $PHP_XSL /usr/local /usr; do
@@ -101413,7 +102656,7 @@
   done
 
   if test -z "$XSLT_CONFIG"; then
-    as_fn_error "xslt-config not found. Please reinstall the libxslt >= 1.1.0 distribution" "$LINENO" 5
+    as_fn_error $? "xslt-config not found. Please reinstall the libxslt >= 1.1.0 distribution" "$LINENO" 5
   else
     libxslt_full_version=`$XSLT_CONFIG --version`
     ac_IFS=$IFS
@@ -101701,7 +102944,7 @@
 
       fi
     else
-      as_fn_error "libxslt version 1.1.0 or greater required." "$LINENO" 5
+      as_fn_error $? "libxslt version 1.1.0 or greater required." "$LINENO" 5
     fi
 
 
@@ -102011,7 +103254,7 @@
   is_it_shared=$PHP_LIBXML_SHARED
   is_it_enabled=$PHP_LIBXML
   if test "$am_i_shared" = "no" && test "$is_it_shared" = "yes" ; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension xsl to build statically, but it
 depends on extension libxml, which you've configured to build shared.
 You either need to build xsl shared or build libxml statically for the
@@ -102019,7 +103262,7 @@
 " "$LINENO" 5
   fi
   if test "x$is_it_enabled" = "xno" && test "x" != "xtrue"; then
-    as_fn_error "
+    as_fn_error $? "
 You've configured extension xsl, which depends on extension libxml,
 but you've either not enabled libxml, or have disabled it.
 " "$LINENO" 5
@@ -102132,7 +103375,7 @@
       PHP_ZLIB_DIR="$PHP_ZLIB_DIR"
       PHP_ZLIB_INCDIR="$PHP_ZLIB_DIR/include"
     else
-      as_fn_error "Can not find zlib headers under \"$PHP_ZLIB_DIR\"" "$LINENO" 5
+      as_fn_error $? "Can not find zlib headers under \"$PHP_ZLIB_DIR\"" "$LINENO" 5
     fi
   else
     for i in /usr/local /usr; do
@@ -102149,7 +103392,7 @@
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for the location of zlib" >&5
 $as_echo_n "checking for the location of zlib... " >&6; }
   if test "$PHP_ZLIB_DIR" = "no"; then
-    as_fn_error "zip support requires ZLIB. Use --with-zlib-dir=<DIR> to specify prefix where ZLIB include and library are located" "$LINENO" 5
+    as_fn_error $? "zip support requires ZLIB. Use --with-zlib-dir=<DIR> to specify prefix where ZLIB include and library are located" "$LINENO" 5
   else
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PHP_ZLIB_DIR" >&5
 $as_echo "$PHP_ZLIB_DIR" >&6; }
@@ -103112,7 +104355,7 @@
 $as_echo_n "checking whether $php_typename exists... " >&6; }
 
   php_cache_value=php_cv_sizeof_$php_typename
-  if { as_var=php_cv_sizeof_$php_typename; eval "test \"\${$as_var+set}\" = set"; }; then :
+  if eval \${php_cv_sizeof_$php_typename+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -103296,7 +104539,7 @@
   as_ac_Lib=`$as_echo "ac_cv_lib_$MYSQL_LIBNAME''_hash_insert" | $as_tr_sh`
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for hash_insert in -l$MYSQL_LIBNAME" >&5
 $as_echo_n "checking for hash_insert in -l$MYSQL_LIBNAME... " >&6; }
-if { as_var=$as_ac_Lib; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval \${$as_ac_Lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -103331,8 +104574,7 @@
 eval ac_res=\$$as_ac_Lib
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-eval as_val=\$$as_ac_Lib
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
 
     LDFLAGS=$save_old_LDFLAGS
     ext_shared=$save_ext_shared
@@ -103352,7 +104594,7 @@
   fi
 
   if test -n "$recode_conflict"; then
-    as_fn_error "recode extension can not be configured together with:$recode_conflict" "$LINENO" 5
+    as_fn_error $? "recode extension can not be configured together with:$recode_conflict" "$LINENO" 5
   fi
 fi
 
@@ -103470,7 +104712,7 @@
 
 
   if test "$pear_error_msg"; then
-    as_fn_error "$pear_error_msg" "$LINENO" 5
+    as_fn_error $? "$pear_error_msg" "$LINENO" 5
   fi
 
   install_pear="install-pear"
@@ -103525,7 +104767,7 @@
   if test "$YACC"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for bison version" >&5
 $as_echo_n "checking for bison version... " >&6; }
-if test "${php_cv_bison_version+set}" = set; then :
+if ${php_cv_bison_version+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -103581,8 +104823,7 @@
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -103593,7 +104834,7 @@
 
 
 ac_fn_c_check_type "$LINENO" "size_t" "ac_cv_type_size_t" "$ac_includes_default"
-if test "x$ac_cv_type_size_t" = x""yes; then :
+if test "x$ac_cv_type_size_t" = xyes; then :
 
 else
 
@@ -103605,7 +104846,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking return type of signal handlers" >&5
 $as_echo_n "checking return type of signal handlers... " >&6; }
-if test "${ac_cv_type_signal+set}" = set; then :
+if ${ac_cv_type_signal+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -103642,7 +104883,7 @@
 
 
 ac_fn_c_check_type "$LINENO" "uint" "ac_cv_type_uint" "$ac_includes_default"
-if test "x$ac_cv_type_uint" = x""yes; then :
+if test "x$ac_cv_type_uint" = xyes; then :
 
 else
 
@@ -103653,7 +104894,7 @@
 fi
 
 ac_fn_c_check_type "$LINENO" "ulong" "ac_cv_type_ulong" "$ac_includes_default"
-if test "x$ac_cv_type_ulong" = x""yes; then :
+if test "x$ac_cv_type_ulong" = xyes; then :
 
 else
 
@@ -103752,13 +104993,13 @@
 for ac_func in vprintf
 do :
   ac_fn_c_check_func "$LINENO" "vprintf" "ac_cv_func_vprintf"
-if test "x$ac_cv_func_vprintf" = x""yes; then :
+if test "x$ac_cv_func_vprintf" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_VPRINTF 1
 _ACEOF
 
 ac_fn_c_check_func "$LINENO" "_doprnt" "ac_cv_func__doprnt"
-if test "x$ac_cv_func__doprnt" = x""yes; then :
+if test "x$ac_cv_func__doprnt" = xyes; then :
 
 $as_echo "#define HAVE_DOPRNT 1" >>confdefs.h
 
@@ -103770,7 +105011,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working memcmp" >&5
 $as_echo_n "checking for working memcmp... " >&6; }
-if test "${ac_cv_func_memcmp_working+set}" = set; then :
+if ${ac_cv_func_memcmp_working+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "$cross_compiling" = yes; then :
@@ -103834,7 +105075,7 @@
 # for constant arguments.  Useless!
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working alloca.h" >&5
 $as_echo_n "checking for working alloca.h... " >&6; }
-if test "${ac_cv_working_alloca_h+set}" = set; then :
+if ${ac_cv_working_alloca_h+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -103867,7 +105108,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for alloca" >&5
 $as_echo_n "checking for alloca... " >&6; }
-if test "${ac_cv_func_alloca_works+set}" = set; then :
+if ${ac_cv_func_alloca_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -103886,7 +105127,7 @@
  #pragma alloca
 #   else
 #    ifndef alloca /* predefined by HP cc +Olibcalls */
-char *alloca ();
+void *alloca (size_t);
 #    endif
 #   endif
 #  endif
@@ -103930,7 +105171,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether \`alloca.c' needs Cray hooks" >&5
 $as_echo_n "checking whether \`alloca.c' needs Cray hooks... " >&6; }
-if test "${ac_cv_os_cray+set}" = set; then :
+if ${ac_cv_os_cray+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -103957,8 +105198,7 @@
   for ac_func in _getb67 GETB67 getb67; do
     as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
 
 cat >>confdefs.h <<_ACEOF
 #define CRAY_STACKSEG_END $ac_func
@@ -103972,7 +105212,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking stack direction for C alloca" >&5
 $as_echo_n "checking stack direction for C alloca... " >&6; }
-if test "${ac_cv_c_stack_direction+set}" = set; then :
+if ${ac_cv_c_stack_direction+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "$cross_compiling" = yes; then :
@@ -104024,8 +105264,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -104036,7 +105275,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether sprintf is broken" >&5
 $as_echo_n "checking whether sprintf is broken... " >&6; }
-if test "${ac_cv_broken_sprintf+set}" = set; then :
+if ${ac_cv_broken_sprintf+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -104082,8 +105321,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -104095,7 +105333,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether fp_except is defined" >&5
 $as_echo_n "checking whether fp_except is defined... " >&6; }
-if test "${ac_cv_type_fp_except+set}" = set; then :
+if ${ac_cv_type_fp_except+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -104412,7 +105650,7 @@
 for ac_header in dlfcn.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "dlfcn.h" "ac_cv_header_dlfcn_h" "$ac_includes_default"
-if test "x$ac_cv_header_dlfcn_h" = x""yes; then :
+if test "x$ac_cv_header_dlfcn_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_DLFCN_H 1
 _ACEOF
@@ -104430,7 +105668,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 104433 "configure"
+#line 105671 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -104645,7 +105883,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for inline" >&5
 $as_echo_n "checking for inline... " >&6; }
-if test "${ac_cv_c_inline+set}" = set; then :
+if ${ac_cv_c_inline+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_cv_c_inline=no
@@ -104910,7 +106148,7 @@
 for ac_func in mremap
 do :
   ac_fn_c_check_func "$LINENO" "mremap" "ac_cv_func_mremap"
-if test "x$ac_cv_func_mremap" = x""yes; then :
+if test "x$ac_cv_func_mremap" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_MREMAP 1
 _ACEOF
@@ -104933,7 +106171,7 @@
 
 
 ac_fn_c_check_func "$LINENO" "sigaction" "ac_cv_func_sigaction"
-if test "x$ac_cv_func_sigaction" = x""yes; then :
+if test "x$ac_cv_func_sigaction" = xyes; then :
 
 
 $as_echo "#define HAVE_SIGACTION 1" >>confdefs.h
@@ -104998,7 +106236,7 @@
 for ac_header in stdarg.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "stdarg.h" "ac_cv_header_stdarg_h" "$ac_includes_default"
-if test "x$ac_cv_header_stdarg_h" = x""yes; then :
+if test "x$ac_cv_header_stdarg_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_STDARG_H 1
 _ACEOF
@@ -105011,7 +106249,7 @@
 for ac_func in sigprocmask
 do :
   ac_fn_c_check_func "$LINENO" "sigprocmask" "ac_cv_func_sigprocmask"
-if test "x$ac_cv_func_sigprocmask" = x""yes; then :
+if test "x$ac_cv_func_sigprocmask" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_SIGPROCMASK 1
 _ACEOF
@@ -105100,14 +106338,14 @@
   for ac_header in st.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "st.h" "ac_cv_header_st_h" "$ac_includes_default"
-if test "x$ac_cv_header_st_h" = x""yes; then :
+if test "x$ac_cv_header_st_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_ST_H 1
 _ACEOF
 
 else
 
-    as_fn_error "Sorry, I was unable to locate the State Threads header file.  Please specify the prefix using --with-tsrm-st=/prefix" "$LINENO" 5
+    as_fn_error $? "Sorry, I was unable to locate the State Threads header file.  Please specify the prefix using --with-tsrm-st=/prefix" "$LINENO" 5
 
 fi
 
@@ -105189,7 +106427,7 @@
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthreads_cflags" >&5
 $as_echo_n "checking for pthreads_cflags... " >&6; }
-if test "${ac_cv_pthreads_cflags+set}" = set; then :
+if ${ac_cv_pthreads_cflags+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -105255,7 +106493,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthreads_lib" >&5
 $as_echo_n "checking for pthreads_lib... " >&6; }
-if test "${ac_cv_pthreads_lib+set}" = set; then :
+if ${ac_cv_pthreads_lib+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -105331,7 +106569,7 @@
 
 else
   if test "$pthreads_working" != "yes"; then
-    as_fn_error "Your system seems to lack POSIX threads." "$LINENO" 5
+    as_fn_error $? "Your system seems to lack POSIX threads." "$LINENO" 5
   fi
 
 
@@ -105974,7 +107212,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for non-GNU ld" >&5
 $as_echo_n "checking for non-GNU ld... " >&6; }
 fi
-if test "${lt_cv_path_LD+set}" = set; then :
+if ${lt_cv_path_LD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$LD"; then
@@ -106011,10 +107249,10 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
-test -z "$LD" && as_fn_error "no acceptable ld found in \$PATH" "$LINENO" 5
+test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
 $as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
-if test "${lt_cv_prog_gnu_ld+set}" = set; then :
+if ${lt_cv_prog_gnu_ld+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   # I'd rather use --version here, but apparently some GNU lds only accept -v.
@@ -106034,7 +107272,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $LD option to reload object files" >&5
 $as_echo_n "checking for $LD option to reload object files... " >&6; }
-if test "${lt_cv_ld_reload_flag+set}" = set; then :
+if ${lt_cv_ld_reload_flag+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_ld_reload_flag='-r'
@@ -106059,7 +107297,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for BSD-compatible nm" >&5
 $as_echo_n "checking for BSD-compatible nm... " >&6; }
-if test "${lt_cv_path_NM+set}" = set; then :
+if ${lt_cv_path_NM+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$NM"; then
@@ -106112,7 +107350,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to recognize dependent libraries" >&5
 $as_echo_n "checking how to recognize dependent libraries... " >&6; }
-if test "${lt_cv_deplibs_check_method+set}" = set; then :
+if ${lt_cv_deplibs_check_method+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_file_magic_cmd='$MAGIC_CMD'
@@ -106342,7 +107580,7 @@
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 106345 "configure"' > conftest.$ac_ext
+  echo '#line 107583 "configure"' > conftest.$ac_ext
   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
@@ -106436,7 +107674,7 @@
   CFLAGS="$CFLAGS -belf"
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler needs -belf" >&5
 $as_echo_n "checking whether the C compiler needs -belf... " >&6; }
-if test "${lt_cv_cc_needs_belf+set}" = set; then :
+if ${lt_cv_cc_needs_belf+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -106521,7 +107759,7 @@
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C++ preprocessor" >&5
 $as_echo_n "checking how to run the C++ preprocessor... " >&6; }
 if test -z "$CXXCPP"; then
-  if test "${ac_cv_prog_CXXCPP+set}" = set; then :
+  if ${ac_cv_prog_CXXCPP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
       # Double quotes because CXXCPP needs to be expanded
@@ -106551,7 +107789,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -106567,11 +107805,11 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
   break
 fi
@@ -106610,7 +107848,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -106626,18 +107864,18 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
 
 else
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "C++ preprocessor \"$CXXCPP\" fails sanity check
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "C++ preprocessor \"$CXXCPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 
 ac_ext=cpp
@@ -106653,7 +107891,7 @@
 # find the maximum length of command line arguments
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking the maximum length of command line arguments" >&5
 $as_echo_n "checking the maximum length of command line arguments... " >&6; }
-if test "${lt_cv_sys_max_cmd_len+set}" = set; then :
+if ${lt_cv_sys_max_cmd_len+:} false; then :
   $as_echo_n "(cached) " >&6
 else
     i=0
@@ -106777,7 +108015,7 @@
 # Check for command to grab the raw symbol name followed by C symbol from nm.
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking command to parse $NM output from $compiler object" >&5
 $as_echo_n "checking command to parse $NM output from $compiler object... " >&6; }
-if test "${lt_cv_sys_global_symbol_pipe+set}" = set; then :
+if ${lt_cv_sys_global_symbol_pipe+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -106989,7 +108227,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for objdir" >&5
 $as_echo_n "checking for objdir... " >&6; }
-if test "${lt_cv_objdir+set}" = set; then :
+if ${lt_cv_objdir+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   rm -f .libs 2>/dev/null
@@ -107056,7 +108294,7 @@
 set dummy ${ac_tool_prefix}ar; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_AR+set}" = set; then :
+if ${ac_cv_prog_AR+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$AR"; then
@@ -107096,7 +108334,7 @@
 set dummy ar; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_AR+set}" = set; then :
+if ${ac_cv_prog_ac_ct_AR+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_AR"; then
@@ -107148,7 +108386,7 @@
 set dummy ${ac_tool_prefix}ranlib; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_RANLIB+set}" = set; then :
+if ${ac_cv_prog_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$RANLIB"; then
@@ -107188,7 +108426,7 @@
 set dummy ranlib; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then :
+if ${ac_cv_prog_ac_ct_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_RANLIB"; then
@@ -107240,7 +108478,7 @@
 set dummy ${ac_tool_prefix}strip; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_STRIP+set}" = set; then :
+if ${ac_cv_prog_STRIP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$STRIP"; then
@@ -107280,7 +108518,7 @@
 set dummy strip; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_STRIP+set}" = set; then :
+if ${ac_cv_prog_ac_ct_STRIP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_STRIP"; then
@@ -107383,7 +108621,7 @@
   if test "$file_magic_cmd" = '$MAGIC_CMD'; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ${ac_tool_prefix}file" >&5
 $as_echo_n "checking for ${ac_tool_prefix}file... " >&6; }
-if test "${lt_cv_path_MAGIC_CMD+set}" = set; then :
+if ${lt_cv_path_MAGIC_CMD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $MAGIC_CMD in
@@ -107445,7 +108683,7 @@
   if test -n "$ac_tool_prefix"; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for file" >&5
 $as_echo_n "checking for file... " >&6; }
-if test "${lt_cv_path_MAGIC_CMD+set}" = set; then :
+if ${lt_cv_path_MAGIC_CMD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $MAGIC_CMD in
@@ -107520,7 +108758,7 @@
 set dummy ${ac_tool_prefix}dsymutil; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_DSYMUTIL+set}" = set; then :
+if ${ac_cv_prog_DSYMUTIL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$DSYMUTIL"; then
@@ -107560,7 +108798,7 @@
 set dummy dsymutil; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_DSYMUTIL+set}" = set; then :
+if ${ac_cv_prog_ac_ct_DSYMUTIL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_DSYMUTIL"; then
@@ -107612,7 +108850,7 @@
 set dummy ${ac_tool_prefix}nmedit; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_NMEDIT+set}" = set; then :
+if ${ac_cv_prog_NMEDIT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$NMEDIT"; then
@@ -107652,7 +108890,7 @@
 set dummy nmedit; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_NMEDIT+set}" = set; then :
+if ${ac_cv_prog_ac_ct_NMEDIT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_NMEDIT"; then
@@ -107702,7 +108940,7 @@
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -single_module linker flag" >&5
 $as_echo_n "checking for -single_module linker flag... " >&6; }
-if test "${lt_cv_apple_cc_single_mod+set}" = set; then :
+if ${lt_cv_apple_cc_single_mod+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_apple_cc_single_mod=no
@@ -107725,7 +108963,7 @@
 $as_echo "$lt_cv_apple_cc_single_mod" >&6; }
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -exported_symbols_list linker flag" >&5
 $as_echo_n "checking for -exported_symbols_list linker flag... " >&6; }
-if test "${lt_cv_ld_exported_symbols_list+set}" = set; then :
+if ${lt_cv_ld_exported_symbols_list+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_ld_exported_symbols_list=no
@@ -107734,7 +108972,7 @@
       LDFLAGS="$LDFLAGS -Wl,-exported_symbols_list,conftest.sym"
 
 cat > conftest.$ac_ext <<EOF
-#line 107737 "configure"
+#line 108975 "configure"
 #include "confdefs.h"
 int main() {
 ; return 0; }
@@ -107876,7 +109114,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
 $as_echo_n "checking if $compiler supports -fno-rtti -fno-exceptions... " >&6; }
-if test "${lt_cv_prog_compiler_rtti_exceptions+set}" = set; then :
+if ${lt_cv_prog_compiler_rtti_exceptions+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_rtti_exceptions=no
@@ -107892,11 +109130,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"configure:107895: $lt_compile\"" >&5)
+   (eval echo "\"configure:109133: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "configure:107899: \$? = $ac_status" >&5
+   echo "configure:109137: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -108174,7 +109412,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic works" >&5
 $as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic works... " >&6; }
-if test "${lt_cv_prog_compiler_pic_works+set}" = set; then :
+if ${lt_cv_prog_compiler_pic_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_pic_works=no
@@ -108190,11 +109428,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"configure:108193: $lt_compile\"" >&5)
+   (eval echo "\"configure:109431: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "configure:108197: \$? = $ac_status" >&5
+   echo "configure:109435: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -108237,7 +109475,7 @@
 wl=$lt_prog_compiler_wl eval lt_tmp_static_flag=\"$lt_prog_compiler_static\"
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
 $as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
-if test "${lt_cv_prog_compiler_static_works+set}" = set; then :
+if ${lt_cv_prog_compiler_static_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_static_works=no
@@ -108275,7 +109513,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
 $as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
-if test "${lt_cv_prog_compiler_c_o+set}" = set; then :
+if ${lt_cv_prog_compiler_c_o+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_c_o=no
@@ -108294,11 +109532,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"configure:108297: $lt_compile\"" >&5)
+   (eval echo "\"configure:109535: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "configure:108301: \$? = $ac_status" >&5
+   echo "configure:109539: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -108758,7 +109996,7 @@
        # Determine the default libpath from the value encoded in an empty executable.
 
 cat > conftest.$ac_ext <<EOF
-#line 108761 "configure"
+#line 109999 "configure"
 #include "confdefs.h"
 int main() {
 ; return 0; }
@@ -108800,7 +110038,7 @@
 	 # Determine the default libpath from the value encoded in an empty executable.
 
 cat > conftest.$ac_ext <<EOF
-#line 108803 "configure"
+#line 110041 "configure"
 #include "confdefs.h"
 int main() {
 ; return 0; }
@@ -109951,14 +111189,14 @@
 $as_echo "$dynamic_linker" >&6; }
 test "$dynamic_linker" = no && can_build_shared=no
 
-if test "${lt_cv_sys_lib_search_path_spec+set}" = set; then :
+if ${lt_cv_sys_lib_search_path_spec+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_sys_lib_search_path_spec="$sys_lib_search_path_spec"
 fi
 
 sys_lib_search_path_spec="$lt_cv_sys_lib_search_path_spec"
-if test "${lt_cv_sys_lib_dlsearch_path_spec+set}" = set; then :
+if ${lt_cv_sys_lib_dlsearch_path_spec+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_sys_lib_dlsearch_path_spec="$sys_lib_dlsearch_path_spec"
@@ -110067,7 +111305,7 @@
   # if libdl is installed we need to link against it
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
 $as_echo_n "checking for dlopen in -ldl... " >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then :
+if ${ac_cv_lib_dl_dlopen+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -110101,7 +111339,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
 $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
-if test "x$ac_cv_lib_dl_dlopen" = x""yes; then :
+if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
 else
 
@@ -110115,12 +111353,12 @@
 
   *)
     ac_fn_c_check_func "$LINENO" "shl_load" "ac_cv_func_shl_load"
-if test "x$ac_cv_func_shl_load" = x""yes; then :
+if test "x$ac_cv_func_shl_load" = xyes; then :
   lt_cv_dlopen="shl_load"
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for shl_load in -ldld" >&5
 $as_echo_n "checking for shl_load in -ldld... " >&6; }
-if test "${ac_cv_lib_dld_shl_load+set}" = set; then :
+if ${ac_cv_lib_dld_shl_load+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -110154,16 +111392,16 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_shl_load" >&5
 $as_echo "$ac_cv_lib_dld_shl_load" >&6; }
-if test "x$ac_cv_lib_dld_shl_load" = x""yes; then :
+if test "x$ac_cv_lib_dld_shl_load" = xyes; then :
   lt_cv_dlopen="shl_load" lt_cv_dlopen_libs="-ldld"
 else
   ac_fn_c_check_func "$LINENO" "dlopen" "ac_cv_func_dlopen"
-if test "x$ac_cv_func_dlopen" = x""yes; then :
+if test "x$ac_cv_func_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen"
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
 $as_echo_n "checking for dlopen in -ldl... " >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then :
+if ${ac_cv_lib_dl_dlopen+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -110197,12 +111435,12 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
 $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
-if test "x$ac_cv_lib_dl_dlopen" = x""yes; then :
+if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -lsvld" >&5
 $as_echo_n "checking for dlopen in -lsvld... " >&6; }
-if test "${ac_cv_lib_svld_dlopen+set}" = set; then :
+if ${ac_cv_lib_svld_dlopen+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -110236,12 +111474,12 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_svld_dlopen" >&5
 $as_echo "$ac_cv_lib_svld_dlopen" >&6; }
-if test "x$ac_cv_lib_svld_dlopen" = x""yes; then :
+if test "x$ac_cv_lib_svld_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-lsvld"
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dld_link in -ldld" >&5
 $as_echo_n "checking for dld_link in -ldld... " >&6; }
-if test "${ac_cv_lib_dld_dld_link+set}" = set; then :
+if ${ac_cv_lib_dld_dld_link+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -110275,7 +111513,7 @@
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_dld_link" >&5
 $as_echo "$ac_cv_lib_dld_dld_link" >&6; }
-if test "x$ac_cv_lib_dld_dld_link" = x""yes; then :
+if test "x$ac_cv_lib_dld_dld_link" = xyes; then :
   lt_cv_dlopen="dld_link" lt_cv_dlopen_libs="-ldld"
 fi
 
@@ -110316,7 +111554,7 @@
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a program can dlopen itself" >&5
 $as_echo_n "checking whether a program can dlopen itself... " >&6; }
-if test "${lt_cv_dlopen_self+set}" = set; then :
+if ${lt_cv_dlopen_self+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   	  if test "$cross_compiling" = yes; then :
@@ -110325,7 +111563,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 110328 "configure"
+#line 111566 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -110416,7 +111654,7 @@
       wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $lt_prog_compiler_static\"
       { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a statically linked program can dlopen itself" >&5
 $as_echo_n "checking whether a statically linked program can dlopen itself... " >&6; }
-if test "${lt_cv_dlopen_self_static+set}" = set; then :
+if ${lt_cv_dlopen_self_static+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   	  if test "$cross_compiling" = yes; then :
@@ -110425,7 +111663,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 110428 "configure"
+#line 111666 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -111102,13 +112340,13 @@
     # Check whether tagname contains only valid characters
     case `$echo "X$tagname" | $Xsed -e 's:[-_ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890,/]::g'` in
     "") ;;
-    *)  as_fn_error "invalid tag name: $tagname" "$LINENO" 5
+    *)  as_fn_error $? "invalid tag name: $tagname" "$LINENO" 5
 	;;
     esac
 
     if grep "^# ### BEGIN LIBTOOL TAG CONFIG: $tagname$" < "${ofile}" > /dev/null
     then
-      as_fn_error "tag name \"$tagname\" already exists" "$LINENO" 5
+      as_fn_error $? "tag name \"$tagname\" already exists" "$LINENO" 5
     fi
 
     # Update the list of available tags.
@@ -111287,7 +112525,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for non-GNU ld" >&5
 $as_echo_n "checking for non-GNU ld... " >&6; }
 fi
-if test "${lt_cv_path_LD+set}" = set; then :
+if ${lt_cv_path_LD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$LD"; then
@@ -111324,10 +112562,10 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
-test -z "$LD" && as_fn_error "no acceptable ld found in \$PATH" "$LINENO" 5
+test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
 $as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
-if test "${lt_cv_prog_gnu_ld+set}" = set; then :
+if ${lt_cv_prog_gnu_ld+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   # I'd rather use --version here, but apparently some GNU lds only accept -v.
@@ -111490,7 +112728,7 @@
       # Determine the default libpath from the value encoded in an empty executable.
 
 cat > conftest.$ac_ext <<EOF
-#line 111493 "configure"
+#line 112731 "configure"
 #include "confdefs.h"
 int main() {
 ; return 0; }
@@ -111533,7 +112771,7 @@
 	# Determine the default libpath from the value encoded in an empty executable.
 
 cat > conftest.$ac_ext <<EOF
-#line 111536 "configure"
+#line 112774 "configure"
 #include "confdefs.h"
 int main() {
 ; return 0; }
@@ -112769,7 +114007,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works" >&5
 $as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works... " >&6; }
-if test "${lt_cv_prog_compiler_pic_works_CXX+set}" = set; then :
+if ${lt_cv_prog_compiler_pic_works_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_pic_works_CXX=no
@@ -112785,11 +114023,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"configure:112788: $lt_compile\"" >&5)
+   (eval echo "\"configure:114026: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "configure:112792: \$? = $ac_status" >&5
+   echo "configure:114030: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -112832,7 +114070,7 @@
 wl=$lt_prog_compiler_wl_CXX eval lt_tmp_static_flag=\"$lt_prog_compiler_static_CXX\"
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
 $as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
-if test "${lt_cv_prog_compiler_static_works_CXX+set}" = set; then :
+if ${lt_cv_prog_compiler_static_works_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_static_works_CXX=no
@@ -112870,7 +114108,7 @@
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
 $as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
-if test "${lt_cv_prog_compiler_c_o_CXX+set}" = set; then :
+if ${lt_cv_prog_compiler_c_o_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_c_o_CXX=no
@@ -112889,11 +114127,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"configure:112892: $lt_compile\"" >&5)
+   (eval echo "\"configure:114130: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "configure:112896: \$? = $ac_status" >&5
+   echo "configure:114134: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -113588,14 +114826,14 @@
 $as_echo "$dynamic_linker" >&6; }
 test "$dynamic_linker" = no && can_build_shared=no
 
-if test "${lt_cv_sys_lib_search_path_spec+set}" = set; then :
+if ${lt_cv_sys_lib_search_path_spec+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_sys_lib_search_path_spec="$sys_lib_search_path_spec"
 fi
 
 sys_lib_search_path_spec="$lt_cv_sys_lib_search_path_spec"
-if test "${lt_cv_sys_lib_dlsearch_path_spec+set}" = set; then :
+if ${lt_cv_sys_lib_dlsearch_path_spec+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_sys_lib_dlsearch_path_spec="$sys_lib_dlsearch_path_spec"
@@ -114083,7 +115321,7 @@
 	;;
 
       *)
-	as_fn_error "Unsupported tag name: $tagname" "$LINENO" 5
+	as_fn_error $? "Unsupported tag name: $tagname" "$LINENO" 5
 	;;
       esac
 
@@ -114101,7 +115339,7 @@
     chmod +x "$ofile"
   else
     rm -f "${ofile}T"
-    as_fn_error "unable to update list of available tagged configurations." "$LINENO" 5
+    as_fn_error $? "unable to update list of available tagged configurations." "$LINENO" 5
   fi
 fi
 
@@ -114776,10 +116014,21 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
+    if test "x$cache_file" != "x/dev/null"; then
       { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
     { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
@@ -114795,6 +116044,7 @@
 
 ac_libobjs=
 ac_ltlibobjs=
+U=
 for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
   # 1. Remove the extension, and $U if already installed.
   ac_script='s/\$U\././;s/\.o$//;s/\.obj$//'
@@ -114810,7 +116060,7 @@
 
 
 
-: ${CONFIG_STATUS=./config.status}
+: "${CONFIG_STATUS=./config.status}"
 ac_write_fail=0
 ac_clean_files_save=$ac_clean_files
 ac_clean_files="$ac_clean_files $CONFIG_STATUS"
@@ -114911,6 +116161,7 @@
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
+as_myself=
 case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
@@ -114956,19 +116207,19 @@
 (unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
 
-# as_fn_error ERROR [LINENO LOG_FD]
-# ---------------------------------
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
 # Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
 # provided, also output the error to LOG_FD, referencing LINENO. Then exit the
-# script with status $?, using 1 if that was 0.
+# script with STATUS, using 1 if that was 0.
 as_fn_error ()
 {
-  as_status=$?; test $as_status -eq 0 && as_status=1
-  if test "$3"; then
-    as_lineno=${as_lineno-"$2"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-    $as_echo "$as_me:${as_lineno-$LINENO}: error: $1" >&$3
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
   fi
-  $as_echo "$as_me: error: $1" >&2
+  $as_echo "$as_me: error: $2" >&2
   as_fn_exit $as_status
 } # as_fn_error
 
@@ -115164,7 +116415,7 @@
       test -d "$as_dir" && break
     done
     test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || as_fn_error "cannot create directory $as_dir"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
 
 
 } # as_fn_mkdir_p
@@ -115218,7 +116469,7 @@
 # values after options handling.
 ac_log="
 This file was extended by $as_me, which was
-generated by GNU Autoconf 2.65.  Invocation command line was
+generated by GNU Autoconf 2.68.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -115284,10 +116535,10 @@
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
 config.status
-configured by $0, generated by GNU Autoconf 2.65,
+configured by $0, generated by GNU Autoconf 2.68,
   with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2009 Free Software Foundation, Inc.
+Copyright (C) 2010 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
@@ -115302,11 +116553,16 @@
 while test $# != 0
 do
   case $1 in
-  --*=*)
+  --*=?*)
     ac_option=`expr "X$1" : 'X\([^=]*\)='`
     ac_optarg=`expr "X$1" : 'X[^=]*=\(.*\)'`
     ac_shift=:
     ;;
+  --*=)
+    ac_option=`expr "X$1" : 'X\([^=]*\)='`
+    ac_optarg=
+    ac_shift=:
+    ;;
   *)
     ac_option=$1
     ac_optarg=$2
@@ -115328,6 +116584,7 @@
     $ac_shift
     case $ac_optarg in
     *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    '') as_fn_error $? "missing file argument" ;;
     esac
     as_fn_append CONFIG_FILES " '$ac_optarg'"
     ac_need_defaults=false;;
@@ -115340,7 +116597,7 @@
     ac_need_defaults=false;;
   --he | --h)
     # Conflict between --help and --header
-    as_fn_error "ambiguous option: \`$1'
+    as_fn_error $? "ambiguous option: \`$1'
 Try \`$0 --help' for more information.";;
   --help | --hel | -h )
     $as_echo "$ac_cs_usage"; exit ;;
@@ -115349,7 +116606,7 @@
     ac_cs_silent=: ;;
 
   # This is an error.
-  -*) as_fn_error "unrecognized option: \`$1'
+  -*) as_fn_error $? "unrecognized option: \`$1'
 Try \`$0 --help' for more information." ;;
 
   *) as_fn_append ac_config_targets " $1"
@@ -115545,7 +116802,7 @@
     "$ALL_OUTPUT_FILES") CONFIG_FILES="$CONFIG_FILES $ALL_OUTPUT_FILES" ;;
     "default") CONFIG_COMMANDS="$CONFIG_COMMANDS default" ;;
 
-  *) as_fn_error "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
+  *) as_fn_error $? "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
   esac
 done
 
@@ -115568,9 +116825,10 @@
 # after its creation but before its name has been assigned to `$tmp'.
 $debug ||
 {
-  tmp=
+  tmp= ac_tmp=
   trap 'exit_status=$?
-  { test -z "$tmp" || test ! -d "$tmp" || rm -fr "$tmp"; } && exit $exit_status
+  : "${ac_tmp:=$tmp}"
+  { test ! -d "$ac_tmp" || rm -fr "$ac_tmp"; } && exit $exit_status
 ' 0
   trap 'as_fn_exit 1' 1 2 13 15
 }
@@ -115578,12 +116836,13 @@
 
 {
   tmp=`(umask 077 && mktemp -d "./confXXXXXX") 2>/dev/null` &&
-  test -n "$tmp" && test -d "$tmp"
+  test -d "$tmp"
 }  ||
 {
   tmp=./conf$$-$RANDOM
   (umask 077 && mkdir "$tmp")
-} || as_fn_error "cannot create a temporary directory in ." "$LINENO" 5
+} || as_fn_error $? "cannot create a temporary directory in ." "$LINENO" 5
+ac_tmp=$tmp
 
 # Set up the scripts for CONFIG_FILES section.
 # No need to generate them if there are no CONFIG_FILES.
@@ -115600,12 +116859,12 @@
 fi
 ac_cs_awk_cr=`$AWK 'BEGIN { print "a\rb" }' </dev/null 2>/dev/null`
 if test "$ac_cs_awk_cr" = "a${ac_cr}b"; then
-  ac_cs_awk_cr='\r'
+  ac_cs_awk_cr='\\r'
 else
   ac_cs_awk_cr=$ac_cr
 fi
 
-echo 'BEGIN {' >"$tmp/subs1.awk" &&
+echo 'BEGIN {' >"$ac_tmp/subs1.awk" &&
 _ACEOF
 
 
@@ -115614,18 +116873,18 @@
   echo "$ac_subst_vars" | sed 's/.*/&!$&$ac_delim/' &&
   echo "_ACEOF"
 } >conf$$subs.sh ||
-  as_fn_error "could not make $CONFIG_STATUS" "$LINENO" 5
-ac_delim_num=`echo "$ac_subst_vars" | grep -c '$'`
+  as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
+ac_delim_num=`echo "$ac_subst_vars" | grep -c '^'`
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
   . ./conf$$subs.sh ||
-    as_fn_error "could not make $CONFIG_STATUS" "$LINENO" 5
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
 
   ac_delim_n=`sed -n "s/.*$ac_delim\$/X/p" conf$$subs.awk | grep -c X`
   if test $ac_delim_n = $ac_delim_num; then
     break
   elif $ac_last_try; then
-    as_fn_error "could not make $CONFIG_STATUS" "$LINENO" 5
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -115633,7 +116892,7 @@
 rm -f conf$$subs.sh
 
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-cat >>"\$tmp/subs1.awk" <<\\_ACAWK &&
+cat >>"\$ac_tmp/subs1.awk" <<\\_ACAWK &&
 _ACEOF
 sed -n '
 h
@@ -115681,7 +116940,7 @@
 rm -f conf$$subs.awk
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 _ACAWK
-cat >>"\$tmp/subs1.awk" <<_ACAWK &&
+cat >>"\$ac_tmp/subs1.awk" <<_ACAWK &&
   for (key in S) S_is_set[key] = 1
   FS = ""
 
@@ -115713,21 +116972,29 @@
   sed "s/$ac_cr\$//; s/$ac_cr/$ac_cs_awk_cr/g"
 else
   cat
-fi < "$tmp/subs1.awk" > "$tmp/subs.awk" \
-  || as_fn_error "could not setup config files machinery" "$LINENO" 5
+fi < "$ac_tmp/subs1.awk" > "$ac_tmp/subs.awk" \
+  || as_fn_error $? "could not setup config files machinery" "$LINENO" 5
 _ACEOF
 
-# VPATH may cause trouble with some makes, so we remove $(srcdir),
-# ${srcdir} and @srcdir@ from VPATH if srcdir is ".", strip leading and
+# VPATH may cause trouble with some makes, so we remove sole $(srcdir),
+# ${srcdir} and @srcdir@ entries from VPATH if srcdir is ".", strip leading and
 # trailing colons and then remove the whole line if VPATH becomes empty
 # (actually we leave an empty line to preserve line numbers).
 if test "x$srcdir" = x.; then
-  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
-s/:*\$(srcdir):*/:/
-s/:*\${srcdir}:*/:/
-s/:*@srcdir@:*/:/
-s/^\([^=]*=[	 ]*\):*/\1/
+  ac_vpsub='/^[	 ]*VPATH[	 ]*=[	 ]*/{
+h
+s///
+s/^/:/
+s/[	 ]*$/:/
+s/:\$(srcdir):/:/g
+s/:\${srcdir}:/:/g
+s/:@srcdir@:/:/g
+s/^:*//
 s/:*$//
+x
+s/\(=[	 ]*\).*/\1/
+G
+s/\n//
 s/^[^=]*=[	 ]*$//
 }'
 fi
@@ -115739,7 +117006,7 @@
 # No need to generate them if there are no CONFIG_HEADERS.
 # This happens for instance with `./config.status Makefile'.
 if test -n "$CONFIG_HEADERS"; then
-cat >"$tmp/defines.awk" <<\_ACAWK ||
+cat >"$ac_tmp/defines.awk" <<\_ACAWK ||
 BEGIN {
 _ACEOF
 
@@ -115751,11 +117018,11 @@
 # handling of long lines.
 ac_delim='%!_!# '
 for ac_last_try in false false :; do
-  ac_t=`sed -n "/$ac_delim/p" confdefs.h`
-  if test -z "$ac_t"; then
+  ac_tt=`sed -n "/$ac_delim/p" confdefs.h`
+  if test -z "$ac_tt"; then
     break
   elif $ac_last_try; then
-    as_fn_error "could not make $CONFIG_HEADERS" "$LINENO" 5
+    as_fn_error $? "could not make $CONFIG_HEADERS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -115840,7 +117107,7 @@
 _ACAWK
 _ACEOF
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-  as_fn_error "could not setup config headers machinery" "$LINENO" 5
+  as_fn_error $? "could not setup config headers machinery" "$LINENO" 5
 fi # test -n "$CONFIG_HEADERS"
 
 
@@ -115853,7 +117120,7 @@
   esac
   case $ac_mode$ac_tag in
   :[FHL]*:*);;
-  :L* | :C*:*) as_fn_error "invalid tag \`$ac_tag'" "$LINENO" 5;;
+  :L* | :C*:*) as_fn_error $? "invalid tag \`$ac_tag'" "$LINENO" 5;;
   :[FH]-) ac_tag=-:-;;
   :[FH]*) ac_tag=$ac_tag:$ac_tag.in;;
   esac
@@ -115872,7 +117139,7 @@
     for ac_f
     do
       case $ac_f in
-      -) ac_f="$tmp/stdin";;
+      -) ac_f="$ac_tmp/stdin";;
       *) # Look for the file first in the build tree, then in the source tree
 	 # (if the path is not absolute).  The absolute path cannot be DOS-style,
 	 # because $ac_f cannot contain `:'.
@@ -115881,7 +117148,7 @@
 	   [\\/$]*) false;;
 	   *) test -f "$srcdir/$ac_f" && ac_f="$srcdir/$ac_f";;
 	   esac ||
-	   as_fn_error "cannot find input file: \`$ac_f'" "$LINENO" 5;;
+	   as_fn_error 1 "cannot find input file: \`$ac_f'" "$LINENO" 5;;
       esac
       case $ac_f in *\'*) ac_f=`$as_echo "$ac_f" | sed "s/'/'\\\\\\\\''/g"`;; esac
       as_fn_append ac_file_inputs " '$ac_f'"
@@ -115907,8 +117174,8 @@
     esac
 
     case $ac_tag in
-    *:-:* | *:-) cat >"$tmp/stdin" \
-      || as_fn_error "could not create $ac_file" "$LINENO" 5 ;;
+    *:-:* | *:-) cat >"$ac_tmp/stdin" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5 ;;
     esac
     ;;
   esac
@@ -116033,23 +117300,24 @@
 s&@abs_top_builddir@&$ac_abs_top_builddir&;t t
 $ac_datarootdir_hack
 "
-eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$tmp/subs.awk" >$tmp/out \
-  || as_fn_error "could not create $ac_file" "$LINENO" 5
+eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$ac_tmp/subs.awk" \
+  >$ac_tmp/out || as_fn_error $? "could not create $ac_file" "$LINENO" 5
 
 test -z "$ac_datarootdir_hack$ac_datarootdir_seen" &&
-  { ac_out=`sed -n '/\${datarootdir}/p' "$tmp/out"`; test -n "$ac_out"; } &&
-  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' "$tmp/out"`; test -z "$ac_out"; } &&
+  { ac_out=`sed -n '/\${datarootdir}/p' "$ac_tmp/out"`; test -n "$ac_out"; } &&
+  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' \
+      "$ac_tmp/out"`; test -z "$ac_out"; } &&
   { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&5
+which seems to be undefined.  Please make sure it is defined" >&5
 $as_echo "$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&2;}
+which seems to be undefined.  Please make sure it is defined" >&2;}
 
-  rm -f "$tmp/stdin"
+  rm -f "$ac_tmp/stdin"
   case $ac_file in
-  -) cat "$tmp/out" && rm -f "$tmp/out";;
-  *) rm -f "$ac_file" && mv "$tmp/out" "$ac_file";;
+  -) cat "$ac_tmp/out" && rm -f "$ac_tmp/out";;
+  *) rm -f "$ac_file" && mv "$ac_tmp/out" "$ac_file";;
   esac \
-  || as_fn_error "could not create $ac_file" "$LINENO" 5
+  || as_fn_error $? "could not create $ac_file" "$LINENO" 5
  ;;
   :H)
   #
@@ -116058,21 +117326,21 @@
   if test x"$ac_file" != x-; then
     {
       $as_echo "/* $configure_input  */" \
-      && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs"
-    } >"$tmp/config.h" \
-      || as_fn_error "could not create $ac_file" "$LINENO" 5
-    if diff "$ac_file" "$tmp/config.h" >/dev/null 2>&1; then
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs"
+    } >"$ac_tmp/config.h" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5
+    if diff "$ac_file" "$ac_tmp/config.h" >/dev/null 2>&1; then
       { $as_echo "$as_me:${as_lineno-$LINENO}: $ac_file is unchanged" >&5
 $as_echo "$as_me: $ac_file is unchanged" >&6;}
     else
       rm -f "$ac_file"
-      mv "$tmp/config.h" "$ac_file" \
-	|| as_fn_error "could not create $ac_file" "$LINENO" 5
+      mv "$ac_tmp/config.h" "$ac_file" \
+	|| as_fn_error $? "could not create $ac_file" "$LINENO" 5
     fi
   else
     $as_echo "/* $configure_input  */" \
-      && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs" \
-      || as_fn_error "could not create -" "$LINENO" 5
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs" \
+      || as_fn_error $? "could not create -" "$LINENO" 5
   fi
  ;;
 
@@ -116089,7 +117357,7 @@
 ac_clean_files=$ac_clean_files_save
 
 test $ac_write_fail = 0 ||
-  as_fn_error "write failure creating $CONFIG_STATUS" "$LINENO" 5
+  as_fn_error $? "write failure creating $CONFIG_STATUS" "$LINENO" 5
 
 
 # configure is writing to config.log, and then calls config.status.
@@ -116110,7 +117378,7 @@
   exec 5>>config.log
   # Use ||, not &&, to avoid exiting from the if with $? = 1, which
   # would make configure fail if this is the last instruction.
-  $ac_cs_success || as_fn_exit $?
+  $ac_cs_success || as_fn_exit 1
 fi
 if test -n "$ac_unrecognized_opts" && test "$enable_option_checking" != no; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
diff -Nru php-5.4.19/main/build-defs.h php-5.4.19.bak.ori/main/build-defs.h
--- php-5.4.19/main/build-defs.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak.ori/main/build-defs.h	2013-09-04 09:52:30.894422786 +0800
@@ -0,0 +1,91 @@
+/*                                                                -*- C -*-
+   +----------------------------------------------------------------------+
+   | PHP Version 5                                                        |
+   +----------------------------------------------------------------------+
+   | Copyright (c) 1997-2007 The PHP Group                                |
+   +----------------------------------------------------------------------+
+   | This source file is subject to version 3.01 of the PHP license,      |
+   | that is bundled with this package in the file LICENSE, and is        |
+   | available through the world-wide-web at the following url:           |
+   | http://www.php.net/license/3_01.txt                                  |
+   | If you did not receive a copy of the PHP license and are unable to   |
+   | obtain it through the world-wide-web, please send a note to          |
+   | license@php.net so we can mail you a copy immediately.               |
+   +----------------------------------------------------------------------+
+   | Author: Stig Sther Bakken <ssb@php.net>                             |
+   +----------------------------------------------------------------------+
+*/
+
+/* $Id$ */
+
+#define CONFIGURE_COMMAND " './configure'  '--target=arm-buildroot-linux-gnueabi' '--host=arm-buildroot-linux-gnueabi' '--build=i686-pc-linux-gnu' '--prefix=/usr' '--exec-prefix=/usr' '--sysconfdir=/etc' '--program-prefix=' '--disable-gtk-doc' '--disable-doc' '--disable-docs' '--disable-documentation' '--with-xmlto=no' '--with-fop=no' '--enable-ipv6' '--enable-static' '--enable-shared' '--mandir=/usr/share/man' '--infodir=/usr/share/info' '--disable-all' '--with-config-file-path=/etc' '--localstatedir=/var' '--with-pear=/usr/lib/php' '--with-sqlite3=/home/dh-builder/beaglebone/buildroot/buildroot-2013.05/output/host/usr/arm-buildroot-linux-gnueabi/sysroot/usr' '--with-mcrypt=/home/dh-builder/beaglebone/buildroot/buildroot-2013.05/output/host/usr/arm-buildroot-linux-gnueabi/sysroot/usr' '--with-mhash=/home/dh-builder/beaglebone/buildroot/buildroot-2013.05/output/host/usr/arm-buildroot-linux-gnueabi/sysroot/usr' '--enable-mbstring' '--enable-apc' '--disable-rpath' '--enable-sockets' '--enable-posix' '--enable-session' '--enable-hash' '--enable-dom' '--enable-simplexml' '--enable-xml' '--enable-xmlreader' '--enable-xmlwriter' '--enable-json' '--enable-filter' '--with-openssl=/home/dh-builder/beaglebone/buildroot/buildroot-2013.05/output/host/usr/arm-buildroot-linux-gnueabi/sysroot/usr' '--enable-libxml' '--with-libxml-dir=/home/dh-builder/beaglebone/buildroot/buildroot-2013.05/output/host/usr/arm-buildroot-linux-gnueabi/sysroot/usr' '--with-xmlrpc' '--with-zlib=/home/dh-builder/beaglebone/buildroot/buildroot-2013.05/output/host/usr/arm-buildroot-linux-gnueabi/sysroot/usr' '--with-sqlite3' '--enable-sqlite-utf8' '--enable-pdo' '--with-pdo-sqlite=/home/dh-builder/beaglebone/buildroot/buildroot-2013.05/output/host/usr/arm-buildroot-linux-gnueabi/sysroot/usr' '--with-pcre-regex=/home/dh-builder/beaglebone/buildroot/buildroot-2013.05/output/host/usr/arm-buildroot-linux-gnueabi/sysroot/usr' '--with-curl=/home/dh-builder/beaglebone/buildroot/buildroot-2013.05/output/host/usr/arm-buildroot-linux-gnueabi/sysroot/usr'"
+#define PHP_ADA_INCLUDE		""
+#define PHP_ADA_LFLAGS		""
+#define PHP_ADA_LIBS		""
+#define PHP_APACHE_INCLUDE	""
+#define PHP_APACHE_TARGET	""
+#define PHP_FHTTPD_INCLUDE      ""
+#define PHP_FHTTPD_LIB          ""
+#define PHP_FHTTPD_TARGET       ""
+#define PHP_CFLAGS		"$(CFLAGS_CLEAN) -prefer-non-pic -static"
+#define PHP_DBASE_LIB		""
+#define PHP_BUILD_DEBUG		""
+#define PHP_GDBM_INCLUDE	""
+#define PHP_IBASE_INCLUDE	""
+#define PHP_IBASE_LFLAGS	""
+#define PHP_IBASE_LIBS		""
+#define PHP_IFX_INCLUDE		""
+#define PHP_IFX_LFLAGS		""
+#define PHP_IFX_LIBS		""
+#define PHP_INSTALL_IT		""
+#define PHP_IODBC_INCLUDE	""
+#define PHP_IODBC_LFLAGS	""
+#define PHP_IODBC_LIBS		""
+#define PHP_MSQL_INCLUDE	""
+#define PHP_MSQL_LFLAGS		""
+#define PHP_MSQL_LIBS		""
+#define PHP_MYSQL_INCLUDE	""
+#define PHP_MYSQL_LIBS		""
+#define PHP_MYSQL_TYPE		""
+#define PHP_ODBC_INCLUDE	""
+#define PHP_ODBC_LFLAGS		""
+#define PHP_ODBC_LIBS		""
+#define PHP_ODBC_TYPE		""
+#define PHP_OCI8_SHARED_LIBADD 	""
+#define PHP_OCI8_DIR			""
+#define PHP_OCI8_ORACLE_VERSION		""
+#define PHP_ORACLE_SHARED_LIBADD 	"@ORACLE_SHARED_LIBADD@"
+#define PHP_ORACLE_DIR				"@ORACLE_DIR@"
+#define PHP_ORACLE_VERSION			"@ORACLE_VERSION@"
+#define PHP_PGSQL_INCLUDE	""
+#define PHP_PGSQL_LFLAGS	""
+#define PHP_PGSQL_LIBS		""
+#define PHP_PROG_SENDMAIL	"/usr/sbin/sendmail"
+#define PHP_SOLID_INCLUDE	""
+#define PHP_SOLID_LIBS		""
+#define PHP_EMPRESS_INCLUDE	""
+#define PHP_EMPRESS_LIBS	""
+#define PHP_SYBASE_INCLUDE	""
+#define PHP_SYBASE_LFLAGS	""
+#define PHP_SYBASE_LIBS		""
+#define PHP_DBM_TYPE		""
+#define PHP_DBM_LIB		""
+#define PHP_LDAP_LFLAGS		""
+#define PHP_LDAP_INCLUDE	""
+#define PHP_LDAP_LIBS		""
+#define PHP_BIRDSTEP_INCLUDE     ""
+#define PHP_BIRDSTEP_LIBS        ""
+#define PEAR_INSTALLDIR         "/usr/lib/php"
+#define PHP_INCLUDE_PATH	".:/usr/lib/php"
+#define PHP_EXTENSION_DIR       "/usr/lib/php/extensions/no-debug-non-zts-20100525"
+#define PHP_PREFIX              "/usr"
+#define PHP_BINDIR              "/usr/bin"
+#define PHP_SBINDIR             "/usr/sbin"
+#define PHP_MANDIR              "/usr/share/man"
+#define PHP_LIBDIR              "/usr/lib/php"
+#define PHP_DATADIR             "${prefix}/share"
+#define PHP_SYSCONFDIR          "/etc"
+#define PHP_LOCALSTATEDIR       "/var"
+#define PHP_CONFIG_FILE_PATH    "/etc"
+#define PHP_CONFIG_FILE_SCAN_DIR    ""
+#define PHP_SHLIB_SUFFIX        "so"
diff -Nru php-5.4.19/main/internal_functions.c php-5.4.19.bak.ori/main/internal_functions.c
--- php-5.4.19/main/internal_functions.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak.ori/main/internal_functions.c	2013-09-04 09:52:30.838422785 +0800
@@ -0,0 +1,105 @@
+/* -*- C -*-
+   +----------------------------------------------------------------------+
+   | PHP Version 5                                                        |
+   +----------------------------------------------------------------------+
+   | Copyright (c) 1997-2007 The PHP Group                                |
+   +----------------------------------------------------------------------+
+   | This source file is subject to version 3.01 of the PHP license,      |
+   | that is bundled with this package in the file LICENSE, and is        |
+   | available through the world-wide-web at the following url:           |
+   | http://www.php.net/license/3_01.txt                                  |
+   | If you did not receive a copy of the PHP license and are unable to   |
+   | obtain it through the world-wide-web, please send a note to          |
+   | license@php.net so we can mail you a copy immediately.               |
+   +----------------------------------------------------------------------+
+   | Authors: Andi Gutmans <andi@zend.com>                                |
+   |          Zeev Suraski <zeev@zend.com>                                |
+   +----------------------------------------------------------------------+
+ */
+
+/* $Id$ */
+
+#include "php.h"
+#include "php_main.h"
+#include "zend_modules.h"
+#include "zend_compile.h"
+#include <stdarg.h>
+#include <stdlib.h>
+#include <stdio.h>
+
+#include "ext/date/php_date.h"
+#include "ext/ereg/php_ereg.h"
+#include "ext/libxml/php_libxml.h"
+#include "ext/openssl/php_openssl.h"
+#include "ext/pcre/php_pcre.h"
+#include "ext/sqlite3/php_sqlite3.h"
+#include "ext/zlib/php_zlib.h"
+#include "ext/apc/apc_php_pcre.h"
+#include "ext/apc/php_apc.h"
+#include "ext/curl/php_curl.h"
+#include "ext/dom/php_dom.h"
+#include "ext/filter/php_filter.h"
+#include "ext/hash/php_hash.h"
+#include "ext/json/php_json.h"
+#include "ext/mbstring/mbstring.h"
+#include "ext/mcrypt/php_mcrypt.h"
+#include "ext/pdo/php_pdo.h"
+#include "ext/pdo_sqlite/php_pdo_sqlite.h"
+#include "ext/posix/php_posix.h"
+#include "ext/reflection/php_reflection.h"
+#include "ext/session/php_session.h"
+#include "ext/simplexml/php_simplexml.h"
+#include "ext/sockets/php_sockets.h"
+#include "ext/spl/php_spl.h"
+#include "ext/standard/php_standard.h"
+#include "ext/xml/php_xml.h"
+#include "ext/xmlreader/php_xmlreader.h"
+#include "ext/xmlrpc/php_xmlrpc.h"
+#include "ext/xmlwriter/php_xmlwriter.h"
+
+
+static zend_module_entry *php_builtin_extensions[] = {
+	phpext_date_ptr,
+	phpext_ereg_ptr,
+	phpext_libxml_ptr,
+	phpext_openssl_ptr,
+	phpext_pcre_ptr,
+	phpext_sqlite3_ptr,
+	phpext_zlib_ptr,
+	phpext_apc_ptr,
+	phpext_curl_ptr,
+	phpext_dom_ptr,
+	phpext_filter_ptr,
+	phpext_hash_ptr,
+	phpext_json_ptr,
+	phpext_mbstring_ptr,
+	phpext_mcrypt_ptr,
+	phpext_pdo_ptr,
+	phpext_pdo_sqlite_ptr,
+	phpext_posix_ptr,
+	phpext_reflection_ptr,
+	phpext_session_ptr,
+	phpext_simplexml_ptr,
+	phpext_sockets_ptr,
+	phpext_spl_ptr,
+	phpext_standard_ptr,
+	phpext_xml_ptr,
+	phpext_xmlreader_ptr,
+	phpext_xmlrpc_ptr,
+	phpext_xmlwriter_ptr,
+
+};
+
+#define EXTCOUNT (sizeof(php_builtin_extensions)/sizeof(zend_module_entry *))
+
+PHPAPI int php_register_internal_extensions(TSRMLS_D)
+{
+	return php_register_extensions(php_builtin_extensions, EXTCOUNT TSRMLS_CC);
+}
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ */
diff -Nru php-5.4.19/main/internal_functions_cli.c php-5.4.19.bak.ori/main/internal_functions_cli.c
--- php-5.4.19/main/internal_functions_cli.c	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak.ori/main/internal_functions_cli.c	2013-09-04 09:52:30.874422784 +0800
@@ -0,0 +1,105 @@
+/* -*- C -*-
+   +----------------------------------------------------------------------+
+   | PHP Version 5                                                        |
+   +----------------------------------------------------------------------+
+   | Copyright (c) 1997-2007 The PHP Group                                |
+   +----------------------------------------------------------------------+
+   | This source file is subject to version 3.01 of the PHP license,      |
+   | that is bundled with this package in the file LICENSE, and is        |
+   | available through the world-wide-web at the following url:           |
+   | http://www.php.net/license/3_01.txt                                  |
+   | If you did not receive a copy of the PHP license and are unable to   |
+   | obtain it through the world-wide-web, please send a note to          |
+   | license@php.net so we can mail you a copy immediately.               |
+   +----------------------------------------------------------------------+
+   | Authors: Andi Gutmans <andi@zend.com>                                |
+   |          Zeev Suraski <zeev@zend.com>                                |
+   +----------------------------------------------------------------------+
+ */
+
+/* $Id$ */
+
+#include "php.h"
+#include "php_main.h"
+#include "zend_modules.h"
+#include "zend_compile.h"
+#include <stdarg.h>
+#include <stdlib.h>
+#include <stdio.h>
+
+#include "ext/date/php_date.h"
+#include "ext/ereg/php_ereg.h"
+#include "ext/libxml/php_libxml.h"
+#include "ext/openssl/php_openssl.h"
+#include "ext/pcre/php_pcre.h"
+#include "ext/sqlite3/php_sqlite3.h"
+#include "ext/zlib/php_zlib.h"
+#include "ext/apc/apc_php_pcre.h"
+#include "ext/apc/php_apc.h"
+#include "ext/curl/php_curl.h"
+#include "ext/dom/php_dom.h"
+#include "ext/filter/php_filter.h"
+#include "ext/hash/php_hash.h"
+#include "ext/json/php_json.h"
+#include "ext/mbstring/mbstring.h"
+#include "ext/mcrypt/php_mcrypt.h"
+#include "ext/pdo/php_pdo.h"
+#include "ext/pdo_sqlite/php_pdo_sqlite.h"
+#include "ext/posix/php_posix.h"
+#include "ext/reflection/php_reflection.h"
+#include "ext/session/php_session.h"
+#include "ext/simplexml/php_simplexml.h"
+#include "ext/sockets/php_sockets.h"
+#include "ext/spl/php_spl.h"
+#include "ext/standard/php_standard.h"
+#include "ext/xml/php_xml.h"
+#include "ext/xmlreader/php_xmlreader.h"
+#include "ext/xmlrpc/php_xmlrpc.h"
+#include "ext/xmlwriter/php_xmlwriter.h"
+
+
+static zend_module_entry *php_builtin_extensions[] = {
+	phpext_date_ptr,
+	phpext_ereg_ptr,
+	phpext_libxml_ptr,
+	phpext_openssl_ptr,
+	phpext_pcre_ptr,
+	phpext_sqlite3_ptr,
+	phpext_zlib_ptr,
+	phpext_apc_ptr,
+	phpext_curl_ptr,
+	phpext_dom_ptr,
+	phpext_filter_ptr,
+	phpext_hash_ptr,
+	phpext_json_ptr,
+	phpext_mbstring_ptr,
+	phpext_mcrypt_ptr,
+	phpext_pdo_ptr,
+	phpext_pdo_sqlite_ptr,
+	phpext_posix_ptr,
+	phpext_reflection_ptr,
+	phpext_session_ptr,
+	phpext_simplexml_ptr,
+	phpext_sockets_ptr,
+	phpext_spl_ptr,
+	phpext_standard_ptr,
+	phpext_xml_ptr,
+	phpext_xmlreader_ptr,
+	phpext_xmlrpc_ptr,
+	phpext_xmlwriter_ptr,
+
+};
+
+#define EXTCOUNT (sizeof(php_builtin_extensions)/sizeof(zend_module_entry *))
+
+PHPAPI int php_register_internal_extensions(TSRMLS_D)
+{
+	return php_register_extensions(php_builtin_extensions, EXTCOUNT TSRMLS_CC);
+}
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ */
diff -Nru php-5.4.19/main/php_config.h php-5.4.19.bak.ori/main/php_config.h
--- php-5.4.19/main/php_config.h	1970-01-01 08:00:00.000000000 +0800
+++ php-5.4.19.bak.ori/main/php_config.h	2013-09-04 09:52:30.998422787 +0800
@@ -0,0 +1,2563 @@
+/* main/php_config.h.  Generated from php_config.h.in by configure.  */
+/* main/php_config.h.in.  Generated from configure.in by autoheader.  */
+
+
+#if defined(__GNUC__) && __GNUC__ >= 4
+# define ZEND_API __attribute__ ((visibility("default")))
+# define ZEND_DLEXPORT __attribute__ ((visibility("default")))
+#else
+# define ZEND_API
+# define ZEND_DLEXPORT
+#endif
+
+#define ZEND_DLIMPORT
+
+/* #undef uint */
+/* #undef ulong */
+
+/* Define if you want to enable memory limit support */
+#define MEMORY_LIMIT 0
+
+
+/* */
+/* #undef AIX */
+
+/* */
+/* #undef APC_FCNTL_LOCKS */
+
+/* */
+/* #undef APC_FILEHITS */
+
+/* */
+#define APC_HAVE_LOOKUP_HOOKS 0
+
+/* shm/mmap memory protection */
+/* #undef APC_MEMPROTECT */
+
+/* */
+#define APC_MMAP 1
+
+/* */
+#define APC_PTHREADMUTEX_LOCKS 1
+
+/* */
+/* #undef APC_PTHREADRW_LOCKS */
+
+/* */
+/* #undef APC_SEM_LOCKS */
+
+/* */
+/* #undef APC_SPIN_LOCKS */
+
+/* Whether to use native BeOS threads */
+/* #undef BETHREADS */
+
+/* */
+/* #undef CDB_INCLUDE_FILE */
+
+/* Define if system uses EBCDIC */
+/* #undef CHARSET_EBCDIC */
+
+/* Whether to build apc as dynamic module */
+/* #undef COMPILE_DL_APC */
+
+/* Whether to build bcmath as dynamic module */
+/* #undef COMPILE_DL_BCMATH */
+
+/* Whether to build bz2 as dynamic module */
+/* #undef COMPILE_DL_BZ2 */
+
+/* Whether to build calendar as dynamic module */
+/* #undef COMPILE_DL_CALENDAR */
+
+/* Whether to build ctype as dynamic module */
+/* #undef COMPILE_DL_CTYPE */
+
+/* Whether to build curl as dynamic module */
+/* #undef COMPILE_DL_CURL */
+
+/* Whether to build date as dynamic module */
+/* #undef COMPILE_DL_DATE */
+
+/* Whether to build dba as dynamic module */
+/* #undef COMPILE_DL_DBA */
+
+/* Whether to build dom as dynamic module */
+/* #undef COMPILE_DL_DOM */
+
+/* Whether to build enchant as dynamic module */
+/* #undef COMPILE_DL_ENCHANT */
+
+/* Whether to build ereg as dynamic module */
+/* #undef COMPILE_DL_EREG */
+
+/* Whether to build exif as dynamic module */
+/* #undef COMPILE_DL_EXIF */
+
+/* Whether to build fileinfo as dynamic module */
+/* #undef COMPILE_DL_FILEINFO */
+
+/* Whether to build filter as dynamic module */
+/* #undef COMPILE_DL_FILTER */
+
+/* Whether to build ftp as dynamic module */
+/* #undef COMPILE_DL_FTP */
+
+/* Whether to build gd as dynamic module */
+/* #undef COMPILE_DL_GD */
+
+/* Whether to build gettext as dynamic module */
+/* #undef COMPILE_DL_GETTEXT */
+
+/* Whether to build gmp as dynamic module */
+/* #undef COMPILE_DL_GMP */
+
+/* Whether to build hash as dynamic module */
+/* #undef COMPILE_DL_HASH */
+
+/* Whether to build iconv as dynamic module */
+/* #undef COMPILE_DL_ICONV */
+
+/* Whether to build imap as dynamic module */
+/* #undef COMPILE_DL_IMAP */
+
+/* Whether to build interbase as dynamic module */
+/* #undef COMPILE_DL_INTERBASE */
+
+/* Whether to build intl as dynamic module */
+/* #undef COMPILE_DL_INTL */
+
+/* Whether to build json as dynamic module */
+/* #undef COMPILE_DL_JSON */
+
+/* Whether to build ldap as dynamic module */
+/* #undef COMPILE_DL_LDAP */
+
+/* Whether to build libxml as dynamic module */
+/* #undef COMPILE_DL_LIBXML */
+
+/* Whether to build mbstring as dynamic module */
+/* #undef COMPILE_DL_MBSTRING */
+
+/* Whether to build mcrypt as dynamic module */
+/* #undef COMPILE_DL_MCRYPT */
+
+/* Whether to build mssql as dynamic module */
+/* #undef COMPILE_DL_MSSQL */
+
+/* Whether to build mysql as dynamic module */
+/* #undef COMPILE_DL_MYSQL */
+
+/* Whether to build mysqli as dynamic module */
+/* #undef COMPILE_DL_MYSQLI */
+
+/* Whether to build mysqlnd as dynamic module */
+/* #undef COMPILE_DL_MYSQLND */
+
+/* Whether to build oci8 as dynamic module */
+/* #undef COMPILE_DL_OCI8 */
+
+/* Whether to build odbc as dynamic module */
+/* #undef COMPILE_DL_ODBC */
+
+/* Whether to build openssl as dynamic module */
+/* #undef COMPILE_DL_OPENSSL */
+
+/* Whether to build pcntl as dynamic module */
+/* #undef COMPILE_DL_PCNTL */
+
+/* Whether to build pcre as dynamic module */
+/* #undef COMPILE_DL_PCRE */
+
+/* Whether to build pdo as dynamic module */
+/* #undef COMPILE_DL_PDO */
+
+/* Whether to build pdo_dblib as dynamic module */
+/* #undef COMPILE_DL_PDO_DBLIB */
+
+/* Whether to build pdo_firebird as dynamic module */
+/* #undef COMPILE_DL_PDO_FIREBIRD */
+
+/* Whether to build pdo_mysql as dynamic module */
+/* #undef COMPILE_DL_PDO_MYSQL */
+
+/* Whether to build pdo_oci as dynamic module */
+/* #undef COMPILE_DL_PDO_OCI */
+
+/* Whether to build pdo_odbc as dynamic module */
+/* #undef COMPILE_DL_PDO_ODBC */
+
+/* Whether to build pdo_pgsql as dynamic module */
+/* #undef COMPILE_DL_PDO_PGSQL */
+
+/* Whether to build pdo_sqlite as dynamic module */
+/* #undef COMPILE_DL_PDO_SQLITE */
+
+/* Whether to build pgsql as dynamic module */
+/* #undef COMPILE_DL_PGSQL */
+
+/* Whether to build phar as dynamic module */
+/* #undef COMPILE_DL_PHAR */
+
+/* Whether to build posix as dynamic module */
+/* #undef COMPILE_DL_POSIX */
+
+/* Whether to build pspell as dynamic module */
+/* #undef COMPILE_DL_PSPELL */
+
+/* Whether to build readline as dynamic module */
+/* #undef COMPILE_DL_READLINE */
+
+/* Whether to build recode as dynamic module */
+/* #undef COMPILE_DL_RECODE */
+
+/* Whether to build reflection as dynamic module */
+/* #undef COMPILE_DL_REFLECTION */
+
+/* Whether to build session as dynamic module */
+/* #undef COMPILE_DL_SESSION */
+
+/* Whether to build shmop as dynamic module */
+/* #undef COMPILE_DL_SHMOP */
+
+/* Whether to build simplexml as dynamic module */
+/* #undef COMPILE_DL_SIMPLEXML */
+
+/* Whether to build snmp as dynamic module */
+/* #undef COMPILE_DL_SNMP */
+
+/* Whether to build soap as dynamic module */
+/* #undef COMPILE_DL_SOAP */
+
+/* Whether to build sockets as dynamic module */
+/* #undef COMPILE_DL_SOCKETS */
+
+/* Whether to build spl as dynamic module */
+/* #undef COMPILE_DL_SPL */
+
+/* Whether to build sqlite3 as dynamic module */
+/* #undef COMPILE_DL_SQLITE3 */
+
+/* Whether to build standard as dynamic module */
+/* #undef COMPILE_DL_STANDARD */
+
+/* Whether to build sybase_ct as dynamic module */
+/* #undef COMPILE_DL_SYBASE_CT */
+
+/* Whether to build sysvmsg as dynamic module */
+/* #undef COMPILE_DL_SYSVMSG */
+
+/* Whether to build sysvsem as dynamic module */
+/* #undef COMPILE_DL_SYSVSEM */
+
+/* Whether to build sysvshm as dynamic module */
+/* #undef COMPILE_DL_SYSVSHM */
+
+/* Whether to build tidy as dynamic module */
+/* #undef COMPILE_DL_TIDY */
+
+/* Whether to build tokenizer as dynamic module */
+/* #undef COMPILE_DL_TOKENIZER */
+
+/* Whether to build wddx as dynamic module */
+/* #undef COMPILE_DL_WDDX */
+
+/* Whether to build xml as dynamic module */
+/* #undef COMPILE_DL_XML */
+
+/* Whether to build xmlreader as dynamic module */
+/* #undef COMPILE_DL_XMLREADER */
+
+/* Whether to build xmlrpc as dynamic module */
+/* #undef COMPILE_DL_XMLRPC */
+
+/* Whether to build xmlwriter as dynamic module */
+/* #undef COMPILE_DL_XMLWRITER */
+
+/* Whether to build xsl as dynamic module */
+/* #undef COMPILE_DL_XSL */
+
+/* Whether to build zip as dynamic module */
+/* #undef COMPILE_DL_ZIP */
+
+/* Whether to build zlib as dynamic module */
+/* #undef COMPILE_DL_ZLIB */
+
+/* */
+#define COOKIE_IO_FUNCTIONS_T cookie_io_functions_t
+
+/* */
+/* #undef COOKIE_SEEKER_USES_OFF64_T */
+
+/* Define to one of `_getb67', `GETB67', `getb67' for Cray-2 and Cray-YMP
+   systems. This function is required for `alloca.c' support on those systems.
+   */
+/* #undef CRAY_STACKSEG_END */
+
+/* Define if crypt_r has uses CRYPTD */
+/* #undef CRYPT_R_CRYPTD */
+
+/* Define if struct crypt_data requires _GNU_SOURCE */
+/* #undef CRYPT_R_GNU_SOURCE */
+
+/* Define if crypt_r uses struct crypt_data */
+/* #undef CRYPT_R_STRUCT_CRYPT_DATA */
+
+/* Define to 1 if using `alloca.c'. */
+/* #undef C_ALLOCA */
+
+/* Define if the target system is darwin */
+/* #undef DARWIN */
+
+/* */
+/* #undef DB1_INCLUDE_FILE */
+
+/* */
+/* #undef DB1_VERSION */
+
+/* */
+/* #undef DB2_INCLUDE_FILE */
+
+/* */
+/* #undef DB3_INCLUDE_FILE */
+
+/* */
+/* #undef DB4_INCLUDE_FILE */
+
+/* */
+/* #undef DBA_CDB */
+
+/* */
+/* #undef DBA_CDB_BUILTIN */
+
+/* */
+/* #undef DBA_CDB_MAKE */
+
+/* */
+/* #undef DBA_DB1 */
+
+/* */
+/* #undef DBA_DB2 */
+
+/* */
+/* #undef DBA_DB3 */
+
+/* */
+/* #undef DBA_DB4 */
+
+/* */
+/* #undef DBA_DBM */
+
+/* */
+/* #undef DBA_FLATFILE */
+
+/* */
+/* #undef DBA_GDBM */
+
+/* */
+/* #undef DBA_INIFILE */
+
+/* */
+/* #undef DBA_NDBM */
+
+/* */
+/* #undef DBA_QDBM */
+
+/* */
+/* #undef DBA_TCADB */
+
+/* */
+/* #undef DBM_INCLUDE_FILE */
+
+/* */
+/* #undef DBM_VERSION */
+
+/* */
+#define DEFAULT_SHORT_OPEN_TAG "1"
+
+/* Define if dlsym() requires a leading underscore in symbol names. */
+/* #undef DLSYM_NEEDS_UNDERSCORE */
+
+/* Whether to enable chroot() function */
+#define ENABLE_CHROOT_FUNC 1
+
+/* */
+/* #undef ENABLE_GD_TTF */
+
+/* */
+/* #undef ENCHANT_VERSION_STRING */
+
+/* */
+/* #undef GDBM_INCLUDE_FILE */
+
+/* Whether you use GNU Pth */
+/* #undef GNUPTH */
+
+/* Whether 3 arg set_rebind_proc() */
+/* #undef HAVE_3ARG_SETREBINDPROC */
+
+/* Define to 1 if you have the `acosh' function. */
+#define HAVE_ACOSH 1
+
+/* */
+/* #undef HAVE_ADABAS */
+
+/* whether the compiler supports __alignof__ */
+#define HAVE_ALIGNOF 1
+
+/* Define to 1 if you have `alloca', as a function or macro. */
+#define HAVE_ALLOCA 1
+
+/* Define to 1 if you have <alloca.h> and it should be used (not on Ultrix).
+   */
+#define HAVE_ALLOCA_H 1
+
+/* Define to 1 if you have the `alphasort' function. */
+#define HAVE_ALPHASORT 1
+
+/* Whether you have AOLserver */
+/* #undef HAVE_AOLSERVER */
+
+/* */
+/* #undef HAVE_APACHE */
+
+/* */
+/* #undef HAVE_APACHE_HOOKS */
+
+/* */
+#define HAVE_APC 1
+
+/* Define to 1 if you have the <ApplicationServices/ApplicationServices.h>
+   header file. */
+/* #undef HAVE_APPLICATIONSERVICES_APPLICATIONSERVICES_H */
+
+/* */
+/* #undef HAVE_AP_COMPAT_H */
+
+/* */
+/* #undef HAVE_AP_CONFIG_H */
+
+/* Define to 1 if you have the <arpa/inet.h> header file. */
+#define HAVE_ARPA_INET_H 1
+
+/* Define to 1 if you have the <arpa/nameser.h> header file. */
+#define HAVE_ARPA_NAMESER_H 1
+
+/* Define to 1 if you have the `asctime_r' function. */
+#define HAVE_ASCTIME_R 1
+
+/* Define to 1 if you have the `asinh' function. */
+#define HAVE_ASINH 1
+
+/* Define to 1 if you have the `asprintf' function. */
+#define HAVE_ASPRINTF 1
+
+/* Define to 1 if you have the <assert.h> header file. */
+#define HAVE_ASSERT_H 1
+
+/* Define to 1 if you have the `atanh' function. */
+#define HAVE_ATANH 1
+
+/* whether atof() accepts INF */
+/* #undef HAVE_ATOF_ACCEPTS_INF */
+
+/* whether atof() accepts NAN */
+/* #undef HAVE_ATOF_ACCEPTS_NAN */
+
+/* Define to 1 if you have the `atoll' function. */
+#define HAVE_ATOLL 1
+
+/* Define to 1 if you have the <atomic.h> header file. */
+/* #undef HAVE_ATOMIC_H */
+
+/* Define this if your target compiler supports builtin atomics */
+#define HAVE_ATOMIC_OPERATIONS 1
+
+/* whether the compiler supports __attribute__ ((__aligned__)) */
+#define HAVE_ATTRIBUTE_ALIGNED 1
+
+/* Whether you have bcmath */
+/* #undef HAVE_BCMATH */
+
+/* */
+/* #undef HAVE_BIND_TEXTDOMAIN_CODESET */
+
+/* */
+/* #undef HAVE_BIRDSTEP */
+
+/* Define if system has broken getcwd */
+/* #undef HAVE_BROKEN_GETCWD */
+
+/* Define if your glibc borks on fopen with mode a+ */
+#define HAVE_BROKEN_GLIBC_FOPEN_APPEND 1
+
+/* Whether we have librecode 3.5 */
+/* #undef HAVE_BROKEN_RECODE */
+
+/* Konstantin Chuguev's iconv implementation */
+/* #undef HAVE_BSD_ICONV */
+
+/* */
+#define HAVE_BUILD_DEFS_H 1
+
+/* Define to 1 if gcc supports __sync_bool_compare_and_swap() a.o. */
+/* #undef HAVE_BUILTIN_ATOMIC */
+
+/* */
+/* #undef HAVE_BUNDLED_PCRE */
+
+/* */
+/* #undef HAVE_BZ2 */
+
+/* */
+/* #undef HAVE_CALENDAR */
+
+/* Whether to compile with Caudium support */
+/* #undef HAVE_CAUDIUM */
+
+/* Define to 1 if you have the `chroot' function. */
+#define HAVE_CHROOT 1
+
+/* Define to 1 if you have the `clearenv' function. */
+/* #undef HAVE_CLEARENV */
+
+/* */
+/* #undef HAVE_CLI0CLI_H */
+
+/* */
+/* #undef HAVE_CLI0CORE_H */
+
+/* */
+/* #undef HAVE_CLI0DEFS_H */
+
+/* */
+/* #undef HAVE_CLI0ENV_H */
+
+/* */
+/* #undef HAVE_CLI0EXT_H */
+
+/* do we have clock_gettime? */
+/* #undef HAVE_CLOCK_GETTIME */
+
+/* do we have clock_get_time? */
+/* #undef HAVE_CLOCK_GET_TIME */
+
+/* Whether you have struct cmsghdr */
+#define HAVE_CMSGHDR 1
+
+/* */
+/* #undef HAVE_CODBC */
+
+/* */
+/* #undef HAVE_COLORCLOSESTHWB */
+
+/* Whether you have a Continuity Server */
+/* #undef HAVE_CONTINUITY */
+
+/* Define to 1 if you have the `CreateProcess' function. */
+/* #undef HAVE_CREATEPROCESS */
+
+/* */
+#define HAVE_CRYPT 1
+
+/* Define to 1 if you have the <crypt.h> header file. */
+#define HAVE_CRYPT_H 1
+
+/* Define to 1 if you have the `crypt_r' function. */
+/* #undef HAVE_CRYPT_R */
+
+/* Define to 1 if you have the `ctermid' function. */
+#define HAVE_CTERMID 1
+
+/* Define to 1 if you have the `ctime_r' function. */
+#define HAVE_CTIME_R 1
+
+/* */
+/* #undef HAVE_CTYPE */
+
+/* */
+#define HAVE_CURL 1
+
+/* */
+#define HAVE_CURL_EASY_STRERROR 1
+
+/* Have cURL with GnuTLS support */
+/* #undef HAVE_CURL_GNUTLS */
+
+/* */
+#define HAVE_CURL_MULTI_STRERROR 1
+
+/* Have cURL with OpenSSL support */
+/* #undef HAVE_CURL_OPENSSL */
+
+/* Have cURL with SSL support */
+#define HAVE_CURL_SSL 1
+
+/* */
+#define HAVE_CURL_VERSION_INFO 1
+
+/* Define to 1 if you have the `cuserid' function. */
+#define HAVE_CUSERID 1
+
+/* */
+/* #undef HAVE_DBA */
+
+/* Whether you want DBMaker */
+/* #undef HAVE_DBMAKER */
+
+/* */
+/* #undef HAVE_DCNGETTEXT */
+
+/* Whether system headers declare timezone */
+#define HAVE_DECLARED_TIMEZONE 1
+
+/* Define to 1 if you have the declaration of `tzname', and to 0 if you don't.
+   */
+/* #undef HAVE_DECL_TZNAME */
+
+/* do we have /dev/poll? */
+/* #undef HAVE_DEVPOLL */
+
+/* Define if the target system has /dev/arandom device */
+/* #undef HAVE_DEV_ARANDOM */
+
+/* Define if the target system has /dev/urandom device */
+#define HAVE_DEV_URANDOM 1
+
+/* Define to 1 if you have the <dirent.h> header file. */
+#define HAVE_DIRENT_H 1
+
+/* Define to 1 if you have the <dlfcn.h> header file. */
+#define HAVE_DLFCN_H 1
+
+/* */
+/* #undef HAVE_DLOPEN */
+
+/* Whether you have dmalloc */
+/* #undef HAVE_DMALLOC */
+
+/* */
+/* #undef HAVE_DNGETTEXT */
+
+/* Define to 1 if you have the <dns.h> header file. */
+/* #undef HAVE_DNS_H */
+
+/* */
+/* #undef HAVE_DNS_SEARCH */
+
+/* */
+/* #undef HAVE_DN_EXPAND */
+
+/* */
+/* #undef HAVE_DN_SKIPNAME */
+
+/* */
+#define HAVE_DOM 1
+
+/* Define to 1 if you don't have `vprintf' but do have `_doprnt.' */
+/* #undef HAVE_DOPRNT */
+
+/* OpenSSL 0.9.7 or later */
+#define HAVE_DSA_DEFAULT_METHOD 1
+
+/* Whether to enable DTrace support */
+/* #undef HAVE_DTRACE */
+
+/* embedded MySQL support enabled */
+/* #undef HAVE_EMBEDDED_MYSQLI */
+
+/* */
+/* #undef HAVE_EMPRESS */
+
+/* */
+/* #undef HAVE_ENCHANT */
+
+/* */
+/* #undef HAVE_ENCHANT_BROKER_SET_PARAM */
+
+/* do we have epoll? */
+/* #undef HAVE_EPOLL */
+
+/* Define to 1 if you have the <errno.h> header file. */
+#define HAVE_ERRNO_H 1
+
+/* */
+/* #undef HAVE_ESOOB */
+
+/* Whether you want EXIF (metadata from images) support */
+/* #undef HAVE_EXIF */
+
+/* Define to 1 if you have the `fabsf' function. */
+/* #undef HAVE_FABSF */
+
+/* Define to 1 if you have the <fcntl.h> header file. */
+#define HAVE_FCNTL_H 1
+
+/* Define to 1 if you have the `finite' function. */
+#define HAVE_FINITE 1
+
+/* Define to 1 if you have the `flock' function. */
+#define HAVE_FLOCK 1
+
+/* Define to 1 if you have the `floorf' function. */
+/* #undef HAVE_FLOORF */
+
+/* Define if flush should be called explicitly after a buffered io. */
+/* #undef HAVE_FLUSHIO */
+
+/* Define to 1 if your system has a working POSIX `fnmatch' function. */
+/* #undef HAVE_FNMATCH */
+
+/* */
+#define HAVE_FOPENCOOKIE 1
+
+/* Define to 1 if you have the `fork' function. */
+#define HAVE_FORK 1
+
+/* Define to 1 if you have the `fpclass' function. */
+/* #undef HAVE_FPCLASS */
+
+/* whether fpsetprec is present and usable */
+/* #undef HAVE_FPSETPREC */
+
+/* whether FPU control word can be manipulated by inline assembler */
+/* #undef HAVE_FPU_INLINE_ASM_X86 */
+
+/* whether floatingpoint.h defines fp_except */
+/* #undef HAVE_FP_EXCEPT */
+
+/* */
+/* #undef HAVE_FREETDS */
+
+/* Define to 1 if you have the `ftok' function. */
+#define HAVE_FTOK 1
+
+/* Whether you want FTP support */
+/* #undef HAVE_FTP */
+
+/* Define to 1 if you have the `funopen' function. */
+/* #undef HAVE_FUNOPEN */
+
+/* Define to 1 if you have the `gai_strerror' function. */
+#define HAVE_GAI_STRERROR 1
+
+/* Whether you have gcov */
+/* #undef HAVE_GCOV */
+
+/* Define to 1 if you have the `gcvt' function. */
+#define HAVE_GCVT 1
+
+/* */
+/* #undef HAVE_GDIMAGECOLORRESOLVE */
+
+/* */
+/* #undef HAVE_GD_BUNDLED */
+
+/* */
+/* #undef HAVE_GD_CACHE_CREATE */
+
+/* */
+/* #undef HAVE_GD_DYNAMIC_CTX_EX */
+
+/* */
+/* #undef HAVE_GD_FONTCACHESHUTDOWN */
+
+/* */
+/* #undef HAVE_GD_FONTMUTEX */
+
+/* */
+/* #undef HAVE_GD_FREEFONTCACHE */
+
+/* */
+/* #undef HAVE_GD_GD2 */
+
+/* */
+/* #undef HAVE_GD_GIF_CREATE */
+
+/* */
+/* #undef HAVE_GD_GIF_CTX */
+
+/* */
+/* #undef HAVE_GD_GIF_READ */
+
+/* */
+/* #undef HAVE_GD_IMAGEELLIPSE */
+
+/* */
+/* #undef HAVE_GD_IMAGESETBRUSH */
+
+/* */
+/* #undef HAVE_GD_IMAGESETTILE */
+
+/* */
+/* #undef HAVE_GD_IMAGE_CONVOLUTION */
+
+/* */
+/* #undef HAVE_GD_IMAGE_PIXELATE */
+
+/* */
+/* #undef HAVE_GD_JPG */
+
+/* */
+/* #undef HAVE_GD_PNG */
+
+/* */
+/* #undef HAVE_GD_STRINGFT */
+
+/* */
+/* #undef HAVE_GD_STRINGFTEX */
+
+/* */
+/* #undef HAVE_GD_STRINGTTF */
+
+/* */
+/* #undef HAVE_GD_WBMP */
+
+/* */
+/* #undef HAVE_GD_WEBP */
+
+/* */
+/* #undef HAVE_GD_XBM */
+
+/* */
+/* #undef HAVE_GD_XPM */
+
+/* Define if you have the getaddrinfo function */
+/* #undef HAVE_GETADDRINFO */
+
+/* Define to 1 if you have the `getcwd' function. */
+#define HAVE_GETCWD 1
+
+/* Define to 1 if you have the `getgrgid_r' function. */
+#define HAVE_GETGRGID_R 1
+
+/* Define to 1 if you have the `getgrnam_r' function. */
+#define HAVE_GETGRNAM_R 1
+
+/* Define to 1 if you have the `getgroups' function. */
+#define HAVE_GETGROUPS 1
+
+/* */
+#define HAVE_GETHOSTBYADDR 1
+
+/* Define to 1 if you have the `gethostname' function. */
+#define HAVE_GETHOSTNAME 1
+
+/* Define to 1 if you have the `getloadavg' function. */
+#define HAVE_GETLOADAVG 1
+
+/* Define to 1 if you have the `getlogin' function. */
+#define HAVE_GETLOGIN 1
+
+/* Define to 1 if you have the `getopt' function. */
+#define HAVE_GETOPT 1
+
+/* Define to 1 if you have the `getpgid' function. */
+#define HAVE_GETPGID 1
+
+/* Define to 1 if you have the `getpid' function. */
+#define HAVE_GETPID 1
+
+/* Define to 1 if you have the `getpriority' function. */
+/* #undef HAVE_GETPRIORITY */
+
+/* Define to 1 if you have the `getprotobyname' function. */
+#define HAVE_GETPROTOBYNAME 1
+
+/* Define to 1 if you have the `getprotobynumber' function. */
+#define HAVE_GETPROTOBYNUMBER 1
+
+/* Define to 1 if you have the `getpwnam_r' function. */
+#define HAVE_GETPWNAM_R 1
+
+/* Define to 1 if you have the `getpwuid_r' function. */
+#define HAVE_GETPWUID_R 1
+
+/* Define to 1 if you have the `getrlimit' function. */
+#define HAVE_GETRLIMIT 1
+
+/* Define to 1 if you have the `getrusage' function. */
+#define HAVE_GETRUSAGE 1
+
+/* Define to 1 if you have the `getservbyname' function. */
+#define HAVE_GETSERVBYNAME 1
+
+/* Define to 1 if you have the `getservbyport' function. */
+#define HAVE_GETSERVBYPORT 1
+
+/* Define to 1 if you have the `getsid' function. */
+#define HAVE_GETSID 1
+
+/* Define to 1 if you have the `gettimeofday' function. */
+#define HAVE_GETTIMEOFDAY 1
+
+/* Define to 1 if you have the `getwd' function. */
+#define HAVE_GETWD 1
+
+/* */
+/* #undef HAVE_GICONV_H */
+
+/* glibc's iconv implementation */
+/* #undef HAVE_GLIBC_ICONV */
+
+/* Define to 1 if you have the `glob' function. */
+#define HAVE_GLOB 1
+
+/* */
+/* #undef HAVE_GMP */
+
+/* Define to 1 if you have the `gmtime_r' function. */
+#define HAVE_GMTIME_R 1
+
+/* Define to 1 if you have the `grantpt' function. */
+#define HAVE_GRANTPT 1
+
+/* Define to 1 if you have the <grp.h> header file. */
+#define HAVE_GRP_H 1
+
+/* Have HASH Extension */
+#define HAVE_HASH_EXT 1
+
+/* Define to 1 if you have the `hstrerror' function. */
+#define HAVE_HSTRERROR 1
+
+/* */
+#define HAVE_HTONL 1
+
+/* whether HUGE_VAL == INF */
+#define HAVE_HUGE_VAL_INF 1
+
+/* whether HUGE_VAL + -HUGEVAL == NAN */
+#define HAVE_HUGE_VAL_NAN 1
+
+/* Define to 1 if you have the `hypot' function. */
+#define HAVE_HYPOT 1
+
+/* */
+/* #undef HAVE_IBASE */
+
+/* */
+/* #undef HAVE_IBMDB2 */
+
+/* IBM iconv implementation */
+/* #undef HAVE_IBM_ICONV */
+
+/* */
+#define HAVE_ICONV 1
+
+/* Define to 1 if you have the <ieeefp.h> header file. */
+/* #undef HAVE_IEEEFP_H */
+
+/* Define to 1 if you have the `if_indextoname' function. */
+#define HAVE_IF_INDEXTONAME 1
+
+/* Define to 1 if you have the `if_nametoindex' function. */
+#define HAVE_IF_NAMETOINDEX 1
+
+/* */
+/* #undef HAVE_IMAP */
+
+/* */
+/* #undef HAVE_IMAP2000 */
+
+/* */
+/* #undef HAVE_IMAP2001 */
+
+/* */
+/* #undef HAVE_IMAP2004 */
+
+/* */
+/* #undef HAVE_IMAP_AUTH_GSS */
+
+/* */
+/* #undef HAVE_IMAP_KRB */
+
+/* */
+/* #undef HAVE_IMAP_MUTF7 */
+
+/* */
+/* #undef HAVE_IMAP_SSL */
+
+/* */
+#define HAVE_INET_ATON 1
+
+/* Define to 1 if you have the `inet_ntoa' function. */
+#define HAVE_INET_NTOA 1
+
+/* Define to 1 if you have the `inet_ntop' function. */
+#define HAVE_INET_NTOP 1
+
+/* Define to 1 if you have the `inet_pton' function. */
+#define HAVE_INET_PTON 1
+
+/* Define to 1 if you have the `initgroups' function. */
+#define HAVE_INITGROUPS 1
+
+/* Define if int32_t type is present. */
+#define HAVE_INT32_T 1
+
+/* Whether intmax_t is available */
+/* #undef HAVE_INTMAX_T */
+
+/* Define to 1 if you have the <inttypes.h> header file. */
+#define HAVE_INTTYPES_H 1
+
+/* */
+/* #undef HAVE_IODBC */
+
+/* */
+/* #undef HAVE_IODBC_H */
+
+/* Whether to enable IPv6 support */
+#define HAVE_IPV6 1
+
+/* Define to 1 if you have the `isascii' function. */
+#define HAVE_ISASCII 1
+
+/* Define to 1 if you have the `isfinite' function. */
+/* #undef HAVE_ISFINITE */
+
+/* Define to 1 if you have the `isinf' function. */
+#define HAVE_ISINF 1
+
+/* Define to 1 if you have the `isnan' function. */
+#define HAVE_ISNAN 1
+
+/* */
+/* #undef HAVE_ISQLEXT_H */
+
+/* */
+/* #undef HAVE_ISQL_H */
+
+/* whether to enable JavaScript Object Serialization support */
+#define HAVE_JSON 1 
+
+/* Define to 1 if you have the `kill' function. */
+#define HAVE_KILL 1
+
+/* do we have kqueue? */
+/* #undef HAVE_KQUEUE */
+
+/* Define to 1 if you have the <langinfo.h> header file. */
+#define HAVE_LANGINFO_H 1
+
+/* Define to 1 if you have the `lchown' function. */
+#define HAVE_LCHOWN 1
+
+/* */
+/* #undef HAVE_LDAP */
+
+/* Define to 1 if you have the `ldap_parse_reference' function. */
+/* #undef HAVE_LDAP_PARSE_REFERENCE */
+
+/* Define to 1 if you have the `ldap_parse_result' function. */
+/* #undef HAVE_LDAP_PARSE_RESULT */
+
+/* LDAP SASL support */
+/* #undef HAVE_LDAP_SASL */
+
+/* */
+/* #undef HAVE_LDAP_SASL_H */
+
+/* */
+/* #undef HAVE_LDAP_SASL_SASL_H */
+
+/* Define to 1 if you have the `ldap_start_tls_s' function. */
+/* #undef HAVE_LDAP_START_TLS_S */
+
+/* */
+/* #undef HAVE_LIBBIND */
+
+/* */
+/* #undef HAVE_LIBCRYPT */
+
+/* */
+/* #undef HAVE_LIBDL */
+
+/* */
+/* #undef HAVE_LIBDNET_STUB */
+
+/* */
+/* #undef HAVE_LIBEDIT */
+
+/* */
+/* #undef HAVE_LIBEXPAT */
+
+/* */
+/* #undef HAVE_LIBFREETYPE */
+
+/* */
+/* #undef HAVE_LIBGD */
+
+/* */
+/* #undef HAVE_LIBGD13 */
+
+/* */
+/* #undef HAVE_LIBGD15 */
+
+/* */
+/* #undef HAVE_LIBGD20 */
+
+/* */
+/* #undef HAVE_LIBGD204 */
+
+/* */
+/* #undef HAVE_LIBICONV */
+
+/* */
+/* #undef HAVE_LIBINTL */
+
+/* Define to 1 if you have the `m' library (-lm). */
+#define HAVE_LIBM 1
+
+/* */
+#define HAVE_LIBMCRYPT 1
+
+/* Whether you have libmm */
+/* #undef HAVE_LIBMM */
+
+/* */
+/* #undef HAVE_LIBNSL */
+
+/* */
+/* #undef HAVE_LIBPAM */
+
+/* */
+/* #undef HAVE_LIBRARYMANAGER_H */
+
+/* */
+/* #undef HAVE_LIBREADLINE */
+
+/* Whether we have librecode 3.5 or higher */
+/* #undef HAVE_LIBRECODE */
+
+/* */
+/* #undef HAVE_LIBRESOLV */
+
+/* */
+/* #undef HAVE_LIBRT */
+
+/* */
+/* #undef HAVE_LIBSOCKET */
+
+/* */
+/* #undef HAVE_LIBT1 */
+
+/* */
+#define HAVE_LIBXML 1
+
+/* Define to 1 if you have the <limits.h> header file. */
+#define HAVE_LIMITS_H 1
+
+/* Define to 1 if you have the `link' function. */
+#define HAVE_LINK 1
+
+/* Define to 1 if you have the `localeconv' function. */
+#define HAVE_LOCALECONV 1
+
+/* Define to 1 if you have the <locale.h> header file. */
+#define HAVE_LOCALE_H 1
+
+/* Define to 1 if you have the `localtime_r' function. */
+#define HAVE_LOCALTIME_R 1
+
+/* Define to 1 if you have the `lockf' function. */
+#define HAVE_LOCKF 1
+
+/* Define to 1 if you have the `log1p' function. */
+#define HAVE_LOG1P 1
+
+/* do we have SO_LISTENQxxx? */
+/* #undef HAVE_LQ_SO_LISTENQ */
+
+/* do we have TCP_INFO? */
+/* #undef HAVE_LQ_TCP_INFO */
+
+/* Define to 1 if you have the `lrand48' function. */
+#define HAVE_LRAND48 1
+
+/* do we have mach_vm_read? */
+/* #undef HAVE_MACH_VM_READ */
+
+/* Define to 1 if you have the `makedev' function. */
+/* #undef HAVE_MAKEDEV */
+
+/* Define to 1 if you have the <malloc.h> header file. */
+#define HAVE_MALLOC_H 1
+
+/* Define to 1 if you have the `mblen' function. */
+#define HAVE_MBLEN 1
+
+/* whether to have multibyte regex support */
+#define HAVE_MBREGEX 1
+
+/* Define to 1 if you have the `mbrlen' function. */
+#define HAVE_MBRLEN 1
+
+/* Define to 1 if you have the `mbsinit' function. */
+#define HAVE_MBSINIT 1
+
+/* Define if your system has mbstate_t in wchar.h */
+#define HAVE_MBSTATE_T 1
+
+/* whether to have multibyte string support */
+#define HAVE_MBSTRING 1
+
+/* Define to 1 if you have the `memcpy' function. */
+#define HAVE_MEMCPY 1
+
+/* Define to 1 if you have the `memmove' function. */
+#define HAVE_MEMMOVE 1
+
+/* Define to 1 if you have the <memory.h> header file. */
+#define HAVE_MEMORY_H 1
+
+/* Define to 1 if you have the `mempcpy' function. */
+#define HAVE_MEMPCPY 1
+
+/* Define if the target system has support for memory allocation using
+   mmap(MAP_ANON) */
+/* #undef HAVE_MEM_MMAP_ANON */
+
+/* Define if the target system has support for memory allocation using
+   mmap("/dev/zero") */
+/* #undef HAVE_MEM_MMAP_ZERO */
+
+/* Define to 1 if you have the `mkfifo' function. */
+#define HAVE_MKFIFO 1
+
+/* Define to 1 if you have the `mknod' function. */
+#define HAVE_MKNOD 1
+
+/* Define to 1 if you have the `mkstemp' function. */
+#define HAVE_MKSTEMP 1
+
+/* Define to 1 if you have the `mmap' function. */
+#define HAVE_MMAP 1
+
+/* Define to 1 if you have the <monetary.h> header file. */
+#define HAVE_MONETARY_H 1
+
+/* Define to 1 if you have the `mremap' function. */
+#define HAVE_MREMAP 1
+
+/* */
+/* #undef HAVE_MSSQL */
+
+/* Whether you have MySQL */
+/* #undef HAVE_MYSQL */
+
+/* */
+/* #undef HAVE_MYSQLILIB */
+
+/* Define to 1 if you have the `nanosleep' function. */
+#define HAVE_NANOSLEEP 1
+
+/* Define to 1 if you have the <ndir.h> header file, and it defines `DIR'. */
+/* #undef HAVE_NDIR_H */
+
+/* Define to 1 if you have the <netdb.h> header file. */
+#define HAVE_NETDB_H 1
+
+/* Define to 1 if you have the <netinet/in.h> header file. */
+#define HAVE_NETINET_IN_H 1
+
+/* Define to 1 if you have the <netinet/tcp.h> header file. */
+#define HAVE_NETINET_TCP_H 1
+
+/* Whether utf8_mime2text() has new signature */
+/* #undef HAVE_NEW_MIME2TEXT */
+
+/* */
+/* #undef HAVE_NGETTEXT */
+
+/* Define to 1 if you have the `nice' function. */
+#define HAVE_NICE 1
+
+/* Define to 1 if you have the `nl_langinfo' function. */
+#define HAVE_NL_LANGINFO 1
+
+/* Whether you have a Netscape/iPlanet/Sun Webserver */
+/* #undef HAVE_NSAPI */
+
+/* */
+/* #undef HAVE_NSLDAP */
+
+/* */
+/* #undef HAVE_OCI8 */
+
+/* */
+/* #undef HAVE_OCICOLLASSIGN */
+
+/* */
+/* #undef HAVE_OCIENVCREATE */
+
+/* */
+/* #undef HAVE_OCIENVNLSCREATE */
+
+/* */
+/* #undef HAVE_OCILOBISTEMPORARY */
+
+/* */
+/* #undef HAVE_OCISTMTFETCH2 */
+
+/* */
+/* #undef HAVE_OCI_INSTANT_CLIENT */
+
+/* */
+/* #undef HAVE_OCI_LOB_READ2 */
+
+/* */
+/* #undef HAVE_ODBC2 */
+
+/* */
+/* #undef HAVE_ODBCSDK_H */
+
+/* */
+/* #undef HAVE_ODBC_H */
+
+/* */
+/* #undef HAVE_ODBC_ROUTER */
+
+/* */
+/* #undef HAVE_OLD_COMPAT_H */
+
+/* whether you have old-style readdir_r */
+/* #undef HAVE_OLD_READDIR_R */
+
+/* Define to 1 if the oniguruma library is available */
+#define HAVE_ONIG 1
+
+/* Define to 1 if you have the <openssl/crypto.h> header file. */
+/* #undef HAVE_OPENSSL_CRYPTO_H */
+
+/* */
+#define HAVE_OPENSSL_EXT 1
+
+/* */
+/* #undef HAVE_ORALDAP */
+
+/* */
+/* #undef HAVE_ORALDAP_10 */
+
+/* Whether struct _zend_object_value is packed */
+#define HAVE_PACKED_OBJECT_VALUE 0
+
+/* */
+#define HAVE_PCRE 1
+
+/* */
+/* #undef HAVE_PDO_DBLIB */
+
+/* */
+/* #undef HAVE_PDO_FIREBIRD */
+
+/* Whether to build PostgreSQL for PDO support or not */
+/* #undef HAVE_PDO_PGSQL */
+
+/* */
+#define HAVE_PDO_SQLITELIB 1
+
+/* Define to 1 if you have the `perror' function. */
+#define HAVE_PERROR 1
+
+/* Whether to build PostgreSQL support or not */
+/* #undef HAVE_PGSQL */
+
+/* Whether libpq is compiled with --enable-multibyte */
+/* #undef HAVE_PGSQL_WITH_MULTIBYTE_SUPPORT */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PGTRANSACTIONSTATUS */
+
+/* Whether to have pg_config.h */
+/* #undef HAVE_PG_CONFIG_H */
+
+/* PostgreSQL 8.1 or later */
+/* #undef HAVE_PG_LO_CREATE */
+
+/* PostgreSQL 8.4 or later */
+/* #undef HAVE_PG_LO_IMPORT_WITH_OID */
+
+/* */
+#define HAVE_PHP_SESSION 1
+
+/* Whether you have phttpd */
+/* #undef HAVE_PHTTPD */
+
+/* Define to 1 if you have the `poll' function. */
+#define HAVE_POLL 1
+
+/* do we have port framework? */
+/* #undef HAVE_PORT */
+
+/* whether to include POSIX-like functions */
+#define HAVE_POSIX 1
+
+/* whether you have POSIX readdir_r */
+/* #undef HAVE_POSIX_READDIR_R */
+
+/* PostgreSQL 7.0.x or later */
+/* #undef HAVE_PQCLIENTENCODING */
+
+/* Broken libpq under windows */
+/* #undef HAVE_PQCMDTUPLES */
+
+/* PostgreSQL 7.2.0 or later */
+/* #undef HAVE_PQESCAPE */
+
+/* PostgreSQL 9.0 or later */
+/* #undef HAVE_PQESCAPELITERAL */
+
+/* PostgreSQL 8.1.4 or later */
+/* #undef HAVE_PQESCAPE_BYTEA_CONN */
+
+/* PostgreSQL 8.1.4 or later */
+/* #undef HAVE_PQESCAPE_CONN */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQEXECPARAMS */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQEXECPREPARED */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQFREEMEM */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQFTABLE */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQGETCOPYDATA */
+
+/* Older PostgreSQL */
+/* #undef HAVE_PQOIDVALUE */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQPARAMETERSTATUS */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQPREPARE */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQPROTOCOLVERSION */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQPUTCOPYDATA */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQPUTCOPYEND */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQRESULTERRORFIELD */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQSENDPREPARE */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQSENDQUERYPARAMS */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQSENDQUERYPREPARED */
+
+/* PostgreSQL 7.4 or later */
+/* #undef HAVE_PQSETERRORVERBOSITY */
+
+/* PostgreSQL 7.0.x or later */
+/* #undef HAVE_PQSETNONBLOCKING */
+
+/* PostgreSQL 7.3.0 or later */
+/* #undef HAVE_PQUNESCAPEBYTEA */
+
+/* do we have prctl? */
+/* #undef HAVE_PRCTL */
+
+/* */
+/* #undef HAVE_PREAD */
+
+/* */
+/* #undef HAVE_PSPELL */
+
+/* do we have ptrace? */
+/* #undef HAVE_PTRACE */
+
+/* Whether ptrdiff_t is available */
+#define HAVE_PTRDIFF_T 1
+
+/* Define to 1 if you have the `ptsname' function. */
+#define HAVE_PTSNAME 1
+
+/* Define to 1 if you have the `putenv' function. */
+#define HAVE_PUTENV 1
+
+/* Define to 1 if you have the <pwd.h> header file. */
+#define HAVE_PWD_H 1
+
+/* */
+/* #undef HAVE_PWRITE */
+
+/* Define to 1 if you have the `random' function. */
+#define HAVE_RANDOM 1
+
+/* Define to 1 if you have the `rand_r' function. */
+#define HAVE_RAND_R 1
+
+/* Define to 1 if you have the `realpath' function. */
+#define HAVE_REALPATH 1
+
+/* Whether Reflection is enabled */
+#define HAVE_REFLECTION 1
+
+/* 1 */
+#define HAVE_REGEX_T_RE_MAGIC 1
+
+/* Define to 1 if you have the <resolv.h> header file. */
+#define HAVE_RESOLV_H 1
+
+/* */
+/* #undef HAVE_RES_NSEARCH */
+
+/* */
+/* #undef HAVE_RES_SEARCH */
+
+/* */
+/* #undef HAVE_RFC822_OUTPUT_ADDRESS_LIST */
+
+/* */
+/* #undef HAVE_RL_CALLBACK_READ_CHAR */
+
+/* Define to 1 if you have the `rl_completion_matches' function. */
+/* #undef HAVE_RL_COMPLETION_MATCHES */
+
+/* */
+/* #undef HAVE_RL_ON_NEW_LINE */
+
+/* Whether you use Roxen */
+/* #undef HAVE_ROXEN */
+
+/* */
+/* #undef HAVE_SAPDB */
+
+/* Whether you have sockaddr_storage.ss_family */
+#define HAVE_SA_SS_FAMILY 1
+
+/* Define to 1 if you have the `scandir' function. */
+#define HAVE_SCANDIR 1
+
+/* do we have select? */
+/* #undef HAVE_SELECT */
+
+/* */
+#define HAVE_SEMUN 0
+
+/* Define to 1 if you have the `setegid' function. */
+#define HAVE_SETEGID 1
+
+/* Define to 1 if you have the `setenv' function. */
+#define HAVE_SETENV 1
+
+/* Define to 1 if you have the `seteuid' function. */
+#define HAVE_SETEUID 1
+
+/* Define to 1 if you have the `setitimer' function. */
+#define HAVE_SETITIMER 1
+
+/* Define to 1 if you have the `setlocale' function. */
+#define HAVE_SETLOCALE 1
+
+/* Define to 1 if you have the `setpgid' function. */
+#define HAVE_SETPGID 1
+
+/* Define to 1 if you have the `setpriority' function. */
+/* #undef HAVE_SETPRIORITY */
+
+/* Define to 1 if you have the `setproctitle' function. */
+/* #undef HAVE_SETPROCTITLE */
+
+/* Define to 1 if you have the `setsid' function. */
+#define HAVE_SETSID 1
+
+/* Define to 1 if you have the `setsockopt' function. */
+#define HAVE_SETSOCKOPT 1
+
+/* Define to 1 if you have the `setvbuf' function. */
+#define HAVE_SETVBUF 1
+
+/* */
+/* #undef HAVE_SHMOP */
+
+/* Define to 1 if you have the `shutdown' function. */
+#define HAVE_SHUTDOWN 1
+
+/* */
+/* #undef HAVE_SHUTDOWN_SNMP_LOGGING */
+
+/* Whether sigaction() is available */
+#define HAVE_SIGACTION 1
+
+/* Define to 1 if you have the <signal.h> header file. */
+#define HAVE_SIGNAL_H 1
+
+/* Define to 1 if you have the `sigprocmask' function. */
+#define HAVE_SIGPROCMASK 1
+
+/* Define to 1 if you have the `sigsetjmp' function. */
+/* #undef HAVE_SIGSETJMP */
+
+/* Define to 1 if you have the `sigtimedwait' function. */
+/* #undef HAVE_SIGTIMEDWAIT */
+
+/* Define to 1 if you have the `sigwaitinfo' function. */
+/* #undef HAVE_SIGWAITINFO */
+
+/* */
+#define HAVE_SIMPLEXML 1
+
+/* Define to 1 if you have the `sin' function. */
+#define HAVE_SIN 1
+
+/* */
+/* #undef HAVE_SNMP */
+
+/* Define to 1 if you have the `snprintf' function. */
+#define HAVE_SNPRINTF 1
+
+/* */
+/* #undef HAVE_SOAP */
+
+/* Whether struct sockaddr has field sa_len */
+/* #undef HAVE_SOCKADDR_SA_LEN */
+
+/* Whether you have struct sockaddr_storage */
+#define HAVE_SOCKADDR_STORAGE 1
+
+/* Define if sockaddr_un in sys/un.h contains a sun_len component */
+/* #undef HAVE_SOCKADDR_UN_SUN_LEN */
+
+/* */
+#define HAVE_SOCKET 1
+
+/* Define to 1 if you have the `socketpair' function. */
+#define HAVE_SOCKETPAIR 1
+
+/* */
+#define HAVE_SOCKETS 1
+
+/* Whether you have socklen_t */
+#define HAVE_SOCKLEN_T 1
+
+/* */
+/* #undef HAVE_SOLID */
+
+/* */
+/* #undef HAVE_SOLID_30 */
+
+/* */
+/* #undef HAVE_SOLID_35 */
+
+/* Whether you want SPL (Standard PHP Library) support */
+#define HAVE_SPL 1
+
+/* */
+/* #undef HAVE_SQLCLI1_H */
+
+/* */
+/* #undef HAVE_SQLDATASOURCES */
+
+/* */
+/* #undef HAVE_SQLEXT_H */
+
+/* */
+#define HAVE_SQLITE3 1
+
+/* have commercial sqlite3 with crypto support */
+/* #undef HAVE_SQLITE3_KEY */
+
+/* */
+/* #undef HAVE_SQLTYPES_H */
+
+/* */
+/* #undef HAVE_SQLUCODE_H */
+
+/* */
+/* #undef HAVE_SQLUNIX_H */
+
+/* */
+/* #undef HAVE_SQL_H */
+
+/* Define to 1 if you have the `srand48' function. */
+#define HAVE_SRAND48 1
+
+/* Define to 1 if you have the `srandom' function. */
+#define HAVE_SRANDOM 1
+
+/* Whether ssize_t is available */
+#define HAVE_SSIZE_T 1
+
+/* Define to 1 if you have the `statfs' function. */
+#define HAVE_STATFS 1
+
+/* Define to 1 if you have the `statvfs' function. */
+#define HAVE_STATVFS 1
+
+/* Define to 1 if you have the <stdarg.h> header file. */
+#define HAVE_STDARG_H 1
+
+/* Define to 1 if you have the <stdarg.h> header file. */
+#define HAVE_STDARG_PROTOTYPES 1
+
+/* Define to 1 if you have the <stdbool.h> header file. */
+/* #undef HAVE_STDBOOL_H */
+
+/* Define to 1 if you have the <stdint.h> header file. */
+#define HAVE_STDINT_H 1
+
+/* Define to 1 if you have the <stdio.h> header file. */
+/* #undef HAVE_STDIO_H */
+
+/* Define to 1 if you have the <stdlib.h> header file. */
+#define HAVE_STDLIB_H 1
+
+/* Define to 1 if you have the `std_syslog' function. */
+/* #undef HAVE_STD_SYSLOG */
+
+/* */
+/* #undef HAVE_STMT_NEXT_RESULT */
+
+/* Define to 1 if you have the `strcasecmp' function. */
+#define HAVE_STRCASECMP 1
+
+/* Define to 1 if you have the `strcoll' function. */
+#define HAVE_STRCOLL 1
+
+/* Define to 1 if you have the `strdup' function. */
+#define HAVE_STRDUP 1
+
+/* Define to 1 if you have the `strerror' function. */
+#define HAVE_STRERROR 1
+
+/* Define to 1 if you have the `strfmon' function. */
+#define HAVE_STRFMON 1
+
+/* Define to 1 if you have the `strftime' function. */
+#define HAVE_STRFTIME 1
+
+/* Define to 1 if you have the <strings.h> header file. */
+#define HAVE_STRINGS_H 1
+
+/* Define to 1 if you have the <string.h> header file. */
+#define HAVE_STRING_H 1
+
+/* Define to 1 if you have the `strlcat' function. */
+/* #undef HAVE_STRLCAT */
+
+/* Define to 1 if you have the `strlcpy' function. */
+/* #undef HAVE_STRLCPY */
+
+/* Define to 1 if you have the `strndup' function. */
+/* #undef HAVE_STRNDUP */
+
+/* Define to 1 if you have the `strnlen' function. */
+#define HAVE_STRNLEN 1
+
+/* Define to 1 if you have the `strpbrk' function. */
+#define HAVE_STRPBRK 1
+
+/* Define to 1 if you have the `strpncpy' function. */
+/* #undef HAVE_STRPNCPY */
+
+/* Define to 1 if you have the `strptime' function. */
+#define HAVE_STRPTIME 1
+
+/* whether strptime() declaration fails */
+#define HAVE_STRPTIME_DECL_FAILS 1
+
+/* Define to 1 if you have the `strstr' function. */
+#define HAVE_STRSTR 1
+
+/* Define to 1 if you have the `strtod' function. */
+#define HAVE_STRTOD 1
+
+/* Define to 1 if you have the `strtok_r' function. */
+#define HAVE_STRTOK_R 1
+
+/* Define to 1 if you have the `strtol' function. */
+#define HAVE_STRTOL 1
+
+/* Define to 1 if you have the `strtoll' function. */
+#define HAVE_STRTOLL 1
+
+/* Define to 1 if you have the `strtoul' function. */
+#define HAVE_STRTOUL 1
+
+/* Define to 1 if you have the `strtoull' function. */
+#define HAVE_STRTOULL 1
+
+/* whether you have struct flock */
+#define HAVE_STRUCT_FLOCK 1
+
+/* Define to 1 if `st_blksize' is a member of `struct stat'. */
+#define HAVE_STRUCT_STAT_ST_BLKSIZE 1
+
+/* Define to 1 if `st_blocks' is a member of `struct stat'. */
+#define HAVE_STRUCT_STAT_ST_BLOCKS 1
+
+/* Define to 1 if `st_rdev' is a member of `struct stat'. */
+#define HAVE_STRUCT_STAT_ST_RDEV 1
+
+/* Define to 1 if `tm_zone' is a member of `struct tm'. */
+#define HAVE_STRUCT_TM_TM_ZONE 1
+
+/* Define to 1 if your `struct stat' has `st_blksize'. Deprecated, use
+   `HAVE_STRUCT_STAT_ST_BLKSIZE' instead. */
+#define HAVE_ST_BLKSIZE 1
+
+/* Define to 1 if your `struct stat' has `st_blocks'. Deprecated, use
+   `HAVE_STRUCT_STAT_ST_BLOCKS' instead. */
+#define HAVE_ST_BLOCKS 1
+
+/* Define to 1 if you have the <st.h> header file. */
+/* #undef HAVE_ST_H */
+
+/* Define to 1 if your `struct stat' has `st_rdev'. Deprecated, use
+   `HAVE_STRUCT_STAT_ST_RDEV' instead. */
+#define HAVE_ST_RDEV 1
+
+/* */
+/* #undef HAVE_SYBASE_CT */
+
+/* Define to 1 if you have the `symlink' function. */
+#define HAVE_SYMLINK 1
+
+/* Define if you have the __sync_fetch_and_add function */
+#define HAVE_SYNC_FETCH_AND_ADD 1
+
+/* do we have sysconf? */
+/* #undef HAVE_SYSCONF */
+
+/* Define to 1 if you have the <sysexits.h> header file. */
+#define HAVE_SYSEXITS_H 1
+
+/* Define to 1 if you have the <syslog.h> header file. */
+#define HAVE_SYSLOG_H 1
+
+/* FPM use systemd integration */
+/* #undef HAVE_SYSTEMD */
+
+/* Define to 1 if you have the <systemd/sd-daemon.h> header file. */
+/* #undef HAVE_SYSTEMD_SD_DAEMON_H */
+
+/* */
+/* #undef HAVE_SYSVMSG */
+
+/* */
+/* #undef HAVE_SYSVSEM */
+
+/* */
+/* #undef HAVE_SYSVSHM */
+
+/* Define to 1 if you have the <sys/dir.h> header file, and it defines `DIR'.
+   */
+/* #undef HAVE_SYS_DIR_H */
+
+/* Define to 1 if you have the <sys/file.h> header file. */
+#define HAVE_SYS_FILE_H 1
+
+/* Define to 1 if you have the <sys/ioctl.h> header file. */
+#define HAVE_SYS_IOCTL_H 1
+
+/* Define to 1 if you have the <sys/ipc.h> header file. */
+#define HAVE_SYS_IPC_H 1
+
+/* Define to 1 if you have the <sys/loadavg.h> header file. */
+/* #undef HAVE_SYS_LOADAVG_H */
+
+/* Define to 1 if you have the <sys/mkdev.h> header file. */
+/* #undef HAVE_SYS_MKDEV_H */
+
+/* Define to 1 if you have the <sys/mman.h> header file. */
+#define HAVE_SYS_MMAN_H 1
+
+/* Define to 1 if you have the <sys/mount.h> header file. */
+#define HAVE_SYS_MOUNT_H 1
+
+/* Define to 1 if you have the <sys/ndir.h> header file, and it defines `DIR'.
+   */
+/* #undef HAVE_SYS_NDIR_H */
+
+/* Define to 1 if you have the <sys/param.h> header file. */
+#define HAVE_SYS_PARAM_H 1
+
+/* Define to 1 if you have the <sys/poll.h> header file. */
+#define HAVE_SYS_POLL_H 1
+
+/* Define to 1 if you have the <sys/resource.h> header file. */
+#define HAVE_SYS_RESOURCE_H 1
+
+/* Define to 1 if you have the <sys/sdt.h> header file. */
+/* #undef HAVE_SYS_SDT_H */
+
+/* Define to 1 if you have the <sys/select.h> header file. */
+#define HAVE_SYS_SELECT_H 1
+
+/* Define to 1 if you have the <sys/socket.h> header file. */
+#define HAVE_SYS_SOCKET_H 1
+
+/* Define to 1 if you have the <sys/sockio.h> header file. */
+/* #undef HAVE_SYS_SOCKIO_H */
+
+/* Define to 1 if you have the <sys/statfs.h> header file. */
+#define HAVE_SYS_STATFS_H 1
+
+/* Define to 1 if you have the <sys/statvfs.h> header file. */
+#define HAVE_SYS_STATVFS_H 1
+
+/* Define to 1 if you have the <sys/stat.h> header file. */
+#define HAVE_SYS_STAT_H 1
+
+/* Define to 1 if you have the <sys/sysexits.h> header file. */
+/* #undef HAVE_SYS_SYSEXITS_H */
+
+/* Define to 1 if you have the <sys/times.h> header file. */
+#define HAVE_SYS_TIMES_H 1
+
+/* Define to 1 if you have the <sys/time.h> header file. */
+#define HAVE_SYS_TIME_H 1
+
+/* Define to 1 if you have the <sys/types.h> header file. */
+#define HAVE_SYS_TYPES_H 1
+
+/* Define to 1 if you have the <sys/uio.h> header file. */
+/* #undef HAVE_SYS_UIO_H */
+
+/* Define to 1 if you have the <sys/un.h> header file. */
+#define HAVE_SYS_UN_H 1
+
+/* Define to 1 if you have the <sys/utsname.h> header file. */
+#define HAVE_SYS_UTSNAME_H 1
+
+/* Define to 1 if you have the <sys/varargs.h> header file. */
+/* #undef HAVE_SYS_VARARGS_H */
+
+/* Define to 1 if you have the <sys/vfs.h> header file. */
+#define HAVE_SYS_VFS_H 1
+
+/* Define to 1 if you have the <sys/wait.h> header file. */
+#define HAVE_SYS_WAIT_H 1
+
+/* Define to 1 if you have the `tempnam' function. */
+#define HAVE_TEMPNAM 1
+
+/* Define to 1 if you have the <termios.h> header file. */
+#define HAVE_TERMIOS_H 1
+
+/* */
+/* #undef HAVE_TIDY */
+
+/* */
+/* #undef HAVE_TIDYOPTGETDOC */
+
+/* do we have times? */
+/* #undef HAVE_TIMES */
+
+/* Define to 1 if you have the <time.h> header file. */
+/* #undef HAVE_TIME_H */
+
+/* whether you have tm_gmtoff in struct tm */
+#define HAVE_TM_GMTOFF 1
+
+/* Define to 1 if your `struct tm' has `tm_zone'. Deprecated, use
+   `HAVE_STRUCT_TM_TM_ZONE' instead. */
+#define HAVE_TM_ZONE 1
+
+/* Whether you have a working ttyname_r */
+/* #undef HAVE_TTYNAME_R */
+
+/* Define to 1 if you have the <tuxmodule.h> header file. */
+/* #undef HAVE_TUXMODULE_H */
+
+/* Define to 1 if you don't have `tm_zone' but do have the external array
+   `tzname'. */
+/* #undef HAVE_TZNAME */
+
+/* Define to 1 if you have the `tzset' function. */
+#define HAVE_TZSET 1
+
+/* */
+/* #undef HAVE_UDBCEXT_H */
+
+/* Define if uint32_t type is present. */
+#define HAVE_UINT32_T 1
+
+/* Define to 1 if you have the <unistd.h> header file. */
+#define HAVE_UNISTD_H 1
+
+/* */
+/* #undef HAVE_UNIXODBC */
+
+/* Define to 1 if you have the <unix.h> header file. */
+/* #undef HAVE_UNIX_H */
+
+/* Define to 1 if you have the `unlockpt' function. */
+#define HAVE_UNLOCKPT 1
+
+/* Define to 1 if you have the `unsetenv' function. */
+#define HAVE_UNSETENV 1
+
+/* */
+/* #undef HAVE_UODBC */
+
+/* Define to 1 if you have the `usleep' function. */
+#define HAVE_USLEEP 1
+
+/* Define to 1 if you have the `utime' function. */
+#define HAVE_UTIME 1
+
+/* Define to 1 if you have the `utimes' function. */
+/* #undef HAVE_UTIMES */
+
+/* Define to 1 if you have the <utime.h> header file. */
+#define HAVE_UTIME_H 1
+
+/* Define to 1 if `utime(file, NULL)' sets file's timestamp to the present. */
+#define HAVE_UTIME_NULL 1
+
+/* Whether struct utsname has domainname */
+#define HAVE_UTSNAME_DOMAINNAME 1
+
+/* enable valgrind memchecks */
+/* #undef HAVE_VALGRIND_MEMCHECK_H */
+
+/* Define to 1 if you have the `vasprintf' function. */
+#define HAVE_VASPRINTF 1
+
+/* Define to 1 if you have the `vprintf' function. */
+#define HAVE_VPRINTF 1
+
+/* Define to 1 if you have the `vsnprintf' function. */
+#define HAVE_VSNPRINTF 1
+
+/* Define to 1 if you have the `wait3' function. */
+/* #undef HAVE_WAIT3 */
+
+/* */
+/* #undef HAVE_WAITPID */
+
+/* Define to 1 if you have the <wchar.h> header file. */
+#define HAVE_WCHAR_H 1
+
+/* */
+/* #undef HAVE_WDDX */
+
+/* */
+#define HAVE_XML 1
+
+/* Define to 1 if you have the <xmlparse.h> header file. */
+/* #undef HAVE_XMLPARSE_H */
+
+/* */
+#define HAVE_XMLREADER 1
+
+/* */
+#define HAVE_XMLRPC 1
+
+/* Define to 1 if you have the <xmltok.h> header file. */
+/* #undef HAVE_XMLTOK_H */
+
+/* */
+#define HAVE_XMLWRITER 1
+
+/* */
+/* #undef HAVE_XSL */
+
+/* */
+/* #undef HAVE_XSL_EXSLT */
+
+/* */
+/* #undef HAVE_YP_GET_DEFAULT_DOMAIN */
+
+/* */
+/* #undef HAVE_ZIP */
+
+/* */
+#define HAVE_ZLIB 1
+
+/* whether _controlfp is present usable */
+/* #undef HAVE__CONTROLFP */
+
+/* whether _controlfp_s is present and usable */
+/* #undef HAVE__CONTROLFP_S */
+
+/* whether _FPU_SETCW is present and usable */
+/* #undef HAVE__FPU_SETCW */
+
+/* */
+/* #undef HPUX */
+
+/* */
+#define HSREGEX 1
+
+/* iconv() is aliased to libiconv() in -liconv */
+/* #undef ICONV_ALIASED_LIBICONV */
+
+/* Whether iconv supports error no or not */
+/* #undef ICONV_SUPPORTS_ERRNO */
+
+/* */
+/* #undef ISOLARIS */
+
+/* */
+/* #undef LINUX */
+
+/* Whether asctime_r is declared */
+/* #undef MISSING_ASCTIME_R_DECL */
+
+/* Whether ctime_r is declared */
+/* #undef MISSING_CTIME_R_DECL */
+
+/* */
+#define MISSING_FCLOSE_DECL 0
+
+/* Whether gmtime_r is declared */
+/* #undef MISSING_GMTIME_R_DECL */
+
+/* Whether localtime_r is declared */
+/* #undef MISSING_LOCALTIME_R_DECL */
+
+/* */
+/* #undef MISSING_MSGHDR_MSGFLAGS */
+
+/* Whether strtok_r is declared */
+/* #undef MISSING_STRTOK_R_DECL */
+
+/* Whether mysqlnd is enabled */
+/* #undef MYSQLI_USE_MYSQLND */
+
+/* Enable compressed protocol support */
+/* #undef MYSQLND_COMPRESSION_WANTED */
+
+/* Enable SSL support */
+/* #undef MYSQLND_SSL_SUPPORTED */
+
+/* Whether mysqlnd is enabled */
+/* #undef MYSQL_USE_MYSQLND */
+
+/* */
+/* #undef NDBM_INCLUDE_FILE */
+
+/* */
+/* #undef NEUTRINO */
+
+/* Define to 1 if your C compiler doesn't accept -c and -o together. */
+/* #undef NO_MINUS_C_MINUS_O */
+
+/* Define to the address where bug reports for this package should be sent. */
+#define PACKAGE_BUGREPORT ""
+
+/* Define to the full name of this package. */
+#define PACKAGE_NAME ""
+
+/* Define to the full name and version of this package. */
+#define PACKAGE_STRING ""
+
+/* Define to the one symbol short name of this package. */
+#define PACKAGE_TARNAME ""
+
+/* Define to the home page for this package. */
+#define PACKAGE_URL ""
+
+/* Define to the version of this package. */
+#define PACKAGE_VERSION ""
+
+/* */
+/* #undef PDO_MYSQL_UNIX_ADDR */
+
+/* Whether pdo_mysql uses mysqlnd */
+/* #undef PDO_USE_MYSQLND */
+
+/* */
+/* #undef PHAR_HASH_OK */
+
+/* */
+/* #undef PHAR_HAVE_OPENSSL */
+
+/* */
+/* #undef PHP_APACHE_HAVE_CLIENT_FD */
+
+/* Whether the system supports BlowFish salt */
+#define PHP_BLOWFISH_CRYPT 1
+
+/* PHP build date */
+#define PHP_BUILD_DATE "2013-09-04"
+
+/* Define if your system has fork/vfork/CreateProcess */
+#define PHP_CAN_SUPPORT_PROC_OPEN 1
+
+/* */
+/* #undef PHP_CURL_URL_WRAPPERS */
+
+/* Whether the system supports extended DES salt */
+#define PHP_EXT_DES_CRYPT 1
+
+/* fpm group name */
+/* #undef PHP_FPM_GROUP */
+
+/* fpm systemd service type */
+/* #undef PHP_FPM_SYSTEMD */
+
+/* fpm user name */
+/* #undef PHP_FPM_USER */
+
+/* Whether you have HP-UX 10.x */
+/* #undef PHP_HPUX_TIME_R */
+
+/* Path to iconv.h */
+/* #undef PHP_ICONV_H_PATH */
+
+/* Which iconv implementation to use */
+/* #undef PHP_ICONV_IMPL */
+
+/* Whether you have IRIX-style functions */
+/* #undef PHP_IRIX_TIME_R */
+
+/* Whether the system supports MD5 salt */
+#define PHP_MD5_CRYPT 1
+
+/* */
+#define PHP_MHASH_BC 1
+
+/* */
+/* #undef PHP_MYSQL_UNIX_SOCK_ADDR */
+
+/* */
+/* #undef PHP_OCI8_DEF_DIR */
+
+/* */
+/* #undef PHP_OCI8_DEF_SHARED_LIBADD */
+
+/* define to 1 if oniguruma has an invalid entry for KOI8 encoding */
+/* #undef PHP_ONIG_BAD_KOI8_ENTRY */
+
+/* Define to 1 if the bundled oniguruma is used */
+#define PHP_ONIG_BUNDLED 1
+
+/* uname output */
+#define PHP_OS "Linux"
+
+/* */
+/* #undef PHP_PDO_OCI_CLIENT_VERSION */
+
+/* whether pread64 is default */
+/* #undef PHP_PREAD_64 */
+
+/* whether pwrite64 is default */
+/* #undef PHP_PWRITE_64 */
+
+/* Whether the system supports SHA256 salt */
+#define PHP_SHA256_CRYPT 1
+
+/* Whether the system supports SHA512 salt */
+#define PHP_SHA512_CRYPT 1
+
+/* */
+#define PHP_SIGCHILD 0
+
+/* Whether the system supports standard DES salt */
+#define PHP_STD_DES_CRYPT 1
+
+/* uname -a output */
+#define PHP_UNAME "Linux dh-builder 3.2.0-4-686-pae #1 SMP Debian 3.2.46-1 i686 GNU/Linux"
+
+/* Whether PHP has to use its own crypt_r for blowfish, des and ext des */
+#define PHP_USE_PHP_CRYPT_R 1
+
+/* whether write(2) works */
+/* #undef PHP_WRITE_STDOUT */
+
+/* /proc/pid/mem interface */
+/* #undef PROC_MEM_FILE */
+
+/* Whether to use Pthreads */
+/* #undef PTHREADS */
+
+/* */
+/* #undef QDBM_INCLUDE_FILE */
+
+/* */
+#define REGEX 1
+
+/* Define as the return type of signal handlers (`int' or `void'). */
+#define RETSIGTYPE void
+
+/* Whether to use Roxen in ZTS mode */
+/* #undef ROXEN_USE_ZTS */
+
+/* The size of `char', as computed by sizeof. */
+#define SIZEOF_CHAR 1
+
+/* The size of `int', as computed by sizeof. */
+#define SIZEOF_INT 4
+
+/* Size of intmax_t */
+/* #undef SIZEOF_INTMAX_T */
+
+/* The size of `long', as computed by sizeof. */
+#define SIZEOF_LONG 4
+
+/* The size of `long int', as computed by sizeof. */
+/* #undef SIZEOF_LONG_INT */
+
+/* The size of `long long', as computed by sizeof. */
+#define SIZEOF_LONG_LONG 8
+
+/* The size of `long long int', as computed by sizeof. */
+#define SIZEOF_LONG_LONG_INT 8
+
+/* Size of ptrdiff_t */
+#define SIZEOF_PTRDIFF_T 8
+
+/* The size of `short', as computed by sizeof. */
+#define SIZEOF_SHORT 2
+
+/* The size of `size_t', as computed by sizeof. */
+#define SIZEOF_SIZE_T 4
+
+/* Size of ssize_t */
+#define SIZEOF_SSIZE_T 8
+
+/* */
+/* #undef SOLARIS */
+
+/* have sqlite3 with column metadata enabled */
+/* #undef SQLITE_ENABLE_COLUMN_METADATA */
+
+/* have sqlite3 with extension support */
+/* #undef SQLITE_OMIT_LOAD_EXTENSION */
+
+/* Needed in sqlunix.h for wchar defs */
+/* #undef SS_FBX */
+
+/* Needed in sqlunix.h */
+/* #undef SS_LINUX */
+
+/* If using the C implementation of alloca, define if you know the
+   direction of stack growth for your system; otherwise it will be
+   automatically deduced at runtime.
+	STACK_DIRECTION > 0 => grows toward higher addresses
+	STACK_DIRECTION < 0 => grows toward lower addresses
+	STACK_DIRECTION = 0 => direction of growth unknown */
+/* #undef STACK_DIRECTION */
+
+/* Define to 1 if you have the ANSI C header files. */
+#define STDC_HEADERS 1
+
+/* */
+/* #undef TCADB_INCLUDE_FILE */
+
+/* Define to 1 if you can safely include both <sys/time.h> and <time.h>. */
+#define TIME_WITH_SYS_TIME 1
+
+/* Define to 1 if your <sys/time.h> declares `struct tm'. */
+/* #undef TM_IN_SYS_TIME */
+
+/* */
+/* #undef TSRM_ST */
+
+/* */
+#define UNDEF_THREADS_HACK /**/
+
+/* */
+/* #undef UNIXWARE */
+
+/* whether to check multibyte regex backtrack */
+#define USE_COMBINATION_EXPLOSION_CHECK 1
+
+/* */
+/* #undef USE_GD_IMGSTRTTF */
+
+/* */
+/* #undef USE_GD_JISX0208 */
+
+/* Define if cross-process locking is required by accept() */
+/* #undef USE_LOCKING */
+
+/* Enable extensions on AIX 3, Interix.  */
+#ifndef _ALL_SOURCE
+# define _ALL_SOURCE 1
+#endif
+/* Enable GNU extensions on systems that have them.  */
+#ifndef _GNU_SOURCE
+# define _GNU_SOURCE 1
+#endif
+/* Enable threading extensions on Solaris.  */
+#ifndef _POSIX_PTHREAD_SEMANTICS
+# define _POSIX_PTHREAD_SEMANTICS 1
+#endif
+/* Enable extensions on HP NonStop.  */
+#ifndef _TANDEM_SOURCE
+# define _TANDEM_SOURCE 1
+#endif
+/* Enable general extensions on Solaris.  */
+#ifndef __EXTENSIONS__
+# define __EXTENSIONS__ 1
+#endif
+
+
+/* */
+/* #undef USE_TRANSFER_TABLES */
+
+/* whether you want Pi3Web support */
+/* #undef WITH_PI3WEB */
+
+/* */
+/* #undef WITH_ZEUS */
+
+/* Define if processor uses big-endian word */
+/* #undef WORDS_BIGENDIAN */
+
+/* Whether sprintf is broken */
+#define ZEND_BROKEN_SPRINTF 0
+
+/* */
+#define ZEND_DEBUG 0
+
+/* Define if double cast to long preserves least significant bits */
+/* #undef ZEND_DVAL_TO_LVAL_CAST_OK */
+
+/* */
+/* #undef ZEND_MM_ALIGNMENT */
+
+/* */
+/* #undef ZEND_MM_ALIGNMENT_LOG2 */
+
+/* Use zend signal handling */
+/* #undef ZEND_SIGNALS */
+
+/* virtual machine dispatch method */
+#define ZEND_VM_KIND ZEND_VM_KIND_CALL
+
+/* */
+/* #undef ZTS */
+
+/* Define to 1 if on MINIX. */
+/* #undef _MINIX */
+
+/* Define to 2 if the system does not provide POSIX.1 features except with
+   this defined. */
+/* #undef _POSIX_1_SOURCE */
+
+/* Define to 1 if you need to in order for `stat' and other things to work. */
+/* #undef _POSIX_SOURCE */
+
+/* */
+/* #undef __DEBUG_APC__ */
+
+/* Define to empty if `const' does not conform to ANSI C. */
+/* #undef const */
+
+/* Define to `int' if <sys/types.h> doesn't define. */
+/* #undef gid_t */
+
+/* */
+/* #undef in_addr_t */
+
+/* Define to `__inline__' or `__inline' if that's what the C compiler
+   calls it, or to nothing if 'inline' is not supported under any name.  */
+#ifndef __cplusplus
+/* #undef inline */
+#endif
+
+/* Define to `unsigned int' if <sys/types.h> does not define. */
+/* #undef size_t */
+
+/* Define to `int' if <sys/types.h> doesn't define. */
+/* #undef uid_t */
+
+/* Define to `unsigned int ' if <sys/types.h> does not define. */
+/* #undef uint */
+
+/* Define to `unsigned long ' if <sys/types.h> does not define. */
+/* #undef ulong */
+
+
+#ifndef ZEND_ACCONFIG_H_NO_C_PROTOS
+
+#ifdef HAVE_STDLIB_H
+# include <stdlib.h>
+#endif
+
+#ifdef HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+
+#ifdef HAVE_SYS_SELECT_H
+#include <sys/select.h>
+#endif
+
+#ifdef HAVE_IEEEFP_H
+# include <ieeefp.h>
+#endif
+
+#ifdef HAVE_STRING_H
+# include <string.h>
+#else
+# include <strings.h>
+#endif
+
+#if ZEND_BROKEN_SPRINTF
+int zend_sprintf(char *buffer, const char *format, ...);
+#else
+# define zend_sprintf sprintf
+#endif
+
+#include <math.h>
+
+/* To enable the is_nan, is_infinite and is_finite PHP functions */
+#ifdef NETWARE
+	#define HAVE_ISNAN 1
+	#define HAVE_ISINF 1
+	#define HAVE_ISFINITE 1
+#endif
+
+#ifndef zend_isnan
+#ifdef HAVE_ISNAN
+#define zend_isnan(a) isnan(a)
+#elif defined(HAVE_FPCLASS)
+#define zend_isnan(a) ((fpclass(a) == FP_SNAN) || (fpclass(a) == FP_QNAN))
+#else
+#define zend_isnan(a) 0
+#endif
+#endif
+
+#ifdef HAVE_ISINF
+#define zend_isinf(a) isinf(a)
+#elif defined(INFINITY)
+/* Might not work, but is required by ISO C99 */
+#define zend_isinf(a) (((a)==INFINITY)?1:0)
+#elif defined(HAVE_FPCLASS)
+#define zend_isinf(a) ((fpclass(a) == FP_PINF) || (fpclass(a) == FP_NINF))
+#else
+#define zend_isinf(a) 0
+#endif
+
+#ifdef HAVE_FINITE
+#define zend_finite(a) finite(a)
+#elif defined(HAVE_ISFINITE) || defined(isfinite)
+#define zend_finite(a) isfinite(a)
+#elif defined(fpclassify)
+#define zend_finite(a) ((fpclassify((a))!=FP_INFINITE&&fpclassify((a))!=FP_NAN)?1:0)
+#else
+#define zend_finite(a) (zend_isnan(a) ? 0 : zend_isinf(a) ? 0 : 1)
+#endif
+
+#endif /* ifndef ZEND_ACCONFIG_H_NO_C_PROTOS */
+
+#ifdef NETWARE
+#ifdef USE_WINSOCK
+#/*This detection against winsock is of no use*/ undef HAVE_SOCKLEN_T
+#/*This detection against winsock is of no use*/ undef HAVE_SYS_SOCKET_H
+#endif
+#endif
+
+/* #undef PTHREADS */
+
diff -Nru php-5.4.19/main/php_config.h.in php-5.4.19.bak.ori/main/php_config.h.in
--- php-5.4.19/main/php_config.h.in	2013-08-20 13:14:44.000000000 +0800
+++ php-5.4.19.bak.ori/main/php_config.h.in	2013-08-28 17:05:07.000000000 +0800
@@ -21,6 +21,33 @@
 /* */
 #undef AIX
 
+/* */
+#undef APC_FCNTL_LOCKS
+
+/* */
+#undef APC_FILEHITS
+
+/* */
+#undef APC_HAVE_LOOKUP_HOOKS
+
+/* shm/mmap memory protection */
+#undef APC_MEMPROTECT
+
+/* */
+#undef APC_MMAP
+
+/* */
+#undef APC_PTHREADMUTEX_LOCKS
+
+/* */
+#undef APC_PTHREADRW_LOCKS
+
+/* */
+#undef APC_SEM_LOCKS
+
+/* */
+#undef APC_SPIN_LOCKS
+
 /* Whether to use native BeOS threads */
 #undef BETHREADS
 
@@ -30,6 +57,9 @@
 /* Define if system uses EBCDIC */
 #undef CHARSET_EBCDIC
 
+/* Whether to build apc as dynamic module */
+#undef COMPILE_DL_APC
+
 /* Whether to build bcmath as dynamic module */
 #undef COMPILE_DL_BCMATH
 
@@ -393,6 +423,9 @@
 /* */
 #undef HAVE_APACHE_HOOKS
 
+/* */
+#undef HAVE_APC
+
 /* Define to 1 if you have the <ApplicationServices/ApplicationServices.h>
    header file. */
 #undef HAVE_APPLICATIONSERVICES_APPLICATIONSERVICES_H
@@ -436,6 +469,9 @@
 /* Define to 1 if you have the <atomic.h> header file. */
 #undef HAVE_ATOMIC_H
 
+/* Define this if your target compiler supports builtin atomics */
+#undef HAVE_ATOMIC_OPERATIONS
+
 /* whether the compiler supports __attribute__ ((__aligned__)) */
 #undef HAVE_ATTRIBUTE_ALIGNED
 
@@ -1988,6 +2024,9 @@
 /* Whether struct utsname has domainname */
 #undef HAVE_UTSNAME_DOMAINNAME
 
+/* enable valgrind memchecks */
+#undef HAVE_VALGRIND_MEMCHECK_H
+
 /* Define to 1 if you have the `vasprintf' function. */
 #undef HAVE_VASPRINTF
 
@@ -2409,6 +2448,9 @@
 /* Define to 1 if you need to in order for `stat' and other things to work. */
 #undef _POSIX_SOURCE
 
+/* */
+#undef __DEBUG_APC__
+
 /* Define to empty if `const' does not conform to ANSI C. */
 #undef const
 
