diff -Naur libupnp-1.6.6/autoconfig.h.in libupnp-1.6.6-mod/autoconfig.h.in
--- libupnp-1.6.6/autoconfig.h.in	2008-04-25 19:47:30.000000000 +0800
+++ libupnp-1.6.6-mod/autoconfig.h.in	2014-02-11 11:05:28.000000000 +0800
@@ -105,6 +105,9 @@
 /* Define to the one symbol short name of this package. */
 #undef PACKAGE_TARNAME
 
+/* Define to the home page for this package. */
+#undef PACKAGE_URL
+
 /* Define to the version of this package. */
 #undef PACKAGE_VERSION
 
diff -Naur libupnp-1.6.6/build-aux/config.guess libupnp-1.6.6-mod/build-aux/config.guess
--- libupnp-1.6.6/build-aux/config.guess	2008-04-25 19:47:43.000000000 +0800
+++ libupnp-1.6.6-mod/build-aux/config.guess	2014-02-11 11:03:35.000000000 +0800
@@ -4,7 +4,7 @@
 #   2000, 2001, 2002, 2003, 2004, 2005, 2006 Free Software Foundation,
 #   Inc.
 
-timestamp='2006-05-13'
+timestamp='2009-07-24'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -139,15 +139,22 @@
 UNAME_SYSTEM=`(uname -s) 2>/dev/null`  || UNAME_SYSTEM=unknown
 UNAME_VERSION=`(uname -v) 2>/dev/null` || UNAME_VERSION=unknown
 
-case "${UNAME_MACHINE}" in
-    i?86)
-	test -z "$VENDOR" && VENDOR=pc
-	;;
-    *)
-	test -z "$VENDOR" && VENDOR=unknown
-	;;
-esac
-test -f /etc/SuSE-release -o -f /.buildenv && VENDOR=suse
+if [ "${UNAME_SYSTEM}" = "Linux" ] ; then
+	eval $set_cc_for_build
+	cat << EOF > $dummy.c
+	#include <features.h>
+	#ifdef __UCLIBC__
+	# ifdef __UCLIBC_CONFIG_VERSION__
+	LIBC=uclibc __UCLIBC_CONFIG_VERSION__
+	# else
+	LIBC=uclibc
+	# endif
+	#else
+	LIBC=gnu
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep LIBC= | sed -e 's: ::g'`
+fi
 
 # Note: order is significant - the case branches are not exclusive.
 
@@ -171,6 +178,7 @@
 	    arm*) machine=arm-unknown ;;
 	    sh3el) machine=shl-unknown ;;
 	    sh3eb) machine=sh-unknown ;;
+	    sh5el) machine=sh5le-unknown ;;
 	    *) machine=${UNAME_MACHINE_ARCH}-unknown ;;
 	esac
 	# The Operating System including object format, if it has switched
@@ -221,7 +229,7 @@
 	echo ${UNAME_MACHINE}-unknown-solidbsd${UNAME_RELEASE}
 	exit ;;
     macppc:MirBSD:*:*)
-	echo powerppc-unknown-mirbsd${UNAME_RELEASE}
+	echo powerpc-unknown-mirbsd${UNAME_RELEASE}
 	exit ;;
     *:MirBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-mirbsd${UNAME_RELEASE}
@@ -339,7 +347,7 @@
     sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)
 	echo sparc-sun-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit ;;
-    i86pc:SunOS:5.*:*)
+    i86pc:SunOS:5.*:* | i86xen:SunOS:5.*:*)
 	echo i386-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit ;;
     sun4*:SunOS:6*:*)
@@ -790,7 +798,7 @@
     i*:CYGWIN*:*)
 	echo ${UNAME_MACHINE}-pc-cygwin
 	exit ;;
-    i*:MINGW*:*)
+    *:MINGW*:*)
 	echo ${UNAME_MACHINE}-pc-mingw32
 	exit ;;
     i*:windows32*:*)
@@ -800,12 +808,15 @@
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
 	exit ;;
-    x86:Interix*:[345]*)
-	echo i586-pc-interix${UNAME_RELEASE}
-	exit ;;
-    EM64T:Interix*:[345]*)
-	echo x86_64-unknown-interix${UNAME_RELEASE}
-	exit ;;
+    *:Interix*:[3456]*)
+    	case ${UNAME_MACHINE} in
+	    x86)
+		echo i586-pc-interix${UNAME_RELEASE}
+		exit ;;
+	    EM64T | authenticamd)
+		echo x86_64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	esac ;;
     [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
 	echo i${UNAME_MACHINE}-pc-mks
 	exit ;;
@@ -839,25 +850,28 @@
 	echo ${UNAME_MACHINE}-pc-minix
 	exit ;;
     arm*:Linux:*:*)
-	echo ${UNAME_MACHINE}-${VENDOR}-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
+	exit ;;
+    avr32*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     cris:Linux:*:*)
-	echo cris-axis-linux-gnu
+	echo cris-axis-linux-${LIBC}
 	exit ;;
     crisv32:Linux:*:*)
-	echo crisv32-axis-linux-gnu
+	echo crisv32-axis-linux-${LIBC}
 	exit ;;
     frv:Linux:*:*)
-    	echo frv-${VENDOR}-linux-gnu
+    	echo frv-unknown-linux-${LIBC}
 	exit ;;
     ia64:Linux:*:*)
-	echo ${UNAME_MACHINE}-${VENDOR}-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     m32r*:Linux:*:*)
-	echo ${UNAME_MACHINE}-${VENDOR}-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     m68*:Linux:*:*)
-	echo ${UNAME_MACHINE}-${VENDOR}-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     mips:Linux:*:*)
 	eval $set_cc_for_build
@@ -880,7 +894,7 @@
 		s: ::g
 		p
 	    }'`"
-	test x"${CPU}" != x && { echo "${CPU}-${VENDOR}-linux-gnu"; exit; }
+	test x"${CPU}" != x && { echo "${CPU}-unknown-linux-${LIBC}"; exit; }
 	;;
     mips64:Linux:*:*)
 	eval $set_cc_for_build
@@ -903,16 +917,16 @@
 		s: ::g
 		p
 	    }'`"
-	test x"${CPU}" != x && { echo "${CPU}-${VENDOR}-linux-gnu"; exit; }
+	test x"${CPU}" != x && { echo "${CPU}-unknown-linux-${LIBC}"; exit; }
 	;;
     or32:Linux:*:*)
-	echo or32-${VENDOR}-linux-gnu
+	echo or32-unknown-linux-${LIBC}
 	exit ;;
     ppc:Linux:*:*)
-	echo powerpc-${VENDOR}-linux-gnu
+	echo powerpc-unknown-linux-${LIBC}
 	exit ;;
     ppc64:Linux:*:*)
-	echo powerpc64-${VENDOR}-linux-gnu
+	echo powerpc64-unknown-linux-${LIBC}
 	exit ;;
     alpha:Linux:*:*)
 	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' < /proc/cpuinfo` in
@@ -925,37 +939,40 @@
 	  EV68*) UNAME_MACHINE=alphaev68 ;;
         esac
 	objdump --private-headers /bin/sh | grep ld.so.1 >/dev/null
-	if test "$?" = 0 ; then LIBC="libc1" ; else LIBC="" ; fi
-	echo ${UNAME_MACHINE}-${VENDOR}-linux-gnu${LIBC}
+	if test "$?" = 0 ; then LIBC="gnulibc1" ; fi
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     parisc:Linux:*:* | hppa:Linux:*:*)
 	# Look for CPU level
 	case `grep '^cpu[^a-z]*:' /proc/cpuinfo 2>/dev/null | cut -d' ' -f2` in
-	  PA7*) echo hppa1.1-${VENDOR}-linux-gnu ;;
-	  PA8*) echo hppa2.0-${VENDOR}-linux-gnu ;;
-	  *)    echo hppa-${VENDOR}-linux-gnu ;;
+	  PA7*) echo hppa1.1-unknown-linux-${LIBC} ;;
+	  PA8*) echo hppa2.0-unknown-linux-${LIBC} ;;
+	  *)    echo hppa-unknown-linux-${LIBC} ;;
 	esac
 	exit ;;
     parisc64:Linux:*:* | hppa64:Linux:*:*)
-	echo hppa64-${VENDOR}-linux-gnu
+	echo hppa64-unknown-linux-${LIBC}
 	exit ;;
     s390:Linux:*:* | s390x:Linux:*:*)
 	echo ${UNAME_MACHINE}-ibm-linux
 	exit ;;
     sh64*:Linux:*:*)
-    	echo ${UNAME_MACHINE}-${VENDOR}-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     sh*:Linux:*:*)
-	echo ${UNAME_MACHINE}-${VENDOR}-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     sparc:Linux:*:* | sparc64:Linux:*:*)
-	echo ${UNAME_MACHINE}-${VENDOR}-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     vax:Linux:*:*)
-	echo ${UNAME_MACHINE}-dec-linux-gnu
+	echo ${UNAME_MACHINE}-dec-linux-${LIBC}
 	exit ;;
     x86_64:Linux:*:*)
-	echo x86_64-${VENDOR}-linux-gnu
+	echo x86_64-unknown-linux-${LIBC}
+	exit ;;
+    xtensa*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-${LIBC}
 	exit ;;
     i*86:Linux:*:*)
 	# The BFD linker knows what the default object file format is, so
@@ -970,20 +987,22 @@
 				    p'`
         case "$ld_supported_targets" in
 	  elf32-i386)
-		TENTATIVE="${UNAME_MACHINE}-${VENDOR}-linux-gnu"
+		TENTATIVE="${UNAME_MACHINE}-pc-linux-${LIBC}"
 		;;
 	  a.out-i386-linux)
-		echo "${UNAME_MACHINE}-${VENDOR}-linux-gnuaout"
+		echo "${UNAME_MACHINE}-pc-linux-${LIBC}aout"
 		exit ;;
 	  coff-i386)
-		echo "${UNAME_MACHINE}-${VENDOR}-linux-gnucoff"
+		echo "${UNAME_MACHINE}-pc-linux-${LIBC}coff"
 		exit ;;
 	  "")
 		# Either a pre-BFD a.out linker (linux-gnuoldld) or
 		# one that does not give us useful --help.
-		echo "${UNAME_MACHINE}-${VENDOR}-linux-gnuoldld"
+		echo "${UNAME_MACHINE}-pc-linux-${LIBC}oldld"
 		exit ;;
 	esac
+	# This should get integrated into the C code below, but now we hack
+	if [ "$LIBC" != "gnu" ] ; then echo "$TENTATIVE" && exit 0 ; fi
 	# Determine whether the default compiler is a.out or elf
 	eval $set_cc_for_build
 	sed 's/^	//' << EOF >$dummy.c
@@ -1015,7 +1034,7 @@
 		p
 	    }'`"
 	test x"${LIBC}" != x && {
-		echo "${UNAME_MACHINE}-${VENDOR}-linux-${LIBC}"
+		echo "${UNAME_MACHINE}-pc-linux-${LIBC}"
 		exit
 	}
 	test x"${TENTATIVE}" != x && { echo "${TENTATIVE}"; exit; }
@@ -1215,6 +1234,15 @@
     SX-6:SUPER-UX:*:*)
 	echo sx6-nec-superux${UNAME_RELEASE}
 	exit ;;
+    SX-7:SUPER-UX:*:*)
+	echo sx7-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8:SUPER-UX:*:*)
+	echo sx8-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8R:SUPER-UX:*:*)
+	echo sx8r-nec-superux${UNAME_RELEASE}
+	exit ;;
     Power*:Rhapsody:*:*)
 	echo powerpc-apple-rhapsody${UNAME_RELEASE}
 	exit ;;
diff -Naur libupnp-1.6.6/build-aux/config.sub libupnp-1.6.6-mod/build-aux/config.sub
--- libupnp-1.6.6/build-aux/config.sub	2008-04-25 19:47:43.000000000 +0800
+++ libupnp-1.6.6-mod/build-aux/config.sub	2014-02-11 11:03:35.000000000 +0800
@@ -4,7 +4,7 @@
 #   2000, 2001, 2002, 2003, 2004, 2005, 2006 Free Software Foundation,
 #   Inc.
 
-timestamp='2006-05-13'
+timestamp='2007-06-28'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -121,6 +121,7 @@
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
   nto-qnx* | linux-gnu* | linux-dietlibc | linux-newlib* | linux-uclibc* | \
+  gnu*-uclibc* | \
   uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | \
   storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
@@ -241,16 +242,16 @@
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
 	| am33_2.0 \
-	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr \
+	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr | avr32 \
 	| bfin \
 	| c4x | clipper \
-	| d10v | d30v | dlx | dsp16xx \
-	| fr30 | frv \
+	| d10v | d30v | dlx | dsp16xx | dvp \
+	| fido | fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
 	| i370 | i860 | i960 | ia64 \
 	| ip2k | iq2000 \
 	| m32c | m32r | m32rle | m68000 | m68k | m88k \
-	| maxq | mb | microblaze | mcore \
+	| maxq | mb | microblaze | mcore | mep \
 	| mips | mipsbe | mipseb | mipsel | mipsle \
 	| mips16 \
 	| mips64 | mips64el \
@@ -276,7 +277,8 @@
 	| pdp10 | pdp11 | pj | pjl \
 	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
 	| pyramid \
-	| sh | sh[1234] | sh[24]a | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
+	| score \
+	| sh | sh[1234] | sh[24]a | sh[24]a*eb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
 	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
 	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
@@ -284,7 +286,7 @@
 	| tahoe | thumb | tic4x | tic80 | tron \
 	| v850 | v850e \
 	| we32k \
-	| x86 | xscale | xscalee[bl] | xstormy16 | xtensa \
+	| x86 | xc16x | xscale | xscalee[bl] | xstormy16 | xtensa \
 	| z8k)
 		basic_machine=$basic_machine-unknown
 		;;
@@ -317,13 +319,13 @@
 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
-	| avr-* \
+	| avr-* | avr32-* \
 	| bfin-* | bs2000-* \
 	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
 	| clipper-* | craynv-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
-	| f30[01]-* | f700-* | fr30-* | frv-* | fx80-* \
+	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
 	| i*86-* | i860-* | i960-* | ia64-* \
@@ -357,7 +359,7 @@
 	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
 	| pyramid-* \
 	| romp-* | rs6000-* \
-	| sh-* | sh[1234]-* | sh[24]a-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
+	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]a*eb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
 	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
 	| sparclite-* \
@@ -367,11 +369,15 @@
 	| tron-* \
 	| v850-* | v850e-* | vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xps100-* | xscale-* | xscalee[bl]-* \
-	| xstormy16-* | xtensa-* \
+	| x86-* | x86_64-* | xc16x-* | xps100-* | xscale-* | xscalee[bl]-* \
+	| xstormy16-* | xtensa*-* \
 	| ymp-* \
 	| z8k-*)
 		;;
+	# Recognize the basic CPU types without company name, with glob match.
+	xtensa*)
+		basic_machine=$basic_machine-unknown
+		;;
 	# Recognize the various machine names and aliases which stand
 	# for a CPU type and a company and sometimes even an OS.
 	386bsd)
@@ -474,8 +480,8 @@
 		basic_machine=craynv-cray
 		os=-unicosmp
 		;;
-	cr16c)
-		basic_machine=cr16c-unknown
+	cr16)
+		basic_machine=cr16-unknown
 		os=-elf
 		;;
 	crds | unos)
@@ -682,6 +688,10 @@
 		basic_machine=i386-pc
 		os=-mingw32
 		;;
+	mingw32ce)
+		basic_machine=arm-unknown
+		os=-mingw32ce
+		;;
 	miniframe)
 		basic_machine=m68000-convergent
 		;;
@@ -689,6 +699,24 @@
 		basic_machine=m68k-atari
 		os=-mint
 		;;
+	mipsEE* | ee | ps2)
+		basic_machine=mips64r5900el-scei
+		case $os in
+		    -linux*)
+			;;
+		    *)
+			os=-elf
+			;;
+		esac
+		;;
+	iop)
+		basic_machine=mipsel-scei
+		os=-irx
+		;;
+	dvp)
+		basic_machine=dvp-scei
+		os=-elf
+		;;
 	mips3*-*)
 		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`
 		;;
@@ -909,6 +937,10 @@
 	sb1el)
 		basic_machine=mipsisa64sb1el-unknown
 		;;
+	sde)
+		basic_machine=mipsisa32-sde
+		os=-elf
+		;;
 	sei)
 		basic_machine=mips-sei
 		os=-seiux
@@ -920,6 +952,9 @@
 		basic_machine=sh-hitachi
 		os=-hms
 		;;
+	sh5el)
+		basic_machine=sh5le-unknown
+		;;
 	sh64)
 		basic_machine=sh64-unknown
 		;;
@@ -1207,6 +1242,7 @@
 	      | -chorusos* | -chorusrdb* \
 	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
 	      | -mingw32* | -linux-gnu* | -linux-newlib* | -linux-uclibc* \
+	      | -gnu*-uclibc* \
 	      | -uxpv* | -beos* | -mpeix* | -udk* \
 	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
@@ -1214,7 +1250,7 @@
 	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
 	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
 	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly* \
-	      | -skyos* | -haiku* | -rdos*)
+	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -irx*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
 	-qnx*)
@@ -1366,6 +1402,9 @@
 # system, and we'll never get to this point.
 
 case $basic_machine in
+        score-*)
+		os=-elf
+		;;
         spu-*)
 		os=-elf
 		;;
@@ -1406,6 +1445,9 @@
 	m68*-cisco)
 		os=-aout
 		;;
+        mep-*)
+		os=-elf
+		;;
 	mips*-cisco)
 		os=-elf
 		;;
diff -Naur libupnp-1.6.6/configure libupnp-1.6.6-mod/configure
--- libupnp-1.6.6/configure	2008-04-25 19:47:24.000000000 +0800
+++ libupnp-1.6.6-mod/configure	2014-02-11 11:05:21.000000000 +0800
@@ -1,59 +1,86 @@
 #! /bin/sh
 # From configure.ac Revision: 1.11 .
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.60 for libupnp 1.6.6.
+# Generated by GNU Autoconf 2.68 for libupnp 1.6.6.
 #
 # Report bugs to <mroberto@users.sourceforge.net>.
 #
+#
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006 Free Software Foundation, Inc.
+# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free Software
+# Foundation, Inc.
+#
+#
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
 
-# Be Bourne compatible
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+# Be more Bourne compatible
+DUALCASE=1; export DUALCASE # for MKS sh
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
-  # Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
+  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
   # is contrary to our usage.  Disable this feature.
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in *posix*) set -o posix;; esac
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
+esac
 fi
-BIN_SH=xpg4; export BIN_SH # for Tru64
-DUALCASE=1; export DUALCASE # for MKS sh
-
 
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
 
-# The user is always right.
-if test "${PATH_SEPARATOR+set}" != set; then
-  echo "#! /bin/sh" >conf$$.sh
-  echo  "exit 0"   >>conf$$.sh
-  chmod +x conf$$.sh
-  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
-    PATH_SEPARATOR=';'
-  else
-    PATH_SEPARATOR=:
+as_nl='
+'
+export as_nl
+# Printing a long string crashes Solaris 7 /usr/bin/printf.
+as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
+as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='printf %s\n'
+  as_echo_n='printf %s'
+else
+  if test "X`(/usr/ucb/echo -n -n $as_echo) 2>/dev/null`" = "X-n $as_echo"; then
+    as_echo_body='eval /usr/ucb/echo -n "$1$as_nl"'
+    as_echo_n='/usr/ucb/echo -n'
+  else
+    as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
+    as_echo_n_body='eval
+      arg=$1;
+      case $arg in #(
+      *"$as_nl"*)
+	expr "X$arg" : "X\\(.*\\)$as_nl";
+	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
+      esac;
+      expr "X$arg" : "X\\(.*\\)" | tr -d "$as_nl"
+    '
+    export as_echo_n_body
+    as_echo_n='sh -c $as_echo_n_body as_echo'
   fi
-  rm -f conf$$.sh
+  export as_echo_body
+  as_echo='sh -c $as_echo_body as_echo'
 fi
 
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  as_unset=unset
-else
-  as_unset=false
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  PATH_SEPARATOR=:
+  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
+    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
+      PATH_SEPARATOR=';'
+  }
 fi
 
 
@@ -62,20 +89,19 @@
 # there to prevent editors from complaining about space-tab.
 # (If _AS_PATH_WALK were called with IFS unset, it would disable word
 # splitting by setting IFS to empty value.)
-as_nl='
-'
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
+as_myself=
+case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-done
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
 IFS=$as_save_IFS
 
      ;;
@@ -86,352 +112,329 @@
   as_myself=$0
 fi
 if test ! -f "$as_myself"; then
-  echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  { (exit 1); exit 1; }
+  $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
+  exit 1
 fi
 
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
 done
 PS1='$ '
 PS2='> '
 PS4='+ '
 
 # NLS nuisances.
-for as_var in \
-  LANG LANGUAGE LC_ADDRESS LC_ALL LC_COLLATE LC_CTYPE LC_IDENTIFICATION \
-  LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER \
-  LC_TELEPHONE LC_TIME
-do
-  if (set +x; test -z "`(eval $as_var=C; export $as_var) 2>&1`"); then
-    eval $as_var=C; export $as_var
-  else
-    ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
-  fi
-done
-
-# Required to use basename.
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
-  as_basename=basename
-else
-  as_basename=false
-fi
-
-
-# Name of the executable.
-as_me=`$as_basename -- "$0" ||
-$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
-	 X"$0" : 'X\(//\)$' \| \
-	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
-echo X/"$0" |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
+LC_ALL=C
+export LC_ALL
+LANGUAGE=C
+export LANGUAGE
 
 # CDPATH.
-$as_unset CDPATH
-
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
 if test "x$CONFIG_SHELL" = x; then
-  if (eval ":") 2>/dev/null; then
-  as_have_required=yes
+  as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
+  emulate sh
+  NULLCMD=:
+  # Pre-4.2 versions of Zsh do word splitting on \${1+\"\$@\"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '\${1+\"\$@\"}'='\"\$@\"'
+  setopt NO_GLOB_SUBST
 else
-  as_have_required=no
+  case \`(set -o) 2>/dev/null\` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
+esac
 fi
-
-  if test $as_have_required = yes && 	 (eval ":
-(as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
+"
+  as_required="as_fn_return () { (exit \$1); }
+as_fn_success () { as_fn_return 0; }
+as_fn_failure () { as_fn_return 1; }
+as_fn_ret_success () { return 0; }
+as_fn_ret_failure () { return 1; }
 
 exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
-
-if ( set x; as_func_ret_success y && test x = \"\$1\" ); then
-  :
+as_fn_success || { exitcode=1; echo as_fn_success failed.; }
+as_fn_failure && { exitcode=1; echo as_fn_failure succeeded.; }
+as_fn_ret_success || { exitcode=1; echo as_fn_ret_success failed.; }
+as_fn_ret_failure && { exitcode=1; echo as_fn_ret_failure succeeded.; }
+if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :
+
+else
+  exitcode=1; echo positional parameters were not saved.
+fi
+test x\$exitcode = x0 || exit 1"
+  as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
+  as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
+  eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
+  test \"x\`expr \$as_lineno_1'\$as_run' + 1\`\" = \"x\$as_lineno_2'\$as_run'\"' || exit 1
+test \$(( 1 + 1 )) = 2 || exit 1"
+  if (eval "$as_required") 2>/dev/null; then :
+  as_have_required=yes
 else
-  exitcode=1
-  echo positional parameters were not saved.
+  as_have_required=no
 fi
+  if test x$as_have_required = xyes && (eval "$as_suggested") 2>/dev/null; then :
 
-test \$exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=\$LINENO
-  as_lineno_2=\$LINENO
-  test \"x\$as_lineno_1\" != \"x\$as_lineno_2\" &&
-  test \"x\`expr \$as_lineno_1 + 1\`\" = \"x\$as_lineno_2\") || { (exit 1); exit 1; }
-") 2> /dev/null; then
-  :
 else
-  as_candidate_shells=
-    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in /usr/bin/posix$PATH_SEPARATOR/bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+as_found=false
+for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  case $as_dir in
+  as_found=:
+  case $as_dir in #(
 	 /*)
 	   for as_base in sh bash ksh sh5; do
-	     as_candidate_shells="$as_candidate_shells $as_dir/$as_base"
+	     # Try only shells that exist, to save several forks.
+	     as_shell=$as_dir/$as_base
+	     if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
+		    { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  CONFIG_SHELL=$as_shell as_have_required=yes
+		   if { $as_echo "$as_bourne_compatible""$as_suggested" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  break 2
+fi
+fi
 	   done;;
        esac
+  as_found=false
 done
+$as_found || { if { test -f "$SHELL" || test -f "$SHELL.exe"; } &&
+	      { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$SHELL"; } 2>/dev/null; then :
+  CONFIG_SHELL=$SHELL as_have_required=yes
+fi; }
 IFS=$as_save_IFS
 
 
-      for as_shell in $as_candidate_shells $SHELL; do
-	 # Try only shells that exist, to save several forks.
-	 if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
-		{ ("$as_shell") 2> /dev/null <<\_ASEOF
-# Be Bourne compatible
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
-  emulate sh
-  NULLCMD=:
-  # Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in *posix*) set -o posix;; esac
-fi
-BIN_SH=xpg4; export BIN_SH # for Tru64
-DUALCASE=1; export DUALCASE # for MKS sh
-
-:
-_ASEOF
-}; then
-  CONFIG_SHELL=$as_shell
-	       as_have_required=yes
-	       if { "$as_shell" 2> /dev/null <<\_ASEOF
-# Be Bourne compatible
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
-  emulate sh
-  NULLCMD=:
-  # Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in *posix*) set -o posix;; esac
-fi
-BIN_SH=xpg4; export BIN_SH # for Tru64
-DUALCASE=1; export DUALCASE # for MKS sh
-
-:
-(as_func_return () {
-  (exit $1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
-
-exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
+      if test "x$CONFIG_SHELL" != x; then :
+  # We cannot yet assume a decent shell, so we have to provide a
+	# neutralization value for shells without unset; and this also
+	# works around shells that cannot unset nonexistent variables.
+	# Preserve -v and -x to the replacement shell.
+	BASH_ENV=/dev/null
+	ENV=/dev/null
+	(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+	export CONFIG_SHELL
+	case $- in # ((((
+	  *v*x* | *x*v* ) as_opts=-vx ;;
+	  *v* ) as_opts=-v ;;
+	  *x* ) as_opts=-x ;;
+	  * ) as_opts= ;;
+	esac
+	exec "$CONFIG_SHELL" $as_opts "$as_myself" ${1+"$@"}
 fi
 
-if ( set x; as_func_ret_success y && test x = "$1" ); then
-  :
-else
-  exitcode=1
-  echo positional parameters were not saved.
+    if test x$as_have_required = xno; then :
+  $as_echo "$0: This script requires a shell more modern than all"
+  $as_echo "$0: the shells that I found on your system."
+  if test x${ZSH_VERSION+set} = xset ; then
+    $as_echo "$0: In particular, zsh $ZSH_VERSION has bugs and should"
+    $as_echo "$0: be upgraded to zsh 4.3.4 or later."
+  else
+    $as_echo "$0: Please tell bug-autoconf@gnu.org and
+$0: mroberto@users.sourceforge.net about your system,
+$0: including any error possibly output before this
+$0: message. Then install a modern shell, or manually run
+$0: the script under such a shell if you do have one."
+  fi
+  exit 1
 fi
-
-test $exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2") || { (exit 1); exit 1; }
-
-_ASEOF
-}; then
-  break
 fi
-
 fi
+SHELL=${CONFIG_SHELL-/bin/sh}
+export SHELL
+# Unset more variables known to interfere with behavior of common tools.
+CLICOLOR_FORCE= GREP_OPTIONS=
+unset CLICOLOR_FORCE GREP_OPTIONS
 
-      done
-
-      if test "x$CONFIG_SHELL" != x; then
-  for as_var in BASH_ENV ENV
-        do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
-        done
-        export CONFIG_SHELL
-        exec "$CONFIG_SHELL" "$as_myself" ${1+"$@"}
-fi
+## --------------------- ##
+## M4sh Shell Functions. ##
+## --------------------- ##
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
 
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
 
-    if test $as_have_required = no; then
-  echo This script requires a shell more modern than all the
-      echo shells that I found on your system.  Please install a
-      echo modern shell, or manually run the script under such a
-      echo shell if you do have one.
-      { (exit 1); exit 1; }
-fi
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
 
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
 
-fi
 
-fi
+} # as_fn_mkdir_p
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
+else
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
 
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
+else
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
 
 
-(eval "as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with STATUS, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
+  fi
+  $as_echo "$as_me: error: $2" >&2
+  as_fn_exit $as_status
+} # as_fn_error
 
-exitcode=0
-if as_func_success; then
-  :
+if expr a : '\(a\)' >/dev/null 2>&1 &&
+   test "X`expr 00001 : '.*\(...\)'`" = X001; then
+  as_expr=expr
 else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
+  as_expr=false
 fi
 
-if as_func_ret_success; then
-  :
+if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
+  as_basename=basename
 else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
+  as_basename=false
 fi
 
-if ( set x; as_func_ret_success y && test x = \"\$1\" ); then
-  :
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
 else
-  exitcode=1
-  echo positional parameters were not saved.
+  as_dirname=false
 fi
 
-test \$exitcode = 0") || {
-  echo No shell found that supports shell functions.
-  echo Please tell autoconf@gnu.org about your system,
-  echo including any error possibly output before this
-  echo message
-}
+as_me=`$as_basename -- "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
 
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
 
 
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2" || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
+  as_lineno_1=$LINENO as_lineno_1a=$LINENO
+  as_lineno_2=$LINENO as_lineno_2a=$LINENO
+  eval 'test "x$as_lineno_1'$as_run'" != "x$as_lineno_2'$as_run'" &&
+  test "x`expr $as_lineno_1'$as_run' + 1`" = "x$as_lineno_2'$as_run'"' || {
+  # Blame Lee E. McMahon (1931-1989) for sed's syntax.  :-)
   sed -n '
     p
     /[$]LINENO/=
@@ -448,8 +451,7 @@
       s/-\n.*//
     ' >$as_me.lineno &&
   chmod +x "$as_me.lineno" ||
-    { echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
-   { (exit 1); exit 1; }; }
+    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
 
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
@@ -459,49 +461,40 @@
   exit
 }
 
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
-
 ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
+case `echo -n x` in #(((((
 -n*)
-  case `echo 'x\c'` in
+  case `echo 'xy\c'` in
   *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
   esac;;
 *)
   ECHO_N='-n';;
 esac
 
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
 rm -f conf$$ conf$$.exe conf$$.file
 if test -d conf$$.dir; then
   rm -f conf$$.dir/conf$$.file
 else
   rm -f conf$$.dir
-  mkdir conf$$.dir
+  mkdir conf$$.dir 2>/dev/null
 fi
-echo >conf$$.file
-if ln -s conf$$.file conf$$ 2>/dev/null; then
-  as_ln_s='ln -s'
-  # ... but there are two gotchas:
-  # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
-  # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-  # In both cases, we have to default to `cp -p'.
-  ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
+if (echo >conf$$.file) 2>/dev/null; then
+  if ln -s conf$$.file conf$$ 2>/dev/null; then
+    as_ln_s='ln -s'
+    # ... but there are two gotchas:
+    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
+    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
+    # In both cases, we have to default to `cp -p'.
+    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
+      as_ln_s='cp -p'
+  elif ln conf$$.file conf$$ 2>/dev/null; then
+    as_ln_s=ln
+  else
     as_ln_s='cp -p'
-elif ln conf$$.file conf$$ 2>/dev/null; then
-  as_ln_s=ln
+  fi
 else
   as_ln_s='cp -p'
 fi
@@ -509,25 +502,34 @@
 rmdir conf$$.dir 2>/dev/null
 
 if mkdir -p . 2>/dev/null; then
-  as_mkdir_p=:
+  as_mkdir_p='mkdir -p "$as_dir"'
 else
   test -d ./-p && rmdir ./-p
   as_mkdir_p=false
 fi
 
-# Find out whether ``test -x'' works.  Don't use a zero-byte file, as
-# systems may use methods other than mode bits to determine executability.
-cat >conf$$.file <<_ASEOF
-#! /bin/sh
-exit 0
-_ASEOF
-chmod +x conf$$.file
-if test -x conf$$.file >/dev/null 2>&1; then
-  as_executable_p="test -x"
+if test -x / >/dev/null 2>&1; then
+  as_test_x='test -x'
 else
-  as_executable_p=:
+  if ls -dL / >/dev/null 2>&1; then
+    as_ls_L_option=L
+  else
+    as_ls_L_option=
+  fi
+  as_test_x='
+    eval sh -c '\''
+      if test -d "$1"; then
+	test -d "$1/.";
+      else
+	case $1 in #(
+	-*)set "./$1";;
+	esac;
+	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
+	???[sx]*):;;*)false;;esac;fi
+    '\'' sh
+  '
 fi
-rm -f conf$$.file
+as_executable_p=$as_test_x
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -537,7 +539,6 @@
 
 
 
-
 # Check that we are running under the correct shell.
 SHELL=${CONFIG_SHELL-/bin/sh}
 
@@ -691,10 +692,11 @@
 
 tagnames=${tagnames+${tagnames},}F77
 
-exec 7<&0 </dev/null 6>&1
+test -n "$DJDIR" || exec 7<&0 </dev/null
+exec 6>&1
 
 # Name of the host.
-# hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
+# hostname on some systems (SVR3.2, old GNU/Linux) returns a bogus exit status,
 # so uname gets run too.
 ac_hostname=`(hostname || uname -n) 2>/dev/null | sed 1q`
 
@@ -709,7 +711,6 @@
 subdirs=
 MFLAGS=
 MAKEFLAGS=
-SHELL=${CONFIG_SHELL-/bin/sh}
 
 # Identity of this package.
 PACKAGE_NAME='libupnp'
@@ -717,179 +718,200 @@
 PACKAGE_VERSION='1.6.6'
 PACKAGE_STRING='libupnp 1.6.6'
 PACKAGE_BUGREPORT='mroberto@users.sourceforge.net'
+PACKAGE_URL=''
 
 ac_unique_file="upnp/inc/upnp.h"
 # Factoring default headers for most tests.
 ac_includes_default="\
 #include <stdio.h>
-#if HAVE_SYS_TYPES_H
+#ifdef HAVE_SYS_TYPES_H
 # include <sys/types.h>
 #endif
-#if HAVE_SYS_STAT_H
+#ifdef HAVE_SYS_STAT_H
 # include <sys/stat.h>
 #endif
-#if STDC_HEADERS
+#ifdef STDC_HEADERS
 # include <stdlib.h>
 # include <stddef.h>
 #else
-# if HAVE_STDLIB_H
+# ifdef HAVE_STDLIB_H
 #  include <stdlib.h>
 # endif
 #endif
-#if HAVE_STRING_H
-# if !STDC_HEADERS && HAVE_MEMORY_H
+#ifdef HAVE_STRING_H
+# if !defined STDC_HEADERS && defined HAVE_MEMORY_H
 #  include <memory.h>
 # endif
 # include <string.h>
 #endif
-#if HAVE_STRINGS_H
+#ifdef HAVE_STRINGS_H
 # include <strings.h>
 #endif
-#if HAVE_INTTYPES_H
+#ifdef HAVE_INTTYPES_H
 # include <inttypes.h>
 #endif
-#if HAVE_STDINT_H
+#ifdef HAVE_STDINT_H
 # include <stdint.h>
 #endif
-#if HAVE_UNISTD_H
+#ifdef HAVE_UNISTD_H
 # include <unistd.h>
 #endif"
 
-ac_subst_vars='SHELL
-PATH_SEPARATOR
-PACKAGE_NAME
-PACKAGE_TARNAME
-PACKAGE_VERSION
-PACKAGE_STRING
-PACKAGE_BUGREPORT
-exec_prefix
-prefix
-program_transform_name
-bindir
-sbindir
-libexecdir
-datarootdir
-datadir
-sysconfdir
-sharedstatedir
-localstatedir
-includedir
-oldincludedir
-docdir
-infodir
-htmldir
-dvidir
-pdfdir
-psdir
-libdir
-localedir
-mandir
-DEFS
-ECHO_C
-ECHO_N
-ECHO_T
-LIBS
+ac_subst_vars='LTLIBOBJS
+LIBOBJS
+PTHREAD_CFLAGS
+PTHREAD_LIBS
+PTHREAD_CC
+acx_pthread_config
+LIBTOOL
+ac_ct_F77
+FFLAGS
+F77
+CXXCPP
+am__fastdepCXX_FALSE
+am__fastdepCXX_TRUE
+CXXDEPMODE
+ac_ct_CXX
+CXXFLAGS
+CXX
+CPP
+RANLIB
+AR
+ECHO
+LN_S
+EGREP
+GREP
+am__fastdepCC_FALSE
+am__fastdepCC_TRUE
+CCDEPMODE
+AMDEPBACKSLASH
+AMDEP_FALSE
+AMDEP_TRUE
+am__quote
+am__include
+DEPDIR
+OBJEXT
+EXEEXT
+ac_ct_CC
+CPPFLAGS
+LDFLAGS
+CFLAGS
+CC
+WITH_DOCUMENTATION_FALSE
+WITH_DOCUMENTATION_TRUE
+ENABLE_SAMPLES_FALSE
+ENABLE_SAMPLES_TRUE
+ENABLE_TOOLS_FALSE
+ENABLE_TOOLS_TRUE
+ENABLE_WEBSERVER_FALSE
+ENABLE_WEBSERVER_TRUE
+ENABLE_DEVICE_FALSE
+ENABLE_DEVICE_TRUE
+ENABLE_CLIENT_FALSE
+ENABLE_CLIENT_TRUE
+ENABLE_DEBUG_FALSE
+ENABLE_DEBUG_TRUE
+host_os
+host_vendor
+host_cpu
+host
+build_os
+build_vendor
+build_cpu
+build
+am__untar
+am__tar
+AMTAR
+am__leading_dot
+SET_MAKE
+AWK
+mkdir_p
+INSTALL_STRIP_PROGRAM
+STRIP
+install_sh
+MAKEINFO
+AUTOHEADER
+AUTOMAKE
+AUTOCONF
+ACLOCAL
+VERSION
+PACKAGE
+CYGPATH_W
+INSTALL_DATA
+INSTALL_SCRIPT
+INSTALL_PROGRAM
+LT_VERSION_UPNP
+LT_VERSION_THREADUTIL
+LT_VERSION_IXML
+target_alias
+host_alias
 build_alias
+LIBS
+ECHO_T
+ECHO_N
+ECHO_C
+DEFS
+mandir
+localedir
+libdir
+psdir
+pdfdir
+dvidir
+htmldir
+infodir
+docdir
+oldincludedir
+includedir
+localstatedir
+sharedstatedir
+sysconfdir
+datadir
+datarootdir
+libexecdir
+sbindir
+bindir
+program_transform_name
+prefix
+exec_prefix
+PACKAGE_URL
+PACKAGE_BUGREPORT
+PACKAGE_STRING
+PACKAGE_VERSION
+PACKAGE_TARNAME
+PACKAGE_NAME
+PATH_SEPARATOR
+SHELL'
+ac_subst_files=''
+ac_user_opts='
+enable_option_checking
+enable_debug
+enable_client
+enable_device
+enable_webserver
+enable_tools
+enable_samples
+with_documentation
+enable_dependency_tracking
+enable_shared
+enable_static
+enable_fast_install
+with_gnu_ld
+enable_libtool_lock
+with_pic
+with_tags
+'
+      ac_precious_vars='build_alias
 host_alias
 target_alias
-LT_VERSION_IXML
-LT_VERSION_THREADUTIL
-LT_VERSION_UPNP
-INSTALL_PROGRAM
-INSTALL_SCRIPT
-INSTALL_DATA
-CYGPATH_W
-PACKAGE
-VERSION
-ACLOCAL
-AUTOCONF
-AUTOMAKE
-AUTOHEADER
-MAKEINFO
-install_sh
-STRIP
-INSTALL_STRIP_PROGRAM
-mkdir_p
-AWK
-SET_MAKE
-am__leading_dot
-AMTAR
-am__tar
-am__untar
-build
-build_cpu
-build_vendor
-build_os
-host
-host_cpu
-host_vendor
-host_os
-ENABLE_DEBUG_TRUE
-ENABLE_DEBUG_FALSE
-ENABLE_CLIENT_TRUE
-ENABLE_CLIENT_FALSE
-ENABLE_DEVICE_TRUE
-ENABLE_DEVICE_FALSE
-ENABLE_WEBSERVER_TRUE
-ENABLE_WEBSERVER_FALSE
-ENABLE_TOOLS_TRUE
-ENABLE_TOOLS_FALSE
-ENABLE_SAMPLES_TRUE
-ENABLE_SAMPLES_FALSE
-WITH_DOCUMENTATION_TRUE
-WITH_DOCUMENTATION_FALSE
 CC
 CFLAGS
 LDFLAGS
+LIBS
 CPPFLAGS
-ac_ct_CC
-EXEEXT
-OBJEXT
-DEPDIR
-am__include
-am__quote
-AMDEP_TRUE
-AMDEP_FALSE
-AMDEPBACKSLASH
-CCDEPMODE
-am__fastdepCC_TRUE
-am__fastdepCC_FALSE
-GREP
-EGREP
-LN_S
-ECHO
-AR
-RANLIB
 CPP
 CXX
 CXXFLAGS
-ac_ct_CXX
-CXXDEPMODE
-am__fastdepCXX_TRUE
-am__fastdepCXX_FALSE
-CXXCPP
-F77
-FFLAGS
-ac_ct_F77
-LIBTOOL
-acx_pthread_config
-PTHREAD_CC
-PTHREAD_LIBS
-PTHREAD_CFLAGS
-LIBOBJS
-LTLIBOBJS'
-ac_subst_files=''
-      ac_precious_vars='build_alias
-host_alias
-target_alias
-CC
-CFLAGS
-LDFLAGS
-CPPFLAGS
-CPP
-CXX
-CXXFLAGS
-CCC
+CCC
 CXXCPP
 F77
 FFLAGS'
@@ -898,6 +920,8 @@
 # Initialize some variables set by options.
 ac_init_help=
 ac_init_version=false
+ac_unrecognized_opts=
+ac_unrecognized_sep=
 # The variables have the same names as the options, with
 # dashes changed to underlines.
 cache_file=/dev/null
@@ -953,8 +977,9 @@
   fi
 
   case $ac_option in
-  *=*)	ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
-  *)	ac_optarg=yes ;;
+  *=?*) ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
+  *=)   ac_optarg= ;;
+  *)    ac_optarg=yes ;;
   esac
 
   # Accept the important Cygnus configure options, so we can diagnose typos.
@@ -996,13 +1021,20 @@
     datarootdir=$ac_optarg ;;
 
   -disable-* | --disable-*)
-    ac_feature=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
+    ac_useropt=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
     # Reject names that are not valid shell variable names.
-    expr "x$ac_feature" : ".*[^-_$as_cr_alnum]" >/dev/null &&
-      { echo "$as_me: error: invalid feature name: $ac_feature" >&2
-   { (exit 1); exit 1; }; }
-    ac_feature=`echo $ac_feature | sed 's/-/_/g'`
-    eval enable_$ac_feature=no ;;
+    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
+      as_fn_error $? "invalid feature name: $ac_useropt"
+    ac_useropt_orig=$ac_useropt
+    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
+    case $ac_user_opts in
+      *"
+"enable_$ac_useropt"
+"*) ;;
+      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--disable-$ac_useropt_orig"
+	 ac_unrecognized_sep=', ';;
+    esac
+    eval enable_$ac_useropt=no ;;
 
   -docdir | --docdir | --docdi | --doc | --do)
     ac_prev=docdir ;;
@@ -1015,13 +1047,20 @@
     dvidir=$ac_optarg ;;
 
   -enable-* | --enable-*)
-    ac_feature=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
+    ac_useropt=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
-    expr "x$ac_feature" : ".*[^-_$as_cr_alnum]" >/dev/null &&
-      { echo "$as_me: error: invalid feature name: $ac_feature" >&2
-   { (exit 1); exit 1; }; }
-    ac_feature=`echo $ac_feature | sed 's/-/_/g'`
-    eval enable_$ac_feature=\$ac_optarg ;;
+    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
+      as_fn_error $? "invalid feature name: $ac_useropt"
+    ac_useropt_orig=$ac_useropt
+    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
+    case $ac_user_opts in
+      *"
+"enable_$ac_useropt"
+"*) ;;
+      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--enable-$ac_useropt_orig"
+	 ac_unrecognized_sep=', ';;
+    esac
+    eval enable_$ac_useropt=\$ac_optarg ;;
 
   -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
   | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
@@ -1212,22 +1251,36 @@
     ac_init_version=: ;;
 
   -with-* | --with-*)
-    ac_package=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
+    ac_useropt=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
-    expr "x$ac_package" : ".*[^-_$as_cr_alnum]" >/dev/null &&
-      { echo "$as_me: error: invalid package name: $ac_package" >&2
-   { (exit 1); exit 1; }; }
-    ac_package=`echo $ac_package| sed 's/-/_/g'`
-    eval with_$ac_package=\$ac_optarg ;;
+    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
+      as_fn_error $? "invalid package name: $ac_useropt"
+    ac_useropt_orig=$ac_useropt
+    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
+    case $ac_user_opts in
+      *"
+"with_$ac_useropt"
+"*) ;;
+      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--with-$ac_useropt_orig"
+	 ac_unrecognized_sep=', ';;
+    esac
+    eval with_$ac_useropt=\$ac_optarg ;;
 
   -without-* | --without-*)
-    ac_package=`expr "x$ac_option" : 'x-*without-\(.*\)'`
+    ac_useropt=`expr "x$ac_option" : 'x-*without-\(.*\)'`
     # Reject names that are not valid shell variable names.
-    expr "x$ac_package" : ".*[^-_$as_cr_alnum]" >/dev/null &&
-      { echo "$as_me: error: invalid package name: $ac_package" >&2
-   { (exit 1); exit 1; }; }
-    ac_package=`echo $ac_package | sed 's/-/_/g'`
-    eval with_$ac_package=no ;;
+    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
+      as_fn_error $? "invalid package name: $ac_useropt"
+    ac_useropt_orig=$ac_useropt
+    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
+    case $ac_user_opts in
+      *"
+"with_$ac_useropt"
+"*) ;;
+      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--without-$ac_useropt_orig"
+	 ac_unrecognized_sep=', ';;
+    esac
+    eval with_$ac_useropt=no ;;
 
   --x)
     # Obsolete; use --with-x.
@@ -1247,26 +1300,26 @@
   | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
     x_libraries=$ac_optarg ;;
 
-  -*) { echo "$as_me: error: unrecognized option: $ac_option
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; }
+  -*) as_fn_error $? "unrecognized option: \`$ac_option'
+Try \`$0 --help' for more information"
     ;;
 
   *=*)
     ac_envvar=`expr "x$ac_option" : 'x\([^=]*\)='`
     # Reject names that are not valid shell variable names.
-    expr "x$ac_envvar" : ".*[^_$as_cr_alnum]" >/dev/null &&
-      { echo "$as_me: error: invalid variable name: $ac_envvar" >&2
-   { (exit 1); exit 1; }; }
+    case $ac_envvar in #(
+      '' | [0-9]* | *[!_$as_cr_alnum]* )
+      as_fn_error $? "invalid variable name: \`$ac_envvar'" ;;
+    esac
     eval $ac_envvar=\$ac_optarg
     export $ac_envvar ;;
 
   *)
     # FIXME: should be removed in autoconf 3.0.
-    echo "$as_me: WARNING: you should use --build, --host, --target" >&2
+    $as_echo "$as_me: WARNING: you should use --build, --host, --target" >&2
     expr "x$ac_option" : ".*[^-._$as_cr_alnum]" >/dev/null &&
-      echo "$as_me: WARNING: invalid host type: $ac_option" >&2
-    : ${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}
+      $as_echo "$as_me: WARNING: invalid host type: $ac_option" >&2
+    : "${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}"
     ;;
 
   esac
@@ -1274,23 +1327,36 @@
 
 if test -n "$ac_prev"; then
   ac_option=--`echo $ac_prev | sed 's/_/-/g'`
-  { echo "$as_me: error: missing argument to $ac_option" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "missing argument to $ac_option"
 fi
 
-# Be sure to have absolute directory names.
+if test -n "$ac_unrecognized_opts"; then
+  case $enable_option_checking in
+    no) ;;
+    fatal) as_fn_error $? "unrecognized options: $ac_unrecognized_opts" ;;
+    *)     $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2 ;;
+  esac
+fi
+
+# Check all directory arguments for consistency.
 for ac_var in	exec_prefix prefix bindir sbindir libexecdir datarootdir \
 		datadir sysconfdir sharedstatedir localstatedir includedir \
 		oldincludedir docdir infodir htmldir dvidir pdfdir psdir \
 		libdir localedir mandir
 do
   eval ac_val=\$$ac_var
+  # Remove trailing slashes.
+  case $ac_val in
+    */ )
+      ac_val=`expr "X$ac_val" : 'X\(.*[^/]\)' \| "X$ac_val" : 'X\(.*\)'`
+      eval $ac_var=\$ac_val;;
+  esac
+  # Be sure to have absolute directory names.
   case $ac_val in
     [\\/$]* | ?:[\\/]* )  continue;;
     NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
   esac
-  { echo "$as_me: error: expected an absolute directory name for --$ac_var: $ac_val" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "expected an absolute directory name for --$ac_var: $ac_val"
 done
 
 # There might be people who depend on the old broken behavior: `$host'
@@ -1304,8 +1370,8 @@
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    echo "$as_me: WARNING: If you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used." >&2
+    $as_echo "$as_me: WARNING: if you wanted to set the --build type, don't use --host.
+    If a cross compiler is detected then cross compile mode will be used" >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1320,23 +1386,21 @@
 ac_pwd=`pwd` && test -n "$ac_pwd" &&
 ac_ls_di=`ls -di .` &&
 ac_pwd_ls_di=`cd "$ac_pwd" && ls -di .` ||
-  { echo "$as_me: error: Working directory cannot be determined" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "working directory cannot be determined"
 test "X$ac_ls_di" = "X$ac_pwd_ls_di" ||
-  { echo "$as_me: error: pwd does not report name of working directory" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "pwd does not report name of working directory"
 
 
 # Find the source files, if location was not specified.
 if test -z "$srcdir"; then
   ac_srcdir_defaulted=yes
   # Try the directory containing this script, then the parent directory.
-  ac_confdir=`$as_dirname -- "$0" ||
-$as_expr X"$0" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$0" : 'X\(//\)[^/]' \| \
-	 X"$0" : 'X\(//\)$' \| \
-	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
-echo X"$0" |
+  ac_confdir=`$as_dirname -- "$as_myself" ||
+$as_expr X"$as_myself" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_myself" : 'X\(//\)[^/]' \| \
+	 X"$as_myself" : 'X\(//\)$' \| \
+	 X"$as_myself" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_myself" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
 	    s//\1/
 	    q
@@ -1363,13 +1427,11 @@
 fi
 if test ! -r "$srcdir/$ac_unique_file"; then
   test "$ac_srcdir_defaulted" = yes && srcdir="$ac_confdir or .."
-  { echo "$as_me: error: cannot find sources ($ac_unique_file) in $srcdir" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot find sources ($ac_unique_file) in $srcdir"
 fi
 ac_msg="sources are in $srcdir, but \`cd $srcdir' does not work"
 ac_abs_confdir=`(
-	cd "$srcdir" && test -r "./$ac_unique_file" || { echo "$as_me: error: $ac_msg" >&2
-   { (exit 1); exit 1; }; }
+	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error $? "$ac_msg"
 	pwd)`
 # When building in place, set srcdir=.
 if test "$ac_abs_confdir" = "$ac_pwd"; then
@@ -1409,7 +1471,7 @@
       --help=short        display options specific to this package
       --help=recursive    display the short help of all the included packages
   -V, --version           display version information and exit
-  -q, --quiet, --silent   do not print \`checking...' messages
+  -q, --quiet, --silent   do not print \`checking ...' messages
       --cache-file=FILE   cache test results in FILE [disabled]
   -C, --config-cache      alias for \`--cache-file=config.cache'
   -n, --no-create         do not create output files
@@ -1417,9 +1479,9 @@
 
 Installation directories:
   --prefix=PREFIX         install architecture-independent files in PREFIX
-			  [$ac_default_prefix]
+                          [$ac_default_prefix]
   --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
-			  [PREFIX]
+                          [PREFIX]
 
 By default, \`make install' will install all the files in
 \`$ac_default_prefix/bin', \`$ac_default_prefix/lib' etc.  You can specify
@@ -1429,25 +1491,25 @@
 For better control, use the options below.
 
 Fine tuning of the installation directories:
-  --bindir=DIR           user executables [EPREFIX/bin]
-  --sbindir=DIR          system admin executables [EPREFIX/sbin]
-  --libexecdir=DIR       program executables [EPREFIX/libexec]
-  --sysconfdir=DIR       read-only single-machine data [PREFIX/etc]
-  --sharedstatedir=DIR   modifiable architecture-independent data [PREFIX/com]
-  --localstatedir=DIR    modifiable single-machine data [PREFIX/var]
-  --libdir=DIR           object code libraries [EPREFIX/lib]
-  --includedir=DIR       C header files [PREFIX/include]
-  --oldincludedir=DIR    C header files for non-gcc [/usr/include]
-  --datarootdir=DIR      read-only arch.-independent data root [PREFIX/share]
-  --datadir=DIR          read-only architecture-independent data [DATAROOTDIR]
-  --infodir=DIR          info documentation [DATAROOTDIR/info]
-  --localedir=DIR        locale-dependent data [DATAROOTDIR/locale]
-  --mandir=DIR           man documentation [DATAROOTDIR/man]
-  --docdir=DIR           documentation root [DATAROOTDIR/doc/libupnp]
-  --htmldir=DIR          html documentation [DOCDIR]
-  --dvidir=DIR           dvi documentation [DOCDIR]
-  --pdfdir=DIR           pdf documentation [DOCDIR]
-  --psdir=DIR            ps documentation [DOCDIR]
+  --bindir=DIR            user executables [EPREFIX/bin]
+  --sbindir=DIR           system admin executables [EPREFIX/sbin]
+  --libexecdir=DIR        program executables [EPREFIX/libexec]
+  --sysconfdir=DIR        read-only single-machine data [PREFIX/etc]
+  --sharedstatedir=DIR    modifiable architecture-independent data [PREFIX/com]
+  --localstatedir=DIR     modifiable single-machine data [PREFIX/var]
+  --libdir=DIR            object code libraries [EPREFIX/lib]
+  --includedir=DIR        C header files [PREFIX/include]
+  --oldincludedir=DIR     C header files for non-gcc [/usr/include]
+  --datarootdir=DIR       read-only arch.-independent data root [PREFIX/share]
+  --datadir=DIR           read-only architecture-independent data [DATAROOTDIR]
+  --infodir=DIR           info documentation [DATAROOTDIR/info]
+  --localedir=DIR         locale-dependent data [DATAROOTDIR/locale]
+  --mandir=DIR            man documentation [DATAROOTDIR/man]
+  --docdir=DIR            documentation root [DATAROOTDIR/doc/libupnp]
+  --htmldir=DIR           html documentation [DOCDIR]
+  --dvidir=DIR            dvi documentation [DOCDIR]
+  --pdfdir=DIR            pdf documentation [DOCDIR]
+  --psdir=DIR             ps documentation [DOCDIR]
 _ACEOF
 
   cat <<\_ACEOF
@@ -1470,6 +1532,7 @@
   cat <<\_ACEOF
 
 Optional Features:
+  --disable-option-checking  ignore unrecognized --enable/--with options
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
   --enable-debug          enable extra debugging code [default=disabled]
@@ -1494,7 +1557,7 @@
   --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
   --with-documentation=directory_name
                           where documentation is installed
-                          [DATADIR/doc/libupnp-1.6.6]
+                          [[DATADIR/doc/]libupnp[-]1.6.6]
   --without-documentation do not install the documentation
   --with-gnu-ld           assume the C compiler uses GNU ld [default=no]
   --with-pic              try to use only PIC/non-PIC objects [default=use
@@ -1506,7 +1569,8 @@
   CFLAGS      C compiler flags
   LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
               nonstandard directory <lib dir>
-  CPPFLAGS    C/C++/Objective C preprocessor flags, e.g. -I<include dir> if
+  LIBS        libraries to pass to the linker, e.g. -l<library>
+  CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if
               you have headers in a nonstandard directory <include dir>
   CPP         C preprocessor
   CXX         C++ compiler command
@@ -1526,15 +1590,17 @@
 if test "$ac_init_help" = "recursive"; then
   # If there are subdirs, report their specific --help.
   for ac_dir in : $ac_subdirs_all; do test "x$ac_dir" = x: && continue
-    test -d "$ac_dir" || continue
+    test -d "$ac_dir" ||
+      { cd "$srcdir" && ac_pwd=`pwd` && srcdir=. && test -d "$ac_dir"; } ||
+      continue
     ac_builddir=.
 
 case "$ac_dir" in
 .) ac_dir_suffix= ac_top_builddir_sub=. ac_top_build_prefix= ;;
 *)
-  ac_dir_suffix=/`echo "$ac_dir" | sed 's,^\.[\\/],,'`
+  ac_dir_suffix=/`$as_echo "$ac_dir" | sed 's|^\.[\\/]||'`
   # A ".." for each directory in $ac_dir_suffix.
-  ac_top_builddir_sub=`echo "$ac_dir_suffix" | sed 's,/[^\\/]*,/..,g;s,/,,'`
+  ac_top_builddir_sub=`$as_echo "$ac_dir_suffix" | sed 's|/[^\\/]*|/..|g;s|/||'`
   case $ac_top_builddir_sub in
   "") ac_top_builddir_sub=. ac_top_build_prefix= ;;
   *)  ac_top_build_prefix=$ac_top_builddir_sub/ ;;
@@ -1570,7 +1636,7 @@
       echo &&
       $SHELL "$ac_srcdir/configure" --help=recursive
     else
-      echo "$as_me: WARNING: no configuration information is in $ac_dir" >&2
+      $as_echo "$as_me: WARNING: no configuration information is in $ac_dir" >&2
     fi || ac_status=$?
     cd "$ac_pwd" || { ac_status=$?; break; }
   done
@@ -1580,21 +1646,635 @@
 if $ac_init_version; then
   cat <<\_ACEOF
 libupnp configure 1.6.6
-generated by GNU Autoconf 2.60
+generated by GNU Autoconf 2.68
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006 Free Software Foundation, Inc.
+Copyright (C) 2010 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
   exit
 fi
+
+## ------------------------ ##
+## Autoconf initialization. ##
+## ------------------------ ##
+
+# ac_fn_c_try_compile LINENO
+# --------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_compile
+
+# ac_fn_c_try_link LINENO
+# -----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_link ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 $as_test_x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_link
+
+# ac_fn_c_try_cpp LINENO
+# ----------------------
+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_cpp ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } > conftest.i && {
+	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+    ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_cpp
+
+# ac_fn_c_check_header_mongrel LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists, giving a warning if it cannot be compiled using
+# the include files in INCLUDES and setting the cache variable VAR
+# accordingly.
+ac_fn_c_check_header_mongrel ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if eval \${$3+:} false; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+else
+  # Is the header compilable?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 usability" >&5
+$as_echo_n "checking $2 usability... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_header_compiler=yes
+else
+  ac_header_compiler=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_compiler" >&5
+$as_echo "$ac_header_compiler" >&6; }
+
+# Is the header present?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 presence" >&5
+$as_echo_n "checking $2 presence... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <$2>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  ac_header_preproc=yes
+else
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc" >&5
+$as_echo "$ac_header_preproc" >&6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in #((
+  yes:no: )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&5
+$as_echo "$as_me: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+  no:yes:* )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: present but cannot be compiled" >&5
+$as_echo "$as_me: WARNING: $2: present but cannot be compiled" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     check for missing prerequisite headers?" >&5
+$as_echo "$as_me: WARNING: $2:     check for missing prerequisite headers?" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: see the Autoconf documentation" >&5
+$as_echo "$as_me: WARNING: $2: see the Autoconf documentation" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&5
+$as_echo "$as_me: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+( $as_echo "## --------------------------------------------- ##
+## Report this to mroberto@users.sourceforge.net ##
+## --------------------------------------------- ##"
+     ) | sed "s/^/$as_me: WARNING:     /" >&2
+    ;;
+esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  eval "$3=\$ac_header_compiler"
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_header_mongrel
+
+# ac_fn_c_try_run LINENO
+# ----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded. Assumes
+# that executables *can* be run.
+ac_fn_c_try_run ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && { ac_try='./conftest$ac_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: program exited with status $ac_status" >&5
+       $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+       ac_retval=$ac_status
+fi
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_run
+
+# ac_fn_c_check_header_compile LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists and can be compiled using the include files in
+# INCLUDES, setting the cache variable VAR accordingly.
+ac_fn_c_check_header_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_header_compile
+
+# ac_fn_c_check_func LINENO FUNC VAR
+# ----------------------------------
+# Tests whether FUNC exists, setting the cache variable VAR accordingly
+ac_fn_c_check_func ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+/* Define $2 to an innocuous variant, in case <limits.h> declares $2.
+   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
+#define $2 innocuous_$2
+
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $2 (); below.
+    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+    <limits.h> exists even on freestanding compilers.  */
+
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+
+#undef $2
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char $2 ();
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined __stub_$2 || defined __stub___$2
+choke me
+#endif
+
+int
+main ()
+{
+return $2 ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_func
+
+# ac_fn_cxx_try_compile LINENO
+# ----------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_compile
+
+# ac_fn_cxx_try_cpp LINENO
+# ------------------------
+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_cpp ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } > conftest.i && {
+	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+    ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_cpp
+
+# ac_fn_cxx_try_link LINENO
+# -------------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_link ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 $as_test_x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_link
+
+# ac_fn_f77_try_compile LINENO
+# ----------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_f77_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_f77_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_f77_try_compile
+
+# ac_fn_f77_try_link LINENO
+# -------------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_f77_try_link ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_f77_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 $as_test_x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_f77_try_link
+
+# ac_fn_c_check_type LINENO TYPE VAR INCLUDES
+# -------------------------------------------
+# Tests whether TYPE exists after having included INCLUDES, setting cache
+# variable VAR accordingly.
+ac_fn_c_check_type ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  eval "$3=no"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+if (sizeof ($2))
+	 return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+if (sizeof (($2)))
+	    return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+
+else
+  eval "$3=yes"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_type
 cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
 It was created by libupnp $as_me 1.6.6, which was
-generated by GNU Autoconf 2.60.  Invocation command line was
+generated by GNU Autoconf 2.68.  Invocation command line was
 
   $ $0 $@
 
@@ -1630,8 +2310,8 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  echo "PATH: $as_dir"
-done
+    $as_echo "PATH: $as_dir"
+  done
 IFS=$as_save_IFS
 
 } >&5
@@ -1665,12 +2345,12 @@
     | -silent | --silent | --silen | --sile | --sil)
       continue ;;
     *\'*)
-      ac_arg=`echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
+      ac_arg=`$as_echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
     esac
     case $ac_pass in
-    1) ac_configure_args0="$ac_configure_args0 '$ac_arg'" ;;
+    1) as_fn_append ac_configure_args0 " '$ac_arg'" ;;
     2)
-      ac_configure_args1="$ac_configure_args1 '$ac_arg'"
+      as_fn_append ac_configure_args1 " '$ac_arg'"
       if test $ac_must_keep_next = true; then
 	ac_must_keep_next=false # Got value, back to normal.
       else
@@ -1686,13 +2366,13 @@
 	  -* ) ac_must_keep_next=true ;;
 	esac
       fi
-      ac_configure_args="$ac_configure_args '$ac_arg'"
+      as_fn_append ac_configure_args " '$ac_arg'"
       ;;
     esac
   done
 done
-$as_unset ac_configure_args0 || test "${ac_configure_args0+set}" != set || { ac_configure_args0=; export ac_configure_args0; }
-$as_unset ac_configure_args1 || test "${ac_configure_args1+set}" != set || { ac_configure_args1=; export ac_configure_args1; }
+{ ac_configure_args0=; unset ac_configure_args0;}
+{ ac_configure_args1=; unset ac_configure_args1;}
 
 # When interrupted or exit'd, cleanup temporary files, and complete
 # config.log.  We remove comments because anyway the quotes in there
@@ -1704,11 +2384,9 @@
   {
     echo
 
-    cat <<\_ASBOX
-## ---------------- ##
+    $as_echo "## ---------------- ##
 ## Cache variables. ##
-## ---------------- ##
-_ASBOX
+## ---------------- ##"
     echo
     # The following way of writing the cache mishandles newlines in values,
 (
@@ -1717,12 +2395,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { echo "$as_me:$LINENO: WARNING: Cache variable $ac_var contains a newline." >&5
-echo "$as_me: WARNING: Cache variable $ac_var contains a newline." >&2;} ;;
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
-      *) $as_unset $ac_var ;;
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -1741,128 +2420,136 @@
 )
     echo
 
-    cat <<\_ASBOX
-## ----------------- ##
+    $as_echo "## ----------------- ##
 ## Output variables. ##
-## ----------------- ##
-_ASBOX
+## ----------------- ##"
     echo
     for ac_var in $ac_subst_vars
     do
       eval ac_val=\$$ac_var
       case $ac_val in
-      *\'\''*) ac_val=`echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
+      *\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
       esac
-      echo "$ac_var='\''$ac_val'\''"
+      $as_echo "$ac_var='\''$ac_val'\''"
     done | sort
     echo
 
     if test -n "$ac_subst_files"; then
-      cat <<\_ASBOX
-## ------------------- ##
+      $as_echo "## ------------------- ##
 ## File substitutions. ##
-## ------------------- ##
-_ASBOX
+## ------------------- ##"
       echo
       for ac_var in $ac_subst_files
       do
 	eval ac_val=\$$ac_var
 	case $ac_val in
-	*\'\''*) ac_val=`echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
+	*\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
 	esac
-	echo "$ac_var='\''$ac_val'\''"
+	$as_echo "$ac_var='\''$ac_val'\''"
       done | sort
       echo
     fi
 
     if test -s confdefs.h; then
-      cat <<\_ASBOX
-## ----------- ##
+      $as_echo "## ----------- ##
 ## confdefs.h. ##
-## ----------- ##
-_ASBOX
+## ----------- ##"
       echo
       cat confdefs.h
       echo
     fi
     test "$ac_signal" != 0 &&
-      echo "$as_me: caught signal $ac_signal"
-    echo "$as_me: exit $exit_status"
+      $as_echo "$as_me: caught signal $ac_signal"
+    $as_echo "$as_me: exit $exit_status"
   } >&5
   rm -f core *.core core.conftest.* &&
     rm -f -r conftest* confdefs* conf$$* $ac_clean_files &&
     exit $exit_status
 ' 0
 for ac_signal in 1 2 13 15; do
-  trap 'ac_signal='$ac_signal'; { (exit 1); exit 1; }' $ac_signal
+  trap 'ac_signal='$ac_signal'; as_fn_exit 1' $ac_signal
 done
 ac_signal=0
 
 # confdefs.h avoids OS command line length limits that DEFS can exceed.
 rm -f -r conftest* confdefs.h
 
+$as_echo "/* confdefs.h */" > confdefs.h
+
 # Predefined preprocessor variables.
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_NAME "$PACKAGE_NAME"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_TARNAME "$PACKAGE_TARNAME"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_VERSION "$PACKAGE_VERSION"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_STRING "$PACKAGE_STRING"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
 _ACEOF
 
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_URL "$PACKAGE_URL"
+_ACEOF
+
 
 # Let the site file select an alternate cache file if it wants to.
-# Prefer explicitly selected file to automatically selected ones.
+# Prefer an explicitly selected file to automatically selected ones.
+ac_site_file1=NONE
+ac_site_file2=NONE
 if test -n "$CONFIG_SITE"; then
-  set x "$CONFIG_SITE"
+  # We do not want a PATH search for config.site.
+  case $CONFIG_SITE in #((
+    -*)  ac_site_file1=./$CONFIG_SITE;;
+    */*) ac_site_file1=$CONFIG_SITE;;
+    *)   ac_site_file1=./$CONFIG_SITE;;
+  esac
 elif test "x$prefix" != xNONE; then
-  set x "$prefix/share/config.site" "$prefix/etc/config.site"
+  ac_site_file1=$prefix/share/config.site
+  ac_site_file2=$prefix/etc/config.site
 else
-  set x "$ac_default_prefix/share/config.site" \
-	"$ac_default_prefix/etc/config.site"
+  ac_site_file1=$ac_default_prefix/share/config.site
+  ac_site_file2=$ac_default_prefix/etc/config.site
 fi
-shift
-for ac_site_file
+for ac_site_file in "$ac_site_file1" "$ac_site_file2"
 do
-  if test -r "$ac_site_file"; then
-    { echo "$as_me:$LINENO: loading site script $ac_site_file" >&5
-echo "$as_me: loading site script $ac_site_file" >&6;}
+  test "x$ac_site_file" = xNONE && continue
+  if test /dev/null != "$ac_site_file" && test -r "$ac_site_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading site script $ac_site_file" >&5
+$as_echo "$as_me: loading site script $ac_site_file" >&6;}
     sed 's/^/| /' "$ac_site_file" >&5
-    . "$ac_site_file"
+    . "$ac_site_file" \
+      || { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "failed to load site script $ac_site_file
+See \`config.log' for more details" "$LINENO" 5; }
   fi
 done
 
 if test -r "$cache_file"; then
-  # Some versions of bash will fail to source /dev/null (special
-  # files actually), so we avoid doing that.
-  if test -f "$cache_file"; then
-    { echo "$as_me:$LINENO: loading cache $cache_file" >&5
-echo "$as_me: loading cache $cache_file" >&6;}
+  # Some versions of bash will fail to source /dev/null (special files
+  # actually), so we avoid doing that.  DJGPP emulates it as a regular file.
+  if test /dev/null != "$cache_file" && test -f "$cache_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading cache $cache_file" >&5
+$as_echo "$as_me: loading cache $cache_file" >&6;}
     case $cache_file in
       [\\/]* | ?:[\\/]* ) . "$cache_file";;
       *)                      . "./$cache_file";;
     esac
   fi
 else
-  { echo "$as_me:$LINENO: creating cache $cache_file" >&5
-echo "$as_me: creating cache $cache_file" >&6;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: creating cache $cache_file" >&5
+$as_echo "$as_me: creating cache $cache_file" >&6;}
   >$cache_file
 fi
 
@@ -1876,68 +2563,56 @@
   eval ac_new_val=\$ac_env_${ac_var}_value
   case $ac_old_set,$ac_new_set in
     set,)
-      { echo "$as_me:$LINENO: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
-echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
+$as_echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
       ac_cache_corrupted=: ;;
     ,set)
-      { echo "$as_me:$LINENO: error: \`$ac_var' was not set in the previous run" >&5
-echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was not set in the previous run" >&5
+$as_echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
       ac_cache_corrupted=: ;;
     ,);;
     *)
       if test "x$ac_old_val" != "x$ac_new_val"; then
-	{ echo "$as_me:$LINENO: error: \`$ac_var' has changed since the previous run:" >&5
-echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
-	{ echo "$as_me:$LINENO:   former value:  $ac_old_val" >&5
-echo "$as_me:   former value:  $ac_old_val" >&2;}
-	{ echo "$as_me:$LINENO:   current value: $ac_new_val" >&5
-echo "$as_me:   current value: $ac_new_val" >&2;}
-	ac_cache_corrupted=:
+	# differences in whitespace do not lead to failure.
+	ac_old_val_w=`echo x $ac_old_val`
+	ac_new_val_w=`echo x $ac_new_val`
+	if test "$ac_old_val_w" != "$ac_new_val_w"; then
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' has changed since the previous run:" >&5
+$as_echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
+	  ac_cache_corrupted=:
+	else
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
+$as_echo "$as_me: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&2;}
+	  eval $ac_var=\$ac_old_val
+	fi
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   former value:  \`$ac_old_val'" >&5
+$as_echo "$as_me:   former value:  \`$ac_old_val'" >&2;}
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   current value: \`$ac_new_val'" >&5
+$as_echo "$as_me:   current value: \`$ac_new_val'" >&2;}
       fi;;
   esac
   # Pass precious variables to config.status.
   if test "$ac_new_set" = set; then
     case $ac_new_val in
-    *\'*) ac_arg=$ac_var=`echo "$ac_new_val" | sed "s/'/'\\\\\\\\''/g"` ;;
+    *\'*) ac_arg=$ac_var=`$as_echo "$ac_new_val" | sed "s/'/'\\\\\\\\''/g"` ;;
     *) ac_arg=$ac_var=$ac_new_val ;;
     esac
     case " $ac_configure_args " in
       *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
-      *) ac_configure_args="$ac_configure_args '$ac_arg'" ;;
+      *) as_fn_append ac_configure_args " '$ac_arg'" ;;
     esac
   fi
 done
 if $ac_cache_corrupted; then
-  { echo "$as_me:$LINENO: error: changes in the environment can compromise the build" >&5
-echo "$as_me: error: changes in the environment can compromise the build" >&2;}
-  { { echo "$as_me:$LINENO: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&5
-echo "$as_me: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: changes in the environment can compromise the build" >&5
+$as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
+  as_fn_error $? "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
+fi
+## -------------------- ##
+## Main body of script. ##
+## -------------------- ##
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -1971,9 +2646,7 @@
   fi
 done
 if test -z "$ac_aux_dir"; then
-  { { echo "$as_me:$LINENO: error: cannot find install-sh or install.sh in build-aux \"$srcdir\"/build-aux" >&5
-echo "$as_me: error: cannot find install-sh or install.sh in build-aux \"$srcdir\"/build-aux" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot find install-sh, install.sh, or shtool in build-aux \"$srcdir\"/build-aux" "$LINENO" 5
 fi
 
 # These three variables are undocumented and unsupported,
@@ -1985,14 +2658,6 @@
 ac_configure="$SHELL $ac_aux_dir/configure"  # Please don't use this var.
 
 
-case m4 in
-  [\\/]* | ?:[\\/]* ) ac_macro_dir=m4         ;;
-  *)                      ac_macro_dir=$srcdir/m4 ;;
-esac
-test -d "$ac_macro_dir" ||
-  { { echo "$as_me:$LINENO: error: cannot find macro directory \`m4'" >&5
-echo "$as_me: error: cannot find macro directory \`m4'" >&2;}
-   { (exit 1); exit 1; }; }
 
 
 
@@ -2011,22 +2676,23 @@
 # SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
 # OS/2's system install, which has a completely different semantic
 # ./install, which can be erroneously created by make from ./install.sh.
-{ echo "$as_me:$LINENO: checking for a BSD-compatible install" >&5
-echo $ECHO_N "checking for a BSD-compatible install... $ECHO_C" >&6; }
+# Reject install programs that cannot install multiple files.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a BSD-compatible install" >&5
+$as_echo_n "checking for a BSD-compatible install... " >&6; }
 if test -z "$INSTALL"; then
-if test "${ac_cv_path_install+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+if ${ac_cv_path_install+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  # Account for people who put trailing slashes in PATH elements.
-case $as_dir/ in
-  ./ | .// | /cC/* | \
+    # Account for people who put trailing slashes in PATH elements.
+case $as_dir/ in #((
+  ./ | .// | /[cC]/* | \
   /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
-  ?:\\/os2\\/install\\/* | ?:\\/OS2\\/INSTALL\\/* | \
+  ?:[\\/]os2[\\/]install[\\/]* | ?:[\\/]OS2[\\/]INSTALL[\\/]* | \
   /usr/ucb/* ) ;;
   *)
     # OSF1 and SCO ODT 3.0 have their own names for install.
@@ -2034,7 +2700,7 @@
     # by default.
     for ac_prog in ginstall scoinst install; do
       for ac_exec_ext in '' $ac_executable_extensions; do
-	if { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_executable_p "$as_dir/$ac_prog$ac_exec_ext"; }; then
+	if { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; }; then
 	  if test $ac_prog = install &&
 	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
 	    # AIX install.  It has an incompatible calling convention.
@@ -2044,17 +2710,29 @@
 	    # program-specific install script used by HP pwplus--don't use.
 	    :
 	  else
-	    ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
-	    break 3
+	    rm -rf conftest.one conftest.two conftest.dir
+	    echo one > conftest.one
+	    echo two > conftest.two
+	    mkdir conftest.dir
+	    if "$as_dir/$ac_prog$ac_exec_ext" -c conftest.one conftest.two "`pwd`/conftest.dir" &&
+	      test -s conftest.one && test -s conftest.two &&
+	      test -s conftest.dir/conftest.one &&
+	      test -s conftest.dir/conftest.two
+	    then
+	      ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
+	      break 3
+	    fi
 	  fi
 	fi
       done
     done
     ;;
 esac
-done
+
+  done
 IFS=$as_save_IFS
 
+rm -rf conftest.one conftest.two conftest.dir
 
 fi
   if test "${ac_cv_path_install+set}" = set; then
@@ -2067,8 +2745,8 @@
     INSTALL=$ac_install_sh
   fi
 fi
-{ echo "$as_me:$LINENO: result: $INSTALL" >&5
-echo "${ECHO_T}$INSTALL" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $INSTALL" >&5
+$as_echo "$INSTALL" >&6; }
 
 # Use test -z because SunOS4 sh mishandles braces in ${var-val}.
 # It thinks the first close brace ends the variable substitution.
@@ -2078,8 +2756,8 @@
 
 test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
-{ echo "$as_me:$LINENO: checking whether build environment is sane" >&5
-echo $ECHO_N "checking whether build environment is sane... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether build environment is sane" >&5
+$as_echo_n "checking whether build environment is sane... " >&6; }
 # Just in case
 sleep 1
 echo timestamp > conftest.file
@@ -2102,11 +2780,8 @@
       # if, for instance, CONFIG_SHELL is bash and it inherits a
       # broken ls alias from the environment.  This has actually
       # happened.  Such a system could not be considered "sane".
-      { { echo "$as_me:$LINENO: error: ls -t appears to fail.  Make sure there is not a broken
-alias in your environment" >&5
-echo "$as_me: error: ls -t appears to fail.  Make sure there is not a broken
-alias in your environment" >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "ls -t appears to fail.  Make sure there is not a broken
+alias in your environment" "$LINENO" 5
    fi
 
    test "$2" = conftest.file
@@ -2115,26 +2790,20 @@
    # Ok.
    :
 else
-   { { echo "$as_me:$LINENO: error: newly created file is older than distributed files!
-Check your system clock" >&5
-echo "$as_me: error: newly created file is older than distributed files!
-Check your system clock" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "newly created file is older than distributed files!
+Check your system clock" "$LINENO" 5
 fi
-{ echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 test "$program_prefix" != NONE &&
   program_transform_name="s&^&$program_prefix&;$program_transform_name"
 # Use a double $ so make ignores it.
 test "$program_suffix" != NONE &&
   program_transform_name="s&\$&$program_suffix&;$program_transform_name"
-# Double any \ or $.  echo might interpret backslashes.
+# Double any \ or $.
 # By default was `s,x,x', remove it if useless.
-cat <<\_ACEOF >conftest.sed
-s/[\\$]/&&/g;s/;s,x,x,$//
-_ACEOF
-program_transform_name=`echo $program_transform_name | sed -f conftest.sed`
-rm -f conftest.sed
+ac_script='s/[\\$]/&&/g;s/;s,x,x,$//'
+program_transform_name=`$as_echo "$program_transform_name" | sed "$ac_script"`
 
 # expand $ac_aux_dir to an absolute path
 am_aux_dir=`cd $ac_aux_dir && pwd`
@@ -2145,8 +2814,8 @@
   am_missing_run="$MISSING --run "
 else
   am_missing_run=
-  { echo "$as_me:$LINENO: WARNING: \`missing' script is too old or missing" >&5
-echo "$as_me: WARNING: \`missing' script is too old or missing" >&2;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`missing' script is too old or missing" >&5
+$as_echo "$as_me: WARNING: \`missing' script is too old or missing" >&2;}
 fi
 
 if mkdir -p --version . >/dev/null 2>&1 && test ! -d ./--version; then
@@ -2186,10 +2855,10 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_AWK+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_AWK+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$AWK"; then
   ac_cv_prog_AWK="$AWK" # Let the user override the test.
@@ -2199,43 +2868,44 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_AWK="$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 AWK=$ac_cv_prog_AWK
 if test -n "$AWK"; then
-  { echo "$as_me:$LINENO: result: $AWK" >&5
-echo "${ECHO_T}$AWK" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AWK" >&5
+$as_echo "$AWK" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
   test -n "$AWK" && break
 done
 
-{ echo "$as_me:$LINENO: checking whether ${MAKE-make} sets \$(MAKE)" >&5
-echo $ECHO_N "checking whether ${MAKE-make} sets \$(MAKE)... $ECHO_C" >&6; }
-set x ${MAKE-make}; ac_make=`echo "$2" | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
-if { as_var=ac_cv_prog_make_${ac_make}_set; eval "test \"\${$as_var+set}\" = set"; }; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ${MAKE-make} sets \$(MAKE)" >&5
+$as_echo_n "checking whether ${MAKE-make} sets \$(MAKE)... " >&6; }
+set x ${MAKE-make}
+ac_make=`$as_echo "$2" | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
+if eval \${ac_cv_prog_make_${ac_make}_set+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   cat >conftest.make <<\_ACEOF
 SHELL = /bin/sh
 all:
 	@echo '@@@%%%=$(MAKE)=@@@%%%'
 _ACEOF
-# GNU make sometimes prints "make[1]: Entering...", which would confuse us.
+# GNU make sometimes prints "make[1]: Entering ...", which would confuse us.
 case `${MAKE-make} -f conftest.make 2>/dev/null` in
   *@@@%%%=?*=@@@%%%*)
     eval ac_cv_prog_make_${ac_make}_set=yes;;
@@ -2245,12 +2915,12 @@
 rm -f conftest.make
 fi
 if eval test \$ac_cv_prog_make_${ac_make}_set = yes; then
-  { echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
   SET_MAKE=
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
   SET_MAKE="MAKE=${MAKE-make}"
 fi
 
@@ -2266,9 +2936,7 @@
 # test to see if srcdir already configured
 if test "`cd $srcdir && pwd`" != "`pwd`" &&
    test -f $srcdir/config.status; then
-  { { echo "$as_me:$LINENO: error: source directory already configured; run \"make distclean\" there first" >&5
-echo "$as_me: error: source directory already configured; run \"make distclean\" there first" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "source directory already configured; run \"make distclean\" there first" "$LINENO" 5
 fi
 
 # test whether we have cygpath
@@ -2321,10 +2989,10 @@
   if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
 set dummy ${ac_tool_prefix}strip; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_STRIP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_STRIP+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$STRIP"; then
   ac_cv_prog_STRIP="$STRIP" # Let the user override the test.
@@ -2334,25 +3002,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 STRIP=$ac_cv_prog_STRIP
 if test -n "$STRIP"; then
-  { echo "$as_me:$LINENO: result: $STRIP" >&5
-echo "${ECHO_T}$STRIP" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $STRIP" >&5
+$as_echo "$STRIP" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -2361,10 +3029,10 @@
   ac_ct_STRIP=$STRIP
   # Extract the first word of "strip", so it can be a program name with args.
 set dummy strip; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_ac_ct_STRIP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_STRIP+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_STRIP"; then
   ac_cv_prog_ac_ct_STRIP="$ac_ct_STRIP" # Let the user override the test.
@@ -2374,25 +3042,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_STRIP="strip"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_STRIP=$ac_cv_prog_ac_ct_STRIP
 if test -n "$ac_ct_STRIP"; then
-  { echo "$as_me:$LINENO: result: $ac_ct_STRIP" >&5
-echo "${ECHO_T}$ac_ct_STRIP" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_STRIP" >&5
+$as_echo "$ac_ct_STRIP" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
   if test "x$ac_ct_STRIP" = x; then
@@ -2400,12 +3068,8 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ echo "$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&5
-echo "$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&2;}
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
     STRIP=$ac_ct_STRIP
@@ -2436,35 +3100,27 @@
 #
 # Make sure we can run config.sub.
 $SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
-  { { echo "$as_me:$LINENO: error: cannot run $SHELL $ac_aux_dir/config.sub" >&5
-echo "$as_me: error: cannot run $SHELL $ac_aux_dir/config.sub" >&2;}
-   { (exit 1); exit 1; }; }
-
-{ echo "$as_me:$LINENO: checking build system type" >&5
-echo $ECHO_N "checking build system type... $ECHO_C" >&6; }
-if test "${ac_cv_build+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
+$as_echo_n "checking build system type... " >&6; }
+if ${ac_cv_build+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_build_alias=$build_alias
 test "x$ac_build_alias" = x &&
   ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
 test "x$ac_build_alias" = x &&
-  { { echo "$as_me:$LINENO: error: cannot guess build type; you must specify one" >&5
-echo "$as_me: error: cannot guess build type; you must specify one" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
 ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
-  { { echo "$as_me:$LINENO: error: $SHELL $ac_aux_dir/config.sub $ac_build_alias failed" >&5
-echo "$as_me: error: $SHELL $ac_aux_dir/config.sub $ac_build_alias failed" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
 
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_build" >&5
-echo "${ECHO_T}$ac_cv_build" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
+$as_echo "$ac_cv_build" >&6; }
 case $ac_cv_build in
 *-*-*) ;;
-*) { { echo "$as_me:$LINENO: error: invalid value of canonical build" >&5
-echo "$as_me: error: invalid value of canonical build" >&2;}
-   { (exit 1); exit 1; }; };;
+*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5;;
 esac
 build=$ac_cv_build
 ac_save_IFS=$IFS; IFS='-'
@@ -2480,28 +3136,24 @@
 case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
 
 
-{ echo "$as_me:$LINENO: checking host system type" >&5
-echo $ECHO_N "checking host system type... $ECHO_C" >&6; }
-if test "${ac_cv_host+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
+$as_echo_n "checking host system type... " >&6; }
+if ${ac_cv_host+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test "x$host_alias" = x; then
   ac_cv_host=$ac_cv_build
 else
   ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
-    { { echo "$as_me:$LINENO: error: $SHELL $ac_aux_dir/config.sub $host_alias failed" >&5
-echo "$as_me: error: $SHELL $ac_aux_dir/config.sub $host_alias failed" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
 fi
 
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_host" >&5
-echo "${ECHO_T}$ac_cv_host" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_host" >&5
+$as_echo "$ac_cv_host" >&6; }
 case $ac_cv_host in
 *-*-*) ;;
-*) { { echo "$as_me:$LINENO: error: invalid value of canonical host" >&5
-echo "$as_me: error: invalid value of canonical host" >&2;}
-   { (exit 1); exit 1; }; };;
+*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5;;
 esac
 host=$ac_cv_host
 ac_save_IFS=$IFS; IFS='-'
@@ -2564,16 +3216,16 @@
 # Check for DEBUG flag
 #
 
-					{ echo "$as_me:$LINENO: checking for --enable-debug" >&5
-echo $ECHO_N "checking for --enable-debug... $ECHO_C" >&6; }
+					{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for --enable-debug" >&5
+$as_echo_n "checking for --enable-debug... " >&6; }
 					# Check whether --enable-debug was given.
-if test "${enable_debug+set}" = set; then
+if test "${enable_debug+set}" = set; then :
   enableval=$enable_debug;
 fi
 
 	test "x$enable_debug" != xyes 		&& enable_debug=no
-	{ echo "$as_me:$LINENO: result: $enable_debug" >&5
-echo "${ECHO_T}$enable_debug" >&6; }
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_debug" >&5
+$as_echo "$enable_debug" >&6; }
 
 
 if test x"$enable_debug" = xyes; then
@@ -2587,25 +3239,17 @@
 
 if test "x$enable_debug" = xyes ; then
 
-cat >>confdefs.h <<\_ACEOF
-#define UPNP_HAVE_DEBUG 1
-_ACEOF
+$as_echo "#define UPNP_HAVE_DEBUG 1" >>confdefs.h
 
 
-cat >>confdefs.h <<\_ACEOF
-#define DEBUG 1
-_ACEOF
+$as_echo "#define DEBUG 1" >>confdefs.h
 
 else
 
-cat >>confdefs.h <<\_ACEOF
-#define NO_DEBUG 1
-_ACEOF
+$as_echo "#define NO_DEBUG 1" >>confdefs.h
 
 
-cat >>confdefs.h <<\_ACEOF
-#define NDEBUG 1
-_ACEOF
+$as_echo "#define NDEBUG 1" >>confdefs.h
 
 fi
 
@@ -2614,16 +3258,16 @@
 # Check for libupnp subsets
 #
 
-					{ echo "$as_me:$LINENO: checking for --enable-client" >&5
-echo $ECHO_N "checking for --enable-client... $ECHO_C" >&6; }
+					{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for --enable-client" >&5
+$as_echo_n "checking for --enable-client... " >&6; }
 					# Check whether --enable-client was given.
-if test "${enable_client+set}" = set; then
+if test "${enable_client+set}" = set; then :
   enableval=$enable_client;
 fi
 
 	test "x$enable_client" != xno 		&& enable_client=yes
-	{ echo "$as_me:$LINENO: result: $enable_client" >&5
-echo "${ECHO_T}$enable_client" >&6; }
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_client" >&5
+$as_echo "$enable_client" >&6; }
 
 
 if test x"$enable_client" = xyes; then
@@ -2637,24 +3281,22 @@
 
 if test "x$enable_client" = xyes ; then
 
-cat >>confdefs.h <<\_ACEOF
-#define UPNP_HAVE_CLIENT 1
-_ACEOF
+$as_echo "#define UPNP_HAVE_CLIENT 1" >>confdefs.h
 
 fi
 
 
 
-					{ echo "$as_me:$LINENO: checking for --enable-device" >&5
-echo $ECHO_N "checking for --enable-device... $ECHO_C" >&6; }
+					{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for --enable-device" >&5
+$as_echo_n "checking for --enable-device... " >&6; }
 					# Check whether --enable-device was given.
-if test "${enable_device+set}" = set; then
+if test "${enable_device+set}" = set; then :
   enableval=$enable_device;
 fi
 
 	test "x$enable_device" != xno 		&& enable_device=yes
-	{ echo "$as_me:$LINENO: result: $enable_device" >&5
-echo "${ECHO_T}$enable_device" >&6; }
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_device" >&5
+$as_echo "$enable_device" >&6; }
 
 
 if test x"$enable_device" = xyes; then
@@ -2668,9 +3310,7 @@
 
 if test "x$enable_device" = xyes ; then
 
-cat >>confdefs.h <<\_ACEOF
-#define UPNP_HAVE_DEVICE 1
-_ACEOF
+$as_echo "#define UPNP_HAVE_DEVICE 1" >>confdefs.h
 
 fi
 
@@ -2679,16 +3319,16 @@
 	enable_webserver=no
 else
 
-					{ echo "$as_me:$LINENO: checking for --enable-webserver" >&5
-echo $ECHO_N "checking for --enable-webserver... $ECHO_C" >&6; }
+					{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for --enable-webserver" >&5
+$as_echo_n "checking for --enable-webserver... " >&6; }
 					# Check whether --enable-webserver was given.
-if test "${enable_webserver+set}" = set; then
+if test "${enable_webserver+set}" = set; then :
   enableval=$enable_webserver;
 fi
 
 	test "x$enable_webserver" != xno 		&& enable_webserver=yes
-	{ echo "$as_me:$LINENO: result: $enable_webserver" >&5
-echo "${ECHO_T}$enable_webserver" >&6; }
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_webserver" >&5
+$as_echo "$enable_webserver" >&6; }
 
 
 if test x"$enable_webserver" = xyes; then
@@ -2713,24 +3353,22 @@
 
 if test "x$enable_webserver" = xyes ; then
 
-cat >>confdefs.h <<\_ACEOF
-#define UPNP_HAVE_WEBSERVER 1
-_ACEOF
+$as_echo "#define UPNP_HAVE_WEBSERVER 1" >>confdefs.h
 
 fi
 
 
 
-					{ echo "$as_me:$LINENO: checking for --enable-tools" >&5
-echo $ECHO_N "checking for --enable-tools... $ECHO_C" >&6; }
+					{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for --enable-tools" >&5
+$as_echo_n "checking for --enable-tools... " >&6; }
 					# Check whether --enable-tools was given.
-if test "${enable_tools+set}" = set; then
+if test "${enable_tools+set}" = set; then :
   enableval=$enable_tools;
 fi
 
 	test "x$enable_tools" != xno 		&& enable_tools=yes
-	{ echo "$as_me:$LINENO: result: $enable_tools" >&5
-echo "${ECHO_T}$enable_tools" >&6; }
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_tools" >&5
+$as_echo "$enable_tools" >&6; }
 
 
 if test x"$enable_tools" = xyes; then
@@ -2744,24 +3382,22 @@
 
 if test "x$enable_tools" = xyes ; then
 
-cat >>confdefs.h <<\_ACEOF
-#define UPNP_HAVE_TOOLS 1
-_ACEOF
+$as_echo "#define UPNP_HAVE_TOOLS 1" >>confdefs.h
 
 fi
 
 
 
-					{ echo "$as_me:$LINENO: checking for --enable-samples" >&5
-echo $ECHO_N "checking for --enable-samples... $ECHO_C" >&6; }
+					{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for --enable-samples" >&5
+$as_echo_n "checking for --enable-samples... " >&6; }
 					# Check whether --enable-samples was given.
-if test "${enable_samples+set}" = set; then
+if test "${enable_samples+set}" = set; then :
   enableval=$enable_samples;
 fi
 
 	test "x$enable_samples" != xno 		&& enable_samples=yes
-	{ echo "$as_me:$LINENO: result: $enable_samples" >&5
-echo "${ECHO_T}$enable_samples" >&6; }
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_samples" >&5
+$as_echo "$enable_samples" >&6; }
 
 
 if test x"$enable_samples" = xyes; then
@@ -2783,11 +3419,11 @@
 # version on that.
 #
 docdir="${datadir}/doc/${PACKAGE_NAME}-${PACKAGE_VERSION}"
-{ echo "$as_me:$LINENO: checking for documentation directory" >&5
-echo $ECHO_N "checking for documentation directory... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for documentation directory" >&5
+$as_echo_n "checking for documentation directory... " >&6; }
 
 # Check whether --with-documentation was given.
-if test "${with_documentation+set}" = set; then
+if test "${with_documentation+set}" = set; then :
   withval=$with_documentation;
 else
   with_documentation=no
@@ -2811,8 +3447,8 @@
 fi
 
 
-{ echo "$as_me:$LINENO: result: $docdir" >&5
-echo "${ECHO_T}$docdir" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $docdir" >&5
+$as_echo "$docdir" >&6; }
 
 
 #
@@ -2826,10 +3462,10 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
@@ -2839,25 +3475,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { echo "$as_me:$LINENO: result: $CC" >&5
-echo "${ECHO_T}$CC" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -2866,10 +3502,10 @@
   ac_ct_CC=$CC
   # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
   ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
@@ -2879,25 +3515,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_CC="gcc"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-echo "${ECHO_T}$ac_ct_CC" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
   if test "x$ac_ct_CC" = x; then
@@ -2905,12 +3541,8 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ echo "$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&5
-echo "$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&2;}
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
     CC=$ac_ct_CC
@@ -2923,10 +3555,10 @@
           if test -n "$ac_tool_prefix"; then
     # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
@@ -2936,25 +3568,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { echo "$as_me:$LINENO: result: $CC" >&5
-echo "${ECHO_T}$CC" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -2963,10 +3595,10 @@
 if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
@@ -2977,18 +3609,18 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
      fi
     ac_cv_prog_CC="cc"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 if test $ac_prog_rejected = yes; then
@@ -3007,11 +3639,11 @@
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { echo "$as_me:$LINENO: result: $CC" >&5
-echo "${ECHO_T}$CC" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -3022,10 +3654,10 @@
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
@@ -3035,25 +3667,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { echo "$as_me:$LINENO: result: $CC" >&5
-echo "${ECHO_T}$CC" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -3066,10 +3698,10 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
   ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
@@ -3079,25 +3711,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-echo "${ECHO_T}$ac_ct_CC" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -3109,12 +3741,8 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ echo "$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&5
-echo "$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&2;}
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
     CC=$ac_ct_CC
@@ -3124,51 +3752,37 @@
 fi
 
 
-test -z "$CC" && { { echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
 
 # Provide some information about the compiler.
-echo "$as_me:$LINENO: checking for C compiler version" >&5
-ac_compiler=`set X $ac_compile; echo $2`
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3180,59 +3794,55 @@
 }
 _ACEOF
 ac_clean_files_save=$ac_clean_files
-ac_clean_files="$ac_clean_files a.out a.exe b.out"
+ac_clean_files="$ac_clean_files a.out a.out.dSYM a.exe b.out"
 # Try to create an executable without -o first, disregard a.out.
 # It will help us diagnose broken compilers, and finding out an intuition
 # of exeext.
-{ echo "$as_me:$LINENO: checking for C compiler default output file name" >&5
-echo $ECHO_N "checking for C compiler default output file name... $ECHO_C" >&6; }
-ac_link_default=`echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
-#
-# List of possible output files, starting from the most likely.
-# The algorithm is not robust to junk in `.', hence go to wildcards (a.*)
-# only as a last resort.  b.out is created by i960 compilers.
-ac_files='a_out.exe a.exe conftest.exe a.out conftest a.* conftest.* b.out'
-#
-# The IRIX 6 linker writes into existing files which may not be
-# executable, retaining their permissions.  Remove them first so a
-# subsequent execution test works.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler works" >&5
+$as_echo_n "checking whether the C compiler works... " >&6; }
+ac_link_default=`$as_echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
+
+# The possible output files:
+ac_files="a.out conftest.exe conftest a.exe a_out.exe b.out conftest.*"
+
 ac_rmfiles=
 for ac_file in $ac_files
 do
   case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.o | *.obj ) ;;
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
     * ) ac_rmfiles="$ac_rmfiles $ac_file";;
   esac
 done
 rm -f $ac_rmfiles
 
-if { (ac_try="$ac_link_default"
+if { { ac_try="$ac_link_default"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_link_default") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
   # Autoconf-2.13 could set the ac_cv_exeext variable to `no'.
 # So ignore a value of `no', otherwise this would lead to `EXEEXT = no'
 # in a Makefile.  We should not override ac_cv_exeext if it was cached,
 # so that the user can short-circuit this test for compilers unknown to
 # Autoconf.
-for ac_file in $ac_files
+for ac_file in $ac_files ''
 do
   test -f "$ac_file" || continue
   case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.o | *.obj )
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj )
 	;;
     [ab].out )
 	# We found the default executable, but exeext='' is most
 	# certainly right.
 	break;;
     *.* )
-        if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
+	if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
 	then :; else
 	   ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
 	fi
@@ -3249,76 +3859,43 @@
 test "$ac_cv_exeext" = no && ac_cv_exeext=
 
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-{ { echo "$as_me:$LINENO: error: C compiler cannot create executables
-See \`config.log' for more details." >&5
-echo "$as_me: error: C compiler cannot create executables
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }
+  ac_file=''
 fi
+if test -z "$ac_file"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+$as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "C compiler cannot create executables
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler default output file name" >&5
+$as_echo_n "checking for C compiler default output file name... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_file" >&5
+$as_echo "$ac_file" >&6; }
 ac_exeext=$ac_cv_exeext
-{ echo "$as_me:$LINENO: result: $ac_file" >&5
-echo "${ECHO_T}$ac_file" >&6; }
 
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ echo "$as_me:$LINENO: checking whether the C compiler works" >&5
-echo $ECHO_N "checking whether the C compiler works... $ECHO_C" >&6; }
-# FIXME: These cross compiler hacks should be removed for Autoconf 3.0
-# If not cross compiling, check that we can run a simple program.
-if test "$cross_compiling" != yes; then
-  if { ac_try='./$ac_file'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-    cross_compiling=no
-  else
-    if test "$cross_compiling" = maybe; then
-	cross_compiling=yes
-    else
-	{ { echo "$as_me:$LINENO: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." >&5
-echo "$as_me: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-  fi
-fi
-{ echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6; }
-
-rm -f a.out a.exe conftest$ac_cv_exeext b.out
+rm -f -r a.out a.out.dSYM a.exe conftest$ac_cv_exeext b.out
 ac_clean_files=$ac_clean_files_save
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ echo "$as_me:$LINENO: checking whether we are cross compiling" >&5
-echo $ECHO_N "checking whether we are cross compiling... $ECHO_C" >&6; }
-{ echo "$as_me:$LINENO: result: $cross_compiling" >&5
-echo "${ECHO_T}$cross_compiling" >&6; }
-
-{ echo "$as_me:$LINENO: checking for suffix of executables" >&5
-echo $ECHO_N "checking for suffix of executables... $ECHO_C" >&6; }
-if { (ac_try="$ac_link"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of executables" >&5
+$as_echo_n "checking for suffix of executables... " >&6; }
+if { { ac_try="$ac_link"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_link") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
   # If both `conftest.exe' and `conftest' are `present' (well, observable)
 # catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
 # work properly (i.e., refer to `conftest.exe'), while it won't with
@@ -3326,37 +3903,90 @@
 for ac_file in conftest.exe conftest conftest.*; do
   test -f "$ac_file" || continue
   case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.o | *.obj ) ;;
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
     *.* ) ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
 	  break;;
     * ) break;;
   esac
 done
 else
-  { { echo "$as_me:$LINENO: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." >&5
-echo "$as_me: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
-rm -f conftest$ac_cv_exeext
-{ echo "$as_me:$LINENO: result: $ac_cv_exeext" >&5
-echo "${ECHO_T}$ac_cv_exeext" >&6; }
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot compute suffix of executables: cannot compile and link
+See \`config.log' for more details" "$LINENO" 5; }
+fi
+rm -f conftest conftest$ac_cv_exeext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_exeext" >&5
+$as_echo "$ac_cv_exeext" >&6; }
 
 rm -f conftest.$ac_ext
 EXEEXT=$ac_cv_exeext
 ac_exeext=$EXEEXT
-{ echo "$as_me:$LINENO: checking for suffix of object files" >&5
-echo $ECHO_N "checking for suffix of object files... $ECHO_C" >&6; }
-if test "${ac_cv_objext+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
+int
+main ()
+{
+FILE *f = fopen ("conftest.out", "w");
+ return ferror (f) || fclose (f) != 0;
+
+  ;
+  return 0;
+}
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+ac_clean_files="$ac_clean_files conftest.out"
+# Check that the compiler produces executables we can run.  If not, either
+# the compiler is broken, or we cross compile.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are cross compiling" >&5
+$as_echo_n "checking whether we are cross compiling... " >&6; }
+if test "$cross_compiling" != yes; then
+  { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+  if { ac_try='./conftest$ac_cv_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then
+    cross_compiling=no
+  else
+    if test "$cross_compiling" = maybe; then
+	cross_compiling=yes
+    else
+	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot run C compiled programs.
+If you meant to cross compile, use \`--host'.
+See \`config.log' for more details" "$LINENO" 5; }
+    fi
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cross_compiling" >&5
+$as_echo "$cross_compiling" >&6; }
+
+rm -f conftest.$ac_ext conftest$ac_cv_exeext conftest.out
+ac_clean_files=$ac_clean_files_save
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of object files" >&5
+$as_echo_n "checking for suffix of object files... " >&6; }
+if ${ac_cv_objext+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3368,51 +3998,46 @@
 }
 _ACEOF
 rm -f conftest.o conftest.obj
-if { (ac_try="$ac_compile"
+if { { ac_try="$ac_compile"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_compile") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
   for ac_file in conftest.o conftest.obj conftest.*; do
   test -f "$ac_file" || continue;
   case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf ) ;;
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM ) ;;
     *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
        break;;
   esac
 done
 else
-  echo "$as_me: failed program was:" >&5
+  $as_echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-{ { echo "$as_me:$LINENO: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&5
-echo "$as_me: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot compute suffix of object files: cannot compile
+See \`config.log' for more details" "$LINENO" 5; }
 fi
-
 rm -f conftest.$ac_cv_objext conftest.$ac_ext
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_objext" >&5
-echo "${ECHO_T}$ac_cv_objext" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_objext" >&5
+$as_echo "$ac_cv_objext" >&6; }
 OBJEXT=$ac_cv_objext
 ac_objext=$OBJEXT
-{ echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
-echo $ECHO_N "checking whether we are using the GNU C compiler... $ECHO_C" >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
+$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
+if ${ac_cv_c_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3426,71 +4051,34 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
-echo "${ECHO_T}$ac_cv_c_compiler_gnu" >&6; }
-GCC=`test $ac_compiler_gnu = yes && echo yes`
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
+$as_echo "$ac_cv_c_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GCC=yes
+else
+  GCC=
+fi
 ac_test_CFLAGS=${CFLAGS+set}
 ac_save_CFLAGS=$CFLAGS
-{ echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
-echo $ECHO_N "checking whether $CC accepts -g... $ECHO_C" >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
+$as_echo_n "checking whether $CC accepts -g... " >&6; }
+if ${ac_cv_prog_cc_g+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_save_c_werror_flag=$ac_c_werror_flag
    ac_c_werror_flag=yes
    ac_cv_prog_cc_g=no
    CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3501,51 +4089,11 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3556,52 +4104,12 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_compile "$LINENO"; then :
 
-	ac_c_werror_flag=$ac_save_c_werror_flag
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
 	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3612,59 +4120,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
    ac_c_werror_flag=$ac_save_c_werror_flag
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
-echo "${ECHO_T}$ac_cv_prog_cc_g" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
+$as_echo "$ac_cv_prog_cc_g" >&6; }
 if test "$ac_test_CFLAGS" = set; then
   CFLAGS=$ac_save_CFLAGS
 elif test $ac_cv_prog_cc_g = yes; then
@@ -3680,18 +4147,14 @@
     CFLAGS=
   fi
 fi
-{ echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
-echo $ECHO_N "checking for $CC option to accept ISO C89... $ECHO_C" >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
+$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
+if ${ac_cv_prog_cc_c89+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_cv_prog_cc_c89=no
 ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
@@ -3748,48 +4211,9 @@
 	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
 do
   CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+  if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_c89=$ac_arg
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext
   test "x$ac_cv_prog_cc_c89" != "xno" && break
 done
@@ -3800,17 +4224,19 @@
 # AC_CACHE_VAL
 case "x$ac_cv_prog_cc_c89" in
   x)
-    { echo "$as_me:$LINENO: result: none needed" >&5
-echo "${ECHO_T}none needed" >&6; } ;;
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
+$as_echo "none needed" >&6; } ;;
   xno)
-    { echo "$as_me:$LINENO: result: unsupported" >&5
-echo "${ECHO_T}unsupported" >&6; } ;;
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
+$as_echo "unsupported" >&6; } ;;
   *)
     CC="$CC $ac_cv_prog_cc_c89"
-    { echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
-echo "${ECHO_T}$ac_cv_prog_cc_c89" >&6; } ;;
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
+$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
 esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
 
+fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -3829,8 +4255,8 @@
 .PHONY: am__doit
 END
 # If we don't find an include directive, just comment out the code.
-{ echo "$as_me:$LINENO: checking for style of include used by $am_make" >&5
-echo $ECHO_N "checking for style of include used by $am_make... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for style of include used by $am_make" >&5
+$as_echo_n "checking for style of include used by $am_make... " >&6; }
 am__include="#"
 am__quote=
 _am_result=none
@@ -3857,12 +4283,12 @@
 fi
 
 
-{ echo "$as_me:$LINENO: result: $_am_result" >&5
-echo "${ECHO_T}$_am_result" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $_am_result" >&5
+$as_echo "$_am_result" >&6; }
 rm -f confinc confmf
 
 # Check whether --enable-dependency-tracking was given.
-if test "${enable_dependency_tracking+set}" = set; then
+if test "${enable_dependency_tracking+set}" = set; then :
   enableval=$enable_dependency_tracking;
 fi
 
@@ -3885,10 +4311,10 @@
 
 depcc="$CC"   am_compiler_list=
 
-{ echo "$as_me:$LINENO: checking dependency style of $depcc" >&5
-echo $ECHO_N "checking dependency style of $depcc... $ECHO_C" >&6; }
-if test "${am_cv_CC_dependencies_compiler_type+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dependency style of $depcc" >&5
+$as_echo_n "checking dependency style of $depcc... " >&6; }
+if ${am_cv_CC_dependencies_compiler_type+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
   # We make a subdir and do the tests there.  Otherwise we can end up
@@ -3975,8 +4401,8 @@
 fi
 
 fi
-{ echo "$as_me:$LINENO: result: $am_cv_CC_dependencies_compiler_type" >&5
-echo "${ECHO_T}$am_cv_CC_dependencies_compiler_type" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_CC_dependencies_compiler_type" >&5
+$as_echo "$am_cv_CC_dependencies_compiler_type" >&6; }
 CCDEPMODE=depmode=$am_cv_CC_dependencies_compiler_type
 
 
@@ -3993,22 +4419,18 @@
 
 
 if test "x$CC" != xcc; then
-  { echo "$as_me:$LINENO: checking whether $CC and cc understand -c and -o together" >&5
-echo $ECHO_N "checking whether $CC and cc understand -c and -o together... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC and cc understand -c and -o together" >&5
+$as_echo_n "checking whether $CC and cc understand -c and -o together... " >&6; }
 else
-  { echo "$as_me:$LINENO: checking whether cc understands -c and -o together" >&5
-echo $ECHO_N "checking whether cc understands -c and -o together... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether cc understands -c and -o together" >&5
+$as_echo_n "checking whether cc understands -c and -o together... " >&6; }
 fi
-set dummy $CC; ac_cc=`echo $2 |
+set dummy $CC; ac_cc=`$as_echo "$2" |
 		      sed 's/[^a-zA-Z0-9_]/_/g;s/^[0-9]/_/'`
-if { as_var=ac_cv_prog_cc_${ac_cc}_c_o; eval "test \"\${$as_var+set}\" = set"; }; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+if eval \${ac_cv_prog_cc_${ac_cc}_c_o+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4024,58 +4446,63 @@
 # existing .o file with -o, though they will create one.
 ac_try='$CC -c conftest.$ac_ext -o conftest2.$ac_objext >&5'
 rm -f conftest2.*
-if { (case "(($ac_try" in
+if { { case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_try") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-   test -f conftest2.$ac_objext && { (case "(($ac_try" in
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } &&
+   test -f conftest2.$ac_objext && { { case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_try") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); };
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; };
 then
   eval ac_cv_prog_cc_${ac_cc}_c_o=yes
   if test "x$CC" != xcc; then
     # Test first that cc exists at all.
     if { ac_try='cc -c conftest.$ac_ext >&5'
-  { (case "(($ac_try" in
+  { { case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_try") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then
       ac_try='cc -c conftest.$ac_ext -o conftest2.$ac_objext >&5'
       rm -f conftest2.*
-      if { (case "(($ac_try" in
+      if { { case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_try") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 test -f conftest2.$ac_objext && { (case "(($ac_try" in
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } &&
+	 test -f conftest2.$ac_objext && { { case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_try") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); };
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; };
       then
 	# cc works too.
 	:
@@ -4092,15 +4519,13 @@
 
 fi
 if eval test \$ac_cv_prog_cc_${ac_cc}_c_o = yes; then
-  { echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-cat >>confdefs.h <<\_ACEOF
-#define NO_MINUS_C_MINUS_O 1
-_ACEOF
+$as_echo "#define NO_MINUS_C_MINUS_O 1" >>confdefs.h
 
 fi
 
@@ -4118,7 +4543,7 @@
 fi
 
 # Check whether --enable-shared was given.
-if test "${enable_shared+set}" = set; then
+if test "${enable_shared+set}" = set; then :
   enableval=$enable_shared; p=${PACKAGE-default}
     case $enableval in
     yes) enable_shared=yes ;;
@@ -4142,7 +4567,7 @@
 
 
 # Check whether --enable-static was given.
-if test "${enable_static+set}" = set; then
+if test "${enable_static+set}" = set; then :
   enableval=$enable_static; p=${PACKAGE-default}
     case $enableval in
     yes) enable_static=yes ;;
@@ -4166,7 +4591,7 @@
 
 
 # Check whether --enable-fast-install was given.
-if test "${enable_fast_install+set}" = set; then
+if test "${enable_fast_install+set}" = set; then :
   enableval=$enable_fast_install; p=${PACKAGE-default}
     case $enableval in
     yes) enable_fast_install=yes ;;
@@ -4189,10 +4614,10 @@
 fi
 
 
-{ echo "$as_me:$LINENO: checking for a sed that does not truncate output" >&5
-echo $ECHO_N "checking for a sed that does not truncate output... $ECHO_C" >&6; }
-if test "${lt_cv_path_SED+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a sed that does not truncate output" >&5
+$as_echo_n "checking for a sed that does not truncate output... " >&6; }
+if ${lt_cv_path_SED+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   # Loop through the user's path and test for sed and gsed.
 # Then use that list of sed's as ones to test for truncation.
@@ -4243,48 +4668,43 @@
 fi
 
 SED=$lt_cv_path_SED
-{ echo "$as_me:$LINENO: result: $SED" >&5
-echo "${ECHO_T}$SED" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $SED" >&5
+$as_echo "$SED" >&6; }
 
-{ echo "$as_me:$LINENO: checking for grep that handles long lines and -e" >&5
-echo $ECHO_N "checking for grep that handles long lines and -e... $ECHO_C" >&6; }
-if test "${ac_cv_path_GREP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  # Extract the first word of "grep ggrep" to use in msg output
-if test -z "$GREP"; then
-set dummy grep ggrep; ac_prog_name=$2
-if test "${ac_cv_path_GREP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for grep that handles long lines and -e" >&5
+$as_echo_n "checking for grep that handles long lines and -e... " >&6; }
+if ${ac_cv_path_GREP+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
+  if test -z "$GREP"; then
   ac_path_GREP_found=false
-# Loop through the user's path and test for each of PROGNAME-LIST
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in grep ggrep; do
-  for ac_exec_ext in '' $ac_executable_extensions; do
-    ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
-    { test -f "$ac_path_GREP" && $as_executable_p "$ac_path_GREP"; } || continue
-    # Check for GNU ac_path_GREP and select it if it is found.
+    for ac_prog in grep ggrep; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
+      { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
+# Check for GNU ac_path_GREP and select it if it is found.
   # Check for GNU $ac_path_GREP
 case `"$ac_path_GREP" --version 2>&1` in
 *GNU*)
   ac_cv_path_GREP="$ac_path_GREP" ac_path_GREP_found=:;;
 *)
   ac_count=0
-  echo $ECHO_N "0123456789$ECHO_C" >"conftest.in"
+  $as_echo_n 0123456789 >"conftest.in"
   while :
   do
     cat "conftest.in" "conftest.in" >"conftest.tmp"
     mv "conftest.tmp" "conftest.in"
     cp "conftest.in" "conftest.nl"
-    echo 'GREP' >> "conftest.nl"
+    $as_echo 'GREP' >> "conftest.nl"
     "$ac_path_GREP" -e 'GREP$' -e '-(cannot match)-' < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_GREP_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_GREP="$ac_path_GREP"
@@ -4296,77 +4716,61 @@
   rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
 esac
 
-
-    $ac_path_GREP_found && break 3
+      $ac_path_GREP_found && break 3
+    done
+  done
   done
-done
-
-done
 IFS=$as_save_IFS
-
-
-fi
-
-GREP="$ac_cv_path_GREP"
-if test -z "$GREP"; then
-  { { echo "$as_me:$LINENO: error: no acceptable $ac_prog_name could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-echo "$as_me: error: no acceptable $ac_prog_name could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
+  if test -z "$ac_cv_path_GREP"; then
+    as_fn_error $? "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+  fi
 else
   ac_cv_path_GREP=$GREP
 fi
 
-
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_path_GREP" >&5
-echo "${ECHO_T}$ac_cv_path_GREP" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_GREP" >&5
+$as_echo "$ac_cv_path_GREP" >&6; }
  GREP="$ac_cv_path_GREP"
 
 
-{ echo "$as_me:$LINENO: checking for egrep" >&5
-echo $ECHO_N "checking for egrep... $ECHO_C" >&6; }
-if test "${ac_cv_path_EGREP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
+$as_echo_n "checking for egrep... " >&6; }
+if ${ac_cv_path_EGREP+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
    then ac_cv_path_EGREP="$GREP -E"
    else
-     # Extract the first word of "egrep" to use in msg output
-if test -z "$EGREP"; then
-set dummy egrep; ac_prog_name=$2
-if test "${ac_cv_path_EGREP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
+     if test -z "$EGREP"; then
   ac_path_EGREP_found=false
-# Loop through the user's path and test for each of PROGNAME-LIST
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in egrep; do
-  for ac_exec_ext in '' $ac_executable_extensions; do
-    ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-    { test -f "$ac_path_EGREP" && $as_executable_p "$ac_path_EGREP"; } || continue
-    # Check for GNU ac_path_EGREP and select it if it is found.
+    for ac_prog in egrep; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
+      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
+# Check for GNU ac_path_EGREP and select it if it is found.
   # Check for GNU $ac_path_EGREP
 case `"$ac_path_EGREP" --version 2>&1` in
 *GNU*)
   ac_cv_path_EGREP="$ac_path_EGREP" ac_path_EGREP_found=:;;
 *)
   ac_count=0
-  echo $ECHO_N "0123456789$ECHO_C" >"conftest.in"
+  $as_echo_n 0123456789 >"conftest.in"
   while :
   do
     cat "conftest.in" "conftest.in" >"conftest.tmp"
     mv "conftest.tmp" "conftest.in"
     cp "conftest.in" "conftest.nl"
-    echo 'EGREP' >> "conftest.nl"
+    $as_echo 'EGREP' >> "conftest.nl"
     "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_EGREP_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_EGREP="$ac_path_EGREP"
@@ -4378,39 +4782,28 @@
   rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
 esac
 
-
-    $ac_path_EGREP_found && break 3
+      $ac_path_EGREP_found && break 3
+    done
+  done
   done
-done
-
-done
 IFS=$as_save_IFS
-
-
-fi
-
-EGREP="$ac_cv_path_EGREP"
-if test -z "$EGREP"; then
-  { { echo "$as_me:$LINENO: error: no acceptable $ac_prog_name could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-echo "$as_me: error: no acceptable $ac_prog_name could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
+  if test -z "$ac_cv_path_EGREP"; then
+    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+  fi
 else
   ac_cv_path_EGREP=$EGREP
 fi
 
-
    fi
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_path_EGREP" >&5
-echo "${ECHO_T}$ac_cv_path_EGREP" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
+$as_echo "$ac_cv_path_EGREP" >&6; }
  EGREP="$ac_cv_path_EGREP"
 
 
 
 # Check whether --with-gnu-ld was given.
-if test "${with_gnu_ld+set}" = set; then
+if test "${with_gnu_ld+set}" = set; then :
   withval=$with_gnu_ld; test "$withval" = no || with_gnu_ld=yes
 else
   with_gnu_ld=no
@@ -4419,8 +4812,8 @@
 ac_prog=ld
 if test "$GCC" = yes; then
   # Check if gcc -print-prog-name=ld gives a path.
-  { echo "$as_me:$LINENO: checking for ld used by $CC" >&5
-echo $ECHO_N "checking for ld used by $CC... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ld used by $CC" >&5
+$as_echo_n "checking for ld used by $CC... " >&6; }
   case $host in
   *-*-mingw*)
     # gcc leaves a trailing carriage return which upsets mingw
@@ -4449,14 +4842,14 @@
     ;;
   esac
 elif test "$with_gnu_ld" = yes; then
-  { echo "$as_me:$LINENO: checking for GNU ld" >&5
-echo $ECHO_N "checking for GNU ld... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU ld" >&5
+$as_echo_n "checking for GNU ld... " >&6; }
 else
-  { echo "$as_me:$LINENO: checking for non-GNU ld" >&5
-echo $ECHO_N "checking for non-GNU ld... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for non-GNU ld" >&5
+$as_echo_n "checking for non-GNU ld... " >&6; }
 fi
-if test "${lt_cv_path_LD+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+if ${lt_cv_path_LD+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -z "$LD"; then
   lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
@@ -4486,19 +4879,17 @@
 
 LD="$lt_cv_path_LD"
 if test -n "$LD"; then
-  { echo "$as_me:$LINENO: result: $LD" >&5
-echo "${ECHO_T}$LD" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LD" >&5
+$as_echo "$LD" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-test -z "$LD" && { { echo "$as_me:$LINENO: error: no acceptable ld found in \$PATH" >&5
-echo "$as_me: error: no acceptable ld found in \$PATH" >&2;}
-   { (exit 1); exit 1; }; }
-{ echo "$as_me:$LINENO: checking if the linker ($LD) is GNU ld" >&5
-echo $ECHO_N "checking if the linker ($LD) is GNU ld... $ECHO_C" >&6; }
-if test "${lt_cv_prog_gnu_ld+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
+$as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
+if ${lt_cv_prog_gnu_ld+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   # I'd rather use --version here, but apparently some GNU lds only accept -v.
 case `$LD -v 2>&1 </dev/null` in
@@ -4510,20 +4901,20 @@
   ;;
 esac
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_prog_gnu_ld" >&5
-echo "${ECHO_T}$lt_cv_prog_gnu_ld" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_gnu_ld" >&5
+$as_echo "$lt_cv_prog_gnu_ld" >&6; }
 with_gnu_ld=$lt_cv_prog_gnu_ld
 
 
-{ echo "$as_me:$LINENO: checking for $LD option to reload object files" >&5
-echo $ECHO_N "checking for $LD option to reload object files... $ECHO_C" >&6; }
-if test "${lt_cv_ld_reload_flag+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $LD option to reload object files" >&5
+$as_echo_n "checking for $LD option to reload object files... " >&6; }
+if ${lt_cv_ld_reload_flag+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_cv_ld_reload_flag='-r'
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_ld_reload_flag" >&5
-echo "${ECHO_T}$lt_cv_ld_reload_flag" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_reload_flag" >&5
+$as_echo "$lt_cv_ld_reload_flag" >&6; }
 reload_flag=$lt_cv_ld_reload_flag
 case $reload_flag in
 "" | " "*) ;;
@@ -4540,10 +4931,10 @@
     ;;
 esac
 
-{ echo "$as_me:$LINENO: checking for BSD-compatible nm" >&5
-echo $ECHO_N "checking for BSD-compatible nm... $ECHO_C" >&6; }
-if test "${lt_cv_path_NM+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for BSD-compatible nm" >&5
+$as_echo_n "checking for BSD-compatible nm... " >&6; }
+if ${lt_cv_path_NM+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$NM"; then
   # Let the user override the test.
@@ -4589,25 +4980,25 @@
   test -z "$lt_cv_path_NM" && lt_cv_path_NM=nm
 fi
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_path_NM" >&5
-echo "${ECHO_T}$lt_cv_path_NM" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_path_NM" >&5
+$as_echo "$lt_cv_path_NM" >&6; }
 NM="$lt_cv_path_NM"
 
-{ echo "$as_me:$LINENO: checking whether ln -s works" >&5
-echo $ECHO_N "checking whether ln -s works... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ln -s works" >&5
+$as_echo_n "checking whether ln -s works... " >&6; }
 LN_S=$as_ln_s
 if test "$LN_S" = "ln -s"; then
-  { echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no, using $LN_S" >&5
-echo "${ECHO_T}no, using $LN_S" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no, using $LN_S" >&5
+$as_echo "no, using $LN_S" >&6; }
 fi
 
-{ echo "$as_me:$LINENO: checking how to recognise dependent libraries" >&5
-echo $ECHO_N "checking how to recognise dependent libraries... $ECHO_C" >&6; }
-if test "${lt_cv_deplibs_check_method+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to recognise dependent libraries" >&5
+$as_echo_n "checking how to recognise dependent libraries... " >&6; }
+if ${lt_cv_deplibs_check_method+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_cv_file_magic_cmd='$MAGIC_CMD'
 lt_cv_file_magic_test_file=
@@ -4780,8 +5171,8 @@
 esac
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_deplibs_check_method" >&5
-echo "${ECHO_T}$lt_cv_deplibs_check_method" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_deplibs_check_method" >&5
+$as_echo "$lt_cv_deplibs_check_method" >&6; }
 file_magic_cmd=$lt_cv_file_magic_cmd
 deplibs_check_method=$lt_cv_deplibs_check_method
 test -z "$deplibs_check_method" && deplibs_check_method=unknown
@@ -4800,7 +5191,7 @@
 
 
 # Check whether --enable-libtool-lock was given.
-if test "${enable_libtool_lock+set}" = set; then
+if test "${enable_libtool_lock+set}" = set; then :
   enableval=$enable_libtool_lock;
 fi
 
@@ -4812,11 +5203,11 @@
 ia64-*-hpux*)
   # Find out which ABI we are using.
   echo 'int i;' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
     case `/usr/bin/file conftest.$ac_objext` in
     *ELF-32*)
       HPUX_IA64_MODE="32"
@@ -4830,12 +5221,12 @@
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 4833 "configure"' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  echo '#line 5224 "configure"' > conftest.$ac_ext
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
    if test "$lt_cv_prog_gnu_ld" = yes; then
     case `/usr/bin/file conftest.$ac_objext` in
     *32-bit*)
@@ -4868,11 +5259,11 @@
 x86_64-*linux*|ppc*-*linux*|powerpc*-*linux*|s390*-*linux*|sparc*-*linux*)
   # Find out which ABI we are using.
   echo 'int i;' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
     case `/usr/bin/file conftest.o` in
     *32-bit*)
       case $host in
@@ -4915,10 +5306,10 @@
   # On SCO OpenServer 5, we need -belf to get full-featured binaries.
   SAVE_CFLAGS="$CFLAGS"
   CFLAGS="$CFLAGS -belf"
-  { echo "$as_me:$LINENO: checking whether the C compiler needs -belf" >&5
-echo $ECHO_N "checking whether the C compiler needs -belf... $ECHO_C" >&6; }
-if test "${lt_cv_cc_needs_belf+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler needs -belf" >&5
+$as_echo_n "checking whether the C compiler needs -belf... " >&6; }
+if ${lt_cv_cc_needs_belf+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -4926,11 +5317,7 @@
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-     cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4941,50 +5328,13 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
   lt_cv_cc_needs_belf=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	lt_cv_cc_needs_belf=no
+  lt_cv_cc_needs_belf=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
      ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
@@ -4992,8 +5342,8 @@
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_cc_needs_belf" >&5
-echo "${ECHO_T}$lt_cv_cc_needs_belf" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_cc_needs_belf" >&5
+$as_echo "$lt_cv_cc_needs_belf" >&6; }
   if test x"$lt_cv_cc_needs_belf" != x"yes"; then
     # this is probably gcc 2.8.0, egcs 1.0 or newer; no need for -belf
     CFLAGS="$SAVE_CFLAGS"
@@ -5002,11 +5352,11 @@
 sparc*-*solaris*)
   # Find out which ABI we are using.
   echo 'int i;' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
     case `/usr/bin/file conftest.o` in
     *64-bit*)
       case $lt_cv_prog_gnu_ld in
@@ -5030,15 +5380,15 @@
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
-{ echo "$as_me:$LINENO: checking how to run the C preprocessor" >&5
-echo $ECHO_N "checking how to run the C preprocessor... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor" >&5
+$as_echo_n "checking how to run the C preprocessor... " >&6; }
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
 fi
 if test -z "$CPP"; then
-  if test "${ac_cv_prog_CPP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  if ${ac_cv_prog_CPP+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
       # Double quotes because CPP needs to be expanded
     for CPP in "$CC -E" "$CC -E -traditional-cpp" "/lib/cpp"
@@ -5052,11 +5402,7 @@
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -5065,90 +5411,34 @@
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  :
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
+if ac_fn_c_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
   break
 fi
 
@@ -5160,8 +5450,8 @@
 else
   ac_cv_prog_CPP=$CPP
 fi
-{ echo "$as_me:$LINENO: result: $CPP" >&5
-echo "${ECHO_T}$CPP" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPP" >&5
+$as_echo "$CPP" >&6; }
 ac_preproc_ok=false
 for ac_c_preproc_warn_flag in '' yes
 do
@@ -5171,11 +5461,7 @@
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -5184,97 +5470,40 @@
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  :
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
+if ac_fn_c_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  :
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+
 else
-  { { echo "$as_me:$LINENO: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&5
-echo "$as_me: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 
 ac_ext=c
@@ -5284,16 +5513,12 @@
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
-{ echo "$as_me:$LINENO: checking for ANSI C header files" >&5
-echo $ECHO_N "checking for ANSI C header files... $ECHO_C" >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
+$as_echo_n "checking for ANSI C header files... " >&6; }
+if ${ac_cv_header_stdc+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 #include <stdarg.h>
@@ -5308,64 +5533,23 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_header_stdc=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_header_stdc=no
+  ac_cv_header_stdc=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <string.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then
-  :
+  $EGREP "memchr" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -5375,18 +5559,14 @@
 
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then
-  :
+  $EGREP "free" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -5396,14 +5576,10 @@
 
 if test $ac_cv_header_stdc = yes; then
   # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then
+  if test "$cross_compiling" = yes; then :
   :
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ctype.h>
 #include <stdlib.h>
@@ -5430,130 +5606,35 @@
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
-else
-  echo "$as_me: program exited with status $ac_status" >&5
-echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_run "$LINENO"; then :
 
-( exit $ac_status )
-ac_cv_header_stdc=no
+else
+  ac_cv_header_stdc=no
 fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_header_stdc" >&5
-echo "${ECHO_T}$ac_cv_header_stdc" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
+$as_echo "$ac_cv_header_stdc" >&6; }
 if test $ac_cv_header_stdc = yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define STDC_HEADERS 1
-_ACEOF
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
 
 fi
 
 # On IRIX 5.3, sys/types and inttypes.h are conflicting.
-
-
-
-
-
-
-
-
-
 for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
 		  inttypes.h stdint.h unistd.h
-do
-as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
-{ echo "$as_me:$LINENO: checking for $ac_header" >&5
-echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  eval "$as_ac_Header=yes"
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_Header=no"
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-ac_res=`eval echo '${'$as_ac_Header'}'`
-	       { echo "$as_me:$LINENO: result: $ac_res" >&5
-echo "${ECHO_T}$ac_res" >&6; }
-if test `eval echo '${'$as_ac_Header'}'` = yes; then
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
+"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
-#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
 
 fi
@@ -5561,193 +5642,36 @@
 done
 
 
-
 for ac_header in dlfcn.h
-do
-as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { echo "$as_me:$LINENO: checking for $ac_header" >&5
-echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-ac_res=`eval echo '${'$as_ac_Header'}'`
-	       { echo "$as_me:$LINENO: result: $ac_res" >&5
-echo "${ECHO_T}$ac_res" >&6; }
-else
-  # Is the header compilable?
-{ echo "$as_me:$LINENO: checking $ac_header usability" >&5
-echo $ECHO_N "checking $ac_header usability... $ECHO_C" >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "dlfcn.h" "ac_cv_header_dlfcn_h" "$ac_includes_default"
+if test "x$ac_cv_header_dlfcn_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_DLFCN_H 1
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_header_compiler=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_header_compiler=no
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6; }
+done
 
-# Is the header present?
-{ echo "$as_me:$LINENO: checking $ac_header presence" >&5
-echo $ECHO_N "checking $ac_header presence... $ECHO_C" >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## --------------------------------------------- ##
-## Report this to mroberto@users.sourceforge.net ##
-## --------------------------------------------- ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ echo "$as_me:$LINENO: checking for $ac_header" >&5
-echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  eval "$as_ac_Header=\$ac_header_preproc"
-fi
-ac_res=`eval echo '${'$as_ac_Header'}'`
-	       { echo "$as_me:$LINENO: result: $ac_res" >&5
-echo "${ECHO_T}$ac_res" >&6; }
-
-fi
-if test `eval echo '${'$as_ac_Header'}'` = yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
-fi
-
-done
-
-ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-if test -z "$CXX"; then
-  if test -n "$CCC"; then
-    CXX=$CCC
+ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+if test -z "$CXX"; then
+  if test -n "$CCC"; then
+    CXX=$CCC
   else
     if test -n "$ac_tool_prefix"; then
   for ac_prog in g++ c++ gpp aCC CC cxx cc++ cl.exe FCC KCC RCC xlC_r xlC
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_CXX+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$CXX"; then
   ac_cv_prog_CXX="$CXX" # Let the user override the test.
@@ -5757,25 +5681,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CXX="$ac_tool_prefix$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CXX=$ac_cv_prog_CXX
 if test -n "$CXX"; then
-  { echo "$as_me:$LINENO: result: $CXX" >&5
-echo "${ECHO_T}$CXX" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXX" >&5
+$as_echo "$CXX" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -5788,10 +5712,10 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_ac_ct_CXX+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CXX"; then
   ac_cv_prog_ac_ct_CXX="$ac_ct_CXX" # Let the user override the test.
@@ -5801,25 +5725,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_CXX="$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CXX=$ac_cv_prog_ac_ct_CXX
 if test -n "$ac_ct_CXX"; then
-  { echo "$as_me:$LINENO: result: $ac_ct_CXX" >&5
-echo "${ECHO_T}$ac_ct_CXX" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CXX" >&5
+$as_echo "$ac_ct_CXX" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -5831,12 +5755,8 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ echo "$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&5
-echo "$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&2;}
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
     CXX=$ac_ct_CXX
@@ -5846,49 +5766,36 @@
   fi
 fi
 # Provide some information about the compiler.
-echo "$as_me:$LINENO: checking for C++ compiler version" >&5
-ac_compiler=`set X $ac_compile; echo $2`
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C++ compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-
-{ echo "$as_me:$LINENO: checking whether we are using the GNU C++ compiler" >&5
-echo $ECHO_N "checking whether we are using the GNU C++ compiler... $ECHO_C" >&6; }
-if test "${ac_cv_cxx_compiler_gnu+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C++ compiler" >&5
+$as_echo_n "checking whether we are using the GNU C++ compiler... " >&6; }
+if ${ac_cv_cxx_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -5902,71 +5809,34 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_cxx_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_cxx_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_cxx_compiler_gnu" >&5
-echo "${ECHO_T}$ac_cv_cxx_compiler_gnu" >&6; }
-GXX=`test $ac_compiler_gnu = yes && echo yes`
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_cxx_compiler_gnu" >&5
+$as_echo "$ac_cv_cxx_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GXX=yes
+else
+  GXX=
+fi
 ac_test_CXXFLAGS=${CXXFLAGS+set}
 ac_save_CXXFLAGS=$CXXFLAGS
-{ echo "$as_me:$LINENO: checking whether $CXX accepts -g" >&5
-echo $ECHO_N "checking whether $CXX accepts -g... $ECHO_C" >&6; }
-if test "${ac_cv_prog_cxx_g+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CXX accepts -g" >&5
+$as_echo_n "checking whether $CXX accepts -g... " >&6; }
+if ${ac_cv_prog_cxx_g+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_save_cxx_werror_flag=$ac_cxx_werror_flag
    ac_cxx_werror_flag=yes
    ac_cv_prog_cxx_g=no
    CXXFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -5977,51 +5847,11 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_cxx_try_compile "$LINENO"; then :
   ac_cv_prog_cxx_g=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CXXFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  CXXFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -6032,52 +5862,12 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_cxx_try_compile "$LINENO"; then :
 
-	ac_cxx_werror_flag=$ac_save_cxx_werror_flag
+else
+  ac_cxx_werror_flag=$ac_save_cxx_werror_flag
 	 CXXFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -6088,59 +5878,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_cxx_try_compile "$LINENO"; then :
   ac_cv_prog_cxx_g=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
    ac_cxx_werror_flag=$ac_save_cxx_werror_flag
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_prog_cxx_g" >&5
-echo "${ECHO_T}$ac_cv_prog_cxx_g" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cxx_g" >&5
+$as_echo "$ac_cv_prog_cxx_g" >&6; }
 if test "$ac_test_CXXFLAGS" = set; then
   CXXFLAGS=$ac_save_CXXFLAGS
 elif test $ac_cv_prog_cxx_g = yes; then
@@ -6164,10 +5913,10 @@
 
 depcc="$CXX"  am_compiler_list=
 
-{ echo "$as_me:$LINENO: checking dependency style of $depcc" >&5
-echo $ECHO_N "checking dependency style of $depcc... $ECHO_C" >&6; }
-if test "${am_cv_CXX_dependencies_compiler_type+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dependency style of $depcc" >&5
+$as_echo_n "checking dependency style of $depcc... " >&6; }
+if ${am_cv_CXX_dependencies_compiler_type+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
   # We make a subdir and do the tests there.  Otherwise we can end up
@@ -6254,8 +6003,8 @@
 fi
 
 fi
-{ echo "$as_me:$LINENO: result: $am_cv_CXX_dependencies_compiler_type" >&5
-echo "${ECHO_T}$am_cv_CXX_dependencies_compiler_type" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_CXX_dependencies_compiler_type" >&5
+$as_echo "$am_cv_CXX_dependencies_compiler_type" >&6; }
 CXXDEPMODE=depmode=$am_cv_CXX_dependencies_compiler_type
 
 
@@ -6281,11 +6030,11 @@
 ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-{ echo "$as_me:$LINENO: checking how to run the C++ preprocessor" >&5
-echo $ECHO_N "checking how to run the C++ preprocessor... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C++ preprocessor" >&5
+$as_echo_n "checking how to run the C++ preprocessor... " >&6; }
 if test -z "$CXXCPP"; then
-  if test "${ac_cv_prog_CXXCPP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  if ${ac_cv_prog_CXXCPP+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
       # Double quotes because CXXCPP needs to be expanded
     for CXXCPP in "$CXX -E" "/lib/cpp"
@@ -6299,11 +6048,7 @@
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -6312,90 +6057,34 @@
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_cxx_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_cxx_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  :
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_cxx_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_cxx_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_cxx_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
+if ac_fn_cxx_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
   break
 fi
 
@@ -6407,8 +6096,8 @@
 else
   ac_cv_prog_CXXCPP=$CXXCPP
 fi
-{ echo "$as_me:$LINENO: result: $CXXCPP" >&5
-echo "${ECHO_T}$CXXCPP" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXXCPP" >&5
+$as_echo "$CXXCPP" >&6; }
 ac_preproc_ok=false
 for ac_cxx_preproc_warn_flag in '' yes
 do
@@ -6418,11 +6107,7 @@
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -6431,97 +6116,40 @@
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_cxx_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_cxx_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  :
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_cxx_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_cxx_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_cxx_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
+if ac_fn_cxx_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  :
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+
 else
-  { { echo "$as_me:$LINENO: error: C++ preprocessor \"$CXXCPP\" fails sanity check
-See \`config.log' for more details." >&5
-echo "$as_me: error: C++ preprocessor \"$CXXCPP\" fails sanity check
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "C++ preprocessor \"$CXXCPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 
 ac_ext=cpp
@@ -6538,14 +6166,14 @@
 ac_link='$F77 -o conftest$ac_exeext $FFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_f77_compiler_gnu
 if test -n "$ac_tool_prefix"; then
-  for ac_prog in g77 f77 xlf frt pgf77 cf77 fort77 fl32 af77 f90 xlf90 pgf90 pghpf epcf90 gfortran g95 f95 fort xlf95 ifort ifc efc pgf95 lf95 ftn
+  for ac_prog in g77 xlf f77 frt pgf77 cf77 fort77 fl32 af77 xlf90 f90 pgf90 pghpf epcf90 gfortran g95 xlf95 f95 fort ifort ifc efc pgfortran pgf95 lf95 ftn
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_F77+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_F77+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$F77"; then
   ac_cv_prog_F77="$F77" # Let the user override the test.
@@ -6555,25 +6183,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_F77="$ac_tool_prefix$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 F77=$ac_cv_prog_F77
 if test -n "$F77"; then
-  { echo "$as_me:$LINENO: result: $F77" >&5
-echo "${ECHO_T}$F77" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $F77" >&5
+$as_echo "$F77" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -6582,14 +6210,14 @@
 fi
 if test -z "$F77"; then
   ac_ct_F77=$F77
-  for ac_prog in g77 f77 xlf frt pgf77 cf77 fort77 fl32 af77 f90 xlf90 pgf90 pghpf epcf90 gfortran g95 f95 fort xlf95 ifort ifc efc pgf95 lf95 ftn
+  for ac_prog in g77 xlf f77 frt pgf77 cf77 fort77 fl32 af77 xlf90 f90 pgf90 pghpf epcf90 gfortran g95 xlf95 f95 fort ifort ifc efc pgfortran pgf95 lf95 ftn
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_ac_ct_F77+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_F77+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_F77"; then
   ac_cv_prog_ac_ct_F77="$ac_ct_F77" # Let the user override the test.
@@ -6599,25 +6227,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_F77="$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_F77=$ac_cv_prog_ac_ct_F77
 if test -n "$ac_ct_F77"; then
-  { echo "$as_me:$LINENO: result: $ac_ct_F77" >&5
-echo "${ECHO_T}$ac_ct_F77" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_F77" >&5
+$as_echo "$ac_ct_F77" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -6629,12 +6257,8 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ echo "$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&5
-echo "$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&2;}
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
     F77=$ac_ct_F77
@@ -6643,50 +6267,41 @@
 
 
 # Provide some information about the compiler.
-echo "$as_me:$LINENO: checking for Fortran 77 compiler version" >&5
-ac_compiler=`set X $ac_compile; echo $2`
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for Fortran 77 compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 rm -f a.out
 
 # If we don't use `.F' as extension, the preprocessor is not run on the
 # input file.  (Note that this only needs to work for GNU compilers.)
 ac_save_ext=$ac_ext
 ac_ext=F
-{ echo "$as_me:$LINENO: checking whether we are using the GNU Fortran 77 compiler" >&5
-echo $ECHO_N "checking whether we are using the GNU Fortran 77 compiler... $ECHO_C" >&6; }
-if test "${ac_cv_f77_compiler_gnu+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU Fortran 77 compiler" >&5
+$as_echo_n "checking whether we are using the GNU Fortran 77 compiler... " >&6; }
+if ${ac_cv_f77_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
+  cat > conftest.$ac_ext <<_ACEOF
       program main
 #ifndef __GNUC__
        choke me
@@ -6694,116 +6309,42 @@
 
       end
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_f77_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_f77_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_f77_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_f77_compiler_gnu" >&5
-echo "${ECHO_T}$ac_cv_f77_compiler_gnu" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_f77_compiler_gnu" >&5
+$as_echo "$ac_cv_f77_compiler_gnu" >&6; }
 ac_ext=$ac_save_ext
 ac_test_FFLAGS=${FFLAGS+set}
 ac_save_FFLAGS=$FFLAGS
 FFLAGS=
-{ echo "$as_me:$LINENO: checking whether $F77 accepts -g" >&5
-echo $ECHO_N "checking whether $F77 accepts -g... $ECHO_C" >&6; }
-if test "${ac_cv_prog_f77_g+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $F77 accepts -g" >&5
+$as_echo_n "checking whether $F77 accepts -g... " >&6; }
+if ${ac_cv_prog_f77_g+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   FFLAGS=-g
-cat >conftest.$ac_ext <<_ACEOF
+cat > conftest.$ac_ext <<_ACEOF
       program main
 
       end
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_f77_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_f77_try_compile "$LINENO"; then :
   ac_cv_prog_f77_g=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_prog_f77_g=no
+  ac_cv_prog_f77_g=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_prog_f77_g" >&5
-echo "${ECHO_T}$ac_cv_prog_f77_g" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_f77_g" >&5
+$as_echo "$ac_cv_prog_f77_g" >&6; }
 if test "$ac_test_FFLAGS" = set; then
   FFLAGS=$ac_save_FFLAGS
 elif test $ac_cv_prog_f77_g = yes; then
@@ -6820,7 +6361,11 @@
   fi
 fi
 
-G77=`test $ac_compiler_gnu = yes && echo yes`
+if test $ac_compiler_gnu = yes; then
+  G77=yes
+else
+  G77=
+fi
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
@@ -6832,10 +6377,10 @@
 # Autoconf 2.13's AC_OBJEXT and AC_EXEEXT macros only works for C compilers!
 
 # find the maximum length of command line arguments
-{ echo "$as_me:$LINENO: checking the maximum length of command line arguments" >&5
-echo $ECHO_N "checking the maximum length of command line arguments... $ECHO_C" >&6; }
-if test "${lt_cv_sys_max_cmd_len+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking the maximum length of command line arguments" >&5
+$as_echo_n "checking the maximum length of command line arguments... " >&6; }
+if ${lt_cv_sys_max_cmd_len+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
     i=0
   teststring="ABCD"
@@ -6941,21 +6486,21 @@
 fi
 
 if test -n $lt_cv_sys_max_cmd_len ; then
-  { echo "$as_me:$LINENO: result: $lt_cv_sys_max_cmd_len" >&5
-echo "${ECHO_T}$lt_cv_sys_max_cmd_len" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_sys_max_cmd_len" >&5
+$as_echo "$lt_cv_sys_max_cmd_len" >&6; }
 else
-  { echo "$as_me:$LINENO: result: none" >&5
-echo "${ECHO_T}none" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: none" >&5
+$as_echo "none" >&6; }
 fi
 
 
 
 
 # Check for command to grab the raw symbol name followed by C symbol from nm.
-{ echo "$as_me:$LINENO: checking command to parse $NM output from $compiler object" >&5
-echo $ECHO_N "checking command to parse $NM output from $compiler object... $ECHO_C" >&6; }
-if test "${lt_cv_sys_global_symbol_pipe+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking command to parse $NM output from $compiler object" >&5
+$as_echo_n "checking command to parse $NM output from $compiler object... " >&6; }
+if ${lt_cv_sys_global_symbol_pipe+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
 
 # These are sane defaults that work on at least a few old systems.
@@ -7057,18 +6602,18 @@
 int main(){nm_test_var='a';nm_test_func();return(0);}
 EOF
 
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
     # Now try to grab the symbols.
     nlist=conftest.nm
-    if { (eval echo "$as_me:$LINENO: \"$NM conftest.$ac_objext \| $lt_cv_sys_global_symbol_pipe \> $nlist\"") >&5
+    if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$NM conftest.$ac_objext \| $lt_cv_sys_global_symbol_pipe \> $nlist\""; } >&5
   (eval $NM conftest.$ac_objext \| $lt_cv_sys_global_symbol_pipe \> $nlist) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s "$nlist"; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s "$nlist"; then
       # Try sorting and uniquifying the output.
       if sort "$nlist" | uniq > "$nlist"T; then
 	mv -f "$nlist"T "$nlist"
@@ -7119,11 +6664,11 @@
 	  lt_save_CFLAGS="$CFLAGS"
 	  LIBS="conftstm.$ac_objext"
 	  CFLAGS="$CFLAGS$lt_prog_compiler_no_builtin_flag"
-	  if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+	  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s conftest${ac_exeext}; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s conftest${ac_exeext}; then
 	    pipe_works=yes
 	  fi
 	  LIBS="$lt_save_LIBS"
@@ -7157,17 +6702,17 @@
   lt_cv_sys_global_symbol_to_cdecl=
 fi
 if test -z "$lt_cv_sys_global_symbol_pipe$lt_cv_sys_global_symbol_to_cdecl"; then
-  { echo "$as_me:$LINENO: result: failed" >&5
-echo "${ECHO_T}failed" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: failed" >&5
+$as_echo "failed" >&6; }
 else
-  { echo "$as_me:$LINENO: result: ok" >&5
-echo "${ECHO_T}ok" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: ok" >&5
+$as_echo "ok" >&6; }
 fi
 
-{ echo "$as_me:$LINENO: checking for objdir" >&5
-echo $ECHO_N "checking for objdir... $ECHO_C" >&6; }
-if test "${lt_cv_objdir+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for objdir" >&5
+$as_echo_n "checking for objdir... " >&6; }
+if ${lt_cv_objdir+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   rm -f .libs 2>/dev/null
 mkdir .libs 2>/dev/null
@@ -7179,8 +6724,8 @@
 fi
 rmdir .libs 2>/dev/null
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_objdir" >&5
-echo "${ECHO_T}$lt_cv_objdir" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_objdir" >&5
+$as_echo "$lt_cv_objdir" >&6; }
 objdir=$lt_cv_objdir
 
 
@@ -7231,10 +6776,10 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}ar", so it can be a program name with args.
 set dummy ${ac_tool_prefix}ar; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_AR+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_AR+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$AR"; then
   ac_cv_prog_AR="$AR" # Let the user override the test.
@@ -7244,25 +6789,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_AR="${ac_tool_prefix}ar"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 AR=$ac_cv_prog_AR
 if test -n "$AR"; then
-  { echo "$as_me:$LINENO: result: $AR" >&5
-echo "${ECHO_T}$AR" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AR" >&5
+$as_echo "$AR" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -7271,10 +6816,10 @@
   ac_ct_AR=$AR
   # Extract the first word of "ar", so it can be a program name with args.
 set dummy ar; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_ac_ct_AR+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_AR+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_AR"; then
   ac_cv_prog_ac_ct_AR="$ac_ct_AR" # Let the user override the test.
@@ -7284,25 +6829,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_AR="ar"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_AR=$ac_cv_prog_ac_ct_AR
 if test -n "$ac_ct_AR"; then
-  { echo "$as_me:$LINENO: result: $ac_ct_AR" >&5
-echo "${ECHO_T}$ac_ct_AR" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_AR" >&5
+$as_echo "$ac_ct_AR" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
   if test "x$ac_ct_AR" = x; then
@@ -7310,12 +6855,8 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ echo "$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&5
-echo "$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&2;}
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
     AR=$ac_ct_AR
@@ -7327,10 +6868,10 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
 set dummy ${ac_tool_prefix}ranlib; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_RANLIB+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_RANLIB+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$RANLIB"; then
   ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
@@ -7340,25 +6881,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 RANLIB=$ac_cv_prog_RANLIB
 if test -n "$RANLIB"; then
-  { echo "$as_me:$LINENO: result: $RANLIB" >&5
-echo "${ECHO_T}$RANLIB" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RANLIB" >&5
+$as_echo "$RANLIB" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -7367,10 +6908,10 @@
   ac_ct_RANLIB=$RANLIB
   # Extract the first word of "ranlib", so it can be a program name with args.
 set dummy ranlib; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_RANLIB+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_RANLIB"; then
   ac_cv_prog_ac_ct_RANLIB="$ac_ct_RANLIB" # Let the user override the test.
@@ -7380,25 +6921,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_RANLIB="ranlib"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
 if test -n "$ac_ct_RANLIB"; then
-  { echo "$as_me:$LINENO: result: $ac_ct_RANLIB" >&5
-echo "${ECHO_T}$ac_ct_RANLIB" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_RANLIB" >&5
+$as_echo "$ac_ct_RANLIB" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
   if test "x$ac_ct_RANLIB" = x; then
@@ -7406,12 +6947,8 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ echo "$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&5
-echo "$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&2;}
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
     RANLIB=$ac_ct_RANLIB
@@ -7423,10 +6960,10 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
 set dummy ${ac_tool_prefix}strip; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_STRIP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_STRIP+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$STRIP"; then
   ac_cv_prog_STRIP="$STRIP" # Let the user override the test.
@@ -7436,25 +6973,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 STRIP=$ac_cv_prog_STRIP
 if test -n "$STRIP"; then
-  { echo "$as_me:$LINENO: result: $STRIP" >&5
-echo "${ECHO_T}$STRIP" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $STRIP" >&5
+$as_echo "$STRIP" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -7463,10 +7000,10 @@
   ac_ct_STRIP=$STRIP
   # Extract the first word of "strip", so it can be a program name with args.
 set dummy strip; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_ac_ct_STRIP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_STRIP+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_STRIP"; then
   ac_cv_prog_ac_ct_STRIP="$ac_ct_STRIP" # Let the user override the test.
@@ -7476,25 +7013,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_STRIP="strip"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_STRIP=$ac_cv_prog_ac_ct_STRIP
 if test -n "$ac_ct_STRIP"; then
-  { echo "$as_me:$LINENO: result: $ac_ct_STRIP" >&5
-echo "${ECHO_T}$ac_ct_STRIP" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_STRIP" >&5
+$as_echo "$ac_ct_STRIP" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
   if test "x$ac_ct_STRIP" = x; then
@@ -7502,12 +7039,8 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ echo "$as_me:$LINENO: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&5
-echo "$as_me: WARNING: In the future, Autoconf will not detect cross-tools
-whose name does not start with the host triplet.  If you think this
-configuration is useful to you, please write to autoconf@gnu.org." >&2;}
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
     STRIP=$ac_ct_STRIP
@@ -7570,10 +7103,10 @@
 case $deplibs_check_method in
 file_magic*)
   if test "$file_magic_cmd" = '$MAGIC_CMD'; then
-    { echo "$as_me:$LINENO: checking for ${ac_tool_prefix}file" >&5
-echo $ECHO_N "checking for ${ac_tool_prefix}file... $ECHO_C" >&6; }
-if test "${lt_cv_path_MAGIC_CMD+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ${ac_tool_prefix}file" >&5
+$as_echo_n "checking for ${ac_tool_prefix}file... " >&6; }
+if ${lt_cv_path_MAGIC_CMD+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   case $MAGIC_CMD in
 [\\/*] |  ?:[\\/]*)
@@ -7623,19 +7156,19 @@
 
 MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
 if test -n "$MAGIC_CMD"; then
-  { echo "$as_me:$LINENO: result: $MAGIC_CMD" >&5
-echo "${ECHO_T}$MAGIC_CMD" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAGIC_CMD" >&5
+$as_echo "$MAGIC_CMD" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 if test -z "$lt_cv_path_MAGIC_CMD"; then
   if test -n "$ac_tool_prefix"; then
-    { echo "$as_me:$LINENO: checking for file" >&5
-echo $ECHO_N "checking for file... $ECHO_C" >&6; }
-if test "${lt_cv_path_MAGIC_CMD+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for file" >&5
+$as_echo_n "checking for file... " >&6; }
+if ${lt_cv_path_MAGIC_CMD+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   case $MAGIC_CMD in
 [\\/*] |  ?:[\\/]*)
@@ -7685,11 +7218,11 @@
 
 MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
 if test -n "$MAGIC_CMD"; then
-  { echo "$as_me:$LINENO: result: $MAGIC_CMD" >&5
-echo "${ECHO_T}$MAGIC_CMD" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAGIC_CMD" >&5
+$as_echo "$MAGIC_CMD" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
   else
@@ -7705,7 +7238,7 @@
 enable_win32_dll=no
 
 # Check whether --enable-libtool-lock was given.
-if test "${enable_libtool_lock+set}" = set; then
+if test "${enable_libtool_lock+set}" = set; then :
   enableval=$enable_libtool_lock;
 fi
 
@@ -7713,7 +7246,7 @@
 
 
 # Check whether --with-pic was given.
-if test "${with_pic+set}" = set; then
+if test "${with_pic+set}" = set; then :
   withval=$with_pic; pic_mode="$withval"
 else
   pic_mode=default
@@ -7776,10 +7309,10 @@
   lt_prog_compiler_no_builtin_flag=' -fno-builtin'
 
 
-{ echo "$as_me:$LINENO: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
-echo $ECHO_N "checking if $compiler supports -fno-rtti -fno-exceptions... $ECHO_C" >&6; }
-if test "${lt_cv_prog_compiler_rtti_exceptions+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
+$as_echo_n "checking if $compiler supports -fno-rtti -fno-exceptions... " >&6; }
+if ${lt_cv_prog_compiler_rtti_exceptions+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_rtti_exceptions=no
   ac_outfile=conftest.$ac_objext
@@ -7794,11 +7327,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:7797: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7330: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:7801: \$? = $ac_status" >&5
+   echo "$as_me:7334: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -7811,8 +7344,8 @@
    $rm conftest*
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_rtti_exceptions" >&5
-echo "${ECHO_T}$lt_cv_prog_compiler_rtti_exceptions" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_rtti_exceptions" >&5
+$as_echo "$lt_cv_prog_compiler_rtti_exceptions" >&6; }
 
 if test x"$lt_cv_prog_compiler_rtti_exceptions" = xyes; then
     lt_prog_compiler_no_builtin_flag="$lt_prog_compiler_no_builtin_flag -fno-rtti -fno-exceptions"
@@ -7826,8 +7359,8 @@
 lt_prog_compiler_pic=
 lt_prog_compiler_static=
 
-{ echo "$as_me:$LINENO: checking for $compiler option to produce PIC" >&5
-echo $ECHO_N "checking for $compiler option to produce PIC... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $compiler option to produce PIC" >&5
+$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
 
   if test "$GCC" = yes; then
     lt_prog_compiler_wl='-Wl,'
@@ -8036,18 +7569,18 @@
     esac
   fi
 
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_pic" >&5
-echo "${ECHO_T}$lt_prog_compiler_pic" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_pic" >&5
+$as_echo "$lt_prog_compiler_pic" >&6; }
 
 #
 # Check to make sure the PIC flag actually works.
 #
 if test -n "$lt_prog_compiler_pic"; then
 
-{ echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic works" >&5
-echo $ECHO_N "checking if $compiler PIC flag $lt_prog_compiler_pic works... $ECHO_C" >&6; }
-if test "${lt_prog_compiler_pic_works+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic works" >&5
+$as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic works... " >&6; }
+if ${lt_prog_compiler_pic_works+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_prog_compiler_pic_works=no
   ac_outfile=conftest.$ac_objext
@@ -8062,11 +7595,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:8065: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7598: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:8069: \$? = $ac_status" >&5
+   echo "$as_me:7602: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -8079,8 +7612,8 @@
    $rm conftest*
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_pic_works" >&5
-echo "${ECHO_T}$lt_prog_compiler_pic_works" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_pic_works" >&5
+$as_echo "$lt_prog_compiler_pic_works" >&6; }
 
 if test x"$lt_prog_compiler_pic_works" = xyes; then
     case $lt_prog_compiler_pic in
@@ -8107,10 +7640,10 @@
 # Check to make sure the static flag actually works.
 #
 wl=$lt_prog_compiler_wl eval lt_tmp_static_flag=\"$lt_prog_compiler_static\"
-{ echo "$as_me:$LINENO: checking if $compiler static flag $lt_tmp_static_flag works" >&5
-echo $ECHO_N "checking if $compiler static flag $lt_tmp_static_flag works... $ECHO_C" >&6; }
-if test "${lt_prog_compiler_static_works+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
+$as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
+if ${lt_prog_compiler_static_works+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_prog_compiler_static_works=no
    save_LDFLAGS="$LDFLAGS"
@@ -8135,8 +7668,8 @@
    LDFLAGS="$save_LDFLAGS"
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_static_works" >&5
-echo "${ECHO_T}$lt_prog_compiler_static_works" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_static_works" >&5
+$as_echo "$lt_prog_compiler_static_works" >&6; }
 
 if test x"$lt_prog_compiler_static_works" = xyes; then
     :
@@ -8145,10 +7678,10 @@
 fi
 
 
-{ echo "$as_me:$LINENO: checking if $compiler supports -c -o file.$ac_objext" >&5
-echo $ECHO_N "checking if $compiler supports -c -o file.$ac_objext... $ECHO_C" >&6; }
-if test "${lt_cv_prog_compiler_c_o+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
+$as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
+if ${lt_cv_prog_compiler_c_o+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_c_o=no
    $rm -r conftest 2>/dev/null
@@ -8166,11 +7699,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:8169: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:7702: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:8173: \$? = $ac_status" >&5
+   echo "$as_me:7706: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -8192,34 +7725,34 @@
    $rm conftest*
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_c_o" >&5
-echo "${ECHO_T}$lt_cv_prog_compiler_c_o" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o" >&5
+$as_echo "$lt_cv_prog_compiler_c_o" >&6; }
 
 
 hard_links="nottested"
 if test "$lt_cv_prog_compiler_c_o" = no && test "$need_locks" != no; then
   # do not overwrite the value of need_locks provided by the user
-  { echo "$as_me:$LINENO: checking if we can lock with hard links" >&5
-echo $ECHO_N "checking if we can lock with hard links... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we can lock with hard links" >&5
+$as_echo_n "checking if we can lock with hard links... " >&6; }
   hard_links=yes
   $rm conftest*
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
   touch conftest.a
   ln conftest.a conftest.b 2>&5 || hard_links=no
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
-  { echo "$as_me:$LINENO: result: $hard_links" >&5
-echo "${ECHO_T}$hard_links" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hard_links" >&5
+$as_echo "$hard_links" >&6; }
   if test "$hard_links" = no; then
-    { echo "$as_me:$LINENO: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
-echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
+$as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
     need_locks=warn
   fi
 else
   need_locks=no
 fi
 
-{ echo "$as_me:$LINENO: checking whether the $compiler linker ($LD) supports shared libraries" >&5
-echo $ECHO_N "checking whether the $compiler linker ($LD) supports shared libraries... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+$as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
 
   runpath_var=
   allow_undefined_flag=
@@ -8618,11 +8151,7 @@
 	# -berok will link without error, but may produce a broken library.
 	allow_undefined_flag='-berok'
        # Determine the default libpath from the value encoded in an empty executable.
-       cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+       cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -8633,55 +8162,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
 
 aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`
 # Check for a 64-bit object if we didn't find anything.
 if test -z "$aix_libpath"; then aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`; fi
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
        hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -8693,11 +8183,7 @@
 	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
 	else
 	 # Determine the default libpath from the value encoded in an empty executable.
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -8708,55 +8194,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
 
 aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`
 # Check for a 64-bit object if we didn't find anything.
 if test -z "$aix_libpath"; then aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`; fi
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
 	 hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -9204,8 +8651,8 @@
     esac
   fi
 
-{ echo "$as_me:$LINENO: result: $ld_shlibs" >&5
-echo "${ECHO_T}$ld_shlibs" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs" >&5
+$as_echo "$ld_shlibs" >&6; }
 test "$ld_shlibs" = no && can_build_shared=no
 
 #
@@ -9225,16 +8672,16 @@
       # Test whether the compiler implicitly links with -lc since on some
       # systems, -lgcc has to come before -lc. If gcc already passes -lc
       # to ld, don't add -lc before -lgcc.
-      { echo "$as_me:$LINENO: checking whether -lc should be explicitly linked in" >&5
-echo $ECHO_N "checking whether -lc should be explicitly linked in... $ECHO_C" >&6; }
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether -lc should be explicitly linked in" >&5
+$as_echo_n "checking whether -lc should be explicitly linked in... " >&6; }
       $rm conftest*
       printf "$lt_simple_compile_test_code" > conftest.$ac_ext
 
-      if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+      if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } 2>conftest.err; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } 2>conftest.err; then
         soname=conftest
         lib=conftest
         libobjs=conftest.$ac_objext
@@ -9248,11 +8695,11 @@
         libname=conftest
         lt_save_allow_undefined_flag=$allow_undefined_flag
         allow_undefined_flag=
-        if { (eval echo "$as_me:$LINENO: \"$archive_cmds 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1\"") >&5
+        if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$archive_cmds 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1\""; } >&5
   (eval $archive_cmds 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
         then
 	  archive_cmds_need_lc=no
         else
@@ -9263,16 +8710,16 @@
         cat conftest.err 1>&5
       fi
       $rm conftest*
-      { echo "$as_me:$LINENO: result: $archive_cmds_need_lc" >&5
-echo "${ECHO_T}$archive_cmds_need_lc" >&6; }
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: $archive_cmds_need_lc" >&5
+$as_echo "$archive_cmds_need_lc" >&6; }
       ;;
     esac
   fi
   ;;
 esac
 
-{ echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
-echo $ECHO_N "checking dynamic linker characteristics... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dynamic linker characteristics" >&5
+$as_echo_n "checking dynamic linker characteristics... " >&6; }
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
@@ -9859,8 +9306,8 @@
   dynamic_linker=no
   ;;
 esac
-{ echo "$as_me:$LINENO: result: $dynamic_linker" >&5
-echo "${ECHO_T}$dynamic_linker" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $dynamic_linker" >&5
+$as_echo "$dynamic_linker" >&6; }
 test "$dynamic_linker" = no && can_build_shared=no
 
 variables_saved_for_relink="PATH $shlibpath_var $runpath_var"
@@ -9868,8 +9315,8 @@
   variables_saved_for_relink="$variables_saved_for_relink GCC_EXEC_PREFIX COMPILER_PATH LIBRARY_PATH"
 fi
 
-{ echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
-echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to hardcode library paths into programs" >&5
+$as_echo_n "checking how to hardcode library paths into programs... " >&6; }
 hardcode_action=
 if test -n "$hardcode_libdir_flag_spec" || \
    test -n "$runpath_var" || \
@@ -9893,8 +9340,8 @@
   # directories.
   hardcode_action=unsupported
 fi
-{ echo "$as_me:$LINENO: result: $hardcode_action" >&5
-echo "${ECHO_T}$hardcode_action" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $hardcode_action" >&5
+$as_echo "$hardcode_action" >&6; }
 
 if test "$hardcode_action" = relink; then
   # Fast installation is not supported
@@ -9907,29 +9354,29 @@
 
 striplib=
 old_striplib=
-{ echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
-echo $ECHO_N "checking whether stripping libraries is possible... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether stripping libraries is possible" >&5
+$as_echo_n "checking whether stripping libraries is possible... " >&6; }
 if test -n "$STRIP" && $STRIP -V 2>&1 | grep "GNU strip" >/dev/null; then
   test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
   test -z "$striplib" && striplib="$STRIP --strip-unneeded"
-  { echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 else
 # FIXME - insert some real tests, host_os isn't really good enough
   case $host_os in
    darwin*)
        if test -n "$STRIP" ; then
          striplib="$STRIP -x"
-         { echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6; }
+         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
        else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
        ;;
    *)
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
     ;;
   esac
 fi
@@ -9961,18 +9408,14 @@
 
   darwin*)
   # if libdl is installed we need to link against it
-    { echo "$as_me:$LINENO: checking for dlopen in -ldl" >&5
-echo $ECHO_N "checking for dlopen in -ldl... $ECHO_C" >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
+$as_echo_n "checking for dlopen in -ldl... " >&6; }
+if ${ac_cv_lib_dl_dlopen+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -9990,55 +9433,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dl_dlopen=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dl_dlopen=no
+  ac_cv_lib_dl_dlopen=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
-echo "${ECHO_T}$ac_cv_lib_dl_dlopen" >&6; }
-if test $ac_cv_lib_dl_dlopen = yes; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
+$as_echo "$ac_cv_lib_dl_dlopen" >&6; }
+if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
 else
 
@@ -10051,118 +9457,18 @@
    ;;
 
   *)
-    { echo "$as_me:$LINENO: checking for shl_load" >&5
-echo $ECHO_N "checking for shl_load... $ECHO_C" >&6; }
-if test "${ac_cv_func_shl_load+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define shl_load to an innocuous variant, in case <limits.h> declares shl_load.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define shl_load innocuous_shl_load
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char shl_load (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef shl_load
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char shl_load ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_shl_load || defined __stub___shl_load
-choke me
-#endif
-
-int
-main ()
-{
-return shl_load ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_func_shl_load=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_func_shl_load=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_func_shl_load" >&5
-echo "${ECHO_T}$ac_cv_func_shl_load" >&6; }
-if test $ac_cv_func_shl_load = yes; then
+    ac_fn_c_check_func "$LINENO" "shl_load" "ac_cv_func_shl_load"
+if test "x$ac_cv_func_shl_load" = xyes; then :
   lt_cv_dlopen="shl_load"
 else
-  { echo "$as_me:$LINENO: checking for shl_load in -ldld" >&5
-echo $ECHO_N "checking for shl_load in -ldld... $ECHO_C" >&6; }
-if test "${ac_cv_lib_dld_shl_load+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for shl_load in -ldld" >&5
+$as_echo_n "checking for shl_load in -ldld... " >&6; }
+if ${ac_cv_lib_dld_shl_load+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -10180,169 +9486,32 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dld_shl_load=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dld_shl_load=no
+  ac_cv_lib_dld_shl_load=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_lib_dld_shl_load" >&5
-echo "${ECHO_T}$ac_cv_lib_dld_shl_load" >&6; }
-if test $ac_cv_lib_dld_shl_load = yes; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_shl_load" >&5
+$as_echo "$ac_cv_lib_dld_shl_load" >&6; }
+if test "x$ac_cv_lib_dld_shl_load" = xyes; then :
   lt_cv_dlopen="shl_load" lt_cv_dlopen_libs="-dld"
 else
-  { echo "$as_me:$LINENO: checking for dlopen" >&5
-echo $ECHO_N "checking for dlopen... $ECHO_C" >&6; }
-if test "${ac_cv_func_dlopen+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define dlopen to an innocuous variant, in case <limits.h> declares dlopen.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define dlopen innocuous_dlopen
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char dlopen (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef dlopen
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char dlopen ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_dlopen || defined __stub___dlopen
-choke me
-#endif
-
-int
-main ()
-{
-return dlopen ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_func_dlopen=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_func_dlopen=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_func_dlopen" >&5
-echo "${ECHO_T}$ac_cv_func_dlopen" >&6; }
-if test $ac_cv_func_dlopen = yes; then
+  ac_fn_c_check_func "$LINENO" "dlopen" "ac_cv_func_dlopen"
+if test "x$ac_cv_func_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen"
 else
-  { echo "$as_me:$LINENO: checking for dlopen in -ldl" >&5
-echo $ECHO_N "checking for dlopen in -ldl... $ECHO_C" >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
+$as_echo_n "checking for dlopen in -ldl... " >&6; }
+if ${ac_cv_lib_dl_dlopen+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -10360,69 +9529,28 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dl_dlopen=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dl_dlopen=no
+  ac_cv_lib_dl_dlopen=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
-echo "${ECHO_T}$ac_cv_lib_dl_dlopen" >&6; }
-if test $ac_cv_lib_dl_dlopen = yes; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
+$as_echo "$ac_cv_lib_dl_dlopen" >&6; }
+if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
 else
-  { echo "$as_me:$LINENO: checking for dlopen in -lsvld" >&5
-echo $ECHO_N "checking for dlopen in -lsvld... $ECHO_C" >&6; }
-if test "${ac_cv_lib_svld_dlopen+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -lsvld" >&5
+$as_echo_n "checking for dlopen in -lsvld... " >&6; }
+if ${ac_cv_lib_svld_dlopen+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lsvld  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -10440,69 +9568,28 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_svld_dlopen=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_svld_dlopen=no
+  ac_cv_lib_svld_dlopen=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_lib_svld_dlopen" >&5
-echo "${ECHO_T}$ac_cv_lib_svld_dlopen" >&6; }
-if test $ac_cv_lib_svld_dlopen = yes; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_svld_dlopen" >&5
+$as_echo "$ac_cv_lib_svld_dlopen" >&6; }
+if test "x$ac_cv_lib_svld_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-lsvld"
 else
-  { echo "$as_me:$LINENO: checking for dld_link in -ldld" >&5
-echo $ECHO_N "checking for dld_link in -ldld... $ECHO_C" >&6; }
-if test "${ac_cv_lib_dld_dld_link+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dld_link in -ldld" >&5
+$as_echo_n "checking for dld_link in -ldld... " >&6; }
+if ${ac_cv_lib_dld_dld_link+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -10520,55 +9607,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dld_dld_link=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dld_dld_link=no
+  ac_cv_lib_dld_dld_link=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_lib_dld_dld_link" >&5
-echo "${ECHO_T}$ac_cv_lib_dld_dld_link" >&6; }
-if test $ac_cv_lib_dld_dld_link = yes; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_dld_link" >&5
+$as_echo "$ac_cv_lib_dld_dld_link" >&6; }
+if test "x$ac_cv_lib_dld_dld_link" = xyes; then :
   lt_cv_dlopen="dld_link" lt_cv_dlopen_libs="-dld"
 fi
 
@@ -10607,10 +9657,10 @@
     save_LIBS="$LIBS"
     LIBS="$lt_cv_dlopen_libs $LIBS"
 
-    { echo "$as_me:$LINENO: checking whether a program can dlopen itself" >&5
-echo $ECHO_N "checking whether a program can dlopen itself... $ECHO_C" >&6; }
-if test "${lt_cv_dlopen_self+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a program can dlopen itself" >&5
+$as_echo_n "checking whether a program can dlopen itself... " >&6; }
+if ${lt_cv_dlopen_self+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   	  if test "$cross_compiling" = yes; then :
   lt_cv_dlopen_self=cross
@@ -10618,7 +9668,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 10621 "configure"
+#line 9671 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -10681,11 +9731,11 @@
     exit (status);
 }
 EOF
-  if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s conftest${ac_exeext} 2>/dev/null; then
     (./conftest; exit; ) >&5 2>/dev/null
     lt_status=$?
     case x$lt_status in
@@ -10702,15 +9752,15 @@
 
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_dlopen_self" >&5
-echo "${ECHO_T}$lt_cv_dlopen_self" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_dlopen_self" >&5
+$as_echo "$lt_cv_dlopen_self" >&6; }
 
     if test "x$lt_cv_dlopen_self" = xyes; then
       wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $lt_prog_compiler_static\"
-      { echo "$as_me:$LINENO: checking whether a statically linked program can dlopen itself" >&5
-echo $ECHO_N "checking whether a statically linked program can dlopen itself... $ECHO_C" >&6; }
-if test "${lt_cv_dlopen_self_static+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a statically linked program can dlopen itself" >&5
+$as_echo_n "checking whether a statically linked program can dlopen itself... " >&6; }
+if ${lt_cv_dlopen_self_static+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   	  if test "$cross_compiling" = yes; then :
   lt_cv_dlopen_self_static=cross
@@ -10718,7 +9768,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 10721 "configure"
+#line 9771 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -10781,11 +9831,11 @@
     exit (status);
 }
 EOF
-  if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s conftest${ac_exeext} 2>/dev/null; then
     (./conftest; exit; ) >&5 2>/dev/null
     lt_status=$?
     case x$lt_status in
@@ -10802,8 +9852,8 @@
 
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_dlopen_self_static" >&5
-echo "${ECHO_T}$lt_cv_dlopen_self_static" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_dlopen_self_static" >&5
+$as_echo "$lt_cv_dlopen_self_static" >&6; }
     fi
 
     CPPFLAGS="$save_CPPFLAGS"
@@ -10825,13 +9875,13 @@
 
 
 # Report which library types will actually be built
-{ echo "$as_me:$LINENO: checking if libtool supports shared libraries" >&5
-echo $ECHO_N "checking if libtool supports shared libraries... $ECHO_C" >&6; }
-{ echo "$as_me:$LINENO: result: $can_build_shared" >&5
-echo "${ECHO_T}$can_build_shared" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if libtool supports shared libraries" >&5
+$as_echo_n "checking if libtool supports shared libraries... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $can_build_shared" >&5
+$as_echo "$can_build_shared" >&6; }
 
-{ echo "$as_me:$LINENO: checking whether to build shared libraries" >&5
-echo $ECHO_N "checking whether to build shared libraries... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build shared libraries" >&5
+$as_echo_n "checking whether to build shared libraries... " >&6; }
 test "$can_build_shared" = "no" && enable_shared=no
 
 # On AIX, shared libraries and static libraries use the same namespace, and
@@ -10851,15 +9901,15 @@
   fi
     ;;
 esac
-{ echo "$as_me:$LINENO: result: $enable_shared" >&5
-echo "${ECHO_T}$enable_shared" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_shared" >&5
+$as_echo "$enable_shared" >&6; }
 
-{ echo "$as_me:$LINENO: checking whether to build static libraries" >&5
-echo $ECHO_N "checking whether to build static libraries... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build static libraries" >&5
+$as_echo_n "checking whether to build static libraries... " >&6; }
 # Make sure either enable_shared or enable_static is yes.
 test "$enable_shared" = yes || enable_static=yes
-{ echo "$as_me:$LINENO: result: $enable_static" >&5
-echo "${ECHO_T}$enable_static" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_static" >&5
+$as_echo "$enable_static" >&6; }
 
 # The else clause should only fire when bootstrapping the
 # libtool distribution, otherwise you forgot to ship ltmain.sh
@@ -10950,8 +10000,8 @@
 cfgfile="${ofile}T"
   trap "$rm \"$cfgfile\"; exit 1" 1 2 15
   $rm -f "$cfgfile"
-  { echo "$as_me:$LINENO: creating $ofile" >&5
-echo "$as_me: creating $ofile" >&6;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: creating $ofile" >&5
+$as_echo "$as_me: creating $ofile" >&6;}
 
   cat <<__EOF__ >> "$cfgfile"
 #! $SHELL
@@ -11352,25 +10402,25 @@
 
 
 # Check whether --with-tags was given.
-if test "${with_tags+set}" = set; then
+if test "${with_tags+set}" = set; then :
   withval=$with_tags; tagnames="$withval"
 fi
 
 
 if test -f "$ltmain" && test -n "$tagnames"; then
   if test ! -f "${ofile}"; then
-    { echo "$as_me:$LINENO: WARNING: output file \`$ofile' does not exist" >&5
-echo "$as_me: WARNING: output file \`$ofile' does not exist" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: output file \`$ofile' does not exist" >&5
+$as_echo "$as_me: WARNING: output file \`$ofile' does not exist" >&2;}
   fi
 
   if test -z "$LTCC"; then
     eval "`$SHELL ${ofile} --config | grep '^LTCC='`"
     if test -z "$LTCC"; then
-      { echo "$as_me:$LINENO: WARNING: output file \`$ofile' does not look like a libtool script" >&5
-echo "$as_me: WARNING: output file \`$ofile' does not look like a libtool script" >&2;}
+      { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: output file \`$ofile' does not look like a libtool script" >&5
+$as_echo "$as_me: WARNING: output file \`$ofile' does not look like a libtool script" >&2;}
     else
-      { echo "$as_me:$LINENO: WARNING: using \`LTCC=$LTCC', extracted from \`$ofile'" >&5
-echo "$as_me: WARNING: using \`LTCC=$LTCC', extracted from \`$ofile'" >&2;}
+      { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using \`LTCC=$LTCC', extracted from \`$ofile'" >&5
+$as_echo "$as_me: WARNING: using \`LTCC=$LTCC', extracted from \`$ofile'" >&2;}
     fi
   fi
   if test -z "$LTCFLAGS"; then
@@ -11387,17 +10437,13 @@
     # Check whether tagname contains only valid characters
     case `$echo "X$tagname" | $Xsed -e 's:[-_ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890,/]::g'` in
     "") ;;
-    *)  { { echo "$as_me:$LINENO: error: invalid tag name: $tagname" >&5
-echo "$as_me: error: invalid tag name: $tagname" >&2;}
-   { (exit 1); exit 1; }; }
+    *)  as_fn_error $? "invalid tag name: $tagname" "$LINENO" 5
 	;;
     esac
 
     if grep "^# ### BEGIN LIBTOOL TAG CONFIG: $tagname$" < "${ofile}" > /dev/null
     then
-      { { echo "$as_me:$LINENO: error: tag name \"$tagname\" already exists" >&5
-echo "$as_me: error: tag name \"$tagname\" already exists" >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "tag name \"$tagname\" already exists" "$LINENO" 5
     fi
 
     # Update the list of available tags.
@@ -11529,7 +10575,7 @@
 
 
 # Check whether --with-gnu-ld was given.
-if test "${with_gnu_ld+set}" = set; then
+if test "${with_gnu_ld+set}" = set; then :
   withval=$with_gnu_ld; test "$withval" = no || with_gnu_ld=yes
 else
   with_gnu_ld=no
@@ -11538,8 +10584,8 @@
 ac_prog=ld
 if test "$GCC" = yes; then
   # Check if gcc -print-prog-name=ld gives a path.
-  { echo "$as_me:$LINENO: checking for ld used by $CC" >&5
-echo $ECHO_N "checking for ld used by $CC... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ld used by $CC" >&5
+$as_echo_n "checking for ld used by $CC... " >&6; }
   case $host in
   *-*-mingw*)
     # gcc leaves a trailing carriage return which upsets mingw
@@ -11568,14 +10614,14 @@
     ;;
   esac
 elif test "$with_gnu_ld" = yes; then
-  { echo "$as_me:$LINENO: checking for GNU ld" >&5
-echo $ECHO_N "checking for GNU ld... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU ld" >&5
+$as_echo_n "checking for GNU ld... " >&6; }
 else
-  { echo "$as_me:$LINENO: checking for non-GNU ld" >&5
-echo $ECHO_N "checking for non-GNU ld... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for non-GNU ld" >&5
+$as_echo_n "checking for non-GNU ld... " >&6; }
 fi
-if test "${lt_cv_path_LD+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+if ${lt_cv_path_LD+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -z "$LD"; then
   lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
@@ -11605,19 +10651,17 @@
 
 LD="$lt_cv_path_LD"
 if test -n "$LD"; then
-  { echo "$as_me:$LINENO: result: $LD" >&5
-echo "${ECHO_T}$LD" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LD" >&5
+$as_echo "$LD" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
-test -z "$LD" && { { echo "$as_me:$LINENO: error: no acceptable ld found in \$PATH" >&5
-echo "$as_me: error: no acceptable ld found in \$PATH" >&2;}
-   { (exit 1); exit 1; }; }
-{ echo "$as_me:$LINENO: checking if the linker ($LD) is GNU ld" >&5
-echo $ECHO_N "checking if the linker ($LD) is GNU ld... $ECHO_C" >&6; }
-if test "${lt_cv_prog_gnu_ld+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
+$as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
+if ${lt_cv_prog_gnu_ld+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   # I'd rather use --version here, but apparently some GNU lds only accept -v.
 case `$LD -v 2>&1 </dev/null` in
@@ -11629,8 +10673,8 @@
   ;;
 esac
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_prog_gnu_ld" >&5
-echo "${ECHO_T}$lt_cv_prog_gnu_ld" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_gnu_ld" >&5
+$as_echo "$lt_cv_prog_gnu_ld" >&6; }
 with_gnu_ld=$lt_cv_prog_gnu_ld
 
 
@@ -11680,8 +10724,8 @@
 fi
 
 # PORTME: fill in a description of your system's C++ link characteristics
-{ echo "$as_me:$LINENO: checking whether the $compiler linker ($LD) supports shared libraries" >&5
-echo $ECHO_N "checking whether the $compiler linker ($LD) supports shared libraries... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+$as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
 ld_shlibs_CXX=yes
 case $host_os in
   aix3*)
@@ -11777,11 +10821,7 @@
       # -berok will link without error, but may produce a broken library.
       allow_undefined_flag_CXX='-berok'
       # Determine the default libpath from the value encoded in an empty executable.
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -11792,55 +10832,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_cxx_try_link "$LINENO"; then :
 
 aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`
 # Check for a 64-bit object if we didn't find anything.
 if test -z "$aix_libpath"; then aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`; fi
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
       hardcode_libdir_flag_spec_CXX='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -11853,11 +10854,7 @@
 	archive_expsym_cmds_CXX="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
       else
 	# Determine the default libpath from the value encoded in an empty executable.
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -11868,55 +10865,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_cxx_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_cxx_try_link "$LINENO"; then :
 
 aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`
 # Check for a 64-bit object if we didn't find anything.
 if test -z "$aix_libpath"; then aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`; fi
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
 	hardcode_libdir_flag_spec_CXX='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -12646,8 +11604,8 @@
     ld_shlibs_CXX=no
     ;;
 esac
-{ echo "$as_me:$LINENO: result: $ld_shlibs_CXX" >&5
-echo "${ECHO_T}$ld_shlibs_CXX" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs_CXX" >&5
+$as_echo "$ld_shlibs_CXX" >&6; }
 test "$ld_shlibs_CXX" = no && can_build_shared=no
 
 GCC_CXX="$GXX"
@@ -12664,11 +11622,11 @@
 };
 EOF
 
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
   # Parse the compiler output and extract the necessary
   # objects, libraries and library flags.
 
@@ -12786,8 +11744,8 @@
 lt_prog_compiler_pic_CXX=
 lt_prog_compiler_static_CXX=
 
-{ echo "$as_me:$LINENO: checking for $compiler option to produce PIC" >&5
-echo $ECHO_N "checking for $compiler option to produce PIC... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $compiler option to produce PIC" >&5
+$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
 
   # C++ specific cases for pic, static, wl, etc.
   if test "$GXX" = yes; then
@@ -13060,18 +12018,18 @@
     esac
   fi
 
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_pic_CXX" >&5
-echo "${ECHO_T}$lt_prog_compiler_pic_CXX" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_pic_CXX" >&5
+$as_echo "$lt_prog_compiler_pic_CXX" >&6; }
 
 #
 # Check to make sure the PIC flag actually works.
 #
 if test -n "$lt_prog_compiler_pic_CXX"; then
 
-{ echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works" >&5
-echo $ECHO_N "checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works... $ECHO_C" >&6; }
-if test "${lt_prog_compiler_pic_works_CXX+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works" >&5
+$as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works... " >&6; }
+if ${lt_prog_compiler_pic_works_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_prog_compiler_pic_works_CXX=no
   ac_outfile=conftest.$ac_objext
@@ -13086,11 +12044,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:13089: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:12047: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:13093: \$? = $ac_status" >&5
+   echo "$as_me:12051: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -13103,8 +12061,8 @@
    $rm conftest*
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_pic_works_CXX" >&5
-echo "${ECHO_T}$lt_prog_compiler_pic_works_CXX" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_pic_works_CXX" >&5
+$as_echo "$lt_prog_compiler_pic_works_CXX" >&6; }
 
 if test x"$lt_prog_compiler_pic_works_CXX" = xyes; then
     case $lt_prog_compiler_pic_CXX in
@@ -13131,10 +12089,10 @@
 # Check to make sure the static flag actually works.
 #
 wl=$lt_prog_compiler_wl_CXX eval lt_tmp_static_flag=\"$lt_prog_compiler_static_CXX\"
-{ echo "$as_me:$LINENO: checking if $compiler static flag $lt_tmp_static_flag works" >&5
-echo $ECHO_N "checking if $compiler static flag $lt_tmp_static_flag works... $ECHO_C" >&6; }
-if test "${lt_prog_compiler_static_works_CXX+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
+$as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
+if ${lt_prog_compiler_static_works_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_prog_compiler_static_works_CXX=no
    save_LDFLAGS="$LDFLAGS"
@@ -13159,8 +12117,8 @@
    LDFLAGS="$save_LDFLAGS"
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_static_works_CXX" >&5
-echo "${ECHO_T}$lt_prog_compiler_static_works_CXX" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_static_works_CXX" >&5
+$as_echo "$lt_prog_compiler_static_works_CXX" >&6; }
 
 if test x"$lt_prog_compiler_static_works_CXX" = xyes; then
     :
@@ -13169,10 +12127,10 @@
 fi
 
 
-{ echo "$as_me:$LINENO: checking if $compiler supports -c -o file.$ac_objext" >&5
-echo $ECHO_N "checking if $compiler supports -c -o file.$ac_objext... $ECHO_C" >&6; }
-if test "${lt_cv_prog_compiler_c_o_CXX+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
+$as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
+if ${lt_cv_prog_compiler_c_o_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_c_o_CXX=no
    $rm -r conftest 2>/dev/null
@@ -13190,11 +12148,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:13193: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:12151: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:13197: \$? = $ac_status" >&5
+   echo "$as_me:12155: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -13216,34 +12174,34 @@
    $rm conftest*
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_c_o_CXX" >&5
-echo "${ECHO_T}$lt_cv_prog_compiler_c_o_CXX" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o_CXX" >&5
+$as_echo "$lt_cv_prog_compiler_c_o_CXX" >&6; }
 
 
 hard_links="nottested"
 if test "$lt_cv_prog_compiler_c_o_CXX" = no && test "$need_locks" != no; then
   # do not overwrite the value of need_locks provided by the user
-  { echo "$as_me:$LINENO: checking if we can lock with hard links" >&5
-echo $ECHO_N "checking if we can lock with hard links... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we can lock with hard links" >&5
+$as_echo_n "checking if we can lock with hard links... " >&6; }
   hard_links=yes
   $rm conftest*
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
   touch conftest.a
   ln conftest.a conftest.b 2>&5 || hard_links=no
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
-  { echo "$as_me:$LINENO: result: $hard_links" >&5
-echo "${ECHO_T}$hard_links" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hard_links" >&5
+$as_echo "$hard_links" >&6; }
   if test "$hard_links" = no; then
-    { echo "$as_me:$LINENO: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
-echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
+$as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
     need_locks=warn
   fi
 else
   need_locks=no
 fi
 
-{ echo "$as_me:$LINENO: checking whether the $compiler linker ($LD) supports shared libraries" >&5
-echo $ECHO_N "checking whether the $compiler linker ($LD) supports shared libraries... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+$as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
 
   export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
   case $host_os in
@@ -13267,8 +12225,8 @@
   ;;
   esac
 
-{ echo "$as_me:$LINENO: result: $ld_shlibs_CXX" >&5
-echo "${ECHO_T}$ld_shlibs_CXX" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs_CXX" >&5
+$as_echo "$ld_shlibs_CXX" >&6; }
 test "$ld_shlibs_CXX" = no && can_build_shared=no
 
 #
@@ -13288,16 +12246,16 @@
       # Test whether the compiler implicitly links with -lc since on some
       # systems, -lgcc has to come before -lc. If gcc already passes -lc
       # to ld, don't add -lc before -lgcc.
-      { echo "$as_me:$LINENO: checking whether -lc should be explicitly linked in" >&5
-echo $ECHO_N "checking whether -lc should be explicitly linked in... $ECHO_C" >&6; }
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether -lc should be explicitly linked in" >&5
+$as_echo_n "checking whether -lc should be explicitly linked in... " >&6; }
       $rm conftest*
       printf "$lt_simple_compile_test_code" > conftest.$ac_ext
 
-      if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+      if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } 2>conftest.err; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } 2>conftest.err; then
         soname=conftest
         lib=conftest
         libobjs=conftest.$ac_objext
@@ -13311,11 +12269,11 @@
         libname=conftest
         lt_save_allow_undefined_flag=$allow_undefined_flag_CXX
         allow_undefined_flag_CXX=
-        if { (eval echo "$as_me:$LINENO: \"$archive_cmds_CXX 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1\"") >&5
+        if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$archive_cmds_CXX 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1\""; } >&5
   (eval $archive_cmds_CXX 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
         then
 	  archive_cmds_need_lc_CXX=no
         else
@@ -13326,16 +12284,16 @@
         cat conftest.err 1>&5
       fi
       $rm conftest*
-      { echo "$as_me:$LINENO: result: $archive_cmds_need_lc_CXX" >&5
-echo "${ECHO_T}$archive_cmds_need_lc_CXX" >&6; }
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: $archive_cmds_need_lc_CXX" >&5
+$as_echo "$archive_cmds_need_lc_CXX" >&6; }
       ;;
     esac
   fi
   ;;
 esac
 
-{ echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
-echo $ECHO_N "checking dynamic linker characteristics... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dynamic linker characteristics" >&5
+$as_echo_n "checking dynamic linker characteristics... " >&6; }
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
@@ -13922,8 +12880,8 @@
   dynamic_linker=no
   ;;
 esac
-{ echo "$as_me:$LINENO: result: $dynamic_linker" >&5
-echo "${ECHO_T}$dynamic_linker" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $dynamic_linker" >&5
+$as_echo "$dynamic_linker" >&6; }
 test "$dynamic_linker" = no && can_build_shared=no
 
 variables_saved_for_relink="PATH $shlibpath_var $runpath_var"
@@ -13931,8 +12889,8 @@
   variables_saved_for_relink="$variables_saved_for_relink GCC_EXEC_PREFIX COMPILER_PATH LIBRARY_PATH"
 fi
 
-{ echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
-echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to hardcode library paths into programs" >&5
+$as_echo_n "checking how to hardcode library paths into programs... " >&6; }
 hardcode_action_CXX=
 if test -n "$hardcode_libdir_flag_spec_CXX" || \
    test -n "$runpath_var_CXX" || \
@@ -13956,8 +12914,8 @@
   # directories.
   hardcode_action_CXX=unsupported
 fi
-{ echo "$as_me:$LINENO: result: $hardcode_action_CXX" >&5
-echo "${ECHO_T}$hardcode_action_CXX" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $hardcode_action_CXX" >&5
+$as_echo "$hardcode_action_CXX" >&6; }
 
 if test "$hardcode_action_CXX" = relink; then
   # Fast installation is not supported
@@ -14482,13 +13440,13 @@
 cc_basename=`$echo "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
 
 
-{ echo "$as_me:$LINENO: checking if libtool supports shared libraries" >&5
-echo $ECHO_N "checking if libtool supports shared libraries... $ECHO_C" >&6; }
-{ echo "$as_me:$LINENO: result: $can_build_shared" >&5
-echo "${ECHO_T}$can_build_shared" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if libtool supports shared libraries" >&5
+$as_echo_n "checking if libtool supports shared libraries... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $can_build_shared" >&5
+$as_echo "$can_build_shared" >&6; }
 
-{ echo "$as_me:$LINENO: checking whether to build shared libraries" >&5
-echo $ECHO_N "checking whether to build shared libraries... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build shared libraries" >&5
+$as_echo_n "checking whether to build shared libraries... " >&6; }
 test "$can_build_shared" = "no" && enable_shared=no
 
 # On AIX, shared libraries and static libraries use the same namespace, and
@@ -14507,15 +13465,15 @@
   fi
   ;;
 esac
-{ echo "$as_me:$LINENO: result: $enable_shared" >&5
-echo "${ECHO_T}$enable_shared" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_shared" >&5
+$as_echo "$enable_shared" >&6; }
 
-{ echo "$as_me:$LINENO: checking whether to build static libraries" >&5
-echo $ECHO_N "checking whether to build static libraries... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build static libraries" >&5
+$as_echo_n "checking whether to build static libraries... " >&6; }
 # Make sure either enable_shared or enable_static is yes.
 test "$enable_shared" = yes || enable_static=yes
-{ echo "$as_me:$LINENO: result: $enable_static" >&5
-echo "${ECHO_T}$enable_static" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_static" >&5
+$as_echo "$enable_static" >&6; }
 
 GCC_F77="$G77"
 LD_F77="$LD"
@@ -14524,8 +13482,8 @@
 lt_prog_compiler_pic_F77=
 lt_prog_compiler_static_F77=
 
-{ echo "$as_me:$LINENO: checking for $compiler option to produce PIC" >&5
-echo $ECHO_N "checking for $compiler option to produce PIC... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $compiler option to produce PIC" >&5
+$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
 
   if test "$GCC" = yes; then
     lt_prog_compiler_wl_F77='-Wl,'
@@ -14734,18 +13692,18 @@
     esac
   fi
 
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_pic_F77" >&5
-echo "${ECHO_T}$lt_prog_compiler_pic_F77" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_pic_F77" >&5
+$as_echo "$lt_prog_compiler_pic_F77" >&6; }
 
 #
 # Check to make sure the PIC flag actually works.
 #
 if test -n "$lt_prog_compiler_pic_F77"; then
 
-{ echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic_F77 works" >&5
-echo $ECHO_N "checking if $compiler PIC flag $lt_prog_compiler_pic_F77 works... $ECHO_C" >&6; }
-if test "${lt_prog_compiler_pic_works_F77+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic_F77 works" >&5
+$as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic_F77 works... " >&6; }
+if ${lt_prog_compiler_pic_works_F77+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_prog_compiler_pic_works_F77=no
   ac_outfile=conftest.$ac_objext
@@ -14760,11 +13718,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:14763: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:13721: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:14767: \$? = $ac_status" >&5
+   echo "$as_me:13725: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -14777,8 +13735,8 @@
    $rm conftest*
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_pic_works_F77" >&5
-echo "${ECHO_T}$lt_prog_compiler_pic_works_F77" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_pic_works_F77" >&5
+$as_echo "$lt_prog_compiler_pic_works_F77" >&6; }
 
 if test x"$lt_prog_compiler_pic_works_F77" = xyes; then
     case $lt_prog_compiler_pic_F77 in
@@ -14805,10 +13763,10 @@
 # Check to make sure the static flag actually works.
 #
 wl=$lt_prog_compiler_wl_F77 eval lt_tmp_static_flag=\"$lt_prog_compiler_static_F77\"
-{ echo "$as_me:$LINENO: checking if $compiler static flag $lt_tmp_static_flag works" >&5
-echo $ECHO_N "checking if $compiler static flag $lt_tmp_static_flag works... $ECHO_C" >&6; }
-if test "${lt_prog_compiler_static_works_F77+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
+$as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
+if ${lt_prog_compiler_static_works_F77+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_prog_compiler_static_works_F77=no
    save_LDFLAGS="$LDFLAGS"
@@ -14833,8 +13791,8 @@
    LDFLAGS="$save_LDFLAGS"
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_static_works_F77" >&5
-echo "${ECHO_T}$lt_prog_compiler_static_works_F77" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_static_works_F77" >&5
+$as_echo "$lt_prog_compiler_static_works_F77" >&6; }
 
 if test x"$lt_prog_compiler_static_works_F77" = xyes; then
     :
@@ -14843,10 +13801,10 @@
 fi
 
 
-{ echo "$as_me:$LINENO: checking if $compiler supports -c -o file.$ac_objext" >&5
-echo $ECHO_N "checking if $compiler supports -c -o file.$ac_objext... $ECHO_C" >&6; }
-if test "${lt_cv_prog_compiler_c_o_F77+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
+$as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
+if ${lt_cv_prog_compiler_c_o_F77+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_c_o_F77=no
    $rm -r conftest 2>/dev/null
@@ -14864,11 +13822,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:14867: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:13825: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:14871: \$? = $ac_status" >&5
+   echo "$as_me:13829: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -14890,34 +13848,34 @@
    $rm conftest*
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_c_o_F77" >&5
-echo "${ECHO_T}$lt_cv_prog_compiler_c_o_F77" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o_F77" >&5
+$as_echo "$lt_cv_prog_compiler_c_o_F77" >&6; }
 
 
 hard_links="nottested"
 if test "$lt_cv_prog_compiler_c_o_F77" = no && test "$need_locks" != no; then
   # do not overwrite the value of need_locks provided by the user
-  { echo "$as_me:$LINENO: checking if we can lock with hard links" >&5
-echo $ECHO_N "checking if we can lock with hard links... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we can lock with hard links" >&5
+$as_echo_n "checking if we can lock with hard links... " >&6; }
   hard_links=yes
   $rm conftest*
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
   touch conftest.a
   ln conftest.a conftest.b 2>&5 || hard_links=no
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
-  { echo "$as_me:$LINENO: result: $hard_links" >&5
-echo "${ECHO_T}$hard_links" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hard_links" >&5
+$as_echo "$hard_links" >&6; }
   if test "$hard_links" = no; then
-    { echo "$as_me:$LINENO: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
-echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
+$as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
     need_locks=warn
   fi
 else
   need_locks=no
 fi
 
-{ echo "$as_me:$LINENO: checking whether the $compiler linker ($LD) supports shared libraries" >&5
-echo $ECHO_N "checking whether the $compiler linker ($LD) supports shared libraries... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+$as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
 
   runpath_var=
   allow_undefined_flag_F77=
@@ -15316,60 +14274,21 @@
 	# -berok will link without error, but may produce a broken library.
 	allow_undefined_flag_F77='-berok'
        # Determine the default libpath from the value encoded in an empty executable.
-       cat >conftest.$ac_ext <<_ACEOF
+       cat > conftest.$ac_ext <<_ACEOF
       program main
 
       end
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_f77_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_f77_try_link "$LINENO"; then :
 
 aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`
 # Check for a 64-bit object if we didn't find anything.
 if test -z "$aix_libpath"; then aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`; fi
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
        hardcode_libdir_flag_spec_F77='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -15381,60 +14300,21 @@
 	  archive_expsym_cmds_F77="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
 	else
 	 # Determine the default libpath from the value encoded in an empty executable.
-	 cat >conftest.$ac_ext <<_ACEOF
+	 cat > conftest.$ac_ext <<_ACEOF
       program main
 
       end
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_f77_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_f77_try_link "$LINENO"; then :
 
 aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`
 # Check for a 64-bit object if we didn't find anything.
 if test -z "$aix_libpath"; then aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`; fi
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
 	 hardcode_libdir_flag_spec_F77='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -15882,8 +14762,8 @@
     esac
   fi
 
-{ echo "$as_me:$LINENO: result: $ld_shlibs_F77" >&5
-echo "${ECHO_T}$ld_shlibs_F77" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs_F77" >&5
+$as_echo "$ld_shlibs_F77" >&6; }
 test "$ld_shlibs_F77" = no && can_build_shared=no
 
 #
@@ -15903,16 +14783,16 @@
       # Test whether the compiler implicitly links with -lc since on some
       # systems, -lgcc has to come before -lc. If gcc already passes -lc
       # to ld, don't add -lc before -lgcc.
-      { echo "$as_me:$LINENO: checking whether -lc should be explicitly linked in" >&5
-echo $ECHO_N "checking whether -lc should be explicitly linked in... $ECHO_C" >&6; }
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether -lc should be explicitly linked in" >&5
+$as_echo_n "checking whether -lc should be explicitly linked in... " >&6; }
       $rm conftest*
       printf "$lt_simple_compile_test_code" > conftest.$ac_ext
 
-      if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+      if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } 2>conftest.err; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } 2>conftest.err; then
         soname=conftest
         lib=conftest
         libobjs=conftest.$ac_objext
@@ -15926,11 +14806,11 @@
         libname=conftest
         lt_save_allow_undefined_flag=$allow_undefined_flag_F77
         allow_undefined_flag_F77=
-        if { (eval echo "$as_me:$LINENO: \"$archive_cmds_F77 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1\"") >&5
+        if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$archive_cmds_F77 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1\""; } >&5
   (eval $archive_cmds_F77 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
         then
 	  archive_cmds_need_lc_F77=no
         else
@@ -15941,16 +14821,16 @@
         cat conftest.err 1>&5
       fi
       $rm conftest*
-      { echo "$as_me:$LINENO: result: $archive_cmds_need_lc_F77" >&5
-echo "${ECHO_T}$archive_cmds_need_lc_F77" >&6; }
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: $archive_cmds_need_lc_F77" >&5
+$as_echo "$archive_cmds_need_lc_F77" >&6; }
       ;;
     esac
   fi
   ;;
 esac
 
-{ echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
-echo $ECHO_N "checking dynamic linker characteristics... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dynamic linker characteristics" >&5
+$as_echo_n "checking dynamic linker characteristics... " >&6; }
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
@@ -16537,8 +15417,8 @@
   dynamic_linker=no
   ;;
 esac
-{ echo "$as_me:$LINENO: result: $dynamic_linker" >&5
-echo "${ECHO_T}$dynamic_linker" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $dynamic_linker" >&5
+$as_echo "$dynamic_linker" >&6; }
 test "$dynamic_linker" = no && can_build_shared=no
 
 variables_saved_for_relink="PATH $shlibpath_var $runpath_var"
@@ -16546,8 +15426,8 @@
   variables_saved_for_relink="$variables_saved_for_relink GCC_EXEC_PREFIX COMPILER_PATH LIBRARY_PATH"
 fi
 
-{ echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
-echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to hardcode library paths into programs" >&5
+$as_echo_n "checking how to hardcode library paths into programs... " >&6; }
 hardcode_action_F77=
 if test -n "$hardcode_libdir_flag_spec_F77" || \
    test -n "$runpath_var_F77" || \
@@ -16571,8 +15451,8 @@
   # directories.
   hardcode_action_F77=unsupported
 fi
-{ echo "$as_me:$LINENO: result: $hardcode_action_F77" >&5
-echo "${ECHO_T}$hardcode_action_F77" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $hardcode_action_F77" >&5
+$as_echo "$hardcode_action_F77" >&6; }
 
 if test "$hardcode_action_F77" = relink; then
   # Fast installation is not supported
@@ -17076,10 +15956,10 @@
   lt_prog_compiler_no_builtin_flag_GCJ=' -fno-builtin'
 
 
-{ echo "$as_me:$LINENO: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
-echo $ECHO_N "checking if $compiler supports -fno-rtti -fno-exceptions... $ECHO_C" >&6; }
-if test "${lt_cv_prog_compiler_rtti_exceptions+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
+$as_echo_n "checking if $compiler supports -fno-rtti -fno-exceptions... " >&6; }
+if ${lt_cv_prog_compiler_rtti_exceptions+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_rtti_exceptions=no
   ac_outfile=conftest.$ac_objext
@@ -17094,11 +15974,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:17097: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:15977: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:17101: \$? = $ac_status" >&5
+   echo "$as_me:15981: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -17111,8 +15991,8 @@
    $rm conftest*
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_rtti_exceptions" >&5
-echo "${ECHO_T}$lt_cv_prog_compiler_rtti_exceptions" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_rtti_exceptions" >&5
+$as_echo "$lt_cv_prog_compiler_rtti_exceptions" >&6; }
 
 if test x"$lt_cv_prog_compiler_rtti_exceptions" = xyes; then
     lt_prog_compiler_no_builtin_flag_GCJ="$lt_prog_compiler_no_builtin_flag_GCJ -fno-rtti -fno-exceptions"
@@ -17126,8 +16006,8 @@
 lt_prog_compiler_pic_GCJ=
 lt_prog_compiler_static_GCJ=
 
-{ echo "$as_me:$LINENO: checking for $compiler option to produce PIC" >&5
-echo $ECHO_N "checking for $compiler option to produce PIC... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $compiler option to produce PIC" >&5
+$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
 
   if test "$GCC" = yes; then
     lt_prog_compiler_wl_GCJ='-Wl,'
@@ -17336,18 +16216,18 @@
     esac
   fi
 
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_pic_GCJ" >&5
-echo "${ECHO_T}$lt_prog_compiler_pic_GCJ" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_pic_GCJ" >&5
+$as_echo "$lt_prog_compiler_pic_GCJ" >&6; }
 
 #
 # Check to make sure the PIC flag actually works.
 #
 if test -n "$lt_prog_compiler_pic_GCJ"; then
 
-{ echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic_GCJ works" >&5
-echo $ECHO_N "checking if $compiler PIC flag $lt_prog_compiler_pic_GCJ works... $ECHO_C" >&6; }
-if test "${lt_prog_compiler_pic_works_GCJ+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic_GCJ works" >&5
+$as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic_GCJ works... " >&6; }
+if ${lt_prog_compiler_pic_works_GCJ+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_prog_compiler_pic_works_GCJ=no
   ac_outfile=conftest.$ac_objext
@@ -17362,11 +16242,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:17365: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:16245: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:17369: \$? = $ac_status" >&5
+   echo "$as_me:16249: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
@@ -17379,8 +16259,8 @@
    $rm conftest*
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_pic_works_GCJ" >&5
-echo "${ECHO_T}$lt_prog_compiler_pic_works_GCJ" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_pic_works_GCJ" >&5
+$as_echo "$lt_prog_compiler_pic_works_GCJ" >&6; }
 
 if test x"$lt_prog_compiler_pic_works_GCJ" = xyes; then
     case $lt_prog_compiler_pic_GCJ in
@@ -17407,10 +16287,10 @@
 # Check to make sure the static flag actually works.
 #
 wl=$lt_prog_compiler_wl_GCJ eval lt_tmp_static_flag=\"$lt_prog_compiler_static_GCJ\"
-{ echo "$as_me:$LINENO: checking if $compiler static flag $lt_tmp_static_flag works" >&5
-echo $ECHO_N "checking if $compiler static flag $lt_tmp_static_flag works... $ECHO_C" >&6; }
-if test "${lt_prog_compiler_static_works_GCJ+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
+$as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
+if ${lt_prog_compiler_static_works_GCJ+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_prog_compiler_static_works_GCJ=no
    save_LDFLAGS="$LDFLAGS"
@@ -17435,8 +16315,8 @@
    LDFLAGS="$save_LDFLAGS"
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_prog_compiler_static_works_GCJ" >&5
-echo "${ECHO_T}$lt_prog_compiler_static_works_GCJ" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_prog_compiler_static_works_GCJ" >&5
+$as_echo "$lt_prog_compiler_static_works_GCJ" >&6; }
 
 if test x"$lt_prog_compiler_static_works_GCJ" = xyes; then
     :
@@ -17445,10 +16325,10 @@
 fi
 
 
-{ echo "$as_me:$LINENO: checking if $compiler supports -c -o file.$ac_objext" >&5
-echo $ECHO_N "checking if $compiler supports -c -o file.$ac_objext... $ECHO_C" >&6; }
-if test "${lt_cv_prog_compiler_c_o_GCJ+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
+$as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
+if ${lt_cv_prog_compiler_c_o_GCJ+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_c_o_GCJ=no
    $rm -r conftest 2>/dev/null
@@ -17466,11 +16346,11 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:17469: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:16349: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:17473: \$? = $ac_status" >&5
+   echo "$as_me:16353: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
@@ -17492,34 +16372,34 @@
    $rm conftest*
 
 fi
-{ echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_c_o_GCJ" >&5
-echo "${ECHO_T}$lt_cv_prog_compiler_c_o_GCJ" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o_GCJ" >&5
+$as_echo "$lt_cv_prog_compiler_c_o_GCJ" >&6; }
 
 
 hard_links="nottested"
 if test "$lt_cv_prog_compiler_c_o_GCJ" = no && test "$need_locks" != no; then
   # do not overwrite the value of need_locks provided by the user
-  { echo "$as_me:$LINENO: checking if we can lock with hard links" >&5
-echo $ECHO_N "checking if we can lock with hard links... $ECHO_C" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we can lock with hard links" >&5
+$as_echo_n "checking if we can lock with hard links... " >&6; }
   hard_links=yes
   $rm conftest*
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
   touch conftest.a
   ln conftest.a conftest.b 2>&5 || hard_links=no
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
-  { echo "$as_me:$LINENO: result: $hard_links" >&5
-echo "${ECHO_T}$hard_links" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hard_links" >&5
+$as_echo "$hard_links" >&6; }
   if test "$hard_links" = no; then
-    { echo "$as_me:$LINENO: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
-echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
+$as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
     need_locks=warn
   fi
 else
   need_locks=no
 fi
 
-{ echo "$as_me:$LINENO: checking whether the $compiler linker ($LD) supports shared libraries" >&5
-echo $ECHO_N "checking whether the $compiler linker ($LD) supports shared libraries... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+$as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
 
   runpath_var=
   allow_undefined_flag_GCJ=
@@ -17918,11 +16798,7 @@
 	# -berok will link without error, but may produce a broken library.
 	allow_undefined_flag_GCJ='-berok'
        # Determine the default libpath from the value encoded in an empty executable.
-       cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+       cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -17933,55 +16809,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
 
 aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`
 # Check for a 64-bit object if we didn't find anything.
 if test -z "$aix_libpath"; then aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`; fi
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
        hardcode_libdir_flag_spec_GCJ='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -17993,11 +16830,7 @@
 	  archive_expsym_cmds_GCJ="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
 	else
 	 # Determine the default libpath from the value encoded in an empty executable.
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -18008,55 +16841,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
 
 aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`
 # Check for a 64-bit object if we didn't find anything.
 if test -z "$aix_libpath"; then aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`; fi
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
 
 	 hardcode_libdir_flag_spec_GCJ='${wl}-blibpath:$libdir:'"$aix_libpath"
@@ -18504,8 +17298,8 @@
     esac
   fi
 
-{ echo "$as_me:$LINENO: result: $ld_shlibs_GCJ" >&5
-echo "${ECHO_T}$ld_shlibs_GCJ" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs_GCJ" >&5
+$as_echo "$ld_shlibs_GCJ" >&6; }
 test "$ld_shlibs_GCJ" = no && can_build_shared=no
 
 #
@@ -18525,16 +17319,16 @@
       # Test whether the compiler implicitly links with -lc since on some
       # systems, -lgcc has to come before -lc. If gcc already passes -lc
       # to ld, don't add -lc before -lgcc.
-      { echo "$as_me:$LINENO: checking whether -lc should be explicitly linked in" >&5
-echo $ECHO_N "checking whether -lc should be explicitly linked in... $ECHO_C" >&6; }
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether -lc should be explicitly linked in" >&5
+$as_echo_n "checking whether -lc should be explicitly linked in... " >&6; }
       $rm conftest*
       printf "$lt_simple_compile_test_code" > conftest.$ac_ext
 
-      if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+      if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } 2>conftest.err; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } 2>conftest.err; then
         soname=conftest
         lib=conftest
         libobjs=conftest.$ac_objext
@@ -18548,11 +17342,11 @@
         libname=conftest
         lt_save_allow_undefined_flag=$allow_undefined_flag_GCJ
         allow_undefined_flag_GCJ=
-        if { (eval echo "$as_me:$LINENO: \"$archive_cmds_GCJ 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1\"") >&5
+        if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$archive_cmds_GCJ 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1\""; } >&5
   (eval $archive_cmds_GCJ 2\>\&1 \| grep \" -lc \" \>/dev/null 2\>\&1) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
         then
 	  archive_cmds_need_lc_GCJ=no
         else
@@ -18563,16 +17357,16 @@
         cat conftest.err 1>&5
       fi
       $rm conftest*
-      { echo "$as_me:$LINENO: result: $archive_cmds_need_lc_GCJ" >&5
-echo "${ECHO_T}$archive_cmds_need_lc_GCJ" >&6; }
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: $archive_cmds_need_lc_GCJ" >&5
+$as_echo "$archive_cmds_need_lc_GCJ" >&6; }
       ;;
     esac
   fi
   ;;
 esac
 
-{ echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
-echo $ECHO_N "checking dynamic linker characteristics... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dynamic linker characteristics" >&5
+$as_echo_n "checking dynamic linker characteristics... " >&6; }
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
@@ -19159,8 +17953,8 @@
   dynamic_linker=no
   ;;
 esac
-{ echo "$as_me:$LINENO: result: $dynamic_linker" >&5
-echo "${ECHO_T}$dynamic_linker" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $dynamic_linker" >&5
+$as_echo "$dynamic_linker" >&6; }
 test "$dynamic_linker" = no && can_build_shared=no
 
 variables_saved_for_relink="PATH $shlibpath_var $runpath_var"
@@ -19168,8 +17962,8 @@
   variables_saved_for_relink="$variables_saved_for_relink GCC_EXEC_PREFIX COMPILER_PATH LIBRARY_PATH"
 fi
 
-{ echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
-echo $ECHO_N "checking how to hardcode library paths into programs... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to hardcode library paths into programs" >&5
+$as_echo_n "checking how to hardcode library paths into programs... " >&6; }
 hardcode_action_GCJ=
 if test -n "$hardcode_libdir_flag_spec_GCJ" || \
    test -n "$runpath_var_GCJ" || \
@@ -19193,8 +17987,8 @@
   # directories.
   hardcode_action_GCJ=unsupported
 fi
-{ echo "$as_me:$LINENO: result: $hardcode_action_GCJ" >&5
-echo "${ECHO_T}$hardcode_action_GCJ" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $hardcode_action_GCJ" >&5
+$as_echo "$hardcode_action_GCJ" >&6; }
 
 if test "$hardcode_action_GCJ" = relink; then
   # Fast installation is not supported
@@ -20105,9 +18899,7 @@
 	;;
 
       *)
-	{ { echo "$as_me:$LINENO: error: Unsupported tag name: $tagname" >&5
-echo "$as_me: error: Unsupported tag name: $tagname" >&2;}
-   { (exit 1); exit 1; }; }
+	as_fn_error $? "Unsupported tag name: $tagname" "$LINENO" 5
 	;;
       esac
 
@@ -20125,9 +18917,7 @@
     chmod +x "$ofile"
   else
     rm -f "${ofile}T"
-    { { echo "$as_me:$LINENO: error: unable to update list of available tagged configurations." >&5
-echo "$as_me: error: unable to update list of available tagged configurations." >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "unable to update list of available tagged configurations." "$LINENO" 5
   fi
 fi
 
@@ -20160,98 +18950,20 @@
 
 
 
-# Find a good install program.  We prefer a C program (faster),
-# so one script is as good as another.  But avoid the broken or
-# incompatible versions:
-# SysV /etc/install, /usr/sbin/install
-# SunOS /usr/etc/install
-# IRIX /sbin/install
-# AIX /bin/install
-# AmigaOS /C/install, which installs bootblocks on floppy discs
-# AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
-# AFS /usr/afsws/bin/install, which mishandles nonexistent args
-# SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
-# OS/2's system install, which has a completely different semantic
-# ./install, which can be erroneously created by make from ./install.sh.
-{ echo "$as_me:$LINENO: checking for a BSD-compatible install" >&5
-echo $ECHO_N "checking for a BSD-compatible install... $ECHO_C" >&6; }
-if test -z "$INSTALL"; then
-if test "${ac_cv_path_install+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  # Account for people who put trailing slashes in PATH elements.
-case $as_dir/ in
-  ./ | .// | /cC/* | \
-  /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
-  ?:\\/os2\\/install\\/* | ?:\\/OS2\\/INSTALL\\/* | \
-  /usr/ucb/* ) ;;
-  *)
-    # OSF1 and SCO ODT 3.0 have their own names for install.
-    # Don't use installbsd from OSF since it installs stuff as root
-    # by default.
-    for ac_prog in ginstall scoinst install; do
-      for ac_exec_ext in '' $ac_executable_extensions; do
-	if { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_executable_p "$as_dir/$ac_prog$ac_exec_ext"; }; then
-	  if test $ac_prog = install &&
-	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
-	    # AIX install.  It has an incompatible calling convention.
-	    :
-	  elif test $ac_prog = install &&
-	    grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
-	    # program-specific install script used by HP pwplus--don't use.
-	    :
-	  else
-	    ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
-	    break 3
-	  fi
-	fi
-      done
-    done
-    ;;
-esac
-done
-IFS=$as_save_IFS
-
-
-fi
-  if test "${ac_cv_path_install+set}" = set; then
-    INSTALL=$ac_cv_path_install
-  else
-    # As a last resort, use the slow shell script.  Don't cache a
-    # value for INSTALL within a source directory, because that will
-    # break other packages using the cache if that directory is
-    # removed, or if the value is a relative name.
-    INSTALL=$ac_install_sh
-  fi
-fi
-{ echo "$as_me:$LINENO: result: $INSTALL" >&5
-echo "${ECHO_T}$INSTALL" >&6; }
-
-# Use test -z because SunOS4 sh mishandles braces in ${var-val}.
-# It thinks the first close brace ends the variable substitution.
-test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
-
-test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL}'
-
-test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
-{ echo "$as_me:$LINENO: checking whether ${MAKE-make} sets \$(MAKE)" >&5
-echo $ECHO_N "checking whether ${MAKE-make} sets \$(MAKE)... $ECHO_C" >&6; }
-set x ${MAKE-make}; ac_make=`echo "$2" | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
-if { as_var=ac_cv_prog_make_${ac_make}_set; eval "test \"\${$as_var+set}\" = set"; }; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ${MAKE-make} sets \$(MAKE)" >&5
+$as_echo_n "checking whether ${MAKE-make} sets \$(MAKE)... " >&6; }
+set x ${MAKE-make}
+ac_make=`$as_echo "$2" | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
+if eval \${ac_cv_prog_make_${ac_make}_set+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   cat >conftest.make <<\_ACEOF
 SHELL = /bin/sh
 all:
 	@echo '@@@%%%=$(MAKE)=@@@%%%'
 _ACEOF
-# GNU make sometimes prints "make[1]: Entering...", which would confuse us.
+# GNU make sometimes prints "make[1]: Entering ...", which would confuse us.
 case `${MAKE-make} -f conftest.make 2>/dev/null` in
   *@@@%%%=?*=@@@%%%*)
     eval ac_cv_prog_make_${ac_make}_set=yes;;
@@ -20261,57 +18973,52 @@
 rm -f conftest.make
 fi
 if eval test \$ac_cv_prog_make_${ac_make}_set = yes; then
-  { echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
   SET_MAKE=
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
   SET_MAKE="MAKE=${MAKE-make}"
 fi
 
-{ echo "$as_me:$LINENO: checking for egrep" >&5
-echo $ECHO_N "checking for egrep... $ECHO_C" >&6; }
-if test "${ac_cv_path_EGREP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
+$as_echo_n "checking for egrep... " >&6; }
+if ${ac_cv_path_EGREP+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
    then ac_cv_path_EGREP="$GREP -E"
    else
-     # Extract the first word of "egrep" to use in msg output
-if test -z "$EGREP"; then
-set dummy egrep; ac_prog_name=$2
-if test "${ac_cv_path_EGREP+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
+     if test -z "$EGREP"; then
   ac_path_EGREP_found=false
-# Loop through the user's path and test for each of PROGNAME-LIST
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in egrep; do
-  for ac_exec_ext in '' $ac_executable_extensions; do
-    ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-    { test -f "$ac_path_EGREP" && $as_executable_p "$ac_path_EGREP"; } || continue
-    # Check for GNU ac_path_EGREP and select it if it is found.
+    for ac_prog in egrep; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
+      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
+# Check for GNU ac_path_EGREP and select it if it is found.
   # Check for GNU $ac_path_EGREP
 case `"$ac_path_EGREP" --version 2>&1` in
 *GNU*)
   ac_cv_path_EGREP="$ac_path_EGREP" ac_path_EGREP_found=:;;
 *)
   ac_count=0
-  echo $ECHO_N "0123456789$ECHO_C" >"conftest.in"
+  $as_echo_n 0123456789 >"conftest.in"
   while :
   do
     cat "conftest.in" "conftest.in" >"conftest.tmp"
     mv "conftest.tmp" "conftest.in"
     cp "conftest.in" "conftest.nl"
-    echo 'EGREP' >> "conftest.nl"
+    $as_echo 'EGREP' >> "conftest.nl"
     "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_EGREP_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_EGREP="$ac_path_EGREP"
@@ -20323,33 +19030,22 @@
   rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
 esac
 
-
-    $ac_path_EGREP_found && break 3
+      $ac_path_EGREP_found && break 3
+    done
+  done
   done
-done
-
-done
 IFS=$as_save_IFS
-
-
-fi
-
-EGREP="$ac_cv_path_EGREP"
-if test -z "$EGREP"; then
-  { { echo "$as_me:$LINENO: error: no acceptable $ac_prog_name could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-echo "$as_me: error: no acceptable $ac_prog_name could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
+  if test -z "$ac_cv_path_EGREP"; then
+    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+  fi
 else
   ac_cv_path_EGREP=$EGREP
 fi
 
-
    fi
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_path_EGREP" >&5
-echo "${ECHO_T}$ac_cv_path_EGREP" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
+$as_echo "$ac_cv_path_EGREP" >&6; }
  EGREP="$ac_cv_path_EGREP"
 
 
@@ -20371,10 +19067,10 @@
 		# AC_PROG_CC already sets CFLAGS to "-g -O2" by default
 		#:
 		# Use -O0 in debug so that variables do not get optimized out
-		{ echo "$as_me:$LINENO: checking CFLAGS for gcc -O0" >&5
-echo $ECHO_N "checking CFLAGS for gcc -O0... $ECHO_C" >&6; }
-if test "${ac_cv_cflags_gcc_option__O0+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CFLAGS for gcc -O0" >&5
+$as_echo_n "checking CFLAGS for gcc -O0... " >&6; }
+if ${ac_cv_cflags_gcc_option__O0+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_cv_cflags_gcc_option__O0="no, unknown"
 
@@ -20387,11 +19083,7 @@
  ac_save_CFLAGS="$CFLAGS"
 for ac_arg in "-pedantic -Werror % -O0"     "-pedantic % -O0 %% no, obsolete"     #
 do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -20402,48 +19094,9 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_cflags_gcc_option__O0=`echo $ac_arg | sed -e 's,.*% *,,'` ; break
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 done
  CFLAGS="$ac_save_CFLAGS"
@@ -20455,23 +19108,23 @@
 
 
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_cflags_gcc_option__O0" >&5
-echo "${ECHO_T}$ac_cv_cflags_gcc_option__O0" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_cflags_gcc_option__O0" >&5
+$as_echo "$ac_cv_cflags_gcc_option__O0" >&6; }
 case ".$ac_cv_cflags_gcc_option__O0" in
      .ok|.ok,*)  ;;
    .|.no|.no,*)  ;;
    *)
    if echo " $CFLAGS " | grep " $ac_cv_cflags_gcc_option__O0 " 2>&1 >/dev/null
-   then { (echo "$as_me:$LINENO: : CFLAGS does contain \$ac_cv_cflags_gcc_option__O0") >&5
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CFLAGS does contain \$ac_cv_cflags_gcc_option__O0"; } >&5
   (: CFLAGS does contain $ac_cv_cflags_gcc_option__O0) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-   else { (echo "$as_me:$LINENO: : CFLAGS=\"\$CFLAGS \$ac_cv_cflags_gcc_option__O0\"") >&5
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CFLAGS=\"\$CFLAGS \$ac_cv_cflags_gcc_option__O0\""; } >&5
   (: CFLAGS="$CFLAGS $ac_cv_cflags_gcc_option__O0") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
                       CFLAGS="$CFLAGS $ac_cv_cflags_gcc_option__O0"
    fi
  ;;
@@ -20479,10 +19132,10 @@
 
 	else
 		# add optimise for size
-		{ echo "$as_me:$LINENO: checking CFLAGS for gcc -Os" >&5
-echo $ECHO_N "checking CFLAGS for gcc -Os... $ECHO_C" >&6; }
-if test "${ac_cv_cflags_gcc_option__Os+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CFLAGS for gcc -Os" >&5
+$as_echo_n "checking CFLAGS for gcc -Os... " >&6; }
+if ${ac_cv_cflags_gcc_option__Os+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_cv_cflags_gcc_option__Os="no, unknown"
 
@@ -20495,11 +19148,7 @@
  ac_save_CFLAGS="$CFLAGS"
 for ac_arg in "-pedantic -Werror % -Os"     "-pedantic % -Os %% no, obsolete"     #
 do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -20510,48 +19159,9 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_cflags_gcc_option__Os=`echo $ac_arg | sed -e 's,.*% *,,'` ; break
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 done
  CFLAGS="$ac_save_CFLAGS"
@@ -20563,23 +19173,23 @@
 
 
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_cflags_gcc_option__Os" >&5
-echo "${ECHO_T}$ac_cv_cflags_gcc_option__Os" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_cflags_gcc_option__Os" >&5
+$as_echo "$ac_cv_cflags_gcc_option__Os" >&6; }
 case ".$ac_cv_cflags_gcc_option__Os" in
      .ok|.ok,*)  ;;
    .|.no|.no,*)  ;;
    *)
    if echo " $CFLAGS " | grep " $ac_cv_cflags_gcc_option__Os " 2>&1 >/dev/null
-   then { (echo "$as_me:$LINENO: : CFLAGS does contain \$ac_cv_cflags_gcc_option__Os") >&5
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CFLAGS does contain \$ac_cv_cflags_gcc_option__Os"; } >&5
   (: CFLAGS does contain $ac_cv_cflags_gcc_option__Os) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-   else { (echo "$as_me:$LINENO: : CFLAGS=\"\$CFLAGS \$ac_cv_cflags_gcc_option__Os\"") >&5
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CFLAGS=\"\$CFLAGS \$ac_cv_cflags_gcc_option__Os\""; } >&5
   (: CFLAGS="$CFLAGS $ac_cv_cflags_gcc_option__Os") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
                       CFLAGS="$CFLAGS $ac_cv_cflags_gcc_option__Os"
    fi
  ;;
@@ -20589,10 +19199,10 @@
 	;;
 esac
 
-{ echo "$as_me:$LINENO: checking CFLAGS for maximum warnings" >&5
-echo $ECHO_N "checking CFLAGS for maximum warnings... $ECHO_C" >&6; }
-if test "${ac_cv_cflags_warn_all+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CFLAGS for maximum warnings" >&5
+$as_echo_n "checking CFLAGS for maximum warnings... " >&6; }
+if ${ac_cv_cflags_warn_all+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_cv_cflags_warn_all="no, unknown"
 
@@ -20605,11 +19215,7 @@
  ac_save_CFLAGS="$CFLAGS"
 for ac_arg in "-pedantic  % -Wall"          "-xstrconst % -v"             "-std1      % -verbose -w0 -warnprotos"    "-qlanglvl=ansi % -qsrcmsg -qinfo=all:noppt:noppc:noobs:nocnd"    "-ansi -ansiE % -fullwarn"    "+ESlit     % +w1"            "-Xc        % -pvctl,fullmsg"    "-h conform % -h msglevel 2"    #
 do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -20620,48 +19226,9 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_cflags_warn_all=`echo $ac_arg | sed -e 's,.*% *,,'` ; break
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 done
  CFLAGS="$ac_save_CFLAGS"
@@ -20673,24 +19240,24 @@
 
 
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_cflags_warn_all" >&5
-echo "${ECHO_T}$ac_cv_cflags_warn_all" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_cflags_warn_all" >&5
+$as_echo "$ac_cv_cflags_warn_all" >&6; }
 case ".$ac_cv_cflags_warn_all" in
      .ok|.ok,*)  ;;
    .|.no|.no,*)
  ;;
    *)
    if echo " $CFLAGS " | grep " $ac_cv_cflags_warn_all " 2>&1 >/dev/null
-   then { (echo "$as_me:$LINENO: : CFLAGS does contain \$ac_cv_cflags_warn_all") >&5
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CFLAGS does contain \$ac_cv_cflags_warn_all"; } >&5
   (: CFLAGS does contain $ac_cv_cflags_warn_all) 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-   else { (echo "$as_me:$LINENO: : CFLAGS=\"\$CFLAGS \$ac_cv_cflags_warn_all\"") >&5
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CFLAGS=\"\$CFLAGS \$ac_cv_cflags_warn_all\""; } >&5
   (: CFLAGS="$CFLAGS $ac_cv_cflags_warn_all") 2>&5
   ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
                       CFLAGS="$CFLAGS $ac_cv_cflags_warn_all"
    fi
  ;;
@@ -20702,78 +19269,9 @@
 #
 # Lot's of stuff to ensure large file support
 #
-{ echo "$as_me:$LINENO: checking for size_t" >&5
-echo $ECHO_N "checking for size_t... $ECHO_C" >&6; }
-if test "${ac_cv_type_size_t+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-typedef size_t ac__type_new_;
-int
-main ()
-{
-if ((ac__type_new_ *) 0)
-  return 0;
-if (sizeof (ac__type_new_))
-  return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_type_size_t=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_type_size_t=no
-fi
+ac_fn_c_check_type "$LINENO" "size_t" "ac_cv_type_size_t" "$ac_includes_default"
+if test "x$ac_cv_type_size_t" = xyes; then :
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_type_size_t" >&5
-echo "${ECHO_T}$ac_cv_type_size_t" >&6; }
-if test $ac_cv_type_size_t = yes; then
-  :
 else
 
 cat >>confdefs.h <<_ACEOF
@@ -20782,78 +19280,9 @@
 
 fi
 
-{ echo "$as_me:$LINENO: checking for off_t" >&5
-echo $ECHO_N "checking for off_t... $ECHO_C" >&6; }
-if test "${ac_cv_type_off_t+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-typedef off_t ac__type_new_;
-int
-main ()
-{
-if ((ac__type_new_ *) 0)
-  return 0;
-if (sizeof (ac__type_new_))
-  return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_type_off_t=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_type_off_t=no
-fi
+ac_fn_c_check_type "$LINENO" "off_t" "ac_cv_type_off_t" "$ac_includes_default"
+if test "x$ac_cv_type_off_t" = xyes; then :
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_type_off_t" >&5
-echo "${ECHO_T}$ac_cv_type_off_t" >&6; }
-if test $ac_cv_type_off_t = yes; then
-  :
 else
 
 cat >>confdefs.h <<_ACEOF
@@ -20863,30 +19292,22 @@
 fi
 
 
-cat >>confdefs.h <<\_ACEOF
-#define _LARGE_FILE_SOURCE
-_ACEOF
+$as_echo "#define _LARGE_FILE_SOURCE /**/" >>confdefs.h
 
 
-cat >>confdefs.h <<\_ACEOF
-#define _FILE_OFFSET_BITS 64
-_ACEOF
+$as_echo "#define _FILE_OFFSET_BITS 64" >>confdefs.h
 
 
 
 #
 # Checks for header files
 #
-{ echo "$as_me:$LINENO: checking for ANSI C header files" >&5
-echo $ECHO_N "checking for ANSI C header files... $ECHO_C" >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
+$as_echo_n "checking for ANSI C header files... " >&6; }
+if ${ac_cv_header_stdc+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 #include <stdarg.h>
@@ -20901,64 +19322,23 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_header_stdc=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_header_stdc=no
+  ac_cv_header_stdc=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <string.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then
-  :
+  $EGREP "memchr" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -20968,18 +19348,14 @@
 
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then
-  :
+  $EGREP "free" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -20989,14 +19365,10 @@
 
 if test $ac_cv_header_stdc = yes; then
   # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then
+  if test "$cross_compiling" = yes; then :
   :
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ctype.h>
 #include <stdlib.h>
@@ -21023,67 +19395,27 @@
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
-else
-  echo "$as_me: program exited with status $ac_status" >&5
-echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_run "$LINENO"; then :
 
-( exit $ac_status )
-ac_cv_header_stdc=no
+else
+  ac_cv_header_stdc=no
 fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_header_stdc" >&5
-echo "${ECHO_T}$ac_cv_header_stdc" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
+$as_echo "$ac_cv_header_stdc" >&6; }
 if test $ac_cv_header_stdc = yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define STDC_HEADERS 1
-_ACEOF
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
 
 fi
 
 # libupnp code doesn't use autoconf variables yet,
 # so just abort if a header file is not found.
-
-
-
-
-
-
-
-
-
-
-
-
-
-
 for ac_header in  \
 	arpa/inet.h \
 	fcntl.h \
@@ -21100,173 +19432,16 @@
 	syslog.h \
 	unistd.h \
 
-do
-as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { echo "$as_me:$LINENO: checking for $ac_header" >&5
-echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-ac_res=`eval echo '${'$as_ac_Header'}'`
-	       { echo "$as_me:$LINENO: result: $ac_res" >&5
-echo "${ECHO_T}$ac_res" >&6; }
-else
-  # Is the header compilable?
-{ echo "$as_me:$LINENO: checking $ac_header usability" >&5
-echo $ECHO_N "checking $ac_header usability... $ECHO_C" >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_header_compiler=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ echo "$as_me:$LINENO: checking $ac_header presence" >&5
-echo $ECHO_N "checking $ac_header presence... $ECHO_C" >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## --------------------------------------------- ##
-## Report this to mroberto@users.sourceforge.net ##
-## --------------------------------------------- ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ echo "$as_me:$LINENO: checking for $ac_header" >&5
-echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  eval "$as_ac_Header=\$ac_header_preproc"
-fi
-ac_res=`eval echo '${'$as_ac_Header'}'`
-	       { echo "$as_me:$LINENO: result: $ac_res" >&5
-echo "${ECHO_T}$ac_res" >&6; }
-
-fi
-if test `eval echo '${'$as_ac_Header'}'` = yes; then
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
-#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
 
 else
-  { { echo "$as_me:$LINENO: error: required header file missing" >&5
-echo "$as_me: error: required header file missing" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "required header file missing" "$LINENO" 5
 fi
 
 done
@@ -21276,16 +19451,12 @@
 #
 # Checks for typedefs, structures, and compiler characteristics
 #
-{ echo "$as_me:$LINENO: checking for an ANSI C-conforming const" >&5
-echo $ECHO_N "checking for an ANSI C-conforming const... $ECHO_C" >&6; }
-if test "${ac_cv_c_const+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for an ANSI C-conforming const" >&5
+$as_echo_n "checking for an ANSI C-conforming const... " >&6; }
+if ${ac_cv_c_const+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -21295,10 +19466,10 @@
 #ifndef __cplusplus
   /* Ultrix mips cc rejects this.  */
   typedef int charset[2];
-  const charset x;
+  const charset cs;
   /* SunOS 4.1.1 cc rejects this.  */
-  char const *const *ccp;
-  char **p;
+  char const *const *pcpcc;
+  char **ppc;
   /* NEC SVR4.0.2 mips cc rejects this.  */
   struct point {int x, y;};
   static struct point const zero = {0,0};
@@ -21307,11 +19478,11 @@
      an arm of an if-expression whose if-part is not a constant
      expression */
   const char *g = "string";
-  ccp = &g + (g ? g-g : 0);
+  pcpcc = &g + (g ? g-g : 0);
   /* HPUX 7.0 cc rejects these. */
-  ++ccp;
-  p = (char**) ccp;
-  ccp = (char const *const *) p;
+  ++pcpcc;
+  ppc = (char**) pcpcc;
+  pcpcc = (char const *const *) ppc;
   { /* SCO 3.2v4 cc rejects this.  */
     char *t;
     char const *s = 0 ? (char *) 0 : (char const *) 0;
@@ -21338,78 +19509,35 @@
     const int foo = 10;
     if (!foo) return 0;
   }
-  return !x[0] && !zero.x;
+  return !cs[0] && !zero.x;
 #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_c_const=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_c_const=no
+  ac_cv_c_const=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_c_const" >&5
-echo "${ECHO_T}$ac_cv_c_const" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_const" >&5
+$as_echo "$ac_cv_c_const" >&6; }
 if test $ac_cv_c_const = no; then
 
-cat >>confdefs.h <<\_ACEOF
-#define const
-_ACEOF
+$as_echo "#define const /**/" >>confdefs.h
 
 fi
 
-{ echo "$as_me:$LINENO: checking for socklen_t" >&5
-echo $ECHO_N "checking for socklen_t... $ECHO_C" >&6; }
-if test "${ac_cv_type_socklen_t+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for socklen_t" >&5
+$as_echo_n "checking for socklen_t... " >&6; }
+if ${ac_cv_type_socklen_t+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
 
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <sys/types.h>
    #include <sys/socket.h>
@@ -21421,58 +19549,19 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_type_socklen_t=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_type_socklen_t=no
+  ac_cv_type_socklen_t=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_type_socklen_t" >&5
-echo "${ECHO_T}$ac_cv_type_socklen_t" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_type_socklen_t" >&5
+$as_echo "$ac_cv_type_socklen_t" >&6; }
   if test $ac_cv_type_socklen_t != yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define socklen_t int
-_ACEOF
+$as_echo "#define socklen_t int" >>confdefs.h
 
   fi
 
@@ -21481,559 +19570,110 @@
 #
 # Checks for library functions
 #
-
 for ac_func in vprintf
-do
-as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-{ echo "$as_me:$LINENO: checking for $ac_func" >&5
-echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6; }
-if { as_var=$as_ac_var; eval "test \"\${$as_var+set}\" = set"; }; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $ac_func innocuous_$ac_func
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef $ac_func
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $ac_func ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$ac_func || defined __stub___$ac_func
-choke me
-#endif
-
-int
-main ()
-{
-return $ac_func ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  eval "$as_ac_var=yes"
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_var=no"
-fi
-
-rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-ac_res=`eval echo '${'$as_ac_var'}'`
-	       { echo "$as_me:$LINENO: result: $ac_res" >&5
-echo "${ECHO_T}$ac_res" >&6; }
-if test `eval echo '${'$as_ac_var'}'` = yes; then
+do :
+  ac_fn_c_check_func "$LINENO" "vprintf" "ac_cv_func_vprintf"
+if test "x$ac_cv_func_vprintf" = xyes; then :
   cat >>confdefs.h <<_ACEOF
-#define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
+#define HAVE_VPRINTF 1
 _ACEOF
 
-{ echo "$as_me:$LINENO: checking for _doprnt" >&5
-echo $ECHO_N "checking for _doprnt... $ECHO_C" >&6; }
-if test "${ac_cv_func__doprnt+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define _doprnt to an innocuous variant, in case <limits.h> declares _doprnt.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define _doprnt innocuous__doprnt
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char _doprnt (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef _doprnt
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char _doprnt ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub__doprnt || defined __stub____doprnt
-choke me
-#endif
-
-int
-main ()
-{
-return _doprnt ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_func__doprnt=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+ac_fn_c_check_func "$LINENO" "_doprnt" "ac_cv_func__doprnt"
+if test "x$ac_cv_func__doprnt" = xyes; then :
 
-	ac_cv_func__doprnt=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_func__doprnt" >&5
-echo "${ECHO_T}$ac_cv_func__doprnt" >&6; }
-if test $ac_cv_func__doprnt = yes; then
-
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_DOPRNT 1
-_ACEOF
+$as_echo "#define HAVE_DOPRNT 1" >>confdefs.h
 
 fi
 
 fi
-done
-
-
-{ echo "$as_me:$LINENO: checking for _LARGEFILE_SOURCE value needed for large files" >&5
-echo $ECHO_N "checking for _LARGEFILE_SOURCE value needed for large files... $ECHO_C" >&6; }
-if test "${ac_cv_sys_largefile_source+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  while :; do
-  ac_cv_sys_largefile_source=no
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdio.h>
-int
-main ()
-{
-return !fseeko;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  break
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#define _LARGEFILE_SOURCE 1
-#include <stdio.h>
-int
-main ()
-{
-return !fseeko;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_sys_largefile_source=1; break
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  break
-done
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_sys_largefile_source" >&5
-echo "${ECHO_T}$ac_cv_sys_largefile_source" >&6; }
-if test "$ac_cv_sys_largefile_source" != no; then
-
-cat >>confdefs.h <<_ACEOF
-#define _LARGEFILE_SOURCE $ac_cv_sys_largefile_source
-_ACEOF
-
-fi
-rm -f conftest*
-
-# We used to try defining _XOPEN_SOURCE=500 too, to work around a bug
-# in glibc 2.1.3, but that breaks too many other things.
-# If you want fseeko and ftello with glibc, upgrade to a fixed glibc.
-{ echo "$as_me:$LINENO: checking for fseeko" >&5
-echo $ECHO_N "checking for fseeko... $ECHO_C" >&6; }
-if test "${ac_cv_func_fseeko+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdio.h>
-int
-main ()
-{
-return fseeko && fseeko (stdin, 0, 0);
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_func_fseeko=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_func_fseeko=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-{ echo "$as_me:$LINENO: result: $ac_cv_func_fseeko" >&5
-echo "${ECHO_T}$ac_cv_func_fseeko" >&6; }
-if test $ac_cv_func_fseeko = yes; then
-
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_FSEEKO 1
-_ACEOF
-
-fi
-
-
-for ac_func in ftime
-do
-as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-{ echo "$as_me:$LINENO: checking for $ac_func" >&5
-echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6; }
-if { as_var=$as_ac_var; eval "test \"\${$as_var+set}\" = set"; }; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $ac_func innocuous_$ac_func
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef $ac_func
+done
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $ac_func ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$ac_func || defined __stub___$ac_func
-choke me
-#endif
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for _LARGEFILE_SOURCE value needed for large files" >&5
+$as_echo_n "checking for _LARGEFILE_SOURCE value needed for large files... " >&6; }
+if ${ac_cv_sys_largefile_source+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  while :; do
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h> /* for off_t */
+     #include <stdio.h>
 int
 main ()
 {
-return $ac_func ();
+int (*fp) (FILE *, off_t, int) = fseeko;
+     return fseeko (stdin, 0, 0) && fp (stdin, 0, 0);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_sys_largefile_source=no; break
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#define _LARGEFILE_SOURCE 1
+#include <sys/types.h> /* for off_t */
+     #include <stdio.h>
+int
+main ()
+{
+int (*fp) (FILE *, off_t, int) = fseeko;
+     return fseeko (stdin, 0, 0) && fp (stdin, 0, 0);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_sys_largefile_source=1; break
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  ac_cv_sys_largefile_source=unknown
+  break
+done
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sys_largefile_source" >&5
+$as_echo "$ac_cv_sys_largefile_source" >&6; }
+case $ac_cv_sys_largefile_source in #(
+  no | unknown) ;;
+  *)
+cat >>confdefs.h <<_ACEOF
+#define _LARGEFILE_SOURCE $ac_cv_sys_largefile_source
+_ACEOF
+;;
 esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  eval "$as_ac_var=yes"
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+rm -rf conftest*
 
-	eval "$as_ac_var=no"
-fi
+# We used to try defining _XOPEN_SOURCE=500 too, to work around a bug
+# in glibc 2.1.3, but that breaks too many other things.
+# If you want fseeko and ftello with glibc, upgrade to a fixed glibc.
+if test $ac_cv_sys_largefile_source != unknown; then
+
+$as_echo "#define HAVE_FSEEKO 1" >>confdefs.h
 
-rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
 fi
-ac_res=`eval echo '${'$as_ac_var'}'`
-	       { echo "$as_me:$LINENO: result: $ac_res" >&5
-echo "${ECHO_T}$ac_res" >&6; }
-if test `eval echo '${'$as_ac_var'}'` = yes; then
+
+for ac_func in ftime
+do :
+  ac_fn_c_check_func "$LINENO" "ftime" "ac_cv_func_ftime"
+if test "x$ac_cv_func_ftime" = xyes; then :
   cat >>confdefs.h <<_ACEOF
-#define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
+#define HAVE_FTIME 1
 _ACEOF
 
 else
-
-{ echo "$as_me:$LINENO: checking for ftime in -lcompat" >&5
-echo $ECHO_N "checking for ftime in -lcompat... $ECHO_C" >&6; }
-if test "${ac_cv_lib_compat_ftime+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ftime in -lcompat" >&5
+$as_echo_n "checking for ftime in -lcompat... " >&6; }
+if ${ac_cv_lib_compat_ftime+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lcompat  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -22051,55 +19691,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_compat_ftime=yes
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_compat_ftime=no
+  ac_cv_lib_compat_ftime=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ echo "$as_me:$LINENO: result: $ac_cv_lib_compat_ftime" >&5
-echo "${ECHO_T}$ac_cv_lib_compat_ftime" >&6; }
-if test $ac_cv_lib_compat_ftime = yes; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_compat_ftime" >&5
+$as_echo "$ac_cv_lib_compat_ftime" >&6; }
+if test "x$ac_cv_lib_compat_ftime" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_LIBCOMPAT 1
 _ACEOF
@@ -22140,13 +19743,9 @@
         CFLAGS="$CFLAGS $PTHREAD_CFLAGS"
         save_LIBS="$LIBS"
         LIBS="$PTHREAD_LIBS $LIBS"
-        { echo "$as_me:$LINENO: checking for pthread_join in LIBS=$PTHREAD_LIBS with CFLAGS=$PTHREAD_CFLAGS" >&5
-echo $ECHO_N "checking for pthread_join in LIBS=$PTHREAD_LIBS with CFLAGS=$PTHREAD_CFLAGS... $ECHO_C" >&6; }
-        cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthread_join in LIBS=$PTHREAD_LIBS with CFLAGS=$PTHREAD_CFLAGS" >&5
+$as_echo_n "checking for pthread_join in LIBS=$PTHREAD_LIBS with CFLAGS=$PTHREAD_CFLAGS... " >&6; }
+        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -22164,52 +19763,13 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
   acx_pthread_ok=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
-        { echo "$as_me:$LINENO: result: $acx_pthread_ok" >&5
-echo "${ECHO_T}$acx_pthread_ok" >&6; }
+    conftest$ac_exeext conftest.$ac_ext
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: $acx_pthread_ok" >&5
+$as_echo "$acx_pthread_ok" >&6; }
         if test x"$acx_pthread_ok" = xno; then
                 PTHREAD_LIBS=""
                 PTHREAD_CFLAGS=""
@@ -22270,23 +19830,23 @@
 
         case $flag in
                 none)
-                { echo "$as_me:$LINENO: checking whether pthreads work without any flags" >&5
-echo $ECHO_N "checking whether pthreads work without any flags... $ECHO_C" >&6; }
+                { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether pthreads work without any flags" >&5
+$as_echo_n "checking whether pthreads work without any flags... " >&6; }
                 ;;
 
                 -*)
-                { echo "$as_me:$LINENO: checking whether pthreads work with $flag" >&5
-echo $ECHO_N "checking whether pthreads work with $flag... $ECHO_C" >&6; }
+                { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether pthreads work with $flag" >&5
+$as_echo_n "checking whether pthreads work with $flag... " >&6; }
                 PTHREAD_CFLAGS="$flag"
                 ;;
 
 		pthread-config)
 		# Extract the first word of "pthread-config", so it can be a program name with args.
 set dummy pthread-config; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_acx_pthread_config+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_acx_pthread_config+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$acx_pthread_config"; then
   ac_cv_prog_acx_pthread_config="$acx_pthread_config" # Let the user override the test.
@@ -22296,14 +19856,14 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_acx_pthread_config="yes"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
   test -z "$ac_cv_prog_acx_pthread_config" && ac_cv_prog_acx_pthread_config="no"
@@ -22311,11 +19871,11 @@
 fi
 acx_pthread_config=$ac_cv_prog_acx_pthread_config
 if test -n "$acx_pthread_config"; then
-  { echo "$as_me:$LINENO: result: $acx_pthread_config" >&5
-echo "${ECHO_T}$acx_pthread_config" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $acx_pthread_config" >&5
+$as_echo "$acx_pthread_config" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -22325,8 +19885,8 @@
 		;;
 
                 *)
-                { echo "$as_me:$LINENO: checking for the pthreads library -l$flag" >&5
-echo $ECHO_N "checking for the pthreads library -l$flag... $ECHO_C" >&6; }
+                { $as_echo "$as_me:${as_lineno-$LINENO}: checking for the pthreads library -l$flag" >&5
+$as_echo_n "checking for the pthreads library -l$flag... " >&6; }
                 PTHREAD_LIBS="-l$flag"
                 ;;
         esac
@@ -22345,11 +19905,7 @@
         # pthread_cleanup_push because it is one of the few pthread
         # functions on Solaris that doesn't have a non-functional libc stub.
         # We try pthread_create on general principles.
-        cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <pthread.h>
 int
@@ -22362,56 +19918,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
   acx_pthread_ok=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 
         LIBS="$save_LIBS"
         CFLAGS="$save_CFLAGS"
 
-        { echo "$as_me:$LINENO: result: $acx_pthread_ok" >&5
-echo "${ECHO_T}$acx_pthread_ok" >&6; }
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: $acx_pthread_ok" >&5
+$as_echo "$acx_pthread_ok" >&6; }
         if test "x$acx_pthread_ok" = xyes; then
                 break;
         fi
@@ -22429,15 +19946,11 @@
         CFLAGS="$CFLAGS $PTHREAD_CFLAGS"
 
         # Detect AIX lossage: JOINABLE attribute is called UNDETACHED.
-	{ echo "$as_me:$LINENO: checking for joinable pthread attribute" >&5
-echo $ECHO_N "checking for joinable pthread attribute... $ECHO_C" >&6; }
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for joinable pthread attribute" >&5
+$as_echo_n "checking for joinable pthread attribute... " >&6; }
 	attr_name=unknown
 	for attr in PTHREAD_CREATE_JOINABLE PTHREAD_CREATE_UNDETACHED; do
-	    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <pthread.h>
 int
@@ -22448,53 +19961,14 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_link "$LINENO"; then :
   attr_name=$attr; break
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
+    conftest$ac_exeext conftest.$ac_ext
 	done
-        { echo "$as_me:$LINENO: result: $attr_name" >&5
-echo "${ECHO_T}$attr_name" >&6; }
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: $attr_name" >&5
+$as_echo "$attr_name" >&6; }
         if test "$attr_name" != PTHREAD_CREATE_JOINABLE; then
 
 cat >>confdefs.h <<_ACEOF
@@ -22503,15 +19977,15 @@
 
         fi
 
-        { echo "$as_me:$LINENO: checking if more special flags are required for pthreads" >&5
-echo $ECHO_N "checking if more special flags are required for pthreads... $ECHO_C" >&6; }
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking if more special flags are required for pthreads" >&5
+$as_echo_n "checking if more special flags are required for pthreads... " >&6; }
         flag=no
         case "${host_cpu}-${host_os}" in
             *-aix* | *-freebsd* | *-darwin*) flag="-D_THREAD_SAFE";;
             *solaris* | *-osf* | *-hpux*) flag="-D_REENTRANT";;
         esac
-        { echo "$as_me:$LINENO: result: ${flag}" >&5
-echo "${ECHO_T}${flag}" >&6; }
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: ${flag}" >&5
+$as_echo "${flag}" >&6; }
         if test "x$flag" != xno; then
             PTHREAD_CFLAGS="$flag $PTHREAD_CFLAGS"
         fi
@@ -22525,10 +19999,10 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6; }
-if test "${ac_cv_prog_PTHREAD_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_PTHREAD_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
   if test -n "$PTHREAD_CC"; then
   ac_cv_prog_PTHREAD_CC="$PTHREAD_CC" # Let the user override the test.
@@ -22538,25 +20012,25 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_PTHREAD_CC="$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 PTHREAD_CC=$ac_cv_prog_PTHREAD_CC
 if test -n "$PTHREAD_CC"; then
-  { echo "$as_me:$LINENO: result: $PTHREAD_CC" >&5
-echo "${ECHO_T}$PTHREAD_CC" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PTHREAD_CC" >&5
+$as_echo "$PTHREAD_CC" >&6; }
 else
-  { echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
 
@@ -22578,16 +20052,12 @@
 # Finally, execute ACTION-IF-FOUND/ACTION-IF-NOT-FOUND:
 if test x"$acx_pthread_ok" = xyes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_PTHREAD 1
-_ACEOF
+$as_echo "#define HAVE_PTHREAD 1" >>confdefs.h
 
         :
 else
         acx_pthread_ok=no
-        { { echo "$as_me:$LINENO: error: POSIX threads are required to build this program" >&5
-echo "$as_me: error: POSIX threads are required to build this program" >&2;}
-   { (exit 1); exit 1; }; }
+        as_fn_error $? "POSIX threads are required to build this program" "$LINENO" 5
 fi
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -22606,19 +20076,15 @@
 # Determine if pthread_rwlock_t is available
 #
 echo "----------------------- pthread_rwlock_t stuff --------------------------------"
-{ echo "$as_me:$LINENO: checking if pthread_rwlock_t is available" >&5
-echo $ECHO_N "checking if pthread_rwlock_t is available... $ECHO_C" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if pthread_rwlock_t is available" >&5
+$as_echo_n "checking if pthread_rwlock_t is available... " >&6; }
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <pthread.h>
 int
@@ -22629,56 +20095,14 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
 
-cat >>confdefs.h <<\_ACEOF
-#define UPNP_USE_RWLOCK 1
-_ACEOF
+$as_echo "#define UPNP_USE_RWLOCK 1" >>confdefs.h
 
-		{ echo "$as_me:$LINENO: result: yes, supported without any options" >&5
-echo "${ECHO_T}yes, supported without any options" >&6; }
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes, supported without any options" >&5
+$as_echo "yes, supported without any options" >&6; }
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #define _GNU_SOURCE
 			#include <pthread.h>
@@ -22690,67 +20114,23 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_compile "$LINENO"; then :
 
-cat >>confdefs.h <<\_ACEOF
-#define UPNP_USE_RWLOCK 1
-_ACEOF
+$as_echo "#define UPNP_USE_RWLOCK 1" >>confdefs.h
 
 			CPPFLAGS="$CPPFLAGS -D_GNU_SOURCE"
-			{ echo "$as_me:$LINENO: result: yes, definition of _GNU_SOURCE required" >&5
-echo "${ECHO_T}yes, definition of _GNU_SOURCE required" >&6; }
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes, definition of _GNU_SOURCE required" >&5
+$as_echo "yes, definition of _GNU_SOURCE required" >&6; }
 else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
 
-cat >>confdefs.h <<\_ACEOF
-#define UPNP_USE_RWLOCK 0
-_ACEOF
+$as_echo "#define UPNP_USE_RWLOCK 0" >>confdefs.h
 
-			{ echo "$as_me:$LINENO: result: no, needs to fallback to pthread_mutex" >&5
-echo "${ECHO_T}no, needs to fallback to pthread_mutex" >&6; }
-			{ { echo "$as_me:$LINENO: error: pthread_rwlock_t not available" >&5
-echo "$as_me: error: pthread_rwlock_t not available" >&2;}
-   { (exit 1); exit 1; }; }
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no, needs to fallback to pthread_mutex" >&5
+$as_echo "no, needs to fallback to pthread_mutex" >&6; }
+			as_fn_error $? "pthread_rwlock_t not available" "$LINENO" 5
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 echo "-------------------------------------------------------------------------------"
 
@@ -22786,12 +20166,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { echo "$as_me:$LINENO: WARNING: Cache variable $ac_var contains a newline." >&5
-echo "$as_me: WARNING: Cache variable $ac_var contains a newline." >&2;} ;;
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
-      *) $as_unset $ac_var ;;
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -22799,8 +20180,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -22822,13 +20203,24 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { echo "$as_me:$LINENO: updating cache $cache_file" >&5
-echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-echo "$as_me: not updating unwritable cache $cache_file" >&6;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
 rm -f confcache
@@ -22841,14 +20233,15 @@
 
 ac_libobjs=
 ac_ltlibobjs=
+U=
 for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
   # 1. Remove the extension, and $U if already installed.
   ac_script='s/\$U\././;s/\.o$//;s/\.obj$//'
-  ac_i=`echo "$ac_i" | sed "$ac_script"`
+  ac_i=`$as_echo "$ac_i" | sed "$ac_script"`
   # 2. Prepend LIBOBJDIR.  When used with automake>=1.10 LIBOBJDIR
   #    will be set to the directory where LIBOBJS objects are built.
-  ac_libobjs="$ac_libobjs \${LIBOBJDIR}$ac_i\$U.$ac_objext"
-  ac_ltlibobjs="$ac_ltlibobjs \${LIBOBJDIR}$ac_i"'$U.lo'
+  as_fn_append ac_libobjs " \${LIBOBJDIR}$ac_i\$U.$ac_objext"
+  as_fn_append ac_ltlibobjs " \${LIBOBJDIR}$ac_i"'$U.lo'
 done
 LIBOBJS=$ac_libobjs
 
@@ -22856,89 +20249,58 @@
 
 
 if test -z "${ENABLE_DEBUG_TRUE}" && test -z "${ENABLE_DEBUG_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"ENABLE_DEBUG\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"ENABLE_DEBUG\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"ENABLE_DEBUG\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${ENABLE_CLIENT_TRUE}" && test -z "${ENABLE_CLIENT_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"ENABLE_CLIENT\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"ENABLE_CLIENT\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"ENABLE_CLIENT\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${ENABLE_DEVICE_TRUE}" && test -z "${ENABLE_DEVICE_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"ENABLE_DEVICE\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"ENABLE_DEVICE\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"ENABLE_DEVICE\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${ENABLE_WEBSERVER_TRUE}" && test -z "${ENABLE_WEBSERVER_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"ENABLE_WEBSERVER\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"ENABLE_WEBSERVER\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"ENABLE_WEBSERVER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${ENABLE_WEBSERVER_TRUE}" && test -z "${ENABLE_WEBSERVER_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"ENABLE_WEBSERVER\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"ENABLE_WEBSERVER\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"ENABLE_WEBSERVER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${ENABLE_TOOLS_TRUE}" && test -z "${ENABLE_TOOLS_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"ENABLE_TOOLS\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"ENABLE_TOOLS\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"ENABLE_TOOLS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${ENABLE_SAMPLES_TRUE}" && test -z "${ENABLE_SAMPLES_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"ENABLE_SAMPLES\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"ENABLE_SAMPLES\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"ENABLE_SAMPLES\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${WITH_DOCUMENTATION_TRUE}" && test -z "${WITH_DOCUMENTATION_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"WITH_DOCUMENTATION\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"WITH_DOCUMENTATION\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"WITH_DOCUMENTATION\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${AMDEP_TRUE}" && test -z "${AMDEP_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"AMDEP\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"AMDEP\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"AMDEP\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${am__fastdepCC_TRUE}" && test -z "${am__fastdepCC_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"am__fastdepCC\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"am__fastdepCC\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"am__fastdepCC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${am__fastdepCXX_TRUE}" && test -z "${am__fastdepCXX_FALSE}"; then
-  { { echo "$as_me:$LINENO: error: conditional \"am__fastdepCXX\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-echo "$as_me: error: conditional \"am__fastdepCXX\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"am__fastdepCXX\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 
-: ${CONFIG_STATUS=./config.status}
+: "${CONFIG_STATUS=./config.status}"
+ac_write_fail=0
 ac_clean_files_save=$ac_clean_files
 ac_clean_files="$ac_clean_files $CONFIG_STATUS"
-{ echo "$as_me:$LINENO: creating $CONFIG_STATUS" >&5
-echo "$as_me: creating $CONFIG_STATUS" >&6;}
-cat >$CONFIG_STATUS <<_ACEOF
+{ $as_echo "$as_me:${as_lineno-$LINENO}: creating $CONFIG_STATUS" >&5
+$as_echo "$as_me: creating $CONFIG_STATUS" >&6;}
+as_write_fail=0
+cat >$CONFIG_STATUS <<_ASEOF || as_write_fail=1
 #! $SHELL
 # Generated by $as_me.
 # Run this file to recreate the current configuration.
@@ -22948,55 +20310,79 @@
 debug=false
 ac_cs_recheck=false
 ac_cs_silent=false
-SHELL=\${CONFIG_SHELL-$SHELL}
-_ACEOF
 
-cat >>$CONFIG_STATUS <<\_ACEOF
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
+SHELL=\${CONFIG_SHELL-$SHELL}
+export SHELL
+_ASEOF
+cat >>$CONFIG_STATUS <<\_ASEOF || as_write_fail=1
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
 
-# Be Bourne compatible
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+# Be more Bourne compatible
+DUALCASE=1; export DUALCASE # for MKS sh
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
-  # Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
+  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
   # is contrary to our usage.  Disable this feature.
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in *posix*) set -o posix;; esac
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
+esac
 fi
-BIN_SH=xpg4; export BIN_SH # for Tru64
-DUALCASE=1; export DUALCASE # for MKS sh
 
 
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
-# The user is always right.
-if test "${PATH_SEPARATOR+set}" != set; then
-  echo "#! /bin/sh" >conf$$.sh
-  echo  "exit 0"   >>conf$$.sh
-  chmod +x conf$$.sh
-  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
-    PATH_SEPARATOR=';'
-  else
-    PATH_SEPARATOR=:
+as_nl='
+'
+export as_nl
+# Printing a long string crashes Solaris 7 /usr/bin/printf.
+as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
+as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='printf %s\n'
+  as_echo_n='printf %s'
+else
+  if test "X`(/usr/ucb/echo -n -n $as_echo) 2>/dev/null`" = "X-n $as_echo"; then
+    as_echo_body='eval /usr/ucb/echo -n "$1$as_nl"'
+    as_echo_n='/usr/ucb/echo -n'
+  else
+    as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
+    as_echo_n_body='eval
+      arg=$1;
+      case $arg in #(
+      *"$as_nl"*)
+	expr "X$arg" : "X\\(.*\\)$as_nl";
+	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
+      esac;
+      expr "X$arg" : "X\\(.*\\)" | tr -d "$as_nl"
+    '
+    export as_echo_n_body
+    as_echo_n='sh -c $as_echo_n_body as_echo'
   fi
-  rm -f conf$$.sh
+  export as_echo_body
+  as_echo='sh -c $as_echo_body as_echo'
 fi
 
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  as_unset=unset
-else
-  as_unset=false
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  PATH_SEPARATOR=:
+  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
+    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
+      PATH_SEPARATOR=';'
+  }
 fi
 
 
@@ -23005,20 +20391,19 @@
 # there to prevent editors from complaining about space-tab.
 # (If _AS_PATH_WALK were called with IFS unset, it would disable word
 # splitting by setting IFS to empty value.)
-as_nl='
-'
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
+as_myself=
+case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-done
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
 IFS=$as_save_IFS
 
      ;;
@@ -23029,32 +20414,111 @@
   as_myself=$0
 fi
 if test ! -f "$as_myself"; then
-  echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  { (exit 1); exit 1; }
+  $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
+  exit 1
 fi
 
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
 done
 PS1='$ '
 PS2='> '
 PS4='+ '
 
 # NLS nuisances.
-for as_var in \
-  LANG LANGUAGE LC_ADDRESS LC_ALL LC_COLLATE LC_CTYPE LC_IDENTIFICATION \
-  LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER \
-  LC_TELEPHONE LC_TIME
-do
-  if (set +x; test -z "`(eval $as_var=C; export $as_var) 2>&1`"); then
-    eval $as_var=C; export $as_var
-  else
-    ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
-  fi
-done
+LC_ALL=C
+export LC_ALL
+LANGUAGE=C
+export LANGUAGE
+
+# CDPATH.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with STATUS, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
+  fi
+  $as_echo "$as_me: error: $2" >&2
+  as_fn_exit $as_status
+} # as_fn_error
+
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
+else
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
+
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
+else
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
+
 
-# Required to use basename.
 if expr a : '\(a\)' >/dev/null 2>&1 &&
    test "X`expr 00001 : '.*\(...\)'`" = X001; then
   as_expr=expr
@@ -23068,13 +20532,17 @@
   as_basename=false
 fi
 
-
-# Name of the executable.
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
+else
+  as_dirname=false
+fi
+
 as_me=`$as_basename -- "$0" ||
 $as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
 	 X"$0" : 'X\(//\)$' \| \
 	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
-echo X/"$0" |
+$as_echo X/"$0" |
     sed '/^.*\/\([^/][^/]*\)\/*$/{
 	    s//\1/
 	    q
@@ -23089,122 +20557,130 @@
 	  }
 	  s/.*/./; q'`
 
-# CDPATH.
-$as_unset CDPATH
-
-
-
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2" || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
-  sed -n '
-    p
-    /[$]LINENO/=
-  ' <$as_myself |
-    sed '
-      s/[$]LINENO.*/&-/
-      t lineno
-      b
-      :lineno
-      N
-      :loop
-      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
-      t loop
-      s/-\n.*//
-    ' >$as_me.lineno &&
-  chmod +x "$as_me.lineno" ||
-    { echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
-   { (exit 1); exit 1; }; }
-
-  # Don't try to exec as it changes $[0], causing all sort of problems
-  # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensitive to this).
-  . "./$as_me.lineno"
-  # Exit status is that of the last command.
-  exit
-}
-
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
 
 ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
+case `echo -n x` in #(((((
 -n*)
-  case `echo 'x\c'` in
+  case `echo 'xy\c'` in
   *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
   esac;;
 *)
   ECHO_N='-n';;
 esac
 
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
 rm -f conf$$ conf$$.exe conf$$.file
 if test -d conf$$.dir; then
   rm -f conf$$.dir/conf$$.file
 else
   rm -f conf$$.dir
-  mkdir conf$$.dir
+  mkdir conf$$.dir 2>/dev/null
 fi
-echo >conf$$.file
-if ln -s conf$$.file conf$$ 2>/dev/null; then
-  as_ln_s='ln -s'
-  # ... but there are two gotchas:
-  # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
-  # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-  # In both cases, we have to default to `cp -p'.
-  ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
+if (echo >conf$$.file) 2>/dev/null; then
+  if ln -s conf$$.file conf$$ 2>/dev/null; then
+    as_ln_s='ln -s'
+    # ... but there are two gotchas:
+    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
+    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
+    # In both cases, we have to default to `cp -p'.
+    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
+      as_ln_s='cp -p'
+  elif ln conf$$.file conf$$ 2>/dev/null; then
+    as_ln_s=ln
+  else
     as_ln_s='cp -p'
-elif ln conf$$.file conf$$ 2>/dev/null; then
-  as_ln_s=ln
+  fi
 else
   as_ln_s='cp -p'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
 
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
+
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
+
+
+} # as_fn_mkdir_p
 if mkdir -p . 2>/dev/null; then
-  as_mkdir_p=:
+  as_mkdir_p='mkdir -p "$as_dir"'
 else
   test -d ./-p && rmdir ./-p
   as_mkdir_p=false
 fi
 
-# Find out whether ``test -x'' works.  Don't use a zero-byte file, as
-# systems may use methods other than mode bits to determine executability.
-cat >conf$$.file <<_ASEOF
-#! /bin/sh
-exit 0
-_ASEOF
-chmod +x conf$$.file
-if test -x conf$$.file >/dev/null 2>&1; then
-  as_executable_p="test -x"
+if test -x / >/dev/null 2>&1; then
+  as_test_x='test -x'
 else
-  as_executable_p=:
+  if ls -dL / >/dev/null 2>&1; then
+    as_ls_L_option=L
+  else
+    as_ls_L_option=
+  fi
+  as_test_x='
+    eval sh -c '\''
+      if test -d "$1"; then
+	test -d "$1/.";
+      else
+	case $1 in #(
+	-*)set "./$1";;
+	esac;
+	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
+	???[sx]*):;;*)false;;esac;fi
+    '\'' sh
+  '
 fi
-rm -f conf$$.file
+as_executable_p=$as_test_x
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -23214,13 +20690,19 @@
 
 
 exec 6>&1
+## ----------------------------------- ##
+## Main body of $CONFIG_STATUS script. ##
+## ----------------------------------- ##
+_ASEOF
+test $as_write_fail = 0 && chmod +x $CONFIG_STATUS || ac_write_fail=1
 
-# Save the log message, to keep $[0] and so on meaningful, and to
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+# Save the log message, to keep $0 and so on meaningful, and to
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
 This file was extended by libupnp $as_me 1.6.6, which was
-generated by GNU Autoconf 2.60.  Invocation command line was
+generated by GNU Autoconf 2.68.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -23233,7 +20715,16 @@
 
 _ACEOF
 
-cat >>$CONFIG_STATUS <<_ACEOF
+case $ac_config_files in *"
+"*) set x $ac_config_files; shift; ac_config_files=$*;;
+esac
+
+case $ac_config_headers in *"
+"*) set x $ac_config_headers; shift; ac_config_headers=$*;;
+esac
+
+
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 # Files that config.status was made for.
 config_files="$ac_config_files"
 config_headers="$ac_config_headers"
@@ -23241,22 +20732,25 @@
 
 _ACEOF
 
-cat >>$CONFIG_STATUS <<\_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 ac_cs_usage="\
-\`$as_me' instantiates files from templates according to the
-current configuration.
+\`$as_me' instantiates files and other configuration actions
+from templates according to the current configuration.  Unless the files
+and actions are specified as TAGs, all are instantiated by default.
 
-Usage: $0 [OPTIONS] [FILE]...
+Usage: $0 [OPTION]... [TAG]...
 
   -h, --help       print this help, then exit
-  -V, --version    print version number, then exit
-  -q, --quiet      do not print progress messages
+  -V, --version    print version number and configuration settings, then exit
+      --config     print configuration, then exit
+  -q, --quiet, --silent
+                   do not print progress messages
   -d, --debug      don't remove temporary files
       --recheck    update $as_me by reconfiguring in the same conditions
-  --file=FILE[:TEMPLATE]
-		   instantiate the configuration file FILE
-  --header=FILE[:TEMPLATE]
-		   instantiate the configuration header FILE
+      --file=FILE[:TEMPLATE]
+                   instantiate the configuration file FILE
+      --header=FILE[:TEMPLATE]
+                   instantiate the configuration header FILE
 
 Configuration files:
 $config_files
@@ -23267,36 +20761,43 @@
 Configuration commands:
 $config_commands
 
-Report bugs to <bug-autoconf@gnu.org>."
+Report bugs to <mroberto@users.sourceforge.net>."
 
 _ACEOF
-cat >>$CONFIG_STATUS <<_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
 libupnp config.status 1.6.6
-configured by $0, generated by GNU Autoconf 2.60,
-  with options \\"`echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
+configured by $0, generated by GNU Autoconf 2.68,
+  with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2006 Free Software Foundation, Inc.
+Copyright (C) 2010 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
 ac_pwd='$ac_pwd'
 srcdir='$srcdir'
 INSTALL='$INSTALL'
+AWK='$AWK'
+test -n "\$AWK" || AWK=awk
 _ACEOF
 
-cat >>$CONFIG_STATUS <<\_ACEOF
-# If no file are specified by the user, then we need to provide default
-# value.  By we need to know if files were specified by the user.
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+# The default lists apply if the user does not specify any file.
 ac_need_defaults=:
 while test $# != 0
 do
   case $1 in
-  --*=*)
+  --*=?*)
     ac_option=`expr "X$1" : 'X\([^=]*\)='`
     ac_optarg=`expr "X$1" : 'X[^=]*=\(.*\)'`
     ac_shift=:
     ;;
+  --*=)
+    ac_option=`expr "X$1" : 'X\([^=]*\)='`
+    ac_optarg=
+    ac_shift=:
+    ;;
   *)
     ac_option=$1
     ac_optarg=$2
@@ -23309,34 +20810,41 @@
   -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
     ac_cs_recheck=: ;;
   --version | --versio | --versi | --vers | --ver | --ve | --v | -V )
-    echo "$ac_cs_version"; exit ;;
+    $as_echo "$ac_cs_version"; exit ;;
+  --config | --confi | --conf | --con | --co | --c )
+    $as_echo "$ac_cs_config"; exit ;;
   --debug | --debu | --deb | --de | --d | -d )
     debug=: ;;
   --file | --fil | --fi | --f )
     $ac_shift
-    CONFIG_FILES="$CONFIG_FILES $ac_optarg"
+    case $ac_optarg in
+    *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    '') as_fn_error $? "missing file argument" ;;
+    esac
+    as_fn_append CONFIG_FILES " '$ac_optarg'"
     ac_need_defaults=false;;
   --header | --heade | --head | --hea )
     $ac_shift
-    CONFIG_HEADERS="$CONFIG_HEADERS $ac_optarg"
+    case $ac_optarg in
+    *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    esac
+    as_fn_append CONFIG_HEADERS " '$ac_optarg'"
     ac_need_defaults=false;;
   --he | --h)
     # Conflict between --help and --header
-    { echo "$as_me: error: ambiguous option: $1
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; };;
+    as_fn_error $? "ambiguous option: \`$1'
+Try \`$0 --help' for more information.";;
   --help | --hel | -h )
-    echo "$ac_cs_usage"; exit ;;
+    $as_echo "$ac_cs_usage"; exit ;;
   -q | -quiet | --quiet | --quie | --qui | --qu | --q \
   | -silent | --silent | --silen | --sile | --sil | --si | --s)
     ac_cs_silent=: ;;
 
   # This is an error.
-  -*) { echo "$as_me: error: unrecognized option: $1
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; } ;;
+  -*) as_fn_error $? "unrecognized option: \`$1'
+Try \`$0 --help' for more information." ;;
 
-  *) ac_config_targets="$ac_config_targets $1"
+  *) as_fn_append ac_config_targets " $1"
      ac_need_defaults=false ;;
 
   esac
@@ -23351,27 +20859,29 @@
 fi
 
 _ACEOF
-cat >>$CONFIG_STATUS <<_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 if \$ac_cs_recheck; then
-  echo "running CONFIG_SHELL=$SHELL $SHELL $0 "$ac_configure_args \$ac_configure_extra_args " --no-create --no-recursion" >&6
-  CONFIG_SHELL=$SHELL
+  set X '$SHELL' '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  shift
+  \$as_echo "running CONFIG_SHELL=$SHELL \$*" >&6
+  CONFIG_SHELL='$SHELL'
   export CONFIG_SHELL
-  exec $SHELL "$0"$ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  exec "\$@"
 fi
 
 _ACEOF
-cat >>$CONFIG_STATUS <<\_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 exec 5>>config.log
 {
   echo
   sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
 ## Running $as_me. ##
 _ASBOX
-  echo "$ac_log"
+  $as_echo "$ac_log"
 } >&5
 
 _ACEOF
-cat >>$CONFIG_STATUS <<_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 #
 # INIT-COMMANDS
 #
@@ -23379,7 +20889,7 @@
 
 _ACEOF
 
-cat >>$CONFIG_STATUS <<\_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 
 # Handling of arguments.
 for ac_config_target in $ac_config_targets
@@ -23398,9 +20908,7 @@
     "docs/dist/Makefile") CONFIG_FILES="$CONFIG_FILES docs/dist/Makefile" ;;
     "libupnp.pc") CONFIG_FILES="$CONFIG_FILES libupnp.pc" ;;
 
-  *) { { echo "$as_me:$LINENO: error: invalid argument: $ac_config_target" >&5
-echo "$as_me: error: invalid argument: $ac_config_target" >&2;}
-   { (exit 1); exit 1; }; };;
+  *) as_fn_error $? "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
   esac
 done
 
@@ -23423,275 +20931,302 @@
 # after its creation but before its name has been assigned to `$tmp'.
 $debug ||
 {
-  tmp=
+  tmp= ac_tmp=
   trap 'exit_status=$?
-  { test -z "$tmp" || test ! -d "$tmp" || rm -fr "$tmp"; } && exit $exit_status
+  : "${ac_tmp:=$tmp}"
+  { test ! -d "$ac_tmp" || rm -fr "$ac_tmp"; } && exit $exit_status
 ' 0
-  trap '{ (exit 1); exit 1; }' 1 2 13 15
+  trap 'as_fn_exit 1' 1 2 13 15
 }
 # Create a (secure) tmp directory for tmp files.
 
 {
   tmp=`(umask 077 && mktemp -d "./confXXXXXX") 2>/dev/null` &&
-  test -n "$tmp" && test -d "$tmp"
+  test -d "$tmp"
 }  ||
 {
   tmp=./conf$$-$RANDOM
   (umask 077 && mkdir "$tmp")
-} ||
-{
-   echo "$me: cannot create a temporary directory in ." >&2
-   { (exit 1); exit 1; }
-}
-
-#
-# Set up the sed scripts for CONFIG_FILES section.
-#
+} || as_fn_error $? "cannot create a temporary directory in ." "$LINENO" 5
+ac_tmp=$tmp
 
-# No need to generate the scripts if there are no CONFIG_FILES.
-# This happens for instance when ./config.status config.h
+# Set up the scripts for CONFIG_FILES section.
+# No need to generate them if there are no CONFIG_FILES.
+# This happens for instance with `./config.status config.h'.
 if test -n "$CONFIG_FILES"; then
 
-_ACEOF
-
-
-
-ac_delim='%!_!# '
-for ac_last_try in false false false false false :; do
-  cat >conf$$subs.sed <<_ACEOF
-SHELL!$SHELL$ac_delim
-PATH_SEPARATOR!$PATH_SEPARATOR$ac_delim
-PACKAGE_NAME!$PACKAGE_NAME$ac_delim
-PACKAGE_TARNAME!$PACKAGE_TARNAME$ac_delim
-PACKAGE_VERSION!$PACKAGE_VERSION$ac_delim
-PACKAGE_STRING!$PACKAGE_STRING$ac_delim
-PACKAGE_BUGREPORT!$PACKAGE_BUGREPORT$ac_delim
-exec_prefix!$exec_prefix$ac_delim
-prefix!$prefix$ac_delim
-program_transform_name!$program_transform_name$ac_delim
-bindir!$bindir$ac_delim
-sbindir!$sbindir$ac_delim
-libexecdir!$libexecdir$ac_delim
-datarootdir!$datarootdir$ac_delim
-datadir!$datadir$ac_delim
-sysconfdir!$sysconfdir$ac_delim
-sharedstatedir!$sharedstatedir$ac_delim
-localstatedir!$localstatedir$ac_delim
-includedir!$includedir$ac_delim
-oldincludedir!$oldincludedir$ac_delim
-docdir!$docdir$ac_delim
-infodir!$infodir$ac_delim
-htmldir!$htmldir$ac_delim
-dvidir!$dvidir$ac_delim
-pdfdir!$pdfdir$ac_delim
-psdir!$psdir$ac_delim
-libdir!$libdir$ac_delim
-localedir!$localedir$ac_delim
-mandir!$mandir$ac_delim
-DEFS!$DEFS$ac_delim
-ECHO_C!$ECHO_C$ac_delim
-ECHO_N!$ECHO_N$ac_delim
-ECHO_T!$ECHO_T$ac_delim
-LIBS!$LIBS$ac_delim
-build_alias!$build_alias$ac_delim
-host_alias!$host_alias$ac_delim
-target_alias!$target_alias$ac_delim
-LT_VERSION_IXML!$LT_VERSION_IXML$ac_delim
-LT_VERSION_THREADUTIL!$LT_VERSION_THREADUTIL$ac_delim
-LT_VERSION_UPNP!$LT_VERSION_UPNP$ac_delim
-INSTALL_PROGRAM!$INSTALL_PROGRAM$ac_delim
-INSTALL_SCRIPT!$INSTALL_SCRIPT$ac_delim
-INSTALL_DATA!$INSTALL_DATA$ac_delim
-CYGPATH_W!$CYGPATH_W$ac_delim
-PACKAGE!$PACKAGE$ac_delim
-VERSION!$VERSION$ac_delim
-ACLOCAL!$ACLOCAL$ac_delim
-AUTOCONF!$AUTOCONF$ac_delim
-AUTOMAKE!$AUTOMAKE$ac_delim
-AUTOHEADER!$AUTOHEADER$ac_delim
-MAKEINFO!$MAKEINFO$ac_delim
-install_sh!$install_sh$ac_delim
-STRIP!$STRIP$ac_delim
-INSTALL_STRIP_PROGRAM!$INSTALL_STRIP_PROGRAM$ac_delim
-mkdir_p!$mkdir_p$ac_delim
-AWK!$AWK$ac_delim
-SET_MAKE!$SET_MAKE$ac_delim
-am__leading_dot!$am__leading_dot$ac_delim
-AMTAR!$AMTAR$ac_delim
-am__tar!$am__tar$ac_delim
-am__untar!$am__untar$ac_delim
-build!$build$ac_delim
-build_cpu!$build_cpu$ac_delim
-build_vendor!$build_vendor$ac_delim
-build_os!$build_os$ac_delim
-host!$host$ac_delim
-host_cpu!$host_cpu$ac_delim
-host_vendor!$host_vendor$ac_delim
-host_os!$host_os$ac_delim
-ENABLE_DEBUG_TRUE!$ENABLE_DEBUG_TRUE$ac_delim
-ENABLE_DEBUG_FALSE!$ENABLE_DEBUG_FALSE$ac_delim
-ENABLE_CLIENT_TRUE!$ENABLE_CLIENT_TRUE$ac_delim
-ENABLE_CLIENT_FALSE!$ENABLE_CLIENT_FALSE$ac_delim
-ENABLE_DEVICE_TRUE!$ENABLE_DEVICE_TRUE$ac_delim
-ENABLE_DEVICE_FALSE!$ENABLE_DEVICE_FALSE$ac_delim
-ENABLE_WEBSERVER_TRUE!$ENABLE_WEBSERVER_TRUE$ac_delim
-ENABLE_WEBSERVER_FALSE!$ENABLE_WEBSERVER_FALSE$ac_delim
-ENABLE_TOOLS_TRUE!$ENABLE_TOOLS_TRUE$ac_delim
-ENABLE_TOOLS_FALSE!$ENABLE_TOOLS_FALSE$ac_delim
-ENABLE_SAMPLES_TRUE!$ENABLE_SAMPLES_TRUE$ac_delim
-ENABLE_SAMPLES_FALSE!$ENABLE_SAMPLES_FALSE$ac_delim
-WITH_DOCUMENTATION_TRUE!$WITH_DOCUMENTATION_TRUE$ac_delim
-WITH_DOCUMENTATION_FALSE!$WITH_DOCUMENTATION_FALSE$ac_delim
-CC!$CC$ac_delim
-CFLAGS!$CFLAGS$ac_delim
-LDFLAGS!$LDFLAGS$ac_delim
-CPPFLAGS!$CPPFLAGS$ac_delim
-ac_ct_CC!$ac_ct_CC$ac_delim
-EXEEXT!$EXEEXT$ac_delim
-OBJEXT!$OBJEXT$ac_delim
-DEPDIR!$DEPDIR$ac_delim
-am__include!$am__include$ac_delim
-am__quote!$am__quote$ac_delim
-AMDEP_TRUE!$AMDEP_TRUE$ac_delim
-AMDEP_FALSE!$AMDEP_FALSE$ac_delim
-AMDEPBACKSLASH!$AMDEPBACKSLASH$ac_delim
-CCDEPMODE!$CCDEPMODE$ac_delim
-_ACEOF
-
-  if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 97; then
-    break
-  elif $ac_last_try; then
-    { { echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
-  else
-    ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
-  fi
-done
 
-ac_eof=`sed -n '/^CEOF[0-9]*$/s/CEOF/0/p' conf$$subs.sed`
-if test -n "$ac_eof"; then
-  ac_eof=`echo "$ac_eof" | sort -nru | sed 1q`
-  ac_eof=`expr $ac_eof + 1`
+ac_cr=`echo X | tr X '\015'`
+# On cygwin, bash can eat \r inside `` if the user requested igncr.
+# But we know of no other shell where ac_cr would be empty at this
+# point, so we can use a bashism as a fallback.
+if test "x$ac_cr" = x; then
+  eval ac_cr=\$\'\\r\'
+fi
+ac_cs_awk_cr=`$AWK 'BEGIN { print "a\rb" }' </dev/null 2>/dev/null`
+if test "$ac_cs_awk_cr" = "a${ac_cr}b"; then
+  ac_cs_awk_cr='\\r'
+else
+  ac_cs_awk_cr=$ac_cr
 fi
 
-cat >>$CONFIG_STATUS <<_ACEOF
-cat >"\$tmp/subs-1.sed" <<\CEOF$ac_eof
-/@[a-zA-Z_][a-zA-Z_0-9]*@/!b
-_ACEOF
-sed '
-s/[,\\&]/\\&/g; s/@/@|#_!!_#|/g
-s/^/s,@/; s/!/@,|#_!!_#|/
-:n
-t n
-s/'"$ac_delim"'$/,g/; t
-s/$/\\/; p
-N; s/^.*\n//; s/[,\\&]/\\&/g; s/@/@|#_!!_#|/g; b n
-' >>$CONFIG_STATUS <conf$$subs.sed
-rm -f conf$$subs.sed
-cat >>$CONFIG_STATUS <<_ACEOF
-CEOF$ac_eof
+echo 'BEGIN {' >"$ac_tmp/subs1.awk" &&
 _ACEOF
 
 
+{
+  echo "cat >conf$$subs.awk <<_ACEOF" &&
+  echo "$ac_subst_vars" | sed 's/.*/&!$&$ac_delim/' &&
+  echo "_ACEOF"
+} >conf$$subs.sh ||
+  as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
+ac_delim_num=`echo "$ac_subst_vars" | grep -c '^'`
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
-  cat >conf$$subs.sed <<_ACEOF
-am__fastdepCC_TRUE!$am__fastdepCC_TRUE$ac_delim
-am__fastdepCC_FALSE!$am__fastdepCC_FALSE$ac_delim
-GREP!$GREP$ac_delim
-EGREP!$EGREP$ac_delim
-LN_S!$LN_S$ac_delim
-ECHO!$ECHO$ac_delim
-AR!$AR$ac_delim
-RANLIB!$RANLIB$ac_delim
-CPP!$CPP$ac_delim
-CXX!$CXX$ac_delim
-CXXFLAGS!$CXXFLAGS$ac_delim
-ac_ct_CXX!$ac_ct_CXX$ac_delim
-CXXDEPMODE!$CXXDEPMODE$ac_delim
-am__fastdepCXX_TRUE!$am__fastdepCXX_TRUE$ac_delim
-am__fastdepCXX_FALSE!$am__fastdepCXX_FALSE$ac_delim
-CXXCPP!$CXXCPP$ac_delim
-F77!$F77$ac_delim
-FFLAGS!$FFLAGS$ac_delim
-ac_ct_F77!$ac_ct_F77$ac_delim
-LIBTOOL!$LIBTOOL$ac_delim
-acx_pthread_config!$acx_pthread_config$ac_delim
-PTHREAD_CC!$PTHREAD_CC$ac_delim
-PTHREAD_LIBS!$PTHREAD_LIBS$ac_delim
-PTHREAD_CFLAGS!$PTHREAD_CFLAGS$ac_delim
-LIBOBJS!$LIBOBJS$ac_delim
-LTLIBOBJS!$LTLIBOBJS$ac_delim
-_ACEOF
+  . ./conf$$subs.sh ||
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
 
-  if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 26; then
+  ac_delim_n=`sed -n "s/.*$ac_delim\$/X/p" conf$$subs.awk | grep -c X`
+  if test $ac_delim_n = $ac_delim_num; then
     break
   elif $ac_last_try; then
-    { { echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
 done
+rm -f conf$$subs.sh
 
-ac_eof=`sed -n '/^CEOF[0-9]*$/s/CEOF/0/p' conf$$subs.sed`
-if test -n "$ac_eof"; then
-  ac_eof=`echo "$ac_eof" | sort -nru | sed 1q`
-  ac_eof=`expr $ac_eof + 1`
-fi
-
-cat >>$CONFIG_STATUS <<_ACEOF
-cat >"\$tmp/subs-2.sed" <<\CEOF$ac_eof
-/@[a-zA-Z_][a-zA-Z_0-9]*@/!b end
-_ACEOF
-sed '
-s/[,\\&]/\\&/g; s/@/@|#_!!_#|/g
-s/^/s,@/; s/!/@,|#_!!_#|/
-:n
-t n
-s/'"$ac_delim"'$/,g/; t
-s/$/\\/; p
-N; s/^.*\n//; s/[,\\&]/\\&/g; s/@/@|#_!!_#|/g; b n
-' >>$CONFIG_STATUS <conf$$subs.sed
-rm -f conf$$subs.sed
-cat >>$CONFIG_STATUS <<_ACEOF
-:end
-s/|#_!!_#|//g
-CEOF$ac_eof
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+cat >>"\$ac_tmp/subs1.awk" <<\\_ACAWK &&
 _ACEOF
+sed -n '
+h
+s/^/S["/; s/!.*/"]=/
+p
+g
+s/^[^!]*!//
+:repl
+t repl
+s/'"$ac_delim"'$//
+t delim
+:nl
+h
+s/\(.\{148\}\)..*/\1/
+t more1
+s/["\\]/\\&/g; s/^/"/; s/$/\\n"\\/
+p
+n
+b repl
+:more1
+s/["\\]/\\&/g; s/^/"/; s/$/"\\/
+p
+g
+s/.\{148\}//
+t nl
+:delim
+h
+s/\(.\{148\}\)..*/\1/
+t more2
+s/["\\]/\\&/g; s/^/"/; s/$/"/
+p
+b
+:more2
+s/["\\]/\\&/g; s/^/"/; s/$/"\\/
+p
+g
+s/.\{148\}//
+t delim
+' <conf$$subs.awk | sed '
+/^[^""]/{
+  N
+  s/\n//
+}
+' >>$CONFIG_STATUS || ac_write_fail=1
+rm -f conf$$subs.awk
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+_ACAWK
+cat >>"\$ac_tmp/subs1.awk" <<_ACAWK &&
+  for (key in S) S_is_set[key] = 1
+  FS = ""
+
+}
+{
+  line = $ 0
+  nfields = split(line, field, "@")
+  substed = 0
+  len = length(field[1])
+  for (i = 2; i < nfields; i++) {
+    key = field[i]
+    keylen = length(key)
+    if (S_is_set[key]) {
+      value = S[key]
+      line = substr(line, 1, len) "" value "" substr(line, len + keylen + 3)
+      len += length(value) + length(field[++i])
+      substed = 1
+    } else
+      len += 1 + keylen
+  }
+
+  print line
+}
 
+_ACAWK
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+if sed "s/$ac_cr//" < /dev/null > /dev/null 2>&1; then
+  sed "s/$ac_cr\$//; s/$ac_cr/$ac_cs_awk_cr/g"
+else
+  cat
+fi < "$ac_tmp/subs1.awk" > "$ac_tmp/subs.awk" \
+  || as_fn_error $? "could not setup config files machinery" "$LINENO" 5
+_ACEOF
 
-# VPATH may cause trouble with some makes, so we remove $(srcdir),
-# ${srcdir} and @srcdir@ from VPATH if srcdir is ".", strip leading and
+# VPATH may cause trouble with some makes, so we remove sole $(srcdir),
+# ${srcdir} and @srcdir@ entries from VPATH if srcdir is ".", strip leading and
 # trailing colons and then remove the whole line if VPATH becomes empty
 # (actually we leave an empty line to preserve line numbers).
 if test "x$srcdir" = x.; then
-  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
-s/:*\$(srcdir):*/:/
-s/:*\${srcdir}:*/:/
-s/:*@srcdir@:*/:/
-s/^\([^=]*=[	 ]*\):*/\1/
+  ac_vpsub='/^[	 ]*VPATH[	 ]*=[	 ]*/{
+h
+s///
+s/^/:/
+s/[	 ]*$/:/
+s/:\$(srcdir):/:/g
+s/:\${srcdir}:/:/g
+s/:@srcdir@:/:/g
+s/^:*//
 s/:*$//
+x
+s/\(=[	 ]*\).*/\1/
+G
+s/\n//
 s/^[^=]*=[	 ]*$//
 }'
 fi
 
-cat >>$CONFIG_STATUS <<\_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 fi # test -n "$CONFIG_FILES"
 
+# Set up the scripts for CONFIG_HEADERS section.
+# No need to generate them if there are no CONFIG_HEADERS.
+# This happens for instance with `./config.status Makefile'.
+if test -n "$CONFIG_HEADERS"; then
+cat >"$ac_tmp/defines.awk" <<\_ACAWK ||
+BEGIN {
+_ACEOF
+
+# Transform confdefs.h into an awk script `defines.awk', embedded as
+# here-document in config.status, that substitutes the proper values into
+# config.h.in to produce config.h.
+
+# Create a delimiter string that does not exist in confdefs.h, to ease
+# handling of long lines.
+ac_delim='%!_!# '
+for ac_last_try in false false :; do
+  ac_tt=`sed -n "/$ac_delim/p" confdefs.h`
+  if test -z "$ac_tt"; then
+    break
+  elif $ac_last_try; then
+    as_fn_error $? "could not make $CONFIG_HEADERS" "$LINENO" 5
+  else
+    ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
+  fi
+done
+
+# For the awk script, D is an array of macro values keyed by name,
+# likewise P contains macro parameters if any.  Preserve backslash
+# newline sequences.
+
+ac_word_re=[_$as_cr_Letters][_$as_cr_alnum]*
+sed -n '
+s/.\{148\}/&'"$ac_delim"'/g
+t rset
+:rset
+s/^[	 ]*#[	 ]*define[	 ][	 ]*/ /
+t def
+d
+:def
+s/\\$//
+t bsnl
+s/["\\]/\\&/g
+s/^ \('"$ac_word_re"'\)\(([^()]*)\)[	 ]*\(.*\)/P["\1"]="\2"\
+D["\1"]=" \3"/p
+s/^ \('"$ac_word_re"'\)[	 ]*\(.*\)/D["\1"]=" \2"/p
+d
+:bsnl
+s/["\\]/\\&/g
+s/^ \('"$ac_word_re"'\)\(([^()]*)\)[	 ]*\(.*\)/P["\1"]="\2"\
+D["\1"]=" \3\\\\\\n"\\/p
+t cont
+s/^ \('"$ac_word_re"'\)[	 ]*\(.*\)/D["\1"]=" \2\\\\\\n"\\/p
+t cont
+d
+:cont
+n
+s/.\{148\}/&'"$ac_delim"'/g
+t clear
+:clear
+s/\\$//
+t bsnlc
+s/["\\]/\\&/g; s/^/"/; s/$/"/p
+d
+:bsnlc
+s/["\\]/\\&/g; s/^/"/; s/$/\\\\\\n"\\/p
+b cont
+' <confdefs.h | sed '
+s/'"$ac_delim"'/"\\\
+"/g' >>$CONFIG_STATUS || ac_write_fail=1
+
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+  for (key in D) D_is_set[key] = 1
+  FS = ""
+}
+/^[\t ]*#[\t ]*(define|undef)[\t ]+$ac_word_re([\t (]|\$)/ {
+  line = \$ 0
+  split(line, arg, " ")
+  if (arg[1] == "#") {
+    defundef = arg[2]
+    mac1 = arg[3]
+  } else {
+    defundef = substr(arg[1], 2)
+    mac1 = arg[2]
+  }
+  split(mac1, mac2, "(") #)
+  macro = mac2[1]
+  prefix = substr(line, 1, index(line, defundef) - 1)
+  if (D_is_set[macro]) {
+    # Preserve the white space surrounding the "#".
+    print prefix "define", macro P[macro] D[macro]
+    next
+  } else {
+    # Replace #undef with comments.  This is necessary, for example,
+    # in the case of _POSIX_SOURCE, which is predefined and required
+    # on some systems where configure will not decide to define it.
+    if (defundef == "undef") {
+      print "/*", prefix defundef, macro, "*/"
+      next
+    }
+  }
+}
+{ print }
+_ACAWK
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+  as_fn_error $? "could not setup config headers machinery" "$LINENO" 5
+fi # test -n "$CONFIG_HEADERS"
+
 
-for ac_tag in  :F $CONFIG_FILES  :H $CONFIG_HEADERS    :C $CONFIG_COMMANDS
+eval set X "  :F $CONFIG_FILES  :H $CONFIG_HEADERS    :C $CONFIG_COMMANDS"
+shift
+for ac_tag
 do
   case $ac_tag in
   :[FHLC]) ac_mode=$ac_tag; continue;;
   esac
   case $ac_mode$ac_tag in
   :[FHL]*:*);;
-  :L* | :C*:*) { { echo "$as_me:$LINENO: error: Invalid tag $ac_tag." >&5
-echo "$as_me: error: Invalid tag $ac_tag." >&2;}
-   { (exit 1); exit 1; }; };;
+  :L* | :C*:*) as_fn_error $? "invalid tag \`$ac_tag'" "$LINENO" 5;;
   :[FH]-) ac_tag=-:-;;
   :[FH]*) ac_tag=$ac_tag:$ac_tag.in;;
   esac
@@ -23710,7 +21245,7 @@
     for ac_f
     do
       case $ac_f in
-      -) ac_f="$tmp/stdin";;
+      -) ac_f="$ac_tmp/stdin";;
       *) # Look for the file first in the build tree, then in the source tree
 	 # (if the path is not absolute).  The absolute path cannot be DOS-style,
 	 # because $ac_f cannot contain `:'.
@@ -23719,26 +21254,34 @@
 	   [\\/$]*) false;;
 	   *) test -f "$srcdir/$ac_f" && ac_f="$srcdir/$ac_f";;
 	   esac ||
-	   { { echo "$as_me:$LINENO: error: cannot find input file: $ac_f" >&5
-echo "$as_me: error: cannot find input file: $ac_f" >&2;}
-   { (exit 1); exit 1; }; };;
+	   as_fn_error 1 "cannot find input file: \`$ac_f'" "$LINENO" 5;;
       esac
-      ac_file_inputs="$ac_file_inputs $ac_f"
+      case $ac_f in *\'*) ac_f=`$as_echo "$ac_f" | sed "s/'/'\\\\\\\\''/g"`;; esac
+      as_fn_append ac_file_inputs " '$ac_f'"
     done
 
     # Let's still pretend it is `configure' which instantiates (i.e., don't
     # use $as_me), people would be surprised to read:
     #    /* config.h.  Generated by config.status.  */
-    configure_input="Generated from "`IFS=:
-	  echo $* | sed 's|^[^:]*/||;s|:[^:]*/|, |g'`" by configure."
+    configure_input='Generated from '`
+	  $as_echo "$*" | sed 's|^[^:]*/||;s|:[^:]*/|, |g'
+	`' by configure.'
     if test x"$ac_file" != x-; then
       configure_input="$ac_file.  $configure_input"
-      { echo "$as_me:$LINENO: creating $ac_file" >&5
-echo "$as_me: creating $ac_file" >&6;}
+      { $as_echo "$as_me:${as_lineno-$LINENO}: creating $ac_file" >&5
+$as_echo "$as_me: creating $ac_file" >&6;}
     fi
+    # Neutralize special characters interpreted by sed in replacement strings.
+    case $configure_input in #(
+    *\&* | *\|* | *\\* )
+       ac_sed_conf_input=`$as_echo "$configure_input" |
+       sed 's/[\\\\&|]/\\\\&/g'`;; #(
+    *) ac_sed_conf_input=$configure_input;;
+    esac
 
     case $ac_tag in
-    *:-:* | *:-) cat >"$tmp/stdin";;
+    *:-:* | *:-) cat >"$ac_tmp/stdin" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5 ;;
     esac
     ;;
   esac
@@ -23748,42 +21291,7 @@
 	 X"$ac_file" : 'X\(//\)[^/]' \| \
 	 X"$ac_file" : 'X\(//\)$' \| \
 	 X"$ac_file" : 'X\(/\)' \| . 2>/dev/null ||
-echo X"$ac_file" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-  { as_dir="$ac_dir"
-  case $as_dir in #(
-  -*) as_dir=./$as_dir;;
-  esac
-  test -d "$as_dir" || { $as_mkdir_p && mkdir -p "$as_dir"; } || {
-    as_dirs=
-    while :; do
-      case $as_dir in #(
-      *\'*) as_qdir=`echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #(
-      *) as_qdir=$as_dir;;
-      esac
-      as_dirs="'$as_qdir' $as_dirs"
-      as_dir=`$as_dirname -- "$as_dir" ||
-$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
-echo X"$as_dir" |
+$as_echo X"$ac_file" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
 	    s//\1/
 	    q
@@ -23801,20 +21309,15 @@
 	    q
 	  }
 	  s/.*/./; q'`
-      test -d "$as_dir" && break
-    done
-    test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || { { echo "$as_me:$LINENO: error: cannot create directory $as_dir" >&5
-echo "$as_me: error: cannot create directory $as_dir" >&2;}
-   { (exit 1); exit 1; }; }; }
+  as_dir="$ac_dir"; as_fn_mkdir_p
   ac_builddir=.
 
 case "$ac_dir" in
 .) ac_dir_suffix= ac_top_builddir_sub=. ac_top_build_prefix= ;;
 *)
-  ac_dir_suffix=/`echo "$ac_dir" | sed 's,^\.[\\/],,'`
+  ac_dir_suffix=/`$as_echo "$ac_dir" | sed 's|^\.[\\/]||'`
   # A ".." for each directory in $ac_dir_suffix.
-  ac_top_builddir_sub=`echo "$ac_dir_suffix" | sed 's,/[^\\/]*,/..,g;s,/,,'`
+  ac_top_builddir_sub=`$as_echo "$ac_dir_suffix" | sed 's|/[^\\/]*|/..|g;s|/||'`
   case $ac_top_builddir_sub in
   "") ac_top_builddir_sub=. ac_top_build_prefix= ;;
   *)  ac_top_build_prefix=$ac_top_builddir_sub/ ;;
@@ -23854,12 +21357,12 @@
   esac
 _ACEOF
 
-cat >>$CONFIG_STATUS <<\_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 # If the template does not know about datarootdir, expand it.
 # FIXME: This hack should be removed a few years after 2.60.
 ac_datarootdir_hack=; ac_datarootdir_seen=
-
-case `sed -n '/datarootdir/ {
+ac_sed_dataroot='
+/datarootdir/ {
   p
   q
 }
@@ -23867,36 +21370,37 @@
 /@docdir@/p
 /@infodir@/p
 /@localedir@/p
-/@mandir@/p
-' $ac_file_inputs` in
+/@mandir@/p'
+case `eval "sed -n \"\$ac_sed_dataroot\" $ac_file_inputs"` in
 *datarootdir*) ac_datarootdir_seen=yes;;
 *@datadir@*|*@docdir@*|*@infodir@*|*@localedir@*|*@mandir@*)
-  { echo "$as_me:$LINENO: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
-echo "$as_me: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&2;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
+$as_echo "$as_me: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&2;}
 _ACEOF
-cat >>$CONFIG_STATUS <<_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
   ac_datarootdir_hack='
   s&@datadir@&$datadir&g
   s&@docdir@&$docdir&g
   s&@infodir@&$infodir&g
   s&@localedir@&$localedir&g
   s&@mandir@&$mandir&g
-    s&\\\${datarootdir}&$datarootdir&g' ;;
+  s&\\\${datarootdir}&$datarootdir&g' ;;
 esac
 _ACEOF
 
 # Neutralize VPATH when `$srcdir' = `.'.
 # Shell code in configure.ac might set extrasub.
 # FIXME: do we really want to maintain this feature?
-cat >>$CONFIG_STATUS <<_ACEOF
-  sed "$ac_vpsub
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+ac_sed_extra="$ac_vpsub
 $extrasub
 _ACEOF
-cat >>$CONFIG_STATUS <<\_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 :t
 /@[a-zA-Z_][a-zA-Z_0-9]*@/!b
-s&@configure_input@&$configure_input&;t t
+s|@configure_input@|$ac_sed_conf_input|;t t
 s&@top_builddir@&$ac_top_builddir_sub&;t t
+s&@top_build_prefix@&$ac_top_build_prefix&;t t
 s&@srcdir@&$ac_srcdir&;t t
 s&@abs_srcdir@&$ac_abs_srcdir&;t t
 s&@top_srcdir@&$ac_top_srcdir&;t t
@@ -23906,135 +21410,65 @@
 s&@abs_top_builddir@&$ac_abs_top_builddir&;t t
 s&@INSTALL@&$ac_INSTALL&;t t
 $ac_datarootdir_hack
-" $ac_file_inputs | sed -f "$tmp/subs-1.sed" | sed -f "$tmp/subs-2.sed" >$tmp/out
+"
+eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$ac_tmp/subs.awk" \
+  >$ac_tmp/out || as_fn_error $? "could not create $ac_file" "$LINENO" 5
 
 test -z "$ac_datarootdir_hack$ac_datarootdir_seen" &&
-  { ac_out=`sed -n '/\${datarootdir}/p' "$tmp/out"`; test -n "$ac_out"; } &&
-  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' "$tmp/out"`; test -z "$ac_out"; } &&
-  { echo "$as_me:$LINENO: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&5
-echo "$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&2;}
+  { ac_out=`sed -n '/\${datarootdir}/p' "$ac_tmp/out"`; test -n "$ac_out"; } &&
+  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' \
+      "$ac_tmp/out"`; test -z "$ac_out"; } &&
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file contains a reference to the variable \`datarootdir'
+which seems to be undefined.  Please make sure it is defined" >&5
+$as_echo "$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
+which seems to be undefined.  Please make sure it is defined" >&2;}
 
-  rm -f "$tmp/stdin"
+  rm -f "$ac_tmp/stdin"
   case $ac_file in
-  -) cat "$tmp/out"; rm -f "$tmp/out";;
-  *) rm -f "$ac_file"; mv "$tmp/out" $ac_file;;
-  esac
+  -) cat "$ac_tmp/out" && rm -f "$ac_tmp/out";;
+  *) rm -f "$ac_file" && mv "$ac_tmp/out" "$ac_file";;
+  esac \
+  || as_fn_error $? "could not create $ac_file" "$LINENO" 5
  ;;
   :H)
   #
   # CONFIG_HEADER
   #
-_ACEOF
-
-# Transform confdefs.h into a sed script `conftest.defines', that
-# substitutes the proper values into config.h.in to produce config.h.
-rm -f conftest.defines conftest.tail
-# First, append a space to every undef/define line, to ease matching.
-echo 's/$/ /' >conftest.defines
-# Then, protect against being on the right side of a sed subst, or in
-# an unquoted here document, in config.status.  If some macros were
-# called several times there might be several #defines for the same
-# symbol, which is useless.  But do not sort them, since the last
-# AC_DEFINE must be honored.
-ac_word_re=[_$as_cr_Letters][_$as_cr_alnum]*
-# These sed commands are passed to sed as "A NAME B PARAMS C VALUE D", where
-# NAME is the cpp macro being defined, VALUE is the value it is being given.
-# PARAMS is the parameter list in the macro definition--in most cases, it's
-# just an empty string.
-ac_dA='s,^\\([	 #]*\\)[^	 ]*\\([	 ]*'
-ac_dB='\\)[	 (].*,\\1define\\2'
-ac_dC=' '
-ac_dD=' ,'
-
-uniq confdefs.h |
-  sed -n '
-	t rset
-	:rset
-	s/^[	 ]*#[	 ]*define[	 ][	 ]*//
-	t ok
-	d
-	:ok
-	s/[\\&,]/\\&/g
-	s/^\('"$ac_word_re"'\)\(([^()]*)\)[	 ]*\(.*\)/ '"$ac_dA"'\1'"$ac_dB"'\2'"${ac_dC}"'\3'"$ac_dD"'/p
-	s/^\('"$ac_word_re"'\)[	 ]*\(.*\)/'"$ac_dA"'\1'"$ac_dB$ac_dC"'\2'"$ac_dD"'/p
-  ' >>conftest.defines
-
-# Remove the space that was appended to ease matching.
-# Then replace #undef with comments.  This is necessary, for
-# example, in the case of _POSIX_SOURCE, which is predefined and required
-# on some systems where configure will not decide to define it.
-# (The regexp can be short, since the line contains either #define or #undef.)
-echo 's/ $//
-s,^[	 #]*u.*,/* & */,' >>conftest.defines
-
-# Break up conftest.defines:
-ac_max_sed_lines=50
-
-# First sed command is:	 sed -f defines.sed $ac_file_inputs >"$tmp/out1"
-# Second one is:	 sed -f defines.sed "$tmp/out1" >"$tmp/out2"
-# Third one will be:	 sed -f defines.sed "$tmp/out2" >"$tmp/out1"
-# et cetera.
-ac_in='$ac_file_inputs'
-ac_out='"$tmp/out1"'
-ac_nxt='"$tmp/out2"'
-
-while :
-do
-  # Write a here document:
-    cat >>$CONFIG_STATUS <<_ACEOF
-    # First, check the format of the line:
-    cat >"\$tmp/defines.sed" <<\\CEOF
-/^[	 ]*#[	 ]*undef[	 ][	 ]*$ac_word_re[	 ]*\$/b def
-/^[	 ]*#[	 ]*define[	 ][	 ]*$ac_word_re[(	 ]/b def
-b
-:def
-_ACEOF
-  sed ${ac_max_sed_lines}q conftest.defines >>$CONFIG_STATUS
-  echo 'CEOF
-    sed -f "$tmp/defines.sed"' "$ac_in >$ac_out" >>$CONFIG_STATUS
-  ac_in=$ac_out; ac_out=$ac_nxt; ac_nxt=$ac_in
-  sed 1,${ac_max_sed_lines}d conftest.defines >conftest.tail
-  grep . conftest.tail >/dev/null || break
-  rm -f conftest.defines
-  mv conftest.tail conftest.defines
-done
-rm -f conftest.defines conftest.tail
-
-echo "ac_result=$ac_in" >>$CONFIG_STATUS
-cat >>$CONFIG_STATUS <<\_ACEOF
   if test x"$ac_file" != x-; then
-    echo "/* $configure_input  */" >"$tmp/config.h"
-    cat "$ac_result" >>"$tmp/config.h"
-    if diff $ac_file "$tmp/config.h" >/dev/null 2>&1; then
-      { echo "$as_me:$LINENO: $ac_file is unchanged" >&5
-echo "$as_me: $ac_file is unchanged" >&6;}
+    {
+      $as_echo "/* $configure_input  */" \
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs"
+    } >"$ac_tmp/config.h" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5
+    if diff "$ac_file" "$ac_tmp/config.h" >/dev/null 2>&1; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: $ac_file is unchanged" >&5
+$as_echo "$as_me: $ac_file is unchanged" >&6;}
     else
-      rm -f $ac_file
-      mv "$tmp/config.h" $ac_file
+      rm -f "$ac_file"
+      mv "$ac_tmp/config.h" "$ac_file" \
+	|| as_fn_error $? "could not create $ac_file" "$LINENO" 5
     fi
   else
-    echo "/* $configure_input  */"
-    cat "$ac_result"
+    $as_echo "/* $configure_input  */" \
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs" \
+      || as_fn_error $? "could not create -" "$LINENO" 5
   fi
-  rm -f "$tmp/out12"
-# Compute $ac_file's index in $config_headers.
+# Compute "$ac_file"'s index in $config_headers.
 _am_stamp_count=1
 for _am_header in $config_headers :; do
   case $_am_header in
-    $ac_file | $ac_file:* )
+    "$ac_file" | "$ac_file":* )
       break ;;
     * )
       _am_stamp_count=`expr $_am_stamp_count + 1` ;;
   esac
 done
-echo "timestamp for $ac_file" >`$as_dirname -- $ac_file ||
-$as_expr X$ac_file : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X$ac_file : 'X\(//\)[^/]' \| \
-	 X$ac_file : 'X\(//\)$' \| \
-	 X$ac_file : 'X\(/\)' \| . 2>/dev/null ||
-echo X$ac_file |
+echo "timestamp for "$ac_file"" >`$as_dirname -- "$ac_file" ||
+$as_expr X"$ac_file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$ac_file" : 'X\(//\)[^/]' \| \
+	 X"$ac_file" : 'X\(//\)$' \| \
+	 X"$ac_file" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$ac_file" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
 	    s//\1/
 	    q
@@ -24054,8 +21488,8 @@
 	  s/.*/./; q'`/stamp-h$_am_stamp_count
  ;;
 
-  :C)  { echo "$as_me:$LINENO: executing $ac_file commands" >&5
-echo "$as_me: executing $ac_file commands" >&6;}
+  :C)  { $as_echo "$as_me:${as_lineno-$LINENO}: executing $ac_file commands" >&5
+$as_echo "$as_me: executing $ac_file commands" >&6;}
  ;;
   esac
 
@@ -24076,7 +21510,7 @@
 	 X"$mf" : 'X\(//\)[^/]' \| \
 	 X"$mf" : 'X\(//\)$' \| \
 	 X"$mf" : 'X\(/\)' \| . 2>/dev/null ||
-echo X"$mf" |
+$as_echo X"$mf" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
 	    s//\1/
 	    q
@@ -24120,42 +21554,7 @@
 	 X"$file" : 'X\(//\)[^/]' \| \
 	 X"$file" : 'X\(//\)$' \| \
 	 X"$file" : 'X\(/\)' \| . 2>/dev/null ||
-echo X"$file" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-    { as_dir=$dirpart/$fdir
-  case $as_dir in #(
-  -*) as_dir=./$as_dir;;
-  esac
-  test -d "$as_dir" || { $as_mkdir_p && mkdir -p "$as_dir"; } || {
-    as_dirs=
-    while :; do
-      case $as_dir in #(
-      *\'*) as_qdir=`echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #(
-      *) as_qdir=$as_dir;;
-      esac
-      as_dirs="'$as_qdir' $as_dirs"
-      as_dir=`$as_dirname -- "$as_dir" ||
-$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
-echo X"$as_dir" |
+$as_echo X"$file" |
     sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
 	    s//\1/
 	    q
@@ -24173,12 +21572,7 @@
 	    q
 	  }
 	  s/.*/./; q'`
-      test -d "$as_dir" && break
-    done
-    test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || { { echo "$as_me:$LINENO: error: cannot create directory $as_dir" >&5
-echo "$as_me: error: cannot create directory $as_dir" >&2;}
-   { (exit 1); exit 1; }; }; }
+    as_dir=$dirpart/$fdir; as_fn_mkdir_p
     # echo "creating $dirpart/$file"
     echo '# dummy' > "$dirpart/$file"
   done
@@ -24189,11 +21583,13 @@
 done # for ac_tag
 
 
-{ (exit 0); exit 0; }
+as_fn_exit 0
 _ACEOF
-chmod +x $CONFIG_STATUS
 ac_clean_files=$ac_clean_files_save
 
+test $ac_write_fail = 0 ||
+  as_fn_error $? "write failure creating $CONFIG_STATUS" "$LINENO" 5
+
 
 # configure is writing to config.log, and then calls config.status.
 # config.status does its own redirection, appending to config.log.
@@ -24213,7 +21609,11 @@
   exec 5>>config.log
   # Use ||, not &&, to avoid exiting from the if with $? = 1, which
   # would make configure fail if this is the last instruction.
-  $ac_cs_success || { (exit 1); exit 1; }
+  $ac_cs_success || as_fn_exit 1
+fi
+if test -n "$ac_unrecognized_opts" && test "$enable_option_checking" != no; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
+$as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2;}
 fi
 
 
diff -Naur libupnp-1.6.6/docs/dist/Makefile.in libupnp-1.6.6-mod/docs/dist/Makefile.in
--- libupnp-1.6.6/docs/dist/Makefile.in	2008-04-25 19:47:37.000000000 +0800
+++ libupnp-1.6.6-mod/docs/dist/Makefile.in	2014-02-11 11:05:20.000000000 +0800
@@ -124,6 +124,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PTHREAD_CC = @PTHREAD_CC@
diff -Naur libupnp-1.6.6/ixml/doc/Makefile.in libupnp-1.6.6-mod/ixml/doc/Makefile.in
--- libupnp-1.6.6/ixml/doc/Makefile.in	2008-04-25 19:47:39.000000000 +0800
+++ libupnp-1.6.6-mod/ixml/doc/Makefile.in	2014-02-11 11:05:20.000000000 +0800
@@ -151,6 +151,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PTHREAD_CC = @PTHREAD_CC@
diff -Naur libupnp-1.6.6/ixml/Makefile.in libupnp-1.6.6-mod/ixml/Makefile.in
--- libupnp-1.6.6/ixml/Makefile.in	2008-04-25 19:47:38.000000000 +0800
+++ libupnp-1.6.6-mod/ixml/Makefile.in	2014-02-11 11:05:20.000000000 +0800
@@ -168,6 +168,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PTHREAD_CC = @PTHREAD_CC@
diff -Naur libupnp-1.6.6/Makefile.in libupnp-1.6.6-mod/Makefile.in
--- libupnp-1.6.6/Makefile.in	2008-04-25 19:47:43.000000000 +0800
+++ libupnp-1.6.6-mod/Makefile.in	2014-02-11 11:05:20.000000000 +0800
@@ -156,6 +156,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PTHREAD_CC = @PTHREAD_CC@
diff -Naur libupnp-1.6.6/NEWS libupnp-1.6.6-mod/NEWS
--- libupnp-1.6.6/NEWS	2008-02-10 09:55:39.000000000 +0800
+++ libupnp-1.6.6-mod/NEWS	2014-02-11 11:03:35.000000000 +0800
@@ -1,6 +1,7 @@
 
 What is new in libupnp 1.3.1
 
+
 * fix: "upnp.h" includes "upnpdebug.h" only if debug enabled in the library 
   (else header file is not installed)
 
diff -Naur libupnp-1.6.6/threadutil/Makefile.in libupnp-1.6.6-mod/threadutil/Makefile.in
--- libupnp-1.6.6/threadutil/Makefile.in	2008-04-25 19:47:39.000000000 +0800
+++ libupnp-1.6.6-mod/threadutil/Makefile.in	2014-02-11 11:05:20.000000000 +0800
@@ -155,6 +155,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PTHREAD_CC = @PTHREAD_CC@
diff -Naur libupnp-1.6.6/upnp/doc/Makefile.in libupnp-1.6.6-mod/upnp/doc/Makefile.in
--- libupnp-1.6.6/upnp/doc/Makefile.in	2008-04-25 19:47:42.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/doc/Makefile.in	2014-02-11 11:05:20.000000000 +0800
@@ -151,6 +151,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PTHREAD_CC = @PTHREAD_CC@
diff -Naur libupnp-1.6.6/upnp/LICENSE libupnp-1.6.6-mod/upnp/LICENSE
--- libupnp-1.6.6/upnp/LICENSE	2008-02-10 09:55:34.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/LICENSE	2014-02-11 11:03:35.000000000 +0800
@@ -1,6 +1,7 @@
 Copyright (c) 2000-2003 Intel Corporation 
 All rights reserved. 
 
+
 Redistribution and use in source and binary forms, with or without 
 modification, are permitted provided that the following conditions are met: 
 
diff -Naur libupnp-1.6.6/upnp/Makefile.in libupnp-1.6.6-mod/upnp/Makefile.in
--- libupnp-1.6.6/upnp/Makefile.in	2008-04-25 19:47:41.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/Makefile.in	2014-02-11 11:05:20.000000000 +0800
@@ -228,6 +228,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PTHREAD_CC = @PTHREAD_CC@
diff -Naur libupnp-1.6.6/upnp/sample/Makefile.am libupnp-1.6.6-mod/upnp/sample/Makefile.am
--- libupnp-1.6.6/upnp/sample/Makefile.am	2008-02-10 09:55:29.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample/Makefile.am	2014-02-11 11:03:35.000000000 +0800
@@ -37,6 +37,13 @@
 	$(AM_CPPFLAGS) \
 	-I$(srcdir)/common/ \
 	-I$(srcdir)/tvdevice
+noinst_PROGRAMS += upnp_nas_device
+endif
+if ENABLE_DEVICE
+upnp_nas_device_CPPFLAGS = \
+	$(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/nasdevice
 endif
 endif
 
@@ -65,6 +72,14 @@
 	tvcombo/upnp_tv_device.h \
 	tvcombo/linux/upnp_tv_combo_main.c
 
+upnp_nas_device_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	nasdevice/upnp_nas_device.c \
+	nasdevice/upnp_nas_device.h \
+	nasdevice/linux/upnp_nas_device_main.c
+
+
 
 if WITH_DOCUMENTATION
 examplesdir = $(docdir)/examples
diff -Naur libupnp-1.6.6/upnp/sample/Makefile.in libupnp-1.6.6-mod/upnp/sample/Makefile.in
--- libupnp-1.6.6/upnp/sample/Makefile.in	2008-04-25 19:47:42.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample/Makefile.in	2014-02-11 11:05:20.000000000 +0800
@@ -46,7 +46,9 @@
 noinst_PROGRAMS = $(am__EXEEXT_1) $(am__EXEEXT_2) $(am__EXEEXT_3)
 @ENABLE_CLIENT_TRUE@@ENABLE_SAMPLES_TRUE@am__append_1 = upnp_tv_ctrlpt
 @ENABLE_CLIENT_TRUE@@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@am__append_2 = upnp_tv_combo
-@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@am__append_3 = upnp_tv_device
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@am__append_3 =  \
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	upnp_tv_device \
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	upnp_nas_device
 subdir = upnp/sample
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -63,9 +65,19 @@
 CONFIG_CLEAN_FILES =
 @ENABLE_CLIENT_TRUE@@ENABLE_SAMPLES_TRUE@am__EXEEXT_1 = upnp_tv_ctrlpt$(EXEEXT)
 @ENABLE_CLIENT_TRUE@@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@am__EXEEXT_2 = upnp_tv_combo$(EXEEXT)
-@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@am__EXEEXT_3 = upnp_tv_device$(EXEEXT)
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@am__EXEEXT_3 = upnp_tv_device$(EXEEXT) \
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	upnp_nas_device$(EXEEXT)
 PROGRAMS = $(noinst_PROGRAMS)
 am__dirstamp = $(am__leading_dot)dirstamp
+am_upnp_nas_device_OBJECTS =  \
+	common/upnp_nas_device-sample_util.$(OBJEXT) \
+	nasdevice/upnp_nas_device-upnp_nas_device.$(OBJEXT) \
+	nasdevice/linux/upnp_nas_device-upnp_nas_device_main.$(OBJEXT)
+upnp_nas_device_OBJECTS = $(am_upnp_nas_device_OBJECTS)
+upnp_nas_device_LDADD = $(LDADD)
+upnp_nas_device_DEPENDENCIES = $(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
 am_upnp_tv_combo_OBJECTS = common/upnp_tv_combo-sample_util.$(OBJEXT) \
 	tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.$(OBJEXT) \
 	tvcombo/upnp_tv_combo-upnp_tv_device.$(OBJEXT) \
@@ -104,10 +116,10 @@
 CCLD = $(CC)
 LINK = $(LIBTOOL) --tag=CC --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
-SOURCES = $(upnp_tv_combo_SOURCES) $(upnp_tv_ctrlpt_SOURCES) \
-	$(upnp_tv_device_SOURCES)
-DIST_SOURCES = $(upnp_tv_combo_SOURCES) $(upnp_tv_ctrlpt_SOURCES) \
-	$(upnp_tv_device_SOURCES)
+SOURCES = $(upnp_nas_device_SOURCES) $(upnp_tv_combo_SOURCES) \
+	$(upnp_tv_ctrlpt_SOURCES) $(upnp_tv_device_SOURCES)
+DIST_SOURCES = $(upnp_nas_device_SOURCES) $(upnp_tv_combo_SOURCES) \
+	$(upnp_tv_ctrlpt_SOURCES) $(upnp_tv_device_SOURCES)
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
 am__vpath_adj = case $$p in \
     $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
@@ -182,6 +194,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PTHREAD_CC = @PTHREAD_CC@
@@ -266,6 +279,11 @@
 @ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	-I$(srcdir)/common/ \
 @ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	-I$(srcdir)/tvdevice
 
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@upnp_nas_device_CPPFLAGS = \
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	$(AM_CPPFLAGS) \
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	-I$(srcdir)/common/ \
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	-I$(srcdir)/nasdevice
+
 upnp_tv_device_SOURCES = \
 	common/sample_util.c \
 	common/sample_util.h \
@@ -289,6 +307,13 @@
 	tvcombo/upnp_tv_device.h \
 	tvcombo/linux/upnp_tv_combo_main.c
 
+upnp_nas_device_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	nasdevice/upnp_nas_device.c \
+	nasdevice/upnp_nas_device.h \
+	nasdevice/linux/upnp_nas_device_main.c
+
 @WITH_DOCUMENTATION_TRUE@examplesdir = $(docdir)/examples
 @WITH_DOCUMENTATION_TRUE@examples_DATA = \
 @WITH_DOCUMENTATION_TRUE@		$(upnp_tv_ctrlpt_SOURCES) \
@@ -347,6 +372,28 @@
 common/$(DEPDIR)/$(am__dirstamp):
 	@$(mkdir_p) common/$(DEPDIR)
 	@: > common/$(DEPDIR)/$(am__dirstamp)
+common/upnp_nas_device-sample_util.$(OBJEXT): common/$(am__dirstamp) \
+	common/$(DEPDIR)/$(am__dirstamp)
+nasdevice/$(am__dirstamp):
+	@$(mkdir_p) nasdevice
+	@: > nasdevice/$(am__dirstamp)
+nasdevice/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) nasdevice/$(DEPDIR)
+	@: > nasdevice/$(DEPDIR)/$(am__dirstamp)
+nasdevice/upnp_nas_device-upnp_nas_device.$(OBJEXT):  \
+	nasdevice/$(am__dirstamp) nasdevice/$(DEPDIR)/$(am__dirstamp)
+nasdevice/linux/$(am__dirstamp):
+	@$(mkdir_p) nasdevice/linux
+	@: > nasdevice/linux/$(am__dirstamp)
+nasdevice/linux/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) nasdevice/linux/$(DEPDIR)
+	@: > nasdevice/linux/$(DEPDIR)/$(am__dirstamp)
+nasdevice/linux/upnp_nas_device-upnp_nas_device_main.$(OBJEXT):  \
+	nasdevice/linux/$(am__dirstamp) \
+	nasdevice/linux/$(DEPDIR)/$(am__dirstamp)
+upnp_nas_device$(EXEEXT): $(upnp_nas_device_OBJECTS) $(upnp_nas_device_DEPENDENCIES) 
+	@rm -f upnp_nas_device$(EXEEXT)
+	$(LINK) $(upnp_nas_device_LDFLAGS) $(upnp_nas_device_OBJECTS) $(upnp_nas_device_LDADD) $(LIBS)
 common/upnp_tv_combo-sample_util.$(OBJEXT): common/$(am__dirstamp) \
 	common/$(DEPDIR)/$(am__dirstamp)
 tvcombo/$(am__dirstamp):
@@ -418,9 +465,12 @@
 
 mostlyclean-compile:
 	-rm -f *.$(OBJEXT)
+	-rm -f common/upnp_nas_device-sample_util.$(OBJEXT)
 	-rm -f common/upnp_tv_combo-sample_util.$(OBJEXT)
 	-rm -f common/upnp_tv_ctrlpt-sample_util.$(OBJEXT)
 	-rm -f common/upnp_tv_device-sample_util.$(OBJEXT)
+	-rm -f nasdevice/linux/upnp_nas_device-upnp_nas_device_main.$(OBJEXT)
+	-rm -f nasdevice/upnp_nas_device-upnp_nas_device.$(OBJEXT)
 	-rm -f tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.$(OBJEXT)
 	-rm -f tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.$(OBJEXT)
 	-rm -f tvcombo/upnp_tv_combo-upnp_tv_device.$(OBJEXT)
@@ -432,9 +482,12 @@
 distclean-compile:
 	-rm -f *.tab.c
 
+@AMDEP_TRUE@@am__include@ @am__quote@common/$(DEPDIR)/upnp_nas_device-sample_util.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@common/$(DEPDIR)/upnp_tv_combo-sample_util.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@common/$(DEPDIR)/upnp_tv_device-sample_util.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Po@am__quote@
@@ -467,6 +520,48 @@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(LTCOMPILE) -c -o $@ $<
 
+common/upnp_nas_device-sample_util.o: common/sample_util.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_nas_device-sample_util.o -MD -MP -MF "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo" -c -o common/upnp_nas_device-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c; \
+@am__fastdepCC_TRUE@	then mv -f "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo" "common/$(DEPDIR)/upnp_nas_device-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='common/sample_util.c' object='common/upnp_nas_device-sample_util.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_nas_device-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c
+
+common/upnp_nas_device-sample_util.obj: common/sample_util.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_nas_device-sample_util.obj -MD -MP -MF "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo" -c -o common/upnp_nas_device-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo" "common/$(DEPDIR)/upnp_nas_device-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='common/sample_util.c' object='common/upnp_nas_device-sample_util.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_nas_device-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`
+
+nasdevice/upnp_nas_device-upnp_nas_device.o: nasdevice/upnp_nas_device.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT nasdevice/upnp_nas_device-upnp_nas_device.o -MD -MP -MF "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo" -c -o nasdevice/upnp_nas_device-upnp_nas_device.o `test -f 'nasdevice/upnp_nas_device.c' || echo '$(srcdir)/'`nasdevice/upnp_nas_device.c; \
+@am__fastdepCC_TRUE@	then mv -f "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo" "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Po"; else rm -f "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='nasdevice/upnp_nas_device.c' object='nasdevice/upnp_nas_device-upnp_nas_device.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o nasdevice/upnp_nas_device-upnp_nas_device.o `test -f 'nasdevice/upnp_nas_device.c' || echo '$(srcdir)/'`nasdevice/upnp_nas_device.c
+
+nasdevice/upnp_nas_device-upnp_nas_device.obj: nasdevice/upnp_nas_device.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT nasdevice/upnp_nas_device-upnp_nas_device.obj -MD -MP -MF "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo" -c -o nasdevice/upnp_nas_device-upnp_nas_device.obj `if test -f 'nasdevice/upnp_nas_device.c'; then $(CYGPATH_W) 'nasdevice/upnp_nas_device.c'; else $(CYGPATH_W) '$(srcdir)/nasdevice/upnp_nas_device.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo" "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Po"; else rm -f "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='nasdevice/upnp_nas_device.c' object='nasdevice/upnp_nas_device-upnp_nas_device.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o nasdevice/upnp_nas_device-upnp_nas_device.obj `if test -f 'nasdevice/upnp_nas_device.c'; then $(CYGPATH_W) 'nasdevice/upnp_nas_device.c'; else $(CYGPATH_W) '$(srcdir)/nasdevice/upnp_nas_device.c'; fi`
+
+nasdevice/linux/upnp_nas_device-upnp_nas_device_main.o: nasdevice/linux/upnp_nas_device_main.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT nasdevice/linux/upnp_nas_device-upnp_nas_device_main.o -MD -MP -MF "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo" -c -o nasdevice/linux/upnp_nas_device-upnp_nas_device_main.o `test -f 'nasdevice/linux/upnp_nas_device_main.c' || echo '$(srcdir)/'`nasdevice/linux/upnp_nas_device_main.c; \
+@am__fastdepCC_TRUE@	then mv -f "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo" "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Po"; else rm -f "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='nasdevice/linux/upnp_nas_device_main.c' object='nasdevice/linux/upnp_nas_device-upnp_nas_device_main.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o nasdevice/linux/upnp_nas_device-upnp_nas_device_main.o `test -f 'nasdevice/linux/upnp_nas_device_main.c' || echo '$(srcdir)/'`nasdevice/linux/upnp_nas_device_main.c
+
+nasdevice/linux/upnp_nas_device-upnp_nas_device_main.obj: nasdevice/linux/upnp_nas_device_main.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT nasdevice/linux/upnp_nas_device-upnp_nas_device_main.obj -MD -MP -MF "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo" -c -o nasdevice/linux/upnp_nas_device-upnp_nas_device_main.obj `if test -f 'nasdevice/linux/upnp_nas_device_main.c'; then $(CYGPATH_W) 'nasdevice/linux/upnp_nas_device_main.c'; else $(CYGPATH_W) '$(srcdir)/nasdevice/linux/upnp_nas_device_main.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo" "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Po"; else rm -f "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='nasdevice/linux/upnp_nas_device_main.c' object='nasdevice/linux/upnp_nas_device-upnp_nas_device_main.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o nasdevice/linux/upnp_nas_device-upnp_nas_device_main.obj `if test -f 'nasdevice/linux/upnp_nas_device_main.c'; then $(CYGPATH_W) 'nasdevice/linux/upnp_nas_device_main.c'; else $(CYGPATH_W) '$(srcdir)/nasdevice/linux/upnp_nas_device_main.c'; fi`
+
 common/upnp_tv_combo-sample_util.o: common/sample_util.c
 @am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_combo-sample_util.o -MD -MP -MF "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo" -c -o common/upnp_tv_combo-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c; \
 @am__fastdepCC_TRUE@	then mv -f "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_combo-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo"; exit 1; fi
@@ -739,6 +834,10 @@
 	-test -z "$(CONFIG_CLEAN_FILES)" || rm -f $(CONFIG_CLEAN_FILES)
 	-rm -f common/$(DEPDIR)/$(am__dirstamp)
 	-rm -f common/$(am__dirstamp)
+	-rm -f nasdevice/$(DEPDIR)/$(am__dirstamp)
+	-rm -f nasdevice/$(am__dirstamp)
+	-rm -f nasdevice/linux/$(DEPDIR)/$(am__dirstamp)
+	-rm -f nasdevice/linux/$(am__dirstamp)
 	-rm -f tvcombo/$(DEPDIR)/$(am__dirstamp)
 	-rm -f tvcombo/$(am__dirstamp)
 	-rm -f tvcombo/linux/$(DEPDIR)/$(am__dirstamp)
@@ -761,7 +860,7 @@
 	mostlyclean-am
 
 distclean: distclean-am
-	-rm -rf common/$(DEPDIR) tvcombo/$(DEPDIR) tvcombo/linux/$(DEPDIR) tvctrlpt/$(DEPDIR) tvctrlpt/linux/$(DEPDIR) tvdevice/$(DEPDIR) tvdevice/linux/$(DEPDIR)
+	-rm -rf common/$(DEPDIR) nasdevice/$(DEPDIR) nasdevice/linux/$(DEPDIR) tvcombo/$(DEPDIR) tvcombo/linux/$(DEPDIR) tvctrlpt/$(DEPDIR) tvctrlpt/linux/$(DEPDIR) tvdevice/$(DEPDIR) tvdevice/linux/$(DEPDIR)
 	-rm -f Makefile
 distclean-am: clean-am distclean-compile distclean-generic \
 	distclean-libtool distclean-tags
@@ -787,7 +886,7 @@
 installcheck-am:
 
 maintainer-clean: maintainer-clean-am
-	-rm -rf common/$(DEPDIR) tvcombo/$(DEPDIR) tvcombo/linux/$(DEPDIR) tvctrlpt/$(DEPDIR) tvctrlpt/linux/$(DEPDIR) tvdevice/$(DEPDIR) tvdevice/linux/$(DEPDIR)
+	-rm -rf common/$(DEPDIR) nasdevice/$(DEPDIR) nasdevice/linux/$(DEPDIR) tvcombo/$(DEPDIR) tvcombo/linux/$(DEPDIR) tvctrlpt/$(DEPDIR) tvctrlpt/linux/$(DEPDIR) tvdevice/$(DEPDIR) tvdevice/linux/$(DEPDIR)
 	-rm -f Makefile
 maintainer-clean-am: distclean-am maintainer-clean-generic
 
diff -Naur libupnp-1.6.6/upnp/sample/nasdevice/linux/upnp_nas_device_main.c libupnp-1.6.6-mod/upnp/sample/nasdevice/linux/upnp_nas_device_main.c
--- libupnp-1.6.6/upnp/sample/nasdevice/linux/upnp_nas_device_main.c	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample/nasdevice/linux/upnp_nas_device_main.c	2014-02-11 15:27:55.000000000 +0800
@@ -0,0 +1,184 @@
+/*
+ * (c) 2010 Western Digital Technologies, Inc. All rights reserved.
+ */
+
+
+#include "sample_util.h"
+#include "upnp_nas_device.h"
+
+
+#include <stdio.h>
+#include <signal.h>
+
+/******************************************************************************
+ * linux_print
+ *
+ * Description: 
+ *       Prints a string to standard out.
+ *
+ * Parameters:
+ *    None
+ *
+ *****************************************************************************/
+void
+linux_print( const char *string )
+{
+    printf( "%s", string );
+}
+
+/******************************************************************************
+ * NAS_DeviceCommandLoop
+ *
+ * Description: 
+ *       Function that receives commands from the user at the command prompt
+ *       during the lifetime of the device, and calls the appropriate
+ *       functions for those commands. Only one command, exit, is currently
+ *       defined.
+ *
+ * Parameters:
+ *    None
+ *
+ *****************************************************************************/
+void *
+NAS_DeviceCommandLoop( void *args )
+{
+    int stoploop = 0;
+    char cmdline[100];
+    char cmd[100];
+
+    while( !stoploop ) {
+        sprintf( cmdline, " " );
+        sprintf( cmd, " " );
+
+        SampleUtil_Print( "\n>> " );
+
+        // Get a command line
+        if (fgets( cmdline, 100, stdin )) {
+            sscanf( cmdline, "%s", cmd );
+
+            if( strcasecmp( cmd, "exit" ) == 0 ) {
+                SampleUtil_Print( "Shutting down...\n" );
+                NAS_DeviceStop();
+                exit( 0 );
+            } else {
+                SampleUtil_Print( "\n   Unknown command: %s\n\n", cmd );
+                SampleUtil_Print( "   Valid Commands:\n" );
+                SampleUtil_Print( "     Exit\n\n" );
+            }
+
+	}
+
+    }
+
+    return NULL;
+}
+
+void sig_handler(int sig)
+{
+
+	SampleUtil_Print( "Upnp shutting down...\n" );
+	NAS_DeviceStop();
+	exit(1);
+
+}
+/******************************************************************************
+ * main
+ *
+ * Description: 
+ *       Main entry point for tv device application.
+ *       Initializes and registers with the sdk.
+ *       Initializes the state stables of the service.
+ *       Starts the command loop.
+ *
+ * Parameters:
+ *    int argc  - count of arguments
+ *    char ** argv -arguments. The application 
+ *                  accepts the following optional arguments:
+ *
+ *                  -ip ipaddress 
+ *                  -port port
+ *		    -desc desc_doc_name 
+ *	            -webdir web_dir_path"
+ *		    -help 
+ *                 
+ *
+ *****************************************************************************/
+int main( IN int argc, IN char **argv )
+{
+
+    unsigned int portTemp = 0;
+    char *ip_address = NULL,
+     *desc_doc_name = NULL,
+     *web_dir_path = NULL;
+    int rc;
+    ithread_t cmdloop_thread;
+#ifndef WIN32
+    int sig;
+    sigset_t sigs_to_catch;
+#endif
+    int code;
+    unsigned int port = 0;
+    int i = 0;
+
+    SampleUtil_Initialize( linux_print );
+
+    // Parse options
+    for( i = 1; i < argc; i++ ) {
+        if( strcmp( argv[i], "-ip" ) == 0 ) {
+            ip_address = argv[++i];
+        } else if( strcmp( argv[i], "-port" ) == 0 ) {
+            sscanf( argv[++i], "%u", &portTemp );
+        } else if( strcmp( argv[i], "-desc" ) == 0 ) {
+            desc_doc_name = argv[++i];
+        } else if( strcmp( argv[i], "-webdir" ) == 0 ) {
+            web_dir_path = argv[++i];
+        } else if( strcmp( argv[i], "-help" ) == 0 ) {
+            SampleUtil_Print( "Usage: %s -ip ipaddress -port port"
+                              " -desc desc_doc_name -webdir web_dir_path"
+                              " -help (this message)\n", argv[0] );
+            SampleUtil_Print( "\tipaddress:     IP address of the device"
+                              " (must match desc. doc)\n" );
+            SampleUtil_Print( "\t\te.g.: 192.168.0.4\n" );
+            SampleUtil_Print( "\tport:          Port number to use for "
+                              "receiving UPnP messages (must match desc. doc)\n" );
+            SampleUtil_Print( "\t\te.g.: 5431\n" );
+            SampleUtil_Print
+                ( "\tdesc_doc_name: name of device description document\n" );
+            SampleUtil_Print( "\t\te.g.: tvdevicedesc.xml\n" );
+            SampleUtil_Print
+                ( "\tweb_dir_path: Filesystem path where web files "
+                  "related to the device are stored\n" );
+            SampleUtil_Print( "\t\te.g.: /upnp/sample/tvdevice/web\n" );
+            return 1;
+        }
+    }
+
+    port = ( unsigned short )portTemp;
+
+    NAS_DeviceStart( ip_address, port, desc_doc_name, web_dir_path, linux_print );
+    
+    //signal(SIGTERM, sig_handler);
+    //while(1){
+	//sleep(10);
+	//pause();
+    //}
+    /* start a command loop thread */
+    //code = ithread_create( &cmdloop_thread, NULL, NAS_DeviceCommandLoop, NULL );
+
+#ifndef WIN32
+    /*
+       Catch Ctrl-C and properly shutdown 
+     */
+    sigemptyset( &sigs_to_catch );
+    sigaddset( &sigs_to_catch, SIGINT );
+    sigwait( &sigs_to_catch, &sig );
+
+    SampleUtil_Print( "Shutting down on signal %d...\n", sig );
+#else
+	ithread_join(cmdloop_thread, NULL);
+#endif
+    rc = NAS_DeviceStop();
+    
+    return rc;
+}
+
diff -Naur libupnp-1.6.6/upnp/sample/nasdevice/upnp_nas_device.c libupnp-1.6.6-mod/upnp/sample/nasdevice/upnp_nas_device.c
--- libupnp-1.6.6/upnp/sample/nasdevice/upnp_nas_device.c	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample/nasdevice/upnp_nas_device.c	2010-04-29 08:50:32.000000000 +0800
@@ -0,0 +1,254 @@
+/*
+ * (c) 2010 Western Digital Technologies, Inc. All rights reserved.
+ */
+
+#include "upnp_nas_device.h"
+
+#define DEFAULT_WEB_DIR "./web"
+
+#define DESC_URL_SIZE 200
+
+/*
+   Device type for NAS device 
+ */
+char NAS_DeviceType[] = "urn:schemas-upnp-org:device:WdNAS:1";
+
+/*
+   The amount of time (in seconds) before advertisements
+   will expire 
+ */
+int default_advr_expire = 100;
+
+/*
+   Device handle supplied by UPnP SDK 
+ */
+UpnpDevice_Handle device_handle = -1;
+
+/*
+   Mutex for protecting the global state table data
+   in a multi-threaded, asynchronous environment.
+   All functions should lock this mutex before reading
+   or writing the state table data. 
+ */
+ithread_mutex_t NAS_DevMutex;
+
+
+/*
+ * currently, the NAS supports NO services
+ */
+
+/******************************************************************************
+ * NAS_DeviceStateTableInit
+ *
+ * Description: 
+ *       Initialize the device state table for 
+ * 	 this NAS Device, pulling identifier info
+ *       from the description Document.  Note that 
+ *       knowledge of the service description is
+ *       assumed.  State table variables and default
+ *       values are currently hardcoded in this file
+ *       rather than being read from service description
+ *       documents.
+ *
+ * Parameters:
+ *   DescDocURL -- The description document URL
+ *
+ *****************************************************************************/
+int
+NAS_DeviceStateTableInit( IN char *DescDocURL )
+{
+    IXML_Document *DescDoc = NULL;
+    int ret = UPNP_E_SUCCESS;
+    char *udn = NULL;
+
+    //Download description document
+    if( UpnpDownloadXmlDoc( DescDocURL, &DescDoc ) != UPNP_E_SUCCESS ) {
+        SampleUtil_Print( "NAS_DeviceStateTableInit -- Error Parsing %s\n",
+                          DescDocURL );
+        ret = UPNP_E_INVALID_DESC;
+        goto error_handler;
+    }
+
+    udn = SampleUtil_GetFirstDocumentItem( DescDoc, "UDN" );
+
+error_handler:
+
+    if( udn )
+        free( udn );
+    if( DescDoc )
+        ixmlDocument_free( DescDoc );
+
+    return ( ret );
+}
+
+/******************************************************************************
+ * NAS_DeviceCallbackEventHandler
+ *
+ * Description: 
+ *       The callback handler registered with the SDK while registering
+ *       root device.  Dispatches the request to the appropriate procedure
+ *       based on the value of EventType. The four requests handled by the 
+ *       device are: 
+ *                   1) Event Subscription requests.  
+ *                   2) Get Variable requests. 
+ *                   3) Action requests.
+ *
+ * Parameters:
+ *
+ *   EventType -- The type of callback event
+ *   Event -- Data structure containing event data
+ *   Cookie -- Optional data specified during callback registration
+ *
+ *****************************************************************************/
+int
+NAS_DeviceCallbackEventHandler( Upnp_EventType EventType,
+				void *Event,
+				void *Cookie )
+{
+
+    switch ( EventType ) {
+
+        default:
+            SampleUtil_Print
+                ( "Error in NAS_DeviceCallbackEventHandler: unknown event type %d\n",
+                  EventType );
+    }
+
+    /*
+       Print a summary of the event received 
+     */
+    SampleUtil_PrintEvent( EventType, Event );
+
+    return ( 0 );
+}
+
+/******************************************************************************
+ * NAS_DeviceStop
+ *
+ * Description: 
+ *       Stops the device. Uninitializes the sdk. 
+ *
+ * Parameters:
+ *
+ *****************************************************************************/
+int
+NAS_DeviceStop()
+{
+    UpnpUnRegisterRootDevice( device_handle );
+    UpnpFinish();
+    SampleUtil_Finish();
+    ithread_mutex_destroy( &NAS_DevMutex );
+    return UPNP_E_SUCCESS;
+}
+
+/******************************************************************************
+ * NAS_DeviceStart
+ *
+ * Description: 
+ *      Initializes the UPnP Sdk, registers the device, and sends out 
+ *      advertisements.  
+ *
+ * Parameters:
+ *
+ *   ip_address - ip address to initialize the sdk (may be NULL)
+ *                if null, then the first non null loopback address is used.
+ *   port       - port number to initialize the sdk (may be 0)
+ *                if zero, then a random number is used.
+ *   desc_doc_name - name of description document.
+ *                   may be NULL. Default is nasdevicedesc.xml
+ *   web_dir_path  - path of web directory.
+ *                   may be NULL. Default is ./web (for Linux) or ../nasdevice/web
+ *                   for windows.
+ *   pfun          - print function to use.  
+ *
+ *****************************************************************************/
+int
+NAS_DeviceStart( char *ip_address,
+               unsigned short port,
+               char *desc_doc_name,
+               char *web_dir_path,
+               print_string pfun )
+{
+    int ret = UPNP_E_SUCCESS;
+
+    char desc_doc_url[DESC_URL_SIZE];
+
+    ithread_mutex_init( &NAS_DevMutex, NULL );
+
+    SampleUtil_Initialize( pfun );
+
+    SampleUtil_Print(
+        "Initializing UPnP Sdk with\n"
+        "\tipaddress = %s port = %u\n",
+        ip_address, port );
+
+    if( ( ret = UpnpInit( ip_address, port ) ) != UPNP_E_SUCCESS ) {
+        SampleUtil_Print( "Error with UpnpInit -- %d\n", ret );
+        UpnpFinish();
+        return ret;
+    }
+
+    if( ip_address == NULL ) {
+        ip_address = UpnpGetServerIpAddress();
+    }
+
+    port = UpnpGetServerPort();
+
+    SampleUtil_Print(
+        "UPnP Initialized\n"
+	"\tipaddress= %s port = %u\n",
+        ip_address, port );
+
+    if( desc_doc_name == NULL ) {
+        desc_doc_name = "nasdevicedesc.xml";
+    }
+
+    if( web_dir_path == NULL ) {
+        web_dir_path = DEFAULT_WEB_DIR;
+    }
+
+    snprintf( desc_doc_url, DESC_URL_SIZE, "http://%s:%d/%s", ip_address,
+              port, desc_doc_name );
+
+    SampleUtil_Print( "Specifying the webserver root directory -- %s\n",
+                      web_dir_path );
+    if( ( ret =
+          UpnpSetWebServerRootDir( web_dir_path ) ) != UPNP_E_SUCCESS ) {
+        SampleUtil_Print
+            ( "Error specifying webserver root directory -- %s: %d\n",
+              web_dir_path, ret );
+        UpnpFinish();
+        return ret;
+    }
+
+    SampleUtil_Print(
+        "Registering the RootDevice\n"
+        "\t with desc_doc_url: %s\n",
+        desc_doc_url );
+
+    if( ( ret = UpnpRegisterRootDevice( desc_doc_url,
+                                        NAS_DeviceCallbackEventHandler,
+                                        &device_handle, &device_handle ) )
+        != UPNP_E_SUCCESS ) {
+        SampleUtil_Print( "Error registering the rootdevice : %d\n", ret );
+        UpnpFinish();
+        return ret;
+    } else {
+        SampleUtil_Print(
+            "RootDevice Registered\n"
+            "Initializing State Table\n");
+        NAS_DeviceStateTableInit( desc_doc_url );
+        SampleUtil_Print("State Table Initialized\n");
+
+        if( ( ret =
+              UpnpSendAdvertisement( device_handle, default_advr_expire ) )
+            != UPNP_E_SUCCESS ) {
+            SampleUtil_Print( "Error sending advertisements : %d\n", ret );
+            UpnpFinish();
+            return ret;
+        }
+
+        SampleUtil_Print("Advertisements Sent\n");
+    }
+    return UPNP_E_SUCCESS;
+}
diff -Naur libupnp-1.6.6/upnp/sample/nasdevice/upnp_nas_device.h libupnp-1.6.6-mod/upnp/sample/nasdevice/upnp_nas_device.h
--- libupnp-1.6.6/upnp/sample/nasdevice/upnp_nas_device.h	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample/nasdevice/upnp_nas_device.h	2010-04-29 08:51:55.000000000 +0800
@@ -0,0 +1,39 @@
+/*
+ * (c) 2010 Western Digital Technologies, Inc. All rights reserved.
+ */
+
+#ifndef UPNP_NAS_DEVICE_H
+#define UPNP_NAS_DEVICE_H
+
+#include <stdio.h>
+#include <signal.h>
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+
+#include "ithread.h"
+#include <stdlib.h>
+#ifndef WIN32
+#include <unistd.h>
+#endif
+#include <string.h>
+#include "upnp.h"
+#include "sample_util.h"
+
+
+/*
+ * currently, the NAS supports NO services
+ */
+
+int NAS_DeviceStart(char * ip_address, unsigned short port,char * desc_doc_name,
+		    char *web_dir_path, print_string pfun);
+
+int NAS_DeviceStop();
+
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif
diff -Naur libupnp-1.6.6/upnp/sample/nas-Makefile libupnp-1.6.6-mod/upnp/sample/nas-Makefile
--- libupnp-1.6.6/upnp/sample/nas-Makefile	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample/nas-Makefile	2010-04-30 06:31:00.000000000 +0800
@@ -0,0 +1,923 @@
+# Makefile.in generated by automake 1.9.6 from Makefile.am.
+# upnp/sample/Makefile.  Generated from Makefile.in by configure.
+
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004, 2005  Free Software Foundation, Inc.
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+
+
+#
+# "Makefile.am" for "libupnp/upnp/sample"
+#
+# Copyright (C) 2007 Marcelo Roberto Jimenez <mroberto@users.sourceforge.net>
+#
+
+
+srcdir = .
+top_srcdir = ../..
+
+pkgdatadir = $(datadir)/libupnp
+pkglibdir = $(libdir)/libupnp
+pkgincludedir = $(includedir)/libupnp
+top_builddir = ../..
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+INSTALL = /usr/bin/install -c
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+build_triplet = i386-pc-linux-gnu
+host_triplet = powerpc-unknown-linux-gnu
+noinst_PROGRAMS = $(am__EXEEXT_1) $(am__EXEEXT_2) $(am__EXEEXT_3)
+am__append_1 = upnp_tv_ctrlpt
+am__append_2 = upnp_tv_combo
+am__append_3 =  \
+	upnp_tv_device \
+	upnp_nas_device
+subdir = upnp/sample
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/m4/acx_pthread.m4 \
+	$(top_srcdir)/m4/ax_cflags_gcc_option.m4 \
+	$(top_srcdir)/m4/ax_cflags_warn_all.m4 \
+	$(top_srcdir)/m4/rt_bool_arg_enable.m4 \
+	$(top_srcdir)/m4/type_socklen_t.m4 $(top_srcdir)/configure.ac
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(install_sh) -d
+CONFIG_HEADER = $(top_builddir)/autoconfig.h \
+	$(top_builddir)/upnp/inc/upnpconfig.h
+CONFIG_CLEAN_FILES =
+am__EXEEXT_1 = upnp_tv_ctrlpt$(EXEEXT)
+am__EXEEXT_2 = upnp_tv_combo$(EXEEXT)
+am__EXEEXT_3 = upnp_tv_device$(EXEEXT) \
+	upnp_nas_device$(EXEEXT)
+PROGRAMS = $(noinst_PROGRAMS)
+am__dirstamp = $(am__leading_dot)dirstamp
+am_upnp_nas_device_OBJECTS =  \
+	common/upnp_nas_device-sample_util.$(OBJEXT) \
+	nasdevice/upnp_nas_device-upnp_nas_device.$(OBJEXT) \
+	nasdevice/linux/upnp_nas_device-upnp_nas_device_main.$(OBJEXT)
+upnp_nas_device_OBJECTS = $(am_upnp_nas_device_OBJECTS)
+upnp_nas_device_LDADD = $(LDADD)
+upnp_nas_device_DEPENDENCIES = $(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+am_upnp_tv_combo_OBJECTS = common/upnp_tv_combo-sample_util.$(OBJEXT) \
+	tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.$(OBJEXT) \
+	tvcombo/upnp_tv_combo-upnp_tv_device.$(OBJEXT) \
+	tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.$(OBJEXT)
+upnp_tv_combo_OBJECTS = $(am_upnp_tv_combo_OBJECTS)
+upnp_tv_combo_LDADD = $(LDADD)
+upnp_tv_combo_DEPENDENCIES = $(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+am_upnp_tv_ctrlpt_OBJECTS =  \
+	common/upnp_tv_ctrlpt-sample_util.$(OBJEXT) \
+	tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.$(OBJEXT) \
+	tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.$(OBJEXT)
+upnp_tv_ctrlpt_OBJECTS = $(am_upnp_tv_ctrlpt_OBJECTS)
+upnp_tv_ctrlpt_LDADD = $(LDADD)
+upnp_tv_ctrlpt_DEPENDENCIES = $(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+am_upnp_tv_device_OBJECTS =  \
+	common/upnp_tv_device-sample_util.$(OBJEXT) \
+	tvdevice/upnp_tv_device-upnp_tv_device.$(OBJEXT) \
+	tvdevice/linux/upnp_tv_device-upnp_tv_device_main.$(OBJEXT)
+upnp_tv_device_OBJECTS = $(am_upnp_tv_device_OBJECTS)
+upnp_tv_device_LDADD = $(LDADD)
+upnp_tv_device_DEPENDENCIES = $(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir) -I$(top_builddir)/upnp/inc
+depcomp = $(SHELL) $(top_srcdir)/build-aux/depcomp
+am__depfiles_maybe = depfiles
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+LTCOMPILE = $(LIBTOOL) --tag=CC --mode=compile $(CC) $(DEFS) \
+	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
+	$(AM_CFLAGS) $(CFLAGS)
+CCLD = $(CC)
+LINK = $(LIBTOOL) --tag=CC --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(AM_LDFLAGS) $(LDFLAGS) -o $@
+SOURCES = $(upnp_nas_device_SOURCES) $(upnp_tv_combo_SOURCES) \
+	$(upnp_tv_ctrlpt_SOURCES) $(upnp_tv_device_SOURCES)
+DIST_SOURCES = $(upnp_nas_device_SOURCES) $(upnp_tv_combo_SOURCES) \
+	$(upnp_tv_ctrlpt_SOURCES) $(upnp_tv_device_SOURCES)
+am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
+am__vpath_adj = case $$p in \
+    $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
+    *) f=$$p;; \
+  esac;
+am__strip_dir = `echo $$p | sed -e 's|^.*/||'`;
+am__installdirs = "$(DESTDIR)$(examplesdir)"
+examplesDATA_INSTALL = $(INSTALL_DATA)
+DATA = $(examples_DATA)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = ${SHELL} /home/taylor_da/libupnp-1.6.6/build-aux/missing --run aclocal-1.9
+AMDEP_FALSE = #
+AMDEP_TRUE = 
+AMTAR = ${SHELL} /home/taylor_da/libupnp-1.6.6/build-aux/missing --run tar
+AR = ar
+AUTOCONF = ${SHELL} /home/taylor_da/libupnp-1.6.6/build-aux/missing --run autoconf
+AUTOHEADER = ${SHELL} /home/taylor_da/libupnp-1.6.6/build-aux/missing --run autoheader
+AUTOMAKE = ${SHELL} /home/taylor_da/libupnp-1.6.6/build-aux/missing --run automake-1.9
+AWK = gawk
+CC = gcc
+CCDEPMODE = depmode=gcc3
+CFLAGS = -pthread -g -O2 -Os -Wall
+CPP = gcc -E
+CPPFLAGS = 
+CXX = g++
+CXXCPP = g++ -E
+CXXDEPMODE = depmode=gcc3
+CXXFLAGS = -g -O2
+CYGPATH_W = echo
+DEFS = -DHAVE_CONFIG_H
+DEPDIR = .deps
+ECHO = echo
+ECHO_C = 
+ECHO_N = -n
+ECHO_T = 
+EGREP = /bin/grep -E
+ENABLE_CLIENT_FALSE = #
+ENABLE_CLIENT_TRUE = 
+ENABLE_DEBUG_FALSE = 
+ENABLE_DEBUG_TRUE = #
+ENABLE_DEVICE_FALSE = #
+ENABLE_DEVICE_TRUE = 
+ENABLE_SAMPLES_FALSE = #
+ENABLE_SAMPLES_TRUE = 
+ENABLE_TOOLS_FALSE = #
+ENABLE_TOOLS_TRUE = 
+ENABLE_WEBSERVER_FALSE = #
+ENABLE_WEBSERVER_TRUE = 
+EXEEXT = 
+F77 = 
+FFLAGS = 
+GREP = /bin/grep
+INSTALL_DATA = ${INSTALL} -m 644
+INSTALL_PROGRAM = ${INSTALL}
+INSTALL_SCRIPT = ${INSTALL}
+INSTALL_STRIP_PROGRAM = ${SHELL} $(install_sh) -c -s
+LDFLAGS = 
+LIBOBJS = 
+LIBS =  
+LIBTOOL = $(SHELL) $(top_builddir)/libtool
+LN_S = ln -s
+LTLIBOBJS = 
+LT_VERSION_IXML = 2:4:0
+LT_VERSION_THREADUTIL = 4:3:2
+LT_VERSION_UPNP = 3:5:0
+MAKEINFO = ${SHELL} /home/taylor_da/libupnp-1.6.6/build-aux/missing --run makeinfo
+OBJEXT = o
+PACKAGE = libupnp
+PACKAGE_BUGREPORT = mroberto@users.sourceforge.net
+PACKAGE_NAME = libupnp
+PACKAGE_STRING = libupnp 1.6.6
+PACKAGE_TARNAME = libupnp
+PACKAGE_URL = @PACKAGE_URL@
+PACKAGE_VERSION = 1.6.6
+PATH_SEPARATOR = :
+PTHREAD_CC = gcc
+PTHREAD_CFLAGS = -pthread
+PTHREAD_LIBS = 
+RANLIB = ranlib
+SET_MAKE = 
+SHELL = /bin/sh
+STRIP = strip
+VERSION = 1.6.6
+WITH_DOCUMENTATION_FALSE = 
+WITH_DOCUMENTATION_TRUE = #
+ac_ct_CC = gcc
+ac_ct_CXX = g++
+ac_ct_F77 = 
+acx_pthread_config = 
+am__fastdepCC_FALSE = #
+am__fastdepCC_TRUE = 
+am__fastdepCXX_FALSE = #
+am__fastdepCXX_TRUE = 
+am__include = include
+am__leading_dot = .
+am__quote = 
+am__tar = ${AMTAR} chof - "$$tardir"
+am__untar = ${AMTAR} xf -
+bindir = ${exec_prefix}/bin
+build = i386-pc-linux-gnu
+build_alias = i386-pc-linux-gnu
+build_cpu = i386
+build_os = linux-gnu
+build_vendor = pc
+datadir = ${datarootdir}
+datarootdir = ${prefix}/share
+docdir = ${datarootdir}/doc/libupnp-1.6.6
+dvidir = ${docdir}
+exec_prefix = /usr
+host = powerpc-unknown-linux-gnu
+host_alias = ppc-linux
+host_cpu = powerpc
+host_os = linux-gnu
+host_vendor = unknown
+htmldir = ${docdir}
+includedir = ${prefix}/include
+infodir = ${datarootdir}/info
+install_sh = /home/taylor_da/libupnp-1.6.6/build-aux/install-sh
+libdir = ${exec_prefix}/lib
+libexecdir = ${exec_prefix}/libexec
+localedir = ${datarootdir}/locale
+localstatedir = ${prefix}/var
+mandir = ${datarootdir}/man
+mkdir_p = mkdir -p --
+oldincludedir = /usr/include
+pdfdir = ${docdir}
+prefix = /usr
+program_transform_name = s,x,x,
+psdir = ${docdir}
+sbindir = ${exec_prefix}/sbin
+sharedstatedir = ${prefix}/com
+sysconfdir = /etc
+target_alias = ppc-linux
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/upnp/inc \
+	-I$(top_srcdir)/threadutil/inc \
+	-I$(top_srcdir)/ixml/inc
+
+LDADD = \
+	$(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+
+upnp_tv_ctrlpt_CPPFLAGS = \
+	$(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/tvctrlpt
+
+upnp_tv_combo_CPPFLAGS = $(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/tvcombo
+
+upnp_tv_device_CPPFLAGS = \
+	$(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/tvdevice
+
+upnp_nas_device_CPPFLAGS = \
+	$(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/nasdevice
+
+upnp_tv_device_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvdevice/upnp_tv_device.c \
+	tvdevice/upnp_tv_device.h \
+	tvdevice/linux/upnp_tv_device_main.c
+
+upnp_tv_ctrlpt_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvctrlpt/upnp_tv_ctrlpt.c \
+	tvctrlpt/upnp_tv_ctrlpt.h \
+	tvctrlpt/linux/upnp_tv_ctrlpt_main.c
+
+upnp_tv_combo_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvcombo/upnp_tv_ctrlpt.c \
+	tvcombo/upnp_tv_ctrlpt.h \
+	tvcombo/upnp_tv_device.c \
+	tvcombo/upnp_tv_device.h \
+	tvcombo/linux/upnp_tv_combo_main.c
+
+upnp_nas_device_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	nasdevice/upnp_nas_device.c \
+	nasdevice/upnp_nas_device.h \
+	nasdevice/linux/upnp_nas_device_main.c
+
+#examplesdir = $(docdir)/examples
+#examples_DATA = \
+#		$(upnp_tv_ctrlpt_SOURCES) \
+#		$(upnp_tv_device_SOURCES)
+
+EXTRA_DIST = \
+	web/tvcombodesc.xml \
+	web/tvcontrolSCPD.xml \
+	web/tvdevicedesc.xml \
+	web/tvdevicepres.html \
+	web/tvpictureSCPD.xml
+
+all: all-am
+
+.SUFFIXES:
+.SUFFIXES: .c .lo .o .obj
+$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --foreign  upnp/sample/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --foreign  upnp/sample/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure:  $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+clean-noinstPROGRAMS:
+	@list='$(noinst_PROGRAMS)'; for p in $$list; do \
+	  f=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
+	  echo " rm -f $$p $$f"; \
+	  rm -f $$p $$f ; \
+	done
+common/$(am__dirstamp):
+	@$(mkdir_p) common
+	@: > common/$(am__dirstamp)
+common/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) common/$(DEPDIR)
+	@: > common/$(DEPDIR)/$(am__dirstamp)
+common/upnp_nas_device-sample_util.$(OBJEXT): common/$(am__dirstamp) \
+	common/$(DEPDIR)/$(am__dirstamp)
+nasdevice/$(am__dirstamp):
+	@$(mkdir_p) nasdevice
+	@: > nasdevice/$(am__dirstamp)
+nasdevice/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) nasdevice/$(DEPDIR)
+	@: > nasdevice/$(DEPDIR)/$(am__dirstamp)
+nasdevice/upnp_nas_device-upnp_nas_device.$(OBJEXT):  \
+	nasdevice/$(am__dirstamp) nasdevice/$(DEPDIR)/$(am__dirstamp)
+nasdevice/linux/$(am__dirstamp):
+	@$(mkdir_p) nasdevice/linux
+	@: > nasdevice/linux/$(am__dirstamp)
+nasdevice/linux/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) nasdevice/linux/$(DEPDIR)
+	@: > nasdevice/linux/$(DEPDIR)/$(am__dirstamp)
+nasdevice/linux/upnp_nas_device-upnp_nas_device_main.$(OBJEXT):  \
+	nasdevice/linux/$(am__dirstamp) \
+	nasdevice/linux/$(DEPDIR)/$(am__dirstamp)
+upnp_nas_device$(EXEEXT): $(upnp_nas_device_OBJECTS) $(upnp_nas_device_DEPENDENCIES) 
+	@rm -f upnp_nas_device$(EXEEXT)
+	$(LINK) $(upnp_nas_device_LDFLAGS) $(upnp_nas_device_OBJECTS) $(upnp_nas_device_LDADD) $(LIBS)
+common/upnp_tv_combo-sample_util.$(OBJEXT): common/$(am__dirstamp) \
+	common/$(DEPDIR)/$(am__dirstamp)
+tvcombo/$(am__dirstamp):
+	@$(mkdir_p) tvcombo
+	@: > tvcombo/$(am__dirstamp)
+tvcombo/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvcombo/$(DEPDIR)
+	@: > tvcombo/$(DEPDIR)/$(am__dirstamp)
+tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.$(OBJEXT):  \
+	tvcombo/$(am__dirstamp) tvcombo/$(DEPDIR)/$(am__dirstamp)
+tvcombo/upnp_tv_combo-upnp_tv_device.$(OBJEXT):  \
+	tvcombo/$(am__dirstamp) tvcombo/$(DEPDIR)/$(am__dirstamp)
+tvcombo/linux/$(am__dirstamp):
+	@$(mkdir_p) tvcombo/linux
+	@: > tvcombo/linux/$(am__dirstamp)
+tvcombo/linux/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvcombo/linux/$(DEPDIR)
+	@: > tvcombo/linux/$(DEPDIR)/$(am__dirstamp)
+tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.$(OBJEXT):  \
+	tvcombo/linux/$(am__dirstamp) \
+	tvcombo/linux/$(DEPDIR)/$(am__dirstamp)
+upnp_tv_combo$(EXEEXT): $(upnp_tv_combo_OBJECTS) $(upnp_tv_combo_DEPENDENCIES) 
+	@rm -f upnp_tv_combo$(EXEEXT)
+	$(LINK) $(upnp_tv_combo_LDFLAGS) $(upnp_tv_combo_OBJECTS) $(upnp_tv_combo_LDADD) $(LIBS)
+common/upnp_tv_ctrlpt-sample_util.$(OBJEXT): common/$(am__dirstamp) \
+	common/$(DEPDIR)/$(am__dirstamp)
+tvctrlpt/$(am__dirstamp):
+	@$(mkdir_p) tvctrlpt
+	@: > tvctrlpt/$(am__dirstamp)
+tvctrlpt/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvctrlpt/$(DEPDIR)
+	@: > tvctrlpt/$(DEPDIR)/$(am__dirstamp)
+tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.$(OBJEXT):  \
+	tvctrlpt/$(am__dirstamp) tvctrlpt/$(DEPDIR)/$(am__dirstamp)
+tvctrlpt/linux/$(am__dirstamp):
+	@$(mkdir_p) tvctrlpt/linux
+	@: > tvctrlpt/linux/$(am__dirstamp)
+tvctrlpt/linux/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvctrlpt/linux/$(DEPDIR)
+	@: > tvctrlpt/linux/$(DEPDIR)/$(am__dirstamp)
+tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.$(OBJEXT):  \
+	tvctrlpt/linux/$(am__dirstamp) \
+	tvctrlpt/linux/$(DEPDIR)/$(am__dirstamp)
+upnp_tv_ctrlpt$(EXEEXT): $(upnp_tv_ctrlpt_OBJECTS) $(upnp_tv_ctrlpt_DEPENDENCIES) 
+	@rm -f upnp_tv_ctrlpt$(EXEEXT)
+	$(LINK) $(upnp_tv_ctrlpt_LDFLAGS) $(upnp_tv_ctrlpt_OBJECTS) $(upnp_tv_ctrlpt_LDADD) $(LIBS)
+common/upnp_tv_device-sample_util.$(OBJEXT): common/$(am__dirstamp) \
+	common/$(DEPDIR)/$(am__dirstamp)
+tvdevice/$(am__dirstamp):
+	@$(mkdir_p) tvdevice
+	@: > tvdevice/$(am__dirstamp)
+tvdevice/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvdevice/$(DEPDIR)
+	@: > tvdevice/$(DEPDIR)/$(am__dirstamp)
+tvdevice/upnp_tv_device-upnp_tv_device.$(OBJEXT):  \
+	tvdevice/$(am__dirstamp) tvdevice/$(DEPDIR)/$(am__dirstamp)
+tvdevice/linux/$(am__dirstamp):
+	@$(mkdir_p) tvdevice/linux
+	@: > tvdevice/linux/$(am__dirstamp)
+tvdevice/linux/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvdevice/linux/$(DEPDIR)
+	@: > tvdevice/linux/$(DEPDIR)/$(am__dirstamp)
+tvdevice/linux/upnp_tv_device-upnp_tv_device_main.$(OBJEXT):  \
+	tvdevice/linux/$(am__dirstamp) \
+	tvdevice/linux/$(DEPDIR)/$(am__dirstamp)
+upnp_tv_device$(EXEEXT): $(upnp_tv_device_OBJECTS) $(upnp_tv_device_DEPENDENCIES) 
+	@rm -f upnp_tv_device$(EXEEXT)
+	$(LINK) $(upnp_tv_device_LDFLAGS) $(upnp_tv_device_OBJECTS) $(upnp_tv_device_LDADD) $(LIBS)
+
+mostlyclean-compile:
+	-rm -f *.$(OBJEXT)
+	-rm -f common/upnp_nas_device-sample_util.$(OBJEXT)
+	-rm -f common/upnp_tv_combo-sample_util.$(OBJEXT)
+	-rm -f common/upnp_tv_ctrlpt-sample_util.$(OBJEXT)
+	-rm -f common/upnp_tv_device-sample_util.$(OBJEXT)
+	-rm -f nasdevice/linux/upnp_nas_device-upnp_nas_device_main.$(OBJEXT)
+	-rm -f nasdevice/upnp_nas_device-upnp_nas_device.$(OBJEXT)
+	-rm -f tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.$(OBJEXT)
+	-rm -f tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.$(OBJEXT)
+	-rm -f tvcombo/upnp_tv_combo-upnp_tv_device.$(OBJEXT)
+	-rm -f tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.$(OBJEXT)
+	-rm -f tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.$(OBJEXT)
+	-rm -f tvdevice/linux/upnp_tv_device-upnp_tv_device_main.$(OBJEXT)
+	-rm -f tvdevice/upnp_tv_device-upnp_tv_device.$(OBJEXT)
+
+distclean-compile:
+	-rm -f *.tab.c
+
+include common/$(DEPDIR)/upnp_nas_device-sample_util.Po
+include common/$(DEPDIR)/upnp_tv_combo-sample_util.Po
+include common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Po
+include common/$(DEPDIR)/upnp_tv_device-sample_util.Po
+include nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Po
+include nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Po
+include tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Po
+include tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Po
+include tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Po
+include tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Po
+include tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Po
+include tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Po
+include tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Po
+
+.c.o:
+	depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.o$$||'`; \
+	if $(COMPILE) -MT $@ -MD -MP -MF "$$depbase.Tpo" -c -o $@ $<; \
+	then mv -f "$$depbase.Tpo" "$$depbase.Po"; else rm -f "$$depbase.Tpo"; exit 1; fi
+#	source='$<' object='$@' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(COMPILE) -c -o $@ $<
+
+.c.obj:
+	depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.obj$$||'`; \
+	if $(COMPILE) -MT $@ -MD -MP -MF "$$depbase.Tpo" -c -o $@ `$(CYGPATH_W) '$<'`; \
+	then mv -f "$$depbase.Tpo" "$$depbase.Po"; else rm -f "$$depbase.Tpo"; exit 1; fi
+#	source='$<' object='$@' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(COMPILE) -c -o $@ `$(CYGPATH_W) '$<'`
+
+.c.lo:
+	depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.lo$$||'`; \
+	if $(LTCOMPILE) -MT $@ -MD -MP -MF "$$depbase.Tpo" -c -o $@ $<; \
+	then mv -f "$$depbase.Tpo" "$$depbase.Plo"; else rm -f "$$depbase.Tpo"; exit 1; fi
+#	source='$<' object='$@' libtool=yes \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(LTCOMPILE) -c -o $@ $<
+
+common/upnp_nas_device-sample_util.o: common/sample_util.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_nas_device-sample_util.o -MD -MP -MF "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo" -c -o common/upnp_nas_device-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c; \
+	then mv -f "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo" "common/$(DEPDIR)/upnp_nas_device-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo"; exit 1; fi
+#	source='common/sample_util.c' object='common/upnp_nas_device-sample_util.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_nas_device-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c
+
+common/upnp_nas_device-sample_util.obj: common/sample_util.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_nas_device-sample_util.obj -MD -MP -MF "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo" -c -o common/upnp_nas_device-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`; \
+	then mv -f "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo" "common/$(DEPDIR)/upnp_nas_device-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_nas_device-sample_util.Tpo"; exit 1; fi
+#	source='common/sample_util.c' object='common/upnp_nas_device-sample_util.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_nas_device-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`
+
+nasdevice/upnp_nas_device-upnp_nas_device.o: nasdevice/upnp_nas_device.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT nasdevice/upnp_nas_device-upnp_nas_device.o -MD -MP -MF "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo" -c -o nasdevice/upnp_nas_device-upnp_nas_device.o `test -f 'nasdevice/upnp_nas_device.c' || echo '$(srcdir)/'`nasdevice/upnp_nas_device.c; \
+	then mv -f "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo" "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Po"; else rm -f "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo"; exit 1; fi
+#	source='nasdevice/upnp_nas_device.c' object='nasdevice/upnp_nas_device-upnp_nas_device.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o nasdevice/upnp_nas_device-upnp_nas_device.o `test -f 'nasdevice/upnp_nas_device.c' || echo '$(srcdir)/'`nasdevice/upnp_nas_device.c
+
+nasdevice/upnp_nas_device-upnp_nas_device.obj: nasdevice/upnp_nas_device.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT nasdevice/upnp_nas_device-upnp_nas_device.obj -MD -MP -MF "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo" -c -o nasdevice/upnp_nas_device-upnp_nas_device.obj `if test -f 'nasdevice/upnp_nas_device.c'; then $(CYGPATH_W) 'nasdevice/upnp_nas_device.c'; else $(CYGPATH_W) '$(srcdir)/nasdevice/upnp_nas_device.c'; fi`; \
+	then mv -f "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo" "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Po"; else rm -f "nasdevice/$(DEPDIR)/upnp_nas_device-upnp_nas_device.Tpo"; exit 1; fi
+#	source='nasdevice/upnp_nas_device.c' object='nasdevice/upnp_nas_device-upnp_nas_device.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o nasdevice/upnp_nas_device-upnp_nas_device.obj `if test -f 'nasdevice/upnp_nas_device.c'; then $(CYGPATH_W) 'nasdevice/upnp_nas_device.c'; else $(CYGPATH_W) '$(srcdir)/nasdevice/upnp_nas_device.c'; fi`
+
+nasdevice/linux/upnp_nas_device-upnp_nas_device_main.o: nasdevice/linux/upnp_nas_device_main.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT nasdevice/linux/upnp_nas_device-upnp_nas_device_main.o -MD -MP -MF "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo" -c -o nasdevice/linux/upnp_nas_device-upnp_nas_device_main.o `test -f 'nasdevice/linux/upnp_nas_device_main.c' || echo '$(srcdir)/'`nasdevice/linux/upnp_nas_device_main.c; \
+	then mv -f "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo" "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Po"; else rm -f "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo"; exit 1; fi
+#	source='nasdevice/linux/upnp_nas_device_main.c' object='nasdevice/linux/upnp_nas_device-upnp_nas_device_main.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o nasdevice/linux/upnp_nas_device-upnp_nas_device_main.o `test -f 'nasdevice/linux/upnp_nas_device_main.c' || echo '$(srcdir)/'`nasdevice/linux/upnp_nas_device_main.c
+
+nasdevice/linux/upnp_nas_device-upnp_nas_device_main.obj: nasdevice/linux/upnp_nas_device_main.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT nasdevice/linux/upnp_nas_device-upnp_nas_device_main.obj -MD -MP -MF "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo" -c -o nasdevice/linux/upnp_nas_device-upnp_nas_device_main.obj `if test -f 'nasdevice/linux/upnp_nas_device_main.c'; then $(CYGPATH_W) 'nasdevice/linux/upnp_nas_device_main.c'; else $(CYGPATH_W) '$(srcdir)/nasdevice/linux/upnp_nas_device_main.c'; fi`; \
+	then mv -f "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo" "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Po"; else rm -f "nasdevice/linux/$(DEPDIR)/upnp_nas_device-upnp_nas_device_main.Tpo"; exit 1; fi
+#	source='nasdevice/linux/upnp_nas_device_main.c' object='nasdevice/linux/upnp_nas_device-upnp_nas_device_main.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_nas_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o nasdevice/linux/upnp_nas_device-upnp_nas_device_main.obj `if test -f 'nasdevice/linux/upnp_nas_device_main.c'; then $(CYGPATH_W) 'nasdevice/linux/upnp_nas_device_main.c'; else $(CYGPATH_W) '$(srcdir)/nasdevice/linux/upnp_nas_device_main.c'; fi`
+
+common/upnp_tv_combo-sample_util.o: common/sample_util.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_combo-sample_util.o -MD -MP -MF "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo" -c -o common/upnp_tv_combo-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c; \
+	then mv -f "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_combo-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo"; exit 1; fi
+#	source='common/sample_util.c' object='common/upnp_tv_combo-sample_util.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_combo-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c
+
+common/upnp_tv_combo-sample_util.obj: common/sample_util.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_combo-sample_util.obj -MD -MP -MF "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo" -c -o common/upnp_tv_combo-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`; \
+	then mv -f "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_combo-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo"; exit 1; fi
+#	source='common/sample_util.c' object='common/upnp_tv_combo-sample_util.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_combo-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`
+
+tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o: tvcombo/upnp_tv_ctrlpt.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o -MD -MP -MF "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo" -c -o tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o `test -f 'tvcombo/upnp_tv_ctrlpt.c' || echo '$(srcdir)/'`tvcombo/upnp_tv_ctrlpt.c; \
+	then mv -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo" "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Po"; else rm -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo"; exit 1; fi
+#	source='tvcombo/upnp_tv_ctrlpt.c' object='tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o `test -f 'tvcombo/upnp_tv_ctrlpt.c' || echo '$(srcdir)/'`tvcombo/upnp_tv_ctrlpt.c
+
+tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.obj: tvcombo/upnp_tv_ctrlpt.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.obj -MD -MP -MF "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo" -c -o tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.obj `if test -f 'tvcombo/upnp_tv_ctrlpt.c'; then $(CYGPATH_W) 'tvcombo/upnp_tv_ctrlpt.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/upnp_tv_ctrlpt.c'; fi`; \
+	then mv -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo" "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Po"; else rm -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo"; exit 1; fi
+#	source='tvcombo/upnp_tv_ctrlpt.c' object='tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.obj `if test -f 'tvcombo/upnp_tv_ctrlpt.c'; then $(CYGPATH_W) 'tvcombo/upnp_tv_ctrlpt.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/upnp_tv_ctrlpt.c'; fi`
+
+tvcombo/upnp_tv_combo-upnp_tv_device.o: tvcombo/upnp_tv_device.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/upnp_tv_combo-upnp_tv_device.o -MD -MP -MF "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo" -c -o tvcombo/upnp_tv_combo-upnp_tv_device.o `test -f 'tvcombo/upnp_tv_device.c' || echo '$(srcdir)/'`tvcombo/upnp_tv_device.c; \
+	then mv -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo" "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Po"; else rm -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo"; exit 1; fi
+#	source='tvcombo/upnp_tv_device.c' object='tvcombo/upnp_tv_combo-upnp_tv_device.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/upnp_tv_combo-upnp_tv_device.o `test -f 'tvcombo/upnp_tv_device.c' || echo '$(srcdir)/'`tvcombo/upnp_tv_device.c
+
+tvcombo/upnp_tv_combo-upnp_tv_device.obj: tvcombo/upnp_tv_device.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/upnp_tv_combo-upnp_tv_device.obj -MD -MP -MF "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo" -c -o tvcombo/upnp_tv_combo-upnp_tv_device.obj `if test -f 'tvcombo/upnp_tv_device.c'; then $(CYGPATH_W) 'tvcombo/upnp_tv_device.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/upnp_tv_device.c'; fi`; \
+	then mv -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo" "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Po"; else rm -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo"; exit 1; fi
+#	source='tvcombo/upnp_tv_device.c' object='tvcombo/upnp_tv_combo-upnp_tv_device.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/upnp_tv_combo-upnp_tv_device.obj `if test -f 'tvcombo/upnp_tv_device.c'; then $(CYGPATH_W) 'tvcombo/upnp_tv_device.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/upnp_tv_device.c'; fi`
+
+tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o: tvcombo/linux/upnp_tv_combo_main.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o -MD -MP -MF "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo" -c -o tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o `test -f 'tvcombo/linux/upnp_tv_combo_main.c' || echo '$(srcdir)/'`tvcombo/linux/upnp_tv_combo_main.c; \
+	then mv -f "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo" "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Po"; else rm -f "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo"; exit 1; fi
+#	source='tvcombo/linux/upnp_tv_combo_main.c' object='tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o `test -f 'tvcombo/linux/upnp_tv_combo_main.c' || echo '$(srcdir)/'`tvcombo/linux/upnp_tv_combo_main.c
+
+tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.obj: tvcombo/linux/upnp_tv_combo_main.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.obj -MD -MP -MF "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo" -c -o tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.obj `if test -f 'tvcombo/linux/upnp_tv_combo_main.c'; then $(CYGPATH_W) 'tvcombo/linux/upnp_tv_combo_main.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/linux/upnp_tv_combo_main.c'; fi`; \
+	then mv -f "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo" "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Po"; else rm -f "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo"; exit 1; fi
+#	source='tvcombo/linux/upnp_tv_combo_main.c' object='tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.obj `if test -f 'tvcombo/linux/upnp_tv_combo_main.c'; then $(CYGPATH_W) 'tvcombo/linux/upnp_tv_combo_main.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/linux/upnp_tv_combo_main.c'; fi`
+
+common/upnp_tv_ctrlpt-sample_util.o: common/sample_util.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_ctrlpt-sample_util.o -MD -MP -MF "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo" -c -o common/upnp_tv_ctrlpt-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c; \
+	then mv -f "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo"; exit 1; fi
+#	source='common/sample_util.c' object='common/upnp_tv_ctrlpt-sample_util.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_ctrlpt-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c
+
+common/upnp_tv_ctrlpt-sample_util.obj: common/sample_util.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_ctrlpt-sample_util.obj -MD -MP -MF "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo" -c -o common/upnp_tv_ctrlpt-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`; \
+	then mv -f "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo"; exit 1; fi
+#	source='common/sample_util.c' object='common/upnp_tv_ctrlpt-sample_util.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_ctrlpt-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`
+
+tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o: tvctrlpt/upnp_tv_ctrlpt.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o -MD -MP -MF "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo" -c -o tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o `test -f 'tvctrlpt/upnp_tv_ctrlpt.c' || echo '$(srcdir)/'`tvctrlpt/upnp_tv_ctrlpt.c; \
+	then mv -f "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo" "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Po"; else rm -f "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo"; exit 1; fi
+#	source='tvctrlpt/upnp_tv_ctrlpt.c' object='tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o `test -f 'tvctrlpt/upnp_tv_ctrlpt.c' || echo '$(srcdir)/'`tvctrlpt/upnp_tv_ctrlpt.c
+
+tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.obj: tvctrlpt/upnp_tv_ctrlpt.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.obj -MD -MP -MF "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo" -c -o tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.obj `if test -f 'tvctrlpt/upnp_tv_ctrlpt.c'; then $(CYGPATH_W) 'tvctrlpt/upnp_tv_ctrlpt.c'; else $(CYGPATH_W) '$(srcdir)/tvctrlpt/upnp_tv_ctrlpt.c'; fi`; \
+	then mv -f "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo" "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Po"; else rm -f "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo"; exit 1; fi
+#	source='tvctrlpt/upnp_tv_ctrlpt.c' object='tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.obj `if test -f 'tvctrlpt/upnp_tv_ctrlpt.c'; then $(CYGPATH_W) 'tvctrlpt/upnp_tv_ctrlpt.c'; else $(CYGPATH_W) '$(srcdir)/tvctrlpt/upnp_tv_ctrlpt.c'; fi`
+
+tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o: tvctrlpt/linux/upnp_tv_ctrlpt_main.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o -MD -MP -MF "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo" -c -o tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o `test -f 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c' || echo '$(srcdir)/'`tvctrlpt/linux/upnp_tv_ctrlpt_main.c; \
+	then mv -f "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo" "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Po"; else rm -f "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo"; exit 1; fi
+#	source='tvctrlpt/linux/upnp_tv_ctrlpt_main.c' object='tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o `test -f 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c' || echo '$(srcdir)/'`tvctrlpt/linux/upnp_tv_ctrlpt_main.c
+
+tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.obj: tvctrlpt/linux/upnp_tv_ctrlpt_main.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.obj -MD -MP -MF "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo" -c -o tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.obj `if test -f 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; then $(CYGPATH_W) 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; else $(CYGPATH_W) '$(srcdir)/tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; fi`; \
+	then mv -f "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo" "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Po"; else rm -f "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo"; exit 1; fi
+#	source='tvctrlpt/linux/upnp_tv_ctrlpt_main.c' object='tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.obj `if test -f 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; then $(CYGPATH_W) 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; else $(CYGPATH_W) '$(srcdir)/tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; fi`
+
+common/upnp_tv_device-sample_util.o: common/sample_util.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_device-sample_util.o -MD -MP -MF "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo" -c -o common/upnp_tv_device-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c; \
+	then mv -f "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_device-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo"; exit 1; fi
+#	source='common/sample_util.c' object='common/upnp_tv_device-sample_util.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_device-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c
+
+common/upnp_tv_device-sample_util.obj: common/sample_util.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_device-sample_util.obj -MD -MP -MF "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo" -c -o common/upnp_tv_device-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`; \
+	then mv -f "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_device-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo"; exit 1; fi
+#	source='common/sample_util.c' object='common/upnp_tv_device-sample_util.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_device-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`
+
+tvdevice/upnp_tv_device-upnp_tv_device.o: tvdevice/upnp_tv_device.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvdevice/upnp_tv_device-upnp_tv_device.o -MD -MP -MF "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo" -c -o tvdevice/upnp_tv_device-upnp_tv_device.o `test -f 'tvdevice/upnp_tv_device.c' || echo '$(srcdir)/'`tvdevice/upnp_tv_device.c; \
+	then mv -f "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo" "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Po"; else rm -f "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo"; exit 1; fi
+#	source='tvdevice/upnp_tv_device.c' object='tvdevice/upnp_tv_device-upnp_tv_device.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvdevice/upnp_tv_device-upnp_tv_device.o `test -f 'tvdevice/upnp_tv_device.c' || echo '$(srcdir)/'`tvdevice/upnp_tv_device.c
+
+tvdevice/upnp_tv_device-upnp_tv_device.obj: tvdevice/upnp_tv_device.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvdevice/upnp_tv_device-upnp_tv_device.obj -MD -MP -MF "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo" -c -o tvdevice/upnp_tv_device-upnp_tv_device.obj `if test -f 'tvdevice/upnp_tv_device.c'; then $(CYGPATH_W) 'tvdevice/upnp_tv_device.c'; else $(CYGPATH_W) '$(srcdir)/tvdevice/upnp_tv_device.c'; fi`; \
+	then mv -f "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo" "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Po"; else rm -f "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo"; exit 1; fi
+#	source='tvdevice/upnp_tv_device.c' object='tvdevice/upnp_tv_device-upnp_tv_device.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvdevice/upnp_tv_device-upnp_tv_device.obj `if test -f 'tvdevice/upnp_tv_device.c'; then $(CYGPATH_W) 'tvdevice/upnp_tv_device.c'; else $(CYGPATH_W) '$(srcdir)/tvdevice/upnp_tv_device.c'; fi`
+
+tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o: tvdevice/linux/upnp_tv_device_main.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o -MD -MP -MF "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo" -c -o tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o `test -f 'tvdevice/linux/upnp_tv_device_main.c' || echo '$(srcdir)/'`tvdevice/linux/upnp_tv_device_main.c; \
+	then mv -f "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo" "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Po"; else rm -f "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo"; exit 1; fi
+#	source='tvdevice/linux/upnp_tv_device_main.c' object='tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o `test -f 'tvdevice/linux/upnp_tv_device_main.c' || echo '$(srcdir)/'`tvdevice/linux/upnp_tv_device_main.c
+
+tvdevice/linux/upnp_tv_device-upnp_tv_device_main.obj: tvdevice/linux/upnp_tv_device_main.c
+	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvdevice/linux/upnp_tv_device-upnp_tv_device_main.obj -MD -MP -MF "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo" -c -o tvdevice/linux/upnp_tv_device-upnp_tv_device_main.obj `if test -f 'tvdevice/linux/upnp_tv_device_main.c'; then $(CYGPATH_W) 'tvdevice/linux/upnp_tv_device_main.c'; else $(CYGPATH_W) '$(srcdir)/tvdevice/linux/upnp_tv_device_main.c'; fi`; \
+	then mv -f "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo" "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Po"; else rm -f "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo"; exit 1; fi
+#	source='tvdevice/linux/upnp_tv_device_main.c' object='tvdevice/linux/upnp_tv_device-upnp_tv_device_main.obj' libtool=no \
+#	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) \
+#	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvdevice/linux/upnp_tv_device-upnp_tv_device_main.obj `if test -f 'tvdevice/linux/upnp_tv_device_main.c'; then $(CYGPATH_W) 'tvdevice/linux/upnp_tv_device_main.c'; else $(CYGPATH_W) '$(srcdir)/tvdevice/linux/upnp_tv_device_main.c'; fi`
+
+mostlyclean-libtool:
+	-rm -f *.lo
+
+clean-libtool:
+	-rm -rf .libs _libs
+
+distclean-libtool:
+	-rm -f libtool
+uninstall-info-am:
+install-examplesDATA: $(examples_DATA)
+	@$(NORMAL_INSTALL)
+	test -z "$(examplesdir)" || $(mkdir_p) "$(DESTDIR)$(examplesdir)"
+	@list='$(examples_DATA)'; for p in $$list; do \
+	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
+	  f=$(am__strip_dir) \
+	  echo " $(examplesDATA_INSTALL) '$$d$$p' '$(DESTDIR)$(examplesdir)/$$f'"; \
+	  $(examplesDATA_INSTALL) "$$d$$p" "$(DESTDIR)$(examplesdir)/$$f"; \
+	done
+
+uninstall-examplesDATA:
+	@$(NORMAL_UNINSTALL)
+	@list='$(examples_DATA)'; for p in $$list; do \
+	  f=$(am__strip_dir) \
+	  echo " rm -f '$(DESTDIR)$(examplesdir)/$$f'"; \
+	  rm -f "$(DESTDIR)$(examplesdir)/$$f"; \
+	done
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	if test -z "$(ETAGS_ARGS)$$tags$$unique"; then :; else \
+	  test -n "$$unique" || unique=$$empty_fix; \
+	  $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	    $$tags $$unique; \
+	fi
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	$(mkdir_p) $(distdir)/web
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
+	  if test -d $$d/$$file; then \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
+	  else \
+	    test -f $(distdir)/$$file \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-am
+all-am: Makefile $(PROGRAMS) $(DATA)
+installdirs:
+	for dir in "$(DESTDIR)$(examplesdir)"; do \
+	  test -z "$$dir" || $(mkdir_p) "$$dir"; \
+	done
+install: install-am
+install-exec: install-exec-am
+install-data: install-data-am
+uninstall: uninstall-am
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+mostlyclean-generic:
+
+clean-generic:
+
+distclean-generic:
+	-test -z "$(CONFIG_CLEAN_FILES)" || rm -f $(CONFIG_CLEAN_FILES)
+	-rm -f common/$(DEPDIR)/$(am__dirstamp)
+	-rm -f common/$(am__dirstamp)
+	-rm -f nasdevice/$(DEPDIR)/$(am__dirstamp)
+	-rm -f nasdevice/$(am__dirstamp)
+	-rm -f nasdevice/linux/$(DEPDIR)/$(am__dirstamp)
+	-rm -f nasdevice/linux/$(am__dirstamp)
+	-rm -f tvcombo/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvcombo/$(am__dirstamp)
+	-rm -f tvcombo/linux/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvcombo/linux/$(am__dirstamp)
+	-rm -f tvctrlpt/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvctrlpt/$(am__dirstamp)
+	-rm -f tvctrlpt/linux/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvctrlpt/linux/$(am__dirstamp)
+	-rm -f tvdevice/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvdevice/$(am__dirstamp)
+	-rm -f tvdevice/linux/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvdevice/linux/$(am__dirstamp)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
+
+clean-am: clean-generic clean-libtool clean-noinstPROGRAMS \
+	mostlyclean-am
+
+distclean: distclean-am
+	-rm -rf common/$(DEPDIR) nasdevice/$(DEPDIR) nasdevice/linux/$(DEPDIR) tvcombo/$(DEPDIR) tvcombo/linux/$(DEPDIR) tvctrlpt/$(DEPDIR) tvctrlpt/linux/$(DEPDIR) tvdevice/$(DEPDIR) tvdevice/linux/$(DEPDIR)
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-libtool distclean-tags
+
+dvi: dvi-am
+
+dvi-am:
+
+html: html-am
+
+info: info-am
+
+info-am:
+
+install-data-am: install-examplesDATA
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-am
+	-rm -rf common/$(DEPDIR) nasdevice/$(DEPDIR) nasdevice/linux/$(DEPDIR) tvcombo/$(DEPDIR) tvcombo/linux/$(DEPDIR) tvctrlpt/$(DEPDIR) tvctrlpt/linux/$(DEPDIR) tvdevice/$(DEPDIR) tvdevice/linux/$(DEPDIR)
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-compile mostlyclean-generic \
+	mostlyclean-libtool
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
+
+uninstall-am: uninstall-examplesDATA uninstall-info-am
+
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
+	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	distclean-compile distclean-generic distclean-libtool \
+	distclean-tags distdir dvi dvi-am html html-am info info-am \
+	install install-am install-data install-data-am \
+	install-examplesDATA install-exec install-exec-am install-info \
+	install-info-am install-man install-strip installcheck \
+	installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-compile \
+	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
+	tags uninstall uninstall-am uninstall-examplesDATA \
+	uninstall-info-am
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
diff -Naur libupnp-1.6.6/upnp/sample/nas-Makefile.am libupnp-1.6.6-mod/upnp/sample/nas-Makefile.am
--- libupnp-1.6.6/upnp/sample/nas-Makefile.am	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample/nas-Makefile.am	2010-04-30 06:31:09.000000000 +0800
@@ -0,0 +1,98 @@
+#
+# "Makefile.am" for "libupnp/upnp/sample"
+#
+# Copyright (C) 2007 Marcelo Roberto Jimenez <mroberto@users.sourceforge.net>
+#
+
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/upnp/inc \
+	-I$(top_srcdir)/threadutil/inc \
+	-I$(top_srcdir)/ixml/inc
+
+LDADD = \
+	$(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+
+
+# samples
+noinst_PROGRAMS =
+if ENABLE_SAMPLES
+if ENABLE_CLIENT
+noinst_PROGRAMS += upnp_tv_ctrlpt
+upnp_tv_ctrlpt_CPPFLAGS = \
+	$(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/tvctrlpt
+if ENABLE_DEVICE
+noinst_PROGRAMS += upnp_tv_combo
+upnp_tv_combo_CPPFLAGS = $(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/tvcombo
+endif
+endif
+if ENABLE_DEVICE
+noinst_PROGRAMS += upnp_tv_device
+upnp_tv_device_CPPFLAGS = \
+	$(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/tvdevice
+noinst_PROGRAMS += upnp_nas_device
+endif
+if ENABLE_DEVICE
+upnp_nas_device_CPPFLAGS = \
+	$(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/nasdevice
+endif
+endif
+
+
+upnp_tv_device_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvdevice/upnp_tv_device.c \
+	tvdevice/upnp_tv_device.h \
+	tvdevice/linux/upnp_tv_device_main.c
+
+
+upnp_tv_ctrlpt_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvctrlpt/upnp_tv_ctrlpt.c \
+	tvctrlpt/upnp_tv_ctrlpt.h \
+	tvctrlpt/linux/upnp_tv_ctrlpt_main.c
+
+upnp_tv_combo_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvcombo/upnp_tv_ctrlpt.c \
+	tvcombo/upnp_tv_ctrlpt.h \
+	tvcombo/upnp_tv_device.c \
+	tvcombo/upnp_tv_device.h \
+	tvcombo/linux/upnp_tv_combo_main.c
+
+upnp_nas_device_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	nasdevice/upnp_nas_device.c \
+	nasdevice/upnp_nas_device.h \
+	nasdevice/linux/upnp_nas_device_main.c
+
+
+
+if WITH_DOCUMENTATION
+examplesdir = $(docdir)/examples
+examples_DATA = \
+		$(upnp_tv_ctrlpt_SOURCES) \
+		$(upnp_tv_device_SOURCES)
+endif
+
+
+EXTRA_DIST = \
+	web/tvcombodesc.xml \
+	web/tvcontrolSCPD.xml \
+	web/tvdevicedesc.xml \
+	web/tvdevicepres.html \
+	web/tvpictureSCPD.xml
+
diff -Naur libupnp-1.6.6/upnp/sample/tvdevice/linux/upnp_tv_device_main.c libupnp-1.6.6-mod/upnp/sample/tvdevice/linux/upnp_tv_device_main.c
--- libupnp-1.6.6/upnp/sample/tvdevice/linux/upnp_tv_device_main.c	2008-03-23 01:04:30.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample/tvdevice/linux/upnp_tv_device_main.c	2014-02-11 11:03:35.000000000 +0800
@@ -176,7 +176,7 @@
     TvDeviceStart( ip_address, port, desc_doc_name, web_dir_path, linux_print );
 
     /* start a command loop thread */
-    code = ithread_create( &cmdloop_thread, NULL, TvDeviceCommandLoop, NULL );
+//    code = ithread_create( &cmdloop_thread, NULL, TvDeviceCommandLoop, NULL );
 
 #ifndef WIN32
     /*
diff -Naur libupnp-1.6.6/upnp/sample/upnp-nas.tz libupnp-1.6.6-mod/upnp/sample/upnp-nas.tz
--- libupnp-1.6.6/upnp/sample/upnp-nas.tz	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample/upnp-nas.tz	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,65 @@
+ K ]{{FO1C Ntk! nwUdX$g|MI3Bnmi3g7Wcz5gw9{E~o~67_z|zwu)$[y;2scSoMl|wxs.yHlk1^-E3U0D;v}ZZ5">=fo3G7gDIxRKE31}u3&l/N	vfiS36ZmJ%OVm0TswbO1=gsJ~DME4\,-Z~&x{46lgGD3waClO,jFZ3z?Fw14z.~13?Abm6 ~'z<6hps=*IWS`.$+Qh$A]Ch2_`WSXABr<x.V	&++?:fZVKP!ide&r0xmr5~k~Ra`?uzQ[Oln; 1wfJUW\<L5l:#WxnJ!C(y9nc
+vpp)<G8WEO@^UvVSg\gk	+~v$B%fNYx0N?c9[rrKG`b}"#JE[2:`f]`RK*hvMpeSR73wlj-){5[KXgK >Irn33Nc]]O:o0'7ea;8'TQpx4,EAk5H\4Dp}f=05B;W#BhKf1IrRPv2F=cmC#9[~*2Y"T/%*"CLe'k\1pScQI(cm7l7GCiu1*K(cZ	a#Iult1svB	HwMujZ>%	UD(>.f*XMCn)!$DTI]]%?Qy4p*8$&[PS8A#uJ4q5d<18P6MNZMdhS(:NR@1Q: b8Is{JT;5/dI0@0OqsVbsS5L=pXbQ CFP&*Fp/	uGrsQ=V}tX[DmP.m"RFlRDQ5]93h
+4h"q!cxc+iY0Y}o\\
+/gMwQnJ!s
+ )/Fp}B+yROX9fRZ-T.Y,ftqP";:JuN!Du|	&z^APAA
+/Hx<7jwz{}<h"D_p;n fU@t'9Y[@3j 0{ c>Wx5o7!F}tne../iz}5B3;kwi<AfE7(o*<\}q X\m#ycRS:>w|HB;mdX[C!$#xnl'RuD;wDvvo$h\*/mRN8,l'%a7I.*bdRPa{[{'O{?DE|[@hpSQ7;OfKT1&pE};CAxf;9> ^lom?Go G~B=:#H,<O*y
+]~k$
+L5Gb
+4y33+qDjx A4
+#0>1!dB&(92Z`EcD`.@sPu){'mMZ
+rr*dz~	6\l|3b)yT@(skl,>J\.3RGc2Jr&.`/t]"V
+53si;Vq<h()W$uS'z4DBt^s^V7-3>=z-`B&p
+iFC/GtU1
+hOL*dr4Y'de#Dad7o;Ch=]
+Dcs#51>ZVPkD!VcbBU'h(
+@bGw^r{9h"&Oo.' K+Qb&@xp<6,eo1*N9N%uUn]QNyRWyc3:%_&Vj:<6T~,g]B,@lq(avlX';hd`U=WKKHBmLFssPmx9nG\\#? ??\W<?v%Jbd`.aeO+'U#.T~BV|<r,4<` ':}|'H6wx	$	YDv}`M*K%6CN|mJ_s SnGh ,[6&okvC:ef`(2X7FG)FX(hq[	TouV:=w#yNaMPx#N(;hz}zs\ryZuB~BT-?
+eX
+bL"CpL<]\P8.w$h"Ihe}2c)Ipe]dx2m5hOn^jB{v\qQBQfa~Us(ha4o]*!=|G-(	vFKD"1$^Sj(,PSF-jopH8PH05rvN	B%}1dkux25Zq[V63I7iiMhk\cMT,&y]}ms`v]Df:.Y\XLKByo-t	rZQg3nJF'?P#gf*u3yt"6h4w=m*St[Y+WZ'jxPRLE}[,q-22B4Bsr$n$FT9t)%W2agZJ8f:IRr8pk6*#>AO V}F]N<16:kqbz?~Z_\%]QsSzA?RQ=hn%3O$}[&}tG?b,w7l`5&	70`uk70
+YM^~)'
+={LV'jY%6uJXWnxsnkNi>	F\EsM $?gjoy>qDgUv>DnPjCPbK#7lIK.q`tE.fRl_L?'ePC9n:r]f $Q)J$O!O)	(B	(:Rm%$dnq!>v|RtVdf}yVG**v02I#X>riLvJcNA+ZHK7q{n_j@fHI=$Z+?JBj]l+95[V^<]zs[m !#Kz^Yu&hsm9XxH\oB>cOLd9
+9oQJ`u <E),
+YMO&K<;Z')A;:STsqCp$\< F\`'[ Aj@asGzda{>YS[5]tP4wq
+u.? W"ncFIqPO[*(!Co5Q2Z]<YAiQVQP]p[nJqupi`J6Kz v;y@Sr#f=NKsq8U7w%
+:	o$2zr\_fql-~w:3oKkF0#L4]dk1<UL*U:M~	3rd7LhW`\{+urZuK8-f[;"~qK#{$ oFN
+r_RnIaPN_J
+Ru2EfI soN+CY:gQ-]F.uwxv>?|'DEDBm39+X{vnHt.bXeILk'Dy7{Bt~[e.A!w|ap2(g5&.b5%GgS,.
+4]Qh.#aMSg{w1a|"Nx+zDRb7t*c*b|I1&UCE;})	zp*:Jj{bmB%l9:i4eFtSks7_<sRV.E6ORxZ9lV[5HXtk5F% }GnK!9}$HG$b vZn#qxmN		GK^.wdd[
+Q"Fa]%+z%D U^.O7JSaR&c![8(`5aD3"Ah AG3<$G^D'q+X6hk`xE</o-<kW",'|!x+DU.?7%U
+ P(m/c=:-PIo"?&\R(b,aBiK=`	"W2pP|kLb"R.[|P I%N&T$5,\4^r"KS,L.*>Gh:XxB}wa"c,&^N-T6TK
+yA,tREy~ ?	rK2JuSZK~vw*<.\R5"CJI&eQ-R3@)E%rYR~qQz4"*E,
+t3;9	)+`U]ADm|Fy,1vM$dqLU$N
+:BP(rZ8l?l
+vgc5+Hc_G97d e*<3Tc$"t @sfPg[O` P>@I<AwJkD:Wxus;D8(pwpImL[sG/0X}"s 2s5/sR'k_><~9UQ$6^N"}Tpc, C-Y5:?0o8>YCrKX
+	
+&Gh~bnwI|_v;3qyK7'7pfqCXdLc 7IOv=G9\C.o(yJy $= q:[J{|Oz<=	PqgFd6]o0N
+=HLcJ9u}' bc|75FjDM	:D54<,*4bS:O2u*[&lV	I% [<3j2d4$f$,7>/e<Mg`*_a&3?9\f9YVpj%f#c5MO
+;XLE03RJz~l5&}0o@e^eK)$->d_""a q7) u<U	;/OlEcO>*<cZtnIE~SHQrW*9,$QH%!EPBf
+U"iy|A) GaB>={ ^)Z0J!tGq}!]	:]q%iK
+\J=<9o=([RI@\_FWX{67;k:g$(&YQ<
+M& 5`.;
+,=w5p kXADKOjw3y_ Wi,s50s ?tiLa?Xe!B68e H
+p6, 'X82r?!GwEk5y]"c?sL9wuIA0*DHZzQ5GGKA2~|)!+SDgU*	Ug J9)3Uwz5=^W[ef0kI5hIiY[i?s9J~`n
+5n'@N)gqy l5P1qR4&6B8
+Ff^18,QsM1
+4cm_WaQ_o}|#)+%;qw7;=X-X_Yw;7Cx!; i$>D,Hh`K^'G'tx:3z~HKZSDtOB':Dcw,5vP#^}:|98|NA,B1RAbE5p8a5` Hc"!mpV'G i"|xd"G)&3YS-=MTc`'651Oac8~4cu*|X?h^GKc<Xg[QRRoYQ4UD|C?O(A<f1zNhq%}wWX,m&=K#N RLRa_ &uR{r
+`??	S37}8rY.1uCLh$Lq~7+8O3d/y2$u:P fX&in5r41RhKWNx_%JRK DwrH?v;jQn~@O
+IpX)Wv)jT#C.@O~rP6yKSR>p$OH}rED#]!i2	uvgs9 7I{FE{mh%Yxfg~	ABEx)}25#j;H_1dX|-GLSi9+w A@wbF(!:::B?MC8!2uxXk
+jkD,ucdbQ*
+' %=pCbSL>TM5.iq]:DM nqDz(t}Ad\c2.f026c!2&Ha`^:S(u\	:4`?>jtTJ Aqtid3C4m++;OSBAb;oX$4dFcw-
+<]>l%TL;;-&vr!n[A@cki=0uy-vBqW 9WLaES CB(/1jsRhW+hr%$	3KTT01USOj v~2II~g-2fg6JLt)c?+R%D25rxV4<M6{)'Ld`ue.c!~1-zOee2LSs)eo "J	g)7"7,K3^j|^'Ubo
+6.y#h1%i4X8"|o0@a*@%pIFx%`[qh
+vKVM"@a=|826'$v)XUl{hVVQ,<YpppFj6*j`t08;}WL	*!|n=
+`M5#S:sV_yzm9
+]g2e:D	uKwCOS3bj99 pE.s~(;|:wIc 9g+hD]*)G)uS"
+KXW6`Y,`Cf@tQ-Bm%NN.X5+#B}ER[pOeeTI#9c,
+tu(E |&O|'U\LnpmL?0z`/~upy6-)]uq<=i0e[Nd !yCl%Tjyx12eCZ-<mO%x4"e~\QQLPteh4@/T}D rRFpg3]$ 0v]%h$K*
+1L`V\}+NrAdBq0]m=F|hK7\C#MR8SgRE5$Tm+,8}I#@'.hf*^
+q0JNPyp4I2sDBN:9"KQ{D }xk
+7IU*E6%)xz{-b73@3hqm9&PZr^&R{J.Z*zFC|2IzGP!nU-<rE>C~"9Jq;B?2.ck7^9?_ezJ' 5FTZ33\9]>|Ea+P
+*N8<A~6l!M!R-:C:!sHy`IG`FB8
+(Pg#9P=<E70d*sR{BGwuKb//w<Al"IBJg3I?T*> $,U		!hwmTCHzXO9Dd;yiYZ}	9
+Z~q$hqo=pBs.zvA8c2Lt9N?aDTC=Q|X?~=WD.DY{K~qJsBB;T\0e0I2z).W,Q/^Lm PeZ+N9eUi5@0Wp^&pEuP<,IKqGB`rR
+G9"Wxx0u_3`b-3z/MdZA
+3OKs	Y_+zj9Zpi:/KU9,$B %cIoYBWB!r&?q Lm$tXk6-pl2O2F_RU.Iey4p<?s3ABeB S+1c:9S}ax% P:Jj/ofG5KW,Tl0[%Wk#~DHg1J(W
+,S|1y{Nwc]|xinkwjv-amuj{=vy1m3s{6"*w}\ZtQNw<9Lb4op7?sOQt} ie](%qR$)xO8n43!y4rT@(AJ	J4k;^ f<7 Yffo;<0J*I{vw	6b{fmm6{Ndp6v;cp91u{j O}]|}32D%C#7EE]hq!`5%u?u/iK]3[|^}#AxdoD|?h @ 
\ No newline at end of file
diff -Naur libupnp-1.6.6/upnp/sample/web/empty.xml libupnp-1.6.6-mod/upnp/sample/web/empty.xml
--- libupnp-1.6.6/upnp/sample/web/empty.xml	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample/web/empty.xml	2014-02-11 13:33:27.000000000 +0800
@@ -0,0 +1,2 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<body/>
\ No newline at end of file
diff -Naur libupnp-1.6.6/upnp/sample-orig/common/sample_util.c libupnp-1.6.6-mod/upnp/sample-orig/common/sample_util.c
--- libupnp-1.6.6/upnp/sample-orig/common/sample_util.c	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/common/sample_util.c	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,793 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+#include "sample_util.h"
+#include <stdarg.h>
+
+#if !UPNP_HAVE_TOOLS
+#	error "Need upnptools.h to compile samples ; try ./configure --enable-tools"
+#endif
+
+
+/*
+   Function pointer to use for displaying formatted
+   strings. Set on Initialization of device. 
+ */
+int initialize = 1;
+print_string gPrintFun = NULL;
+state_update gStateUpdateFun = NULL;
+
+//mutex to control displaying of events
+ithread_mutex_t display_mutex;
+
+/********************************************************************************
+ * SampleUtil_Initialize
+ *
+ * Description: 
+ *     Initializes the sample util. Must be called before any sample util 
+ *     functions. May be called multiple times.
+ *
+ * Parameters:
+ *   print_function - print function to use in SampleUtil_Print
+ *
+ ********************************************************************************/
+int
+SampleUtil_Initialize( print_string print_function )
+{
+    if( initialize ) {
+        ithread_mutexattr_t attr;
+
+        gPrintFun = print_function;
+        ithread_mutexattr_init( &attr );
+        ithread_mutexattr_setkind_np( &attr, ITHREAD_MUTEX_RECURSIVE_NP );
+        ithread_mutex_init( &display_mutex, &attr );
+        ithread_mutexattr_destroy( &attr );
+        initialize = 0;
+    }
+    return UPNP_E_SUCCESS;
+}
+
+/********************************************************************************
+ * SampleUtil_RegisterUpdateFunction
+ *
+ * Description: 
+ *
+ * Parameters:
+ *
+ ********************************************************************************/
+int
+SampleUtil_RegisterUpdateFunction( state_update update_function )
+{
+    static int initialize = 1;  //only intialize once
+
+    if( initialize ) {
+        gStateUpdateFun = update_function;
+        initialize = 0;
+    }
+    return UPNP_E_SUCCESS;
+}
+
+/********************************************************************************
+ * SampleUtil_Finish
+ *
+ * Description: 
+ *     Releases Resources held by sample util.
+ *
+ * Parameters:
+ *
+ ********************************************************************************/
+int
+SampleUtil_Finish()
+{
+    ithread_mutex_destroy( &display_mutex );
+    gPrintFun = NULL;
+    initialize = 1;
+    return UPNP_E_SUCCESS;
+}
+
+/********************************************************************************
+ * SampleUtil_GetElementValue
+ *
+ * Description: 
+ *       Given a DOM node such as <Channel>11</Channel>, this routine
+ *       extracts the value (e.g., 11) from the node and returns it as 
+ *       a string. The string must be freed by the caller using 
+ *       free.
+ *
+ * Parameters:
+ *   node -- The DOM node from which to extract the value
+ *
+ ********************************************************************************/
+
+char *
+SampleUtil_GetElementValue( IN IXML_Element * element )
+{
+
+    IXML_Node *child = ixmlNode_getFirstChild( ( IXML_Node * ) element );
+
+    char *temp = NULL;
+
+    if( ( child != 0 ) && ( ixmlNode_getNodeType( child ) == eTEXT_NODE ) ) {
+        temp = strdup( ixmlNode_getNodeValue( child ) );
+    }
+
+    return temp;
+}
+
+/********************************************************************************
+ * SampleUtil_GetFirstServiceList
+ *
+ * Description: 
+ *       Given a DOM node representing a UPnP Device Description Document,
+ *       this routine parses the document and finds the first service list
+ *       (i.e., the service list for the root device).  The service list
+ *       is returned as a DOM node list.
+ *
+ * Parameters:
+ *   node -- The DOM node from which to extract the service list
+ *
+ ********************************************************************************/
+IXML_NodeList *
+SampleUtil_GetFirstServiceList( IN IXML_Document * doc )
+{
+    IXML_NodeList *ServiceList = NULL;
+    IXML_NodeList *servlistnodelist = NULL;
+    IXML_Node *servlistnode = NULL;
+
+    servlistnodelist =
+        ixmlDocument_getElementsByTagName( doc, "serviceList" );
+    if( servlistnodelist && ixmlNodeList_length( servlistnodelist ) ) {
+
+        /*
+           we only care about the first service list, from the root device 
+         */
+        servlistnode = ixmlNodeList_item( servlistnodelist, 0 );
+
+        /*
+           create as list of DOM nodes 
+         */
+        ServiceList =
+            ixmlElement_getElementsByTagName( ( IXML_Element * )
+                                              servlistnode, "service" );
+    }
+
+    if( servlistnodelist )
+        ixmlNodeList_free( servlistnodelist );
+
+    return ServiceList;
+}
+
+/********************************************************************************
+ * SampleUtil_GetFirstDocumentItem
+ *
+ * Description: 
+ *       Given a document node, this routine searches for the first element
+ *       named by the input string item, and returns its value as a string.
+ *       String must be freed by caller using free.
+ * Parameters:
+ *   doc -- The DOM document from which to extract the value
+ *   item -- The item to search for
+ *
+ ********************************************************************************/
+char *
+SampleUtil_GetFirstDocumentItem( IN IXML_Document * doc,
+                                 IN const char *item )
+{
+    IXML_NodeList *nodeList = NULL;
+    IXML_Node *textNode = NULL;
+    IXML_Node *tmpNode = NULL;
+
+    char *ret = NULL;
+
+    nodeList = ixmlDocument_getElementsByTagName( doc, ( char * )item );
+
+    if( nodeList ) {
+        if( ( tmpNode = ixmlNodeList_item( nodeList, 0 ) ) ) {
+            textNode = ixmlNode_getFirstChild( tmpNode );
+
+            ret = strdup( ixmlNode_getNodeValue( textNode ) );
+        }
+    }
+
+    if( nodeList )
+        ixmlNodeList_free( nodeList );
+    return ret;
+}
+
+/********************************************************************************
+ * SampleUtil_GetFirstElementItem
+ *
+ * Description: 
+ *       Given a DOM element, this routine searches for the first element
+ *       named by the input string item, and returns its value as a string.
+ *       The string must be freed using free.
+ * Parameters:
+ *   node -- The DOM element from which to extract the value
+ *   item -- The item to search for
+ *
+ ********************************************************************************/
+char *
+SampleUtil_GetFirstElementItem( IN IXML_Element * element,
+                                IN const char *item )
+{
+    IXML_NodeList *nodeList = NULL;
+    IXML_Node *textNode = NULL;
+    IXML_Node *tmpNode = NULL;
+
+    char *ret = NULL;
+
+    nodeList = ixmlElement_getElementsByTagName( element, ( char * )item );
+
+    if( nodeList == NULL ) {
+        SampleUtil_Print( "Error finding %s in XML Node\n", item );
+        return NULL;
+    }
+
+    if( ( tmpNode = ixmlNodeList_item( nodeList, 0 ) ) == NULL ) {
+        SampleUtil_Print( "Error finding %s value in XML Node\n", item );
+        ixmlNodeList_free( nodeList );
+        return NULL;
+    }
+
+    textNode = ixmlNode_getFirstChild( tmpNode );
+
+    ret = strdup( ixmlNode_getNodeValue( textNode ) );
+
+    if( !ret ) {
+        SampleUtil_Print( "Error allocating memory for %s in XML Node\n",
+                          item );
+        ixmlNodeList_free( nodeList );
+        return NULL;
+    }
+
+    ixmlNodeList_free( nodeList );
+
+    return ret;
+}
+
+/********************************************************************************
+ * SampleUtil_PrintEventType
+ *
+ * Description: 
+ *       Prints a callback event type as a string.
+ *
+ * Parameters:
+ *   S -- The callback event
+ *
+ ********************************************************************************/
+void
+SampleUtil_PrintEventType( IN Upnp_EventType S )
+{
+    switch ( S ) {
+
+        case UPNP_DISCOVERY_ADVERTISEMENT_ALIVE:
+            SampleUtil_Print( "UPNP_DISCOVERY_ADVERTISEMENT_ALIVE\n" );
+            break;
+        case UPNP_DISCOVERY_ADVERTISEMENT_BYEBYE:
+            SampleUtil_Print( "UPNP_DISCOVERY_ADVERTISEMENT_BYEBYE\n" );
+            break;
+        case UPNP_DISCOVERY_SEARCH_RESULT:
+            SampleUtil_Print( "UPNP_DISCOVERY_SEARCH_RESULT\n" );
+            break;
+        case UPNP_DISCOVERY_SEARCH_TIMEOUT:
+            SampleUtil_Print( "UPNP_DISCOVERY_SEARCH_TIMEOUT\n" );
+            break;
+
+            /*
+               SOAP Stuff 
+             */
+        case UPNP_CONTROL_ACTION_REQUEST:
+            SampleUtil_Print( "UPNP_CONTROL_ACTION_REQUEST\n" );
+            break;
+        case UPNP_CONTROL_ACTION_COMPLETE:
+            SampleUtil_Print( "UPNP_CONTROL_ACTION_COMPLETE\n" );
+            break;
+        case UPNP_CONTROL_GET_VAR_REQUEST:
+            SampleUtil_Print( "UPNP_CONTROL_GET_VAR_REQUEST\n" );
+            break;
+        case UPNP_CONTROL_GET_VAR_COMPLETE:
+            SampleUtil_Print( "UPNP_CONTROL_GET_VAR_COMPLETE\n" );
+            break;
+
+            /*
+               GENA Stuff 
+             */
+        case UPNP_EVENT_SUBSCRIPTION_REQUEST:
+            SampleUtil_Print( "UPNP_EVENT_SUBSCRIPTION_REQUEST\n" );
+            break;
+        case UPNP_EVENT_RECEIVED:
+            SampleUtil_Print( "UPNP_EVENT_RECEIVED\n" );
+            break;
+        case UPNP_EVENT_RENEWAL_COMPLETE:
+            SampleUtil_Print( "UPNP_EVENT_RENEWAL_COMPLETE\n" );
+            break;
+        case UPNP_EVENT_SUBSCRIBE_COMPLETE:
+            SampleUtil_Print( "UPNP_EVENT_SUBSCRIBE_COMPLETE\n" );
+            break;
+        case UPNP_EVENT_UNSUBSCRIBE_COMPLETE:
+            SampleUtil_Print( "UPNP_EVENT_UNSUBSCRIBE_COMPLETE\n" );
+            break;
+
+        case UPNP_EVENT_AUTORENEWAL_FAILED:
+            SampleUtil_Print( "UPNP_EVENT_AUTORENEWAL_FAILED\n" );
+            break;
+        case UPNP_EVENT_SUBSCRIPTION_EXPIRED:
+            SampleUtil_Print( "UPNP_EVENT_SUBSCRIPTION_EXPIRED\n" );
+            break;
+
+    }
+}
+
+/********************************************************************************
+ * SampleUtil_PrintEvent
+ *
+ * Description: 
+ *       Prints callback event structure details.
+ *
+ * Parameters:
+ *   EventType -- The type of callback event
+ *   Event -- The callback event structure
+ *
+ ********************************************************************************/
+int
+SampleUtil_PrintEvent( IN Upnp_EventType EventType,
+                       IN void *Event )
+{
+
+    ithread_mutex_lock( &display_mutex );
+
+    SampleUtil_Print
+        ( "\n\n\n======================================================================\n" );
+    SampleUtil_Print
+        ( "----------------------------------------------------------------------\n" );
+    SampleUtil_PrintEventType( EventType );
+
+    switch ( EventType ) {
+
+            /*
+               SSDP 
+             */
+        case UPNP_DISCOVERY_ADVERTISEMENT_ALIVE:
+        case UPNP_DISCOVERY_ADVERTISEMENT_BYEBYE:
+        case UPNP_DISCOVERY_SEARCH_RESULT:
+            {
+                struct Upnp_Discovery *d_event =
+                    ( struct Upnp_Discovery * )Event;
+
+                SampleUtil_Print( "ErrCode     =  %d\n",
+                                  d_event->ErrCode );
+                SampleUtil_Print( "Expires     =  %d\n",
+                                  d_event->Expires );
+                SampleUtil_Print( "DeviceId    =  %s\n",
+                                  d_event->DeviceId );
+                SampleUtil_Print( "DeviceType  =  %s\n",
+                                  d_event->DeviceType );
+                SampleUtil_Print( "ServiceType =  %s\n",
+                                  d_event->ServiceType );
+                SampleUtil_Print( "ServiceVer  =  %s\n",
+                                  d_event->ServiceVer );
+                SampleUtil_Print( "Location    =  %s\n",
+                                  d_event->Location );
+                SampleUtil_Print( "OS          =  %s\n", d_event->Os );
+                SampleUtil_Print( "Ext         =  %s\n", d_event->Ext );
+
+            }
+            break;
+
+        case UPNP_DISCOVERY_SEARCH_TIMEOUT:
+            // Nothing to print out here
+            break;
+
+            /*
+               SOAP 
+             */
+        case UPNP_CONTROL_ACTION_REQUEST:
+            {
+                struct Upnp_Action_Request *a_event =
+                    ( struct Upnp_Action_Request * )Event;
+                char *xmlbuff = NULL;
+
+                SampleUtil_Print( "ErrCode     =  %d\n",
+                                  a_event->ErrCode );
+                SampleUtil_Print( "ErrStr      =  %s\n", a_event->ErrStr );
+                SampleUtil_Print( "ActionName  =  %s\n",
+                                  a_event->ActionName );
+                SampleUtil_Print( "UDN         =  %s\n", a_event->DevUDN );
+                SampleUtil_Print( "ServiceID   =  %s\n",
+                                  a_event->ServiceID );
+                if( a_event->ActionRequest ) {
+                    xmlbuff = ixmlPrintNode( ( IXML_Node * ) a_event->ActionRequest );
+                    if( xmlbuff )
+                        SampleUtil_Print( "ActRequest  =  %s\n", xmlbuff );
+                    if( xmlbuff )
+                        ixmlFreeDOMString( xmlbuff );
+                    xmlbuff = NULL;
+                } else {
+                    SampleUtil_Print( "ActRequest  =  (null)\n" );
+                }
+
+                if( a_event->ActionResult ) {
+                    xmlbuff = ixmlPrintNode( ( IXML_Node * ) a_event->ActionResult );
+                    if( xmlbuff )
+                        SampleUtil_Print( "ActResult   =  %s\n", xmlbuff );
+                    if( xmlbuff )
+                        ixmlFreeDOMString( xmlbuff );
+                    xmlbuff = NULL;
+                } else {
+                    SampleUtil_Print( "ActResult   =  (null)\n" );
+                }
+            }
+            break;
+
+        case UPNP_CONTROL_ACTION_COMPLETE:
+            {
+                struct Upnp_Action_Complete *a_event =
+                    ( struct Upnp_Action_Complete * )Event;
+                char *xmlbuff = NULL;
+
+                SampleUtil_Print( "ErrCode     =  %d\n",
+                                  a_event->ErrCode );
+                SampleUtil_Print( "CtrlUrl     =  %s\n",
+                                  a_event->CtrlUrl );
+                if( a_event->ActionRequest ) {
+                    xmlbuff = ixmlPrintNode( ( IXML_Node * ) a_event->ActionRequest );
+                    if( xmlbuff )
+                        SampleUtil_Print( "ActRequest  =  %s\n", xmlbuff );
+                    if( xmlbuff )
+                        ixmlFreeDOMString( xmlbuff );
+                    xmlbuff = NULL;
+                } else {
+                    SampleUtil_Print( "ActRequest  =  (null)\n" );
+                }
+
+                if( a_event->ActionResult ) {
+                    xmlbuff = ixmlPrintNode( ( IXML_Node * ) a_event->ActionResult );
+                    if( xmlbuff )
+                        SampleUtil_Print( "ActResult   =  %s\n", xmlbuff );
+                    if( xmlbuff )
+                        ixmlFreeDOMString( xmlbuff );
+                    xmlbuff = NULL;
+                } else {
+                    SampleUtil_Print( "ActResult   =  (null)\n" );
+                }
+            }
+            break;
+
+        case UPNP_CONTROL_GET_VAR_REQUEST:
+            {
+                struct Upnp_State_Var_Request *sv_event =
+                    ( struct Upnp_State_Var_Request * )Event;
+
+                SampleUtil_Print( "ErrCode     =  %d\n",
+                                  sv_event->ErrCode );
+                SampleUtil_Print( "ErrStr      =  %s\n",
+                                  sv_event->ErrStr );
+                SampleUtil_Print( "UDN         =  %s\n",
+                                  sv_event->DevUDN );
+                SampleUtil_Print( "ServiceID   =  %s\n",
+                                  sv_event->ServiceID );
+                SampleUtil_Print( "StateVarName=  %s\n",
+                                  sv_event->StateVarName );
+                SampleUtil_Print( "CurrentVal  =  %s\n",
+                                  sv_event->CurrentVal );
+            }
+            break;
+
+        case UPNP_CONTROL_GET_VAR_COMPLETE:
+            {
+                struct Upnp_State_Var_Complete *sv_event =
+                    ( struct Upnp_State_Var_Complete * )Event;
+
+                SampleUtil_Print( "ErrCode     =  %d\n",
+                                  sv_event->ErrCode );
+                SampleUtil_Print( "CtrlUrl     =  %s\n",
+                                  sv_event->CtrlUrl );
+                SampleUtil_Print( "StateVarName=  %s\n",
+                                  sv_event->StateVarName );
+                SampleUtil_Print( "CurrentVal  =  %s\n",
+                                  sv_event->CurrentVal );
+            }
+            break;
+
+            /*
+               GENA 
+             */
+        case UPNP_EVENT_SUBSCRIPTION_REQUEST:
+            {
+                struct Upnp_Subscription_Request *sr_event =
+                    ( struct Upnp_Subscription_Request * )Event;
+
+                SampleUtil_Print( "ServiceID   =  %s\n",
+                                  sr_event->ServiceId );
+                SampleUtil_Print( "UDN         =  %s\n", sr_event->UDN );
+                SampleUtil_Print( "SID         =  %s\n", sr_event->Sid );
+            }
+            break;
+
+        case UPNP_EVENT_RECEIVED:
+            {
+                struct Upnp_Event *e_event = ( struct Upnp_Event * )Event;
+                char *xmlbuff = NULL;
+
+                SampleUtil_Print( "SID         =  %s\n", e_event->Sid );
+                SampleUtil_Print( "EventKey    =  %d\n",
+                                  e_event->EventKey );
+                xmlbuff = ixmlPrintNode( ( IXML_Node * ) e_event->ChangedVariables );
+                SampleUtil_Print( "ChangedVars =  %s\n", xmlbuff );
+                ixmlFreeDOMString( xmlbuff );
+                xmlbuff = NULL;
+            }
+            break;
+
+        case UPNP_EVENT_RENEWAL_COMPLETE:
+            {
+                struct Upnp_Event_Subscribe *es_event =
+                    ( struct Upnp_Event_Subscribe * )Event;
+
+                SampleUtil_Print( "SID         =  %s\n", es_event->Sid );
+                SampleUtil_Print( "ErrCode     =  %d\n",
+                                  es_event->ErrCode );
+                SampleUtil_Print( "TimeOut     =  %d\n",
+                                  es_event->TimeOut );
+            }
+            break;
+
+        case UPNP_EVENT_SUBSCRIBE_COMPLETE:
+        case UPNP_EVENT_UNSUBSCRIBE_COMPLETE:
+            {
+                struct Upnp_Event_Subscribe *es_event =
+                    ( struct Upnp_Event_Subscribe * )Event;
+
+                SampleUtil_Print( "SID         =  %s\n", es_event->Sid );
+                SampleUtil_Print( "ErrCode     =  %d\n",
+                                  es_event->ErrCode );
+                SampleUtil_Print( "PublisherURL=  %s\n",
+                                  es_event->PublisherUrl );
+                SampleUtil_Print( "TimeOut     =  %d\n",
+                                  es_event->TimeOut );
+            }
+            break;
+
+        case UPNP_EVENT_AUTORENEWAL_FAILED:
+        case UPNP_EVENT_SUBSCRIPTION_EXPIRED:
+            {
+                struct Upnp_Event_Subscribe *es_event =
+                    ( struct Upnp_Event_Subscribe * )Event;
+
+                SampleUtil_Print( "SID         =  %s\n", es_event->Sid );
+                SampleUtil_Print( "ErrCode     =  %d\n",
+                                  es_event->ErrCode );
+                SampleUtil_Print( "PublisherURL=  %s\n",
+                                  es_event->PublisherUrl );
+                SampleUtil_Print( "TimeOut     =  %d\n",
+                                  es_event->TimeOut );
+            }
+            break;
+
+    }
+    SampleUtil_Print
+        ( "----------------------------------------------------------------------\n" );
+    SampleUtil_Print
+        ( "======================================================================\n\n\n\n" );
+
+    ithread_mutex_unlock( &display_mutex );
+    return ( 0 );
+}
+
+/********************************************************************************
+ * SampleUtil_FindAndParseService
+ *
+ * Description: 
+ *       This routine finds the first occurance of a service in a DOM representation
+ *       of a description document and parses it.  
+ *
+ * Parameters:
+ *   DescDoc -- The DOM description document
+ *   location -- The location of the description document
+ *   serviceSearchType -- The type of service to search for
+ *   serviceId -- OUT -- The service ID
+ *   eventURL -- OUT -- The event URL for the service
+ *   controlURL -- OUT -- The control URL for the service
+ *
+ ********************************************************************************/
+int
+SampleUtil_FindAndParseService( IN IXML_Document * DescDoc,
+                                IN char *location,
+                                IN char *serviceType,
+                                OUT char **serviceId,
+                                OUT char **eventURL,
+                                OUT char **controlURL )
+{
+    int i,
+      length,
+      found = 0;
+    int ret;
+    char *tempServiceType = NULL;
+    char *baseURL = NULL;
+    char *base;
+    char *relcontrolURL = NULL,
+     *releventURL = NULL;
+    IXML_NodeList *serviceList = NULL;
+    IXML_Element *service = NULL;
+
+    baseURL = SampleUtil_GetFirstDocumentItem( DescDoc, "URLBase" );
+
+    if( baseURL )
+        base = baseURL;
+    else
+        base = location;
+
+    serviceList = SampleUtil_GetFirstServiceList( DescDoc );
+    length = ixmlNodeList_length( serviceList );
+    for( i = 0; i < length; i++ ) {
+        service = ( IXML_Element * ) ixmlNodeList_item( serviceList, i );
+        tempServiceType =
+            SampleUtil_GetFirstElementItem( ( IXML_Element * ) service,
+                                            "serviceType" );
+
+        if( strcmp( tempServiceType, serviceType ) == 0 ) {
+            SampleUtil_Print( "Found service: %s\n", serviceType );
+            *serviceId =
+                SampleUtil_GetFirstElementItem( service, "serviceId" );
+            SampleUtil_Print( "serviceId: %s\n", ( *serviceId ) );
+            relcontrolURL =
+                SampleUtil_GetFirstElementItem( service, "controlURL" );
+            releventURL =
+                SampleUtil_GetFirstElementItem( service, "eventSubURL" );
+
+            *controlURL =
+                malloc( strlen( base ) + strlen( relcontrolURL ) + 1 );
+            if( *controlURL ) {
+                ret = UpnpResolveURL( base, relcontrolURL, *controlURL );
+                if( ret != UPNP_E_SUCCESS )
+                    SampleUtil_Print
+                        ( "Error generating controlURL from %s + %s\n",
+                          base, relcontrolURL );
+            }
+
+            *eventURL =
+                malloc( strlen( base ) + strlen( releventURL ) + 1 );
+            if( *eventURL ) {
+                ret = UpnpResolveURL( base, releventURL, *eventURL );
+                if( ret != UPNP_E_SUCCESS )
+                    SampleUtil_Print
+                        ( "Error generating eventURL from %s + %s\n", base,
+                          releventURL );
+            }
+
+            if( relcontrolURL )
+                free( relcontrolURL );
+            if( releventURL )
+                free( releventURL );
+            relcontrolURL = releventURL = NULL;
+
+            found = 1;
+            break;
+        }
+
+        if( tempServiceType )
+            free( tempServiceType );
+        tempServiceType = NULL;
+    }
+
+    if( tempServiceType )
+        free( tempServiceType );
+    if( serviceList )
+        ixmlNodeList_free( serviceList );
+    if( baseURL )
+        free( baseURL );
+
+    return ( found );
+}
+
+// printf wrapper for portable code
+int
+uprint1( char *fmt,
+         ... )
+{
+    va_list ap;
+    char *buf = NULL;
+    int size;
+
+    va_start( ap, fmt );
+    size = vsnprintf( buf, 0, fmt, ap );
+    va_end( ap );
+
+    if( size > 0 ) {
+        buf = ( char * )malloc( size + 1 );
+        if( vsnprintf( buf, size + 1, fmt, ap ) != size ) {
+            free( buf );
+            buf = NULL;
+        }
+    }
+
+    if( buf ) {
+        ithread_mutex_lock( &display_mutex );
+        if( gPrintFun )
+            gPrintFun( buf );
+        ithread_mutex_unlock( &display_mutex );
+        free( buf );
+    }
+
+    return size;
+}
+
+/********************************************************************************
+ * SampleUtil_Print
+ *
+ * Description: 
+ *      Provides platform-specific print functionality.  This function should be
+ *      called when you want to print content suitable for console output (i.e.,
+ *      in a large text box or on a screen).  If your device/operating system is 
+ *      not supported here, you should add a port.
+ *
+ * Parameters:
+ *		Same as printf()
+ *
+ ********************************************************************************/
+int
+SampleUtil_Print( char *fmt,
+                  ... )
+{
+    va_list ap;
+    char buf[200];
+    int rc;
+
+    va_start( ap, fmt );
+    rc = vsnprintf( buf, 200, fmt, ap );
+    va_end( ap );
+
+    ithread_mutex_lock( &display_mutex );
+    if( gPrintFun )
+        gPrintFun( buf );
+    ithread_mutex_unlock( &display_mutex );
+
+    return rc;
+}
+
+/********************************************************************************
+ * SampleUtil_StateUpdate
+ *
+ * Description: 
+ *
+ * Parameters:
+ *
+ ********************************************************************************/
+void
+SampleUtil_StateUpdate( const char *varName,
+                        const char *varValue,
+                        const char *UDN,
+                        eventType type )
+{
+    if( gStateUpdateFun )
+        gStateUpdateFun( varName, varValue, UDN, type );
+    // TBD: Add mutex here?
+}
diff -Naur libupnp-1.6.6/upnp/sample-orig/common/sample_util.h libupnp-1.6.6-mod/upnp/sample-orig/common/sample_util.h
--- libupnp-1.6.6/upnp/sample-orig/common/sample_util.h	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/common/sample_util.h	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,288 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+#ifndef SAMPLE_UTIL_H
+#define SAMPLE_UTIL_H
+
+#ifdef __cplusplus
+extern "C" {
+#endif /* __cplusplus */
+
+
+#include <stdlib.h>
+#include <string.h>
+
+#include "ithread.h"
+#include "ixml.h"
+#include "upnptools.h"
+
+
+// mutex to control displaying of events
+extern ithread_mutex_t display_mutex;
+
+
+typedef enum {
+	STATE_UPDATE = 0,
+	DEVICE_ADDED = 1,
+	DEVICE_REMOVED = 2,
+	GET_VAR_COMPLETE = 3
+} eventType;
+
+
+/********************************************************************************
+ * SampleUtil_GetElementValue
+ *
+ * Description: 
+ *       Given a DOM node such as <Channel>11</Channel>, this routine
+ *       extracts the value (e.g., 11) from the node and returns it as 
+ *       a string. The string must be freed by the caller using 
+ *       free.
+ *
+ * Parameters:
+ *   node -- The DOM node from which to extract the value
+ *
+ ********************************************************************************/
+char *SampleUtil_GetElementValue(IN IXML_Element *element);
+
+/********************************************************************************
+ * SampleUtil_GetFirstServiceList
+ *
+ * Description: 
+ *       Given a DOM node representing a UPnP Device Description Document,
+ *       this routine parses the document and finds the first service list
+ *       (i.e., the service list for the root device).  The service list
+ *       is returned as a DOM node list. The NodeList must be freed using
+ *       NodeList_free.
+ *
+ * Parameters:
+ *   node -- The DOM node from which to extract the service list
+ *
+ ********************************************************************************/
+
+IXML_NodeList *SampleUtil_GetFirstServiceList(IN IXML_Document *doc); 
+
+
+/********************************************************************************
+ * SampleUtil_GetFirstDocumentItem
+ *
+ * Description: 
+ *       Given a document node, this routine searches for the first element
+ *       named by the input string item, and returns its value as a string.
+ *       String must be freed by caller using free.
+ * Parameters:
+ *   doc -- The DOM document from which to extract the value
+ *   item -- The item to search for
+ *
+ ********************************************************************************/
+char *SampleUtil_GetFirstDocumentItem(IN IXML_Document *doc, IN const char *item); 
+
+
+
+/********************************************************************************
+ * SampleUtil_GetFirstElementItem
+ *
+ * Description: 
+ *       Given a DOM element, this routine searches for the first element
+ *       named by the input string item, and returns its value as a string.
+ *       The string must be freed using free.
+ * Parameters:
+ *   node -- The DOM element from which to extract the value
+ *   item -- The item to search for
+ *
+ ********************************************************************************/
+char *SampleUtil_GetFirstElementItem(IN IXML_Element *element, IN const char *item); 
+
+/********************************************************************************
+ * SampleUtil_PrintEventType
+ *
+ * Description: 
+ *       Prints a callback event type as a string.
+ *
+ * Parameters:
+ *   S -- The callback event
+ *
+ ********************************************************************************/
+void SampleUtil_PrintEventType(IN Upnp_EventType S);
+
+/********************************************************************************
+ * SampleUtil_PrintEvent
+ *
+ * Description: 
+ *       Prints callback event structure details.
+ *
+ * Parameters:
+ *   EventType -- The type of callback event
+ *   Event -- The callback event structure
+ *
+ ********************************************************************************/
+int SampleUtil_PrintEvent(IN Upnp_EventType EventType, 
+			  IN void *Event);
+
+/********************************************************************************
+ * SampleUtil_FindAndParseService
+ *
+ * Description: 
+ *       This routine finds the first occurance of a service in a DOM representation
+ *       of a description document and parses it.  Note that this function currently
+ *       assumes that the eventURL and controlURL values in the service definitions
+ *       are full URLs.  Relative URLs are not handled here.
+ *
+ * Parameters:
+ *   DescDoc -- The DOM description document
+ *   location -- The location of the description document
+ *   serviceSearchType -- The type of service to search for
+ *   serviceId -- OUT -- The service ID
+ *   eventURL -- OUT -- The event URL for the service
+ *   controlURL -- OUT -- The control URL for the service
+ *
+ ********************************************************************************/
+int SampleUtil_FindAndParseService (
+	IN IXML_Document *DescDoc,
+	IN char* location, 
+	IN char *serviceType,
+	OUT char **serviceId, 
+	OUT char **eventURL,
+	OUT char **controlURL);
+
+
+/********************************************************************************
+ * print_string
+ *
+ * Description: 
+ *       Prototype for displaying strings. All printing done by the device,
+ *       control point, and sample util, ultimately use this to display strings 
+ *       to the user.
+ *
+ * Parameters:
+ *   const char * string.
+ *
+ ********************************************************************************/
+typedef void (*print_string)(const char *string);
+
+//global print function used by sample util
+extern print_string gPrintFun;
+
+/********************************************************************************
+ * state_update
+ *
+ * Description: 
+ *     Prototype for passing back state changes
+ *
+ * Parameters:
+ *   const char * varName
+ *   const char * varValue
+ *   const char * UDN
+ *   int          newDevice
+ ********************************************************************************/
+typedef void (*state_update)(
+	const char *varName,
+	const char *varValue,
+	const char *UDN,
+	eventType type);
+
+//global state update function used by smaple util
+extern state_update gStateUpdateFun;
+
+/********************************************************************************
+ * SampleUtil_Initialize
+ *
+ * Description: 
+ *     Initializes the sample util. Must be called before any sample util 
+ *     functions. May be called multiple times.
+ *
+ * Parameters:
+ *   print_function - print function to use in SampleUtil_Print
+ *
+ ********************************************************************************/
+int SampleUtil_Initialize(print_string print_function);
+
+/********************************************************************************
+ * SampleUtil_Finish
+ *
+ * Description: 
+ *     Releases Resources held by sample util.
+ *
+ * Parameters:
+ *
+ ********************************************************************************/
+int SampleUtil_Finish();
+
+/********************************************************************************
+ * SampleUtil_Print
+ *
+ * Description: 
+ *     Function emulating printf that ultimately calls the registered print 
+ *     function with the formatted string.
+ *
+ * Parameters:
+ *   fmt - format (see printf)
+ *   . . .  - variable number of args. (see printf)
+ *
+ ********************************************************************************/
+int SampleUtil_Print(char *fmt, ...);
+
+/********************************************************************************
+ * SampleUtil_RegisterUpdateFunction
+ *
+ * Description: 
+ *
+ * Parameters:
+ *
+ ********************************************************************************/
+int SampleUtil_RegisterUpdateFunction(state_update update_function);
+
+/********************************************************************************
+ * SampleUtil_StateUpdate
+ *
+ * Description: 
+ *
+ * Parameters:
+ *
+ ********************************************************************************/
+void SampleUtil_StateUpdate(
+	const char *varName,
+	const char *varValue,
+	const char *UDN,
+	eventType type);
+
+#ifdef __cplusplus
+};
+#endif /* __cplusplus */
+
+
+#ifdef WIN32
+	#define snprintf	_snprintf
+	#define strcasecmp	stricmp
+#endif
+
+
+#endif /* SAMPLE_UTIL_H */
+
diff -Naur libupnp-1.6.6/upnp/sample-orig/Makefile.am libupnp-1.6.6-mod/upnp/sample-orig/Makefile.am
--- libupnp-1.6.6/upnp/sample-orig/Makefile.am	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/Makefile.am	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,83 @@
+#
+# "Makefile.am" for "libupnp/upnp/sample"
+#
+# Copyright (C) 2007 Marcelo Roberto Jimenez <mroberto@users.sourceforge.net>
+#
+
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/upnp/inc \
+	-I$(top_srcdir)/threadutil/inc \
+	-I$(top_srcdir)/ixml/inc
+
+LDADD = \
+	$(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+
+
+# samples
+noinst_PROGRAMS =
+if ENABLE_SAMPLES
+if ENABLE_CLIENT
+noinst_PROGRAMS += upnp_tv_ctrlpt
+upnp_tv_ctrlpt_CPPFLAGS = \
+	$(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/tvctrlpt
+if ENABLE_DEVICE
+noinst_PROGRAMS += upnp_tv_combo
+upnp_tv_combo_CPPFLAGS = $(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/tvcombo
+endif
+endif
+if ENABLE_DEVICE
+noinst_PROGRAMS += upnp_tv_device
+upnp_tv_device_CPPFLAGS = \
+	$(AM_CPPFLAGS) \
+	-I$(srcdir)/common/ \
+	-I$(srcdir)/tvdevice
+endif
+endif
+
+
+upnp_tv_device_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvdevice/upnp_tv_device.c \
+	tvdevice/upnp_tv_device.h \
+	tvdevice/linux/upnp_tv_device_main.c
+
+
+upnp_tv_ctrlpt_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvctrlpt/upnp_tv_ctrlpt.c \
+	tvctrlpt/upnp_tv_ctrlpt.h \
+	tvctrlpt/linux/upnp_tv_ctrlpt_main.c
+
+upnp_tv_combo_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvcombo/upnp_tv_ctrlpt.c \
+	tvcombo/upnp_tv_ctrlpt.h \
+	tvcombo/upnp_tv_device.c \
+	tvcombo/upnp_tv_device.h \
+	tvcombo/linux/upnp_tv_combo_main.c
+
+
+if WITH_DOCUMENTATION
+examplesdir = $(docdir)/examples
+examples_DATA = \
+		$(upnp_tv_ctrlpt_SOURCES) \
+		$(upnp_tv_device_SOURCES)
+endif
+
+
+EXTRA_DIST = \
+	web/tvcombodesc.xml \
+	web/tvcontrolSCPD.xml \
+	web/tvdevicedesc.xml \
+	web/tvdevicepres.html \
+	web/tvpictureSCPD.xml
+
diff -Naur libupnp-1.6.6/upnp/sample-orig/Makefile.in libupnp-1.6.6-mod/upnp/sample-orig/Makefile.in
--- libupnp-1.6.6/upnp/sample-orig/Makefile.in	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/Makefile.in	2014-02-11 11:05:20.000000000 +0800
@@ -0,0 +1,824 @@
+# Makefile.in generated by automake 1.9.6 from Makefile.am.
+# @configure_input@
+
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004, 2005  Free Software Foundation, Inc.
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+@SET_MAKE@
+
+#
+# "Makefile.am" for "libupnp/upnp/sample"
+#
+# Copyright (C) 2007 Marcelo Roberto Jimenez <mroberto@users.sourceforge.net>
+#
+
+
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+VPATH = @srcdir@
+pkgdatadir = $(datadir)/@PACKAGE@
+pkglibdir = $(libdir)/@PACKAGE@
+pkgincludedir = $(includedir)/@PACKAGE@
+top_builddir = ../..
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+INSTALL = @INSTALL@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+build_triplet = @build@
+host_triplet = @host@
+noinst_PROGRAMS = $(am__EXEEXT_1) $(am__EXEEXT_2) $(am__EXEEXT_3)
+@ENABLE_CLIENT_TRUE@@ENABLE_SAMPLES_TRUE@am__append_1 = upnp_tv_ctrlpt
+@ENABLE_CLIENT_TRUE@@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@am__append_2 = upnp_tv_combo
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@am__append_3 = upnp_tv_device
+subdir = upnp/sample
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/m4/acx_pthread.m4 \
+	$(top_srcdir)/m4/ax_cflags_gcc_option.m4 \
+	$(top_srcdir)/m4/ax_cflags_warn_all.m4 \
+	$(top_srcdir)/m4/rt_bool_arg_enable.m4 \
+	$(top_srcdir)/m4/type_socklen_t.m4 $(top_srcdir)/configure.ac
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(install_sh) -d
+CONFIG_HEADER = $(top_builddir)/autoconfig.h \
+	$(top_builddir)/upnp/inc/upnpconfig.h
+CONFIG_CLEAN_FILES =
+@ENABLE_CLIENT_TRUE@@ENABLE_SAMPLES_TRUE@am__EXEEXT_1 = upnp_tv_ctrlpt$(EXEEXT)
+@ENABLE_CLIENT_TRUE@@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@am__EXEEXT_2 = upnp_tv_combo$(EXEEXT)
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@am__EXEEXT_3 = upnp_tv_device$(EXEEXT)
+PROGRAMS = $(noinst_PROGRAMS)
+am__dirstamp = $(am__leading_dot)dirstamp
+am_upnp_tv_combo_OBJECTS = common/upnp_tv_combo-sample_util.$(OBJEXT) \
+	tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.$(OBJEXT) \
+	tvcombo/upnp_tv_combo-upnp_tv_device.$(OBJEXT) \
+	tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.$(OBJEXT)
+upnp_tv_combo_OBJECTS = $(am_upnp_tv_combo_OBJECTS)
+upnp_tv_combo_LDADD = $(LDADD)
+upnp_tv_combo_DEPENDENCIES = $(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+am_upnp_tv_ctrlpt_OBJECTS =  \
+	common/upnp_tv_ctrlpt-sample_util.$(OBJEXT) \
+	tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.$(OBJEXT) \
+	tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.$(OBJEXT)
+upnp_tv_ctrlpt_OBJECTS = $(am_upnp_tv_ctrlpt_OBJECTS)
+upnp_tv_ctrlpt_LDADD = $(LDADD)
+upnp_tv_ctrlpt_DEPENDENCIES = $(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+am_upnp_tv_device_OBJECTS =  \
+	common/upnp_tv_device-sample_util.$(OBJEXT) \
+	tvdevice/upnp_tv_device-upnp_tv_device.$(OBJEXT) \
+	tvdevice/linux/upnp_tv_device-upnp_tv_device_main.$(OBJEXT)
+upnp_tv_device_OBJECTS = $(am_upnp_tv_device_OBJECTS)
+upnp_tv_device_LDADD = $(LDADD)
+upnp_tv_device_DEPENDENCIES = $(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir) -I$(top_builddir)/upnp/inc
+depcomp = $(SHELL) $(top_srcdir)/build-aux/depcomp
+am__depfiles_maybe = depfiles
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+LTCOMPILE = $(LIBTOOL) --tag=CC --mode=compile $(CC) $(DEFS) \
+	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
+	$(AM_CFLAGS) $(CFLAGS)
+CCLD = $(CC)
+LINK = $(LIBTOOL) --tag=CC --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(AM_LDFLAGS) $(LDFLAGS) -o $@
+SOURCES = $(upnp_tv_combo_SOURCES) $(upnp_tv_ctrlpt_SOURCES) \
+	$(upnp_tv_device_SOURCES)
+DIST_SOURCES = $(upnp_tv_combo_SOURCES) $(upnp_tv_ctrlpt_SOURCES) \
+	$(upnp_tv_device_SOURCES)
+am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
+am__vpath_adj = case $$p in \
+    $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
+    *) f=$$p;; \
+  esac;
+am__strip_dir = `echo $$p | sed -e 's|^.*/||'`;
+am__installdirs = "$(DESTDIR)$(examplesdir)"
+examplesDATA_INSTALL = $(INSTALL_DATA)
+DATA = $(examples_DATA)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
+AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+CC = @CC@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPP = @CPP@
+CPPFLAGS = @CPPFLAGS@
+CXX = @CXX@
+CXXCPP = @CXXCPP@
+CXXDEPMODE = @CXXDEPMODE@
+CXXFLAGS = @CXXFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+ECHO = @ECHO@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EGREP = @EGREP@
+ENABLE_CLIENT_FALSE = @ENABLE_CLIENT_FALSE@
+ENABLE_CLIENT_TRUE = @ENABLE_CLIENT_TRUE@
+ENABLE_DEBUG_FALSE = @ENABLE_DEBUG_FALSE@
+ENABLE_DEBUG_TRUE = @ENABLE_DEBUG_TRUE@
+ENABLE_DEVICE_FALSE = @ENABLE_DEVICE_FALSE@
+ENABLE_DEVICE_TRUE = @ENABLE_DEVICE_TRUE@
+ENABLE_SAMPLES_FALSE = @ENABLE_SAMPLES_FALSE@
+ENABLE_SAMPLES_TRUE = @ENABLE_SAMPLES_TRUE@
+ENABLE_TOOLS_FALSE = @ENABLE_TOOLS_FALSE@
+ENABLE_TOOLS_TRUE = @ENABLE_TOOLS_TRUE@
+ENABLE_WEBSERVER_FALSE = @ENABLE_WEBSERVER_FALSE@
+ENABLE_WEBSERVER_TRUE = @ENABLE_WEBSERVER_TRUE@
+EXEEXT = @EXEEXT@
+F77 = @F77@
+FFLAGS = @FFLAGS@
+GREP = @GREP@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LIBTOOL = @LIBTOOL@
+LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
+LT_VERSION_IXML = @LT_VERSION_IXML@
+LT_VERSION_THREADUTIL = @LT_VERSION_THREADUTIL@
+LT_VERSION_UPNP = @LT_VERSION_UPNP@
+MAKEINFO = @MAKEINFO@
+OBJEXT = @OBJEXT@
+PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
+PTHREAD_CC = @PTHREAD_CC@
+PTHREAD_CFLAGS = @PTHREAD_CFLAGS@
+PTHREAD_LIBS = @PTHREAD_LIBS@
+RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
+VERSION = @VERSION@
+WITH_DOCUMENTATION_FALSE = @WITH_DOCUMENTATION_FALSE@
+WITH_DOCUMENTATION_TRUE = @WITH_DOCUMENTATION_TRUE@
+ac_ct_CC = @ac_ct_CC@
+ac_ct_CXX = @ac_ct_CXX@
+ac_ct_F77 = @ac_ct_F77@
+acx_pthread_config = @acx_pthread_config@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
+am__fastdepCXX_TRUE = @am__fastdepCXX_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+am__tar = @am__tar@
+am__untar = @am__untar@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+datarootdir = @datarootdir@
+docdir = @docdir@
+dvidir = @dvidir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+htmldir = @htmldir@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localedir = @localedir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+pdfdir = @pdfdir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+psdir = @psdir@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/upnp/inc \
+	-I$(top_srcdir)/threadutil/inc \
+	-I$(top_srcdir)/ixml/inc
+
+LDADD = \
+	$(top_builddir)/upnp/libupnp.la \
+	$(top_builddir)/threadutil/libthreadutil.la \
+	$(top_builddir)/ixml/libixml.la
+
+@ENABLE_CLIENT_TRUE@@ENABLE_SAMPLES_TRUE@upnp_tv_ctrlpt_CPPFLAGS = \
+@ENABLE_CLIENT_TRUE@@ENABLE_SAMPLES_TRUE@	$(AM_CPPFLAGS) \
+@ENABLE_CLIENT_TRUE@@ENABLE_SAMPLES_TRUE@	-I$(srcdir)/common/ \
+@ENABLE_CLIENT_TRUE@@ENABLE_SAMPLES_TRUE@	-I$(srcdir)/tvctrlpt
+
+@ENABLE_CLIENT_TRUE@@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@upnp_tv_combo_CPPFLAGS = $(AM_CPPFLAGS) \
+@ENABLE_CLIENT_TRUE@@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	-I$(srcdir)/common/ \
+@ENABLE_CLIENT_TRUE@@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	-I$(srcdir)/tvcombo
+
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@upnp_tv_device_CPPFLAGS = \
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	$(AM_CPPFLAGS) \
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	-I$(srcdir)/common/ \
+@ENABLE_DEVICE_TRUE@@ENABLE_SAMPLES_TRUE@	-I$(srcdir)/tvdevice
+
+upnp_tv_device_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvdevice/upnp_tv_device.c \
+	tvdevice/upnp_tv_device.h \
+	tvdevice/linux/upnp_tv_device_main.c
+
+upnp_tv_ctrlpt_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvctrlpt/upnp_tv_ctrlpt.c \
+	tvctrlpt/upnp_tv_ctrlpt.h \
+	tvctrlpt/linux/upnp_tv_ctrlpt_main.c
+
+upnp_tv_combo_SOURCES = \
+	common/sample_util.c \
+	common/sample_util.h \
+	tvcombo/upnp_tv_ctrlpt.c \
+	tvcombo/upnp_tv_ctrlpt.h \
+	tvcombo/upnp_tv_device.c \
+	tvcombo/upnp_tv_device.h \
+	tvcombo/linux/upnp_tv_combo_main.c
+
+@WITH_DOCUMENTATION_TRUE@examplesdir = $(docdir)/examples
+@WITH_DOCUMENTATION_TRUE@examples_DATA = \
+@WITH_DOCUMENTATION_TRUE@		$(upnp_tv_ctrlpt_SOURCES) \
+@WITH_DOCUMENTATION_TRUE@		$(upnp_tv_device_SOURCES)
+
+EXTRA_DIST = \
+	web/tvcombodesc.xml \
+	web/tvcontrolSCPD.xml \
+	web/tvdevicedesc.xml \
+	web/tvdevicepres.html \
+	web/tvpictureSCPD.xml
+
+all: all-am
+
+.SUFFIXES:
+.SUFFIXES: .c .lo .o .obj
+$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --foreign  upnp/sample/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --foreign  upnp/sample/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure:  $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+clean-noinstPROGRAMS:
+	@list='$(noinst_PROGRAMS)'; for p in $$list; do \
+	  f=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
+	  echo " rm -f $$p $$f"; \
+	  rm -f $$p $$f ; \
+	done
+common/$(am__dirstamp):
+	@$(mkdir_p) common
+	@: > common/$(am__dirstamp)
+common/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) common/$(DEPDIR)
+	@: > common/$(DEPDIR)/$(am__dirstamp)
+common/upnp_tv_combo-sample_util.$(OBJEXT): common/$(am__dirstamp) \
+	common/$(DEPDIR)/$(am__dirstamp)
+tvcombo/$(am__dirstamp):
+	@$(mkdir_p) tvcombo
+	@: > tvcombo/$(am__dirstamp)
+tvcombo/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvcombo/$(DEPDIR)
+	@: > tvcombo/$(DEPDIR)/$(am__dirstamp)
+tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.$(OBJEXT):  \
+	tvcombo/$(am__dirstamp) tvcombo/$(DEPDIR)/$(am__dirstamp)
+tvcombo/upnp_tv_combo-upnp_tv_device.$(OBJEXT):  \
+	tvcombo/$(am__dirstamp) tvcombo/$(DEPDIR)/$(am__dirstamp)
+tvcombo/linux/$(am__dirstamp):
+	@$(mkdir_p) tvcombo/linux
+	@: > tvcombo/linux/$(am__dirstamp)
+tvcombo/linux/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvcombo/linux/$(DEPDIR)
+	@: > tvcombo/linux/$(DEPDIR)/$(am__dirstamp)
+tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.$(OBJEXT):  \
+	tvcombo/linux/$(am__dirstamp) \
+	tvcombo/linux/$(DEPDIR)/$(am__dirstamp)
+upnp_tv_combo$(EXEEXT): $(upnp_tv_combo_OBJECTS) $(upnp_tv_combo_DEPENDENCIES) 
+	@rm -f upnp_tv_combo$(EXEEXT)
+	$(LINK) $(upnp_tv_combo_LDFLAGS) $(upnp_tv_combo_OBJECTS) $(upnp_tv_combo_LDADD) $(LIBS)
+common/upnp_tv_ctrlpt-sample_util.$(OBJEXT): common/$(am__dirstamp) \
+	common/$(DEPDIR)/$(am__dirstamp)
+tvctrlpt/$(am__dirstamp):
+	@$(mkdir_p) tvctrlpt
+	@: > tvctrlpt/$(am__dirstamp)
+tvctrlpt/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvctrlpt/$(DEPDIR)
+	@: > tvctrlpt/$(DEPDIR)/$(am__dirstamp)
+tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.$(OBJEXT):  \
+	tvctrlpt/$(am__dirstamp) tvctrlpt/$(DEPDIR)/$(am__dirstamp)
+tvctrlpt/linux/$(am__dirstamp):
+	@$(mkdir_p) tvctrlpt/linux
+	@: > tvctrlpt/linux/$(am__dirstamp)
+tvctrlpt/linux/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvctrlpt/linux/$(DEPDIR)
+	@: > tvctrlpt/linux/$(DEPDIR)/$(am__dirstamp)
+tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.$(OBJEXT):  \
+	tvctrlpt/linux/$(am__dirstamp) \
+	tvctrlpt/linux/$(DEPDIR)/$(am__dirstamp)
+upnp_tv_ctrlpt$(EXEEXT): $(upnp_tv_ctrlpt_OBJECTS) $(upnp_tv_ctrlpt_DEPENDENCIES) 
+	@rm -f upnp_tv_ctrlpt$(EXEEXT)
+	$(LINK) $(upnp_tv_ctrlpt_LDFLAGS) $(upnp_tv_ctrlpt_OBJECTS) $(upnp_tv_ctrlpt_LDADD) $(LIBS)
+common/upnp_tv_device-sample_util.$(OBJEXT): common/$(am__dirstamp) \
+	common/$(DEPDIR)/$(am__dirstamp)
+tvdevice/$(am__dirstamp):
+	@$(mkdir_p) tvdevice
+	@: > tvdevice/$(am__dirstamp)
+tvdevice/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvdevice/$(DEPDIR)
+	@: > tvdevice/$(DEPDIR)/$(am__dirstamp)
+tvdevice/upnp_tv_device-upnp_tv_device.$(OBJEXT):  \
+	tvdevice/$(am__dirstamp) tvdevice/$(DEPDIR)/$(am__dirstamp)
+tvdevice/linux/$(am__dirstamp):
+	@$(mkdir_p) tvdevice/linux
+	@: > tvdevice/linux/$(am__dirstamp)
+tvdevice/linux/$(DEPDIR)/$(am__dirstamp):
+	@$(mkdir_p) tvdevice/linux/$(DEPDIR)
+	@: > tvdevice/linux/$(DEPDIR)/$(am__dirstamp)
+tvdevice/linux/upnp_tv_device-upnp_tv_device_main.$(OBJEXT):  \
+	tvdevice/linux/$(am__dirstamp) \
+	tvdevice/linux/$(DEPDIR)/$(am__dirstamp)
+upnp_tv_device$(EXEEXT): $(upnp_tv_device_OBJECTS) $(upnp_tv_device_DEPENDENCIES) 
+	@rm -f upnp_tv_device$(EXEEXT)
+	$(LINK) $(upnp_tv_device_LDFLAGS) $(upnp_tv_device_OBJECTS) $(upnp_tv_device_LDADD) $(LIBS)
+
+mostlyclean-compile:
+	-rm -f *.$(OBJEXT)
+	-rm -f common/upnp_tv_combo-sample_util.$(OBJEXT)
+	-rm -f common/upnp_tv_ctrlpt-sample_util.$(OBJEXT)
+	-rm -f common/upnp_tv_device-sample_util.$(OBJEXT)
+	-rm -f tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.$(OBJEXT)
+	-rm -f tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.$(OBJEXT)
+	-rm -f tvcombo/upnp_tv_combo-upnp_tv_device.$(OBJEXT)
+	-rm -f tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.$(OBJEXT)
+	-rm -f tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.$(OBJEXT)
+	-rm -f tvdevice/linux/upnp_tv_device-upnp_tv_device_main.$(OBJEXT)
+	-rm -f tvdevice/upnp_tv_device-upnp_tv_device.$(OBJEXT)
+
+distclean-compile:
+	-rm -f *.tab.c
+
+@AMDEP_TRUE@@am__include@ @am__quote@common/$(DEPDIR)/upnp_tv_combo-sample_util.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@common/$(DEPDIR)/upnp_tv_device-sample_util.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Po@am__quote@
+
+.c.o:
+@am__fastdepCC_TRUE@	depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.o$$||'`; \
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$$depbase.Tpo" -c -o $@ $<; \
+@am__fastdepCC_TRUE@	then mv -f "$$depbase.Tpo" "$$depbase.Po"; else rm -f "$$depbase.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c -o $@ $<
+
+.c.obj:
+@am__fastdepCC_TRUE@	depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.obj$$||'`; \
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$$depbase.Tpo" -c -o $@ `$(CYGPATH_W) '$<'`; \
+@am__fastdepCC_TRUE@	then mv -f "$$depbase.Tpo" "$$depbase.Po"; else rm -f "$$depbase.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c -o $@ `$(CYGPATH_W) '$<'`
+
+.c.lo:
+@am__fastdepCC_TRUE@	depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.lo$$||'`; \
+@am__fastdepCC_TRUE@	if $(LTCOMPILE) -MT $@ -MD -MP -MF "$$depbase.Tpo" -c -o $@ $<; \
+@am__fastdepCC_TRUE@	then mv -f "$$depbase.Tpo" "$$depbase.Plo"; else rm -f "$$depbase.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LTCOMPILE) -c -o $@ $<
+
+common/upnp_tv_combo-sample_util.o: common/sample_util.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_combo-sample_util.o -MD -MP -MF "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo" -c -o common/upnp_tv_combo-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c; \
+@am__fastdepCC_TRUE@	then mv -f "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_combo-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='common/sample_util.c' object='common/upnp_tv_combo-sample_util.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_combo-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c
+
+common/upnp_tv_combo-sample_util.obj: common/sample_util.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_combo-sample_util.obj -MD -MP -MF "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo" -c -o common/upnp_tv_combo-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_combo-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_combo-sample_util.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='common/sample_util.c' object='common/upnp_tv_combo-sample_util.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_combo-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`
+
+tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o: tvcombo/upnp_tv_ctrlpt.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o -MD -MP -MF "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo" -c -o tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o `test -f 'tvcombo/upnp_tv_ctrlpt.c' || echo '$(srcdir)/'`tvcombo/upnp_tv_ctrlpt.c; \
+@am__fastdepCC_TRUE@	then mv -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo" "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Po"; else rm -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvcombo/upnp_tv_ctrlpt.c' object='tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o `test -f 'tvcombo/upnp_tv_ctrlpt.c' || echo '$(srcdir)/'`tvcombo/upnp_tv_ctrlpt.c
+
+tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.obj: tvcombo/upnp_tv_ctrlpt.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.obj -MD -MP -MF "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo" -c -o tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.obj `if test -f 'tvcombo/upnp_tv_ctrlpt.c'; then $(CYGPATH_W) 'tvcombo/upnp_tv_ctrlpt.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/upnp_tv_ctrlpt.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo" "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Po"; else rm -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_ctrlpt.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvcombo/upnp_tv_ctrlpt.c' object='tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.obj `if test -f 'tvcombo/upnp_tv_ctrlpt.c'; then $(CYGPATH_W) 'tvcombo/upnp_tv_ctrlpt.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/upnp_tv_ctrlpt.c'; fi`
+
+tvcombo/upnp_tv_combo-upnp_tv_device.o: tvcombo/upnp_tv_device.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/upnp_tv_combo-upnp_tv_device.o -MD -MP -MF "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo" -c -o tvcombo/upnp_tv_combo-upnp_tv_device.o `test -f 'tvcombo/upnp_tv_device.c' || echo '$(srcdir)/'`tvcombo/upnp_tv_device.c; \
+@am__fastdepCC_TRUE@	then mv -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo" "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Po"; else rm -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvcombo/upnp_tv_device.c' object='tvcombo/upnp_tv_combo-upnp_tv_device.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/upnp_tv_combo-upnp_tv_device.o `test -f 'tvcombo/upnp_tv_device.c' || echo '$(srcdir)/'`tvcombo/upnp_tv_device.c
+
+tvcombo/upnp_tv_combo-upnp_tv_device.obj: tvcombo/upnp_tv_device.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/upnp_tv_combo-upnp_tv_device.obj -MD -MP -MF "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo" -c -o tvcombo/upnp_tv_combo-upnp_tv_device.obj `if test -f 'tvcombo/upnp_tv_device.c'; then $(CYGPATH_W) 'tvcombo/upnp_tv_device.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/upnp_tv_device.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo" "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Po"; else rm -f "tvcombo/$(DEPDIR)/upnp_tv_combo-upnp_tv_device.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvcombo/upnp_tv_device.c' object='tvcombo/upnp_tv_combo-upnp_tv_device.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/upnp_tv_combo-upnp_tv_device.obj `if test -f 'tvcombo/upnp_tv_device.c'; then $(CYGPATH_W) 'tvcombo/upnp_tv_device.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/upnp_tv_device.c'; fi`
+
+tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o: tvcombo/linux/upnp_tv_combo_main.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o -MD -MP -MF "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo" -c -o tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o `test -f 'tvcombo/linux/upnp_tv_combo_main.c' || echo '$(srcdir)/'`tvcombo/linux/upnp_tv_combo_main.c; \
+@am__fastdepCC_TRUE@	then mv -f "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo" "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Po"; else rm -f "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvcombo/linux/upnp_tv_combo_main.c' object='tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o `test -f 'tvcombo/linux/upnp_tv_combo_main.c' || echo '$(srcdir)/'`tvcombo/linux/upnp_tv_combo_main.c
+
+tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.obj: tvcombo/linux/upnp_tv_combo_main.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.obj -MD -MP -MF "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo" -c -o tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.obj `if test -f 'tvcombo/linux/upnp_tv_combo_main.c'; then $(CYGPATH_W) 'tvcombo/linux/upnp_tv_combo_main.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/linux/upnp_tv_combo_main.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo" "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Po"; else rm -f "tvcombo/linux/$(DEPDIR)/upnp_tv_combo-upnp_tv_combo_main.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvcombo/linux/upnp_tv_combo_main.c' object='tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_combo_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.obj `if test -f 'tvcombo/linux/upnp_tv_combo_main.c'; then $(CYGPATH_W) 'tvcombo/linux/upnp_tv_combo_main.c'; else $(CYGPATH_W) '$(srcdir)/tvcombo/linux/upnp_tv_combo_main.c'; fi`
+
+common/upnp_tv_ctrlpt-sample_util.o: common/sample_util.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_ctrlpt-sample_util.o -MD -MP -MF "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo" -c -o common/upnp_tv_ctrlpt-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c; \
+@am__fastdepCC_TRUE@	then mv -f "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='common/sample_util.c' object='common/upnp_tv_ctrlpt-sample_util.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_ctrlpt-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c
+
+common/upnp_tv_ctrlpt-sample_util.obj: common/sample_util.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_ctrlpt-sample_util.obj -MD -MP -MF "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo" -c -o common/upnp_tv_ctrlpt-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_ctrlpt-sample_util.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='common/sample_util.c' object='common/upnp_tv_ctrlpt-sample_util.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_ctrlpt-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`
+
+tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o: tvctrlpt/upnp_tv_ctrlpt.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o -MD -MP -MF "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo" -c -o tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o `test -f 'tvctrlpt/upnp_tv_ctrlpt.c' || echo '$(srcdir)/'`tvctrlpt/upnp_tv_ctrlpt.c; \
+@am__fastdepCC_TRUE@	then mv -f "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo" "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Po"; else rm -f "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvctrlpt/upnp_tv_ctrlpt.c' object='tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o `test -f 'tvctrlpt/upnp_tv_ctrlpt.c' || echo '$(srcdir)/'`tvctrlpt/upnp_tv_ctrlpt.c
+
+tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.obj: tvctrlpt/upnp_tv_ctrlpt.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.obj -MD -MP -MF "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo" -c -o tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.obj `if test -f 'tvctrlpt/upnp_tv_ctrlpt.c'; then $(CYGPATH_W) 'tvctrlpt/upnp_tv_ctrlpt.c'; else $(CYGPATH_W) '$(srcdir)/tvctrlpt/upnp_tv_ctrlpt.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo" "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Po"; else rm -f "tvctrlpt/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvctrlpt/upnp_tv_ctrlpt.c' object='tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.obj `if test -f 'tvctrlpt/upnp_tv_ctrlpt.c'; then $(CYGPATH_W) 'tvctrlpt/upnp_tv_ctrlpt.c'; else $(CYGPATH_W) '$(srcdir)/tvctrlpt/upnp_tv_ctrlpt.c'; fi`
+
+tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o: tvctrlpt/linux/upnp_tv_ctrlpt_main.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o -MD -MP -MF "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo" -c -o tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o `test -f 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c' || echo '$(srcdir)/'`tvctrlpt/linux/upnp_tv_ctrlpt_main.c; \
+@am__fastdepCC_TRUE@	then mv -f "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo" "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Po"; else rm -f "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvctrlpt/linux/upnp_tv_ctrlpt_main.c' object='tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o `test -f 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c' || echo '$(srcdir)/'`tvctrlpt/linux/upnp_tv_ctrlpt_main.c
+
+tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.obj: tvctrlpt/linux/upnp_tv_ctrlpt_main.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.obj -MD -MP -MF "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo" -c -o tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.obj `if test -f 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; then $(CYGPATH_W) 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; else $(CYGPATH_W) '$(srcdir)/tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo" "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Po"; else rm -f "tvctrlpt/linux/$(DEPDIR)/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvctrlpt/linux/upnp_tv_ctrlpt_main.c' object='tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_ctrlpt_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.obj `if test -f 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; then $(CYGPATH_W) 'tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; else $(CYGPATH_W) '$(srcdir)/tvctrlpt/linux/upnp_tv_ctrlpt_main.c'; fi`
+
+common/upnp_tv_device-sample_util.o: common/sample_util.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_device-sample_util.o -MD -MP -MF "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo" -c -o common/upnp_tv_device-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c; \
+@am__fastdepCC_TRUE@	then mv -f "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_device-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='common/sample_util.c' object='common/upnp_tv_device-sample_util.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_device-sample_util.o `test -f 'common/sample_util.c' || echo '$(srcdir)/'`common/sample_util.c
+
+common/upnp_tv_device-sample_util.obj: common/sample_util.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT common/upnp_tv_device-sample_util.obj -MD -MP -MF "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo" -c -o common/upnp_tv_device-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo" "common/$(DEPDIR)/upnp_tv_device-sample_util.Po"; else rm -f "common/$(DEPDIR)/upnp_tv_device-sample_util.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='common/sample_util.c' object='common/upnp_tv_device-sample_util.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o common/upnp_tv_device-sample_util.obj `if test -f 'common/sample_util.c'; then $(CYGPATH_W) 'common/sample_util.c'; else $(CYGPATH_W) '$(srcdir)/common/sample_util.c'; fi`
+
+tvdevice/upnp_tv_device-upnp_tv_device.o: tvdevice/upnp_tv_device.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvdevice/upnp_tv_device-upnp_tv_device.o -MD -MP -MF "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo" -c -o tvdevice/upnp_tv_device-upnp_tv_device.o `test -f 'tvdevice/upnp_tv_device.c' || echo '$(srcdir)/'`tvdevice/upnp_tv_device.c; \
+@am__fastdepCC_TRUE@	then mv -f "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo" "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Po"; else rm -f "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvdevice/upnp_tv_device.c' object='tvdevice/upnp_tv_device-upnp_tv_device.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvdevice/upnp_tv_device-upnp_tv_device.o `test -f 'tvdevice/upnp_tv_device.c' || echo '$(srcdir)/'`tvdevice/upnp_tv_device.c
+
+tvdevice/upnp_tv_device-upnp_tv_device.obj: tvdevice/upnp_tv_device.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvdevice/upnp_tv_device-upnp_tv_device.obj -MD -MP -MF "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo" -c -o tvdevice/upnp_tv_device-upnp_tv_device.obj `if test -f 'tvdevice/upnp_tv_device.c'; then $(CYGPATH_W) 'tvdevice/upnp_tv_device.c'; else $(CYGPATH_W) '$(srcdir)/tvdevice/upnp_tv_device.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo" "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Po"; else rm -f "tvdevice/$(DEPDIR)/upnp_tv_device-upnp_tv_device.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvdevice/upnp_tv_device.c' object='tvdevice/upnp_tv_device-upnp_tv_device.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvdevice/upnp_tv_device-upnp_tv_device.obj `if test -f 'tvdevice/upnp_tv_device.c'; then $(CYGPATH_W) 'tvdevice/upnp_tv_device.c'; else $(CYGPATH_W) '$(srcdir)/tvdevice/upnp_tv_device.c'; fi`
+
+tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o: tvdevice/linux/upnp_tv_device_main.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o -MD -MP -MF "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo" -c -o tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o `test -f 'tvdevice/linux/upnp_tv_device_main.c' || echo '$(srcdir)/'`tvdevice/linux/upnp_tv_device_main.c; \
+@am__fastdepCC_TRUE@	then mv -f "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo" "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Po"; else rm -f "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvdevice/linux/upnp_tv_device_main.c' object='tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o `test -f 'tvdevice/linux/upnp_tv_device_main.c' || echo '$(srcdir)/'`tvdevice/linux/upnp_tv_device_main.c
+
+tvdevice/linux/upnp_tv_device-upnp_tv_device_main.obj: tvdevice/linux/upnp_tv_device_main.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT tvdevice/linux/upnp_tv_device-upnp_tv_device_main.obj -MD -MP -MF "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo" -c -o tvdevice/linux/upnp_tv_device-upnp_tv_device_main.obj `if test -f 'tvdevice/linux/upnp_tv_device_main.c'; then $(CYGPATH_W) 'tvdevice/linux/upnp_tv_device_main.c'; else $(CYGPATH_W) '$(srcdir)/tvdevice/linux/upnp_tv_device_main.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo" "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Po"; else rm -f "tvdevice/linux/$(DEPDIR)/upnp_tv_device-upnp_tv_device_main.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='tvdevice/linux/upnp_tv_device_main.c' object='tvdevice/linux/upnp_tv_device-upnp_tv_device_main.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(upnp_tv_device_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o tvdevice/linux/upnp_tv_device-upnp_tv_device_main.obj `if test -f 'tvdevice/linux/upnp_tv_device_main.c'; then $(CYGPATH_W) 'tvdevice/linux/upnp_tv_device_main.c'; else $(CYGPATH_W) '$(srcdir)/tvdevice/linux/upnp_tv_device_main.c'; fi`
+
+mostlyclean-libtool:
+	-rm -f *.lo
+
+clean-libtool:
+	-rm -rf .libs _libs
+
+distclean-libtool:
+	-rm -f libtool
+uninstall-info-am:
+install-examplesDATA: $(examples_DATA)
+	@$(NORMAL_INSTALL)
+	test -z "$(examplesdir)" || $(mkdir_p) "$(DESTDIR)$(examplesdir)"
+	@list='$(examples_DATA)'; for p in $$list; do \
+	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
+	  f=$(am__strip_dir) \
+	  echo " $(examplesDATA_INSTALL) '$$d$$p' '$(DESTDIR)$(examplesdir)/$$f'"; \
+	  $(examplesDATA_INSTALL) "$$d$$p" "$(DESTDIR)$(examplesdir)/$$f"; \
+	done
+
+uninstall-examplesDATA:
+	@$(NORMAL_UNINSTALL)
+	@list='$(examples_DATA)'; for p in $$list; do \
+	  f=$(am__strip_dir) \
+	  echo " rm -f '$(DESTDIR)$(examplesdir)/$$f'"; \
+	  rm -f "$(DESTDIR)$(examplesdir)/$$f"; \
+	done
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	if test -z "$(ETAGS_ARGS)$$tags$$unique"; then :; else \
+	  test -n "$$unique" || unique=$$empty_fix; \
+	  $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	    $$tags $$unique; \
+	fi
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	$(mkdir_p) $(distdir)/web
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
+	  if test -d $$d/$$file; then \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
+	  else \
+	    test -f $(distdir)/$$file \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-am
+all-am: Makefile $(PROGRAMS) $(DATA)
+installdirs:
+	for dir in "$(DESTDIR)$(examplesdir)"; do \
+	  test -z "$$dir" || $(mkdir_p) "$$dir"; \
+	done
+install: install-am
+install-exec: install-exec-am
+install-data: install-data-am
+uninstall: uninstall-am
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+mostlyclean-generic:
+
+clean-generic:
+
+distclean-generic:
+	-test -z "$(CONFIG_CLEAN_FILES)" || rm -f $(CONFIG_CLEAN_FILES)
+	-rm -f common/$(DEPDIR)/$(am__dirstamp)
+	-rm -f common/$(am__dirstamp)
+	-rm -f tvcombo/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvcombo/$(am__dirstamp)
+	-rm -f tvcombo/linux/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvcombo/linux/$(am__dirstamp)
+	-rm -f tvctrlpt/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvctrlpt/$(am__dirstamp)
+	-rm -f tvctrlpt/linux/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvctrlpt/linux/$(am__dirstamp)
+	-rm -f tvdevice/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvdevice/$(am__dirstamp)
+	-rm -f tvdevice/linux/$(DEPDIR)/$(am__dirstamp)
+	-rm -f tvdevice/linux/$(am__dirstamp)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
+
+clean-am: clean-generic clean-libtool clean-noinstPROGRAMS \
+	mostlyclean-am
+
+distclean: distclean-am
+	-rm -rf common/$(DEPDIR) tvcombo/$(DEPDIR) tvcombo/linux/$(DEPDIR) tvctrlpt/$(DEPDIR) tvctrlpt/linux/$(DEPDIR) tvdevice/$(DEPDIR) tvdevice/linux/$(DEPDIR)
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-libtool distclean-tags
+
+dvi: dvi-am
+
+dvi-am:
+
+html: html-am
+
+info: info-am
+
+info-am:
+
+install-data-am: install-examplesDATA
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-am
+	-rm -rf common/$(DEPDIR) tvcombo/$(DEPDIR) tvcombo/linux/$(DEPDIR) tvctrlpt/$(DEPDIR) tvctrlpt/linux/$(DEPDIR) tvdevice/$(DEPDIR) tvdevice/linux/$(DEPDIR)
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-compile mostlyclean-generic \
+	mostlyclean-libtool
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
+
+uninstall-am: uninstall-examplesDATA uninstall-info-am
+
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
+	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	distclean-compile distclean-generic distclean-libtool \
+	distclean-tags distdir dvi dvi-am html html-am info info-am \
+	install install-am install-data install-data-am \
+	install-examplesDATA install-exec install-exec-am install-info \
+	install-info-am install-man install-strip installcheck \
+	installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-compile \
+	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
+	tags uninstall uninstall-am uninstall-examplesDATA \
+	uninstall-info-am
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvcombo/linux/upnp_tv_combo_main.c libupnp-1.6.6-mod/upnp/sample-orig/tvcombo/linux/upnp_tv_combo_main.c
--- libupnp-1.6.6/upnp/sample-orig/tvcombo/linux/upnp_tv_combo_main.c	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvcombo/linux/upnp_tv_combo_main.c	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,491 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+
+#include "sample_util.h"
+#include "upnp_tv_ctrlpt.h"
+#include "upnp_tv_device.h"
+
+
+#include <stdio.h>
+#include <string.h>
+
+/*
+   Tags for valid commands issued at the command prompt 
+ */
+enum cmdloop_tvcmds {
+    PRTHELP = 0, PRTFULLHELP, POWON, POWOFF,
+    SETCHAN, SETVOL, SETCOL, SETTINT, SETCONT, SETBRT,
+    CTRLACTION, PICTACTION, CTRLGETVAR, PICTGETVAR,
+    PRTDEV, LSTDEV, REFRESH, EXITCMD
+};
+
+/*
+   Data structure for parsing commands from the command line 
+ */
+struct cmdloop_commands {
+    char *str;                  // the string 
+    int cmdnum;                 // the command
+    int numargs;                // the number of arguments
+    char *args;                 // the args
+} cmdloop_commands;
+
+/*
+   Mappings between command text names, command tag,
+   and required command arguments for command line
+   commands 
+ */
+static struct cmdloop_commands cmdloop_cmdlist[] = {
+    {"Help", PRTHELP, 1, ""},
+    {"HelpFull", PRTFULLHELP, 1, ""},
+    {"ListDev", LSTDEV, 1, ""},
+    {"Refresh", REFRESH, 1, ""},
+    {"PrintDev", PRTDEV, 2, "<devnum>"},
+    {"PowerOn", POWON, 2, "<devnum>"},
+    {"PowerOff", POWOFF, 2, "<devnum>"},
+    {"SetChannel", SETCHAN, 3, "<devnum> <channel (int)>"},
+    {"SetVolume", SETVOL, 3, "<devnum> <volume (int)>"},
+    {"SetColor", SETCOL, 3, "<devnum> <color (int)>"},
+    {"SetTint", SETTINT, 3, "<devnum> <tint (int)>"},
+    {"SetContrast", SETCONT, 3, "<devnum> <contrast (int)>"},
+    {"SetBrightness", SETBRT, 3, "<devnum> <brightness (int)>"},
+    {"CtrlAction", CTRLACTION, 2, "<devnum> <action (string)>"},
+    {"PictAction", PICTACTION, 2, "<devnum> <action (string)>"},
+    {"CtrlGetVar", CTRLGETVAR, 2, "<devnum> <varname (string)>"},
+    {"PictGetVar", PICTGETVAR, 2, "<devnum> <varname (string)>"},
+    {"Exit", EXITCMD, 1, ""}
+};
+
+void
+linux_print( const char *string )
+{
+    puts( string );
+}
+
+/********************************************************************************
+ * TvCtrlPointPrintHelp
+ *
+ * Description: 
+ *       Print help info for this application.
+ ********************************************************************************/
+void
+TvCtrlPointPrintShortHelp( void )
+{
+    SampleUtil_Print( "Commands:" );
+    SampleUtil_Print( "  Help" );
+    SampleUtil_Print( "  HelpFull" );
+    SampleUtil_Print( "  ListDev" );
+    SampleUtil_Print( "  Refresh" );
+    SampleUtil_Print( "  PrintDev      <devnum>" );
+    SampleUtil_Print( "  PowerOn       <devnum>" );
+    SampleUtil_Print( "  PowerOff      <devnum>" );
+    SampleUtil_Print( "  SetChannel    <devnum> <channel>" );
+    SampleUtil_Print( "  SetVolume     <devnum> <volume>" );
+    SampleUtil_Print( "  SetColor      <devnum> <color>" );
+    SampleUtil_Print( "  SetTint       <devnum> <tint>" );
+    SampleUtil_Print( "  SetContrast   <devnum> <contrast>" );
+    SampleUtil_Print( "  SetBrightness <devnum> <brightness>" );
+    SampleUtil_Print( "  CtrlAction    <devnum> <action>" );
+    SampleUtil_Print( "  PictAction    <devnum> <action>" );
+    SampleUtil_Print( "  CtrlGetVar    <devnum> <varname>" );
+    SampleUtil_Print( "  PictGetVar    <devnum> <action>" );
+    SampleUtil_Print( "  Exit" );
+}
+
+void
+TvCtrlPointPrintLongHelp( void )
+{
+    SampleUtil_Print( "" );
+    SampleUtil_Print( "******************************" );
+    SampleUtil_Print( "* TV Control Point Help Info *" );
+    SampleUtil_Print( "******************************" );
+    SampleUtil_Print( "" );
+    SampleUtil_Print( "This sample control point application automatically searches" );
+    SampleUtil_Print( "for and subscribes to the services of television device emulator" );
+    SampleUtil_Print( "devices. While registers a tv device itself." );
+    SampleUtil_Print( "" );
+    SampleUtil_Print( "Commands:" );
+    SampleUtil_Print( "  Help" );
+    SampleUtil_Print( "       Print this help info." );
+    SampleUtil_Print( "  ListDev" );
+    SampleUtil_Print( "       Print the current list of TV Device Emulators that this" );
+    SampleUtil_Print( "         control point is aware of.  Each device is preceded by a" );
+    SampleUtil_Print( "         device number which corresponds to the devnum argument of" );
+    SampleUtil_Print( "         commands listed below." );
+    SampleUtil_Print( "  Refresh" );
+    SampleUtil_Print( "       Delete all of the devices from the device list and issue new" );
+    SampleUtil_Print( "         search request to rebuild the list from scratch." );
+    SampleUtil_Print( "  PrintDev       <devnum>" );
+    SampleUtil_Print( "       Print the state table for the device <devnum>." );
+    SampleUtil_Print( "         e.g., 'PrintDev 1' prints the state table for the first" );
+    SampleUtil_Print( "         device in the device list." );
+    SampleUtil_Print( "  PowerOn        <devnum>" );
+    SampleUtil_Print( "       Sends the PowerOn action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>." );
+    SampleUtil_Print( "  PowerOff       <devnum>" );
+    SampleUtil_Print( "       Sends the PowerOff action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>." );
+    SampleUtil_Print( "  SetChannel     <devnum> <channel>" );
+    SampleUtil_Print( "       Sends the SetChannel action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the channel to be changed" );
+    SampleUtil_Print( "         to <channel>." );
+    SampleUtil_Print( "  SetVolume      <devnum> <volume>" );
+    SampleUtil_Print( "       Sends the SetVolume action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the volume to be changed" );
+    SampleUtil_Print( "         to <volume>." );
+    SampleUtil_Print( "  SetColor       <devnum> <color>" );
+    SampleUtil_Print( "       Sends the SetColor action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the color to be changed" );
+    SampleUtil_Print( "         to <color>." );
+    SampleUtil_Print( "  SetTint        <devnum> <tint>" );
+    SampleUtil_Print( "       Sends the SetTint action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the tint to be changed" );
+    SampleUtil_Print( "         to <tint>." );
+    SampleUtil_Print( "  SetContrast    <devnum> <contrast>" );
+    SampleUtil_Print( "       Sends the SetContrast action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the contrast to be changed" );
+    SampleUtil_Print( "         to <contrast>." );
+    SampleUtil_Print( "  SetBrightness  <devnum> <brightness>" );
+    SampleUtil_Print( "       Sends the SetBrightness action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the brightness to be changed" );
+    SampleUtil_Print( "         to <brightness>." );
+    SampleUtil_Print( "  CtrlAction     <devnum> <action>" );
+    SampleUtil_Print( "       Sends an action request specified by the string <action>" );
+    SampleUtil_Print( "         to the Control Service of device <devnum>.  This command" );
+    SampleUtil_Print( "         only works for actions that have no arguments." );
+    SampleUtil_Print( "         (e.g., \"CtrlAction 1 IncreaseChannel\")" );
+    SampleUtil_Print( "  PictAction     <devnum> <action>" );
+    SampleUtil_Print( "       Sends an action request specified by the string <action>" );
+    SampleUtil_Print( "         to the Picture Service of device <devnum>.  This command" );
+    SampleUtil_Print( "         only works for actions that have no arguments." );
+    SampleUtil_Print( "         (e.g., \"PictAction 1 DecreaseContrast\")" );
+    SampleUtil_Print( "  CtrlGetVar     <devnum> <varname>" );
+    SampleUtil_Print( "       Requests the value of a variable specified by the string <varname>" );
+    SampleUtil_Print( "         from the Control Service of device <devnum>." );
+    SampleUtil_Print( "         (e.g., \"CtrlGetVar 1 Volume\")" );
+    SampleUtil_Print( "  PictGetVar     <devnum> <action>" );
+    SampleUtil_Print( "       Requests the value of a variable specified by the string <varname>" );
+    SampleUtil_Print( "         from the Picture Service of device <devnum>." );
+    SampleUtil_Print( "         (e.g., \"PictGetVar 1 Tint\")" );
+    SampleUtil_Print( "  Exit" );
+    SampleUtil_Print( "       Exits the control point application." );
+}
+
+/********************************************************************************
+ * TvCtrlPointPrintCommands
+ *
+ * Description: 
+ *       Print the list of valid command line commands to the user
+ *
+ * Parameters:
+ *   None
+ *
+ ********************************************************************************/
+void
+TvCtrlPointPrintCommands()
+{
+    int i;
+    int numofcmds = sizeof( cmdloop_cmdlist ) / sizeof( cmdloop_commands );
+
+    SampleUtil_Print( "Valid Commands:" );
+    for( i = 0; i < numofcmds; i++ ) {
+        SampleUtil_Print( "  %-14s %s", cmdloop_cmdlist[i].str,
+                          cmdloop_cmdlist[i].args );
+    }
+    SampleUtil_Print( "" );
+}
+
+/********************************************************************************
+ * TvCtrlPointCommandLoop
+ *
+ * Description: 
+ *       Function that receives commands from the user at the command prompt
+ *       during the lifetime of the control point, and calls the appropriate
+ *       functions for those commands.
+ *
+ * Parameters:
+ *    None
+ *
+ ********************************************************************************/
+void *
+TvCtrlPointCommandLoop( void *args )
+{
+    char cmdline[100];
+
+    while( 1 ) {
+        SampleUtil_Print( "\n>> " );
+        fgets( cmdline, 100, stdin );
+        TvCtrlPointProcessCommand( cmdline );
+    }
+
+    return NULL;
+}
+
+int
+TvCtrlPointProcessCommand( char *cmdline )
+{
+    char cmd[100];
+    char strarg[100];
+    int arg_val_err = -99999;
+    int arg1 = arg_val_err;
+    int arg2 = arg_val_err;
+    int cmdnum = -1;
+    int numofcmds = sizeof( cmdloop_cmdlist ) / sizeof( cmdloop_commands );
+    int cmdfound = 0;
+    int i,
+      rc;
+    int invalidargs = 0;
+    int validargs;
+
+    validargs = sscanf( cmdline, "%s %d %d", cmd, &arg1, &arg2 );
+
+    for( i = 0; i < numofcmds; i++ ) {
+        if( strcasecmp( cmd, cmdloop_cmdlist[i].str ) == 0 ) {
+            cmdnum = cmdloop_cmdlist[i].cmdnum;
+            cmdfound++;
+            if( validargs != cmdloop_cmdlist[i].numargs )
+                invalidargs++;
+            break;
+        }
+    }
+
+    if( !cmdfound ) {
+        SampleUtil_Print( "Command not found; try 'Help'" );
+        return TV_SUCCESS;
+    }
+
+    if( invalidargs ) {
+        SampleUtil_Print( "Invalid arguments; try 'Help'" );
+        return TV_SUCCESS;
+    }
+
+    switch ( cmdnum ) {
+        case PRTHELP:
+            TvCtrlPointPrintShortHelp();
+            break;
+
+        case PRTFULLHELP:
+            TvCtrlPointPrintLongHelp();
+            break;
+
+        case POWON:
+            TvCtrlPointSendPowerOn( arg1 );
+            break;
+
+        case POWOFF:
+            TvCtrlPointSendPowerOff( arg1 );
+            break;
+
+        case SETCHAN:
+            TvCtrlPointSendSetChannel( arg1, arg2 );
+            break;
+
+        case SETVOL:
+            TvCtrlPointSendSetVolume( arg1, arg2 );
+            break;
+
+        case SETCOL:
+            TvCtrlPointSendSetColor( arg1, arg2 );
+            break;
+
+        case SETTINT:
+            TvCtrlPointSendSetTint( arg1, arg2 );
+            break;
+
+        case SETCONT:
+            TvCtrlPointSendSetContrast( arg1, arg2 );
+            break;
+
+        case SETBRT:
+            TvCtrlPointSendSetBrightness( arg1, arg2 );
+            break;
+
+        case CTRLACTION:
+            /*
+               re-parse commandline since second arg is string 
+             */
+            validargs = sscanf( cmdline, "%s %d %s", cmd, &arg1, strarg );
+            if( 3 == validargs )
+                TvCtrlPointSendAction( TV_SERVICE_CONTROL, arg1, strarg,
+                                       NULL, NULL, 0 );
+            else
+                invalidargs++;
+            break;
+
+        case PICTACTION:
+            /*
+               re-parse commandline since second arg is string 
+             */
+            validargs = sscanf( cmdline, "%s %d %s", cmd, &arg1, strarg );
+            if( 3 == validargs )
+                TvCtrlPointSendAction( TV_SERVICE_PICTURE, arg1, strarg,
+                                       NULL, NULL, 0 );
+            else
+                invalidargs++;
+            break;
+
+        case CTRLGETVAR:
+            /*
+               re-parse commandline since second arg is string 
+             */
+            validargs = sscanf( cmdline, "%s %d %s", cmd, &arg1, strarg );
+            if( 3 == validargs )
+                TvCtrlPointGetVar( TV_SERVICE_CONTROL, arg1, strarg );
+            else
+                invalidargs++;
+            break;
+
+        case PICTGETVAR:
+            /*
+               re-parse commandline since second arg is string 
+             */
+            validargs = sscanf( cmdline, "%s %d %s", cmd, &arg1, strarg );
+            if( 3 == validargs )
+                TvCtrlPointGetVar( TV_SERVICE_PICTURE, arg1, strarg );
+            else
+                invalidargs++;
+            break;
+
+        case PRTDEV:
+            TvCtrlPointPrintDevice( arg1 );
+            break;
+
+        case LSTDEV:
+            TvCtrlPointPrintList();
+            break;
+
+        case REFRESH:
+            TvCtrlPointRefresh();
+            break;
+
+        case EXITCMD:
+            rc = TvCtrlPointStop();
+            exit( rc );
+            break;
+
+        default:
+            SampleUtil_Print( "Command not implemented; see 'Help'" );
+            break;
+    }
+
+    if( invalidargs )
+        SampleUtil_Print( "Invalid args in command; see 'Help'" );
+
+    return TV_SUCCESS;
+}
+
+int
+device_main( int argc, char **argv )
+{
+
+    unsigned int portTemp = 0;
+    char *ip_address = NULL,
+     *desc_doc_name = NULL,
+     *web_dir_path = NULL;
+    unsigned int port = 0;
+
+    int i = 0;
+
+    SampleUtil_Initialize( linux_print );
+
+    // Parse options
+    for( i = 1; i < argc; i++ ) {
+        if( strcmp( argv[i], "-ip" ) == 0 ) {
+            ip_address = argv[++i];
+        } else if( strcmp( argv[i], "-port" ) == 0 ) {
+            sscanf( argv[++i], "%u", &portTemp );
+        } else if( strcmp( argv[i], "-desc" ) == 0 ) {
+            desc_doc_name = argv[++i];
+        } else if( strcmp( argv[i], "-webdir" ) == 0 ) {
+            web_dir_path = argv[++i];
+        } else if( strcmp( argv[i], "-help" ) == 0 ) {
+            SampleUtil_Print( "Usage: %s -ip ipaddress -port port"
+                              " -desc desc_doc_name -webdir web_dir_path"
+                              " -help (this message)\n", argv[0] );
+            SampleUtil_Print( "\tipaddress:     IP address of the device"
+                              " (must match desc. doc)\n" );
+            SampleUtil_Print( "\t\te.g.: 192.168.0.4\n" );
+            SampleUtil_Print( "\tport:          Port number to use for "
+                              "receiving UPnP messages (must match desc. doc)\n" );
+            SampleUtil_Print( "\t\te.g.: 5431\n" );
+            SampleUtil_Print
+                ( "\tdesc_doc_name: name of device description document\n" );
+            SampleUtil_Print( "\t\te.g.: tvcombodesc.xml\n" );
+            SampleUtil_Print
+                ( "\tweb_dir_path: Filesystem path where web files "
+                  "related to the device are stored\n" );
+            SampleUtil_Print( "\t\te.g.: /upnp/sample/web\n" );
+            return 1;
+        }
+    }
+
+    port = ( unsigned short )portTemp;
+
+    return TvDeviceStart( ip_address, port, desc_doc_name, web_dir_path, linux_print );
+}
+
+int main( int argc, char **argv )
+{
+    int rc;
+    ithread_t cmdloop_thread;
+#ifndef WIN32
+    int sig;
+    sigset_t sigs_to_catch;
+#endif
+    int code;
+
+    device_main(argc, argv);
+    rc = TvCtrlPointStart( linux_print, NULL );
+    if( rc != TV_SUCCESS ) {
+        SampleUtil_Print( "Error starting UPnP TV Control Point" );
+        return rc;
+    }
+    /* start a command loop thread */
+    code = ithread_create( &cmdloop_thread, NULL, TvCtrlPointCommandLoop, NULL );
+
+#ifndef WIN32
+    /*
+       Catch Ctrl-C and properly shutdown 
+     */
+    sigemptyset( &sigs_to_catch );
+    sigaddset( &sigs_to_catch, SIGINT );
+    sigwait( &sigs_to_catch, &sig );
+
+    SampleUtil_Print( "Shutting down on signal %d...\n", sig );
+#else
+	ithread_join(cmdloop_thread, NULL);
+#endif
+    TvDeviceStop();
+    rc = TvCtrlPointStop();
+    
+    return rc;
+}
+
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvcombo/upnp_tv_ctrlpt.c libupnp-1.6.6-mod/upnp/sample-orig/tvcombo/upnp_tv_ctrlpt.c
--- libupnp-1.6.6/upnp/sample-orig/tvcombo/upnp_tv_ctrlpt.c	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvcombo/upnp_tv_ctrlpt.c	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,1417 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+#include "upnp_tv_ctrlpt.h"
+
+/*
+   Mutex for protecting the global device list
+   in a multi-threaded, asynchronous environment.
+   All functions should lock this mutex before reading
+   or writing the device list. 
+ */
+ithread_mutex_t DeviceListMutex;
+
+UpnpClient_Handle ctrlpt_handle = -1;
+
+char TvDeviceType[] = "urn:schemas-upnp-org:device:tvdevice:1";
+char *TvServiceType[] = {
+    "urn:schemas-upnp-org:service:tvcontrol:1",
+    "urn:schemas-upnp-org:service:tvpicture:1"
+};
+char *TvServiceName[] = { "Control", "Picture" };
+
+/*
+   Global arrays for storing variable names and counts for 
+   TvControl and TvPicture services 
+ */
+char *TvVarName[TV_SERVICE_SERVCOUNT][TV_MAXVARS] = {
+    {"Power", "Channel", "Volume", ""},
+    {"Color", "Tint", "Contrast", "Brightness"}
+};
+char TvVarCount[TV_SERVICE_SERVCOUNT] =
+    { TV_CONTROL_VARCOUNT, TV_PICTURE_VARCOUNT };
+
+/*
+   Timeout to request during subscriptions 
+ */
+int default_timeout = 1801;
+
+/*
+   The first node in the global device list, or NULL if empty 
+ */
+struct TvDeviceNode *GlobalDeviceList = NULL;
+
+/********************************************************************************
+ * TvCtrlPointDeleteNode
+ *
+ * Description: 
+ *       Delete a device node from the global device list.  Note that this
+ *       function is NOT thread safe, and should be called from another
+ *       function that has already locked the global device list.
+ *
+ * Parameters:
+ *   node -- The device node
+ *
+ ********************************************************************************/
+int
+TvCtrlPointDeleteNode( struct TvDeviceNode *node )
+{
+    int rc,
+      service,
+      var;
+
+    if( NULL == node ) {
+        SampleUtil_Print( "ERROR: TvCtrlPointDeleteNode: Node is empty" );
+        return TV_ERROR;
+    }
+
+    for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+        /*
+           If we have a valid control SID, then unsubscribe 
+         */
+        if( strcmp( node->device.TvService[service].SID, "" ) != 0 ) {
+            rc = UpnpUnSubscribe( ctrlpt_handle,
+                                  node->device.TvService[service].SID );
+            if( UPNP_E_SUCCESS == rc ) {
+                SampleUtil_Print
+                    ( "Unsubscribed from Tv %s EventURL with SID=%s",
+                      TvServiceName[service],
+                      node->device.TvService[service].SID );
+            } else {
+                SampleUtil_Print
+                    ( "Error unsubscribing to Tv %s EventURL -- %d",
+                      TvServiceName[service], rc );
+            }
+        }
+
+        for( var = 0; var < TvVarCount[service]; var++ ) {
+            if( node->device.TvService[service].VariableStrVal[var] ) {
+                free( node->device.TvService[service].
+                      VariableStrVal[var] );
+            }
+        }
+    }
+
+    //Notify New Device Added
+    SampleUtil_StateUpdate( NULL, NULL, node->device.UDN, DEVICE_REMOVED );
+    free( node );
+    node = NULL;
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointRemoveDevice
+ *
+ * Description: 
+ *       Remove a device from the global device list.
+ *
+ * Parameters:
+ *   UDN -- The Unique Device Name for the device to remove
+ *
+ ********************************************************************************/
+int
+TvCtrlPointRemoveDevice( char *UDN )
+{
+    struct TvDeviceNode *curdevnode,
+     *prevdevnode;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    curdevnode = GlobalDeviceList;
+    if( !curdevnode ) {
+        SampleUtil_Print
+            ( "WARNING: TvCtrlPointRemoveDevice: Device list empty" );
+    } else {
+        if( 0 == strcmp( curdevnode->device.UDN, UDN ) ) {
+            GlobalDeviceList = curdevnode->next;
+            TvCtrlPointDeleteNode( curdevnode );
+        } else {
+            prevdevnode = curdevnode;
+            curdevnode = curdevnode->next;
+
+            while( curdevnode ) {
+                if( strcmp( curdevnode->device.UDN, UDN ) == 0 ) {
+                    prevdevnode->next = curdevnode->next;
+                    TvCtrlPointDeleteNode( curdevnode );
+                    break;
+                }
+
+                prevdevnode = curdevnode;
+                curdevnode = curdevnode->next;
+            }
+        }
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointRemoveAll
+ *
+ * Description: 
+ *       Remove all devices from the global device list.
+ *
+ * Parameters:
+ *   None
+ *
+ ********************************************************************************/
+int
+TvCtrlPointRemoveAll( void )
+{
+    struct TvDeviceNode *curdevnode,
+     *next;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    curdevnode = GlobalDeviceList;
+    GlobalDeviceList = NULL;
+
+    while( curdevnode ) {
+        next = curdevnode->next;
+        TvCtrlPointDeleteNode( curdevnode );
+        curdevnode = next;
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointRefresh
+ *
+ * Description: 
+ *       Clear the current global device list and issue new search
+ *	 requests to build it up again from scratch.
+ *
+ * Parameters:
+ *   None
+ *
+ ********************************************************************************/
+int
+TvCtrlPointRefresh( void )
+{
+    int rc;
+
+    TvCtrlPointRemoveAll();
+
+    /*
+       Search for all devices of type tvdevice version 1, 
+       waiting for up to 5 seconds for the response 
+     */
+    rc = UpnpSearchAsync( ctrlpt_handle, 5, TvDeviceType, NULL );
+    if( UPNP_E_SUCCESS != rc ) {
+        SampleUtil_Print( "Error sending search request%d", rc );
+        return TV_ERROR;
+    }
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointGetVar
+ *
+ * Description: 
+ *       Send a GetVar request to the specified service of a device.
+ *
+ * Parameters:
+ *   service -- The service
+ *   devnum -- The number of the device (order in the list,
+ *             starting with 1)
+ *   varname -- The name of the variable to request.
+ *
+ ********************************************************************************/
+int
+TvCtrlPointGetVar( int service,
+                   int devnum,
+                   char *varname )
+{
+    struct TvDeviceNode *devnode;
+    int rc;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    rc = TvCtrlPointGetDevice( devnum, &devnode );
+
+    if( TV_SUCCESS == rc ) {
+        rc = UpnpGetServiceVarStatusAsync( ctrlpt_handle,
+                                           devnode->device.
+                                           TvService[service].ControlURL,
+                                           varname,
+                                           TvCtrlPointCallbackEventHandler,
+                                           NULL );
+        if( rc != UPNP_E_SUCCESS ) {
+            SampleUtil_Print
+                ( "Error in UpnpGetServiceVarStatusAsync -- %d", rc );
+            rc = TV_ERROR;
+        }
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    return rc;
+}
+
+int
+TvCtrlPointGetPower( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_CONTROL, devnum, "Power" );
+}
+
+int
+TvCtrlPointGetChannel( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_CONTROL, devnum, "Channel" );
+}
+
+int
+TvCtrlPointGetVolume( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_CONTROL, devnum, "Volume" );
+}
+
+int
+TvCtrlPointGetColor( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_PICTURE, devnum, "Color" );
+}
+
+int
+TvCtrlPointGetTint( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_PICTURE, devnum, "Tint" );
+}
+
+int
+TvCtrlPointGetContrast( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_PICTURE, devnum, "Contrast" );
+}
+
+int
+TvCtrlPointGetBrightness( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_PICTURE, devnum, "Brightness" );
+}
+
+/********************************************************************************
+ * TvCtrlPointSendAction
+ *
+ * Description: 
+ *       Send an Action request to the specified service of a device.
+ *
+ * Parameters:
+ *   service -- The service
+ *   devnum -- The number of the device (order in the list,
+ *             starting with 1)
+ *   actionname -- The name of the action.
+ *   param_name -- An array of parameter names
+ *   param_val -- The corresponding parameter values
+ *   param_count -- The number of parameters
+ *
+ ********************************************************************************/
+int
+TvCtrlPointSendAction( int service,
+                       int devnum,
+                       char *actionname,
+                       char **param_name,
+                       char **param_val,
+                       int param_count )
+{
+    struct TvDeviceNode *devnode;
+    IXML_Document *actionNode = NULL;
+    int rc = TV_SUCCESS;
+    int param;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    rc = TvCtrlPointGetDevice( devnum, &devnode );
+    if( TV_SUCCESS == rc ) {
+        if( 0 == param_count ) {
+            actionNode =
+                UpnpMakeAction( actionname, TvServiceType[service], 0,
+                                NULL );
+        } else {
+            for( param = 0; param < param_count; param++ ) {
+                if( UpnpAddToAction
+                    ( &actionNode, actionname, TvServiceType[service],
+                      param_name[param],
+                      param_val[param] ) != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "ERROR: TvCtrlPointSendAction: Trying to add action param" );
+                    //return -1; // TBD - BAD! leaves mutex locked
+                }
+            }
+        }
+
+        rc = UpnpSendActionAsync( ctrlpt_handle,
+                                  devnode->device.TvService[service].
+                                  ControlURL, TvServiceType[service],
+                                  NULL, actionNode,
+                                  TvCtrlPointCallbackEventHandler, NULL );
+
+        if( rc != UPNP_E_SUCCESS ) {
+            SampleUtil_Print( "Error in UpnpSendActionAsync -- %d", rc );
+            rc = TV_ERROR;
+        }
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    if( actionNode )
+        ixmlDocument_free( actionNode );
+
+    return rc;
+}
+
+/********************************************************************************
+ * TvCtrlPointSendActionNumericArg
+ *
+ * Description:Send an action with one argument to a device in the global device list.
+ *
+ * Parameters:
+ *   devnum -- The number of the device (order in the list, starting with 1)
+ *   service -- TV_SERVICE_CONTROL or TV_SERVICE_PICTURE
+ *   actionName -- The device action, i.e., "SetChannel"
+ *   paramName -- The name of the parameter that is being passed
+ *   paramValue -- Actual value of the parameter being passed
+ *
+ ********************************************************************************/
+int
+TvCtrlPointSendActionNumericArg( int devnum,
+                                 int service,
+                                 char *actionName,
+                                 char *paramName,
+                                 int paramValue )
+{
+    char param_val_a[50];
+    char *param_val = param_val_a;
+
+    sprintf( param_val_a, "%d", paramValue );
+
+    return TvCtrlPointSendAction( service, devnum, actionName, &paramName,
+                                  &param_val, 1 );
+}
+
+int
+TvCtrlPointSendPowerOn( int devnum )
+{
+    return TvCtrlPointSendAction( TV_SERVICE_CONTROL, devnum, "PowerOn",
+                                  NULL, NULL, 0 );
+}
+
+int
+TvCtrlPointSendPowerOff( int devnum )
+{
+    return TvCtrlPointSendAction( TV_SERVICE_CONTROL, devnum, "PowerOff",
+                                  NULL, NULL, 0 );
+}
+
+int
+TvCtrlPointSendSetChannel( int devnum,
+                           int channel )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_CONTROL,
+                                            "SetChannel", "Channel",
+                                            channel );
+}
+
+int
+TvCtrlPointSendSetVolume( int devnum,
+                          int volume )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_CONTROL,
+                                            "SetVolume", "Volume",
+                                            volume );
+}
+
+int
+TvCtrlPointSendSetColor( int devnum,
+                         int color )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_PICTURE,
+                                            "SetColor", "Color", color );
+}
+
+int
+TvCtrlPointSendSetTint( int devnum,
+                        int tint )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_PICTURE,
+                                            "SetTint", "Tint", tint );
+}
+
+int
+TvCtrlPointSendSetContrast( int devnum,
+                            int contrast )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_PICTURE,
+                                            "SetContrast", "Contrast",
+                                            contrast );
+}
+
+int
+TvCtrlPointSendSetBrightness( int devnum,
+                              int brightness )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_PICTURE,
+                                            "SetBrightness", "Brightness",
+                                            brightness );
+}
+
+/********************************************************************************
+ * TvCtrlPointGetDevice
+ *
+ * Description: 
+ *       Given a list number, returns the pointer to the device
+ *       node at that position in the global device list.  Note
+ *       that this function is not thread safe.  It must be called 
+ *       from a function that has locked the global device list.
+ *
+ * Parameters:
+ *   devnum -- The number of the device (order in the list,
+ *             starting with 1)
+ *   devnode -- The output device node pointer
+ *
+ ********************************************************************************/
+int
+TvCtrlPointGetDevice( int devnum,
+                      struct TvDeviceNode **devnode )
+{
+    int count = devnum;
+    struct TvDeviceNode *tmpdevnode = NULL;
+
+    if( count )
+        tmpdevnode = GlobalDeviceList;
+
+    while( --count && tmpdevnode ) {
+        tmpdevnode = tmpdevnode->next;
+    }
+
+    if( !tmpdevnode ) {
+        SampleUtil_Print( "Error finding TvDevice number -- %d", devnum );
+        return TV_ERROR;
+    }
+
+    *devnode = tmpdevnode;
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointPrintList
+ *
+ * Description: 
+ *       Print the universal device names for each device in the global device list
+ *
+ * Parameters:
+ *   None
+ *
+ ********************************************************************************/
+int
+TvCtrlPointPrintList()
+{
+    struct TvDeviceNode *tmpdevnode;
+    int i = 0;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    SampleUtil_Print( "TvCtrlPointPrintList:" );
+    tmpdevnode = GlobalDeviceList;
+    while( tmpdevnode ) {
+        SampleUtil_Print( " %3d -- %s", ++i, tmpdevnode->device.UDN );
+        tmpdevnode = tmpdevnode->next;
+    }
+    SampleUtil_Print( "" );
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointPrintDevice
+ *
+ * Description: 
+ *       Print the identifiers and state table for a device from
+ *       the global device list.
+ *
+ * Parameters:
+ *   devnum -- The number of the device (order in the list,
+ *             starting with 1)
+ *
+ ********************************************************************************/
+int
+TvCtrlPointPrintDevice( int devnum )
+{
+    struct TvDeviceNode *tmpdevnode;
+    int i = 0,
+      service,
+      var;
+    char spacer[15];
+
+    if( devnum <= 0 ) {
+        SampleUtil_Print
+            ( "Error in TvCtrlPointPrintDevice: invalid devnum = %d",
+              devnum );
+        return TV_ERROR;
+    }
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    SampleUtil_Print( "TvCtrlPointPrintDevice:" );
+    tmpdevnode = GlobalDeviceList;
+    while( tmpdevnode ) {
+        i++;
+        if( i == devnum )
+            break;
+        tmpdevnode = tmpdevnode->next;
+    }
+
+    if( !tmpdevnode ) {
+        SampleUtil_Print
+            ( "Error in TvCtrlPointPrintDevice: invalid devnum = %d  --  actual device count = %d",
+              devnum, i );
+    } else {
+        SampleUtil_Print( "  TvDevice -- %d", devnum );
+        SampleUtil_Print( "    |                  " );
+        SampleUtil_Print( "    +- UDN        = %s",
+                          tmpdevnode->device.UDN );
+        SampleUtil_Print( "    +- DescDocURL     = %s",
+                          tmpdevnode->device.DescDocURL );
+        SampleUtil_Print( "    +- FriendlyName   = %s",
+                          tmpdevnode->device.FriendlyName );
+        SampleUtil_Print( "    +- PresURL        = %s",
+                          tmpdevnode->device.PresURL );
+        SampleUtil_Print( "    +- Adver. TimeOut = %d",
+                          tmpdevnode->device.AdvrTimeOut );
+
+        for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+            if( service < TV_SERVICE_SERVCOUNT - 1 )
+                sprintf( spacer, "    |    " );
+            else
+                sprintf( spacer, "         " );
+            SampleUtil_Print( "    |                  " );
+            SampleUtil_Print( "    +- Tv %s Service",
+                              TvServiceName[service] );
+            SampleUtil_Print( "%s+- ServiceId       = %s", spacer,
+                              tmpdevnode->device.TvService[service].
+                              ServiceId );
+            SampleUtil_Print( "%s+- ServiceType     = %s", spacer,
+                              tmpdevnode->device.TvService[service].
+                              ServiceType );
+            SampleUtil_Print( "%s+- EventURL        = %s", spacer,
+                              tmpdevnode->device.TvService[service].
+                              EventURL );
+            SampleUtil_Print( "%s+- ControlURL      = %s", spacer,
+                              tmpdevnode->device.TvService[service].
+                              ControlURL );
+            SampleUtil_Print( "%s+- SID             = %s", spacer,
+                              tmpdevnode->device.TvService[service].SID );
+            SampleUtil_Print( "%s+- ServiceStateTable", spacer );
+
+            for( var = 0; var < TvVarCount[service]; var++ ) {
+                SampleUtil_Print( "%s     +- %-10s = %s", spacer,
+                                  TvVarName[service][var],
+                                  tmpdevnode->device.TvService[service].
+                                  VariableStrVal[var] );
+            }
+        }
+    }
+
+    SampleUtil_Print( "" );
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointAddDevice
+ *
+ * Description: 
+ *       If the device is not already included in the global device list,
+ *       add it.  Otherwise, update its advertisement expiration timeout.
+ *
+ * Parameters:
+ *   DescDoc -- The description document for the device
+ *   location -- The location of the description document URL
+ *   expires -- The expiration time for this advertisement
+ *
+ ********************************************************************************/
+void
+TvCtrlPointAddDevice( IXML_Document * DescDoc,
+                      char *location,
+                      int expires )
+{
+    char *deviceType = NULL;
+    char *friendlyName = NULL;
+    char presURL[200];
+    char *baseURL = NULL;
+    char *relURL = NULL;
+    char *UDN = NULL;
+    char *serviceId[TV_SERVICE_SERVCOUNT] = { NULL, NULL };
+    char *eventURL[TV_SERVICE_SERVCOUNT] = { NULL, NULL };
+    char *controlURL[TV_SERVICE_SERVCOUNT] = { NULL, NULL };
+    Upnp_SID eventSID[TV_SERVICE_SERVCOUNT];
+    int TimeOut[TV_SERVICE_SERVCOUNT] =
+        { default_timeout, default_timeout };
+    struct TvDeviceNode *deviceNode;
+    struct TvDeviceNode *tmpdevnode;
+    int ret = 1;
+    int found = 0;
+    int service,
+      var;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    /*
+       Read key elements from description document 
+     */
+    UDN = SampleUtil_GetFirstDocumentItem( DescDoc, "UDN" );
+    deviceType = SampleUtil_GetFirstDocumentItem( DescDoc, "deviceType" );
+    friendlyName =
+        SampleUtil_GetFirstDocumentItem( DescDoc, "friendlyName" );
+    baseURL = SampleUtil_GetFirstDocumentItem( DescDoc, "URLBase" );
+    relURL = SampleUtil_GetFirstDocumentItem( DescDoc, "presentationURL" );
+
+    ret =
+        UpnpResolveURL( ( baseURL ? baseURL : location ), relURL,
+                        presURL );
+
+    if( UPNP_E_SUCCESS != ret )
+        SampleUtil_Print( "Error generating presURL from %s + %s", baseURL,
+                          relURL );
+
+    if( strcmp( deviceType, TvDeviceType ) == 0 ) {
+        SampleUtil_Print( "Found Tv device" );
+
+        // Check if this device is already in the list
+        tmpdevnode = GlobalDeviceList;
+        while( tmpdevnode ) {
+            if( strcmp( tmpdevnode->device.UDN, UDN ) == 0 ) {
+                found = 1;
+                break;
+            }
+            tmpdevnode = tmpdevnode->next;
+        }
+
+        if( found ) {
+            // The device is already there, so just update 
+            // the advertisement timeout field
+            tmpdevnode->device.AdvrTimeOut = expires;
+        } else {
+            for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+                if( SampleUtil_FindAndParseService
+                    ( DescDoc, location, TvServiceType[service],
+                      &serviceId[service], &eventURL[service],
+                      &controlURL[service] ) ) {
+                    SampleUtil_Print( "Subscribing to EventURL %s...",
+                                      eventURL[service] );
+
+                    ret =
+                        UpnpSubscribe( ctrlpt_handle, eventURL[service],
+                                       &TimeOut[service],
+                                       eventSID[service] );
+
+                    if( ret == UPNP_E_SUCCESS ) {
+                        SampleUtil_Print
+                            ( "Subscribed to EventURL with SID=%s",
+                              eventSID[service] );
+                    } else {
+                        SampleUtil_Print
+                            ( "Error Subscribing to EventURL -- %d", ret );
+                        strcpy( eventSID[service], "" );
+                    }
+                } else {
+                    SampleUtil_Print( "Error: Could not find Service: %s",
+                                      TvServiceType[service] );
+                }
+            }
+
+            /*
+               Create a new device node 
+             */
+            deviceNode =
+                ( struct TvDeviceNode * )
+                malloc( sizeof( struct TvDeviceNode ) );
+            strcpy( deviceNode->device.UDN, UDN );
+            strcpy( deviceNode->device.DescDocURL, location );
+            strcpy( deviceNode->device.FriendlyName, friendlyName );
+            strcpy( deviceNode->device.PresURL, presURL );
+            deviceNode->device.AdvrTimeOut = expires;
+
+            for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+                strcpy( deviceNode->device.TvService[service].ServiceId,
+                        serviceId[service] );
+                strcpy( deviceNode->device.TvService[service].ServiceType,
+                        TvServiceType[service] );
+                strcpy( deviceNode->device.TvService[service].ControlURL,
+                        controlURL[service] );
+                strcpy( deviceNode->device.TvService[service].EventURL,
+                        eventURL[service] );
+                strcpy( deviceNode->device.TvService[service].SID,
+                        eventSID[service] );
+
+                for( var = 0; var < TvVarCount[service]; var++ ) {
+                    deviceNode->device.TvService[service].
+                        VariableStrVal[var] =
+                        ( char * )malloc( TV_MAX_VAL_LEN );
+                    strcpy( deviceNode->device.TvService[service].
+                            VariableStrVal[var], "" );
+                }
+            }
+
+            deviceNode->next = NULL;
+
+            // Insert the new device node in the list
+            if( ( tmpdevnode = GlobalDeviceList ) ) {
+
+                while( tmpdevnode ) {
+                    if( tmpdevnode->next ) {
+                        tmpdevnode = tmpdevnode->next;
+                    } else {
+                        tmpdevnode->next = deviceNode;
+                        break;
+                    }
+                }
+            } else {
+                GlobalDeviceList = deviceNode;
+            }
+
+            //Notify New Device Added
+            SampleUtil_StateUpdate( NULL, NULL, deviceNode->device.UDN,
+                                    DEVICE_ADDED );
+        }
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    if( deviceType )
+        free( deviceType );
+    if( friendlyName )
+        free( friendlyName );
+    if( UDN )
+        free( UDN );
+    if( baseURL )
+        free( baseURL );
+    if( relURL )
+        free( relURL );
+
+    for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+        if( serviceId[service] )
+            free( serviceId[service] );
+        if( controlURL[service] )
+            free( controlURL[service] );
+        if( eventURL[service] )
+            free( eventURL[service] );
+    }
+}
+
+/********************************************************************************
+ * TvStateUpdate
+ *
+ * Description: 
+ *       Update a Tv state table.  Called when an event is
+ *       received.  Note: this function is NOT thread save.  It must be
+ *       called from another function that has locked the global device list.
+ *
+ * Parameters:
+ *   UDN     -- The UDN of the parent device.
+ *   Service -- The service state table to update
+ *   ChangedVariables -- DOM document representing the XML received
+ *                       with the event
+ *   State -- pointer to the state table for the Tv  service
+ *            to update
+ *
+ ********************************************************************************/
+void
+TvStateUpdate( char *UDN,
+               int Service,
+               IXML_Document * ChangedVariables,
+               char **State )
+{
+    IXML_NodeList *properties,
+     *variables;
+    IXML_Element *property,
+     *variable;
+    int length,
+      length1;
+    int i,
+      j;
+    char *tmpstate = NULL;
+
+    SampleUtil_Print( "Tv State Update (service %d): ", Service );
+
+    /*
+       Find all of the e:property tags in the document 
+     */
+    properties =
+        ixmlDocument_getElementsByTagName( ChangedVariables,
+                                           "e:property" );
+    if( NULL != properties ) {
+        length = ixmlNodeList_length( properties );
+        for( i = 0; i < length; i++ ) { /* Loop through each property change found */
+            property =
+                ( IXML_Element * ) ixmlNodeList_item( properties, i );
+
+            /*
+               For each variable name in the state table, check if this
+               is a corresponding property change 
+             */
+            for( j = 0; j < TvVarCount[Service]; j++ ) {
+                variables =
+                    ixmlElement_getElementsByTagName( property,
+                                                      TvVarName[Service]
+                                                      [j] );
+
+                /*
+                   If a match is found, extract the value, and update the state table 
+                 */
+                if( variables ) {
+                    length1 = ixmlNodeList_length( variables );
+                    if( length1 ) {
+                        variable =
+                            ( IXML_Element * )
+                            ixmlNodeList_item( variables, 0 );
+                        tmpstate = SampleUtil_GetElementValue( variable );
+
+                        if( tmpstate ) {
+                            strcpy( State[j], tmpstate );
+                            SampleUtil_Print
+                                ( " Variable Name: %s New Value:'%s'",
+                                  TvVarName[Service][j], State[j] );
+                        }
+
+                        if( tmpstate )
+                            free( tmpstate );
+                        tmpstate = NULL;
+                    }
+
+                    ixmlNodeList_free( variables );
+                    variables = NULL;
+                }
+            }
+
+        }
+        ixmlNodeList_free( properties );
+    }
+}
+
+/********************************************************************************
+ * TvCtrlPointHandleEvent
+ *
+ * Description: 
+ *       Handle a UPnP event that was received.  Process the event and update
+ *       the appropriate service state table.
+ *
+ * Parameters:
+ *   sid -- The subscription id for the event
+ *   eventkey -- The eventkey number for the event
+ *   changes -- The DOM document representing the changes
+ *
+ ********************************************************************************/
+void
+TvCtrlPointHandleEvent( Upnp_SID sid,
+                        int evntkey,
+                        IXML_Document * changes )
+{
+    struct TvDeviceNode *tmpdevnode;
+    int service;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    tmpdevnode = GlobalDeviceList;
+    while( tmpdevnode ) {
+        for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+            if( strcmp( tmpdevnode->device.TvService[service].SID, sid ) ==
+                0 ) {
+                SampleUtil_Print( "Received Tv %s Event: %d for SID %s",
+                                  TvServiceName[service], evntkey, sid );
+
+                TvStateUpdate( tmpdevnode->device.UDN, service, changes,
+                               ( char ** )&tmpdevnode->device.
+                               TvService[service].VariableStrVal );
+                break;
+            }
+        }
+        tmpdevnode = tmpdevnode->next;
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+}
+
+/********************************************************************************
+ * TvCtrlPointHandleSubscribeUpdate
+ *
+ * Description: 
+ *       Handle a UPnP subscription update that was received.  Find the 
+ *       service the update belongs to, and update its subscription
+ *       timeout.
+ *
+ * Parameters:
+ *   eventURL -- The event URL for the subscription
+ *   sid -- The subscription id for the subscription
+ *   timeout  -- The new timeout for the subscription
+ *
+ ********************************************************************************/
+void
+TvCtrlPointHandleSubscribeUpdate( char *eventURL,
+                                  Upnp_SID sid,
+                                  int timeout )
+{
+    struct TvDeviceNode *tmpdevnode;
+    int service;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    tmpdevnode = GlobalDeviceList;
+    while( tmpdevnode ) {
+        for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+
+            if( strcmp
+                ( tmpdevnode->device.TvService[service].EventURL,
+                  eventURL ) == 0 ) {
+                SampleUtil_Print
+                    ( "Received Tv %s Event Renewal for eventURL %s",
+                      TvServiceName[service], eventURL );
+                strcpy( tmpdevnode->device.TvService[service].SID, sid );
+                break;
+            }
+        }
+
+        tmpdevnode = tmpdevnode->next;
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+}
+
+void
+TvCtrlPointHandleGetVar( char *controlURL,
+                         char *varName,
+                         DOMString varValue )
+{
+
+    struct TvDeviceNode *tmpdevnode;
+    int service;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    tmpdevnode = GlobalDeviceList;
+    while( tmpdevnode ) {
+        for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+            if( strcmp
+                ( tmpdevnode->device.TvService[service].ControlURL,
+                  controlURL ) == 0 ) {
+                SampleUtil_StateUpdate( varName, varValue,
+                                        tmpdevnode->device.UDN,
+                                        GET_VAR_COMPLETE );
+                break;
+            }
+        }
+        tmpdevnode = tmpdevnode->next;
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+}
+
+/********************************************************************************
+ * TvCtrlPointCallbackEventHandler
+ *
+ * Description: 
+ *       The callback handler registered with the SDK while registering
+ *       the control point.  Detects the type of callback, and passes the 
+ *       request on to the appropriate function.
+ *
+ * Parameters:
+ *   EventType -- The type of callback event
+ *   Event -- Data structure containing event data
+ *   Cookie -- Optional data specified during callback registration
+ *
+ ********************************************************************************/
+int
+TvCtrlPointCallbackEventHandler( Upnp_EventType EventType,
+                                 void *Event,
+                                 void *Cookie )
+{
+    SampleUtil_PrintEvent( EventType, Event );
+
+    switch ( EventType ) {
+            /*
+               SSDP Stuff 
+             */
+        case UPNP_DISCOVERY_ADVERTISEMENT_ALIVE:
+        case UPNP_DISCOVERY_SEARCH_RESULT:
+            {
+                struct Upnp_Discovery *d_event =
+                    ( struct Upnp_Discovery * )Event;
+                IXML_Document *DescDoc = NULL;
+                int ret;
+
+                if( d_event->ErrCode != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print( "Error in Discovery Callback -- %d",
+                                      d_event->ErrCode );
+                }
+
+                if( ( ret =
+                      UpnpDownloadXmlDoc( d_event->Location,
+                                          &DescDoc ) ) !=
+                    UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "Error obtaining device description from %s -- error = %d",
+                          d_event->Location, ret );
+                } else {
+                    TvCtrlPointAddDevice( DescDoc, d_event->Location,
+                                          d_event->Expires );
+                }
+
+                if( DescDoc )
+                    ixmlDocument_free( DescDoc );
+
+                TvCtrlPointPrintList();
+                break;
+            }
+
+        case UPNP_DISCOVERY_SEARCH_TIMEOUT:
+            /*
+               Nothing to do here... 
+             */
+            break;
+
+        case UPNP_DISCOVERY_ADVERTISEMENT_BYEBYE:
+            {
+                struct Upnp_Discovery *d_event =
+                    ( struct Upnp_Discovery * )Event;
+
+                if( d_event->ErrCode != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "Error in Discovery ByeBye Callback -- %d",
+                          d_event->ErrCode );
+                }
+
+                SampleUtil_Print( "Received ByeBye for Device: %s",
+                                  d_event->DeviceId );
+                TvCtrlPointRemoveDevice( d_event->DeviceId );
+
+                SampleUtil_Print( "After byebye:" );
+                TvCtrlPointPrintList();
+
+                break;
+            }
+
+            /*
+               SOAP Stuff 
+             */
+        case UPNP_CONTROL_ACTION_COMPLETE:
+            {
+                struct Upnp_Action_Complete *a_event =
+                    ( struct Upnp_Action_Complete * )Event;
+
+                if( a_event->ErrCode != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "Error in  Action Complete Callback -- %d",
+                          a_event->ErrCode );
+                }
+
+                /*
+                   No need for any processing here, just print out results.  Service state
+                   table updates are handled by events. 
+                 */
+
+                break;
+            }
+
+        case UPNP_CONTROL_GET_VAR_COMPLETE:
+            {
+                struct Upnp_State_Var_Complete *sv_event =
+                    ( struct Upnp_State_Var_Complete * )Event;
+
+                if( sv_event->ErrCode != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "Error in Get Var Complete Callback -- %d",
+                          sv_event->ErrCode );
+                } else {
+                    TvCtrlPointHandleGetVar( sv_event->CtrlUrl,
+                                             sv_event->StateVarName,
+                                             sv_event->CurrentVal );
+                }
+
+                break;
+            }
+
+            /*
+               GENA Stuff 
+             */
+        case UPNP_EVENT_RECEIVED:
+            {
+                struct Upnp_Event *e_event = ( struct Upnp_Event * )Event;
+
+                TvCtrlPointHandleEvent( e_event->Sid, e_event->EventKey,
+                                        e_event->ChangedVariables );
+                break;
+            }
+
+        case UPNP_EVENT_SUBSCRIBE_COMPLETE:
+        case UPNP_EVENT_UNSUBSCRIBE_COMPLETE:
+        case UPNP_EVENT_RENEWAL_COMPLETE:
+            {
+                struct Upnp_Event_Subscribe *es_event =
+                    ( struct Upnp_Event_Subscribe * )Event;
+
+                if( es_event->ErrCode != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "Error in Event Subscribe Callback -- %d",
+                          es_event->ErrCode );
+                } else {
+                    TvCtrlPointHandleSubscribeUpdate( es_event->
+                                                      PublisherUrl,
+                                                      es_event->Sid,
+                                                      es_event->TimeOut );
+                }
+
+                break;
+            }
+
+        case UPNP_EVENT_AUTORENEWAL_FAILED:
+        case UPNP_EVENT_SUBSCRIPTION_EXPIRED:
+            {
+                int TimeOut = default_timeout;
+                Upnp_SID newSID;
+                int ret;
+
+                struct Upnp_Event_Subscribe *es_event =
+                    ( struct Upnp_Event_Subscribe * )Event;
+
+                ret =
+                    UpnpSubscribe( ctrlpt_handle, es_event->PublisherUrl,
+                                   &TimeOut, newSID );
+
+                if( ret == UPNP_E_SUCCESS ) {
+                    SampleUtil_Print( "Subscribed to EventURL with SID=%s",
+                                      newSID );
+                    TvCtrlPointHandleSubscribeUpdate( es_event->
+                                                      PublisherUrl, newSID,
+                                                      TimeOut );
+                } else {
+                    SampleUtil_Print
+                        ( "Error Subscribing to EventURL -- %d", ret );
+                }
+                break;
+            }
+
+            /*
+               ignore these cases, since this is not a device 
+             */
+        case UPNP_EVENT_SUBSCRIPTION_REQUEST:
+        case UPNP_CONTROL_GET_VAR_REQUEST:
+        case UPNP_CONTROL_ACTION_REQUEST:
+            break;
+    }
+
+    return 0;
+}
+
+/********************************************************************************
+ * TvCtrlPointVerifyTimeouts
+ *
+ * Description: 
+ *       Checks the advertisement  each device
+ *        in the global device list.  If an advertisement expires,
+ *       the device is removed from the list.  If an advertisement is about to
+ *       expire, a search request is sent for that device.  
+ *
+ * Parameters:
+ *    incr -- The increment to subtract from the timeouts each time the
+ *            function is called.
+ *
+ ********************************************************************************/
+void
+TvCtrlPointVerifyTimeouts( int incr )
+{
+    struct TvDeviceNode *prevdevnode,
+     *curdevnode;
+    int ret;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    prevdevnode = NULL;
+    curdevnode = GlobalDeviceList;
+
+    while( curdevnode ) {
+        curdevnode->device.AdvrTimeOut -= incr;
+        //SampleUtil_Print("Advertisement Timeout: %d\n", curdevnode->device.AdvrTimeOut);
+
+        if( curdevnode->device.AdvrTimeOut <= 0 ) {
+            /*
+               This advertisement has expired, so we should remove the device
+               from the list 
+             */
+
+            if( GlobalDeviceList == curdevnode )
+                GlobalDeviceList = curdevnode->next;
+            else
+                prevdevnode->next = curdevnode->next;
+            TvCtrlPointDeleteNode( curdevnode );
+            if( prevdevnode )
+                curdevnode = prevdevnode->next;
+            else
+                curdevnode = GlobalDeviceList;
+        } else {
+
+            if( curdevnode->device.AdvrTimeOut < 2 * incr ) {
+                /*
+                   This advertisement is about to expire, so send
+                   out a search request for this device UDN to 
+                   try to renew 
+                 */
+                ret = UpnpSearchAsync( ctrlpt_handle, incr,
+                                       curdevnode->device.UDN, NULL );
+                if( ret != UPNP_E_SUCCESS )
+                    SampleUtil_Print
+                        ( "Error sending search request for Device UDN: %s -- err = %d",
+                          curdevnode->device.UDN, ret );
+            }
+
+            prevdevnode = curdevnode;
+            curdevnode = curdevnode->next;
+        }
+
+    }
+    ithread_mutex_unlock( &DeviceListMutex );
+
+}
+
+/********************************************************************************
+ * TvCtrlPointTimerLoop
+ *
+ * Description: 
+ *       Function that runs in its own thread and monitors advertisement
+ *       and subscription timeouts for devices in the global device list.
+ *
+ * Parameters:
+ *    None
+ *
+ ********************************************************************************/
+void *
+TvCtrlPointTimerLoop( void *args )
+{
+    int incr = 30;              // how often to verify the timeouts, in seconds
+
+    while( 1 ) {
+        isleep( incr );
+        TvCtrlPointVerifyTimeouts( incr );
+    }
+
+    return NULL;
+}
+
+/********************************************************************************
+ * TvCtrlPointStart
+ *
+ * Description: 
+ *		Call this function to initialize the UPnP library and start the TV Control
+ *		Point.  This function creates a timer thread and provides a callback
+ *		handler to process any UPnP events that are received.
+ *
+ * Parameters:
+ *		None
+ *
+ * Returns:
+ *		TV_SUCCESS if everything went well, else TV_ERROR
+ *
+ ********************************************************************************/
+int
+TvCtrlPointStart( print_string printFunctionPtr,
+                  state_update updateFunctionPtr )
+{
+    ithread_t timer_thread;
+    int rc;
+    unsigned short port = 0;
+    char *ip_address = NULL;
+
+    SampleUtil_Initialize( printFunctionPtr );
+    SampleUtil_RegisterUpdateFunction( updateFunctionPtr );
+
+    ithread_mutex_init( &DeviceListMutex, 0 );
+
+    SampleUtil_Print(
+        "Initializing UPnP Sdk with\n"
+        "\tipaddress = %s port = %u\n",
+        ip_address, port );
+
+    rc = UpnpInit( ip_address, port );
+    if( UPNP_E_SUCCESS != rc ) {
+        SampleUtil_Print( "WinCEStart: UpnpInit() Error: %d", rc );
+        //UpnpFinish();
+        //return TV_ERROR;
+    }
+
+    if( NULL == ip_address ) {
+        ip_address = UpnpGetServerIpAddress();
+    }
+    if( 0 == port ) {
+        port = UpnpGetServerPort();
+    }
+
+    SampleUtil_Print(
+        "UPnP Initialized\n"
+	"\tipaddress= %s port = %u\n",
+        ip_address, port );
+
+    SampleUtil_Print( "Registering Control Point" );
+    rc = UpnpRegisterClient( TvCtrlPointCallbackEventHandler,
+                             &ctrlpt_handle, &ctrlpt_handle );
+    if( UPNP_E_SUCCESS != rc ) {
+        SampleUtil_Print( "Error registering CP: %d", rc );
+        UpnpFinish();
+        return TV_ERROR;
+    }
+
+    SampleUtil_Print( "Control Point Registered" );
+
+    TvCtrlPointRefresh();
+
+    // start a timer thread
+    ithread_create( &timer_thread, NULL, TvCtrlPointTimerLoop, NULL );
+
+    return TV_SUCCESS;
+}
+
+int
+TvCtrlPointStop( void )
+{
+    TvCtrlPointRemoveAll();
+    UpnpUnRegisterClient( ctrlpt_handle );
+    UpnpFinish();
+    SampleUtil_Finish();
+
+    return TV_SUCCESS;
+}
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvcombo/upnp_tv_ctrlpt.h libupnp-1.6.6-mod/upnp/sample-orig/tvcombo/upnp_tv_ctrlpt.h
--- libupnp-1.6.6/upnp/sample-orig/tvcombo/upnp_tv_ctrlpt.h	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvcombo/upnp_tv_ctrlpt.h	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,160 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+#ifndef UPNP_TV_CTRLPT_H
+#define UPNP_TV_CTRLPT_H
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+
+#include <stdio.h>
+
+#include "ithread.h"
+#ifndef WIN32
+#include <unistd.h>
+#endif
+#include <stdarg.h>
+#include <stdlib.h>
+#include <signal.h>
+#include <string.h>
+
+#include "upnp.h"
+#include "upnptools.h"
+#include "sample_util.h"
+
+#define TV_SERVICE_SERVCOUNT	2
+#define TV_SERVICE_CONTROL		0
+#define TV_SERVICE_PICTURE		1
+
+#define TV_CONTROL_VARCOUNT		3
+#define TV_CONTROL_POWER		0
+#define TV_CONTROL_CHANNEL		1
+#define TV_CONTROL_VOLUME		2
+
+#define TV_PICTURE_VARCOUNT		4
+#define TV_PICTURE_COLOR		0
+#define TV_PICTURE_TINT			1
+#define TV_PICTURE_CONTRAST		2
+#define TV_PICTURE_BRIGHTNESS	3
+
+#define TV_MAX_VAL_LEN			5
+
+#define TV_SUCCESS				0
+#define TV_ERROR				(-1)
+#define TV_WARNING				1
+
+/* This should be the maximum VARCOUNT from above */
+#define TV_MAXVARS				TV_PICTURE_VARCOUNT
+
+extern char TvDeviceType[];
+extern char *TvServiceType[];
+extern char *TvServiceName[];
+extern char *TvVarName[TV_SERVICE_SERVCOUNT][TV_MAXVARS];
+extern char TvVarCount[];
+
+struct tv_service {
+    char ServiceId[NAME_SIZE];
+    char ServiceType[NAME_SIZE];
+    char *VariableStrVal[TV_MAXVARS];
+    char EventURL[NAME_SIZE];
+    char ControlURL[NAME_SIZE];
+    char SID[NAME_SIZE];
+};
+
+extern struct TvDeviceNode *GlobalDeviceList;
+
+struct TvDevice {
+    char UDN[250];
+    char DescDocURL[250];
+    char FriendlyName[250];
+    char PresURL[250];
+    int  AdvrTimeOut;
+    struct tv_service TvService[TV_SERVICE_SERVCOUNT];
+};
+
+struct TvDeviceNode {
+    struct TvDevice device;
+    struct TvDeviceNode *next;
+};
+
+extern ithread_mutex_t DeviceListMutex;
+
+extern UpnpClient_Handle ctrlpt_handle;
+
+void	TvCtrlPointPrintHelp( void );
+int		TvCtrlPointDeleteNode(struct TvDeviceNode*);
+int		TvCtrlPointRemoveDevice(char*);
+int		TvCtrlPointRemoveAll( void );
+int		TvCtrlPointRefresh( void );
+
+
+int		TvCtrlPointSendAction(int, int, char *, char **, char **, int);
+int		TvCtrlPointSendActionNumericArg(int devnum, int service, char *actionName, char *paramName, int paramValue);
+int		TvCtrlPointSendPowerOn(int devnum);
+int		TvCtrlPointSendPowerOff(int devnum);
+int		TvCtrlPointSendSetChannel(int, int);
+int		TvCtrlPointSendSetVolume(int, int);
+int		TvCtrlPointSendSetColor(int, int);
+int		TvCtrlPointSendSetTint(int, int);
+int		TvCtrlPointSendSetContrast(int, int);
+int		TvCtrlPointSendSetBrightness(int, int);
+
+int		TvCtrlPointGetVar(int, int, char*);
+int		TvCtrlPointGetPower(int devnum);
+int		TvCtrlPointGetChannel(int);
+int		TvCtrlPointGetVolume(int);
+int		TvCtrlPointGetColor(int);
+int		TvCtrlPointGetTint(int);
+int		TvCtrlPointGetContrast(int);
+int		TvCtrlPointGetBrightness(int);
+
+int		TvCtrlPointGetDevice(int, struct TvDeviceNode **);
+int		TvCtrlPointPrintList( void );
+int		TvCtrlPointPrintDevice(int);
+void	TvCtrlPointAddDevice (IXML_Document *, char *, int); 
+void    TvCtrlPointHandleGetVar(char *,char *,DOMString);
+void	TvStateUpdate(char*,int, IXML_Document * , char **);
+void	TvCtrlPointHandleEvent(Upnp_SID, int, IXML_Document *); 
+void	TvCtrlPointHandleSubscribeUpdate(char *, Upnp_SID, int); 
+int		TvCtrlPointCallbackEventHandler(Upnp_EventType, void *, void *);
+void	TvCtrlPointVerifyTimeouts(int);
+void	TvCtrlPointPrintCommands( void );
+void*	TvCtrlPointCommandLoop( void* );
+int		TvCtrlPointStart( print_string printFunctionPtr, state_update updateFunctionPtr );
+int		TvCtrlPointStop( void );
+int		TvCtrlPointProcessCommand( char *cmdline );
+
+#ifdef __cplusplus
+};
+#endif
+
+#endif //UPNP_TV_CTRLPT_H
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvcombo/upnp_tv_device.c libupnp-1.6.6-mod/upnp/sample-orig/tvcombo/upnp_tv_device.c
--- libupnp-1.6.6/upnp/sample-orig/tvcombo/upnp_tv_device.c	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvcombo/upnp_tv_device.c	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,2038 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+#include "upnp_tv_device.h"
+
+#define DEFAULT_WEB_DIR "./web"
+
+#define DESC_URL_SIZE 200
+
+/*
+   Device type for tv device 
+ */
+extern char TvDeviceType[];
+
+/*
+   Service types for tv services
+ */
+extern char *TvServiceType[];
+
+/*
+   Global arrays for storing Tv Control Service
+   variable names, values, and defaults 
+ */
+char *tvc_varname[] = { "Power", "Channel", "Volume" };
+char tvc_varval[TV_CONTROL_VARCOUNT][TV_MAX_VAL_LEN];
+char *tvc_varval_def[] = { "1", "1", "5" };
+
+/*
+   Global arrays for storing Tv Picture Service
+   variable names, values, and defaults 
+ */
+char *tvp_varname[] = { "Color", "Tint", "Contrast", "Brightness" };
+char tvp_varval[TV_PICTURE_VARCOUNT][TV_MAX_VAL_LEN];
+char *tvp_varval_def[] = { "5", "5", "5", "5" };
+
+/*
+   The amount of time (in seconds) before advertisements
+   will expire 
+ */
+int default_advr_expire = 100;
+
+/*
+   Global structure for storing the state table for this device 
+ */
+struct TvService tv_service_table[2];
+
+/*
+   Device handle supplied by UPnP SDK 
+ */
+UpnpDevice_Handle device_handle = -1;
+
+/*
+   Mutex for protecting the global state table data
+   in a multi-threaded, asynchronous environment.
+   All functions should lock this mutex before reading
+   or writing the state table data. 
+ */
+ithread_mutex_t TVDevMutex;
+
+//Color constants
+#define MAX_COLOR 10
+#define MIN_COLOR 1
+
+//Brightness constants
+#define MAX_BRIGHTNESS 10
+#define MIN_BRIGHTNESS 1
+
+//Power constants
+#define POWER_ON 1
+#define POWER_OFF 0
+
+//Tint constants
+#define MAX_TINT 10
+#define MIN_TINT 1
+
+//Volume constants
+#define MAX_VOLUME 10
+#define MIN_VOLUME 1
+
+//Contrast constants
+#define MAX_CONTRAST 10
+#define MIN_CONTRAST 1
+
+//Channel constants
+#define MAX_CHANNEL 100
+#define MIN_CHANNEL 1
+
+/******************************************************************************
+ * SetServiceTable
+ *
+ * Description: 
+ *       Initializes the service table for the specified service.
+ *       Note that 
+ *       knowledge of the service description is
+ *       assumed. 
+ * Parameters:
+ *   int serviceType - one of TV_SERVICE_CONTROL or, TV_SERVICE_PICTURE
+ *   const char * UDN - UDN of device containing service
+ *   const char * serviceId - serviceId of service
+ *   const char * serviceTypeS - service type (as specified in Description
+ *                                             Document) 
+ *   struct TvService *out - service containing table to be set.
+ *
+ *****************************************************************************/
+int
+SetServiceTable( IN int serviceType,
+                 IN const char *UDN,
+                 IN const char *serviceId,
+                 IN const char *serviceTypeS,
+                 INOUT struct TvService *out )
+{
+    unsigned int i = 0;
+
+    strcpy( out->UDN, UDN );
+    strcpy( out->ServiceId, serviceId );
+    strcpy( out->ServiceType, serviceTypeS );
+
+    switch ( serviceType ) {
+        case TV_SERVICE_CONTROL:
+            out->VariableCount = TV_CONTROL_VARCOUNT;
+            for( i = 0;
+                 i < tv_service_table[TV_SERVICE_CONTROL].VariableCount;
+                 i++ ) {
+                tv_service_table[TV_SERVICE_CONTROL].VariableName[i]
+                    = tvc_varname[i];
+                tv_service_table[TV_SERVICE_CONTROL].VariableStrVal[i]
+                    = tvc_varval[i];
+                strcpy( tv_service_table[TV_SERVICE_CONTROL].
+                        VariableStrVal[i], tvc_varval_def[i] );
+            }
+
+            break;
+        case TV_SERVICE_PICTURE:
+            out->VariableCount = TV_PICTURE_VARCOUNT;
+
+            for( i = 0;
+                 i < tv_service_table[TV_SERVICE_PICTURE].VariableCount;
+                 i++ ) {
+                tv_service_table[TV_SERVICE_PICTURE].VariableName[i] =
+                    tvp_varname[i];
+                tv_service_table[TV_SERVICE_PICTURE].VariableStrVal[i] =
+                    tvp_varval[i];
+                strcpy( tv_service_table[TV_SERVICE_PICTURE].
+                        VariableStrVal[i], tvp_varval_def[i] );
+            }
+
+            break;
+        default:
+            assert( 0 );
+    }
+
+    return SetActionTable( serviceType, out );
+
+}
+
+/******************************************************************************
+ * SetActionTable
+ *
+ * Description: 
+ *       Initializes the action table for the specified service.
+ *       Note that 
+ *       knowledge of the service description is
+ *       assumed.  Action names are hardcoded.
+ * Parameters:
+ *   int serviceType - one of TV_SERVICE_CONTROL or, TV_SERVICE_PICTURE
+ *   struct TvService *out - service containing action table to set.
+ *
+ *****************************************************************************/
+int
+SetActionTable( IN int serviceType,
+                INOUT struct TvService *out )
+{
+    if( serviceType == TV_SERVICE_CONTROL ) {
+        out->ActionNames[0] = "PowerOn";
+        out->actions[0] = TvDevicePowerOn;
+        out->ActionNames[1] = "PowerOff";
+        out->actions[1] = TvDevicePowerOff;
+        out->ActionNames[2] = "SetChannel";
+        out->actions[2] = TvDeviceSetChannel;
+        out->ActionNames[3] = "IncreaseChannel";
+        out->actions[3] = TvDeviceIncreaseChannel;
+        out->ActionNames[4] = "DecreaseChannel";
+        out->actions[4] = TvDeviceDecreaseChannel;
+        out->ActionNames[5] = "SetVolume";
+        out->actions[5] = TvDeviceSetVolume;
+        out->ActionNames[6] = "IncreaseVolume";
+        out->actions[6] = TvDeviceIncreaseVolume;
+        out->ActionNames[7] = "DecreaseVolume";
+        out->actions[7] = TvDeviceDecreaseVolume;
+        out->ActionNames[8] = NULL;
+        return 1;
+    } else if( serviceType == TV_SERVICE_PICTURE ) {
+        out->ActionNames[0] = "SetColor";
+        out->ActionNames[1] = "IncreaseColor";
+        out->ActionNames[2] = "DecreaseColor";
+        out->actions[0] = TvDeviceSetColor;
+        out->actions[1] = TvDeviceIncreaseColor;
+        out->actions[2] = TvDeviceDecreaseColor;
+        out->ActionNames[3] = "SetTint";
+        out->ActionNames[4] = "IncreaseTint";
+        out->ActionNames[5] = "DecreaseTint";
+        out->actions[3] = TvDeviceSetTint;
+        out->actions[4] = TvDeviceIncreaseTint;
+        out->actions[5] = TvDeviceDecreaseTint;
+
+        out->ActionNames[6] = "SetBrightness";
+        out->ActionNames[7] = "IncreaseBrightness";
+        out->ActionNames[8] = "DecreaseBrightness";
+        out->actions[6] = TvDeviceSetBrightness;
+        out->actions[7] = TvDeviceIncreaseBrightness;
+        out->actions[8] = TvDeviceDecreaseBrightness;
+
+        out->ActionNames[9] = "SetContrast";
+        out->ActionNames[10] = "IncreaseContrast";
+        out->ActionNames[11] = "DecreaseContrast";
+
+        out->actions[9] = TvDeviceSetContrast;
+        out->actions[10] = TvDeviceIncreaseContrast;
+        out->actions[11] = TvDeviceDecreaseContrast;
+        return 1;
+    }
+
+    return 0;
+
+}
+
+/******************************************************************************
+ * TvDeviceStateTableInit
+ *
+ * Description: 
+ *       Initialize the device state table for 
+ * 	 this TvDevice, pulling identifier info
+ *       from the description Document.  Note that 
+ *       knowledge of the service description is
+ *       assumed.  State table variables and default
+ *       values are currently hardcoded in this file
+ *       rather than being read from service description
+ *       documents.
+ *
+ * Parameters:
+ *   DescDocURL -- The description document URL
+ *
+ *****************************************************************************/
+int
+TvDeviceStateTableInit( IN char *DescDocURL )
+{
+    IXML_Document *DescDoc = NULL;
+    int ret = UPNP_E_SUCCESS;
+    char *servid_ctrl = NULL,
+     *evnturl_ctrl = NULL,
+     *ctrlurl_ctrl = NULL;
+    char *servid_pict = NULL,
+     *evnturl_pict = NULL,
+     *ctrlurl_pict = NULL;
+    char *udn = NULL;
+
+    //Download description document
+    if( UpnpDownloadXmlDoc( DescDocURL, &DescDoc ) != UPNP_E_SUCCESS ) {
+        SampleUtil_Print( "TvDeviceStateTableInit -- Error Parsing %s\n",
+                          DescDocURL );
+        ret = UPNP_E_INVALID_DESC;
+        goto error_handler;
+    }
+
+    udn = SampleUtil_GetFirstDocumentItem( DescDoc, "UDN" );
+
+    /*
+       Find the Tv Control Service identifiers 
+     */
+    if( !SampleUtil_FindAndParseService( DescDoc, DescDocURL,
+                                         TvServiceType[TV_SERVICE_CONTROL],
+                                         &servid_ctrl, &evnturl_ctrl,
+                                         &ctrlurl_ctrl ) ) {
+        SampleUtil_Print( "TvDeviceStateTableInit -- Error: Could not find"
+                          " Service: %s\n",
+                          TvServiceType[TV_SERVICE_CONTROL] );
+
+        ret = UPNP_E_INVALID_DESC;
+        goto error_handler;
+    }
+
+    //set control service table
+    SetServiceTable( TV_SERVICE_CONTROL, udn, servid_ctrl,
+                     TvServiceType[TV_SERVICE_CONTROL],
+                     &tv_service_table[TV_SERVICE_CONTROL] );
+
+    /*
+       Find the Tv Picture Service identifiers 
+     */
+    if( !SampleUtil_FindAndParseService( DescDoc, DescDocURL,
+                                         TvServiceType[TV_SERVICE_PICTURE],
+                                         &servid_pict, &evnturl_pict,
+                                         &ctrlurl_pict ) ) {
+        SampleUtil_Print( "TvDeviceStateTableInit -- Error: Could not find"
+                          " Service: %s\n",
+                          TvServiceType[TV_SERVICE_PICTURE] );
+
+        ret = UPNP_E_INVALID_DESC;
+        goto error_handler;
+    }
+    //set picture service table
+    SetServiceTable( TV_SERVICE_PICTURE, udn, servid_pict,
+                     TvServiceType[TV_SERVICE_PICTURE],
+                     &tv_service_table[TV_SERVICE_PICTURE] );
+
+  error_handler:
+
+    //clean up
+    if( udn )
+        free( udn );
+    if( servid_ctrl )
+        free( servid_ctrl );
+    if( evnturl_ctrl )
+        free( evnturl_ctrl );
+    if( ctrlurl_ctrl )
+        free( ctrlurl_ctrl );
+    if( servid_pict )
+        free( servid_pict );
+    if( evnturl_pict )
+        free( evnturl_pict );
+    if( ctrlurl_pict )
+        free( ctrlurl_pict );
+    if( DescDoc )
+        ixmlDocument_free( DescDoc );
+
+    return ( ret );
+}
+
+/******************************************************************************
+ * TvDeviceHandleSubscriptionRequest
+ *
+ * Description: 
+ *       Called during a subscription request callback.  If the
+ *       subscription request is for this device and either its
+ *       control service or picture service, then accept it.
+ *
+ * Parameters:
+ *   sr_event -- The subscription request event structure
+ *
+ *****************************************************************************/
+int
+TvDeviceHandleSubscriptionRequest( IN struct Upnp_Subscription_Request
+                                   *sr_event )
+{
+    unsigned int i = 0;         //,j=0;
+
+    // IXML_Document *PropSet=NULL;
+
+    //lock state mutex
+    ithread_mutex_lock( &TVDevMutex );
+
+    for( i = 0; i < TV_SERVICE_SERVCOUNT; i++ ) {
+        if( ( strcmp( sr_event->UDN, tv_service_table[i].UDN ) == 0 ) &&
+            ( strcmp( sr_event->ServiceId, tv_service_table[i].ServiceId )
+              == 0 ) ) {
+
+            /*
+               PropSet = NULL;
+
+               for (j=0; j< tv_service_table[i].VariableCount; j++)
+               {
+               //add each variable to the property set
+               //for initial state dump
+               UpnpAddToPropertySet(&PropSet, 
+               tv_service_table[i].VariableName[j],
+               tv_service_table[i].VariableStrVal[j]);
+               }
+
+               //dump initial state 
+               UpnpAcceptSubscriptionExt(device_handle, sr_event->UDN, 
+               sr_event->ServiceId,
+               PropSet,sr_event->Sid);
+               //free document
+               Document_free(PropSet);
+
+             */
+
+            UpnpAcceptSubscription( device_handle,
+                                    sr_event->UDN,
+                                    sr_event->ServiceId,
+                                    ( const char ** )tv_service_table[i].
+                                    VariableName,
+                                    ( const char ** )tv_service_table[i].
+                                    VariableStrVal,
+                                    tv_service_table[i].VariableCount,
+                                    sr_event->Sid );
+
+        }
+    }
+
+    ithread_mutex_unlock( &TVDevMutex );
+
+    return ( 1 );
+}
+
+/******************************************************************************
+ * TvDeviceHandleGetVarRequest
+ *
+ * Description: 
+ *       Called during a get variable request callback.  If the
+ *       request is for this device and either its control service
+ *       or picture service, then respond with the variable value.
+ *
+ * Parameters:
+ *   cgv_event -- The control get variable request event structure
+ *
+ *****************************************************************************/
+int
+TvDeviceHandleGetVarRequest( INOUT struct Upnp_State_Var_Request
+                             *cgv_event )
+{
+    unsigned int i = 0,
+      j = 0;
+    int getvar_succeeded = 0;
+
+    cgv_event->CurrentVal = NULL;
+
+    ithread_mutex_lock( &TVDevMutex );
+
+    for( i = 0; i < TV_SERVICE_SERVCOUNT; i++ ) {
+        //check udn and service id
+        if( ( strcmp( cgv_event->DevUDN, tv_service_table[i].UDN ) == 0 )
+            &&
+            ( strcmp( cgv_event->ServiceID, tv_service_table[i].ServiceId )
+              == 0 ) ) {
+            //check variable name
+            for( j = 0; j < tv_service_table[i].VariableCount; j++ ) {
+                if( strcmp( cgv_event->StateVarName,
+                            tv_service_table[i].VariableName[j] ) == 0 ) {
+                    getvar_succeeded = 1;
+                    cgv_event->CurrentVal =
+                        ixmlCloneDOMString( tv_service_table[i].
+                                            VariableStrVal[j] );
+                    break;
+                }
+            }
+        }
+    }
+
+    if( getvar_succeeded ) {
+        cgv_event->ErrCode = UPNP_E_SUCCESS;
+    } else {
+        SampleUtil_Print
+            ( "Error in UPNP_CONTROL_GET_VAR_REQUEST callback:\n" );
+        SampleUtil_Print( "   Unknown variable name = %s\n",
+                          cgv_event->StateVarName );
+        cgv_event->ErrCode = 404;
+        strcpy( cgv_event->ErrStr, "Invalid Variable" );
+    }
+
+    ithread_mutex_unlock( &TVDevMutex );
+
+    return ( cgv_event->ErrCode == UPNP_E_SUCCESS );
+}
+
+/******************************************************************************
+ * TvDeviceHandleActionRequest
+ *
+ * Description: 
+ *       Called during an action request callback.  If the
+ *       request is for this device and either its control service
+ *       or picture service, then perform the action and respond.
+ *
+ * Parameters:
+ *   ca_event -- The control action request event structure
+ *
+ *****************************************************************************/
+int
+TvDeviceHandleActionRequest( INOUT struct Upnp_Action_Request *ca_event )
+{
+
+    /*
+       Defaults if action not found 
+     */
+    int action_found = 0;
+    int i = 0;
+    int service = -1;
+    int retCode = 0;
+    char *errorString = NULL;
+
+    ca_event->ErrCode = 0;
+    ca_event->ActionResult = NULL;
+
+    if( ( strcmp( ca_event->DevUDN,
+                  tv_service_table[TV_SERVICE_CONTROL].UDN ) == 0 ) &&
+        ( strcmp
+          ( ca_event->ServiceID,
+            tv_service_table[TV_SERVICE_CONTROL].ServiceId ) == 0 ) ) {
+        /*
+           Request for action in the TvDevice Control Service 
+         */
+        service = TV_SERVICE_CONTROL;
+    } else if( ( strcmp( ca_event->DevUDN,
+                         tv_service_table[TV_SERVICE_PICTURE].UDN ) == 0 )
+               &&
+               ( strcmp
+                 ( ca_event->ServiceID,
+                   tv_service_table[TV_SERVICE_PICTURE].ServiceId ) ==
+                 0 ) ) {
+        /*
+           Request for action in the TvDevice Picture Service 
+         */
+        service = TV_SERVICE_PICTURE;
+    }
+    //Find and call appropriate procedure based on action name
+    //Each action name has an associated procedure stored in the
+    //service table. These are set at initialization.
+
+    for( i = 0; ( ( i < TV_MAXACTIONS ) &&
+                  ( tv_service_table[service].ActionNames[i] != NULL ) );
+         i++ ) {
+
+        if( !strcmp( ca_event->ActionName,
+                     tv_service_table[service].ActionNames[i] ) ) {
+
+            if( ( !strcmp( tv_service_table[TV_SERVICE_CONTROL].
+                           VariableStrVal[TV_CONTROL_POWER], "1" ) )
+                || ( !strcmp( ca_event->ActionName, "PowerOn" ) ) ) {
+                retCode =
+                    tv_service_table[service].actions[i] ( ca_event->
+                                                           ActionRequest,
+                                                           &ca_event->
+                                                           ActionResult,
+                                                           &errorString );
+            } else {
+                errorString = "Power is Off";
+                retCode = UPNP_E_INTERNAL_ERROR;
+            }
+            action_found = 1;
+            break;
+        }
+    }
+
+    if( !action_found ) {
+        ca_event->ActionResult = NULL;
+        strcpy( ca_event->ErrStr, "Invalid Action" );
+        ca_event->ErrCode = 401;
+    } else {
+        if( retCode == UPNP_E_SUCCESS ) {
+            ca_event->ErrCode = UPNP_E_SUCCESS;
+        } else {
+            //copy the error string 
+            strcpy( ca_event->ErrStr, errorString );
+            switch ( retCode ) {
+                case UPNP_E_INVALID_PARAM:
+                    {
+                        ca_event->ErrCode = 402;
+                        break;
+                    }
+                case UPNP_E_INTERNAL_ERROR:
+                default:
+                    {
+                        ca_event->ErrCode = 501;
+                        break;
+                    }
+
+            }
+        }
+    }
+
+    return ( ca_event->ErrCode );
+}
+
+/******************************************************************************
+ * TvDeviceSetServiceTableVar
+ *
+ * Description: 
+ *       Update the TvDevice service state table, and notify all subscribed 
+ *       control points of the updated state.  Note that since this function
+ *       blocks on the mutex TVDevMutex, to avoid a hang this function should 
+ *       not be called within any other function that currently has this mutex 
+ *       locked.
+ *
+ * Parameters:
+ *   service -- The service number (TV_SERVICE_CONTROL or TV_SERVICE_PICTURE)
+ *   variable -- The variable number (TV_CONTROL_POWER, TV_CONTROL_CHANNEL,
+ *                   TV_CONTROL_VOLUME, TV_PICTURE_COLOR, TV_PICTURE_TINT,
+ *                   TV_PICTURE_CONTRAST, or TV_PICTURE_BRIGHTNESS)
+ *   value -- The string representation of the new value
+ *
+ *****************************************************************************/
+int
+TvDeviceSetServiceTableVar( IN unsigned int service,
+                            IN unsigned int variable,
+                            IN char *value )
+{
+    //IXML_Document  *PropSet= NULL;
+
+    if( ( service >= TV_SERVICE_SERVCOUNT )
+        || ( variable >= tv_service_table[service].VariableCount )
+        || ( strlen( value ) >= TV_MAX_VAL_LEN ) ) {
+        return ( 0 );
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+
+    strcpy( tv_service_table[service].VariableStrVal[variable], value );
+
+    /*
+       //Using utility api
+       PropSet= UpnpCreatePropertySet(1,tv_service_table[service].
+       VariableName[variable], 
+       tv_service_table[service].
+       VariableStrVal[variable]);
+
+       UpnpNotifyExt(device_handle, tv_service_table[service].UDN, 
+       tv_service_table[service].ServiceId,PropSet);
+
+       //Free created property set
+       Document_free(PropSet);
+     */
+
+    UpnpNotify( device_handle,
+                tv_service_table[service].UDN,
+                tv_service_table[service].ServiceId,
+                ( const char ** )&tv_service_table[service].
+                VariableName[variable],
+                ( const char ** )&tv_service_table[service].
+                VariableStrVal[variable], 1 );
+
+    ithread_mutex_unlock( &TVDevMutex );
+
+    return ( 1 );
+
+}
+
+/******************************************************************************
+ * TvDeviceSetPower
+ *
+ * Description: 
+ *       Turn the power on/off, update the TvDevice control service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   on -- If 1, turn power on.  If 0, turn power off.
+ *
+ *****************************************************************************/
+int
+TvDeviceSetPower( IN int on )
+{
+    char value[TV_MAX_VAL_LEN];
+    int ret = 0;
+
+    if( on != POWER_ON && on != POWER_OFF ) {
+        SampleUtil_Print( "error: can't set power to value %d\n", on );
+        return ( 0 );
+    }
+
+    /*
+       Vendor-specific code to turn the power on/off goes here 
+     */
+
+    sprintf( value, "%d", on );
+    ret = TvDeviceSetServiceTableVar( TV_SERVICE_CONTROL, TV_CONTROL_POWER,
+                                      value );
+
+    return ( ret );
+}
+
+/******************************************************************************
+ * TvDevicePowerOn
+ *
+ * Description: 
+ *       Turn the power on.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in - document of action request
+ *    IXML_Document **out - action result
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDevicePowerOn( IN IXML_Document * in,
+                 OUT IXML_Document ** out,
+                 OUT char **errorString )
+{
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( TvDeviceSetPower( POWER_ON ) ) {
+        //create a response
+
+        if( UpnpAddToActionResponse( out, "PowerOn",
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "Power", "1" ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * TvDevicePowerOff
+ *
+ * Description: 
+ *       Turn the power off.
+ *
+ * Parameters:
+ *    
+ *    IXML_Document * in - document of action request
+ *    IXML_Document **out - action result
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDevicePowerOff( IN IXML_Document * in,
+                  OUT IXML_Document ** out,
+                  OUT char **errorString )
+{
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+    if( TvDeviceSetPower( POWER_OFF ) ) {
+        //create a response
+
+        if( UpnpAddToActionResponse( out, "PowerOff",
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "Power", "0" ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+
+        return UPNP_E_SUCCESS;
+    }
+
+    ( *errorString ) = "Internal Error";
+    return UPNP_E_INTERNAL_ERROR;
+}
+
+/******************************************************************************
+ * TvDeviceSetChannel
+ *
+ * Description: 
+ *       Change the channel, update the TvDevice control service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *    
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceSetChannel( IN IXML_Document * in,
+                    OUT IXML_Document ** out,
+                    OUT char **errorString )
+{
+
+    char *value = NULL;
+
+    int channel = 0;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Channel" ) ) ) {
+        ( *errorString ) = "Invalid Channel";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    channel = atoi( value );
+
+    if( channel < MIN_CHANNEL || channel > MAX_CHANNEL ) {
+
+        free( value );
+        SampleUtil_Print( "error: can't change to channel %d\n", channel );
+        ( *errorString ) = "Invalid Channel";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_CONTROL,
+                                    TV_CONTROL_CHANNEL, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetChannel",
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "NewChannel",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementChannel
+ *
+ * Description: 
+ *       Increment the channel.  Read the current channel from the state
+ *       table, add the increment, and then change the channel.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the channel.
+ *      
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+IncrementChannel( IN int incr,
+                  IN IXML_Document * in,
+                  OUT IXML_Document ** out,
+                  OUT char **errorString )
+{
+    int curchannel,
+      newchannel;
+
+    char *actionName = NULL;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseChannel";
+    } else {
+        actionName = "DecreaseChannel";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curchannel = atoi( tv_service_table[TV_SERVICE_CONTROL].
+                       VariableStrVal[TV_CONTROL_CHANNEL] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newchannel = curchannel + incr;
+
+    if( newchannel < MIN_CHANNEL || newchannel > MAX_CHANNEL ) {
+        SampleUtil_Print( "error: can't change to channel %d\n",
+                          newchannel );
+        ( *errorString ) = "Invalid Channel";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newchannel );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_CONTROL,
+                                    TV_CONTROL_CHANNEL, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "Channel", value ) != UPNP_E_SUCCESS )
+        {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseChannel
+ *
+ * Description: 
+ *       Decrease the channel.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceDecreaseChannel( IN IXML_Document * in,
+                         OUT IXML_Document ** out,
+                         OUT char **errorString )
+{
+    return IncrementChannel( -1, in, out, errorString );
+
+}
+
+/******************************************************************************
+ * TvDeviceIncreaseChannel
+ *
+ * Description: 
+ *       Increase the channel.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceIncreaseChannel( IN IXML_Document * in,
+                         OUT IXML_Document ** out,
+                         OUT char **errorString )
+{
+    return IncrementChannel( 1, in, out, errorString );
+
+}
+
+/******************************************************************************
+ * TvDeviceSetVolume
+ *
+ * Description: 
+ *       Change the volume, update the TvDevice control service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *  
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceSetVolume( IN IXML_Document * in,
+                   OUT IXML_Document ** out,
+                   OUT char **errorString )
+{
+
+    char *value = NULL;
+
+    int volume = 0;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Volume" ) ) ) {
+        ( *errorString ) = "Invalid Volume";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    volume = atoi( value );
+
+    if( volume < MIN_VOLUME || volume > MAX_VOLUME ) {
+        SampleUtil_Print( "error: can't change to volume %d\n", volume );
+        ( *errorString ) = "Invalid Volume";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the volume goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_CONTROL,
+                                    TV_CONTROL_VOLUME, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetVolume",
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "NewVolume",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementVolume
+ *
+ * Description: 
+ *       Increment the volume.  Read the current volume from the state
+ *       table, add the increment, and then change the volume.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the volume.
+ *      
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+IncrementVolume( IN int incr,
+                 IN IXML_Document * in,
+                 OUT IXML_Document ** out,
+                 OUT char **errorString )
+{
+    int curvolume,
+      newvolume;
+    char *actionName = NULL;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseVolume";
+    } else {
+        actionName = "DecreaseVolume";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curvolume = atoi( tv_service_table[TV_SERVICE_CONTROL].
+                      VariableStrVal[TV_CONTROL_VOLUME] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newvolume = curvolume + incr;
+
+    if( newvolume < MIN_VOLUME || newvolume > MAX_VOLUME ) {
+        SampleUtil_Print( "error: can't change to volume %d\n",
+                          newvolume );
+        ( *errorString ) = "Invalid Volume";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newvolume );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_CONTROL,
+                                    TV_CONTROL_VOLUME, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "Volume", value ) != UPNP_E_SUCCESS )
+        {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * TvDeviceIncrVolume
+ *
+ * Description: 
+ *       Increase the volume. 
+ *
+ * Parameters:
+ *   
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+TvDeviceIncreaseVolume( IN IXML_Document * in,
+                        OUT IXML_Document ** out,
+                        OUT char **errorString )
+{
+
+    return IncrementVolume( 1, in, out, errorString );
+
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseVolume
+ *
+ * Description: 
+ *       Decrease the volume.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceDecreaseVolume( IN IXML_Document * in,
+                        OUT IXML_Document ** out,
+                        OUT char **errorString )
+{
+
+    return IncrementVolume( -1, in, out, errorString );
+
+}
+
+/******************************************************************************
+ * TvDeviceSetColor
+ *
+ * Description: 
+ *       Change the color, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceSetColor( IN IXML_Document * in,
+                  OUT IXML_Document ** out,
+                  OUT char **errorString )
+{
+
+    char *value = NULL;
+
+    int color = 0;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Color" ) ) ) {
+        ( *errorString ) = "Invalid Color";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    color = atoi( value );
+
+    if( color < MIN_COLOR || color > MAX_COLOR ) {
+        SampleUtil_Print( "error: can't change to color %d\n", color );
+        ( *errorString ) = "Invalid Color";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the volume goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_COLOR, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetColor",
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "NewColor",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementColor
+ *
+ * Description: 
+ *       Increment the color.  Read the current color from the state
+ *       table, add the increment, and then change the color.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the color.
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+
+int
+IncrementColor( IN int incr,
+                IN IXML_Document * in,
+                OUT IXML_Document ** out,
+                OUT char **errorString )
+{
+    int curcolor,
+      newcolor;
+
+    char *actionName;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseColor";
+    } else {
+        actionName = "DecreaseColor";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curcolor = atoi( tv_service_table[TV_SERVICE_PICTURE].
+                     VariableStrVal[TV_PICTURE_COLOR] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newcolor = curcolor + incr;
+
+    if( newcolor < MIN_COLOR || newcolor > MAX_COLOR ) {
+        SampleUtil_Print( "error: can't change to color %d\n", newcolor );
+        ( *errorString ) = "Invalid Color";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newcolor );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_COLOR, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "Color", value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseColor
+ *
+ * Description: 
+ *       Decrease the color.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+TvDeviceDecreaseColor( IN IXML_Document * in,
+                       OUT IXML_Document ** out,
+                       OUT char **errorString )
+{
+
+    return IncrementColor( -1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceIncreaseColor
+ *
+ * Description: 
+ *       Increase the color.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+TvDeviceIncreaseColor( IN IXML_Document * in,
+                       OUT IXML_Document ** out,
+                       OUT char **errorString )
+{
+
+    return IncrementColor( 1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceSetTint
+ *
+ * Description: 
+ *       Change the tint, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceSetTint( IN IXML_Document * in,
+                 OUT IXML_Document ** out,
+                 OUT char **errorString )
+{
+
+    char *value = NULL;
+
+    int tint = -1;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Tint" ) ) ) {
+        ( *errorString ) = "Invalid Tint";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    tint = atoi( value );
+
+    if( tint < MIN_TINT || tint > MAX_TINT ) {
+        SampleUtil_Print( "error: can't change to tint %d\n", tint );
+        ( *errorString ) = "Invalid Tint";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the volume goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_TINT, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetTint",
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "NewTint", value ) != UPNP_E_SUCCESS )
+        {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementTint
+ *
+ * Description: 
+ *       Increment the tint.  Read the current tint from the state
+ *       table, add the increment, and then change the tint.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the tint.
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+IncrementTint( IN int incr,
+               IN IXML_Document * in,
+               OUT IXML_Document ** out,
+               OUT char **errorString )
+{
+    int curtint,
+      newtint;
+
+    char *actionName = NULL;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseTint";
+    } else {
+        actionName = "DecreaseTint";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curtint = atoi( tv_service_table[TV_SERVICE_PICTURE].
+                    VariableStrVal[TV_PICTURE_TINT] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newtint = curtint + incr;
+
+    if( newtint < MIN_TINT || newtint > MAX_TINT ) {
+        SampleUtil_Print( "error: can't change to tint %d\n", newtint );
+        ( *errorString ) = "Invalid Tint";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newtint );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_TINT, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "Tint", value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * TvDeviceIncreaseTint
+ *
+ * Description: 
+ *       Increase tint.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceIncreaseTint( IN IXML_Document * in,
+                      OUT IXML_Document ** out,
+                      OUT char **errorString )
+{
+
+    return IncrementTint( 1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseTint
+ *
+ * Description: 
+ *       Decrease tint.
+ *
+ * Parameters:
+ *  
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceDecreaseTint( IN IXML_Document * in,
+                      OUT IXML_Document ** out,
+                      OUT char **errorString )
+{
+
+    return IncrementTint( -1, in, out, errorString );
+}
+
+/*****************************************************************************
+ * TvDeviceSetContrast
+ *
+ * Description: 
+ *       Change the contrast, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ ****************************************************************************/
+int
+TvDeviceSetContrast( IN IXML_Document * in,
+                     OUT IXML_Document ** out,
+                     OUT char **errorString )
+{
+
+    char *value = NULL;
+    int contrast = -1;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Contrast" ) ) ) {
+        ( *errorString ) = "Invalid Contrast";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    contrast = atoi( value );
+
+    if( contrast < MIN_CONTRAST || contrast > MAX_CONTRAST ) {
+        SampleUtil_Print( "error: can't change to contrast %d\n",
+                          contrast );
+        ( *errorString ) = "Invalid Contrast";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the volume goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_CONTRAST, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetContrast",
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "NewContrast",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementContrast
+ *
+ * Description: 
+ *       Increment the contrast.  Read the current contrast from the state
+ *       table, add the increment, and then change the contrast.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the contrast.
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+IncrementContrast( IN int incr,
+                   IN IXML_Document * in,
+                   OUT IXML_Document ** out,
+                   OUT char **errorString )
+{
+    int curcontrast,
+      newcontrast;
+
+    char *actionName = NULL;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseContrast";
+    } else {
+        actionName = "DecreaseContrast";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curcontrast = atoi( tv_service_table[TV_SERVICE_PICTURE].
+                        VariableStrVal[TV_PICTURE_CONTRAST] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newcontrast = curcontrast + incr;
+
+    if( newcontrast < MIN_CONTRAST || newcontrast > MAX_CONTRAST ) {
+        SampleUtil_Print( "error: can't change to contrast %d\n",
+                          newcontrast );
+        ( *errorString ) = "Invalid Contrast";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newcontrast );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_CONTRAST, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "Contrast",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+}
+
+/******************************************************************************
+ * TvDeviceIncreaseContrast
+ *
+ * Description: 
+ *
+ *      Increase the contrast.
+ *
+ * Parameters:
+ *       
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceIncreaseContrast( IN IXML_Document * in,
+                          OUT IXML_Document ** out,
+                          OUT char **errorString )
+{
+
+    return IncrementContrast( 1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseContrast
+ *
+ * Description: 
+ *      Decrease the contrast.
+ *
+ * Parameters:
+ *          
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceDecreaseContrast( IXML_Document * in,
+                          IXML_Document ** out,
+                          char **errorString )
+{
+    return IncrementContrast( -1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceSetBrightness
+ *
+ * Description: 
+ *       Change the brightness, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   brightness -- The brightness value to change to.
+ *
+ *****************************************************************************/
+int
+TvDeviceSetBrightness( IN IXML_Document * in,
+                       OUT IXML_Document ** out,
+                       OUT char **errorString )
+{
+
+    char *value = NULL;
+    int brightness = -1;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Brightness" ) ) ) {
+        ( *errorString ) = "Invalid Brightness";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    brightness = atoi( value );
+
+    if( brightness < MIN_BRIGHTNESS || brightness > MAX_BRIGHTNESS ) {
+        SampleUtil_Print( "error: can't change to brightness %d\n",
+                          brightness );
+        ( *errorString ) = "Invalid Brightness";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the volume goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_BRIGHTNESS, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetBrightness",
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "NewBrightness",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementBrightness
+ *
+ * Description: 
+ *       Increment the brightness.  Read the current brightness from the state
+ *       table, add the increment, and then change the brightness.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the brightness.
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+IncrementBrightness( IN int incr,
+                     IN IXML_Document * in,
+                     OUT IXML_Document ** out,
+                     OUT char **errorString )
+{
+    int curbrightness,
+      newbrightness;
+    char *actionName = NULL;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseBrightness";
+    } else {
+        actionName = "DecreaseBrightness";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curbrightness = atoi( tv_service_table[TV_SERVICE_PICTURE].
+                          VariableStrVal[TV_PICTURE_BRIGHTNESS] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newbrightness = curbrightness + incr;
+
+    if( newbrightness < MIN_BRIGHTNESS || newbrightness > MAX_BRIGHTNESS ) {
+        SampleUtil_Print( "error: can't change to brightness %d\n",
+                          newbrightness );
+        ( *errorString ) = "Invalid Brightness";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newbrightness );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_BRIGHTNESS, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "Brightness",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+}
+
+/******************************************************************************
+ * TvDeviceIncreaseBrightness
+ *
+ * Description: 
+ *       Increase brightness.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceIncreaseBrightness( IN IXML_Document * in,
+                            OUT IXML_Document ** out,
+                            OUT char **errorString )
+{
+    return IncrementBrightness( 1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseBrightness
+ *
+ * Description: 
+ *       Decrease brightnesss.
+ *
+ * Parameters:
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceDecreaseBrightness( IN IXML_Document * in,
+                            OUT IXML_Document ** out,
+                            OUT char **errorString )
+{
+    return IncrementBrightness( -1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceCallbackEventHandler
+ *
+ * Description: 
+ *       The callback handler registered with the SDK while registering
+ *       root device.  Dispatches the request to the appropriate procedure
+ *       based on the value of EventType. The four requests handled by the 
+ *       device are: 
+ *                   1) Event Subscription requests.  
+ *                   2) Get Variable requests. 
+ *                   3) Action requests.
+ *
+ * Parameters:
+ *
+ *   EventType -- The type of callback event
+ *   Event -- Data structure containing event data
+ *   Cookie -- Optional data specified during callback registration
+ *
+ *****************************************************************************/
+int
+TvDeviceCallbackEventHandler( Upnp_EventType EventType,
+                              void *Event,
+                              void *Cookie )
+{
+
+    switch ( EventType ) {
+
+        case UPNP_EVENT_SUBSCRIPTION_REQUEST:
+
+            TvDeviceHandleSubscriptionRequest( ( struct
+                                                 Upnp_Subscription_Request
+                                                 * )Event );
+            break;
+
+        case UPNP_CONTROL_GET_VAR_REQUEST:
+            TvDeviceHandleGetVarRequest( ( struct Upnp_State_Var_Request
+                                           * )Event );
+            break;
+
+        case UPNP_CONTROL_ACTION_REQUEST:
+            TvDeviceHandleActionRequest( ( struct Upnp_Action_Request * )
+                                         Event );
+            break;
+
+            /*
+               ignore these cases, since this is not a control point 
+             */
+        case UPNP_DISCOVERY_ADVERTISEMENT_ALIVE:
+        case UPNP_DISCOVERY_SEARCH_RESULT:
+        case UPNP_DISCOVERY_SEARCH_TIMEOUT:
+        case UPNP_DISCOVERY_ADVERTISEMENT_BYEBYE:
+        case UPNP_CONTROL_ACTION_COMPLETE:
+        case UPNP_CONTROL_GET_VAR_COMPLETE:
+        case UPNP_EVENT_RECEIVED:
+        case UPNP_EVENT_RENEWAL_COMPLETE:
+        case UPNP_EVENT_SUBSCRIBE_COMPLETE:
+        case UPNP_EVENT_UNSUBSCRIBE_COMPLETE:
+            break;
+
+        default:
+            SampleUtil_Print
+                ( "Error in TvDeviceCallbackEventHandler: unknown event type %d\n",
+                  EventType );
+    }
+
+    /*
+       Print a summary of the event received 
+     */
+    SampleUtil_PrintEvent( EventType, Event );
+
+    return ( 0 );
+}
+
+/******************************************************************************
+ * TvDeviceStop
+ *
+ * Description: 
+ *       Stops the device. Uninitializes the sdk. 
+ *
+ * Parameters:
+ *
+ *****************************************************************************/
+int
+TvDeviceStop()
+{
+    UpnpUnRegisterRootDevice( device_handle );
+    UpnpFinish();
+    SampleUtil_Finish();
+    ithread_mutex_destroy( &TVDevMutex );
+    return UPNP_E_SUCCESS;
+}
+
+/******************************************************************************
+ * TvDeviceStart
+ *
+ * Description: 
+ *      Initializes the UPnP Sdk, registers the device, and sends out 
+ *      advertisements.  
+ *
+ * Parameters:
+ *
+ *   ip_address - ip address to initialize the sdk (may be NULL)
+ *                if null, then the first non null loopback address is used.
+ *   port       - port number to initialize the sdk (may be 0)
+ *                if zero, then a random number is used.
+ *   desc_doc_name - name of description document.
+ *                   may be NULL. Default is tvcombodesc.xml
+ *   web_dir_path  - path of web directory.
+ *                   may be NULL. Default is ./web (for Linux) or ../tvdevice/web
+ *                   for windows.
+ *   pfun          - print function to use.  
+ *
+ *****************************************************************************/
+int
+TvDeviceStart( char *ip_address,
+               unsigned short port,
+               char *desc_doc_name,
+               char *web_dir_path,
+               print_string pfun )
+{
+    int ret = UPNP_E_SUCCESS;
+
+    char desc_doc_url[DESC_URL_SIZE];
+
+    ithread_mutex_init( &TVDevMutex, NULL );
+
+    SampleUtil_Initialize( pfun );
+
+    SampleUtil_Print(
+        "Initializing UPnP Sdk with\n"
+        "\tipaddress = %s port = %u\n",
+        ip_address, port );
+
+    if( ( ret = UpnpInit( ip_address, port ) ) != UPNP_E_SUCCESS ) {
+        SampleUtil_Print( "Error with UpnpInit -- %d\n", ret );
+        UpnpFinish();
+        return ret;
+    }
+
+    if( ip_address == NULL ) {
+        ip_address = UpnpGetServerIpAddress();
+    }
+
+    if( port == 0 ) {
+        port = UpnpGetServerPort();
+    }
+
+    SampleUtil_Print(
+        "UPnP Initialized\n"
+	"\tipaddress= %s port = %u\n",
+        ip_address, port );
+
+    if( desc_doc_name == NULL ) {
+        desc_doc_name = "tvcombodesc.xml";
+    }
+
+    if( web_dir_path == NULL ) {
+        web_dir_path = DEFAULT_WEB_DIR;
+    }
+
+    snprintf( desc_doc_url, DESC_URL_SIZE, "http://%s:%d/%s", ip_address,
+              port, desc_doc_name );
+
+    SampleUtil_Print( "Specifying the webserver root directory -- %s\n",
+                      web_dir_path );
+    if( ( ret =
+          UpnpSetWebServerRootDir( web_dir_path ) ) != UPNP_E_SUCCESS ) {
+        SampleUtil_Print
+            ( "Error specifying webserver root directory -- %s: %d\n",
+              web_dir_path, ret );
+        UpnpFinish();
+        return ret;
+    }
+
+    SampleUtil_Print(
+        "Registering the RootDevice\n"
+        "\t with desc_doc_url: %s\n",
+        desc_doc_url );
+
+    if( ( ret = UpnpRegisterRootDevice( desc_doc_url,
+                                        TvDeviceCallbackEventHandler,
+                                        &device_handle, &device_handle ) )
+        != UPNP_E_SUCCESS ) {
+        SampleUtil_Print( "Error registering the rootdevice : %d\n", ret );
+        UpnpFinish();
+        return ret;
+    } else {
+        SampleUtil_Print(
+            "RootDevice Registered\n"
+            "Initializing State Table\n");
+        TvDeviceStateTableInit( desc_doc_url );
+        SampleUtil_Print("State Table Initialized\n");
+
+        if( ( ret =
+              UpnpSendAdvertisement( device_handle, default_advr_expire ) )
+            != UPNP_E_SUCCESS ) {
+            SampleUtil_Print( "Error sending advertisements : %d\n", ret );
+            UpnpFinish();
+            return ret;
+        }
+
+        SampleUtil_Print("Advertisements Sent\n");
+    }
+    return UPNP_E_SUCCESS;
+}
+
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvcombo/upnp_tv_device.h libupnp-1.6.6-mod/upnp/sample-orig/tvcombo/upnp_tv_device.h
--- libupnp-1.6.6/upnp/sample-orig/tvcombo/upnp_tv_device.h	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvcombo/upnp_tv_device.h	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,640 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+#ifndef UPNP_TV_DEVICE_H
+#define UPNP_TV_DEVICE_H
+
+#include <stdio.h>
+#include <signal.h>
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+
+#include "ithread.h"
+#include <stdlib.h>
+#ifndef WIN32
+#include <unistd.h>
+#endif
+#include <string.h>
+#include "upnp.h"
+#include "sample_util.h"
+
+//Color constants
+#define MAX_COLOR 10
+#define MIN_COLOR 1
+
+//Brightness constants
+#define MAX_BRIGHTNESS 10
+#define MIN_BRIGHTNESS 1
+
+//Power constants
+#define POWER_ON 1
+#define POWER_OFF 0
+
+//Tint constants
+#define MAX_TINT 10
+#define MIN_TINT 1
+
+//Volume constants
+#define MAX_VOLUME 10
+#define MIN_VOLUME 1
+
+//Contrast constants
+#define MAX_CONTRAST 10
+#define MIN_CONTRAST 1
+
+//Channel constants
+#define MAX_CHANNEL 100
+#define MIN_CHANNEL 1
+
+//Number of services.
+#define TV_SERVICE_SERVCOUNT  2
+
+//Index of control service
+#define TV_SERVICE_CONTROL    0
+
+//Index of picture service
+#define TV_SERVICE_PICTURE    1
+
+//Number of control variables
+#define TV_CONTROL_VARCOUNT   3
+
+//Index of power variable
+#define TV_CONTROL_POWER      0
+
+//Index of channel variable
+#define TV_CONTROL_CHANNEL    1
+
+//Index of volume variable
+#define TV_CONTROL_VOLUME     2
+
+//Number of picture variables
+#define TV_PICTURE_VARCOUNT   4
+
+//Index of color variable
+#define TV_PICTURE_COLOR      0
+
+//Index of tint variable
+#define TV_PICTURE_TINT       1
+
+//Index of contrast variable
+#define TV_PICTURE_CONTRAST   2
+
+//Index of brightness variable
+#define TV_PICTURE_BRIGHTNESS 3
+
+//Max value length
+#define TV_MAX_VAL_LEN 5
+
+//Max actions
+#define TV_MAXACTIONS 12
+
+/* This should be the maximum VARCOUNT from above */
+#define TV_MAXVARS TV_PICTURE_VARCOUNT
+
+
+extern char TvDeviceType[];
+
+extern char *TvServiceType[];
+
+
+
+/******************************************************************************
+ * upnp_action
+ *
+ * Description: 
+ *       Prototype for all actions. For each action that a service 
+ *       implements, there is a corresponding function with this prototype.
+ *       Pointers to these functions, along with action names, are stored
+ *       in the service table. When an action request comes in the action
+ *       name is matched, and the appropriate function is called.
+ *       Each function returns UPNP_E_SUCCESS, on success, and a nonzero 
+ *       error code on failure.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * request - document of action request
+ *    IXML_Document **out - action result
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+
+typedef int (*upnp_action) (IXML_Document *request, IXML_Document **out, 
+			    char **errorString);
+
+/* Structure for storing Tv Service
+   identifiers and state table */
+struct TvService {
+  
+  char UDN[NAME_SIZE]; /* Universally Unique Device Name */
+  char ServiceId[NAME_SIZE];
+  char ServiceType[NAME_SIZE];
+  char *VariableName[TV_MAXVARS]; 
+  char *VariableStrVal[TV_MAXVARS];
+  char *ActionNames[TV_MAXACTIONS];
+  upnp_action actions[TV_MAXACTIONS];
+  unsigned int  VariableCount;
+};
+
+//Array of service structures
+extern struct TvService tv_service_table[];
+
+//Device handle returned from sdk
+extern UpnpDevice_Handle device_handle;
+
+
+/* Mutex for protecting the global state table data
+   in a multi-threaded, asynchronous environment.
+   All functions should lock this mutex before reading
+   or writing the state table data. */
+extern ithread_mutex_t TVDevMutex;
+
+
+
+/******************************************************************************
+ * SetActionTable
+ *
+ * Description: 
+ *       Initializes the action table for the specified service.
+ *       Note that 
+ *       knowledge of the service description is
+ *       assumed.  Action names are hardcoded.
+ * Parameters:
+ *   int serviceType - one of TV_SERVICE_CONTROL or, TV_SERVICE_PICTURE
+ *   struct TvService *out - service containing action table to set.
+ *
+ *****************************************************************************/
+int SetActionTable(int serviceType, struct TvService * out);
+
+/******************************************************************************
+ * TvDeviceStateTableInit
+ *
+ * Description: 
+ *       Initialize the device state table for 
+ * 	 this TvDevice, pulling identifier info
+ *       from the description Document.  Note that 
+ *       knowledge of the service description is
+ *       assumed.  State table variables and default
+ *       values are currently hardcoded in this file
+ *       rather than being read from service description
+ *       documents.
+ *
+ * Parameters:
+ *   DescDocURL -- The description document URL
+ *
+ *****************************************************************************/
+int TvDeviceStateTableInit(char*);
+
+
+/******************************************************************************
+ * TvDeviceHandleSubscriptionRequest
+ *
+ * Description: 
+ *       Called during a subscription request callback.  If the
+ *       subscription request is for this device and either its
+ *       control service or picture service, then accept it.
+ *
+ * Parameters:
+ *   sr_event -- The subscription request event structure
+ *
+ *****************************************************************************/
+int TvDeviceHandleSubscriptionRequest(struct Upnp_Subscription_Request *);
+
+/******************************************************************************
+ * TvDeviceHandleGetVarRequest
+ *
+ * Description: 
+ *       Called during a get variable request callback.  If the
+ *       request is for this device and either its control service
+ *       or picture service, then respond with the variable value.
+ *
+ * Parameters:
+ *   cgv_event -- The control get variable request event structure
+ *
+ *****************************************************************************/
+int TvDeviceHandleGetVarRequest(struct Upnp_State_Var_Request *);
+
+/******************************************************************************
+ * TvDeviceHandleActionRequest
+ *
+ * Description: 
+ *       Called during an action request callback.  If the
+ *       request is for this device and either its control service
+ *       or picture service, then perform the action and respond.
+ *
+ * Parameters:
+ *   ca_event -- The control action request event structure
+ *
+ *****************************************************************************/
+int TvDeviceHandleActionRequest(struct Upnp_Action_Request *);
+
+/******************************************************************************
+ * TvDeviceCallbackEventHandler
+ *
+ * Description: 
+ *       The callback handler registered with the SDK while registering
+ *       root device.  Dispatches the request to the appropriate procedure
+ *       based on the value of EventType. The four requests handled by the 
+ *       device are: 
+ *                   1) Event Subscription requests.  
+ *                   2) Get Variable requests. 
+ *                   3) Action requests.
+ *
+ * Parameters:
+ *
+ *   EventType -- The type of callback event
+ *   Event -- Data structure containing event data
+ *   Cookie -- Optional data specified during callback registration
+ *
+ *****************************************************************************/
+int TvDeviceCallbackEventHandler(Upnp_EventType, void*, void*);
+
+/******************************************************************************
+ * TvDeviceSetServiceTableVar
+ *
+ * Description: 
+ *       Update the TvDevice service state table, and notify all subscribed 
+ *       control points of the updated state.  Note that since this function
+ *       blocks on the mutex TVDevMutex, to avoid a hang this function should 
+ *       not be called within any other function that currently has this mutex 
+ *       locked.
+ *
+ * Parameters:
+ *   service -- The service number (TV_SERVICE_CONTROL or TV_SERVICE_PICTURE)
+ *   variable -- The variable number (TV_CONTROL_POWER, TV_CONTROL_CHANNEL,
+ *                   TV_CONTROL_VOLUME, TV_PICTURE_COLOR, TV_PICTURE_TINT,
+ *                   TV_PICTURE_CONTRAST, or TV_PICTURE_BRIGHTNESS)
+ *   value -- The string representation of the new value
+ *
+ *****************************************************************************/
+int TvDeviceSetServiceTableVar(unsigned int, unsigned int, char*);
+
+//Control Service Actions
+
+/******************************************************************************
+ * TvDevicePowerOn
+ *
+ * Description: 
+ *       Turn the power on.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in - document of action request
+ *    IXML_Document **out - action result
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDevicePowerOn(IN IXML_Document * in, OUT IXML_Document **out, 
+		    OUT char **errorString);
+
+/******************************************************************************
+ * TvDevicePowerOff
+ *
+ * Description: 
+ *       Turn the power off.
+ *
+ * Parameters:
+ *    
+ *    IXML_Document * in - document of action request
+ *    IXML_Document **out - action result
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDevicePowerOff(IN IXML_Document *in, OUT IXML_Document **out, 
+		     OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceSetChannel
+ *
+ * Description: 
+ *       Change the channel, update the TvDevice control service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *    
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceSetChannel(IN IXML_Document *in, OUT IXML_Document **out, 
+		       OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceIncreaseChannel
+ *
+ * Description: 
+ *       Increase the channel.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceIncreaseChannel(IN IXML_Document *in, OUT IXML_Document **out, 
+			    OUT char **errorString);
+/******************************************************************************
+ * TvDeviceDecreaseChannel
+ *
+ * Description: 
+ *       Decrease the channel.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceDecreaseChannel(IN IXML_Document *in, OUT IXML_Document **out, 
+			    OUT char **errorString);
+/******************************************************************************
+ * TvDeviceSetVolume
+ *
+ * Description: 
+ *       Change the volume, update the TvDevice control service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *  
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceSetVolume(IN IXML_Document *in, OUT IXML_Document **out, 
+		      OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceIncreaseVolume
+ *
+ * Description: 
+ *       Increase the volume. 
+ *
+ * Parameters:
+ *   
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int TvDeviceIncreaseVolume(IN IXML_Document *in, OUT IXML_Document**out, 
+			   OUT char **errorString);
+
+
+/******************************************************************************
+ * TvDeviceDecreaseVolume
+ *
+ * Description: 
+ *       Decrease the volume.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceDecreaseVolume(IN IXML_Document *in, OUT IXML_Document**out, 
+			   OUT char **errorString);
+
+
+//Picture Service Actions
+
+/******************************************************************************
+ * TvDeviceSetColor
+ *
+ * Description: 
+ *       Change the color, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceSetColor(IN IXML_Document *in, OUT IXML_Document **out, 
+		     OUT char **errorString);
+
+
+/******************************************************************************
+ * TvDeviceIncreaseColor
+ *
+ * Description: 
+ *       Increase the color.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int TvDeviceIncreaseColor(IN IXML_Document * in, OUT IXML_Document **out, 
+			  OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceDecreaseColor
+ *
+ * Description: 
+ *       Decrease the color.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int TvDeviceDecreaseColor(IN IXML_Document * in, OUT IXML_Document **out, 
+			  OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceSetTint
+ *
+ * Description: 
+ *       Change the tint, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceSetTint(IN IXML_Document *in, OUT IXML_Document **out, 
+		    OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceIncreaseTint
+ *
+ * Description: 
+ *       Increase tint.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceIncreaseTint(IN IXML_Document *in, OUT IXML_Document **out, 
+			 OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceDecreaseTint
+ *
+ * Description: 
+ *       Decrease tint.
+ *
+ * Parameters:
+ *  
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceDecreaseTint(IN IXML_Document *in, OUT IXML_Document **out, 
+			 OUT char **errorString);
+
+/*****************************************************************************
+ * TvDeviceSetContrast
+ *
+ * Description: 
+ *       Change the contrast, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ ****************************************************************************/
+int TvDeviceSetContrast(IN IXML_Document *in, OUT IXML_Document **out, 
+			OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceIncreaseContrast
+ *
+ * Description: 
+ *
+ *      Increase the contrast.
+ *
+ * Parameters:
+ *       
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceIncreaseContrast(IN IXML_Document *in, OUT IXML_Document **out, 
+			     OUT char **errorString);
+/******************************************************************************
+ * TvDeviceDecreaseContrast
+ *
+ * Description: 
+ *      Decrease the contrast.
+ *
+ * Parameters:
+ *          
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceDecreaseContrast(IN IXML_Document *in, OUT IXML_Document **out, 
+			     OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceSetBrightness
+ *
+ * Description: 
+ *       Change the brightness, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   brightness -- The brightness value to change to.
+ *
+ *****************************************************************************/
+int TvDeviceSetBrightness(IN IXML_Document *in, OUT IXML_Document **out, 
+			  OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceIncreaseBrightness
+ *
+ * Description: 
+ *       Increase brightness.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceIncreaseBrightness(IN IXML_Document *in, OUT IXML_Document **out, 
+			       OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceDecreaseBrightness
+ *
+ * Description: 
+ *       Decrease brightnesss.
+ *
+ * Parameters:
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceDecreaseBrightness(IN IXML_Document *in, OUT IXML_Document **out, 
+			       OUT char **errorString);
+
+int TvDeviceStart(char * ip_address, unsigned short port,char * desc_doc_name,
+				  char *web_dir_path, print_string pfun);
+int TvDeviceStop();
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvctrlpt/linux/upnp_tv_ctrlpt_main.c libupnp-1.6.6-mod/upnp/sample-orig/tvctrlpt/linux/upnp_tv_ctrlpt_main.c
--- libupnp-1.6.6/upnp/sample-orig/tvctrlpt/linux/upnp_tv_ctrlpt_main.c	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvctrlpt/linux/upnp_tv_ctrlpt_main.c	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,441 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+
+#include "sample_util.h"
+#include "upnp_tv_ctrlpt.h"
+
+
+#include <stdio.h>
+#include <string.h>
+
+/*
+   Tags for valid commands issued at the command prompt 
+ */
+enum cmdloop_tvcmds {
+    PRTHELP = 0, PRTFULLHELP, POWON, POWOFF,
+    SETCHAN, SETVOL, SETCOL, SETTINT, SETCONT, SETBRT,
+    CTRLACTION, PICTACTION, CTRLGETVAR, PICTGETVAR,
+    PRTDEV, LSTDEV, REFRESH, EXITCMD
+};
+
+/*
+   Data structure for parsing commands from the command line 
+ */
+struct cmdloop_commands {
+    char *str;                  // the string 
+    int cmdnum;                 // the command
+    int numargs;                // the number of arguments
+    char *args;                 // the args
+} cmdloop_commands;
+
+/*
+   Mappings between command text names, command tag,
+   and required command arguments for command line
+   commands 
+ */
+static struct cmdloop_commands cmdloop_cmdlist[] = {
+    {"Help", PRTHELP, 1, ""},
+    {"HelpFull", PRTFULLHELP, 1, ""},
+    {"ListDev", LSTDEV, 1, ""},
+    {"Refresh", REFRESH, 1, ""},
+    {"PrintDev", PRTDEV, 2, "<devnum>"},
+    {"PowerOn", POWON, 2, "<devnum>"},
+    {"PowerOff", POWOFF, 2, "<devnum>"},
+    {"SetChannel", SETCHAN, 3, "<devnum> <channel (int)>"},
+    {"SetVolume", SETVOL, 3, "<devnum> <volume (int)>"},
+    {"SetColor", SETCOL, 3, "<devnum> <color (int)>"},
+    {"SetTint", SETTINT, 3, "<devnum> <tint (int)>"},
+    {"SetContrast", SETCONT, 3, "<devnum> <contrast (int)>"},
+    {"SetBrightness", SETBRT, 3, "<devnum> <brightness (int)>"},
+    {"CtrlAction", CTRLACTION, 2, "<devnum> <action (string)>"},
+    {"PictAction", PICTACTION, 2, "<devnum> <action (string)>"},
+    {"CtrlGetVar", CTRLGETVAR, 2, "<devnum> <varname (string)>"},
+    {"PictGetVar", PICTGETVAR, 2, "<devnum> <varname (string)>"},
+    {"Exit", EXITCMD, 1, ""}
+};
+
+void
+linux_print( const char *string )
+{
+    puts( string );
+}
+
+/********************************************************************************
+ * TvCtrlPointPrintHelp
+ *
+ * Description: 
+ *       Print help info for this application.
+ ********************************************************************************/
+void
+TvCtrlPointPrintShortHelp( void )
+{
+    SampleUtil_Print( "Commands:" );
+    SampleUtil_Print( "  Help" );
+    SampleUtil_Print( "  HelpFull" );
+    SampleUtil_Print( "  ListDev" );
+    SampleUtil_Print( "  Refresh" );
+    SampleUtil_Print( "  PrintDev      <devnum>" );
+    SampleUtil_Print( "  PowerOn       <devnum>" );
+    SampleUtil_Print( "  PowerOff      <devnum>" );
+    SampleUtil_Print( "  SetChannel    <devnum> <channel>" );
+    SampleUtil_Print( "  SetVolume     <devnum> <volume>" );
+    SampleUtil_Print( "  SetColor      <devnum> <color>" );
+    SampleUtil_Print( "  SetTint       <devnum> <tint>" );
+    SampleUtil_Print( "  SetContrast   <devnum> <contrast>" );
+    SampleUtil_Print( "  SetBrightness <devnum> <brightness>" );
+    SampleUtil_Print( "  CtrlAction    <devnum> <action>" );
+    SampleUtil_Print( "  PictAction    <devnum> <action>" );
+    SampleUtil_Print( "  CtrlGetVar    <devnum> <varname>" );
+    SampleUtil_Print( "  PictGetVar    <devnum> <action>" );
+    SampleUtil_Print( "  Exit" );
+}
+
+void
+TvCtrlPointPrintLongHelp( void )
+{
+    SampleUtil_Print( "" );
+    SampleUtil_Print( "******************************" );
+    SampleUtil_Print( "* TV Control Point Help Info *" );
+    SampleUtil_Print( "******************************" );
+    SampleUtil_Print( "" );
+    SampleUtil_Print( "This sample control point application automatically searches" );
+    SampleUtil_Print( "for and subscribes to the services of television device emulator" );
+    SampleUtil_Print( "devices, described in the tvdevicedesc.xml description document." );
+    SampleUtil_Print( "" );
+    SampleUtil_Print( "Commands:" );
+    SampleUtil_Print( "  Help" );
+    SampleUtil_Print( "       Print this help info." );
+    SampleUtil_Print( "  ListDev" );
+    SampleUtil_Print( "       Print the current list of TV Device Emulators that this" );
+    SampleUtil_Print( "         control point is aware of.  Each device is preceded by a" );
+    SampleUtil_Print( "         device number which corresponds to the devnum argument of" );
+    SampleUtil_Print( "         commands listed below." );
+    SampleUtil_Print( "  Refresh" );
+    SampleUtil_Print( "       Delete all of the devices from the device list and issue new" );
+    SampleUtil_Print( "         search request to rebuild the list from scratch." );
+    SampleUtil_Print( "  PrintDev       <devnum>" );
+    SampleUtil_Print( "       Print the state table for the device <devnum>." );
+    SampleUtil_Print( "         e.g., 'PrintDev 1' prints the state table for the first" );
+    SampleUtil_Print( "         device in the device list." );
+    SampleUtil_Print( "  PowerOn        <devnum>" );
+    SampleUtil_Print( "       Sends the PowerOn action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>." );
+    SampleUtil_Print( "  PowerOff       <devnum>" );
+    SampleUtil_Print( "       Sends the PowerOff action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>." );
+    SampleUtil_Print( "  SetChannel     <devnum> <channel>" );
+    SampleUtil_Print( "       Sends the SetChannel action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the channel to be changed" );
+    SampleUtil_Print( "         to <channel>." );
+    SampleUtil_Print( "  SetVolume      <devnum> <volume>" );
+    SampleUtil_Print( "       Sends the SetVolume action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the volume to be changed" );
+    SampleUtil_Print( "         to <volume>." );
+    SampleUtil_Print( "  SetColor       <devnum> <color>" );
+    SampleUtil_Print( "       Sends the SetColor action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the color to be changed" );
+    SampleUtil_Print( "         to <color>." );
+    SampleUtil_Print( "  SetTint        <devnum> <tint>" );
+    SampleUtil_Print( "       Sends the SetTint action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the tint to be changed" );
+    SampleUtil_Print( "         to <tint>." );
+    SampleUtil_Print( "  SetContrast    <devnum> <contrast>" );
+    SampleUtil_Print( "       Sends the SetContrast action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the contrast to be changed" );
+    SampleUtil_Print( "         to <contrast>." );
+    SampleUtil_Print( "  SetBrightness  <devnum> <brightness>" );
+    SampleUtil_Print( "       Sends the SetBrightness action to the Control Service of" );
+    SampleUtil_Print( "         device <devnum>, requesting the brightness to be changed" );
+    SampleUtil_Print( "         to <brightness>." );
+    SampleUtil_Print( "  CtrlAction     <devnum> <action>" );
+    SampleUtil_Print( "       Sends an action request specified by the string <action>" );
+    SampleUtil_Print( "         to the Control Service of device <devnum>.  This command" );
+    SampleUtil_Print( "         only works for actions that have no arguments." );
+    SampleUtil_Print( "         (e.g., \"CtrlAction 1 IncreaseChannel\")" );
+    SampleUtil_Print( "  PictAction     <devnum> <action>" );
+    SampleUtil_Print( "       Sends an action request specified by the string <action>" );
+    SampleUtil_Print( "         to the Picture Service of device <devnum>.  This command" );
+    SampleUtil_Print( "         only works for actions that have no arguments." );
+    SampleUtil_Print( "         (e.g., \"PictAction 1 DecreaseContrast\")" );
+    SampleUtil_Print( "  CtrlGetVar     <devnum> <varname>" );
+    SampleUtil_Print( "       Requests the value of a variable specified by the string <varname>" );
+    SampleUtil_Print( "         from the Control Service of device <devnum>." );
+    SampleUtil_Print( "         (e.g., \"CtrlGetVar 1 Volume\")" );
+    SampleUtil_Print( "  PictGetVar     <devnum> <action>" );
+    SampleUtil_Print( "       Requests the value of a variable specified by the string <varname>" );
+    SampleUtil_Print( "         from the Picture Service of device <devnum>." );
+    SampleUtil_Print( "         (e.g., \"PictGetVar 1 Tint\")" );
+    SampleUtil_Print( "  Exit" );
+    SampleUtil_Print( "       Exits the control point application." );
+}
+
+/********************************************************************************
+ * TvCtrlPointPrintCommands
+ *
+ * Description: 
+ *       Print the list of valid command line commands to the user
+ *
+ * Parameters:
+ *   None
+ *
+ ********************************************************************************/
+void
+TvCtrlPointPrintCommands()
+{
+    int i;
+    int numofcmds = sizeof( cmdloop_cmdlist ) / sizeof( cmdloop_commands );
+
+    SampleUtil_Print( "Valid Commands:" );
+    for( i = 0; i < numofcmds; i++ ) {
+        SampleUtil_Print( "  %-14s %s", cmdloop_cmdlist[i].str,
+                          cmdloop_cmdlist[i].args );
+    }
+    SampleUtil_Print( "" );
+}
+
+/********************************************************************************
+ * TvCtrlPointCommandLoop
+ *
+ * Description: 
+ *       Function that receives commands from the user at the command prompt
+ *       during the lifetime of the control point, and calls the appropriate
+ *       functions for those commands.
+ *
+ * Parameters:
+ *    None
+ *
+ ********************************************************************************/
+void *
+TvCtrlPointCommandLoop( void *args )
+{
+    char cmdline[100];
+
+    while( 1 ) {
+        SampleUtil_Print( "\n>> " );
+        fgets( cmdline, 100, stdin );
+        TvCtrlPointProcessCommand( cmdline );
+    }
+
+    return NULL;
+}
+
+int
+TvCtrlPointProcessCommand( char *cmdline )
+{
+    char cmd[100];
+    char strarg[100];
+    int arg_val_err = -99999;
+    int arg1 = arg_val_err;
+    int arg2 = arg_val_err;
+    int cmdnum = -1;
+    int numofcmds = sizeof( cmdloop_cmdlist ) / sizeof( cmdloop_commands );
+    int cmdfound = 0;
+    int i,
+      rc;
+    int invalidargs = 0;
+    int validargs;
+
+    validargs = sscanf( cmdline, "%s %d %d", cmd, &arg1, &arg2 );
+
+    for( i = 0; i < numofcmds; i++ ) {
+        if( strcasecmp( cmd, cmdloop_cmdlist[i].str ) == 0 ) {
+            cmdnum = cmdloop_cmdlist[i].cmdnum;
+            cmdfound++;
+            if( validargs != cmdloop_cmdlist[i].numargs )
+                invalidargs++;
+            break;
+        }
+    }
+
+    if( !cmdfound ) {
+        SampleUtil_Print( "Command not found; try 'Help'" );
+        return TV_SUCCESS;
+    }
+
+    if( invalidargs ) {
+        SampleUtil_Print( "Invalid arguments; try 'Help'" );
+        return TV_SUCCESS;
+    }
+
+    switch ( cmdnum ) {
+        case PRTHELP:
+            TvCtrlPointPrintShortHelp();
+            break;
+
+        case PRTFULLHELP:
+            TvCtrlPointPrintLongHelp();
+            break;
+
+        case POWON:
+            TvCtrlPointSendPowerOn( arg1 );
+            break;
+
+        case POWOFF:
+            TvCtrlPointSendPowerOff( arg1 );
+            break;
+
+        case SETCHAN:
+            TvCtrlPointSendSetChannel( arg1, arg2 );
+            break;
+
+        case SETVOL:
+            TvCtrlPointSendSetVolume( arg1, arg2 );
+            break;
+
+        case SETCOL:
+            TvCtrlPointSendSetColor( arg1, arg2 );
+            break;
+
+        case SETTINT:
+            TvCtrlPointSendSetTint( arg1, arg2 );
+            break;
+
+        case SETCONT:
+            TvCtrlPointSendSetContrast( arg1, arg2 );
+            break;
+
+        case SETBRT:
+            TvCtrlPointSendSetBrightness( arg1, arg2 );
+            break;
+
+        case CTRLACTION:
+            /*
+               re-parse commandline since second arg is string 
+             */
+            validargs = sscanf( cmdline, "%s %d %s", cmd, &arg1, strarg );
+            if( 3 == validargs )
+                TvCtrlPointSendAction( TV_SERVICE_CONTROL, arg1, strarg,
+                                       NULL, NULL, 0 );
+            else
+                invalidargs++;
+            break;
+
+        case PICTACTION:
+            /*
+               re-parse commandline since second arg is string 
+             */
+            validargs = sscanf( cmdline, "%s %d %s", cmd, &arg1, strarg );
+            if( 3 == validargs )
+                TvCtrlPointSendAction( TV_SERVICE_PICTURE, arg1, strarg,
+                                       NULL, NULL, 0 );
+            else
+                invalidargs++;
+            break;
+
+        case CTRLGETVAR:
+            /*
+               re-parse commandline since second arg is string 
+             */
+            validargs = sscanf( cmdline, "%s %d %s", cmd, &arg1, strarg );
+            if( 3 == validargs )
+                TvCtrlPointGetVar( TV_SERVICE_CONTROL, arg1, strarg );
+            else
+                invalidargs++;
+            break;
+
+        case PICTGETVAR:
+            /*
+               re-parse commandline since second arg is string 
+             */
+            validargs = sscanf( cmdline, "%s %d %s", cmd, &arg1, strarg );
+            if( 3 == validargs )
+                TvCtrlPointGetVar( TV_SERVICE_PICTURE, arg1, strarg );
+            else
+                invalidargs++;
+            break;
+
+        case PRTDEV:
+            TvCtrlPointPrintDevice( arg1 );
+            break;
+
+        case LSTDEV:
+            TvCtrlPointPrintList();
+            break;
+
+        case REFRESH:
+            TvCtrlPointRefresh();
+            break;
+
+        case EXITCMD:
+            rc = TvCtrlPointStop();
+            exit( rc );
+            break;
+
+        default:
+            SampleUtil_Print( "Command not implemented; see 'Help'" );
+            break;
+    }
+
+    if( invalidargs )
+        SampleUtil_Print( "Invalid args in command; see 'Help'" );
+
+    return TV_SUCCESS;
+}
+
+int
+main( int argc,
+      char **argv )
+{
+    int rc;
+    ithread_t cmdloop_thread;
+#ifndef WIN32
+    int sig;
+    sigset_t sigs_to_catch;
+#endif
+    int code;
+
+    rc = TvCtrlPointStart( linux_print, NULL );
+    if( rc != TV_SUCCESS ) {
+        SampleUtil_Print( "Error starting UPnP TV Control Point" );
+        return rc;
+    }
+    // start a command loop thread
+    code =
+        ithread_create( &cmdloop_thread, NULL, TvCtrlPointCommandLoop,
+                        NULL );
+
+#ifndef WIN32
+    /*
+       Catch Ctrl-C and properly shutdown 
+     */
+    sigemptyset( &sigs_to_catch );
+    sigaddset( &sigs_to_catch, SIGINT );
+    sigwait( &sigs_to_catch, &sig );
+
+    SampleUtil_Print( "Shutting down on signal %d...", sig );
+#else
+	ithread_join(cmdloop_thread, NULL);
+#endif
+
+    rc = TvCtrlPointStop();
+    return rc;
+}
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvctrlpt/upnp_tv_ctrlpt.c libupnp-1.6.6-mod/upnp/sample-orig/tvctrlpt/upnp_tv_ctrlpt.c
--- libupnp-1.6.6/upnp/sample-orig/tvctrlpt/upnp_tv_ctrlpt.c	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvctrlpt/upnp_tv_ctrlpt.c	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,1417 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+#include "upnp_tv_ctrlpt.h"
+
+/*
+   Mutex for protecting the global device list
+   in a multi-threaded, asynchronous environment.
+   All functions should lock this mutex before reading
+   or writing the device list. 
+ */
+ithread_mutex_t DeviceListMutex;
+
+UpnpClient_Handle ctrlpt_handle = -1;
+
+char TvDeviceType[] = "urn:schemas-upnp-org:device:tvdevice:1";
+char *TvServiceType[] = {
+    "urn:schemas-upnp-org:service:tvcontrol:1",
+    "urn:schemas-upnp-org:service:tvpicture:1"
+};
+char *TvServiceName[] = { "Control", "Picture" };
+
+/*
+   Global arrays for storing variable names and counts for 
+   TvControl and TvPicture services 
+ */
+char *TvVarName[TV_SERVICE_SERVCOUNT][TV_MAXVARS] = {
+    {"Power", "Channel", "Volume", ""},
+    {"Color", "Tint", "Contrast", "Brightness"}
+};
+char TvVarCount[TV_SERVICE_SERVCOUNT] =
+    { TV_CONTROL_VARCOUNT, TV_PICTURE_VARCOUNT };
+
+/*
+   Timeout to request during subscriptions 
+ */
+int default_timeout = 1801;
+
+/*
+   The first node in the global device list, or NULL if empty 
+ */
+struct TvDeviceNode *GlobalDeviceList = NULL;
+
+/********************************************************************************
+ * TvCtrlPointDeleteNode
+ *
+ * Description: 
+ *       Delete a device node from the global device list.  Note that this
+ *       function is NOT thread safe, and should be called from another
+ *       function that has already locked the global device list.
+ *
+ * Parameters:
+ *   node -- The device node
+ *
+ ********************************************************************************/
+int
+TvCtrlPointDeleteNode( struct TvDeviceNode *node )
+{
+    int rc,
+      service,
+      var;
+
+    if( NULL == node ) {
+        SampleUtil_Print( "ERROR: TvCtrlPointDeleteNode: Node is empty" );
+        return TV_ERROR;
+    }
+
+    for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+        /*
+           If we have a valid control SID, then unsubscribe 
+         */
+        if( strcmp( node->device.TvService[service].SID, "" ) != 0 ) {
+            rc = UpnpUnSubscribe( ctrlpt_handle,
+                                  node->device.TvService[service].SID );
+            if( UPNP_E_SUCCESS == rc ) {
+                SampleUtil_Print
+                    ( "Unsubscribed from Tv %s EventURL with SID=%s",
+                      TvServiceName[service],
+                      node->device.TvService[service].SID );
+            } else {
+                SampleUtil_Print
+                    ( "Error unsubscribing to Tv %s EventURL -- %d",
+                      TvServiceName[service], rc );
+            }
+        }
+
+        for( var = 0; var < TvVarCount[service]; var++ ) {
+            if( node->device.TvService[service].VariableStrVal[var] ) {
+                free( node->device.TvService[service].
+                      VariableStrVal[var] );
+            }
+        }
+    }
+
+    //Notify New Device Added
+    SampleUtil_StateUpdate( NULL, NULL, node->device.UDN, DEVICE_REMOVED );
+    free( node );
+    node = NULL;
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointRemoveDevice
+ *
+ * Description: 
+ *       Remove a device from the global device list.
+ *
+ * Parameters:
+ *   UDN -- The Unique Device Name for the device to remove
+ *
+ ********************************************************************************/
+int
+TvCtrlPointRemoveDevice( char *UDN )
+{
+    struct TvDeviceNode *curdevnode,
+     *prevdevnode;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    curdevnode = GlobalDeviceList;
+    if( !curdevnode ) {
+        SampleUtil_Print
+            ( "WARNING: TvCtrlPointRemoveDevice: Device list empty" );
+    } else {
+        if( 0 == strcmp( curdevnode->device.UDN, UDN ) ) {
+            GlobalDeviceList = curdevnode->next;
+            TvCtrlPointDeleteNode( curdevnode );
+        } else {
+            prevdevnode = curdevnode;
+            curdevnode = curdevnode->next;
+
+            while( curdevnode ) {
+                if( strcmp( curdevnode->device.UDN, UDN ) == 0 ) {
+                    prevdevnode->next = curdevnode->next;
+                    TvCtrlPointDeleteNode( curdevnode );
+                    break;
+                }
+
+                prevdevnode = curdevnode;
+                curdevnode = curdevnode->next;
+            }
+        }
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointRemoveAll
+ *
+ * Description: 
+ *       Remove all devices from the global device list.
+ *
+ * Parameters:
+ *   None
+ *
+ ********************************************************************************/
+int
+TvCtrlPointRemoveAll( void )
+{
+    struct TvDeviceNode *curdevnode,
+     *next;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    curdevnode = GlobalDeviceList;
+    GlobalDeviceList = NULL;
+
+    while( curdevnode ) {
+        next = curdevnode->next;
+        TvCtrlPointDeleteNode( curdevnode );
+        curdevnode = next;
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointRefresh
+ *
+ * Description: 
+ *       Clear the current global device list and issue new search
+ *	 requests to build it up again from scratch.
+ *
+ * Parameters:
+ *   None
+ *
+ ********************************************************************************/
+int
+TvCtrlPointRefresh( void )
+{
+    int rc;
+
+    TvCtrlPointRemoveAll();
+
+    /*
+       Search for all devices of type tvdevice version 1, 
+       waiting for up to 5 seconds for the response 
+     */
+    rc = UpnpSearchAsync( ctrlpt_handle, 5, TvDeviceType, NULL );
+    if( UPNP_E_SUCCESS != rc ) {
+        SampleUtil_Print( "Error sending search request%d", rc );
+        return TV_ERROR;
+    }
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointGetVar
+ *
+ * Description: 
+ *       Send a GetVar request to the specified service of a device.
+ *
+ * Parameters:
+ *   service -- The service
+ *   devnum -- The number of the device (order in the list,
+ *             starting with 1)
+ *   varname -- The name of the variable to request.
+ *
+ ********************************************************************************/
+int
+TvCtrlPointGetVar( int service,
+                   int devnum,
+                   char *varname )
+{
+    struct TvDeviceNode *devnode;
+    int rc;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    rc = TvCtrlPointGetDevice( devnum, &devnode );
+
+    if( TV_SUCCESS == rc ) {
+        rc = UpnpGetServiceVarStatusAsync( ctrlpt_handle,
+                                           devnode->device.
+                                           TvService[service].ControlURL,
+                                           varname,
+                                           TvCtrlPointCallbackEventHandler,
+                                           NULL );
+        if( rc != UPNP_E_SUCCESS ) {
+            SampleUtil_Print
+                ( "Error in UpnpGetServiceVarStatusAsync -- %d", rc );
+            rc = TV_ERROR;
+        }
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    return rc;
+}
+
+int
+TvCtrlPointGetPower( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_CONTROL, devnum, "Power" );
+}
+
+int
+TvCtrlPointGetChannel( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_CONTROL, devnum, "Channel" );
+}
+
+int
+TvCtrlPointGetVolume( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_CONTROL, devnum, "Volume" );
+}
+
+int
+TvCtrlPointGetColor( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_PICTURE, devnum, "Color" );
+}
+
+int
+TvCtrlPointGetTint( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_PICTURE, devnum, "Tint" );
+}
+
+int
+TvCtrlPointGetContrast( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_PICTURE, devnum, "Contrast" );
+}
+
+int
+TvCtrlPointGetBrightness( int devnum )
+{
+    return TvCtrlPointGetVar( TV_SERVICE_PICTURE, devnum, "Brightness" );
+}
+
+/********************************************************************************
+ * TvCtrlPointSendAction
+ *
+ * Description: 
+ *       Send an Action request to the specified service of a device.
+ *
+ * Parameters:
+ *   service -- The service
+ *   devnum -- The number of the device (order in the list,
+ *             starting with 1)
+ *   actionname -- The name of the action.
+ *   param_name -- An array of parameter names
+ *   param_val -- The corresponding parameter values
+ *   param_count -- The number of parameters
+ *
+ ********************************************************************************/
+int
+TvCtrlPointSendAction( int service,
+                       int devnum,
+                       char *actionname,
+                       char **param_name,
+                       char **param_val,
+                       int param_count )
+{
+    struct TvDeviceNode *devnode;
+    IXML_Document *actionNode = NULL;
+    int rc = TV_SUCCESS;
+    int param;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    rc = TvCtrlPointGetDevice( devnum, &devnode );
+    if( TV_SUCCESS == rc ) {
+        if( 0 == param_count ) {
+            actionNode =
+                UpnpMakeAction( actionname, TvServiceType[service], 0,
+                                NULL );
+        } else {
+            for( param = 0; param < param_count; param++ ) {
+                if( UpnpAddToAction
+                    ( &actionNode, actionname, TvServiceType[service],
+                      param_name[param],
+                      param_val[param] ) != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "ERROR: TvCtrlPointSendAction: Trying to add action param" );
+                    //return -1; // TBD - BAD! leaves mutex locked
+                }
+            }
+        }
+
+        rc = UpnpSendActionAsync( ctrlpt_handle,
+                                  devnode->device.TvService[service].
+                                  ControlURL, TvServiceType[service],
+                                  NULL, actionNode,
+                                  TvCtrlPointCallbackEventHandler, NULL );
+
+        if( rc != UPNP_E_SUCCESS ) {
+            SampleUtil_Print( "Error in UpnpSendActionAsync -- %d", rc );
+            rc = TV_ERROR;
+        }
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    if( actionNode )
+        ixmlDocument_free( actionNode );
+
+    return rc;
+}
+
+/********************************************************************************
+ * TvCtrlPointSendActionNumericArg
+ *
+ * Description:Send an action with one argument to a device in the global device list.
+ *
+ * Parameters:
+ *   devnum -- The number of the device (order in the list, starting with 1)
+ *   service -- TV_SERVICE_CONTROL or TV_SERVICE_PICTURE
+ *   actionName -- The device action, i.e., "SetChannel"
+ *   paramName -- The name of the parameter that is being passed
+ *   paramValue -- Actual value of the parameter being passed
+ *
+ ********************************************************************************/
+int
+TvCtrlPointSendActionNumericArg( int devnum,
+                                 int service,
+                                 char *actionName,
+                                 char *paramName,
+                                 int paramValue )
+{
+    char param_val_a[50];
+    char *param_val = param_val_a;
+
+    sprintf( param_val_a, "%d", paramValue );
+
+    return TvCtrlPointSendAction( service, devnum, actionName, &paramName,
+                                  &param_val, 1 );
+}
+
+int
+TvCtrlPointSendPowerOn( int devnum )
+{
+    return TvCtrlPointSendAction( TV_SERVICE_CONTROL, devnum, "PowerOn",
+                                  NULL, NULL, 0 );
+}
+
+int
+TvCtrlPointSendPowerOff( int devnum )
+{
+    return TvCtrlPointSendAction( TV_SERVICE_CONTROL, devnum, "PowerOff",
+                                  NULL, NULL, 0 );
+}
+
+int
+TvCtrlPointSendSetChannel( int devnum,
+                           int channel )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_CONTROL,
+                                            "SetChannel", "Channel",
+                                            channel );
+}
+
+int
+TvCtrlPointSendSetVolume( int devnum,
+                          int volume )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_CONTROL,
+                                            "SetVolume", "Volume",
+                                            volume );
+}
+
+int
+TvCtrlPointSendSetColor( int devnum,
+                         int color )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_PICTURE,
+                                            "SetColor", "Color", color );
+}
+
+int
+TvCtrlPointSendSetTint( int devnum,
+                        int tint )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_PICTURE,
+                                            "SetTint", "Tint", tint );
+}
+
+int
+TvCtrlPointSendSetContrast( int devnum,
+                            int contrast )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_PICTURE,
+                                            "SetContrast", "Contrast",
+                                            contrast );
+}
+
+int
+TvCtrlPointSendSetBrightness( int devnum,
+                              int brightness )
+{
+    return TvCtrlPointSendActionNumericArg( devnum, TV_SERVICE_PICTURE,
+                                            "SetBrightness", "Brightness",
+                                            brightness );
+}
+
+/********************************************************************************
+ * TvCtrlPointGetDevice
+ *
+ * Description: 
+ *       Given a list number, returns the pointer to the device
+ *       node at that position in the global device list.  Note
+ *       that this function is not thread safe.  It must be called 
+ *       from a function that has locked the global device list.
+ *
+ * Parameters:
+ *   devnum -- The number of the device (order in the list,
+ *             starting with 1)
+ *   devnode -- The output device node pointer
+ *
+ ********************************************************************************/
+int
+TvCtrlPointGetDevice( int devnum,
+                      struct TvDeviceNode **devnode )
+{
+    int count = devnum;
+    struct TvDeviceNode *tmpdevnode = NULL;
+
+    if( count )
+        tmpdevnode = GlobalDeviceList;
+
+    while( --count && tmpdevnode ) {
+        tmpdevnode = tmpdevnode->next;
+    }
+
+    if( !tmpdevnode ) {
+        SampleUtil_Print( "Error finding TvDevice number -- %d", devnum );
+        return TV_ERROR;
+    }
+
+    *devnode = tmpdevnode;
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointPrintList
+ *
+ * Description: 
+ *       Print the universal device names for each device in the global device list
+ *
+ * Parameters:
+ *   None
+ *
+ ********************************************************************************/
+int
+TvCtrlPointPrintList()
+{
+    struct TvDeviceNode *tmpdevnode;
+    int i = 0;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    SampleUtil_Print( "TvCtrlPointPrintList:" );
+    tmpdevnode = GlobalDeviceList;
+    while( tmpdevnode ) {
+        SampleUtil_Print( " %3d -- %s", ++i, tmpdevnode->device.UDN );
+        tmpdevnode = tmpdevnode->next;
+    }
+    SampleUtil_Print( "" );
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointPrintDevice
+ *
+ * Description: 
+ *       Print the identifiers and state table for a device from
+ *       the global device list.
+ *
+ * Parameters:
+ *   devnum -- The number of the device (order in the list,
+ *             starting with 1)
+ *
+ ********************************************************************************/
+int
+TvCtrlPointPrintDevice( int devnum )
+{
+    struct TvDeviceNode *tmpdevnode;
+    int i = 0,
+      service,
+      var;
+    char spacer[15];
+
+    if( devnum <= 0 ) {
+        SampleUtil_Print
+            ( "Error in TvCtrlPointPrintDevice: invalid devnum = %d",
+              devnum );
+        return TV_ERROR;
+    }
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    SampleUtil_Print( "TvCtrlPointPrintDevice:" );
+    tmpdevnode = GlobalDeviceList;
+    while( tmpdevnode ) {
+        i++;
+        if( i == devnum )
+            break;
+        tmpdevnode = tmpdevnode->next;
+    }
+
+    if( !tmpdevnode ) {
+        SampleUtil_Print
+            ( "Error in TvCtrlPointPrintDevice: invalid devnum = %d  --  actual device count = %d",
+              devnum, i );
+    } else {
+        SampleUtil_Print( "  TvDevice -- %d", devnum );
+        SampleUtil_Print( "    |                  " );
+        SampleUtil_Print( "    +- UDN        = %s",
+                          tmpdevnode->device.UDN );
+        SampleUtil_Print( "    +- DescDocURL     = %s",
+                          tmpdevnode->device.DescDocURL );
+        SampleUtil_Print( "    +- FriendlyName   = %s",
+                          tmpdevnode->device.FriendlyName );
+        SampleUtil_Print( "    +- PresURL        = %s",
+                          tmpdevnode->device.PresURL );
+        SampleUtil_Print( "    +- Adver. TimeOut = %d",
+                          tmpdevnode->device.AdvrTimeOut );
+
+        for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+            if( service < TV_SERVICE_SERVCOUNT - 1 )
+                sprintf( spacer, "    |    " );
+            else
+                sprintf( spacer, "         " );
+            SampleUtil_Print( "    |                  " );
+            SampleUtil_Print( "    +- Tv %s Service",
+                              TvServiceName[service] );
+            SampleUtil_Print( "%s+- ServiceId       = %s", spacer,
+                              tmpdevnode->device.TvService[service].
+                              ServiceId );
+            SampleUtil_Print( "%s+- ServiceType     = %s", spacer,
+                              tmpdevnode->device.TvService[service].
+                              ServiceType );
+            SampleUtil_Print( "%s+- EventURL        = %s", spacer,
+                              tmpdevnode->device.TvService[service].
+                              EventURL );
+            SampleUtil_Print( "%s+- ControlURL      = %s", spacer,
+                              tmpdevnode->device.TvService[service].
+                              ControlURL );
+            SampleUtil_Print( "%s+- SID             = %s", spacer,
+                              tmpdevnode->device.TvService[service].SID );
+            SampleUtil_Print( "%s+- ServiceStateTable", spacer );
+
+            for( var = 0; var < TvVarCount[service]; var++ ) {
+                SampleUtil_Print( "%s     +- %-10s = %s", spacer,
+                                  TvVarName[service][var],
+                                  tmpdevnode->device.TvService[service].
+                                  VariableStrVal[var] );
+            }
+        }
+    }
+
+    SampleUtil_Print( "" );
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    return TV_SUCCESS;
+}
+
+/********************************************************************************
+ * TvCtrlPointAddDevice
+ *
+ * Description: 
+ *       If the device is not already included in the global device list,
+ *       add it.  Otherwise, update its advertisement expiration timeout.
+ *
+ * Parameters:
+ *   DescDoc -- The description document for the device
+ *   location -- The location of the description document URL
+ *   expires -- The expiration time for this advertisement
+ *
+ ********************************************************************************/
+void
+TvCtrlPointAddDevice( IXML_Document * DescDoc,
+                      char *location,
+                      int expires )
+{
+    char *deviceType = NULL;
+    char *friendlyName = NULL;
+    char presURL[200];
+    char *baseURL = NULL;
+    char *relURL = NULL;
+    char *UDN = NULL;
+    char *serviceId[TV_SERVICE_SERVCOUNT] = { NULL, NULL };
+    char *eventURL[TV_SERVICE_SERVCOUNT] = { NULL, NULL };
+    char *controlURL[TV_SERVICE_SERVCOUNT] = { NULL, NULL };
+    Upnp_SID eventSID[TV_SERVICE_SERVCOUNT];
+    int TimeOut[TV_SERVICE_SERVCOUNT] =
+        { default_timeout, default_timeout };
+    struct TvDeviceNode *deviceNode;
+    struct TvDeviceNode *tmpdevnode;
+    int ret = 1;
+    int found = 0;
+    int service,
+      var;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    /*
+       Read key elements from description document 
+     */
+    UDN = SampleUtil_GetFirstDocumentItem( DescDoc, "UDN" );
+    deviceType = SampleUtil_GetFirstDocumentItem( DescDoc, "deviceType" );
+    friendlyName =
+        SampleUtil_GetFirstDocumentItem( DescDoc, "friendlyName" );
+    baseURL = SampleUtil_GetFirstDocumentItem( DescDoc, "URLBase" );
+    relURL = SampleUtil_GetFirstDocumentItem( DescDoc, "presentationURL" );
+
+    ret =
+        UpnpResolveURL( ( baseURL ? baseURL : location ), relURL,
+                        presURL );
+
+    if( UPNP_E_SUCCESS != ret )
+        SampleUtil_Print( "Error generating presURL from %s + %s", baseURL,
+                          relURL );
+
+    if( strcmp( deviceType, TvDeviceType ) == 0 ) {
+        SampleUtil_Print( "Found Tv device" );
+
+        // Check if this device is already in the list
+        tmpdevnode = GlobalDeviceList;
+        while( tmpdevnode ) {
+            if( strcmp( tmpdevnode->device.UDN, UDN ) == 0 ) {
+                found = 1;
+                break;
+            }
+            tmpdevnode = tmpdevnode->next;
+        }
+
+        if( found ) {
+            // The device is already there, so just update 
+            // the advertisement timeout field
+            tmpdevnode->device.AdvrTimeOut = expires;
+        } else {
+            for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+                if( SampleUtil_FindAndParseService
+                    ( DescDoc, location, TvServiceType[service],
+                      &serviceId[service], &eventURL[service],
+                      &controlURL[service] ) ) {
+                    SampleUtil_Print( "Subscribing to EventURL %s...",
+                                      eventURL[service] );
+
+                    ret =
+                        UpnpSubscribe( ctrlpt_handle, eventURL[service],
+                                       &TimeOut[service],
+                                       eventSID[service] );
+
+                    if( ret == UPNP_E_SUCCESS ) {
+                        SampleUtil_Print
+                            ( "Subscribed to EventURL with SID=%s",
+                              eventSID[service] );
+                    } else {
+                        SampleUtil_Print
+                            ( "Error Subscribing to EventURL -- %d", ret );
+                        strcpy( eventSID[service], "" );
+                    }
+                } else {
+                    SampleUtil_Print( "Error: Could not find Service: %s",
+                                      TvServiceType[service] );
+                }
+            }
+
+            /*
+               Create a new device node 
+             */
+            deviceNode =
+                ( struct TvDeviceNode * )
+                malloc( sizeof( struct TvDeviceNode ) );
+            strcpy( deviceNode->device.UDN, UDN );
+            strcpy( deviceNode->device.DescDocURL, location );
+            strcpy( deviceNode->device.FriendlyName, friendlyName );
+            strcpy( deviceNode->device.PresURL, presURL );
+            deviceNode->device.AdvrTimeOut = expires;
+
+            for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+                strcpy( deviceNode->device.TvService[service].ServiceId,
+                        serviceId[service] );
+                strcpy( deviceNode->device.TvService[service].ServiceType,
+                        TvServiceType[service] );
+                strcpy( deviceNode->device.TvService[service].ControlURL,
+                        controlURL[service] );
+                strcpy( deviceNode->device.TvService[service].EventURL,
+                        eventURL[service] );
+                strcpy( deviceNode->device.TvService[service].SID,
+                        eventSID[service] );
+
+                for( var = 0; var < TvVarCount[service]; var++ ) {
+                    deviceNode->device.TvService[service].
+                        VariableStrVal[var] =
+                        ( char * )malloc( TV_MAX_VAL_LEN );
+                    strcpy( deviceNode->device.TvService[service].
+                            VariableStrVal[var], "" );
+                }
+            }
+
+            deviceNode->next = NULL;
+
+            // Insert the new device node in the list
+            if( ( tmpdevnode = GlobalDeviceList ) ) {
+
+                while( tmpdevnode ) {
+                    if( tmpdevnode->next ) {
+                        tmpdevnode = tmpdevnode->next;
+                    } else {
+                        tmpdevnode->next = deviceNode;
+                        break;
+                    }
+                }
+            } else {
+                GlobalDeviceList = deviceNode;
+            }
+
+            //Notify New Device Added
+            SampleUtil_StateUpdate( NULL, NULL, deviceNode->device.UDN,
+                                    DEVICE_ADDED );
+        }
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+
+    if( deviceType )
+        free( deviceType );
+    if( friendlyName )
+        free( friendlyName );
+    if( UDN )
+        free( UDN );
+    if( baseURL )
+        free( baseURL );
+    if( relURL )
+        free( relURL );
+
+    for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+        if( serviceId[service] )
+            free( serviceId[service] );
+        if( controlURL[service] )
+            free( controlURL[service] );
+        if( eventURL[service] )
+            free( eventURL[service] );
+    }
+}
+
+/********************************************************************************
+ * TvStateUpdate
+ *
+ * Description: 
+ *       Update a Tv state table.  Called when an event is
+ *       received.  Note: this function is NOT thread save.  It must be
+ *       called from another function that has locked the global device list.
+ *
+ * Parameters:
+ *   UDN     -- The UDN of the parent device.
+ *   Service -- The service state table to update
+ *   ChangedVariables -- DOM document representing the XML received
+ *                       with the event
+ *   State -- pointer to the state table for the Tv  service
+ *            to update
+ *
+ ********************************************************************************/
+void
+TvStateUpdate( char *UDN,
+               int Service,
+               IXML_Document * ChangedVariables,
+               char **State )
+{
+    IXML_NodeList *properties,
+     *variables;
+    IXML_Element *property,
+     *variable;
+    int length,
+      length1;
+    int i,
+      j;
+    char *tmpstate = NULL;
+
+    SampleUtil_Print( "Tv State Update (service %d): ", Service );
+
+    /*
+       Find all of the e:property tags in the document 
+     */
+    properties =
+        ixmlDocument_getElementsByTagName( ChangedVariables,
+                                           "e:property" );
+    if( NULL != properties ) {
+        length = ixmlNodeList_length( properties );
+        for( i = 0; i < length; i++ ) { /* Loop through each property change found */
+            property =
+                ( IXML_Element * ) ixmlNodeList_item( properties, i );
+
+            /*
+               For each variable name in the state table, check if this
+               is a corresponding property change 
+             */
+            for( j = 0; j < TvVarCount[Service]; j++ ) {
+                variables =
+                    ixmlElement_getElementsByTagName( property,
+                                                      TvVarName[Service]
+                                                      [j] );
+
+                /*
+                   If a match is found, extract the value, and update the state table 
+                 */
+                if( variables ) {
+                    length1 = ixmlNodeList_length( variables );
+                    if( length1 ) {
+                        variable =
+                            ( IXML_Element * )
+                            ixmlNodeList_item( variables, 0 );
+                        tmpstate = SampleUtil_GetElementValue( variable );
+
+                        if( tmpstate ) {
+                            strcpy( State[j], tmpstate );
+                            SampleUtil_Print
+                                ( " Variable Name: %s New Value:'%s'",
+                                  TvVarName[Service][j], State[j] );
+                        }
+
+                        if( tmpstate )
+                            free( tmpstate );
+                        tmpstate = NULL;
+                    }
+
+                    ixmlNodeList_free( variables );
+                    variables = NULL;
+                }
+            }
+
+        }
+        ixmlNodeList_free( properties );
+    }
+}
+
+/********************************************************************************
+ * TvCtrlPointHandleEvent
+ *
+ * Description: 
+ *       Handle a UPnP event that was received.  Process the event and update
+ *       the appropriate service state table.
+ *
+ * Parameters:
+ *   sid -- The subscription id for the event
+ *   eventkey -- The eventkey number for the event
+ *   changes -- The DOM document representing the changes
+ *
+ ********************************************************************************/
+void
+TvCtrlPointHandleEvent( Upnp_SID sid,
+                        int evntkey,
+                        IXML_Document * changes )
+{
+    struct TvDeviceNode *tmpdevnode;
+    int service;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    tmpdevnode = GlobalDeviceList;
+    while( tmpdevnode ) {
+        for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+            if( strcmp( tmpdevnode->device.TvService[service].SID, sid ) ==
+                0 ) {
+                SampleUtil_Print( "Received Tv %s Event: %d for SID %s",
+                                  TvServiceName[service], evntkey, sid );
+
+                TvStateUpdate( tmpdevnode->device.UDN, service, changes,
+                               ( char ** )&tmpdevnode->device.
+                               TvService[service].VariableStrVal );
+                break;
+            }
+        }
+        tmpdevnode = tmpdevnode->next;
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+}
+
+/********************************************************************************
+ * TvCtrlPointHandleSubscribeUpdate
+ *
+ * Description: 
+ *       Handle a UPnP subscription update that was received.  Find the 
+ *       service the update belongs to, and update its subscription
+ *       timeout.
+ *
+ * Parameters:
+ *   eventURL -- The event URL for the subscription
+ *   sid -- The subscription id for the subscription
+ *   timeout  -- The new timeout for the subscription
+ *
+ ********************************************************************************/
+void
+TvCtrlPointHandleSubscribeUpdate( char *eventURL,
+                                  Upnp_SID sid,
+                                  int timeout )
+{
+    struct TvDeviceNode *tmpdevnode;
+    int service;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    tmpdevnode = GlobalDeviceList;
+    while( tmpdevnode ) {
+        for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+
+            if( strcmp
+                ( tmpdevnode->device.TvService[service].EventURL,
+                  eventURL ) == 0 ) {
+                SampleUtil_Print
+                    ( "Received Tv %s Event Renewal for eventURL %s",
+                      TvServiceName[service], eventURL );
+                strcpy( tmpdevnode->device.TvService[service].SID, sid );
+                break;
+            }
+        }
+
+        tmpdevnode = tmpdevnode->next;
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+}
+
+void
+TvCtrlPointHandleGetVar( char *controlURL,
+                         char *varName,
+                         DOMString varValue )
+{
+
+    struct TvDeviceNode *tmpdevnode;
+    int service;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    tmpdevnode = GlobalDeviceList;
+    while( tmpdevnode ) {
+        for( service = 0; service < TV_SERVICE_SERVCOUNT; service++ ) {
+            if( strcmp
+                ( tmpdevnode->device.TvService[service].ControlURL,
+                  controlURL ) == 0 ) {
+                SampleUtil_StateUpdate( varName, varValue,
+                                        tmpdevnode->device.UDN,
+                                        GET_VAR_COMPLETE );
+                break;
+            }
+        }
+        tmpdevnode = tmpdevnode->next;
+    }
+
+    ithread_mutex_unlock( &DeviceListMutex );
+}
+
+/********************************************************************************
+ * TvCtrlPointCallbackEventHandler
+ *
+ * Description: 
+ *       The callback handler registered with the SDK while registering
+ *       the control point.  Detects the type of callback, and passes the 
+ *       request on to the appropriate function.
+ *
+ * Parameters:
+ *   EventType -- The type of callback event
+ *   Event -- Data structure containing event data
+ *   Cookie -- Optional data specified during callback registration
+ *
+ ********************************************************************************/
+int
+TvCtrlPointCallbackEventHandler( Upnp_EventType EventType,
+                                 void *Event,
+                                 void *Cookie )
+{
+    SampleUtil_PrintEvent( EventType, Event );
+
+    switch ( EventType ) {
+            /*
+               SSDP Stuff 
+             */
+        case UPNP_DISCOVERY_ADVERTISEMENT_ALIVE:
+        case UPNP_DISCOVERY_SEARCH_RESULT:
+            {
+                struct Upnp_Discovery *d_event =
+                    ( struct Upnp_Discovery * )Event;
+                IXML_Document *DescDoc = NULL;
+                int ret;
+
+                if( d_event->ErrCode != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print( "Error in Discovery Callback -- %d",
+                                      d_event->ErrCode );
+                }
+
+                if( ( ret =
+                      UpnpDownloadXmlDoc( d_event->Location,
+                                          &DescDoc ) ) !=
+                    UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "Error obtaining device description from %s -- error = %d",
+                          d_event->Location, ret );
+                } else {
+                    TvCtrlPointAddDevice( DescDoc, d_event->Location,
+                                          d_event->Expires );
+                }
+
+                if( DescDoc )
+                    ixmlDocument_free( DescDoc );
+
+                TvCtrlPointPrintList();
+                break;
+            }
+
+        case UPNP_DISCOVERY_SEARCH_TIMEOUT:
+            /*
+               Nothing to do here... 
+             */
+            break;
+
+        case UPNP_DISCOVERY_ADVERTISEMENT_BYEBYE:
+            {
+                struct Upnp_Discovery *d_event =
+                    ( struct Upnp_Discovery * )Event;
+
+                if( d_event->ErrCode != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "Error in Discovery ByeBye Callback -- %d",
+                          d_event->ErrCode );
+                }
+
+                SampleUtil_Print( "Received ByeBye for Device: %s",
+                                  d_event->DeviceId );
+                TvCtrlPointRemoveDevice( d_event->DeviceId );
+
+                SampleUtil_Print( "After byebye:" );
+                TvCtrlPointPrintList();
+
+                break;
+            }
+
+            /*
+               SOAP Stuff 
+             */
+        case UPNP_CONTROL_ACTION_COMPLETE:
+            {
+                struct Upnp_Action_Complete *a_event =
+                    ( struct Upnp_Action_Complete * )Event;
+
+                if( a_event->ErrCode != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "Error in  Action Complete Callback -- %d",
+                          a_event->ErrCode );
+                }
+
+                /*
+                   No need for any processing here, just print out results.  Service state
+                   table updates are handled by events. 
+                 */
+
+                break;
+            }
+
+        case UPNP_CONTROL_GET_VAR_COMPLETE:
+            {
+                struct Upnp_State_Var_Complete *sv_event =
+                    ( struct Upnp_State_Var_Complete * )Event;
+
+                if( sv_event->ErrCode != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "Error in Get Var Complete Callback -- %d",
+                          sv_event->ErrCode );
+                } else {
+                    TvCtrlPointHandleGetVar( sv_event->CtrlUrl,
+                                             sv_event->StateVarName,
+                                             sv_event->CurrentVal );
+                }
+
+                break;
+            }
+
+            /*
+               GENA Stuff 
+             */
+        case UPNP_EVENT_RECEIVED:
+            {
+                struct Upnp_Event *e_event = ( struct Upnp_Event * )Event;
+
+                TvCtrlPointHandleEvent( e_event->Sid, e_event->EventKey,
+                                        e_event->ChangedVariables );
+                break;
+            }
+
+        case UPNP_EVENT_SUBSCRIBE_COMPLETE:
+        case UPNP_EVENT_UNSUBSCRIBE_COMPLETE:
+        case UPNP_EVENT_RENEWAL_COMPLETE:
+            {
+                struct Upnp_Event_Subscribe *es_event =
+                    ( struct Upnp_Event_Subscribe * )Event;
+
+                if( es_event->ErrCode != UPNP_E_SUCCESS ) {
+                    SampleUtil_Print
+                        ( "Error in Event Subscribe Callback -- %d",
+                          es_event->ErrCode );
+                } else {
+                    TvCtrlPointHandleSubscribeUpdate( es_event->
+                                                      PublisherUrl,
+                                                      es_event->Sid,
+                                                      es_event->TimeOut );
+                }
+
+                break;
+            }
+
+        case UPNP_EVENT_AUTORENEWAL_FAILED:
+        case UPNP_EVENT_SUBSCRIPTION_EXPIRED:
+            {
+                int TimeOut = default_timeout;
+                Upnp_SID newSID;
+                int ret;
+
+                struct Upnp_Event_Subscribe *es_event =
+                    ( struct Upnp_Event_Subscribe * )Event;
+
+                ret =
+                    UpnpSubscribe( ctrlpt_handle, es_event->PublisherUrl,
+                                   &TimeOut, newSID );
+
+                if( ret == UPNP_E_SUCCESS ) {
+                    SampleUtil_Print( "Subscribed to EventURL with SID=%s",
+                                      newSID );
+                    TvCtrlPointHandleSubscribeUpdate( es_event->
+                                                      PublisherUrl, newSID,
+                                                      TimeOut );
+                } else {
+                    SampleUtil_Print
+                        ( "Error Subscribing to EventURL -- %d", ret );
+                }
+                break;
+            }
+
+            /*
+               ignore these cases, since this is not a device 
+             */
+        case UPNP_EVENT_SUBSCRIPTION_REQUEST:
+        case UPNP_CONTROL_GET_VAR_REQUEST:
+        case UPNP_CONTROL_ACTION_REQUEST:
+            break;
+    }
+
+    return 0;
+}
+
+/********************************************************************************
+ * TvCtrlPointVerifyTimeouts
+ *
+ * Description: 
+ *       Checks the advertisement  each device
+ *        in the global device list.  If an advertisement expires,
+ *       the device is removed from the list.  If an advertisement is about to
+ *       expire, a search request is sent for that device.  
+ *
+ * Parameters:
+ *    incr -- The increment to subtract from the timeouts each time the
+ *            function is called.
+ *
+ ********************************************************************************/
+void
+TvCtrlPointVerifyTimeouts( int incr )
+{
+    struct TvDeviceNode *prevdevnode,
+     *curdevnode;
+    int ret;
+
+    ithread_mutex_lock( &DeviceListMutex );
+
+    prevdevnode = NULL;
+    curdevnode = GlobalDeviceList;
+
+    while( curdevnode ) {
+        curdevnode->device.AdvrTimeOut -= incr;
+        //SampleUtil_Print("Advertisement Timeout: %d\n", curdevnode->device.AdvrTimeOut);
+
+        if( curdevnode->device.AdvrTimeOut <= 0 ) {
+            /*
+               This advertisement has expired, so we should remove the device
+               from the list 
+             */
+
+            if( GlobalDeviceList == curdevnode )
+                GlobalDeviceList = curdevnode->next;
+            else
+                prevdevnode->next = curdevnode->next;
+            TvCtrlPointDeleteNode( curdevnode );
+            if( prevdevnode )
+                curdevnode = prevdevnode->next;
+            else
+                curdevnode = GlobalDeviceList;
+        } else {
+
+            if( curdevnode->device.AdvrTimeOut < 2 * incr ) {
+                /*
+                   This advertisement is about to expire, so send
+                   out a search request for this device UDN to 
+                   try to renew 
+                 */
+                ret = UpnpSearchAsync( ctrlpt_handle, incr,
+                                       curdevnode->device.UDN, NULL );
+                if( ret != UPNP_E_SUCCESS )
+                    SampleUtil_Print
+                        ( "Error sending search request for Device UDN: %s -- err = %d",
+                          curdevnode->device.UDN, ret );
+            }
+
+            prevdevnode = curdevnode;
+            curdevnode = curdevnode->next;
+        }
+
+    }
+    ithread_mutex_unlock( &DeviceListMutex );
+
+}
+
+/********************************************************************************
+ * TvCtrlPointTimerLoop
+ *
+ * Description: 
+ *       Function that runs in its own thread and monitors advertisement
+ *       and subscription timeouts for devices in the global device list.
+ *
+ * Parameters:
+ *    None
+ *
+ ********************************************************************************/
+void *
+TvCtrlPointTimerLoop( void *args )
+{
+    int incr = 30;              // how often to verify the timeouts, in seconds
+
+    while( 1 ) {
+        isleep( incr );
+        TvCtrlPointVerifyTimeouts( incr );
+    }
+
+    return NULL;
+}
+
+/********************************************************************************
+ * TvCtrlPointStart
+ *
+ * Description: 
+ *		Call this function to initialize the UPnP library and start the TV Control
+ *		Point.  This function creates a timer thread and provides a callback
+ *		handler to process any UPnP events that are received.
+ *
+ * Parameters:
+ *		None
+ *
+ * Returns:
+ *		TV_SUCCESS if everything went well, else TV_ERROR
+ *
+ ********************************************************************************/
+int
+TvCtrlPointStart( print_string printFunctionPtr,
+                  state_update updateFunctionPtr )
+{
+    ithread_t timer_thread;
+    int rc;
+    unsigned short port = 0;
+    char *ip_address = NULL;
+
+    SampleUtil_Initialize( printFunctionPtr );
+    SampleUtil_RegisterUpdateFunction( updateFunctionPtr );
+
+    ithread_mutex_init( &DeviceListMutex, 0 );
+
+    SampleUtil_Print(
+        "Initializing UPnP Sdk with\n"
+        "\tipaddress = %s port = %u\n",
+        ip_address, port );
+
+    rc = UpnpInit( ip_address, port );
+    if( UPNP_E_SUCCESS != rc ) {
+        SampleUtil_Print( "WinCEStart: UpnpInit() Error: %d", rc );
+        UpnpFinish();
+        return TV_ERROR;
+    }
+
+    if( NULL == ip_address ) {
+        ip_address = UpnpGetServerIpAddress();
+    }
+    if( 0 == port ) {
+        port = UpnpGetServerPort();
+    }
+
+    SampleUtil_Print(
+        "UPnP Initialized\n"
+	"\tipaddress= %s port = %u\n",
+        ip_address, port );
+
+    SampleUtil_Print( "Registering Control Point" );
+    rc = UpnpRegisterClient( TvCtrlPointCallbackEventHandler,
+                             &ctrlpt_handle, &ctrlpt_handle );
+    if( UPNP_E_SUCCESS != rc ) {
+        SampleUtil_Print( "Error registering CP: %d", rc );
+        UpnpFinish();
+        return TV_ERROR;
+    }
+
+    SampleUtil_Print( "Control Point Registered" );
+
+    TvCtrlPointRefresh();
+
+    // start a timer thread
+    ithread_create( &timer_thread, NULL, TvCtrlPointTimerLoop, NULL );
+
+    return TV_SUCCESS;
+}
+
+int
+TvCtrlPointStop( void )
+{
+    TvCtrlPointRemoveAll();
+    UpnpUnRegisterClient( ctrlpt_handle );
+    UpnpFinish();
+    SampleUtil_Finish();
+
+    return TV_SUCCESS;
+}
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvctrlpt/upnp_tv_ctrlpt.h libupnp-1.6.6-mod/upnp/sample-orig/tvctrlpt/upnp_tv_ctrlpt.h
--- libupnp-1.6.6/upnp/sample-orig/tvctrlpt/upnp_tv_ctrlpt.h	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvctrlpt/upnp_tv_ctrlpt.h	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,160 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+#ifndef UPNP_TV_CTRLPT_H
+#define UPNP_TV_CTRLPT_H
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+
+#include <stdio.h>
+
+#include "ithread.h"
+#ifndef WIN32
+#include <unistd.h>
+#endif
+#include <stdarg.h>
+#include <stdlib.h>
+#include <signal.h>
+#include <string.h>
+
+#include "upnp.h"
+#include "upnptools.h"
+#include "sample_util.h"
+
+#define TV_SERVICE_SERVCOUNT	2
+#define TV_SERVICE_CONTROL		0
+#define TV_SERVICE_PICTURE		1
+
+#define TV_CONTROL_VARCOUNT		3
+#define TV_CONTROL_POWER		0
+#define TV_CONTROL_CHANNEL		1
+#define TV_CONTROL_VOLUME		2
+
+#define TV_PICTURE_VARCOUNT		4
+#define TV_PICTURE_COLOR		0
+#define TV_PICTURE_TINT			1
+#define TV_PICTURE_CONTRAST		2
+#define TV_PICTURE_BRIGHTNESS	3
+
+#define TV_MAX_VAL_LEN			5
+
+#define TV_SUCCESS				0
+#define TV_ERROR				(-1)
+#define TV_WARNING				1
+
+/* This should be the maximum VARCOUNT from above */
+#define TV_MAXVARS				TV_PICTURE_VARCOUNT
+
+extern char TvDeviceType[];
+extern char *TvServiceType[];
+extern char *TvServiceName[];
+extern char *TvVarName[TV_SERVICE_SERVCOUNT][TV_MAXVARS];
+extern char TvVarCount[];
+
+struct tv_service {
+    char ServiceId[NAME_SIZE];
+    char ServiceType[NAME_SIZE];
+    char *VariableStrVal[TV_MAXVARS];
+    char EventURL[NAME_SIZE];
+    char ControlURL[NAME_SIZE];
+    char SID[NAME_SIZE];
+};
+
+extern struct TvDeviceNode *GlobalDeviceList;
+
+struct TvDevice {
+    char UDN[250];
+    char DescDocURL[250];
+    char FriendlyName[250];
+    char PresURL[250];
+    int  AdvrTimeOut;
+    struct tv_service TvService[TV_SERVICE_SERVCOUNT];
+};
+
+struct TvDeviceNode {
+    struct TvDevice device;
+    struct TvDeviceNode *next;
+};
+
+extern ithread_mutex_t DeviceListMutex;
+
+extern UpnpClient_Handle ctrlpt_handle;
+
+void	TvCtrlPointPrintHelp( void );
+int		TvCtrlPointDeleteNode(struct TvDeviceNode*);
+int		TvCtrlPointRemoveDevice(char*);
+int		TvCtrlPointRemoveAll( void );
+int		TvCtrlPointRefresh( void );
+
+
+int		TvCtrlPointSendAction(int, int, char *, char **, char **, int);
+int		TvCtrlPointSendActionNumericArg(int devnum, int service, char *actionName, char *paramName, int paramValue);
+int		TvCtrlPointSendPowerOn(int devnum);
+int		TvCtrlPointSendPowerOff(int devnum);
+int		TvCtrlPointSendSetChannel(int, int);
+int		TvCtrlPointSendSetVolume(int, int);
+int		TvCtrlPointSendSetColor(int, int);
+int		TvCtrlPointSendSetTint(int, int);
+int		TvCtrlPointSendSetContrast(int, int);
+int		TvCtrlPointSendSetBrightness(int, int);
+
+int		TvCtrlPointGetVar(int, int, char*);
+int		TvCtrlPointGetPower(int devnum);
+int		TvCtrlPointGetChannel(int);
+int		TvCtrlPointGetVolume(int);
+int		TvCtrlPointGetColor(int);
+int		TvCtrlPointGetTint(int);
+int		TvCtrlPointGetContrast(int);
+int		TvCtrlPointGetBrightness(int);
+
+int		TvCtrlPointGetDevice(int, struct TvDeviceNode **);
+int		TvCtrlPointPrintList( void );
+int		TvCtrlPointPrintDevice(int);
+void	TvCtrlPointAddDevice (IXML_Document *, char *, int); 
+void    TvCtrlPointHandleGetVar(char *,char *,DOMString);
+void	TvStateUpdate(char*,int, IXML_Document * , char **);
+void	TvCtrlPointHandleEvent(Upnp_SID, int, IXML_Document *); 
+void	TvCtrlPointHandleSubscribeUpdate(char *, Upnp_SID, int); 
+int		TvCtrlPointCallbackEventHandler(Upnp_EventType, void *, void *);
+void	TvCtrlPointVerifyTimeouts(int);
+void	TvCtrlPointPrintCommands( void );
+void*	TvCtrlPointCommandLoop( void* );
+int		TvCtrlPointStart( print_string printFunctionPtr, state_update updateFunctionPtr );
+int		TvCtrlPointStop( void );
+int		TvCtrlPointProcessCommand( char *cmdline );
+
+#ifdef __cplusplus
+};
+#endif
+
+#endif //UPNP_TV_CTRLPT_H
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvdevice/linux/upnp_tv_device_main.c libupnp-1.6.6-mod/upnp/sample-orig/tvdevice/linux/upnp_tv_device_main.c
--- libupnp-1.6.6/upnp/sample-orig/tvdevice/linux/upnp_tv_device_main.c	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvdevice/linux/upnp_tv_device_main.c	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,197 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+
+#include "sample_util.h"
+#include "upnp_tv_device.h"
+
+
+#include <stdio.h>
+
+
+/******************************************************************************
+ * linux_print
+ *
+ * Description: 
+ *       Prints a string to standard out.
+ *
+ * Parameters:
+ *    None
+ *
+ *****************************************************************************/
+void
+linux_print( const char *string )
+{
+    printf( "%s", string );
+}
+
+/******************************************************************************
+ * TvDeviceCommandLoop
+ *
+ * Description: 
+ *       Function that receives commands from the user at the command prompt
+ *       during the lifetime of the device, and calls the appropriate
+ *       functions for those commands. Only one command, exit, is currently
+ *       defined.
+ *
+ * Parameters:
+ *    None
+ *
+ *****************************************************************************/
+void *
+TvDeviceCommandLoop( void *args )
+{
+    int stoploop = 0;
+    char cmdline[100];
+    char cmd[100];
+
+    while( !stoploop ) {
+        sprintf( cmdline, " " );
+        sprintf( cmd, " " );
+
+        SampleUtil_Print( "\n>> " );
+
+        // Get a command line
+        fgets( cmdline, 100, stdin );
+
+        sscanf( cmdline, "%s", cmd );
+
+        if( strcasecmp( cmd, "exit" ) == 0 ) {
+            SampleUtil_Print( "Shutting down...\n" );
+            TvDeviceStop();
+            exit( 0 );
+        } else {
+            SampleUtil_Print( "\n   Unknown command: %s\n\n", cmd );
+            SampleUtil_Print( "   Valid Commands:\n" );
+            SampleUtil_Print( "     Exit\n\n" );
+        }
+
+    }
+
+    return NULL;
+}
+
+/******************************************************************************
+ * main
+ *
+ * Description: 
+ *       Main entry point for tv device application.
+ *       Initializes and registers with the sdk.
+ *       Initializes the state stables of the service.
+ *       Starts the command loop.
+ *
+ * Parameters:
+ *    int argc  - count of arguments
+ *    char ** argv -arguments. The application 
+ *                  accepts the following optional arguments:
+ *
+ *                  -ip ipaddress 
+ *                  -port port
+ *		    -desc desc_doc_name 
+ *	            -webdir web_dir_path"
+ *		    -help 
+ *                 
+ *
+ *****************************************************************************/
+int main( IN int argc, IN char **argv )
+{
+
+    unsigned int portTemp = 0;
+    char *ip_address = NULL,
+     *desc_doc_name = NULL,
+     *web_dir_path = NULL;
+    int rc;
+    ithread_t cmdloop_thread;
+#ifndef WIN32
+    int sig;
+    sigset_t sigs_to_catch;
+#endif
+    int code;
+    unsigned int port = 0;
+    int i = 0;
+
+    SampleUtil_Initialize( linux_print );
+
+    // Parse options
+    for( i = 1; i < argc; i++ ) {
+        if( strcmp( argv[i], "-ip" ) == 0 ) {
+            ip_address = argv[++i];
+        } else if( strcmp( argv[i], "-port" ) == 0 ) {
+            sscanf( argv[++i], "%u", &portTemp );
+        } else if( strcmp( argv[i], "-desc" ) == 0 ) {
+            desc_doc_name = argv[++i];
+        } else if( strcmp( argv[i], "-webdir" ) == 0 ) {
+            web_dir_path = argv[++i];
+        } else if( strcmp( argv[i], "-help" ) == 0 ) {
+            SampleUtil_Print( "Usage: %s -ip ipaddress -port port"
+                              " -desc desc_doc_name -webdir web_dir_path"
+                              " -help (this message)\n", argv[0] );
+            SampleUtil_Print( "\tipaddress:     IP address of the device"
+                              " (must match desc. doc)\n" );
+            SampleUtil_Print( "\t\te.g.: 192.168.0.4\n" );
+            SampleUtil_Print( "\tport:          Port number to use for "
+                              "receiving UPnP messages (must match desc. doc)\n" );
+            SampleUtil_Print( "\t\te.g.: 5431\n" );
+            SampleUtil_Print
+                ( "\tdesc_doc_name: name of device description document\n" );
+            SampleUtil_Print( "\t\te.g.: tvdevicedesc.xml\n" );
+            SampleUtil_Print
+                ( "\tweb_dir_path: Filesystem path where web files "
+                  "related to the device are stored\n" );
+            SampleUtil_Print( "\t\te.g.: /upnp/sample/tvdevice/web\n" );
+            return 1;
+        }
+    }
+
+    port = ( unsigned short )portTemp;
+
+    TvDeviceStart( ip_address, port, desc_doc_name, web_dir_path, linux_print );
+
+    /* start a command loop thread */
+//    code = ithread_create( &cmdloop_thread, NULL, TvDeviceCommandLoop, NULL );
+
+#ifndef WIN32
+    /*
+       Catch Ctrl-C and properly shutdown 
+     */
+    sigemptyset( &sigs_to_catch );
+    sigaddset( &sigs_to_catch, SIGINT );
+    sigwait( &sigs_to_catch, &sig );
+
+    SampleUtil_Print( "Shutting down on signal %d...\n", sig );
+#else
+	ithread_join(cmdloop_thread, NULL);
+#endif
+    rc = TvDeviceStop();
+    
+    return rc;
+}
+
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvdevice/upnp_tv_device.c libupnp-1.6.6-mod/upnp/sample-orig/tvdevice/upnp_tv_device.c
--- libupnp-1.6.6/upnp/sample-orig/tvdevice/upnp_tv_device.c	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvdevice/upnp_tv_device.c	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,2038 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+#include "upnp_tv_device.h"
+
+#define DEFAULT_WEB_DIR "./web"
+
+#define DESC_URL_SIZE 200
+
+/*
+   Device type for tv device 
+ */
+char TvDeviceType[] = "urn:schemas-upnp-org:device:tvdevice:1";
+
+/*
+   Service types for tv services
+ */
+char *TvServiceType[] = { "urn:schemas-upnp-org:service:tvcontrol:1",
+    "urn:schemas-upnp-org:service:tvpicture:1"
+};
+
+/*
+   Global arrays for storing Tv Control Service
+   variable names, values, and defaults 
+ */
+char *tvc_varname[] = { "Power", "Channel", "Volume" };
+char tvc_varval[TV_CONTROL_VARCOUNT][TV_MAX_VAL_LEN];
+char *tvc_varval_def[] = { "1", "1", "5" };
+
+/*
+   Global arrays for storing Tv Picture Service
+   variable names, values, and defaults 
+ */
+char *tvp_varname[] = { "Color", "Tint", "Contrast", "Brightness" };
+char tvp_varval[TV_PICTURE_VARCOUNT][TV_MAX_VAL_LEN];
+char *tvp_varval_def[] = { "5", "5", "5", "5" };
+
+/*
+   The amount of time (in seconds) before advertisements
+   will expire 
+ */
+int default_advr_expire = 100;
+
+/*
+   Global structure for storing the state table for this device 
+ */
+struct TvService tv_service_table[2];
+
+/*
+   Device handle supplied by UPnP SDK 
+ */
+UpnpDevice_Handle device_handle = -1;
+
+/*
+   Mutex for protecting the global state table data
+   in a multi-threaded, asynchronous environment.
+   All functions should lock this mutex before reading
+   or writing the state table data. 
+ */
+ithread_mutex_t TVDevMutex;
+
+//Color constants
+#define MAX_COLOR 10
+#define MIN_COLOR 1
+
+//Brightness constants
+#define MAX_BRIGHTNESS 10
+#define MIN_BRIGHTNESS 1
+
+//Power constants
+#define POWER_ON 1
+#define POWER_OFF 0
+
+//Tint constants
+#define MAX_TINT 10
+#define MIN_TINT 1
+
+//Volume constants
+#define MAX_VOLUME 10
+#define MIN_VOLUME 1
+
+//Contrast constants
+#define MAX_CONTRAST 10
+#define MIN_CONTRAST 1
+
+//Channel constants
+#define MAX_CHANNEL 100
+#define MIN_CHANNEL 1
+
+/******************************************************************************
+ * SetServiceTable
+ *
+ * Description: 
+ *       Initializes the service table for the specified service.
+ *       Note that 
+ *       knowledge of the service description is
+ *       assumed. 
+ * Parameters:
+ *   int serviceType - one of TV_SERVICE_CONTROL or, TV_SERVICE_PICTURE
+ *   const char * UDN - UDN of device containing service
+ *   const char * serviceId - serviceId of service
+ *   const char * serviceTypeS - service type (as specified in Description
+ *                                             Document) 
+ *   struct TvService *out - service containing table to be set.
+ *
+ *****************************************************************************/
+int
+SetServiceTable( IN int serviceType,
+                 IN const char *UDN,
+                 IN const char *serviceId,
+                 IN const char *serviceTypeS,
+                 INOUT struct TvService *out )
+{
+    unsigned int i = 0;
+
+    strcpy( out->UDN, UDN );
+    strcpy( out->ServiceId, serviceId );
+    strcpy( out->ServiceType, serviceTypeS );
+
+    switch ( serviceType ) {
+        case TV_SERVICE_CONTROL:
+            out->VariableCount = TV_CONTROL_VARCOUNT;
+            for( i = 0;
+                 i < tv_service_table[TV_SERVICE_CONTROL].VariableCount;
+                 i++ ) {
+                tv_service_table[TV_SERVICE_CONTROL].VariableName[i]
+                    = tvc_varname[i];
+                tv_service_table[TV_SERVICE_CONTROL].VariableStrVal[i]
+                    = tvc_varval[i];
+                strcpy( tv_service_table[TV_SERVICE_CONTROL].
+                        VariableStrVal[i], tvc_varval_def[i] );
+            }
+
+            break;
+        case TV_SERVICE_PICTURE:
+            out->VariableCount = TV_PICTURE_VARCOUNT;
+
+            for( i = 0;
+                 i < tv_service_table[TV_SERVICE_PICTURE].VariableCount;
+                 i++ ) {
+                tv_service_table[TV_SERVICE_PICTURE].VariableName[i] =
+                    tvp_varname[i];
+                tv_service_table[TV_SERVICE_PICTURE].VariableStrVal[i] =
+                    tvp_varval[i];
+                strcpy( tv_service_table[TV_SERVICE_PICTURE].
+                        VariableStrVal[i], tvp_varval_def[i] );
+            }
+
+            break;
+        default:
+            assert( 0 );
+    }
+
+    return SetActionTable( serviceType, out );
+
+}
+
+/******************************************************************************
+ * SetActionTable
+ *
+ * Description: 
+ *       Initializes the action table for the specified service.
+ *       Note that 
+ *       knowledge of the service description is
+ *       assumed.  Action names are hardcoded.
+ * Parameters:
+ *   int serviceType - one of TV_SERVICE_CONTROL or, TV_SERVICE_PICTURE
+ *   struct TvService *out - service containing action table to set.
+ *
+ *****************************************************************************/
+int
+SetActionTable( IN int serviceType,
+                INOUT struct TvService *out )
+{
+    if( serviceType == TV_SERVICE_CONTROL ) {
+        out->ActionNames[0] = "PowerOn";
+        out->actions[0] = TvDevicePowerOn;
+        out->ActionNames[1] = "PowerOff";
+        out->actions[1] = TvDevicePowerOff;
+        out->ActionNames[2] = "SetChannel";
+        out->actions[2] = TvDeviceSetChannel;
+        out->ActionNames[3] = "IncreaseChannel";
+        out->actions[3] = TvDeviceIncreaseChannel;
+        out->ActionNames[4] = "DecreaseChannel";
+        out->actions[4] = TvDeviceDecreaseChannel;
+        out->ActionNames[5] = "SetVolume";
+        out->actions[5] = TvDeviceSetVolume;
+        out->ActionNames[6] = "IncreaseVolume";
+        out->actions[6] = TvDeviceIncreaseVolume;
+        out->ActionNames[7] = "DecreaseVolume";
+        out->actions[7] = TvDeviceDecreaseVolume;
+        out->ActionNames[8] = NULL;
+        return 1;
+    } else if( serviceType == TV_SERVICE_PICTURE ) {
+        out->ActionNames[0] = "SetColor";
+        out->ActionNames[1] = "IncreaseColor";
+        out->ActionNames[2] = "DecreaseColor";
+        out->actions[0] = TvDeviceSetColor;
+        out->actions[1] = TvDeviceIncreaseColor;
+        out->actions[2] = TvDeviceDecreaseColor;
+        out->ActionNames[3] = "SetTint";
+        out->ActionNames[4] = "IncreaseTint";
+        out->ActionNames[5] = "DecreaseTint";
+        out->actions[3] = TvDeviceSetTint;
+        out->actions[4] = TvDeviceIncreaseTint;
+        out->actions[5] = TvDeviceDecreaseTint;
+
+        out->ActionNames[6] = "SetBrightness";
+        out->ActionNames[7] = "IncreaseBrightness";
+        out->ActionNames[8] = "DecreaseBrightness";
+        out->actions[6] = TvDeviceSetBrightness;
+        out->actions[7] = TvDeviceIncreaseBrightness;
+        out->actions[8] = TvDeviceDecreaseBrightness;
+
+        out->ActionNames[9] = "SetContrast";
+        out->ActionNames[10] = "IncreaseContrast";
+        out->ActionNames[11] = "DecreaseContrast";
+
+        out->actions[9] = TvDeviceSetContrast;
+        out->actions[10] = TvDeviceIncreaseContrast;
+        out->actions[11] = TvDeviceDecreaseContrast;
+        return 1;
+    }
+
+    return 0;
+
+}
+
+/******************************************************************************
+ * TvDeviceStateTableInit
+ *
+ * Description: 
+ *       Initialize the device state table for 
+ * 	 this TvDevice, pulling identifier info
+ *       from the description Document.  Note that 
+ *       knowledge of the service description is
+ *       assumed.  State table variables and default
+ *       values are currently hardcoded in this file
+ *       rather than being read from service description
+ *       documents.
+ *
+ * Parameters:
+ *   DescDocURL -- The description document URL
+ *
+ *****************************************************************************/
+int
+TvDeviceStateTableInit( IN char *DescDocURL )
+{
+    IXML_Document *DescDoc = NULL;
+    int ret = UPNP_E_SUCCESS;
+    char *servid_ctrl = NULL,
+     *evnturl_ctrl = NULL,
+     *ctrlurl_ctrl = NULL;
+    char *servid_pict = NULL,
+     *evnturl_pict = NULL,
+     *ctrlurl_pict = NULL;
+    char *udn = NULL;
+
+    //Download description document
+    if( UpnpDownloadXmlDoc( DescDocURL, &DescDoc ) != UPNP_E_SUCCESS ) {
+        SampleUtil_Print( "TvDeviceStateTableInit -- Error Parsing %s\n",
+                          DescDocURL );
+        ret = UPNP_E_INVALID_DESC;
+        goto error_handler;
+    }
+
+    udn = SampleUtil_GetFirstDocumentItem( DescDoc, "UDN" );
+
+    /*
+       Find the Tv Control Service identifiers 
+     */
+    if( !SampleUtil_FindAndParseService( DescDoc, DescDocURL,
+                                         TvServiceType[TV_SERVICE_CONTROL],
+                                         &servid_ctrl, &evnturl_ctrl,
+                                         &ctrlurl_ctrl ) ) {
+        SampleUtil_Print( "TvDeviceStateTableInit -- Error: Could not find"
+                          " Service: %s\n",
+                          TvServiceType[TV_SERVICE_CONTROL] );
+
+        ret = UPNP_E_INVALID_DESC;
+        goto error_handler;
+    }
+
+    //set control service table
+    SetServiceTable( TV_SERVICE_CONTROL, udn, servid_ctrl,
+                     TvServiceType[TV_SERVICE_CONTROL],
+                     &tv_service_table[TV_SERVICE_CONTROL] );
+
+    /*
+       Find the Tv Picture Service identifiers 
+     */
+    if( !SampleUtil_FindAndParseService( DescDoc, DescDocURL,
+                                         TvServiceType[TV_SERVICE_PICTURE],
+                                         &servid_pict, &evnturl_pict,
+                                         &ctrlurl_pict ) ) {
+        SampleUtil_Print( "TvDeviceStateTableInit -- Error: Could not find"
+                          " Service: %s\n",
+                          TvServiceType[TV_SERVICE_PICTURE] );
+
+        ret = UPNP_E_INVALID_DESC;
+        goto error_handler;
+    }
+    //set picture service table
+    SetServiceTable( TV_SERVICE_PICTURE, udn, servid_pict,
+                     TvServiceType[TV_SERVICE_PICTURE],
+                     &tv_service_table[TV_SERVICE_PICTURE] );
+
+  error_handler:
+
+    //clean up
+    if( udn )
+        free( udn );
+    if( servid_ctrl )
+        free( servid_ctrl );
+    if( evnturl_ctrl )
+        free( evnturl_ctrl );
+    if( ctrlurl_ctrl )
+        free( ctrlurl_ctrl );
+    if( servid_pict )
+        free( servid_pict );
+    if( evnturl_pict )
+        free( evnturl_pict );
+    if( ctrlurl_pict )
+        free( ctrlurl_pict );
+    if( DescDoc )
+        ixmlDocument_free( DescDoc );
+
+    return ( ret );
+}
+
+/******************************************************************************
+ * TvDeviceHandleSubscriptionRequest
+ *
+ * Description: 
+ *       Called during a subscription request callback.  If the
+ *       subscription request is for this device and either its
+ *       control service or picture service, then accept it.
+ *
+ * Parameters:
+ *   sr_event -- The subscription request event structure
+ *
+ *****************************************************************************/
+int
+TvDeviceHandleSubscriptionRequest( IN struct Upnp_Subscription_Request
+                                   *sr_event )
+{
+    unsigned int i = 0;         //,j=0;
+
+    // IXML_Document *PropSet=NULL;
+
+    //lock state mutex
+    ithread_mutex_lock( &TVDevMutex );
+
+    for( i = 0; i < TV_SERVICE_SERVCOUNT; i++ ) {
+        if( ( strcmp( sr_event->UDN, tv_service_table[i].UDN ) == 0 ) &&
+            ( strcmp( sr_event->ServiceId, tv_service_table[i].ServiceId )
+              == 0 ) ) {
+
+            /*
+               PropSet = NULL;
+
+               for (j=0; j< tv_service_table[i].VariableCount; j++)
+               {
+               //add each variable to the property set
+               //for initial state dump
+               UpnpAddToPropertySet(&PropSet, 
+               tv_service_table[i].VariableName[j],
+               tv_service_table[i].VariableStrVal[j]);
+               }
+
+               //dump initial state 
+               UpnpAcceptSubscriptionExt(device_handle, sr_event->UDN, 
+               sr_event->ServiceId,
+               PropSet,sr_event->Sid);
+               //free document
+               Document_free(PropSet);
+
+             */
+
+            UpnpAcceptSubscription( device_handle,
+                                    sr_event->UDN,
+                                    sr_event->ServiceId,
+                                    ( const char ** )tv_service_table[i].
+                                    VariableName,
+                                    ( const char ** )tv_service_table[i].
+                                    VariableStrVal,
+                                    tv_service_table[i].VariableCount,
+                                    sr_event->Sid );
+
+        }
+    }
+
+    ithread_mutex_unlock( &TVDevMutex );
+
+    return ( 1 );
+}
+
+/******************************************************************************
+ * TvDeviceHandleGetVarRequest
+ *
+ * Description: 
+ *       Called during a get variable request callback.  If the
+ *       request is for this device and either its control service
+ *       or picture service, then respond with the variable value.
+ *
+ * Parameters:
+ *   cgv_event -- The control get variable request event structure
+ *
+ *****************************************************************************/
+int
+TvDeviceHandleGetVarRequest( INOUT struct Upnp_State_Var_Request
+                             *cgv_event )
+{
+    unsigned int i = 0,
+      j = 0;
+    int getvar_succeeded = 0;
+
+    cgv_event->CurrentVal = NULL;
+
+    ithread_mutex_lock( &TVDevMutex );
+
+    for( i = 0; i < TV_SERVICE_SERVCOUNT; i++ ) {
+        //check udn and service id
+        if( ( strcmp( cgv_event->DevUDN, tv_service_table[i].UDN ) == 0 )
+            &&
+            ( strcmp( cgv_event->ServiceID, tv_service_table[i].ServiceId )
+              == 0 ) ) {
+            //check variable name
+            for( j = 0; j < tv_service_table[i].VariableCount; j++ ) {
+                if( strcmp( cgv_event->StateVarName,
+                            tv_service_table[i].VariableName[j] ) == 0 ) {
+                    getvar_succeeded = 1;
+                    cgv_event->CurrentVal =
+                        ixmlCloneDOMString( tv_service_table[i].
+                                            VariableStrVal[j] );
+                    break;
+                }
+            }
+        }
+    }
+
+    if( getvar_succeeded ) {
+        cgv_event->ErrCode = UPNP_E_SUCCESS;
+    } else {
+        SampleUtil_Print
+            ( "Error in UPNP_CONTROL_GET_VAR_REQUEST callback:\n" );
+        SampleUtil_Print( "   Unknown variable name = %s\n",
+                          cgv_event->StateVarName );
+        cgv_event->ErrCode = 404;
+        strcpy( cgv_event->ErrStr, "Invalid Variable" );
+    }
+
+    ithread_mutex_unlock( &TVDevMutex );
+
+    return ( cgv_event->ErrCode == UPNP_E_SUCCESS );
+}
+
+/******************************************************************************
+ * TvDeviceHandleActionRequest
+ *
+ * Description: 
+ *       Called during an action request callback.  If the
+ *       request is for this device and either its control service
+ *       or picture service, then perform the action and respond.
+ *
+ * Parameters:
+ *   ca_event -- The control action request event structure
+ *
+ *****************************************************************************/
+int
+TvDeviceHandleActionRequest( INOUT struct Upnp_Action_Request *ca_event )
+{
+
+    /*
+       Defaults if action not found 
+     */
+    int action_found = 0;
+    int i = 0;
+    int service = -1;
+    int retCode = 0;
+    char *errorString = NULL;
+
+    ca_event->ErrCode = 0;
+    ca_event->ActionResult = NULL;
+
+    if( ( strcmp( ca_event->DevUDN,
+                  tv_service_table[TV_SERVICE_CONTROL].UDN ) == 0 ) &&
+        ( strcmp
+          ( ca_event->ServiceID,
+            tv_service_table[TV_SERVICE_CONTROL].ServiceId ) == 0 ) ) {
+        /*
+           Request for action in the TvDevice Control Service 
+         */
+        service = TV_SERVICE_CONTROL;
+    } else if( ( strcmp( ca_event->DevUDN,
+                         tv_service_table[TV_SERVICE_PICTURE].UDN ) == 0 )
+               &&
+               ( strcmp
+                 ( ca_event->ServiceID,
+                   tv_service_table[TV_SERVICE_PICTURE].ServiceId ) ==
+                 0 ) ) {
+        /*
+           Request for action in the TvDevice Picture Service 
+         */
+        service = TV_SERVICE_PICTURE;
+    }
+    //Find and call appropriate procedure based on action name
+    //Each action name has an associated procedure stored in the
+    //service table. These are set at initialization.
+
+    for( i = 0; ( ( i < TV_MAXACTIONS ) &&
+                  ( tv_service_table[service].ActionNames[i] != NULL ) );
+         i++ ) {
+
+        if( !strcmp( ca_event->ActionName,
+                     tv_service_table[service].ActionNames[i] ) ) {
+
+            if( ( !strcmp( tv_service_table[TV_SERVICE_CONTROL].
+                           VariableStrVal[TV_CONTROL_POWER], "1" ) )
+                || ( !strcmp( ca_event->ActionName, "PowerOn" ) ) ) {
+                retCode =
+                    tv_service_table[service].actions[i] ( ca_event->
+                                                           ActionRequest,
+                                                           &ca_event->
+                                                           ActionResult,
+                                                           &errorString );
+            } else {
+                errorString = "Power is Off";
+                retCode = UPNP_E_INTERNAL_ERROR;
+            }
+            action_found = 1;
+            break;
+        }
+    }
+
+    if( !action_found ) {
+        ca_event->ActionResult = NULL;
+        strcpy( ca_event->ErrStr, "Invalid Action" );
+        ca_event->ErrCode = 401;
+    } else {
+        if( retCode == UPNP_E_SUCCESS ) {
+            ca_event->ErrCode = UPNP_E_SUCCESS;
+        } else {
+            //copy the error string 
+            strcpy( ca_event->ErrStr, errorString );
+            switch ( retCode ) {
+                case UPNP_E_INVALID_PARAM:
+                    {
+                        ca_event->ErrCode = 402;
+                        break;
+                    }
+                case UPNP_E_INTERNAL_ERROR:
+                default:
+                    {
+                        ca_event->ErrCode = 501;
+                        break;
+                    }
+
+            }
+        }
+    }
+
+    return ( ca_event->ErrCode );
+}
+
+/******************************************************************************
+ * TvDeviceSetServiceTableVar
+ *
+ * Description: 
+ *       Update the TvDevice service state table, and notify all subscribed 
+ *       control points of the updated state.  Note that since this function
+ *       blocks on the mutex TVDevMutex, to avoid a hang this function should 
+ *       not be called within any other function that currently has this mutex 
+ *       locked.
+ *
+ * Parameters:
+ *   service -- The service number (TV_SERVICE_CONTROL or TV_SERVICE_PICTURE)
+ *   variable -- The variable number (TV_CONTROL_POWER, TV_CONTROL_CHANNEL,
+ *                   TV_CONTROL_VOLUME, TV_PICTURE_COLOR, TV_PICTURE_TINT,
+ *                   TV_PICTURE_CONTRAST, or TV_PICTURE_BRIGHTNESS)
+ *   value -- The string representation of the new value
+ *
+ *****************************************************************************/
+int
+TvDeviceSetServiceTableVar( IN unsigned int service,
+                            IN unsigned int variable,
+                            IN char *value )
+{
+    //IXML_Document  *PropSet= NULL;
+
+    if( ( service >= TV_SERVICE_SERVCOUNT )
+        || ( variable >= tv_service_table[service].VariableCount )
+        || ( strlen( value ) >= TV_MAX_VAL_LEN ) ) {
+        return ( 0 );
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+
+    strcpy( tv_service_table[service].VariableStrVal[variable], value );
+
+    /*
+       //Using utility api
+       PropSet= UpnpCreatePropertySet(1,tv_service_table[service].
+       VariableName[variable], 
+       tv_service_table[service].
+       VariableStrVal[variable]);
+
+       UpnpNotifyExt(device_handle, tv_service_table[service].UDN, 
+       tv_service_table[service].ServiceId,PropSet);
+
+       //Free created property set
+       Document_free(PropSet);
+     */
+
+    UpnpNotify( device_handle,
+                tv_service_table[service].UDN,
+                tv_service_table[service].ServiceId,
+                ( const char ** )&tv_service_table[service].
+                VariableName[variable],
+                ( const char ** )&tv_service_table[service].
+                VariableStrVal[variable], 1 );
+
+    ithread_mutex_unlock( &TVDevMutex );
+
+    return ( 1 );
+
+}
+
+/******************************************************************************
+ * TvDeviceSetPower
+ *
+ * Description: 
+ *       Turn the power on/off, update the TvDevice control service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   on -- If 1, turn power on.  If 0, turn power off.
+ *
+ *****************************************************************************/
+int
+TvDeviceSetPower( IN int on )
+{
+    char value[TV_MAX_VAL_LEN];
+    int ret = 0;
+
+    if( on != POWER_ON && on != POWER_OFF ) {
+        SampleUtil_Print( "error: can't set power to value %d\n", on );
+        return ( 0 );
+    }
+
+    /*
+       Vendor-specific code to turn the power on/off goes here 
+     */
+
+    sprintf( value, "%d", on );
+    ret = TvDeviceSetServiceTableVar( TV_SERVICE_CONTROL, TV_CONTROL_POWER,
+                                      value );
+
+    return ( ret );
+}
+
+/******************************************************************************
+ * TvDevicePowerOn
+ *
+ * Description: 
+ *       Turn the power on.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in - document of action request
+ *    IXML_Document **out - action result
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDevicePowerOn( IN IXML_Document * in,
+                 OUT IXML_Document ** out,
+                 OUT char **errorString )
+{
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( TvDeviceSetPower( POWER_ON ) ) {
+        //create a response
+
+        if( UpnpAddToActionResponse( out, "PowerOn",
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "Power", "1" ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * TvDevicePowerOff
+ *
+ * Description: 
+ *       Turn the power off.
+ *
+ * Parameters:
+ *    
+ *    IXML_Document * in - document of action request
+ *    IXML_Document **out - action result
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDevicePowerOff( IN IXML_Document * in,
+                  OUT IXML_Document ** out,
+                  OUT char **errorString )
+{
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+    if( TvDeviceSetPower( POWER_OFF ) ) {
+        //create a response
+
+        if( UpnpAddToActionResponse( out, "PowerOff",
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "Power", "0" ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+
+        return UPNP_E_SUCCESS;
+    }
+
+    ( *errorString ) = "Internal Error";
+    return UPNP_E_INTERNAL_ERROR;
+}
+
+/******************************************************************************
+ * TvDeviceSetChannel
+ *
+ * Description: 
+ *       Change the channel, update the TvDevice control service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *    
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceSetChannel( IN IXML_Document * in,
+                    OUT IXML_Document ** out,
+                    OUT char **errorString )
+{
+
+    char *value = NULL;
+
+    int channel = 0;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Channel" ) ) ) {
+        ( *errorString ) = "Invalid Channel";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    channel = atoi( value );
+
+    if( channel < MIN_CHANNEL || channel > MAX_CHANNEL ) {
+
+        free( value );
+        SampleUtil_Print( "error: can't change to channel %d\n", channel );
+        ( *errorString ) = "Invalid Channel";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_CONTROL,
+                                    TV_CONTROL_CHANNEL, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetChannel",
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "NewChannel",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementChannel
+ *
+ * Description: 
+ *       Increment the channel.  Read the current channel from the state
+ *       table, add the increment, and then change the channel.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the channel.
+ *      
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+IncrementChannel( IN int incr,
+                  IN IXML_Document * in,
+                  OUT IXML_Document ** out,
+                  OUT char **errorString )
+{
+    int curchannel,
+      newchannel;
+
+    char *actionName = NULL;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseChannel";
+    } else {
+        actionName = "DecreaseChannel";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curchannel = atoi( tv_service_table[TV_SERVICE_CONTROL].
+                       VariableStrVal[TV_CONTROL_CHANNEL] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newchannel = curchannel + incr;
+
+    if( newchannel < MIN_CHANNEL || newchannel > MAX_CHANNEL ) {
+        SampleUtil_Print( "error: can't change to channel %d\n",
+                          newchannel );
+        ( *errorString ) = "Invalid Channel";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newchannel );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_CONTROL,
+                                    TV_CONTROL_CHANNEL, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "Channel", value ) != UPNP_E_SUCCESS )
+        {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseChannel
+ *
+ * Description: 
+ *       Decrease the channel.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceDecreaseChannel( IN IXML_Document * in,
+                         OUT IXML_Document ** out,
+                         OUT char **errorString )
+{
+    return IncrementChannel( -1, in, out, errorString );
+
+}
+
+/******************************************************************************
+ * TvDeviceIncreaseChannel
+ *
+ * Description: 
+ *       Increase the channel.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceIncreaseChannel( IN IXML_Document * in,
+                         OUT IXML_Document ** out,
+                         OUT char **errorString )
+{
+    return IncrementChannel( 1, in, out, errorString );
+
+}
+
+/******************************************************************************
+ * TvDeviceSetVolume
+ *
+ * Description: 
+ *       Change the volume, update the TvDevice control service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *  
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceSetVolume( IN IXML_Document * in,
+                   OUT IXML_Document ** out,
+                   OUT char **errorString )
+{
+
+    char *value = NULL;
+
+    int volume = 0;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Volume" ) ) ) {
+        ( *errorString ) = "Invalid Volume";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    volume = atoi( value );
+
+    if( volume < MIN_VOLUME || volume > MAX_VOLUME ) {
+        SampleUtil_Print( "error: can't change to volume %d\n", volume );
+        ( *errorString ) = "Invalid Volume";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the volume goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_CONTROL,
+                                    TV_CONTROL_VOLUME, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetVolume",
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "NewVolume",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementVolume
+ *
+ * Description: 
+ *       Increment the volume.  Read the current volume from the state
+ *       table, add the increment, and then change the volume.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the volume.
+ *      
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+IncrementVolume( IN int incr,
+                 IN IXML_Document * in,
+                 OUT IXML_Document ** out,
+                 OUT char **errorString )
+{
+    int curvolume,
+      newvolume;
+    char *actionName = NULL;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseVolume";
+    } else {
+        actionName = "DecreaseVolume";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curvolume = atoi( tv_service_table[TV_SERVICE_CONTROL].
+                      VariableStrVal[TV_CONTROL_VOLUME] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newvolume = curvolume + incr;
+
+    if( newvolume < MIN_VOLUME || newvolume > MAX_VOLUME ) {
+        SampleUtil_Print( "error: can't change to volume %d\n",
+                          newvolume );
+        ( *errorString ) = "Invalid Volume";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newvolume );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_CONTROL,
+                                    TV_CONTROL_VOLUME, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_CONTROL],
+                                     "Volume", value ) != UPNP_E_SUCCESS )
+        {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * TvDeviceIncrVolume
+ *
+ * Description: 
+ *       Increase the volume. 
+ *
+ * Parameters:
+ *   
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+TvDeviceIncreaseVolume( IN IXML_Document * in,
+                        OUT IXML_Document ** out,
+                        OUT char **errorString )
+{
+
+    return IncrementVolume( 1, in, out, errorString );
+
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseVolume
+ *
+ * Description: 
+ *       Decrease the volume.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceDecreaseVolume( IN IXML_Document * in,
+                        OUT IXML_Document ** out,
+                        OUT char **errorString )
+{
+
+    return IncrementVolume( -1, in, out, errorString );
+
+}
+
+/******************************************************************************
+ * TvDeviceSetColor
+ *
+ * Description: 
+ *       Change the color, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceSetColor( IN IXML_Document * in,
+                  OUT IXML_Document ** out,
+                  OUT char **errorString )
+{
+
+    char *value = NULL;
+
+    int color = 0;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Color" ) ) ) {
+        ( *errorString ) = "Invalid Color";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    color = atoi( value );
+
+    if( color < MIN_COLOR || color > MAX_COLOR ) {
+        SampleUtil_Print( "error: can't change to color %d\n", color );
+        ( *errorString ) = "Invalid Color";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the volume goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_COLOR, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetColor",
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "NewColor",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementColor
+ *
+ * Description: 
+ *       Increment the color.  Read the current color from the state
+ *       table, add the increment, and then change the color.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the color.
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+
+int
+IncrementColor( IN int incr,
+                IN IXML_Document * in,
+                OUT IXML_Document ** out,
+                OUT char **errorString )
+{
+    int curcolor,
+      newcolor;
+
+    char *actionName;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseColor";
+    } else {
+        actionName = "DecreaseColor";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curcolor = atoi( tv_service_table[TV_SERVICE_PICTURE].
+                     VariableStrVal[TV_PICTURE_COLOR] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newcolor = curcolor + incr;
+
+    if( newcolor < MIN_COLOR || newcolor > MAX_COLOR ) {
+        SampleUtil_Print( "error: can't change to color %d\n", newcolor );
+        ( *errorString ) = "Invalid Color";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newcolor );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_COLOR, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "Color", value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseColor
+ *
+ * Description: 
+ *       Decrease the color.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+TvDeviceDecreaseColor( IN IXML_Document * in,
+                       OUT IXML_Document ** out,
+                       OUT char **errorString )
+{
+
+    return IncrementColor( -1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceIncreaseColor
+ *
+ * Description: 
+ *       Increase the color.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+TvDeviceIncreaseColor( IN IXML_Document * in,
+                       OUT IXML_Document ** out,
+                       OUT char **errorString )
+{
+
+    return IncrementColor( 1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceSetTint
+ *
+ * Description: 
+ *       Change the tint, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceSetTint( IN IXML_Document * in,
+                 OUT IXML_Document ** out,
+                 OUT char **errorString )
+{
+
+    char *value = NULL;
+
+    int tint = -1;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Tint" ) ) ) {
+        ( *errorString ) = "Invalid Tint";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    tint = atoi( value );
+
+    if( tint < MIN_TINT || tint > MAX_TINT ) {
+        SampleUtil_Print( "error: can't change to tint %d\n", tint );
+        ( *errorString ) = "Invalid Tint";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the volume goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_TINT, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetTint",
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "NewTint", value ) != UPNP_E_SUCCESS )
+        {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementTint
+ *
+ * Description: 
+ *       Increment the tint.  Read the current tint from the state
+ *       table, add the increment, and then change the tint.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the tint.
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+IncrementTint( IN int incr,
+               IN IXML_Document * in,
+               OUT IXML_Document ** out,
+               OUT char **errorString )
+{
+    int curtint,
+      newtint;
+
+    char *actionName = NULL;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseTint";
+    } else {
+        actionName = "DecreaseTint";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curtint = atoi( tv_service_table[TV_SERVICE_PICTURE].
+                    VariableStrVal[TV_PICTURE_TINT] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newtint = curtint + incr;
+
+    if( newtint < MIN_TINT || newtint > MAX_TINT ) {
+        SampleUtil_Print( "error: can't change to tint %d\n", newtint );
+        ( *errorString ) = "Invalid Tint";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newtint );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_TINT, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "Tint", value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * TvDeviceIncreaseTint
+ *
+ * Description: 
+ *       Increase tint.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceIncreaseTint( IN IXML_Document * in,
+                      OUT IXML_Document ** out,
+                      OUT char **errorString )
+{
+
+    return IncrementTint( 1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseTint
+ *
+ * Description: 
+ *       Decrease tint.
+ *
+ * Parameters:
+ *  
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceDecreaseTint( IN IXML_Document * in,
+                      OUT IXML_Document ** out,
+                      OUT char **errorString )
+{
+
+    return IncrementTint( -1, in, out, errorString );
+}
+
+/*****************************************************************************
+ * TvDeviceSetContrast
+ *
+ * Description: 
+ *       Change the contrast, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ ****************************************************************************/
+int
+TvDeviceSetContrast( IN IXML_Document * in,
+                     OUT IXML_Document ** out,
+                     OUT char **errorString )
+{
+
+    char *value = NULL;
+    int contrast = -1;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Contrast" ) ) ) {
+        ( *errorString ) = "Invalid Contrast";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    contrast = atoi( value );
+
+    if( contrast < MIN_CONTRAST || contrast > MAX_CONTRAST ) {
+        SampleUtil_Print( "error: can't change to contrast %d\n",
+                          contrast );
+        ( *errorString ) = "Invalid Contrast";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the volume goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_CONTRAST, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetContrast",
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "NewContrast",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementContrast
+ *
+ * Description: 
+ *       Increment the contrast.  Read the current contrast from the state
+ *       table, add the increment, and then change the contrast.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the contrast.
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+IncrementContrast( IN int incr,
+                   IN IXML_Document * in,
+                   OUT IXML_Document ** out,
+                   OUT char **errorString )
+{
+    int curcontrast,
+      newcontrast;
+
+    char *actionName = NULL;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseContrast";
+    } else {
+        actionName = "DecreaseContrast";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curcontrast = atoi( tv_service_table[TV_SERVICE_PICTURE].
+                        VariableStrVal[TV_PICTURE_CONTRAST] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newcontrast = curcontrast + incr;
+
+    if( newcontrast < MIN_CONTRAST || newcontrast > MAX_CONTRAST ) {
+        SampleUtil_Print( "error: can't change to contrast %d\n",
+                          newcontrast );
+        ( *errorString ) = "Invalid Contrast";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newcontrast );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_CONTRAST, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "Contrast",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+}
+
+/******************************************************************************
+ * TvDeviceIncreaseContrast
+ *
+ * Description: 
+ *
+ *      Increase the contrast.
+ *
+ * Parameters:
+ *       
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceIncreaseContrast( IN IXML_Document * in,
+                          OUT IXML_Document ** out,
+                          OUT char **errorString )
+{
+
+    return IncrementContrast( 1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseContrast
+ *
+ * Description: 
+ *      Decrease the contrast.
+ *
+ * Parameters:
+ *          
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceDecreaseContrast( IXML_Document * in,
+                          IXML_Document ** out,
+                          char **errorString )
+{
+    return IncrementContrast( -1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceSetBrightness
+ *
+ * Description: 
+ *       Change the brightness, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   brightness -- The brightness value to change to.
+ *
+ *****************************************************************************/
+int
+TvDeviceSetBrightness( IN IXML_Document * in,
+                       OUT IXML_Document ** out,
+                       OUT char **errorString )
+{
+
+    char *value = NULL;
+    int brightness = -1;
+
+    ( *out ) = NULL;
+    ( *errorString ) = NULL;
+
+    if( !( value = SampleUtil_GetFirstDocumentItem( in, "Brightness" ) ) ) {
+        ( *errorString ) = "Invalid Brightness";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    brightness = atoi( value );
+
+    if( brightness < MIN_BRIGHTNESS || brightness > MAX_BRIGHTNESS ) {
+        SampleUtil_Print( "error: can't change to brightness %d\n",
+                          brightness );
+        ( *errorString ) = "Invalid Brightness";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the volume goes here 
+     */
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_BRIGHTNESS, value ) ) {
+        if( UpnpAddToActionResponse( out, "SetBrightness",
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "NewBrightness",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            free( value );
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        free( value );
+        return UPNP_E_SUCCESS;
+    } else {
+        free( value );
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+
+}
+
+/******************************************************************************
+ * IncrementBrightness
+ *
+ * Description: 
+ *       Increment the brightness.  Read the current brightness from the state
+ *       table, add the increment, and then change the brightness.
+ *
+ * Parameters:
+ *   incr -- The increment by which to change the brightness.
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int
+IncrementBrightness( IN int incr,
+                     IN IXML_Document * in,
+                     OUT IXML_Document ** out,
+                     OUT char **errorString )
+{
+    int curbrightness,
+      newbrightness;
+    char *actionName = NULL;
+    char value[TV_MAX_VAL_LEN];
+
+    if( incr > 0 ) {
+        actionName = "IncreaseBrightness";
+    } else {
+        actionName = "DecreaseBrightness";
+    }
+
+    ithread_mutex_lock( &TVDevMutex );
+    curbrightness = atoi( tv_service_table[TV_SERVICE_PICTURE].
+                          VariableStrVal[TV_PICTURE_BRIGHTNESS] );
+    ithread_mutex_unlock( &TVDevMutex );
+
+    newbrightness = curbrightness + incr;
+
+    if( newbrightness < MIN_BRIGHTNESS || newbrightness > MAX_BRIGHTNESS ) {
+        SampleUtil_Print( "error: can't change to brightness %d\n",
+                          newbrightness );
+        ( *errorString ) = "Invalid Brightness";
+        return UPNP_E_INVALID_PARAM;
+    }
+
+    /*
+       Vendor-specific code to set the channel goes here 
+     */
+
+    sprintf( value, "%d", newbrightness );
+
+    if( TvDeviceSetServiceTableVar( TV_SERVICE_PICTURE,
+                                    TV_PICTURE_BRIGHTNESS, value ) ) {
+        if( UpnpAddToActionResponse( out, actionName,
+                                     TvServiceType[TV_SERVICE_PICTURE],
+                                     "Brightness",
+                                     value ) != UPNP_E_SUCCESS ) {
+            ( *out ) = NULL;
+            ( *errorString ) = "Internal Error";
+            return UPNP_E_INTERNAL_ERROR;
+        }
+        return UPNP_E_SUCCESS;
+    } else {
+        ( *errorString ) = "Internal Error";
+        return UPNP_E_INTERNAL_ERROR;
+    }
+}
+
+/******************************************************************************
+ * TvDeviceIncreaseBrightness
+ *
+ * Description: 
+ *       Increase brightness.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceIncreaseBrightness( IN IXML_Document * in,
+                            OUT IXML_Document ** out,
+                            OUT char **errorString )
+{
+    return IncrementBrightness( 1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceDecreaseBrightness
+ *
+ * Description: 
+ *       Decrease brightnesss.
+ *
+ * Parameters:
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int
+TvDeviceDecreaseBrightness( IN IXML_Document * in,
+                            OUT IXML_Document ** out,
+                            OUT char **errorString )
+{
+    return IncrementBrightness( -1, in, out, errorString );
+}
+
+/******************************************************************************
+ * TvDeviceCallbackEventHandler
+ *
+ * Description: 
+ *       The callback handler registered with the SDK while registering
+ *       root device.  Dispatches the request to the appropriate procedure
+ *       based on the value of EventType. The four requests handled by the 
+ *       device are: 
+ *                   1) Event Subscription requests.  
+ *                   2) Get Variable requests. 
+ *                   3) Action requests.
+ *
+ * Parameters:
+ *
+ *   EventType -- The type of callback event
+ *   Event -- Data structure containing event data
+ *   Cookie -- Optional data specified during callback registration
+ *
+ *****************************************************************************/
+int
+TvDeviceCallbackEventHandler( Upnp_EventType EventType,
+                              void *Event,
+                              void *Cookie )
+{
+
+    switch ( EventType ) {
+
+        case UPNP_EVENT_SUBSCRIPTION_REQUEST:
+
+            TvDeviceHandleSubscriptionRequest( ( struct
+                                                 Upnp_Subscription_Request
+                                                 * )Event );
+            break;
+
+        case UPNP_CONTROL_GET_VAR_REQUEST:
+            TvDeviceHandleGetVarRequest( ( struct Upnp_State_Var_Request
+                                           * )Event );
+            break;
+
+        case UPNP_CONTROL_ACTION_REQUEST:
+            TvDeviceHandleActionRequest( ( struct Upnp_Action_Request * )
+                                         Event );
+            break;
+
+            /*
+               ignore these cases, since this is not a control point 
+             */
+        case UPNP_DISCOVERY_ADVERTISEMENT_ALIVE:
+        case UPNP_DISCOVERY_SEARCH_RESULT:
+        case UPNP_DISCOVERY_SEARCH_TIMEOUT:
+        case UPNP_DISCOVERY_ADVERTISEMENT_BYEBYE:
+        case UPNP_CONTROL_ACTION_COMPLETE:
+        case UPNP_CONTROL_GET_VAR_COMPLETE:
+        case UPNP_EVENT_RECEIVED:
+        case UPNP_EVENT_RENEWAL_COMPLETE:
+        case UPNP_EVENT_SUBSCRIBE_COMPLETE:
+        case UPNP_EVENT_UNSUBSCRIBE_COMPLETE:
+            break;
+
+        default:
+            SampleUtil_Print
+                ( "Error in TvDeviceCallbackEventHandler: unknown event type %d\n",
+                  EventType );
+    }
+
+    /*
+       Print a summary of the event received 
+     */
+    SampleUtil_PrintEvent( EventType, Event );
+
+    return ( 0 );
+}
+
+/******************************************************************************
+ * TvDeviceStop
+ *
+ * Description: 
+ *       Stops the device. Uninitializes the sdk. 
+ *
+ * Parameters:
+ *
+ *****************************************************************************/
+int
+TvDeviceStop()
+{
+    UpnpUnRegisterRootDevice( device_handle );
+    UpnpFinish();
+    SampleUtil_Finish();
+    ithread_mutex_destroy( &TVDevMutex );
+    return UPNP_E_SUCCESS;
+}
+
+/******************************************************************************
+ * TvDeviceStart
+ *
+ * Description: 
+ *      Initializes the UPnP Sdk, registers the device, and sends out 
+ *      advertisements.  
+ *
+ * Parameters:
+ *
+ *   ip_address - ip address to initialize the sdk (may be NULL)
+ *                if null, then the first non null loopback address is used.
+ *   port       - port number to initialize the sdk (may be 0)
+ *                if zero, then a random number is used.
+ *   desc_doc_name - name of description document.
+ *                   may be NULL. Default is tvdevicedesc.xml
+ *   web_dir_path  - path of web directory.
+ *                   may be NULL. Default is ./web (for Linux) or ../tvdevice/web
+ *                   for windows.
+ *   pfun          - print function to use.  
+ *
+ *****************************************************************************/
+int
+TvDeviceStart( char *ip_address,
+               unsigned short port,
+               char *desc_doc_name,
+               char *web_dir_path,
+               print_string pfun )
+{
+    int ret = UPNP_E_SUCCESS;
+
+    char desc_doc_url[DESC_URL_SIZE];
+
+    ithread_mutex_init( &TVDevMutex, NULL );
+
+    SampleUtil_Initialize( pfun );
+
+    SampleUtil_Print(
+        "Initializing UPnP Sdk with\n"
+        "\tipaddress = %s port = %u\n",
+        ip_address, port );
+
+    if( ( ret = UpnpInit( ip_address, port ) ) != UPNP_E_SUCCESS ) {
+        SampleUtil_Print( "Error with UpnpInit -- %d\n", ret );
+        UpnpFinish();
+        return ret;
+    }
+
+    if( ip_address == NULL ) {
+        ip_address = UpnpGetServerIpAddress();
+    }
+
+    port = UpnpGetServerPort();
+
+    SampleUtil_Print(
+        "UPnP Initialized\n"
+	"\tipaddress= %s port = %u\n",
+        ip_address, port );
+
+    if( desc_doc_name == NULL ) {
+        desc_doc_name = "tvdevicedesc.xml";
+    }
+
+    if( web_dir_path == NULL ) {
+        web_dir_path = DEFAULT_WEB_DIR;
+    }
+
+    snprintf( desc_doc_url, DESC_URL_SIZE, "http://%s:%d/%s", ip_address,
+              port, desc_doc_name );
+
+    SampleUtil_Print( "Specifying the webserver root directory -- %s\n",
+                      web_dir_path );
+    if( ( ret =
+          UpnpSetWebServerRootDir( web_dir_path ) ) != UPNP_E_SUCCESS ) {
+        SampleUtil_Print
+            ( "Error specifying webserver root directory -- %s: %d\n",
+              web_dir_path, ret );
+        UpnpFinish();
+        return ret;
+    }
+
+    SampleUtil_Print(
+        "Registering the RootDevice\n"
+        "\t with desc_doc_url: %s\n",
+        desc_doc_url );
+
+    if( ( ret = UpnpRegisterRootDevice( desc_doc_url,
+                                        TvDeviceCallbackEventHandler,
+                                        &device_handle, &device_handle ) )
+        != UPNP_E_SUCCESS ) {
+        SampleUtil_Print( "Error registering the rootdevice : %d\n", ret );
+        UpnpFinish();
+        return ret;
+    } else {
+        SampleUtil_Print(
+            "RootDevice Registered\n"
+            "Initializing State Table\n");
+        TvDeviceStateTableInit( desc_doc_url );
+        SampleUtil_Print("State Table Initialized\n");
+
+        if( ( ret =
+              UpnpSendAdvertisement( device_handle, default_advr_expire ) )
+            != UPNP_E_SUCCESS ) {
+            SampleUtil_Print( "Error sending advertisements : %d\n", ret );
+            UpnpFinish();
+            return ret;
+        }
+
+        SampleUtil_Print("Advertisements Sent\n");
+    }
+    return UPNP_E_SUCCESS;
+}
+
diff -Naur libupnp-1.6.6/upnp/sample-orig/tvdevice/upnp_tv_device.h libupnp-1.6.6-mod/upnp/sample-orig/tvdevice/upnp_tv_device.h
--- libupnp-1.6.6/upnp/sample-orig/tvdevice/upnp_tv_device.h	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/tvdevice/upnp_tv_device.h	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,640 @@
+///////////////////////////////////////////////////////////////////////////
+//
+// Copyright (c) 2000-2003 Intel Corporation 
+// All rights reserved. 
+//
+// Redistribution and use in source and binary forms, with or without 
+// modification, are permitted provided that the following conditions are met: 
+//
+// * Redistributions of source code must retain the above copyright notice, 
+// this list of conditions and the following disclaimer. 
+// * Redistributions in binary form must reproduce the above copyright notice, 
+// this list of conditions and the following disclaimer in the documentation 
+// and/or other materials provided with the distribution. 
+// * Neither name of Intel Corporation nor the names of its contributors 
+// may be used to endorse or promote products derived from this software 
+// without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR 
+// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
+// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
+// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR 
+// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY 
+// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+// NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS 
+// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+///////////////////////////////////////////////////////////////////////////
+
+#ifndef UPNP_TV_DEVICE_H
+#define UPNP_TV_DEVICE_H
+
+#include <stdio.h>
+#include <signal.h>
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+
+#include "ithread.h"
+#include <stdlib.h>
+#ifndef WIN32
+#include <unistd.h>
+#endif
+#include <string.h>
+#include "upnp.h"
+#include "sample_util.h"
+
+//Color constants
+#define MAX_COLOR 10
+#define MIN_COLOR 1
+
+//Brightness constants
+#define MAX_BRIGHTNESS 10
+#define MIN_BRIGHTNESS 1
+
+//Power constants
+#define POWER_ON 1
+#define POWER_OFF 0
+
+//Tint constants
+#define MAX_TINT 10
+#define MIN_TINT 1
+
+//Volume constants
+#define MAX_VOLUME 10
+#define MIN_VOLUME 1
+
+//Contrast constants
+#define MAX_CONTRAST 10
+#define MIN_CONTRAST 1
+
+//Channel constants
+#define MAX_CHANNEL 100
+#define MIN_CHANNEL 1
+
+//Number of services.
+#define TV_SERVICE_SERVCOUNT  2
+
+//Index of control service
+#define TV_SERVICE_CONTROL    0
+
+//Index of picture service
+#define TV_SERVICE_PICTURE    1
+
+//Number of control variables
+#define TV_CONTROL_VARCOUNT   3
+
+//Index of power variable
+#define TV_CONTROL_POWER      0
+
+//Index of channel variable
+#define TV_CONTROL_CHANNEL    1
+
+//Index of volume variable
+#define TV_CONTROL_VOLUME     2
+
+//Number of picture variables
+#define TV_PICTURE_VARCOUNT   4
+
+//Index of color variable
+#define TV_PICTURE_COLOR      0
+
+//Index of tint variable
+#define TV_PICTURE_TINT       1
+
+//Index of contrast variable
+#define TV_PICTURE_CONTRAST   2
+
+//Index of brightness variable
+#define TV_PICTURE_BRIGHTNESS 3
+
+//Max value length
+#define TV_MAX_VAL_LEN 5
+
+//Max actions
+#define TV_MAXACTIONS 12
+
+/* This should be the maximum VARCOUNT from above */
+#define TV_MAXVARS TV_PICTURE_VARCOUNT
+
+
+extern char TvDeviceType[];
+
+extern char *TvServiceType[];
+
+
+
+/******************************************************************************
+ * upnp_action
+ *
+ * Description: 
+ *       Prototype for all actions. For each action that a service 
+ *       implements, there is a corresponding function with this prototype.
+ *       Pointers to these functions, along with action names, are stored
+ *       in the service table. When an action request comes in the action
+ *       name is matched, and the appropriate function is called.
+ *       Each function returns UPNP_E_SUCCESS, on success, and a nonzero 
+ *       error code on failure.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * request - document of action request
+ *    IXML_Document **out - action result
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+
+typedef int (*upnp_action) (IXML_Document *request, IXML_Document **out, 
+			    char **errorString);
+
+/* Structure for storing Tv Service
+   identifiers and state table */
+struct TvService {
+  
+  char UDN[NAME_SIZE]; /* Universally Unique Device Name */
+  char ServiceId[NAME_SIZE];
+  char ServiceType[NAME_SIZE];
+  char *VariableName[TV_MAXVARS]; 
+  char *VariableStrVal[TV_MAXVARS];
+  char *ActionNames[TV_MAXACTIONS];
+  upnp_action actions[TV_MAXACTIONS];
+  unsigned int  VariableCount;
+};
+
+//Array of service structures
+extern struct TvService tv_service_table[];
+
+//Device handle returned from sdk
+extern UpnpDevice_Handle device_handle;
+
+
+/* Mutex for protecting the global state table data
+   in a multi-threaded, asynchronous environment.
+   All functions should lock this mutex before reading
+   or writing the state table data. */
+extern ithread_mutex_t TVDevMutex;
+
+
+
+/******************************************************************************
+ * SetActionTable
+ *
+ * Description: 
+ *       Initializes the action table for the specified service.
+ *       Note that 
+ *       knowledge of the service description is
+ *       assumed.  Action names are hardcoded.
+ * Parameters:
+ *   int serviceType - one of TV_SERVICE_CONTROL or, TV_SERVICE_PICTURE
+ *   struct TvService *out - service containing action table to set.
+ *
+ *****************************************************************************/
+int SetActionTable(int serviceType, struct TvService * out);
+
+/******************************************************************************
+ * TvDeviceStateTableInit
+ *
+ * Description: 
+ *       Initialize the device state table for 
+ * 	 this TvDevice, pulling identifier info
+ *       from the description Document.  Note that 
+ *       knowledge of the service description is
+ *       assumed.  State table variables and default
+ *       values are currently hardcoded in this file
+ *       rather than being read from service description
+ *       documents.
+ *
+ * Parameters:
+ *   DescDocURL -- The description document URL
+ *
+ *****************************************************************************/
+int TvDeviceStateTableInit(char*);
+
+
+/******************************************************************************
+ * TvDeviceHandleSubscriptionRequest
+ *
+ * Description: 
+ *       Called during a subscription request callback.  If the
+ *       subscription request is for this device and either its
+ *       control service or picture service, then accept it.
+ *
+ * Parameters:
+ *   sr_event -- The subscription request event structure
+ *
+ *****************************************************************************/
+int TvDeviceHandleSubscriptionRequest(struct Upnp_Subscription_Request *);
+
+/******************************************************************************
+ * TvDeviceHandleGetVarRequest
+ *
+ * Description: 
+ *       Called during a get variable request callback.  If the
+ *       request is for this device and either its control service
+ *       or picture service, then respond with the variable value.
+ *
+ * Parameters:
+ *   cgv_event -- The control get variable request event structure
+ *
+ *****************************************************************************/
+int TvDeviceHandleGetVarRequest(struct Upnp_State_Var_Request *);
+
+/******************************************************************************
+ * TvDeviceHandleActionRequest
+ *
+ * Description: 
+ *       Called during an action request callback.  If the
+ *       request is for this device and either its control service
+ *       or picture service, then perform the action and respond.
+ *
+ * Parameters:
+ *   ca_event -- The control action request event structure
+ *
+ *****************************************************************************/
+int TvDeviceHandleActionRequest(struct Upnp_Action_Request *);
+
+/******************************************************************************
+ * TvDeviceCallbackEventHandler
+ *
+ * Description: 
+ *       The callback handler registered with the SDK while registering
+ *       root device.  Dispatches the request to the appropriate procedure
+ *       based on the value of EventType. The four requests handled by the 
+ *       device are: 
+ *                   1) Event Subscription requests.  
+ *                   2) Get Variable requests. 
+ *                   3) Action requests.
+ *
+ * Parameters:
+ *
+ *   EventType -- The type of callback event
+ *   Event -- Data structure containing event data
+ *   Cookie -- Optional data specified during callback registration
+ *
+ *****************************************************************************/
+int TvDeviceCallbackEventHandler(Upnp_EventType, void*, void*);
+
+/******************************************************************************
+ * TvDeviceSetServiceTableVar
+ *
+ * Description: 
+ *       Update the TvDevice service state table, and notify all subscribed 
+ *       control points of the updated state.  Note that since this function
+ *       blocks on the mutex TVDevMutex, to avoid a hang this function should 
+ *       not be called within any other function that currently has this mutex 
+ *       locked.
+ *
+ * Parameters:
+ *   service -- The service number (TV_SERVICE_CONTROL or TV_SERVICE_PICTURE)
+ *   variable -- The variable number (TV_CONTROL_POWER, TV_CONTROL_CHANNEL,
+ *                   TV_CONTROL_VOLUME, TV_PICTURE_COLOR, TV_PICTURE_TINT,
+ *                   TV_PICTURE_CONTRAST, or TV_PICTURE_BRIGHTNESS)
+ *   value -- The string representation of the new value
+ *
+ *****************************************************************************/
+int TvDeviceSetServiceTableVar(unsigned int, unsigned int, char*);
+
+//Control Service Actions
+
+/******************************************************************************
+ * TvDevicePowerOn
+ *
+ * Description: 
+ *       Turn the power on.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in - document of action request
+ *    IXML_Document **out - action result
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDevicePowerOn(IN IXML_Document * in, OUT IXML_Document **out, 
+		    OUT char **errorString);
+
+/******************************************************************************
+ * TvDevicePowerOff
+ *
+ * Description: 
+ *       Turn the power off.
+ *
+ * Parameters:
+ *    
+ *    IXML_Document * in - document of action request
+ *    IXML_Document **out - action result
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDevicePowerOff(IN IXML_Document *in, OUT IXML_Document **out, 
+		     OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceSetChannel
+ *
+ * Description: 
+ *       Change the channel, update the TvDevice control service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *    
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceSetChannel(IN IXML_Document *in, OUT IXML_Document **out, 
+		       OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceIncreaseChannel
+ *
+ * Description: 
+ *       Increase the channel.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceIncreaseChannel(IN IXML_Document *in, OUT IXML_Document **out, 
+			    OUT char **errorString);
+/******************************************************************************
+ * TvDeviceDecreaseChannel
+ *
+ * Description: 
+ *       Decrease the channel.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceDecreaseChannel(IN IXML_Document *in, OUT IXML_Document **out, 
+			    OUT char **errorString);
+/******************************************************************************
+ * TvDeviceSetVolume
+ *
+ * Description: 
+ *       Change the volume, update the TvDevice control service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *  
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceSetVolume(IN IXML_Document *in, OUT IXML_Document **out, 
+		      OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceIncreaseVolume
+ *
+ * Description: 
+ *       Increase the volume. 
+ *
+ * Parameters:
+ *   
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int TvDeviceIncreaseVolume(IN IXML_Document *in, OUT IXML_Document**out, 
+			   OUT char **errorString);
+
+
+/******************************************************************************
+ * TvDeviceDecreaseVolume
+ *
+ * Description: 
+ *       Decrease the volume.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceDecreaseVolume(IN IXML_Document *in, OUT IXML_Document**out, 
+			   OUT char **errorString);
+
+
+//Picture Service Actions
+
+/******************************************************************************
+ * TvDeviceSetColor
+ *
+ * Description: 
+ *       Change the color, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceSetColor(IN IXML_Document *in, OUT IXML_Document **out, 
+		     OUT char **errorString);
+
+
+/******************************************************************************
+ * TvDeviceIncreaseColor
+ *
+ * Description: 
+ *       Increase the color.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int TvDeviceIncreaseColor(IN IXML_Document * in, OUT IXML_Document **out, 
+			  OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceDecreaseColor
+ *
+ * Description: 
+ *       Decrease the color.  
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *****************************************************************************/
+int TvDeviceDecreaseColor(IN IXML_Document * in, OUT IXML_Document **out, 
+			  OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceSetTint
+ *
+ * Description: 
+ *       Change the tint, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceSetTint(IN IXML_Document *in, OUT IXML_Document **out, 
+		    OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceIncreaseTint
+ *
+ * Description: 
+ *       Increase tint.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceIncreaseTint(IN IXML_Document *in, OUT IXML_Document **out, 
+			 OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceDecreaseTint
+ *
+ * Description: 
+ *       Decrease tint.
+ *
+ * Parameters:
+ *  
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceDecreaseTint(IN IXML_Document *in, OUT IXML_Document **out, 
+			 OUT char **errorString);
+
+/*****************************************************************************
+ * TvDeviceSetContrast
+ *
+ * Description: 
+ *       Change the contrast, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ ****************************************************************************/
+int TvDeviceSetContrast(IN IXML_Document *in, OUT IXML_Document **out, 
+			OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceIncreaseContrast
+ *
+ * Description: 
+ *
+ *      Increase the contrast.
+ *
+ * Parameters:
+ *       
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceIncreaseContrast(IN IXML_Document *in, OUT IXML_Document **out, 
+			     OUT char **errorString);
+/******************************************************************************
+ * TvDeviceDecreaseContrast
+ *
+ * Description: 
+ *      Decrease the contrast.
+ *
+ * Parameters:
+ *          
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceDecreaseContrast(IN IXML_Document *in, OUT IXML_Document **out, 
+			     OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceSetBrightness
+ *
+ * Description: 
+ *       Change the brightness, update the TvDevice picture service
+ *       state table, and notify all subscribed control points of the
+ *       updated state.
+ *
+ * Parameters:
+ *   brightness -- The brightness value to change to.
+ *
+ *****************************************************************************/
+int TvDeviceSetBrightness(IN IXML_Document *in, OUT IXML_Document **out, 
+			  OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceIncreaseBrightness
+ *
+ * Description: 
+ *       Increase brightness.
+ *
+ * Parameters:
+ *
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceIncreaseBrightness(IN IXML_Document *in, OUT IXML_Document **out, 
+			       OUT char **errorString);
+
+/******************************************************************************
+ * TvDeviceDecreaseBrightness
+ *
+ * Description: 
+ *       Decrease brightnesss.
+ *
+ * Parameters:
+ *    IXML_Document * in -  action request document
+ *    IXML_Document **out - action result document
+ *    char **errorString - errorString (in case action was unsuccessful)
+ *
+ *****************************************************************************/
+int TvDeviceDecreaseBrightness(IN IXML_Document *in, OUT IXML_Document **out, 
+			       OUT char **errorString);
+
+int TvDeviceStart(char * ip_address, unsigned short port,char * desc_doc_name,
+				  char *web_dir_path, print_string pfun);
+int TvDeviceStop();
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif
diff -Naur libupnp-1.6.6/upnp/sample-orig/upnp-nas.tz libupnp-1.6.6-mod/upnp/sample-orig/upnp-nas.tz
--- libupnp-1.6.6/upnp/sample-orig/upnp-nas.tz	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/upnp-nas.tz	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,65 @@
+ K ]{{FO1C Ntk! nwUdX$g|MI3Bnmi3g7Wcz5gw9{E~o~67_z|zwu)$[y;2scSoMl|wxs.yHlk1^-E3U0D;v}ZZ5">=fo3G7gDIxRKE31}u3&l/N	vfiS36ZmJ%OVm0TswbO1=gsJ~DME4\,-Z~&x{46lgGD3waClO,jFZ3z?Fw14z.~13?Abm6 ~'z<6hps=*IWS`.$+Qh$A]Ch2_`WSXABr<x.V	&++?:fZVKP!ide&r0xmr5~k~Ra`?uzQ[Oln; 1wfJUW\<L5l:#WxnJ!C(y9nc
+vpp)<G8WEO@^UvVSg\gk	+~v$B%fNYx0N?c9[rrKG`b}"#JE[2:`f]`RK*hvMpeSR73wlj-){5[KXgK >Irn33Nc]]O:o0'7ea;8'TQpx4,EAk5H\4Dp}f=05B;W#BhKf1IrRPv2F=cmC#9[~*2Y"T/%*"CLe'k\1pScQI(cm7l7GCiu1*K(cZ	a#Iult1svB	HwMujZ>%	UD(>.f*XMCn)!$DTI]]%?Qy4p*8$&[PS8A#uJ4q5d<18P6MNZMdhS(:NR@1Q: b8Is{JT;5/dI0@0OqsVbsS5L=pXbQ CFP&*Fp/	uGrsQ=V}tX[DmP.m"RFlRDQ5]93h
+4h"q!cxc+iY0Y}o\\
+/gMwQnJ!s
+ )/Fp}B+yROX9fRZ-T.Y,ftqP";:JuN!Du|	&z^APAA
+/Hx<7jwz{}<h"D_p;n fU@t'9Y[@3j 0{ c>Wx5o7!F}tne../iz}5B3;kwi<AfE7(o*<\}q X\m#ycRS:>w|HB;mdX[C!$#xnl'RuD;wDvvo$h\*/mRN8,l'%a7I.*bdRPa{[{'O{?DE|[@hpSQ7;OfKT1&pE};CAxf;9> ^lom?Go G~B=:#H,<O*y
+]~k$
+L5Gb
+4y33+qDjx A4
+#0>1!dB&(92Z`EcD`.@sPu){'mMZ
+rr*dz~	6\l|3b)yT@(skl,>J\.3RGc2Jr&.`/t]"V
+53si;Vq<h()W$uS'z4DBt^s^V7-3>=z-`B&p
+iFC/GtU1
+hOL*dr4Y'de#Dad7o;Ch=]
+Dcs#51>ZVPkD!VcbBU'h(
+@bGw^r{9h"&Oo.' K+Qb&@xp<6,eo1*N9N%uUn]QNyRWyc3:%_&Vj:<6T~,g]B,@lq(avlX';hd`U=WKKHBmLFssPmx9nG\\#? ??\W<?v%Jbd`.aeO+'U#.T~BV|<r,4<` ':}|'H6wx	$	YDv}`M*K%6CN|mJ_s SnGh ,[6&okvC:ef`(2X7FG)FX(hq[	TouV:=w#yNaMPx#N(;hz}zs\ryZuB~BT-?
+eX
+bL"CpL<]\P8.w$h"Ihe}2c)Ipe]dx2m5hOn^jB{v\qQBQfa~Us(ha4o]*!=|G-(	vFKD"1$^Sj(,PSF-jopH8PH05rvN	B%}1dkux25Zq[V63I7iiMhk\cMT,&y]}ms`v]Df:.Y\XLKByo-t	rZQg3nJF'?P#gf*u3yt"6h4w=m*St[Y+WZ'jxPRLE}[,q-22B4Bsr$n$FT9t)%W2agZJ8f:IRr8pk6*#>AO V}F]N<16:kqbz?~Z_\%]QsSzA?RQ=hn%3O$}[&}tG?b,w7l`5&	70`uk70
+YM^~)'
+={LV'jY%6uJXWnxsnkNi>	F\EsM $?gjoy>qDgUv>DnPjCPbK#7lIK.q`tE.fRl_L?'ePC9n:r]f $Q)J$O!O)	(B	(:Rm%$dnq!>v|RtVdf}yVG**v02I#X>riLvJcNA+ZHK7q{n_j@fHI=$Z+?JBj]l+95[V^<]zs[m !#Kz^Yu&hsm9XxH\oB>cOLd9
+9oQJ`u <E),
+YMO&K<;Z')A;:STsqCp$\< F\`'[ Aj@asGzda{>YS[5]tP4wq
+u.? W"ncFIqPO[*(!Co5Q2Z]<YAiQVQP]p[nJqupi`J6Kz v;y@Sr#f=NKsq8U7w%
+:	o$2zr\_fql-~w:3oKkF0#L4]dk1<UL*U:M~	3rd7LhW`\{+urZuK8-f[;"~qK#{$ oFN
+r_RnIaPN_J
+Ru2EfI soN+CY:gQ-]F.uwxv>?|'DEDBm39+X{vnHt.bXeILk'Dy7{Bt~[e.A!w|ap2(g5&.b5%GgS,.
+4]Qh.#aMSg{w1a|"Nx+zDRb7t*c*b|I1&UCE;})	zp*:Jj{bmB%l9:i4eFtSks7_<sRV.E6ORxZ9lV[5HXtk5F% }GnK!9}$HG$b vZn#qxmN		GK^.wdd[
+Q"Fa]%+z%D U^.O7JSaR&c![8(`5aD3"Ah AG3<$G^D'q+X6hk`xE</o-<kW",'|!x+DU.?7%U
+ P(m/c=:-PIo"?&\R(b,aBiK=`	"W2pP|kLb"R.[|P I%N&T$5,\4^r"KS,L.*>Gh:XxB}wa"c,&^N-T6TK
+yA,tREy~ ?	rK2JuSZK~vw*<.\R5"CJI&eQ-R3@)E%rYR~qQz4"*E,
+t3;9	)+`U]ADm|Fy,1vM$dqLU$N
+:BP(rZ8l?l
+vgc5+Hc_G97d e*<3Tc$"t @sfPg[O` P>@I<AwJkD:Wxus;D8(pwpImL[sG/0X}"s 2s5/sR'k_><~9UQ$6^N"}Tpc, C-Y5:?0o8>YCrKX
+	
+&Gh~bnwI|_v;3qyK7'7pfqCXdLc 7IOv=G9\C.o(yJy $= q:[J{|Oz<=	PqgFd6]o0N
+=HLcJ9u}' bc|75FjDM	:D54<,*4bS:O2u*[&lV	I% [<3j2d4$f$,7>/e<Mg`*_a&3?9\f9YVpj%f#c5MO
+;XLE03RJz~l5&}0o@e^eK)$->d_""a q7) u<U	;/OlEcO>*<cZtnIE~SHQrW*9,$QH%!EPBf
+U"iy|A) GaB>={ ^)Z0J!tGq}!]	:]q%iK
+\J=<9o=([RI@\_FWX{67;k:g$(&YQ<
+M& 5`.;
+,=w5p kXADKOjw3y_ Wi,s50s ?tiLa?Xe!B68e H
+p6, 'X82r?!GwEk5y]"c?sL9wuIA0*DHZzQ5GGKA2~|)!+SDgU*	Ug J9)3Uwz5=^W[ef0kI5hIiY[i?s9J~`n
+5n'@N)gqy l5P1qR4&6B8
+Ff^18,QsM1
+4cm_WaQ_o}|#)+%;qw7;=X-X_Yw;7Cx!; i$>D,Hh`K^'G'tx:3z~HKZSDtOB':Dcw,5vP#^}:|98|NA,B1RAbE5p8a5` Hc"!mpV'G i"|xd"G)&3YS-=MTc`'651Oac8~4cu*|X?h^GKc<Xg[QRRoYQ4UD|C?O(A<f1zNhq%}wWX,m&=K#N RLRa_ &uR{r
+`??	S37}8rY.1uCLh$Lq~7+8O3d/y2$u:P fX&in5r41RhKWNx_%JRK DwrH?v;jQn~@O
+IpX)Wv)jT#C.@O~rP6yKSR>p$OH}rED#]!i2	uvgs9 7I{FE{mh%Yxfg~	ABEx)}25#j;H_1dX|-GLSi9+w A@wbF(!:::B?MC8!2uxXk
+jkD,ucdbQ*
+' %=pCbSL>TM5.iq]:DM nqDz(t}Ad\c2.f026c!2&Ha`^:S(u\	:4`?>jtTJ Aqtid3C4m++;OSBAb;oX$4dFcw-
+<]>l%TL;;-&vr!n[A@cki=0uy-vBqW 9WLaES CB(/1jsRhW+hr%$	3KTT01USOj v~2II~g-2fg6JLt)c?+R%D25rxV4<M6{)'Ld`ue.c!~1-zOee2LSs)eo "J	g)7"7,K3^j|^'Ubo
+6.y#h1%i4X8"|o0@a*@%pIFx%`[qh
+vKVM"@a=|826'$v)XUl{hVVQ,<YpppFj6*j`t08;}WL	*!|n=
+`M5#S:sV_yzm9
+]g2e:D	uKwCOS3bj99 pE.s~(;|:wIc 9g+hD]*)G)uS"
+KXW6`Y,`Cf@tQ-Bm%NN.X5+#B}ER[pOeeTI#9c,
+tu(E |&O|'U\LnpmL?0z`/~upy6-)]uq<=i0e[Nd !yCl%Tjyx12eCZ-<mO%x4"e~\QQLPteh4@/T}D rRFpg3]$ 0v]%h$K*
+1L`V\}+NrAdBq0]m=F|hK7\C#MR8SgRE5$Tm+,8}I#@'.hf*^
+q0JNPyp4I2sDBN:9"KQ{D }xk
+7IU*E6%)xz{-b73@3hqm9&PZr^&R{J.Z*zFC|2IzGP!nU-<rE>C~"9Jq;B?2.ck7^9?_ezJ' 5FTZ33\9]>|Ea+P
+*N8<A~6l!M!R-:C:!sHy`IG`FB8
+(Pg#9P=<E70d*sR{BGwuKb//w<Al"IBJg3I?T*> $,U		!hwmTCHzXO9Dd;yiYZ}	9
+Z~q$hqo=pBs.zvA8c2Lt9N?aDTC=Q|X?~=WD.DY{K~qJsBB;T\0e0I2z).W,Q/^Lm PeZ+N9eUi5@0Wp^&pEuP<,IKqGB`rR
+G9"Wxx0u_3`b-3z/MdZA
+3OKs	Y_+zj9Zpi:/KU9,$B %cIoYBWB!r&?q Lm$tXk6-pl2O2F_RU.Iey4p<?s3ABeB S+1c:9S}ax% P:Jj/ofG5KW,Tl0[%Wk#~DHg1J(W
+,S|1y{Nwc]|xinkwjv-amuj{=vy1m3s{6"*w}\ZtQNw<9Lb4op7?sOQt} ie](%qR$)xO8n43!y4rT@(AJ	J4k;^ f<7 Yffo;<0J*I{vw	6b{fmm6{Ndp6v;cp91u{j O}]|}32D%C#7EE]hq!`5%u?u/iK]3[|^}#AxdoD|?h @ 
\ No newline at end of file
diff -Naur libupnp-1.6.6/upnp/sample-orig/upnp_tv_combo libupnp-1.6.6-mod/upnp/sample-orig/upnp_tv_combo
--- libupnp-1.6.6/upnp/sample-orig/upnp_tv_combo	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/upnp_tv_combo	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,117 @@
+#! /bin/sh
+
+# upnp_tv_combo - temporary wrapper script for .libs/upnp_tv_combo
+# Generated by ltmain.sh - GNU libtool 1.5.22 (1.1220.2.365 2005/12/18 22:14:06)
+#
+# The upnp_tv_combo program cannot be directly executed until all the libtool
+# libraries that it depends on are installed.
+#
+# This wrapper script should never be moved out of the build directory.
+# If it is, it will not operate correctly.
+
+# Sed substitution that helps us do robust quoting.  It backslashifies
+# metacharacters that are still active within double-quoted strings.
+Xsed='/home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed -e 1s/^X//'
+sed_quote_subst='s/\([\\`\\"$\\\\]\)/\\\1/g'
+
+# The HP-UX ksh and POSIX shell print the target directory to stdout
+# if CDPATH is set.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+relink_command="(cd /home/steveh/projects/upnp-nas/libupnp-1.6.6/upnp/sample; { test -z \"\${LIBRARY_PATH+set}\" || unset LIBRARY_PATH || { LIBRARY_PATH=; export LIBRARY_PATH; }; }; { test -z \"\${COMPILER_PATH+set}\" || unset COMPILER_PATH || { COMPILER_PATH=; export COMPILER_PATH; }; }; { test -z \"\${GCC_EXEC_PREFIX+set}\" || unset GCC_EXEC_PREFIX || { GCC_EXEC_PREFIX=; export GCC_EXEC_PREFIX; }; }; { test -z \"\${LD_RUN_PATH+set}\" || unset LD_RUN_PATH || { LD_RUN_PATH=; export LD_RUN_PATH; }; }; { test -z \"\${LD_LIBRARY_PATH+set}\" || unset LD_LIBRARY_PATH || { LD_LIBRARY_PATH=; export LD_LIBRARY_PATH; }; }; PATH=\"/home/steveh/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games\"; export PATH; /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/usr/bin/ppc_4xxFP-gcc -pthread -g -O2 -Os -Wall -o \$progdir/\$file common/upnp_tv_combo-sample_util.o tvcombo/upnp_tv_combo-upnp_tv_ctrlpt.o tvcombo/upnp_tv_combo-upnp_tv_device.o tvcombo/linux/upnp_tv_combo-upnp_tv_combo_main.o  ../../upnp/.libs/libupnp.so /home/steveh/projects/upnp-nas/libupnp-1.6.6/threadutil/.libs/libthreadutil.so /home/steveh/projects/upnp-nas/libupnp-1.6.6/ixml/.libs/libixml.so ../../threadutil/.libs/libthreadutil.so ../../ixml/.libs/libixml.so -Wl,--rpath -Wl,/home/steveh/projects/upnp-nas/libupnp-1.6.6/upnp/.libs -Wl,--rpath -Wl,/home/steveh/projects/upnp-nas/libupnp-1.6.6/threadutil/.libs -Wl,--rpath -Wl,/home/steveh/projects/upnp-nas/libupnp-1.6.6/ixml/.libs)"
+
+# This environment variable determines our operation mode.
+if test "$libtool_install_magic" = "%%%MAGIC variable%%%"; then
+  # install mode needs the following variable:
+  notinst_deplibs=' ../../upnp/libupnp.la /home/steveh/projects/upnp-nas/libupnp-1.6.6/threadutil/libthreadutil.la /home/steveh/projects/upnp-nas/libupnp-1.6.6/ixml/libixml.la ../../threadutil/libthreadutil.la ../../ixml/libixml.la'
+else
+  # When we are sourced in execute mode, $file and $echo are already set.
+  if test "$libtool_execute_magic" != "%%%MAGIC variable%%%"; then
+    echo="echo"
+    file="$0"
+    # Make sure echo works.
+    if test "X$1" = X--no-reexec; then
+      # Discard the --no-reexec flag, and continue.
+      shift
+    elif test "X`($echo '\t') 2>/dev/null`" = 'X\t'; then
+      # Yippee, $echo works!
+      :
+    else
+      # Restart under the correct shell, and then maybe $echo will work.
+      exec /bin/sh "$0" --no-reexec ${1+"$@"}
+    fi
+  fi
+
+  # Find the directory that this script lives in.
+  thisdir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+  test "x$thisdir" = "x$file" && thisdir=.
+
+  # Follow symbolic links until we get to the real thisdir.
+  file=`ls -ld "$file" | /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed -n 's/.*-> //p'`
+  while test -n "$file"; do
+    destdir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+
+    # If there was a directory component, then change thisdir.
+    if test "x$destdir" != "x$file"; then
+      case "$destdir" in
+      [\\/]* | [A-Za-z]:[\\/]*) thisdir="$destdir" ;;
+      *) thisdir="$thisdir/$destdir" ;;
+      esac
+    fi
+
+    file=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
+    file=`ls -ld "$thisdir/$file" | /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed -n 's/.*-> //p'`
+  done
+
+  # Try to get the absolute directory name.
+  absdir=`cd "$thisdir" && pwd`
+  test -n "$absdir" && thisdir="$absdir"
+
+  program=lt-'upnp_tv_combo'
+  progdir="$thisdir/.libs"
+
+  if test ! -f "$progdir/$program" || \
+     { file=`ls -1dt "$progdir/$program" "$progdir/../$program" 2>/dev/null | /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed 1q`; \
+       test "X$file" != "X$progdir/$program"; }; then
+
+    file="$$-$program"
+
+    if test ! -d "$progdir"; then
+      mkdir "$progdir"
+    else
+      rm -f "$progdir/$file"
+    fi
+
+    # relink executable if necessary
+    if test -n "$relink_command"; then
+      if relink_command_output=`eval $relink_command 2>&1`; then :
+      else
+	echo "$relink_command_output" >&2
+	rm -f "$progdir/$file"
+	exit 1
+      fi
+    fi
+
+    mv -f "$progdir/$file" "$progdir/$program" 2>/dev/null ||
+    { rm -f "$progdir/$program";
+      mv -f "$progdir/$file" "$progdir/$program"; }
+    rm -f "$progdir/$file"
+  fi
+
+  if test -f "$progdir/$program"; then
+    if test "$libtool_execute_magic" != "%%%MAGIC variable%%%"; then
+      # Run the actual program with our arguments.
+
+      exec "$progdir/$program" ${1+"$@"}
+
+      $echo "$0: cannot exec $program ${1+"$@"}"
+      exit 1
+    fi
+  else
+    # The program doesn't exist.
+    $echo "$0: error: \`$progdir/$program' does not exist" 1>&2
+    $echo "This script is just a wrapper for $program." 1>&2
+    echo "See the libtool documentation for more information." 1>&2
+    exit 1
+  fi
+fi
diff -Naur libupnp-1.6.6/upnp/sample-orig/upnp_tv_ctrlpt libupnp-1.6.6-mod/upnp/sample-orig/upnp_tv_ctrlpt
--- libupnp-1.6.6/upnp/sample-orig/upnp_tv_ctrlpt	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/upnp_tv_ctrlpt	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,117 @@
+#! /bin/sh
+
+# upnp_tv_ctrlpt - temporary wrapper script for .libs/upnp_tv_ctrlpt
+# Generated by ltmain.sh - GNU libtool 1.5.22 (1.1220.2.365 2005/12/18 22:14:06)
+#
+# The upnp_tv_ctrlpt program cannot be directly executed until all the libtool
+# libraries that it depends on are installed.
+#
+# This wrapper script should never be moved out of the build directory.
+# If it is, it will not operate correctly.
+
+# Sed substitution that helps us do robust quoting.  It backslashifies
+# metacharacters that are still active within double-quoted strings.
+Xsed='/home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed -e 1s/^X//'
+sed_quote_subst='s/\([\\`\\"$\\\\]\)/\\\1/g'
+
+# The HP-UX ksh and POSIX shell print the target directory to stdout
+# if CDPATH is set.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+relink_command="(cd /home/steveh/projects/upnp-nas/libupnp-1.6.6/upnp/sample; { test -z \"\${LIBRARY_PATH+set}\" || unset LIBRARY_PATH || { LIBRARY_PATH=; export LIBRARY_PATH; }; }; { test -z \"\${COMPILER_PATH+set}\" || unset COMPILER_PATH || { COMPILER_PATH=; export COMPILER_PATH; }; }; { test -z \"\${GCC_EXEC_PREFIX+set}\" || unset GCC_EXEC_PREFIX || { GCC_EXEC_PREFIX=; export GCC_EXEC_PREFIX; }; }; { test -z \"\${LD_RUN_PATH+set}\" || unset LD_RUN_PATH || { LD_RUN_PATH=; export LD_RUN_PATH; }; }; { test -z \"\${LD_LIBRARY_PATH+set}\" || unset LD_LIBRARY_PATH || { LD_LIBRARY_PATH=; export LD_LIBRARY_PATH; }; }; PATH=\"/home/steveh/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games\"; export PATH; /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/usr/bin/ppc_4xxFP-gcc -pthread -g -O2 -Os -Wall -o \$progdir/\$file common/upnp_tv_ctrlpt-sample_util.o tvctrlpt/upnp_tv_ctrlpt-upnp_tv_ctrlpt.o tvctrlpt/linux/upnp_tv_ctrlpt-upnp_tv_ctrlpt_main.o  ../../upnp/.libs/libupnp.so /home/steveh/projects/upnp-nas/libupnp-1.6.6/threadutil/.libs/libthreadutil.so /home/steveh/projects/upnp-nas/libupnp-1.6.6/ixml/.libs/libixml.so ../../threadutil/.libs/libthreadutil.so ../../ixml/.libs/libixml.so -Wl,--rpath -Wl,/home/steveh/projects/upnp-nas/libupnp-1.6.6/upnp/.libs -Wl,--rpath -Wl,/home/steveh/projects/upnp-nas/libupnp-1.6.6/threadutil/.libs -Wl,--rpath -Wl,/home/steveh/projects/upnp-nas/libupnp-1.6.6/ixml/.libs)"
+
+# This environment variable determines our operation mode.
+if test "$libtool_install_magic" = "%%%MAGIC variable%%%"; then
+  # install mode needs the following variable:
+  notinst_deplibs=' ../../upnp/libupnp.la /home/steveh/projects/upnp-nas/libupnp-1.6.6/threadutil/libthreadutil.la /home/steveh/projects/upnp-nas/libupnp-1.6.6/ixml/libixml.la ../../threadutil/libthreadutil.la ../../ixml/libixml.la'
+else
+  # When we are sourced in execute mode, $file and $echo are already set.
+  if test "$libtool_execute_magic" != "%%%MAGIC variable%%%"; then
+    echo="echo"
+    file="$0"
+    # Make sure echo works.
+    if test "X$1" = X--no-reexec; then
+      # Discard the --no-reexec flag, and continue.
+      shift
+    elif test "X`($echo '\t') 2>/dev/null`" = 'X\t'; then
+      # Yippee, $echo works!
+      :
+    else
+      # Restart under the correct shell, and then maybe $echo will work.
+      exec /bin/sh "$0" --no-reexec ${1+"$@"}
+    fi
+  fi
+
+  # Find the directory that this script lives in.
+  thisdir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+  test "x$thisdir" = "x$file" && thisdir=.
+
+  # Follow symbolic links until we get to the real thisdir.
+  file=`ls -ld "$file" | /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed -n 's/.*-> //p'`
+  while test -n "$file"; do
+    destdir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+
+    # If there was a directory component, then change thisdir.
+    if test "x$destdir" != "x$file"; then
+      case "$destdir" in
+      [\\/]* | [A-Za-z]:[\\/]*) thisdir="$destdir" ;;
+      *) thisdir="$thisdir/$destdir" ;;
+      esac
+    fi
+
+    file=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
+    file=`ls -ld "$thisdir/$file" | /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed -n 's/.*-> //p'`
+  done
+
+  # Try to get the absolute directory name.
+  absdir=`cd "$thisdir" && pwd`
+  test -n "$absdir" && thisdir="$absdir"
+
+  program=lt-'upnp_tv_ctrlpt'
+  progdir="$thisdir/.libs"
+
+  if test ! -f "$progdir/$program" || \
+     { file=`ls -1dt "$progdir/$program" "$progdir/../$program" 2>/dev/null | /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed 1q`; \
+       test "X$file" != "X$progdir/$program"; }; then
+
+    file="$$-$program"
+
+    if test ! -d "$progdir"; then
+      mkdir "$progdir"
+    else
+      rm -f "$progdir/$file"
+    fi
+
+    # relink executable if necessary
+    if test -n "$relink_command"; then
+      if relink_command_output=`eval $relink_command 2>&1`; then :
+      else
+	echo "$relink_command_output" >&2
+	rm -f "$progdir/$file"
+	exit 1
+      fi
+    fi
+
+    mv -f "$progdir/$file" "$progdir/$program" 2>/dev/null ||
+    { rm -f "$progdir/$program";
+      mv -f "$progdir/$file" "$progdir/$program"; }
+    rm -f "$progdir/$file"
+  fi
+
+  if test -f "$progdir/$program"; then
+    if test "$libtool_execute_magic" != "%%%MAGIC variable%%%"; then
+      # Run the actual program with our arguments.
+
+      exec "$progdir/$program" ${1+"$@"}
+
+      $echo "$0: cannot exec $program ${1+"$@"}"
+      exit 1
+    fi
+  else
+    # The program doesn't exist.
+    $echo "$0: error: \`$progdir/$program' does not exist" 1>&2
+    $echo "This script is just a wrapper for $program." 1>&2
+    echo "See the libtool documentation for more information." 1>&2
+    exit 1
+  fi
+fi
diff -Naur libupnp-1.6.6/upnp/sample-orig/upnp_tv_device libupnp-1.6.6-mod/upnp/sample-orig/upnp_tv_device
--- libupnp-1.6.6/upnp/sample-orig/upnp_tv_device	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/upnp_tv_device	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,117 @@
+#! /bin/sh
+
+# upnp_tv_device - temporary wrapper script for .libs/upnp_tv_device
+# Generated by ltmain.sh - GNU libtool 1.5.22 (1.1220.2.365 2005/12/18 22:14:06)
+#
+# The upnp_tv_device program cannot be directly executed until all the libtool
+# libraries that it depends on are installed.
+#
+# This wrapper script should never be moved out of the build directory.
+# If it is, it will not operate correctly.
+
+# Sed substitution that helps us do robust quoting.  It backslashifies
+# metacharacters that are still active within double-quoted strings.
+Xsed='/home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed -e 1s/^X//'
+sed_quote_subst='s/\([\\`\\"$\\\\]\)/\\\1/g'
+
+# The HP-UX ksh and POSIX shell print the target directory to stdout
+# if CDPATH is set.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+relink_command="(cd /home/steveh/projects/upnp-nas/libupnp-1.6.6/upnp/sample; { test -z \"\${LIBRARY_PATH+set}\" || unset LIBRARY_PATH || { LIBRARY_PATH=; export LIBRARY_PATH; }; }; { test -z \"\${COMPILER_PATH+set}\" || unset COMPILER_PATH || { COMPILER_PATH=; export COMPILER_PATH; }; }; { test -z \"\${GCC_EXEC_PREFIX+set}\" || unset GCC_EXEC_PREFIX || { GCC_EXEC_PREFIX=; export GCC_EXEC_PREFIX; }; }; { test -z \"\${LD_RUN_PATH+set}\" || unset LD_RUN_PATH || { LD_RUN_PATH=; export LD_RUN_PATH; }; }; { test -z \"\${LD_LIBRARY_PATH+set}\" || unset LD_LIBRARY_PATH || { LD_LIBRARY_PATH=; export LD_LIBRARY_PATH; }; }; PATH=\"/home/steveh/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games\"; export PATH; /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/usr/bin/ppc_4xxFP-gcc -pthread -g -O2 -Os -Wall -o \$progdir/\$file common/upnp_tv_device-sample_util.o tvdevice/upnp_tv_device-upnp_tv_device.o tvdevice/linux/upnp_tv_device-upnp_tv_device_main.o  ../../upnp/.libs/libupnp.so /home/steveh/projects/upnp-nas/libupnp-1.6.6/threadutil/.libs/libthreadutil.so /home/steveh/projects/upnp-nas/libupnp-1.6.6/ixml/.libs/libixml.so ../../threadutil/.libs/libthreadutil.so ../../ixml/.libs/libixml.so -Wl,--rpath -Wl,/home/steveh/projects/upnp-nas/libupnp-1.6.6/upnp/.libs -Wl,--rpath -Wl,/home/steveh/projects/upnp-nas/libupnp-1.6.6/threadutil/.libs -Wl,--rpath -Wl,/home/steveh/projects/upnp-nas/libupnp-1.6.6/ixml/.libs)"
+
+# This environment variable determines our operation mode.
+if test "$libtool_install_magic" = "%%%MAGIC variable%%%"; then
+  # install mode needs the following variable:
+  notinst_deplibs=' ../../upnp/libupnp.la /home/steveh/projects/upnp-nas/libupnp-1.6.6/threadutil/libthreadutil.la /home/steveh/projects/upnp-nas/libupnp-1.6.6/ixml/libixml.la ../../threadutil/libthreadutil.la ../../ixml/libixml.la'
+else
+  # When we are sourced in execute mode, $file and $echo are already set.
+  if test "$libtool_execute_magic" != "%%%MAGIC variable%%%"; then
+    echo="echo"
+    file="$0"
+    # Make sure echo works.
+    if test "X$1" = X--no-reexec; then
+      # Discard the --no-reexec flag, and continue.
+      shift
+    elif test "X`($echo '\t') 2>/dev/null`" = 'X\t'; then
+      # Yippee, $echo works!
+      :
+    else
+      # Restart under the correct shell, and then maybe $echo will work.
+      exec /bin/sh "$0" --no-reexec ${1+"$@"}
+    fi
+  fi
+
+  # Find the directory that this script lives in.
+  thisdir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+  test "x$thisdir" = "x$file" && thisdir=.
+
+  # Follow symbolic links until we get to the real thisdir.
+  file=`ls -ld "$file" | /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed -n 's/.*-> //p'`
+  while test -n "$file"; do
+    destdir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+
+    # If there was a directory component, then change thisdir.
+    if test "x$destdir" != "x$file"; then
+      case "$destdir" in
+      [\\/]* | [A-Za-z]:[\\/]*) thisdir="$destdir" ;;
+      *) thisdir="$thisdir/$destdir" ;;
+      esac
+    fi
+
+    file=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
+    file=`ls -ld "$thisdir/$file" | /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed -n 's/.*-> //p'`
+  done
+
+  # Try to get the absolute directory name.
+  absdir=`cd "$thisdir" && pwd`
+  test -n "$absdir" && thisdir="$absdir"
+
+  program=lt-'upnp_tv_device'
+  progdir="$thisdir/.libs"
+
+  if test ! -f "$progdir/$program" || \
+     { file=`ls -1dt "$progdir/$program" "$progdir/../$program" 2>/dev/null | /home/steveh/3G/Apollo3G_amcc/build-ppc/staging_dir/bin/sed 1q`; \
+       test "X$file" != "X$progdir/$program"; }; then
+
+    file="$$-$program"
+
+    if test ! -d "$progdir"; then
+      mkdir "$progdir"
+    else
+      rm -f "$progdir/$file"
+    fi
+
+    # relink executable if necessary
+    if test -n "$relink_command"; then
+      if relink_command_output=`eval $relink_command 2>&1`; then :
+      else
+	echo "$relink_command_output" >&2
+	rm -f "$progdir/$file"
+	exit 1
+      fi
+    fi
+
+    mv -f "$progdir/$file" "$progdir/$program" 2>/dev/null ||
+    { rm -f "$progdir/$program";
+      mv -f "$progdir/$file" "$progdir/$program"; }
+    rm -f "$progdir/$file"
+  fi
+
+  if test -f "$progdir/$program"; then
+    if test "$libtool_execute_magic" != "%%%MAGIC variable%%%"; then
+      # Run the actual program with our arguments.
+
+      exec "$progdir/$program" ${1+"$@"}
+
+      $echo "$0: cannot exec $program ${1+"$@"}"
+      exit 1
+    fi
+  else
+    # The program doesn't exist.
+    $echo "$0: error: \`$progdir/$program' does not exist" 1>&2
+    $echo "This script is just a wrapper for $program." 1>&2
+    echo "See the libtool documentation for more information." 1>&2
+    exit 1
+  fi
+fi
diff -Naur libupnp-1.6.6/upnp/sample-orig/web/tvcombodesc.xml libupnp-1.6.6-mod/upnp/sample-orig/web/tvcombodesc.xml
--- libupnp-1.6.6/upnp/sample-orig/web/tvcombodesc.xml	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/web/tvcombodesc.xml	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,37 @@
+<?xml version="1.0"?>
+<root xmlns="urn:schemas-upnp-org:device-1-0">
+  <specVersion>
+    <major>1</major>
+    <minor>0</minor>
+  </specVersion>
+  <device>
+    <deviceType>urn:schemas-upnp-org:device:tvdevice:1</deviceType>
+    <friendlyName>UPnP Television Emulator</friendlyName>
+    <manufacturer>TV Manufacturer Name</manufacturer>
+    <manufacturerURL>http://www.manufacturer.com</manufacturerURL>
+    <modelDescription>UPnP Television Device Emulator 1.0</modelDescription>
+    <modelName>TVEmulator</modelName>
+    <modelNumber>1.0</modelNumber>
+    <modelURL>http://www.manufacturer.com/TVEmulator/</modelURL>
+    <serialNumber>123456789001</serialNumber>
+    <UDN>uuid:Upnp-TVEmulator-1_0-1234567890002</UDN>
+    <UPC>123456789</UPC>
+    <serviceList>
+      <service>
+        <serviceType>urn:schemas-upnp-org:service:tvcontrol:1</serviceType>
+        <serviceId>urn:upnp-org:serviceId:tvcontrol1</serviceId>
+        <controlURL>/upnp/control/tvcontrol1</controlURL>
+        <eventSubURL>/upnp/event/tvcontrol1</eventSubURL>
+        <SCPDURL>/tvcontrolSCPD.xml</SCPDURL>
+      </service>
+      <service>
+        <serviceType>urn:schemas-upnp-org:service:tvpicture:1</serviceType>
+        <serviceId>urn:upnp-org:serviceId:tvpicture1</serviceId>
+        <controlURL>/upnp/control/tvpicture1</controlURL>
+        <eventSubURL>/upnp/event/tvpicture1</eventSubURL>
+        <SCPDURL>/tvpictureSCPD.xml</SCPDURL>
+      </service>
+    </serviceList>
+   <presentationURL>/tvdevicepres.html</presentationURL>
+</device>
+</root>
diff -Naur libupnp-1.6.6/upnp/sample-orig/web/tvcontrolSCPD.xml libupnp-1.6.6-mod/upnp/sample-orig/web/tvcontrolSCPD.xml
--- libupnp-1.6.6/upnp/sample-orig/web/tvcontrolSCPD.xml	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/web/tvcontrolSCPD.xml	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,175 @@
+<?xml version="1.0"?>
+<scpd xmlns="urn:schemas-upnp-org:service-1-0">
+
+  <specVersion>
+    <major>1</major>
+    <minor>0</minor>
+  </specVersion>
+
+
+  <actionList>
+
+    <action>
+      <name>PowerOn</name>
+      <argumentList>
+         <argument>
+           <retval />
+           <name>Power</name>
+           <relatedStateVariable>Power</relatedStateVariable>
+           <direction>out</direction>
+          </argument>
+      </argumentList>
+    </action>
+
+    <action>
+      <name>PowerOff</name>    
+      <argumentList>
+         <argument>
+           <retval />
+           <name>Power</name>
+           <relatedStateVariable>Power</relatedStateVariable>
+           <direction>out</direction>
+          </argument>
+      </argumentList>
+    </action>
+
+    <action>
+      <name>SetChannel</name>
+      <argumentList>
+
+        <argument>
+        <name>Channel</name>
+          <relatedStateVariable>Channel</relatedStateVariable>
+          <direction>in</direction>
+        </argument>
+
+        <argument>
+         <name>NewChannel</name>
+         <retval />
+         <relatedStateVariable>Channel</relatedStateVariable>
+         <direction>out</direction>
+        </argument>
+
+      </argumentList>
+    </action>
+
+    <action>
+      <name>IncreaseChannel</name>     
+       <argumentList>
+        <argument>
+         <name>Channel</name>
+         <retval />
+         <relatedStateVariable>Channel</relatedStateVariable>
+         <direction>out</direction>
+        </argument>
+       </argumentList>
+    </action>
+
+    <action>
+      <name>DecreaseChannel</name> 
+      <argumentList>
+        <argument>
+         <name>Channel</name>
+         <retval />
+         <relatedStateVariable>Channel</relatedStateVariable>
+         <direction>out</direction>
+        </argument>
+       </argumentList>
+    </action>
+
+    <action>
+      <name>SetVolume</name>
+      <argumentList>
+        <argument>
+        <name>Volume</name>
+          <relatedStateVariable>Volume</relatedStateVariable>
+          <direction>in</direction>
+        </argument>
+
+        <argument>
+         <name>NewVolume</name>
+         <retval />
+         <relatedStateVariable>Volume</relatedStateVariable>
+         <direction>out</direction>
+         </argument>
+      </argumentList>
+    </action>
+
+    <action>
+      <name>IncreaseVolume</name>       
+      <argumentList>
+
+        <argument>
+         <name>Volume</name>
+         <retval />
+         <relatedStateVariable>Volume</relatedStateVariable>
+         <direction>out</direction>
+         </argument>
+       </argumentList>
+
+    </action>
+
+    <action>
+      <name>DecreaseVolume</name>       
+      <argumentList>
+
+        <argument>
+         <name>Volume</name>
+         <retval />
+         <relatedStateVariable>Volume</relatedStateVariable>
+         <direction>out</direction>
+         </argument>
+      </argumentList>
+    </action>
+
+  </actionList>
+
+  <serviceStateTable>
+
+    <stateVariable sendEvents="yes">
+      <name>Power</name>
+      <dataType>Boolean</dataType>
+      <defaultValue>0</defaultValue>
+    </stateVariable>
+
+    <stateVariable sendEvents="yes">
+      <name>Channel</name>
+      <dataType>i4</dataType>
+        <allowedValueRange>
+          <minimum>1</minimum>
+          <maximum>100</maximum>
+          <step>1</step>
+        </allowedValueRange>
+      <defaultValue>1</defaultValue>
+    </stateVariable>
+
+    <stateVariable sendEvents="yes">
+      <name>Volume</name>
+      <dataType>i4</dataType>
+        <allowedValueRange>
+          <minimum>0</minimum>
+          <maximum>10</maximum>
+          <step>1</step>
+        </allowedValueRange>
+      <defaultValue>5</defaultValue>
+    </stateVariable>
+
+  </serviceStateTable>
+
+</scpd>
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
diff -Naur libupnp-1.6.6/upnp/sample-orig/web/tvdevicedesc.xml libupnp-1.6.6-mod/upnp/sample-orig/web/tvdevicedesc.xml
--- libupnp-1.6.6/upnp/sample-orig/web/tvdevicedesc.xml	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/web/tvdevicedesc.xml	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,37 @@
+<?xml version="1.0"?>
+<root xmlns="urn:schemas-upnp-org:device-1-0">
+  <specVersion>
+    <major>1</major>
+    <minor>0</minor>
+  </specVersion>
+  <device>
+    <deviceType>urn:schemas-upnp-org:device:tvdevice:1</deviceType>
+    <friendlyName>UPnP Television Emulator</friendlyName>
+    <manufacturer>TV Manufacturer Name</manufacturer>
+    <manufacturerURL>http://www.manufacturer.com</manufacturerURL>
+    <modelDescription>UPnP Television Device Emulator 1.0</modelDescription>
+    <modelName>TVEmulator</modelName>
+    <modelNumber>1.0</modelNumber>
+    <modelURL>http://www.manufacturer.com/TVEmulator/</modelURL>
+    <serialNumber>123456789001</serialNumber>
+    <UDN>uuid:Upnp-TVEmulator-1_0-1234567890001</UDN>
+    <UPC>123456789</UPC>
+    <serviceList>
+      <service>
+        <serviceType>urn:schemas-upnp-org:service:tvcontrol:1</serviceType>
+        <serviceId>urn:upnp-org:serviceId:tvcontrol1</serviceId>
+        <controlURL>/upnp/control/tvcontrol1</controlURL>
+        <eventSubURL>/upnp/event/tvcontrol1</eventSubURL>
+        <SCPDURL>/tvcontrolSCPD.xml</SCPDURL>
+      </service>
+      <service>
+        <serviceType>urn:schemas-upnp-org:service:tvpicture:1</serviceType>
+        <serviceId>urn:upnp-org:serviceId:tvpicture1</serviceId>
+        <controlURL>/upnp/control/tvpicture1</controlURL>
+        <eventSubURL>/upnp/event/tvpicture1</eventSubURL>
+        <SCPDURL>/tvpictureSCPD.xml</SCPDURL>
+      </service>
+    </serviceList>
+   <presentationURL>/tvdevicepres.html</presentationURL>
+</device>
+</root>
diff -Naur libupnp-1.6.6/upnp/sample-orig/web/tvdevicepres.html libupnp-1.6.6-mod/upnp/sample-orig/web/tvdevicepres.html
--- libupnp-1.6.6/upnp/sample-orig/web/tvdevicepres.html	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/web/tvdevicepres.html	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,300 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
+  <HTML>
+    <HEAD>
+      <TITLE>Presentation page for Controlling a UPnP Television</TITLE>
+    </HEAD>
+
+    <BODY>
+
+      <H3><P ID=FName>Device Name</P></H3>
+
+
+      <H3>TvDevice Control State Table</H3>
+      <TABLE BGCOLOR='#D6D7DE' BORDER=0 VALIGN=top ALIGN=left CELLPADDING=1 CELLSPACING=3>
+        <TR>
+          <TD BGCOLOR='#000000' VALIGN=center ALIGN=center WIDTH=60><B><FONT SIZE="2" COLOR=whitesmoke>Variable</FONT></B></TD>
+          <TD VALIGN=middle ALIGN=left BGCOLOR='#000000' WIDTH=60><B><FONT SIZE="2" COLOR=whitesmoke>Value</FONT></B></TD>
+          <TD VALIGN=middle ALIGN=left BGCOLOR='#000000' WIDTH=60><B><FONT SIZE="2" COLOR=whitesmoke>Actions</FONT></B></TD>
+        </TR>
+        <TR>
+          <TD  BGCOLOR="#FFFFFF" VALIGN=center ALIGN=center>Power</TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top"><P ID=Power></P></TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top">
+		&nbsp;&nbsp;
+		<INPUT type="button" onclick="SetPowerOn()"      value=" On   ">
+	        &nbsp;&nbsp;
+		<INPUT type="button" onclick="SetPowerOff()"     value=" Off  ">
+		&nbsp;&nbsp;
+          </TD>
+        </TR>
+        <TR>
+          <TD  BGCOLOR="#FFFFFF" VALIGN=center ALIGN=center>Channel</TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top"><P ID=Channel></P></TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top">
+		&nbsp;&nbsp;
+		<INPUT type="button" onclick="IncreaseChannel()"     value=" Up   ">
+		&nbsp;&nbsp;
+	        <INPUT type="button" onclick="DecreaseChannel()"     value=" Down ">
+		&nbsp;&nbsp;
+          </TD>
+        </TR>
+        <TR>
+          <TD  BGCOLOR="#FFFFFF" VALIGN=center ALIGN=center>Volume</TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top"><P ID=Volume></P></TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top">
+		&nbsp;&nbsp;
+		<INPUT type="button" onclick="IncreaseVolume()"     value=" Up   ">
+		&nbsp;&nbsp;
+	        <INPUT type="button" onclick="DecreaseVolume()"     value=" Down ">
+		&nbsp;&nbsp;
+          </TD>
+        </TR>
+      </TABLE>
+
+
+      <BR>
+      <BR>
+      <BR>
+      <BR>
+      <BR>
+      <BR>
+      <BR>
+      <BR>
+      <BR>
+
+      <H3>TvDevice Picture State Table</H3>
+      <TABLE BGCOLOR='#D6D7DE' BORDER=0 VALIGN=top ALIGN=left CELLPADDING=1 CELLSPACING=3>
+        <TR>
+          <TD BGCOLOR='#000000' VALIGN=center ALIGN=center WIDTH=60><B><FONT SIZE="2" COLOR=whitesmoke>Variable</FONT></B></TD>
+          <TD VALIGN=middle ALIGN=left BGCOLOR='#000000' WIDTH=60><B><FONT SIZE="2" COLOR=whitesmoke>Value</FONT></B></TD>
+          <TD VALIGN=middle ALIGN=left BGCOLOR='#000000' WIDTH=60><B><FONT SIZE="2" COLOR=whitesmoke>Actions</FONT></B></TD>
+        </TR>
+        <TR>
+          <TD  BGCOLOR="#FFFFFF" VALIGN=center ALIGN=center>Color</TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top"><P ID=Color></P></TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top">
+		&nbsp;&nbsp;
+		<INPUT type="button" onclick="IncreaseColor()"     value=" Up   ">
+		&nbsp;&nbsp;
+	        <INPUT type="button" onclick="DecreaseColor()"     value=" Down ">
+		&nbsp;&nbsp;
+          </TD>
+        </TR>
+        <TR>
+          <TD  BGCOLOR="#FFFFFF" VALIGN=center ALIGN=center>Tint</TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top"><P ID=Tint></P></TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top">
+		&nbsp;&nbsp;
+		<INPUT type="button" onclick="IncreaseTint()"     value=" Up   ">
+		&nbsp;&nbsp;
+	        <INPUT type="button" onclick="DecreaseTint()"     value=" Down ">
+		&nbsp;&nbsp;
+          </TD>
+        </TR>
+        <TR>
+          <TD  BGCOLOR="#FFFFFF" VALIGN=center ALIGN=center>Contrast</TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top"><P ID=Contrast></P></TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top">
+		&nbsp;&nbsp;
+		<INPUT type="button" onclick="IncreaseContrast()"     value=" Up   ">
+		&nbsp;&nbsp;
+	        <INPUT type="button" onclick="DecreaseContrast()"     value=" Down ">
+		&nbsp;&nbsp;
+          </TD>
+        </TR>
+        <TR>
+          <TD  BGCOLOR="#FFFFFF" VALIGN=center ALIGN=center>Brightness</TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top"><P ID=Brightness></P></TD>
+          <TD  BGCOLOR="#FFFFFF" valign="top">
+		&nbsp;&nbsp;
+		<INPUT type="button" onclick="IncreaseBrightness()"     value=" Up   ">
+		&nbsp;&nbsp;
+	        <INPUT type="button" onclick="DecreaseBrightness()"     value=" Down ">
+		&nbsp;&nbsp;
+          </TD>
+        </TR>
+      </TABLE>
+<H3>&nbsp;</H3>
+
+<SCRIPT language=VBScript>
+
+
+' *********************************************************
+' Event handler called when the UPnP device submits events
+' *********************************************************
+
+
+
+Sub eventHandler(callbackType, svcObj, varName, value)
+
+'Dim output
+'output = output & "varName " & varName & vbCrLf 
+'output = output & "value " & value & vbCrLf
+'output = output & "svcObj " & svcObj.Id & vbCrLf
+'MsgBox output 
+
+  If (callbackType = "VARIABLE_UPDATE") Then
+    select case svcObj.Id
+      case "urn:upnp-org:serviceId:tvcontrol1"
+        select case varName
+          Case "Power"      Power.innerText = value
+          Case "Channel"    Channel.innerText = value
+          Case "Volume"     Volume.innerText = value
+        end select
+      case "urn:upnp-org:serviceId:tvpicture1"
+        select case varName
+          Case "Color"      Color.innerText = value
+          Case "Tint"       Tint.innerText = value
+          Case "Contrast"   Contrast.innerText = value
+          Case "Brightness" Brightness.innerText = value
+        end select
+      end select
+    End If
+End Sub
+
+
+
+' **********************************************************
+' Button action callbacks invoke actions
+' **********************************************************
+
+function SetPowerOn()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvControlService.InvokeAction "PowerOn", inArgs, outArgs
+end function
+
+
+function SetPowerOff()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvControlService.InvokeAction "PowerOff", inArgs, outArgs
+end function
+
+function IncreaseChannel()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvControlService.InvokeAction "IncreaseChannel", inArgs, outArgs
+end function
+
+function DecreaseChannel()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvControlService.InvokeAction "DecreaseChannel", inArgs, outArgs
+end function
+
+function IncreaseVolume()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvControlService.InvokeAction "IncreaseVolume", inArgs, outArgs
+end function
+
+function DecreaseVolume()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvControlService.InvokeAction "DecreaseVolume", inArgs, outArgs
+end function
+
+function IncreaseColor()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvPictureService.InvokeAction "IncreaseColor", inArgs, outArgs
+end function
+
+function DecreaseColor()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvPictureService.InvokeAction "DecreaseColor", inArgs, outArgs
+end function
+
+function IncreaseTint()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvPictureService.InvokeAction "IncreaseTint", inArgs, outArgs
+end function
+
+function DecreaseTint()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvPictureService.InvokeAction "DecreaseTint", inArgs, outArgs
+end function
+
+function IncreaseContrast()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvPictureService.InvokeAction "IncreaseContrast", inArgs, outArgs
+end function
+
+function DecreaseContrast()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvPictureService.InvokeAction "DecreaseContrast", inArgs, outArgs
+end function
+
+function IncreaseBrightness()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvPictureService.InvokeAction "IncreaseBrightness", inArgs, outArgs
+end function
+
+function DecreaseBrightness()
+    Dim inArgs(0)
+    Dim outArgs(0)
+    TvPictureService.InvokeAction "DecreaseBrightness", inArgs, outArgs
+end function
+
+
+
+
+' ********************************************************
+' Download the description document from the UPnP device
+' ********************************************************
+Dim TvDesc
+Set TvDesc = CreateObject("UPnP.DescriptionDocument.1")
+TvDesc.Load("tvdevicedesc.xml")
+
+
+' ********************************************************
+' Get the Root Device from the description document
+' ********************************************************
+Dim TvDevice
+Set TvDevice = TvDesc.RootDevice
+
+
+' ********************************************************
+' Output some of the device properties to the user
+' ********************************************************
+Dim output
+output = "Found: " & vbCrLf
+output = output & "DisplayName: " & TvDevice.FriendlyName & vbCrLf 
+output = output & "Type: " & TvDevice.Type & vbCrLf
+output = output & "UDN: " & TvDevice.UniqueDeviceName & vbCrLf
+MsgBox output 
+
+FName.innerText =  TvDevice.FriendlyName
+
+
+' ********************************************************
+' Attach the event handler to the tv control service 
+' ********************************************************
+Dim TvControlService
+set TvControlService=TvDevice.Services("urn:upnp-org:serviceId:tvcontrol1")
+TvControlService.AddCallback GetRef("eventHandler")
+
+' ********************************************************
+' Attach the event handler to the tv picture service 
+' ********************************************************
+Dim TvPictureService
+set TvPictureService=TvDevice.Services("urn:upnp-org:serviceId:tvpicture1")
+TvPictureService.AddCallback GetRef("eventHandler")
+
+
+
+</SCRIPT>
+</BODY>
+</HTML>
+
+
+
+
+
diff -Naur libupnp-1.6.6/upnp/sample-orig/web/tvpictureSCPD.xml libupnp-1.6.6-mod/upnp/sample-orig/web/tvpictureSCPD.xml
--- libupnp-1.6.6/upnp/sample-orig/web/tvpictureSCPD.xml	1970-01-01 08:00:00.000000000 +0800
+++ libupnp-1.6.6-mod/upnp/sample-orig/web/tvpictureSCPD.xml	2014-02-11 11:03:35.000000000 +0800
@@ -0,0 +1,249 @@
+<?xml version="1.0"?>
+<scpd xmlns="urn:schemas-upnp-org:service-1-0">
+
+  <specVersion>
+    <major>1</major>
+    <minor>0</minor>
+  </specVersion>
+
+
+  <actionList>
+
+    <action>
+      <name>SetColor</name>
+      <argumentList>
+        <argument>
+        <name>Color</name>
+          <relatedStateVariable>Color</relatedStateVariable>
+          <direction>in</direction>
+        </argument>
+
+        <argument>
+        <name>NewColor</name>
+          <retval />
+          <relatedStateVariable>Color</relatedStateVariable>
+          <direction>out</direction>
+        </argument>
+
+      </argumentList>
+    </action>
+
+    <action>
+      <name>IncreaseColor</name>    
+       <argumentList> 
+       <argument>
+        <name>Color</name>
+          <retval />
+          <relatedStateVariable>Color</relatedStateVariable>
+          <direction>out</direction>
+        </argument>  
+        </argumentList>
+    </action>
+
+    <action>
+      <name>DecreaseColor</name>     
+       <argumentList> 
+       <argument>
+        <name>Color</name>
+          <retval />
+          <relatedStateVariable>Color</relatedStateVariable>
+          <direction>out</direction>
+        </argument>  
+        </argumentList>
+    </action>
+
+    <action>
+      <name>SetTint</name>
+      <argumentList>
+        <argument>
+        <name>Tint</name>
+          <relatedStateVariable>Tint</relatedStateVariable>
+          <direction>in</direction>
+        </argument>
+        <argument>
+        <name>NewTint</name>
+          <retval />
+          <relatedStateVariable>Tint</relatedStateVariable>
+          <direction>out</direction>
+        </argument>
+
+    </argumentList>
+    </action>
+
+    <action>
+      <name>IncreaseTint</name> 
+       <argumentList>
+         <argument>
+        <name>Tint</name>
+          <retval />
+          <relatedStateVariable>Tint</relatedStateVariable>
+          <direction>out</direction>
+        </argument>
+       </argumentList>
+    </action>
+
+    <action>
+      <name>DecreaseTint</name> 
+       <argumentList>
+         <argument>
+        <name>Tint</name>
+          <retval />
+          <relatedStateVariable>Tint</relatedStateVariable>
+          <direction>out</direction>
+        </argument>
+       </argumentList>
+    </action>
+
+    <action>
+      <name>SetContrast</name>
+      <argumentList>
+    	<argument>
+        	<name>Contrast</name>
+	          <relatedStateVariable>Contrast</relatedStateVariable>
+    	      <direction>in</direction>
+       	</argument>
+	    <argument>
+        <name>NewContrast</name>
+          <retval />
+          <relatedStateVariable>Contrast</relatedStateVariable>
+          <direction>out</direction>
+        </argument>  
+    </argumentList>
+    </action>
+
+    <action>
+      <name>IncreaseContrast</name> 
+       <argumentList>
+        <argument>
+        <name>Contrast</name>
+          <retval />
+          <relatedStateVariable>Contrast</relatedStateVariable>
+          <direction>out</direction>
+        </argument>  
+       </argumentList>
+    </action>
+
+    <action>
+      <name>DecreaseContrast</name>       
+      <argumentList>
+        <argument>
+        <name>Contrast</name>
+          <retval />
+          <relatedStateVariable>Contrast</relatedStateVariable>
+          <direction>out</direction>
+        </argument>  
+       </argumentList>
+    </action>
+
+    <action>
+      <name>SetBrightness</name>
+      <argumentList>
+		<argument>
+        <name>Brightness</name>
+          <relatedStateVariable>Brightness</relatedStateVariable>
+          <direction>in</direction>
+        </argument>
+         <argument>
+        <name>NewBrightness</name>
+          <retval />
+          <relatedStateVariable>Brightness</relatedStateVariable>
+          <direction>out</direction>
+        </argument>
+      </argumentList>
+    </action>
+
+    <action>
+      <name>IncreaseBrightness</name>       
+       <argumentList>
+
+         <argument>
+        <name>Brightness</name>
+          <retval />
+          <relatedStateVariable>Brightness</relatedStateVariable>
+          <direction>out</direction>
+        </argument>
+       </argumentList>
+    </action>
+
+    <action>
+      <name>DecreaseBrightness</name>       
+      <argumentList>
+
+         <argument>
+        <name>Brightness</name>
+          <retval />
+          <relatedStateVariable>Brightness</relatedStateVariable>
+          <direction>out</direction>
+        </argument>
+       </argumentList>
+    </action>
+
+  </actionList>
+
+
+  <serviceStateTable>
+
+    <stateVariable sendEvents="yes">
+      <name>Color</name>
+      <dataType>i4</dataType>
+        <allowedValueRange>
+          <minimum>1</minimum>
+          <maximum>10</maximum>
+          <step>1</step>
+        </allowedValueRange>
+      <defaultValue>5</defaultValue>
+    </stateVariable>
+
+    <stateVariable sendEvents="yes">
+      <name>Tint</name>
+      <dataType>i4</dataType>
+        <allowedValueRange>
+          <minimum>1</minimum>
+          <maximum>10</maximum>
+          <step>1</step>
+        </allowedValueRange>
+      <defaultValue>5</defaultValue>
+    </stateVariable>
+
+    <stateVariable sendEvents="yes">
+      <name>Contrast</name>
+      <dataType>i4</dataType>
+        <allowedValueRange>
+          <minimum>1</minimum>
+          <maximum>10</maximum>
+          <step>1</step>
+        </allowedValueRange>
+      <defaultValue>5</defaultValue>
+    </stateVariable>
+
+    <stateVariable sendEvents="yes">
+      <name>Brightness</name>
+      <dataType>i4</dataType>
+        <allowedValueRange>
+          <minimum>1</minimum>
+          <maximum>10</maximum>
+          <step>1</step>
+        </allowedValueRange>
+      <defaultValue>5</defaultValue>
+    </stateVariable>
+
+  </serviceStateTable>
+
+
+</scpd>
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
